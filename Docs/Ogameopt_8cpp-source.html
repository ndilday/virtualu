<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Ogameopt.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Ogameopt.cpp</h1><a href="Ogameopt_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">// Functions : Game options interface</span>
00002 <span class="comment">// Flies : Ogameopt.cpp</span>
00003 <span class="comment">// Owner: chwg1012</span>
00004 
00005 <span class="preprocessor">#include &lt;<a class="code" href="KEY_8H.html">KEY.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;<a class="code" href="Osys_8h.html">Osys.h</a>&gt;</span>
00007 <span class="preprocessor">#include &lt;<a class="code" href="OSTR_8H.html">OSTR.H</a>&gt;</span>
00008 <span class="preprocessor">#include &lt;OMISC.H&gt;</span>
00009 <span class="preprocessor">#include &lt;<a class="code" href="OMUSIC_8H.html">OMUSIC.H</a>&gt;</span>
00010 <span class="preprocessor">#include &lt;<a class="code" href="OGAMESET_8H.html">OGAMESET.H</a>&gt;</span>
00011 <span class="preprocessor">#include &lt;OAUDIO.H&gt;</span>
00012 <span class="preprocessor">#include &lt;OWORLDMT.H&gt;</span>
00013 <span class="preprocessor">#include &lt;ODEPT.H&gt;</span>
00014 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00015 <span class="preprocessor">#include &lt;OCONFIG.H&gt;</span>
00016 <span class="preprocessor">#include &lt;OIFACE.H&gt;</span>
00017 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>
00018 <span class="preprocessor">#include &lt;OBUTTON.H&gt;</span>
00019 <span class="preprocessor">#include &lt;<a class="code" href="OGETA_8H.html">OGETA.H</a>&gt;</span>
00020 <span class="preprocessor">#include &lt;OVBROW98.h&gt;</span>
00021 <span class="preprocessor">#include &lt;<a class="code" href="OVGALOCK_8H.html">OVGALOCK.H</a>&gt;</span>
00022 <span class="preprocessor">#include &lt;<a class="code" href="OVALSLDR_8H.html">OVALSLDR.H</a>&gt;</span>
00023 <span class="preprocessor">#include &lt;OPSCHOOL.H&gt;</span>
00024 <span class="preprocessor">#include &lt;<a class="code" href="OBOX_8H.html">OBOX.H</a>&gt;</span>
00025 <span class="preprocessor">#include &lt;OGFILE.H&gt;</span>                               <span class="comment">//## fred 1109</span>
00026 
00027 <span class="keyword">enum</span> {                                            <span class="comment">// screen coordinates</span>
00028     <a class="code" href="Ogameopt_8cpp.html#a44a22">REPORT_X1</a> = <a class="code" href="Oworldmt_8h.html#a12">ZOOM_X1</a>+15,
00029     <a class="code" href="Ogameopt_8cpp.html#a44a23">REPORT_Y1</a> = <a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a>+25,
00030     <a class="code" href="Ogameopt_8cpp.html#a44a24">REPORT_X2</a> = <a class="code" href="Oworldmt_8h.html#a14">ZOOM_X2</a>-15,
00031     <a class="code" href="Ogameopt_8cpp.html#a44a25">REPORT_Y2</a> = <a class="code" href="Oworldmt_8h.html#a15">ZOOM_Y2</a>-25
00032 };
00033 
00034 <span class="keyword">enum</span> {                                            <span class="comment">// screen coordinates</span>
00035     <a class="code" href="Ogameopt_8cpp.html#a45a26">WIN_X1</a> = <a class="code" href="Ogameopt_8cpp.html#a44a22">REPORT_X1</a>+15,
00036     <a class="code" href="Ogameopt_8cpp.html#a45a27">WIN_Y1</a> = <a class="code" href="Ogameopt_8cpp.html#a44a23">REPORT_Y1</a>+25,
00037     <a class="code" href="Ogameopt_8cpp.html#a45a28">WIN_X2</a> = <a class="code" href="Ogameopt_8cpp.html#a44a24">REPORT_X2</a>-15,
00038     <a class="code" href="Ogameopt_8cpp.html#a45a29">WIN_Y2</a> = <a class="code" href="Ogameopt_8cpp.html#a44a25">REPORT_Y2</a>-25
00039 };
00040 
00041 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00042 <span class="preprocessor"></span><span class="keyword">enum</span>{<a class="code" href="Ogameopt_8cpp.html#a46a30">SAVE_GAME</a>,<a class="code" href="Ogameopt_8cpp.html#a46a31">LOAD_GAME</a>,LOG_OUTPUT_NOW,<a class="code" href="Ogameopt_8cpp.html#a46a32">RETIRE</a>,<a class="code" href="Ogameopt_8cpp.html#a46a33">QUIT_TO_MAIN_MENU</a>,<a class="code" href="Ogameopt_8cpp.html#a46a34">QUIT_TO_WINDOW</a>,<a class="code" href="Ogameopt_8cpp.html#a46a35">CONTINUE_GAME</a>,<a class="code" href="Ogameopt_8cpp.html#a46a36">NONE</a>,<a class="code" href="Ogameopt_8cpp.html#a46a37">GO_BUTTON_COUNT</a>=<a class="code" href="Ogameopt_8cpp.html#a46a36">NONE</a>};
00043 <span class="preprocessor">#else</span>
00044 <span class="preprocessor"></span><span class="keyword">enum</span>{<a class="code" href="Ogameopt_8cpp.html#a46a30">SAVE_GAME</a>,<a class="code" href="Ogameopt_8cpp.html#a46a31">LOAD_GAME</a>,<a class="code" href="Ogameopt_8cpp.html#a46a32">RETIRE</a>,<a class="code" href="Ogameopt_8cpp.html#a46a33">QUIT_TO_MAIN_MENU</a>,<a class="code" href="Ogameopt_8cpp.html#a46a34">QUIT_TO_WINDOW</a>,<a class="code" href="Ogameopt_8cpp.html#a46a35">CONTINUE_GAME</a>,<a class="code" href="Ogameopt_8cpp.html#a46a36">NONE</a>,<a class="code" href="Ogameopt_8cpp.html#a46a37">GO_BUTTON_COUNT</a>=<a class="code" href="Ogameopt_8cpp.html#a46a36">NONE</a>};
00045 <span class="preprocessor">#endif</span>
00046 <span class="preprocessor"></span><span class="keyword">static</span> <a class="code" href="classButton.html">Button</a> go_button[<a class="code" href="Ogameopt_8cpp.html#a46a37">GO_BUTTON_COUNT</a>];
00047 <span class="comment">//static short * go_button_up_bitmap[6];</span>
00048 <span class="comment">//static short * go_button_down_bitmap[6];</span>
00049 <span class="keyword">static</span> <span class="keywordtype">char</span> * go_button_label[<a class="code" href="Ogameopt_8cpp.html#a46a37">GO_BUTTON_COUNT</a>]= {
00050     <span class="stringliteral">"Save Game"</span>,
00051     <span class="stringliteral">"Load Game"</span>,
00052 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00053 <span class="preprocessor"></span>    <span class="stringliteral">"Log Output Now"</span>,
00054 <span class="preprocessor">#endif</span>
00055 <span class="preprocessor"></span>    <span class="stringliteral">"Retire"</span>,
00056     <span class="stringliteral">"Quit to Main Menu"</span>,
00057     <span class="stringliteral">"Quit to Windows"</span>,
00058     <span class="stringliteral">"Continue Game"</span>
00059 };
00060 
00061 <span class="keyword">enum</span>{<a class="code" href="Ogameopt_8cpp.html#a47a38">SCR_TOP</a>,<a class="code" href="Ogameopt_8cpp.html#a47a39">SCR_SAVE_GAME</a>,<a class="code" href="Ogameopt_8cpp.html#a47a40">SCR_LOAD_GAME</a>};
00062 
00063 <span class="keyword">static</span> <a class="code" href="classButton.html">Button</a> ar_button[2];
00064 <span class="keyword">static</span> <a class="code" href="classButton.html">Button</a> help_button[2];
00065 <span class="keyword">static</span> <a class="code" href="classButton.html">Button</a> music_button[2];
00066 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00067 <span class="preprocessor"></span><span class="keyword">static</span> <a class="code" href="classButton.html">Button</a> threshold_event_button[2];
00068 <span class="keyword">static</span> <a class="code" href="classButton.html">Button</a> building_label_button[2];
00069 <span class="preprocessor">#endif</span>
00070 <span class="preprocessor"></span><span class="comment">//static short * ar_button_up_bitmap[2];</span>
00071 <span class="comment">//static short * ar_button_down_bitmap[2];</span>
00072 <span class="keyword">static</span> <span class="keywordtype">short</span> * background_bitmap=<a class="code" href="OHELP_8H.html#a0">NULL</a>;
00073 
00074 <span class="keyword">static</span> <a class="code" href="classButton.html">Button</a> save_button;
00075 <span class="keyword">static</span> <a class="code" href="classButton.html">Button</a> load_button;
00076 <span class="keyword">static</span> <a class="code" href="classButton.html">Button</a> delete_button;
00077 <span class="keyword">static</span> <a class="code" href="classButton.html">Button</a> cancel_button;
00078 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00079 <span class="preprocessor"></span><span class="keyword">static</span> <a class="code" href="classButton.html">Button</a> browse_button;
00080 <span class="preprocessor">#endif</span>
00081 <span class="preprocessor"></span><span class="keyword">static</span> <a class="code" href="classVBrowse98.html">VBrowse98</a> game_browser;
00082 
00083 <span class="keyword">static</span> <a class="code" href="classValueSlider.html">ValueSlider</a> vslider[3];
00084 <span class="keyword">static</span> <span class="keywordtype">int</span> current_option=<a class="code" href="Ogameopt_8cpp.html#a46a36">NONE</a>;
00085 <span class="keyword">static</span> <span class="keywordtype">int</span> current_screen_type=<a class="code" href="Ogameopt_8cpp.html#a47a38">SCR_TOP</a>;
00086 
00087 <span class="keyword">static</span> <span class="keywordtype">void</span> disp_load_game_rec(<span class="keywordtype">int</span>,<span class="keywordtype">int</span>,<span class="keywordtype">int</span>,<span class="keywordtype">int</span>);
00088 <span class="keyword">static</span> <span class="keywordtype">void</span> disp_save_game_rec(<span class="keywordtype">int</span>,<span class="keywordtype">int</span>,<span class="keywordtype">int</span>,<span class="keywordtype">int</span>);
00089 
00090 <span class="keyword">static</span> <span class="keywordtype">int</span> redraw_scr_save_browser;
00091 <span class="keyword">static</span> <a class="code" href="classGetA.html">GetA</a> game_name;
00092 <span class="keyword">static</span> <a class="code" href="classString.html">String</a> game_name_str;
00093 
00094 <span class="keyword">static</span> <span class="keywordtype">char</span> * go_label[]= {
00095     <span class="stringliteral">"Sound Effects Volume"</span>,
00096     <span class="stringliteral">"Music Volume"</span>,
00097     <span class="stringliteral">"Game Speed"</span>,
00098     <span class="stringliteral">"Help"</span>,
00099     <span class="stringliteral">"Annual Report"</span>,
00100 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00101 <span class="preprocessor"></span>    <span class="stringliteral">"Threshold Events"</span>,
00102     <span class="stringliteral">"Building Labels"</span>,
00103 <span class="preprocessor">#endif</span>
00104 <span class="preprocessor"></span>};
00105 
00106 <span class="keyword">static</span> <span class="keywordtype">char</span> * help_label[2]= {
00107     <span class="stringliteral">"On"</span>,
00108     <span class="stringliteral">"Off"</span>,
00109 };
00110 
00111 <span class="keyword">static</span> <span class="keywordtype">char</span> * ar_label[2]= {
00112     <span class="stringliteral">"On"</span>,
00113     <span class="stringliteral">"Off"</span>,
00114 };
00115 
00116 <span class="keyword">static</span> <span class="keywordtype">int</span> v[3];
00117 <span class="keyword">static</span> <span class="keywordtype">int</span> browser_rec_size;
00118 
00119 <span class="keywordtype">void</span> <a class="code" href="Ogameopt_8cpp.html#a43">free_button_memory</a>(<span class="keywordtype">void</span>);
00120 
<a name="l00121"></a><a class="code" href="classSys.html#a24">00121</a> <span class="keywordtype">void</span> <a class="code" href="classSys.html#a24">Sys::setting_report</a>(<span class="keywordtype">int</span> refreshFlag) {
00122     <span class="keyword">static</span> <span class="keywordtype">int</span>  tab1=<a class="code" href="Ogameopt_8cpp.html#a45a26">WIN_X1</a>+10,
00123         tab2=<a class="code" href="Ogameopt_8cpp.html#a45a26">WIN_X1</a>+410,
00124         vtab0=<a class="code" href="Ogameopt_8cpp.html#a45a27">WIN_Y1</a>+10,
00125         vtab1=<a class="code" href="Ogameopt_8cpp.html#a45a27">WIN_Y1</a>+60,
00126         vtab2=<a class="code" href="Ogameopt_8cpp.html#a45a29">WIN_Y2</a>-30;
00127 
00128     <span class="comment">//   vga.use_back();</span>
00129     <span class="comment">//------ begin : Top Screen of game options --//</span>
00130     <span class="keywordflow">if</span>(current_screen_type==<a class="code" href="Ogameopt_8cpp.html#a47a38">SCR_TOP</a>) {
00131         <span class="keywordtype">int</span> i,j;
00132         <span class="keywordflow">if</span> (refreshFlag == <a class="code" href="Gamedef_8h.html#a71a16">INFO_REPAINT</a>) {
00133 
00134             v[2]=(sys.save_speed+2)/10;
00135             <span class="comment">//                  v[2]=(config.frame_speed+2)/10;</span>
00136             v[1]=config.cd_music_volume/10;
00137             v[0]=config.sound_effect_volume/10;
00138             <span class="keywordflow">if</span>(!background_bitmap) {
00139                 user_interface.darken(<a class="code" href="Oworldmt_8h.html#a12">ZOOM_X1</a>,<a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a>,<a class="code" href="Oworldmt_8h.html#a14">ZOOM_X2</a>,<a class="code" href="Oworldmt_8h.html#a15">ZOOM_Y2</a>);
00140                 info.disp_column_bitmap(&amp;vga_back);
00141                 user_interface.brighten(<a class="code" href="Ogameopt_8cpp.html#a45a26">WIN_X1</a>,<a class="code" href="Ogameopt_8cpp.html#a45a27">WIN_Y1</a>,<a class="code" href="Ogameopt_8cpp.html#a45a28">WIN_X2</a>,<a class="code" href="Ogameopt_8cpp.html#a45a29">WIN_Y2</a>);
00142                 user_interface.rect(<a class="code" href="Ogameopt_8cpp.html#a45a26">WIN_X1</a>,<a class="code" href="Ogameopt_8cpp.html#a45a27">WIN_Y1</a>,<a class="code" href="Ogameopt_8cpp.html#a45a28">WIN_X2</a>,<a class="code" href="Ogameopt_8cpp.html#a45a29">WIN_Y2</a>);
00143                 background_bitmap=vga_back.save_area
00144                     (<a class="code" href="Oworldmt_8h.html#a12">ZOOM_X1</a>,<a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a>,<a class="code" href="Oworldmt_8h.html#a14">ZOOM_X2</a>,<a class="code" href="Oworldmt_8h.html#a15">ZOOM_Y2</a>,background_bitmap);
00145             }
00146             <span class="keywordflow">else</span>
00147                 vga_back.rest_area(background_bitmap,0,0);
00148 
00149             <a class="code" href="Ogameopt_8cpp.html#a43">free_button_memory</a>();
00150 
00151 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00152 <span class="preprocessor"></span>            <span class="keyword">const</span> rv0 = vtab1;
00153             <span class="keyword">const</span> rvi = 36;
00154             <span class="keyword">const</span> rvh = 28;
00155 
00156             <span class="keyword">const</span> lv0 = vtab1;
00157             <span class="keyword">const</span> lvi = 36;
00158             <span class="keyword">const</span> lvh = 22;
00159 <span class="preprocessor">#else</span>
00160 <span class="preprocessor"></span>            <span class="keyword">const</span> rv0 = vtab1;
00161             <span class="keyword">const</span> rvi = 40;
00162             <span class="keyword">const</span> rvh = 30;
00163 
00164             <span class="keyword">const</span> lv0 = vtab1+15;
00165             <span class="keyword">const</span> lvi = 40;
00166             <span class="keyword">const</span> lvh = 22;
00167 <span class="preprocessor">#endif</span>
00168 <span class="preprocessor"></span>
00169             <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="Ogameopt_8cpp.html#a46a37">GO_BUTTON_COUNT</a>;i++) {
00170                 go_button[i].<a class="code" href="classButton.html#a10">create_text</a>(
00171                     tab2, rv0+i*rvi,                        <span class="comment">// vtab1+i*40,</span>
00172                     tab2+250, rv0+i*rvi+rvh,                <span class="comment">// vtab1+i*40+30,</span>
00173                     go_button_label[i] );
00174             }
00175 
00176             <span class="keywordflow">for</span>(i=0;i&lt;2;i++) {
00177                 music_button[i].<a class="code" href="classButton.html#a10">create_text</a>(
00178                     tab1+200+i*50, lv0+1*lvi,               <span class="comment">// vtab1+55,</span>
00179                     tab1+240+i*50, lv0+1*lvi+lvh,           <span class="comment">// vtab1+55+22,</span>
00180                     ar_label[i]
00181                     );
00182                 help_button[i].<a class="code" href="classButton.html#a10">create_text</a>(
00183                     tab1+200+i*50, lv0+3*lvi,               <span class="comment">// vtab1+135,</span>
00184                     tab1+240+i*50, lv0+3*lvi+lvh,           <span class="comment">// vtab1+135+22,</span>
00185                     help_label[i]
00186                     );
00187                 ar_button[i].<a class="code" href="classButton.html#a10">create_text</a>(
00188                     tab1+200+i*50, lv0+4*lvi,               <span class="comment">// vtab1+175,</span>
00189                     tab1+240+i*50, lv0+4*lvi+lvh,           <span class="comment">// vtab1+175+22,</span>
00190                     ar_label[i]
00191                     );
00192 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00193 <span class="preprocessor"></span>                threshold_event_button[i].<a class="code" href="classButton.html#a10">create_text</a>(
00194                     tab1+200+i*50, lv0+5*lvi,
00195                     tab1+240+i*50, lv0+5*lvi+lvh,
00196                     ar_label[i]
00197                     );
00198                 building_label_button[i].<a class="code" href="classButton.html#a10">create_text</a>(
00199                     tab1+200+i*50, lv0+6*lvi,
00200                     tab1+240+i*50, lv0+6*lvi+lvh,
00201                     ar_label[i]
00202                     );
00203 <span class="preprocessor">#endif</span>
00204 <span class="preprocessor"></span>            }
00205 
00206             font_charts.put(tab1+280, vtab0,<span class="stringliteral">"Game Menu"</span>);
00207 
00208 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00209 <span class="preprocessor"></span>            <span class="keywordflow">for</span>(j=0;j&lt;7;j++)
00210 <span class="preprocessor">#else</span>
00211 <span class="preprocessor"></span>                <span class="keywordflow">for</span>(j=0;j&lt;5;j++)
00212 <span class="preprocessor">#endif</span>
00213 <span class="preprocessor"></span>                {
00214                     font_chartsm.put(
00215                         tab1+25, lv0+j*lvi+5,                   <span class="comment">// vtab1+j*40+20,</span>
00216                         go_label[j]
00217                         );
00218                 }
00219 
00220             <span class="keywordflow">for</span>(j=0;j&lt;3;j+=2) {
00221                 vslider[j].<a class="code" href="classValueSlider.html#a2">init</a>(
00222                     tab1+200, lv0+j*lvi+2,                  <span class="comment">// vtab1+j*40+17,</span>
00223                     150,20,0, 10, &amp;v[j], 1, <a class="code" href="COLOR_8H.html#a25">V_YELLOW</a>, 4);
00224                 <span class="comment">//                              vslider[j].paint();</span>
00225             }
00226         }
00227 
00228         <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="Ogameopt_8cpp.html#a46a37">GO_BUTTON_COUNT</a>;i++)
00229             go_button[i].<a class="code" href="classButton.html#a20">paint</a>();
00230 
00231         <span class="keywordflow">for</span>(i=0;i&lt;2;i++) {
00232             <span class="keywordflow">if</span>(i == (1-config.cd_music_volume))
00233                 music_button[i].<a class="code" href="classButton.html#a24">push</a>();
00234             <span class="keywordflow">else</span>
00235                 music_button[i].<a class="code" href="classButton.html#a25">pop</a>();
00236             music_button[i].<a class="code" href="classButton.html#a20">paint</a>();
00237         }
00238 
00239         <span class="keywordflow">for</span>(i=0;i&lt;2;i++) {
00240             <span class="keywordflow">if</span>(i == (1-config.context_sensitive_help))
00241                 help_button[i].<a class="code" href="classButton.html#a24">push</a>();
00242             <span class="keywordflow">else</span>
00243                 help_button[i].<a class="code" href="classButton.html#a25">pop</a>();
00244             help_button[i].<a class="code" href="classButton.html#a20">paint</a>();
00245         }
00246 
00247         <span class="keywordflow">for</span>(i=0;i&lt;2;i++) {
00248             <span class="keywordflow">if</span>(i == (1-config.disp_year_end_report))
00249                 ar_button[i].<a class="code" href="classButton.html#a24">push</a>();
00250             <span class="keywordflow">else</span>
00251                 ar_button[i].<a class="code" href="classButton.html#a25">pop</a>();
00252             ar_button[i].<a class="code" href="classButton.html#a20">paint</a>();
00253         }
00254 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00255 <span class="preprocessor"></span>        <span class="keywordflow">for</span>(i=0;i&lt;2;i++) {
00256             <span class="keywordflow">if</span>( i == (1-player_school.threshold_event_flag))
00257                 threshold_event_button[i].<a class="code" href="classButton.html#a24">push</a>();
00258             <span class="keywordflow">else</span>
00259                 threshold_event_button[i].<a class="code" href="classButton.html#a25">pop</a>();
00260             threshold_event_button[i].<a class="code" href="classButton.html#a20">paint</a>();
00261         }
00262 
00263         <span class="keywordflow">for</span>(i=0;i&lt;2;i++) {
00264             <span class="keywordflow">if</span>( i == (1-config.disp_building_label))
00265                 building_label_button[i].<a class="code" href="classButton.html#a24">push</a>();
00266             <span class="keywordflow">else</span>
00267                 building_label_button[i].<a class="code" href="classButton.html#a25">pop</a>();
00268             building_label_button[i].<a class="code" href="classButton.html#a20">paint</a>();
00269         }
00270 <span class="preprocessor">#endif</span>
00271 <span class="preprocessor"></span>
00272         <span class="keywordflow">for</span>(i=0;i&lt;3;i+=2)
00273             vslider[i].<a class="code" href="classValueSlider.html#a7">refresh</a>();
00274 
00275         <span class="comment">// the report does not belong to any of the buttons</span>
00276         vga_back.put_bitmap(<a class="code" href="Oinfo_8h.html#a99a6">REPORT_BUTTON_X1</a>, <a class="code" href="Oinfo_8h.html#a99a7">REPORT_BUTTON_Y1</a>, info.report_bitmap[0]);
00277         <span class="comment">//              user_interface.darken(REPORT_BUTTON_X1, REPORT_BUTTON_Y1, REPORT_BUTTON_X2, REPORT_BUTTON_Y2-1);</span>
00278         <span class="comment">//              vga.blt_buf(REPORT_BUTTON_X1, REPORT_BUTTON_Y1, REPORT_BUTTON_X2, REPORT_BUTTON_Y2-1);</span>
00279     }
00280     <span class="comment">//------ begin : Save game Screen of game options --//</span>
00281     <span class="keywordflow">if</span>( current_screen_type==<a class="code" href="Ogameopt_8cpp.html#a47a39">SCR_SAVE_GAME</a>) {
00282         <span class="keywordflow">if</span> (refreshFlag == <a class="code" href="Gamedef_8h.html#a71a16">INFO_REPAINT</a> || redraw_scr_save_browser) {
00283             vga_back.rest_area(background_bitmap,0,0);
00284             user_interface.bar(tab1+200,vtab1-5,tab1+550,vtab1+22,<a class="code" href="COLOR_8H.html#a17">V_WHITE</a>);
00285             user_interface.rect(tab1+200,vtab1-5,tab1+550,vtab1+22);
00286 
00287             font_charts.put(tab1+290, vtab0,<span class="stringliteral">"Save Game"</span>);
00288             save_button.<a class="code" href="classButton.html#a10">create_text</a>(tab1+150,vtab2,tab1+220,vtab2+20,<span class="stringliteral">"Save"</span>);
00289             delete_button.<a class="code" href="classButton.html#a10">create_text</a>(tab1+300,vtab2,tab1+370,vtab2+20,<span class="stringliteral">"Delete"</span>);
00290             cancel_button.<a class="code" href="classButton.html#a10">create_text</a>(tab1+450,vtab2,tab1+520,vtab2+20,<span class="stringliteral">"Close"</span>);
00291 
00292             user_interface.brighten(tab1+100, vtab1+35, tab1+550, vtab2-20);
00293             user_interface.rect(tab1+100, vtab1+35, tab1+550, vtab2-20);
00294 
00295             game_browser.<a class="code" href="classVBrowse98.html#a2">init</a>( tab1+100, vtab1+35, tab1+550, vtab2-20,
00296                                0, 18, browser_rec_size, disp_save_game_rec );
00297             game_browser.<a class="code" href="classVBrowse98.html#a4">open</a>(game_browser.<a class="code" href="classVBrowse98.html#a6">recno</a>());
00298 
00299             font_chartsm.put(tab1+100,vtab1,<span class="stringliteral">"Game name"</span>);
00300             <span class="keywordflow">if</span>(!redraw_scr_save_browser)
00301                 game_name.<a class="code" href="classGetA.html#a1">init</a>(tab1+210,vtab1+2,tab1+550,game_name_str.<a class="code" href="classString.html#m0">str_buf</a>,18,&amp;font_charts,0,1);
00302             redraw_scr_save_browser=0;
00303         }
00304         <span class="comment">//      int rc=game_browser.recno();</span>
00305         <span class="comment">//      game_browser.update();</span>
00306         user_interface.bar(tab1+200,vtab1-5,tab1+550,vtab1+22,<a class="code" href="COLOR_8H.html#a17">V_WHITE</a>);
00307         user_interface.rect(tab1+200,vtab1-5,tab1+550,vtab1+22);
00308         game_name.<a class="code" href="classGetA.html#a7">paint</a>();
00309 
00310         save_button.<a class="code" href="classButton.html#a20">paint</a>();
00311         delete_button.<a class="code" href="classButton.html#a20">paint</a>();
00312         cancel_button.<a class="code" href="classButton.html#a20">paint</a>();
00313     }
00314 
00315     <span class="comment">//------ begin : Load game Screen of game options --//</span>
00316     <span class="keywordflow">if</span>( current_screen_type==<a class="code" href="Ogameopt_8cpp.html#a47a40">SCR_LOAD_GAME</a>) {
00317         <span class="keywordflow">if</span> (refreshFlag == <a class="code" href="Gamedef_8h.html#a71a16">INFO_REPAINT</a>) {
00318             vga_back.rest_area(background_bitmap,0,0);
00319             font_charts.put(tab1+290, vtab0,<span class="stringliteral">"Load Game"</span>);
00320 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00321 <span class="preprocessor"></span>            load_button.<a class="code" href="classButton.html#a10">create_text</a>(tab1+130,vtab2,tab1+200,vtab2+20,<span class="stringliteral">"Load"</span>);
00322             delete_button.<a class="code" href="classButton.html#a10">create_text</a>(tab1+240,vtab2,tab1+310,vtab2+20,<span class="stringliteral">"Delete"</span>);
00323             cancel_button.<a class="code" href="classButton.html#a10">create_text</a>(tab1+350,vtab2,tab1+420,vtab2+20,<span class="stringliteral">"Close"</span>);
00324             browse_button.<a class="code" href="classButton.html#a10">create_text</a>(tab1+460,vtab2,tab1+530,vtab2+20,<span class="stringliteral">"Browse"</span>);
00325 <span class="preprocessor">#else</span>
00326 <span class="preprocessor"></span>            load_button.<a class="code" href="classButton.html#a10">create_text</a>(tab1+150,vtab2,tab1+220,vtab2+20,<span class="stringliteral">"Load"</span>);
00327             delete_button.<a class="code" href="classButton.html#a10">create_text</a>(tab1+300,vtab2,tab1+370,vtab2+20,<span class="stringliteral">"Delete"</span>);
00328             cancel_button.<a class="code" href="classButton.html#a10">create_text</a>(tab1+450,vtab2,tab1+520,vtab2+20,<span class="stringliteral">"Close"</span>);
00329 <span class="preprocessor">#endif</span>
00330 <span class="preprocessor"></span>
00331             user_interface.brighten(tab1+100, vtab1+10, tab1+550, vtab2-20);
00332             user_interface.rect(tab1+100, vtab1+10, tab1+550, vtab2-20);
00333             game_browser.<a class="code" href="classVBrowse98.html#a2">init</a>( tab1+100, vtab1+10, tab1+550, vtab2-20,
00334                                0, 18, browser_rec_size, disp_load_game_rec );
00335             game_browser.<a class="code" href="classVBrowse98.html#a4">open</a>(game_browser.<a class="code" href="classVBrowse98.html#a6">recno</a>());
00336         }
00337 
00338         <span class="comment">//      int rc=game_browser.recno();</span>
00339         <span class="comment">//      game_browser.update();</span>
00340 
00341         load_button.<a class="code" href="classButton.html#a20">paint</a>();
00342         delete_button.<a class="code" href="classButton.html#a20">paint</a>();
00343         cancel_button.<a class="code" href="classButton.html#a20">paint</a>();
00344 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00345 <span class="preprocessor"></span>        browse_button.<a class="code" href="classButton.html#a20">paint</a>();
00346 <span class="preprocessor">#endif</span>
00347 <span class="preprocessor"></span>    }
00348 
00349     vga.blt_buf(<a class="code" href="Oworldmt_8h.html#a12">ZOOM_X1</a>,<a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a>,<a class="code" href="Oworldmt_8h.html#a14">ZOOM_X2</a>,<a class="code" href="Oworldmt_8h.html#a15">ZOOM_Y2</a>);
00350     <span class="comment">//  vga.use_front();</span>
00351 };
00352 
00353 <span class="comment">//------ Start of function Sys::setting_report_detect -----//</span>
00354 
<a name="l00355"></a><a class="code" href="classSys.html#a25">00355</a> <span class="keywordtype">int</span> <a class="code" href="classSys.html#a25">Sys::setting_report_detect</a>() {
00356     <span class="comment">//</span>
00357     <span class="keywordflow">if</span>( current_screen_type==<a class="code" href="Ogameopt_8cpp.html#a47a38">SCR_TOP</a>) {
00358         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;3;i+=2) {
00359             <span class="keywordflow">if</span>(vslider[i].<a class="code" href="classValueSlider.html#a8">detect</a>()) {
00360                 v[i]=(*vslider[i].<a class="code" href="classValueSlider.html#m7">var_ptr</a>);
00361 
00362                 <span class="keywordflow">if</span>(i==0) {
00363                     config.sound_effect_volume=v[0]*10;
00364                     audio.play_wav(<span class="stringliteral">"BEEPS-TI"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00365                     audio.set_wav_volume(v[0]*10);
00366                 }
00367 
00368                 <span class="comment">// ## begin zb 02/21/99</span>
00369                 <span class="keywordflow">if</span>(i==2)
00370                     sys.save_speed=v[2]*98/10;
00371                 <span class="comment">// ## end zb 02/21/99</span>
00372 
00373                 <span class="keywordflow">return</span> 1;
00374             }
00375         }
00376 
00377         vga.use_front();
00378         <span class="comment">//      for(i=0;i&lt;6;i++)</span>
00379         <span class="comment">//                      if(go_button_up_bitmap[i])</span>
00380         <span class="comment">//                      go_button[i].body_ptr = (void *) (go_button_up_bitmap[i] + 4);</span>
00381 
00382         <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="Ogameopt_8cpp.html#a46a37">GO_BUTTON_COUNT</a>;i++)
00383             <span class="keywordflow">if</span>(go_button[i].<a class="code" href="classButton.html#a21">detect</a>()) {
00384                 current_option=i;
00385                 <span class="comment">//                              if(go_button_down_bitmap[i])</span>
00386                 <span class="comment">//                              go_button[current_option].body_ptr = (void *) (go_button_down_bitmap[current_option] + 4);</span>
00387 
00388                 <span class="keywordflow">if</span>(current_option==<a class="code" href="Ogameopt_8cpp.html#a46a35">CONTINUE_GAME</a>) {
00389                     <a class="code" href="classSys.html#m39">menu_pull_down</a> = 0;
00390                     <a class="code" href="classSys.html#a15">set_staying_view_mode</a>(0);
00391                     sys.redraw_all_flag=1;
00392                     <span class="comment">//## fred 0213</span>
00393                     <span class="keywordflow">if</span> ( config.cd_music_volume &lt;=0 )
00394                         music.stop();
00395                     <span class="comment">//## fred 0213</span>
00396                 }
00397 
00398                 <span class="keywordflow">if</span>(current_option==<a class="code" href="Ogameopt_8cpp.html#a46a34">QUIT_TO_WINDOW</a>) {
00399                     <span class="keywordtype">int</span> rc;
00400                     rc=box.ask(<span class="stringliteral">"Quit to Windows now?  "</span>);
00401                     <span class="keywordflow">if</span>(rc==1)
00402                         sys.signal_exit_flag = 1;
00403                     <span class="keywordflow">else</span>
00404                         sys.redraw_all_flag = 1;
00405                 }
00406 
00407                 <span class="keywordflow">if</span>(current_option==<a class="code" href="Ogameopt_8cpp.html#a46a33">QUIT_TO_MAIN_MENU</a>) {
00408                     <span class="keywordtype">int</span> rc;
00409                     rc=box.ask(<span class="stringliteral">"Quit to Main Menu now?  "</span>);
00410                     <span class="keywordflow">if</span>(rc==1) {
00411                         sys.signal_exit_flag = 2;
00412                         <a class="code" href="classSys.html#m39">menu_pull_down</a> = 0;
00413                         <a class="code" href="classSys.html#a15">set_staying_view_mode</a>(0);
00414                         sys.set_speed(<a class="code" href="Osys_8h.html#a43a7">DEFAULT_SPEED</a>);
00415                     }
00416                     <span class="keywordflow">else</span>
00417                         sys.redraw_all_flag = 1;
00418                 }
00419 
00420                 <span class="keywordflow">if</span>(current_option==<a class="code" href="Ogameopt_8cpp.html#a46a32">RETIRE</a>) {
00421                     <span class="keywordtype">int</span> rc;
00422                     rc=box.ask(<span class="stringliteral">"Retire now?  "</span>);
00423                     <span class="keywordflow">if</span>(rc==1) {
00424                         <span class="comment">/*                                      sys.signal_exit_flag = 2;</span>
00425 <span class="comment">                                                                menu_pull_down = 0;</span>
00426 <span class="comment">                                                                set_staying_view_mode(0);</span>
00427 <span class="comment">                                                                sys.set_speed(DEFAULT_SPEED);</span>
00428 <span class="comment">                        */</span>
00429                         sys.set_staying_view_mode(<a class="code" href="Osys_8h.html#a45a22">MODE_RETIREMENT</a>);
00430                         <span class="comment">//## fred 0213</span>
00431                         <span class="comment">//                                              game_file_array.add_hall_of_fame(player_school.ultimate_game_score);</span>
00432 
00433                         <span class="keywordflow">if</span> ( config.cd_music_volume &lt;=0 )
00434                             music.stop();
00435                         <span class="comment">//## fred 0213</span>
00436                     }
00437                     <span class="keywordflow">else</span>
00438                         sys.redraw_all_flag = 1;
00439                 }
00440 
00441                 <span class="keywordflow">if</span>(current_option==<a class="code" href="Ogameopt_8cpp.html#a46a30">SAVE_GAME</a>) {
00442                     game_file_array.init(<span class="stringliteral">"*.SAV"</span>);            <span class="comment">//## fred</span>
00443 
00444                     sys.redraw_all_flag=1;
00445                     current_screen_type=<a class="code" href="Ogameopt_8cpp.html#a47a39">SCR_SAVE_GAME</a>;
00446                     game_name_str=player_school.player_last_name;
00447                     browser_rec_size=game_file_array.size();
00448                 }
00449 
00450                 <span class="keywordflow">if</span>(current_option==<a class="code" href="Ogameopt_8cpp.html#a46a31">LOAD_GAME</a>) {
00451                     sys.redraw_all_flag=1;
00452                     current_screen_type=<a class="code" href="Ogameopt_8cpp.html#a47a40">SCR_LOAD_GAME</a>;
00453                     game_file_array.init(<span class="stringliteral">"*.SAV"</span>);            <span class="comment">//## fred</span>
00454                     browser_rec_size=game_file_array.size();
00455                 }
00456 
00457 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00458 <span class="preprocessor"></span>                <span class="keywordflow">if</span>( current_option==LOG_OUTPUT_NOW ) {
00459                     <span class="comment">// if config.log_enable, write to log file</span>
00460                     <span class="keywordflow">if</span>( config.log_enable &amp;&amp; config.log_file_name[0] ) {
00461                         game_file.append_game_log( config.log_file_name );
00462                     }
00463                     <span class="keywordflow">else</span> {
00464                         <span class="comment">// if not ask file to write or append</span>
00465 
00466                         BOOL retValue;
00467                         <span class="keywordtype">char</span> writeLogFile[MAX_PATH];
00468                         writeLogFile[0] = <span class="charliteral">'\0'</span>; {
00469                             <a class="code" href="classMouseDispCount.html">MouseDispCount</a> mouseDispCount;        <span class="comment">// redisplay windows cursor</span>
00470 
00471                             <span class="comment">// ask filename now</span>
00472                             OPENFILENAME openFileName;
00473                             memset( &amp;openFileName, 0, <span class="keyword">sizeof</span>(openFileName) );
00474                             openFileName.lStructSize = <span class="keyword">sizeof</span>(openFileName);
00475                             openFileName.hwndOwner = <a class="code" href="classSys.html#m0">main_hwnd</a>;
00476                             openFileName.hInstance = <a class="code" href="classSys.html#m1">app_hinstance</a>;
00477                             <span class="comment">// two '\0' at the end</span>
00478                             openFileName.lpstrFilter = <span class="stringliteral">"Log file(*.log)\0*.log\0All Files(*.*)\0*.*\0"</span>;
00479                             openFileName.lpstrCustomFilter = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00480                             openFileName.nMaxCustFilter = 0;
00481                             openFileName.nFilterIndex = 0;
00482                             openFileName.lpstrFile =  writeLogFile;
00483                             openFileName.nMaxFile = <span class="keyword">sizeof</span>(writeLogFile);
00484                             openFileName.lpstrFileTitle = <a class="code" href="OHELP_8H.html#a0">NULL</a>;   <span class="comment">// result filename, without path</span>
00485                             openFileName.nMaxFileTitle = 0;
00486                             openFileName.lpstrInitialDir = <span class="stringliteral">"."</span>;   <span class="comment">// current directory</span>
00487                             openFileName.lpstrTitle = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00488                             <span class="comment">// no OFN_OVERWRITEPROMPT, append</span>
00489                             openFileName.Flags = OFN_LONGNAMES | OFN_PATHMUSTEXIST | OFN_HIDEREADONLY;
00490                             openFileName.nFileOffset = 0;
00491                             openFileName.nFileExtension = 0;
00492                             openFileName.lpstrDefExt = <span class="stringliteral">"log"</span>;
00493                             openFileName.lCustData = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00494                             openFileName.lpfnHook = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00495                             openFileName.lpTemplateName = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00496 
00497                             retValue = GetSaveFileName(&amp;openFileName);
00498                         }                                       <span class="comment">// call mouseDispCount destructor</span>
00499 
00500                         <span class="keywordflow">if</span>( retValue &amp;&amp; writeLogFile[0] ) {
00501                             <span class="keywordflow">if</span>( !m.is_file_exist(writeLogFile) )
00502                                 <span class="comment">// overwrite old log file</span>
00503                                 game_file.create_game_log(writeLogFile);
00504 
00505                             game_file.append_game_log(writeLogFile);
00506                         }
00507                     }
00508                 }
00509 <span class="preprocessor">#endif</span>
00510 <span class="preprocessor"></span>
00511                 current_option=<a class="code" href="Ogameopt_8cpp.html#a46a36">NONE</a>;
00512                 <span class="keywordflow">return</span> 1;
00513             }
00514 
00515         <span class="keywordflow">for</span>(i=0;i&lt;2;i++) {
00516             <span class="keywordflow">if</span>(help_button[i].<a class="code" href="classButton.html#a21">detect</a>()) {
00517                 config.context_sensitive_help=1-i;
00518                 help_button[i].<a class="code" href="classButton.html#a24">push</a>();
00519                 help_button[1-i].<a class="code" href="classButton.html#a25">pop</a>();
00520                 <span class="keywordflow">return</span> 1;
00521             }
00522         }
00523 
00524         <span class="keywordflow">for</span>(i=0;i&lt;2;i++) {
00525             <span class="keywordflow">if</span>(ar_button[i].<a class="code" href="classButton.html#a21">detect</a>()) {
00526                 config.disp_year_end_report=1-i;
00527                 ar_button[i].<a class="code" href="classButton.html#a24">push</a>();
00528                 ar_button[1-i].<a class="code" href="classButton.html#a25">pop</a>();
00529                 <span class="keywordflow">return</span> 1;
00530             }
00531         }
00532 
00533 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00534 <span class="preprocessor"></span>        <span class="keywordflow">for</span>(i=0;i&lt;2;i++) {
00535             <span class="keywordflow">if</span>( threshold_event_button[i].<a class="code" href="classButton.html#a21">detect</a>() ) {
00536                 player_school.threshold_event_flag = 1-i;
00537                 threshold_event_button[i].<a class="code" href="classButton.html#a24">push</a>();
00538                 threshold_event_button[1-i].<a class="code" href="classButton.html#a25">pop</a>();
00539                 <span class="keywordflow">return</span> 1;
00540             }
00541         }
00542         <span class="keywordflow">for</span>(i=0;i&lt;2;i++) {
00543             <span class="keywordflow">if</span>( building_label_button[i].<a class="code" href="classButton.html#a21">detect</a>() ) {
00544                 config.disp_building_label = 1-i;
00545                 building_label_button[i].<a class="code" href="classButton.html#a24">push</a>();
00546                 building_label_button[1-i].<a class="code" href="classButton.html#a25">pop</a>();
00547                 <span class="keywordflow">return</span> 1;
00548             }
00549         }
00550 <span class="preprocessor">#endif</span>
00551 <span class="preprocessor"></span>
00552         <span class="keywordflow">for</span>(i=0;i&lt;2;i++)
00553             <span class="keywordflow">if</span>(music_button[i].<a class="code" href="classButton.html#a21">detect</a>()) {
00554                 config.cd_music_volume=1-i;
00555 
00556                 <span class="keywordflow">if</span>( config.cd_music_volume ) {
00557                     <span class="keywordflow">if</span>( music.is_playing() ) {
00558                         music.change_volume(config.cd_music_volume);
00559                     }
00560                 }
00561                 <span class="keywordflow">else</span>
00562                     music.stop();
00563 
00564                 music_button[i].<a class="code" href="classButton.html#a24">push</a>();
00565                 music_button[1-i].<a class="code" href="classButton.html#a25">pop</a>();
00566                 <span class="keywordflow">return</span> 1;
00567             }
00568         vga.use_back();
00569     }
00570 
00571     <span class="keywordflow">if</span>( current_screen_type==<a class="code" href="Ogameopt_8cpp.html#a47a40">SCR_LOAD_GAME</a>) {
00572         vga.use_front();
00573 
00574         <span class="comment">//---- detect load button --------//</span>
00575 
00576         <span class="keywordflow">if</span> ( load_button.<a class="code" href="classButton.html#a21">detect</a>() ) {
00577             <span class="keywordflow">if</span> ( game_file_array.size()&gt;=game_browser.<a class="code" href="classVBrowse98.html#a6">recno</a>() &amp;&amp; game_browser.<a class="code" href="classVBrowse98.html#a6">recno</a>()&gt;0) {
00578                 load_game_now(game_browser.<a class="code" href="classVBrowse98.html#a6">recno</a>());
00579                 <span class="keywordflow">return</span> 1;
00580             }
00581         }
00582 
00583         <span class="keywordflow">if</span> ( delete_button.<a class="code" href="classButton.html#a21">detect</a>() ) {
00584             <span class="keywordflow">if</span>(game_browser.<a class="code" href="classVBrowse98.html#a6">recno</a>()&gt;0) {
00585                 <span class="comment">//##  BUGHERE fred 1112 ##/</span>
00586                 game_file_array.del_game(game_browser.<a class="code" href="classVBrowse98.html#a6">recno</a>());
00587                 browser_rec_size=game_file_array.size();
00588                 sys.redraw_all_flag=1;
00589             }
00590         }
00591 
00592         <span class="keywordflow">if</span>(cancel_button.<a class="code" href="classButton.html#a21">detect</a>()) {
00593             sys.redraw_all_flag=1;
00594             current_screen_type=<a class="code" href="Ogameopt_8cpp.html#a47a38">SCR_TOP</a>;
00595             <span class="keywordflow">return</span> 1;
00596         }
00597 
00598 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00599 <span class="preprocessor"></span>        <span class="keywordflow">if</span>( browse_button.<a class="code" href="classButton.html#a21">detect</a>() ) {
00600             <span class="keywordtype">char</span> loadFileName[MAX_PATH] = <span class="stringliteral">""</span>;
00601             BOOL retValue = FALSE; {
00602                 <a class="code" href="classMouseDispCount.html">MouseDispCount</a> mouseDispCount;            <span class="comment">// redisplay windows cursor</span>
00603 
00604                 <span class="comment">// ask filename now</span>
00605                 OPENFILENAME openFileName;
00606                 memset( &amp;openFileName, 0, <span class="keyword">sizeof</span>(openFileName) );
00607                 openFileName.lStructSize = <span class="keyword">sizeof</span>(openFileName);
00608                 openFileName.hwndOwner = sys.main_hwnd;
00609                 openFileName.hInstance = sys.app_hinstance;
00610                 <span class="comment">// 2 '\0' at the end</span>
00611                 openFileName.lpstrFilter = <span class="stringliteral">"All Files(*.*)\0*.*\0"</span>;
00612                 openFileName.lpstrCustomFilter = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00613                 openFileName.nMaxCustFilter = 0;
00614                 openFileName.nFilterIndex = 0;
00615                 openFileName.lpstrFile =  loadFileName;   <span class="comment">// first char is already NULL</span>
00616                 openFileName.nMaxFile = <span class="keyword">sizeof</span>(loadFileName);
00617                 openFileName.lpstrFileTitle = <a class="code" href="OHELP_8H.html#a0">NULL</a>;       <span class="comment">// result filename, without path</span>
00618                 openFileName.nMaxFileTitle = 0;
00619                 openFileName.lpstrInitialDir = <span class="stringliteral">"."</span>;       <span class="comment">// current directory</span>
00620                 openFileName.lpstrTitle = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00621                 openFileName.Flags = OFN_LONGNAMES | OFN_PATHMUSTEXIST | OFN_FILEMUSTEXIST | OFN_HIDEREADONLY;
00622                 openFileName.nFileOffset = 0;
00623                 openFileName.nFileExtension = 0;
00624                 openFileName.lpstrDefExt = <span class="stringliteral">"001"</span>;
00625                 openFileName.lCustData = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00626                 openFileName.lpfnHook = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00627                 openFileName.lpTemplateName = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00628 
00629                 retValue = GetOpenFileName(&amp;openFileName);
00630             }                                           <span class="comment">// call mouseDispCount destructor</span>
00631 
00632             <span class="keywordflow">if</span>( retValue ) {
00633                 game_file.load_game(loadFileName);
00634                 load_game_now(0);                         <span class="comment">// game already loaded, don't load again</span>
00635                 <span class="keywordflow">return</span> 1;
00636             }
00637         }
00638 <span class="preprocessor">#endif</span>
00639 <span class="preprocessor"></span>
00640         vga.use_back();
00641 
00642         <span class="keywordflow">if</span>(<span class="keywordtype">int</span> rc=game_browser.<a class="code" href="classVBrowse98.html#a8">detect</a>()) {
00643             game_browser.<a class="code" href="classVBrowse98.html#a10">refresh</a>(rc);
00644             <span class="keywordflow">if</span>(game_browser.<a class="code" href="classVBrowse98.html#m1">double_click</a>) {
00645                 <span class="keywordflow">if</span> (game_file_array.size()&gt;=rc &amp;&amp; rc&gt;0) {
00646                     load_game_now(rc);
00647                     <span class="keywordflow">return</span> 1;
00648                 }
00649             }
00650         }
00651     }
00652 
00653     <span class="keywordflow">if</span>( current_screen_type==<a class="code" href="Ogameopt_8cpp.html#a47a39">SCR_SAVE_GAME</a>) {
00654         vga.use_front();
00655 
00656         <span class="keywordflow">if</span>( game_name.<a class="code" href="classGetA.html#a6">detect</a>()==<a class="code" href="KEY_8H.html#a3">KEY_RETURN</a> || save_button.<a class="code" href="classButton.html#a21">detect</a>() ) {
00657             <a class="code" href="classString.html">String</a> str = game_name_str;
00658 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00659 <span class="preprocessor"></span>            <span class="keywordflow">if</span>( strchr( str, <span class="charliteral">'.'</span> ) == <a class="code" href="OHELP_8H.html#a0">NULL</a> )            <span class="comment">// if overwriting auto save, don't append .sav</span>
00660 <span class="preprocessor">#endif</span>
00661 <span class="preprocessor"></span>                str+=<span class="stringliteral">".sav"</span>;
00662 
00663             game_file_array.save_new_game(str);
00664             browser_rec_size=game_file_array.size();
00665             <span class="comment">//                  game_browser.refresh();</span>
00666             <span class="comment">//                  redraw_scr_save_browser=1;</span>
00667             sys.redraw_all_flag=1;
00668             current_screen_type=<a class="code" href="Ogameopt_8cpp.html#a47a38">SCR_TOP</a>;
00669 
00670             <a class="code" href="classSys.html#m39">menu_pull_down</a> = 0;
00671             <a class="code" href="classSys.html#a15">set_staying_view_mode</a>(0);
00672             sys.redraw_all_flag=1;
00673             <span class="comment">//## fred 0213</span>
00674             <span class="keywordflow">if</span> ( config.cd_music_volume &lt;=0 )
00675                 music.stop();
00676             <span class="keywordflow">return</span> 1;
00677         }
00678 
00679         <span class="keywordflow">if</span> ( delete_button.<a class="code" href="classButton.html#a21">detect</a>() ) {
00680             <span class="keywordflow">if</span>(game_browser.<a class="code" href="classVBrowse98.html#a6">recno</a>()&gt;0) {
00681                 <span class="comment">//## BUGHERE fred 1112 ##/</span>
00682                 game_file_array.del_game(game_browser.<a class="code" href="classVBrowse98.html#a6">recno</a>());
00683                 browser_rec_size=game_file_array.size();
00684                 sys.redraw_all_flag=1;
00685             }
00686         }
00687 
00688         <span class="keywordflow">if</span>(cancel_button.<a class="code" href="classButton.html#a21">detect</a>()) {
00689             sys.redraw_all_flag=1;
00690             current_screen_type=<a class="code" href="Ogameopt_8cpp.html#a47a38">SCR_TOP</a>;
00691             <span class="keywordflow">return</span> 1;
00692         }
00693         vga.use_back();
00694 
00695         <span class="keywordflow">if</span>(<span class="keywordtype">int</span> rc=game_browser.<a class="code" href="classVBrowse98.html#a8">detect</a>()) {
00696             game_browser.<a class="code" href="classVBrowse98.html#a10">refresh</a>(rc);
00697             <span class="comment">//                  if(game_browser.double_click)</span>
00698             <span class="comment">//                  {</span>
00699             game_name_str=game_file_array[rc]-&gt;get_save_name();
00700             game_name.<a class="code" href="classGetA.html#a13">select_whole</a>();
00701             game_browser.<a class="code" href="classVBrowse98.html#a10">refresh</a>();
00702             <span class="comment">//                  }</span>
00703         }
00704 
00705     }
00706 
00707     <span class="keywordflow">return</span> 0;
00708 }
00709 
00710 <span class="comment">//-------- Start of function Sys::load_game_now --------//</span>
00711 
00712 <span class="keywordtype">void</span> Sys::load_game_now(<span class="keywordtype">int</span> gameBrowseRecno) {
00713 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00714 <span class="preprocessor"></span>    <span class="keywordflow">if</span>( gameBrowseRecno )                           <span class="comment">// now gameBrowseRecno can be zero</span>
00715 <span class="preprocessor">#endif</span>
00716 <span class="preprocessor"></span>        game_file_array[gameBrowseRecno]-&gt;load_game();
00717 
00718     <a class="code" href="classSys.html#a15">set_staying_view_mode</a>(0);
00719     <a class="code" href="classSys.html#m14">view_mode</a>=<a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>;
00720     <a class="code" href="classSys.html#m13">prev_view_mode</a> = <a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>;
00721     <a class="code" href="classSys.html#m15">back_view_mode</a> = <a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>;
00722     <a class="code" href="classSys.html#m19">is_institution_report</a>=0;
00723     <a class="code" href="classSys.html#m39">menu_pull_down</a>=0;
00724     <a class="code" href="classSys.html#m8">redraw_all_flag</a> = 1;
00725     <a class="code" href="classSys.html#m9">redraw_zoom_flag</a> = 0;
00726     <a class="code" href="classSys.html#a13">set_speed</a>(<a class="code" href="classSys.html#m40">save_speed</a>);
00727     <a class="code" href="classSys.html#m42">m_o_log_selected</a>=0;
00728     <a class="code" href="classSys.html#m43">m_o_log_highlighted</a>=-1;
00729     <a class="code" href="classSys.html#m44">m_o_log_old_selected</a>=-2;
00730     <a class="code" href="classSys.html#m45">m_o_log_old_highlighted</a>=-2;
00731     <a class="code" href="classSys.html#m46">m_o_log_display_updated</a>=1;
00732     config.scroll_speed=10;
00733     current_screen_type=<a class="code" href="Ogameopt_8cpp.html#a47a38">SCR_TOP</a>;
00734     <a class="code" href="classSys.html#m8">redraw_all_flag</a>=1;
00735 }
00736 
00737 <span class="comment">//-------- End of function Sys::load_game_now --------//</span>
00738 
<a name="l00739"></a><a class="code" href="Ogameopt_8cpp.html#a43">00739</a> <span class="keywordtype">void</span> <a class="code" href="Ogameopt_8cpp.html#a43">free_button_memory</a>(<span class="keywordtype">void</span>) {
00740     <span class="comment">/*   for(int i=0;i&lt;6;i++)</span>
00741 <span class="comment">         {</span>
00742 <span class="comment">         if(go_button_up_bitmap[i])</span>
00743 <span class="comment">         {</span>
00744 <span class="comment">         mem_del(go_button_up_bitmap[i]);</span>
00745 <span class="comment">         go_button_up_bitmap[i]=NULL;</span>
00746 <span class="comment">         }</span>
00747 <span class="comment">         if(go_button_down_bitmap[i])</span>
00748 <span class="comment">         {      mem_del(go_button_down_bitmap[i]);</span>
00749 <span class="comment">         go_button_down_bitmap[i]=NULL;</span>
00750 <span class="comment">         }</span>
00751 <span class="comment">         }</span>
00752 <span class="comment">         for(i=0;i&lt;2;i++)</span>
00753 <span class="comment">         {</span>
00754 <span class="comment">         if(ar_button_up_bitmap[i])</span>
00755 <span class="comment">         {</span>
00756 <span class="comment">         mem_del(ar_button_up_bitmap[i]);</span>
00757 <span class="comment">         ar_button_up_bitmap[i]=NULL;</span>
00758 <span class="comment">         }</span>
00759 <span class="comment">         if(ar_button_down_bitmap[i])</span>
00760 <span class="comment">         {</span>
00761 <span class="comment">         mem_del(ar_button_down_bitmap[i]);</span>
00762 <span class="comment">         ar_button_down_bitmap[i]=NULL;</span>
00763 <span class="comment">         }</span>
00764 <span class="comment">         }</span>
00765 <span class="comment">    */</span>
00766     <span class="comment">// #### begin Gilbert 02/05/2001 ####//</span>
00767     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="Ogameopt_8cpp.html#a46a37">GO_BUTTON_COUNT</a>; ++i ) {
00768         go_button[i].<a class="code" href="classButton.html#a2">deinit</a>();
00769     }
00770     music_button[0].<a class="code" href="classButton.html#a2">deinit</a>();
00771     music_button[1].<a class="code" href="classButton.html#a2">deinit</a>();
00772     help_button[0].<a class="code" href="classButton.html#a2">deinit</a>();
00773     help_button[1].<a class="code" href="classButton.html#a2">deinit</a>();
00774     ar_button[0].<a class="code" href="classButton.html#a2">deinit</a>();
00775     ar_button[1].<a class="code" href="classButton.html#a2">deinit</a>();
00776 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00777 <span class="preprocessor"></span>    threshold_event_button[0].<a class="code" href="classButton.html#a2">deinit</a>();
00778     threshold_event_button[1].<a class="code" href="classButton.html#a2">deinit</a>();
00779     building_label_button[0].<a class="code" href="classButton.html#a2">deinit</a>();
00780     building_label_button[1].<a class="code" href="classButton.html#a2">deinit</a>();
00781 <span class="preprocessor">#endif</span>
00782 <span class="preprocessor"></span>    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;3;j+=2) {
00783         vslider[j].<a class="code" href="classValueSlider.html#a5">deinit</a>();
00784     }
00785     <span class="comment">// #### end Gilbert 02/05/2001 ####//</span>
00786 }
00787 
<a name="l00788"></a><a class="code" href="classSys.html#a26">00788</a> <span class="keywordtype">void</span> <a class="code" href="classSys.html#a26">Sys::setting_report_deinit</a>(<span class="keywordtype">void</span>) {
00789 
00790     <span class="comment">// set speed</span>
00791     sys.set_speed((*vslider[2].var_ptr)*990/100);
00792     <a class="code" href="Ogameopt_8cpp.html#a43">free_button_memory</a>();
00793     <span class="comment">// #### begin Gilbert 02/05/2001 ####//</span>
00794     save_button.<a class="code" href="classButton.html#a2">deinit</a>();
00795     load_button.<a class="code" href="classButton.html#a2">deinit</a>();
00796     delete_button.<a class="code" href="classButton.html#a2">deinit</a>();
00797     cancel_button.<a class="code" href="classButton.html#a2">deinit</a>();
00798 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00799 <span class="preprocessor"></span>    browse_button.<a class="code" href="classButton.html#a2">deinit</a>();
00800 <span class="preprocessor">#endif</span>
00801 <span class="preprocessor"></span>    game_browser.<a class="code" href="classVBrowse98.html#a3">deinit</a>();
00802     <span class="comment">// game_name.deinit();</span>
00803     <span class="comment">// #### end Gilbert 02/05/2001 ####//</span>
00804 
00805     <span class="keywordflow">if</span>(background_bitmap) {
00806         <a class="code" href="ALL_8H.html#a8">mem_del</a>(background_bitmap);
00807         background_bitmap=<a class="code" href="OHELP_8H.html#a0">NULL</a>;
00808     }
00809     current_screen_type=<a class="code" href="Ogameopt_8cpp.html#a47a38">SCR_TOP</a>;
00810 };
00811 
00812 <span class="keyword">static</span> <span class="keywordtype">void</span> disp_load_game_rec(<span class="keywordtype">int</span> recNo, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> refreshFlag) {
00813     <span class="keywordflow">if</span>((recNo&gt;0)&amp;&amp;(recNo&lt;=game_file_array.size())) {
00814 
00815         <a class="code" href="classGameFile.html">GameFile</a>* gfPtr = game_file_array[recNo];
00816         <span class="keywordtype">char</span>* name = gfPtr-&gt;<a class="code" href="classGameFile.html#a0">get_save_name</a>();
00817         font_chartsm.put(x,y,name);
00818     }
00819 };
00820 
00821 <span class="keyword">static</span> <span class="keywordtype">void</span> disp_save_game_rec(<span class="keywordtype">int</span> recNo, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> refreshFlag) {
00822     <span class="keywordflow">if</span>((recNo&gt;0)&amp;&amp;(recNo&lt;=game_file_array.size())) {
00823 
00824         <a class="code" href="classGameFile.html">GameFile</a>* gfPtr = game_file_array[recNo];
00825         <span class="keywordtype">char</span>* name = gfPtr-&gt;<a class="code" href="classGameFile.html#a0">get_save_name</a>();
00826         font_chartsm.put(x,y,name);
00827     }
00828 };
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:43 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
