<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Odepta.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Odepta.cpp</h1><a href="Odepta_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : ODEPTA.CPP</span>
00002 <span class="comment">//Description : Department resource object</span>
00003 
00004 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00005 <span class="preprocessor">#include &lt;OMATH.H&gt;</span>
00006 <span class="preprocessor">#include &lt;<a class="code" href="OGAME_8H.html">OGAME.H</a>&gt;</span>
00007 <span class="preprocessor">#include &lt;<a class="code" href="OGAMESET_8H.html">OGAMESET.H</a>&gt;</span>
00008 <span class="preprocessor">#include &lt;<a class="code" href="ODEPTRES_8H.html">ODEPTRES.H</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;ODEPT.H&gt;</span>
00010 <span class="preprocessor">#include &lt;OPSCHOOL.H&gt;</span>
00011 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>
00012 <span class="preprocessor">#include &lt;OFINANCE.H&gt;</span>
00013 <span class="preprocessor">#include &lt;<a class="code" href="OSCHLRES_8H.html">OSCHLRES.H</a>&gt;</span>                             <span class="comment">//## fred 0919</span>
00014 <span class="preprocessor">#include &lt;OFACILIT.H&gt;</span>
00015 
00016 <span class="comment">//--------- Begin of function DepartmentArray::DepartmentArray ----------//</span>
<a name="l00018"></a><a class="code" href="classDepartmentArray.html#a0">00018</a> <span class="comment">DepartmentArray::DepartmentArray() : DynArrayB(sizeof(Department*), 20, DEFAULT_REUSE_INTERVAL_DAYS) {</span>
00019 }
00020 
00021 <span class="comment">//---------- End of function DepartmentArray::DepartmentArray ----------//</span>
00022 
00023 <span class="comment">//--------- Begin of function DepartmentArray::~DepartmentArray ----------//</span>
<a name="l00025"></a><a class="code" href="classDepartmentArray.html#a1">00025</a> <span class="comment">DepartmentArray::~DepartmentArray() {</span>
00026     deinit();
00027 }
00028 
00029 <span class="comment">//---------- End of function DepartmentArray::~DepartmentArray ----------//</span>
00030 
00031 <span class="comment">//--------- Begin of function DepartmentArray::init ----------//</span>
<a name="l00033"></a><a class="code" href="classDepartmentArray.html#a2">00033</a> <span class="comment">void DepartmentArray::init() {</span>
00034     deinit();
00035     <span class="comment">//## 200799</span>
00036     memset( (<span class="keywordtype">char</span> *)<span class="keyword">this</span> + <span class="keyword">sizeof</span>(<a class="code" href="classDynArrayB.html">DynArrayB</a>), 0, <span class="keyword">sizeof</span>(<a class="code" href="classDepartmentArray.html">DepartmentArray</a>)-<span class="keyword">sizeof</span>(<a class="code" href="classDynArrayB.html">DynArrayB</a>) );
00037 
00038     <span class="keyword">enum</span> {
00039         <a class="code" href="Odept__if_8cpp.html#a139a89">MODE_DEPT_MAIN</a> = 0,
00040         <a class="code" href="Odept__if_8cpp.html#a139a90">MODE_DEPT_EDUCATIONAL_QUALITY</a>=1,
00041         <a class="code" href="Odept__if_8cpp.html#a139a91">MODE_DEPT_DEPARTMENTAL_ACADEMIC_STANDING</a>=2,
00042         <a class="code" href="Odept__if_8cpp.html#a139a92">MODE_DEPT_STUDENT_MORALE</a>=3,
00043         <a class="code" href="Odept__if_8cpp.html#a139a93">MODE_DEPT_FACULTY_RESEARCH_PERFORMANCE</a>=4,
00044         <a class="code" href="Odept__if_8cpp.html#a139a94">MODE_DEPT_FACULTY_MORALE</a>=5,
00045         <a class="code" href="Odept__if_8cpp.html#a139a95">MODE_DEPT_FACULTY_DIVERSITY_INDEX</a>=6,
00046         <a class="code" href="Odept__if_8cpp.html#a139a96">MODE_DEPT_EDUCATIONAL_QUALITY2</a>=7,
00047         <a class="code" href="Odept__if_8cpp.html#a139a97">MODE_DEPT_RANK</a>=8,
00048     };
00049 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00050 <span class="preprocessor"></span>    <span class="keyword">enum</span> {
00051         <a class="code" href="Ocour__if_8cpp.html#a62a43">REPORT_TYPE_DEPARTMENT_OVERVIEW</a>, <a class="code" href="Ocour__if_8cpp.html#a62a44">REPORT_TYPE_DEPARTMENT_CLASSTYPES</a>, REPORT_TYPE_DEPARTMENT_TECHNOLOGY,
00052         <a class="code" href="Ocour__if_8cpp.html#a62a45">REPORT_TYPE_INSTITUTION_OVERVIEW</a>, <a class="code" href="Ocour__if_8cpp.html#a62a46">REPORT_TYPE_INSTITUTION_SUMMERTEACHING</a>, REPORT_TYPE_INSTITUTION_TECHNOLOGY,
00053     };
00054 <span class="preprocessor">#else</span>
00055 <span class="preprocessor"></span>    <span class="keyword">enum</span> {
00056         <a class="code" href="Ocour__if_8cpp.html#a62a43">REPORT_TYPE_DEPARTMENT_OVERVIEW</a>, <a class="code" href="Ocour__if_8cpp.html#a62a44">REPORT_TYPE_DEPARTMENT_CLASSTYPES</a>,
00057         <a class="code" href="Ocour__if_8cpp.html#a62a45">REPORT_TYPE_INSTITUTION_OVERVIEW</a>, <a class="code" href="Ocour__if_8cpp.html#a62a46">REPORT_TYPE_INSTITUTION_SUMMERTEACHING</a>,
00058     };
00059 <span class="preprocessor">#endif</span>
00060 <span class="preprocessor"></span>
00061     <span class="keyword">enum</span> {
00062         <a class="code" href="Odept__if_8cpp.html#a138a86">MODE_INSTITUTION</a>  = 0,
00063         <a class="code" href="Odept__if_8cpp.html#a138a87">MODE_DEPARTMENT</a> = 1,
00064         MODE_RANK     = 2,
00065     };
00066 
00067     current_report_type=<a class="code" href="Ocour__if_8cpp.html#a62a45">REPORT_TYPE_INSTITUTION_OVERVIEW</a>;
00068     current_screen_mode = <a class="code" href="Odept__if_8cpp.html#a139a89">MODE_DEPT_MAIN</a>;
00069     current_pref_report_type=<a class="code" href="Odept__if_8cpp.html#a139a90">MODE_DEPT_EDUCATIONAL_QUALITY</a>;
00070     current_data_mode = <a class="code" href="Odept__if_8cpp.html#a138a86">MODE_INSTITUTION</a>;
00071 
00072     department_count = 0;
00073 
00074     selected_recno = 0;
00075 
00076     weight_teaching = 40;                           <span class="comment">// = [0,100]</span>
00077     weight_scholarship = 30;
00078     weight_research = 30;
00079 
00080     teaching_weight_input=1;                        <span class="comment">// {Very important = 3; Important = 2; Moderately important = 1; Not at all important = 0}</span>
00081     scholarship_weight_input=1;
00082     research_weight_input=1;
00083     gender_ethnic_equity_weight_input=1;
00084 
00085     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>; i++)
00086         rank_age_group_salary_increase_multiplier[i] = 1.0f;
00087 
00088     faculty_count_on_tenure_line = 0;
00089     faculty_count_tenured = 0;
00090 
00091 }
00092 
00093 <span class="comment">//---------- End of function DepartmentArray::init ----------//</span>
00094 
00095 <span class="comment">//--------- Begin of function DepartmentArray::deinit ----------//</span>
<a name="l00097"></a><a class="code" href="classDepartmentArray.html#a3">00097</a> <span class="comment">void DepartmentArray::deinit() {</span>
00098     <span class="keywordflow">if</span>( size()==0 )
00099         <span class="keywordflow">return</span>;
00100 
00101     <span class="comment">//----------------------------------//</span>
00102 
00103     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=size() ; i&gt;0 ; i-- ) {
00104         <span class="keywordflow">if</span>( !is_deleted(i) )
00105             del(i);
00106     }
00107 
00108     <span class="comment">//----------------------------------//</span>
00109 
00110     zap();                                          <span class="comment">// zap the DynArrayB</span>
00111 }
00112 
00113 <span class="comment">//---------- End of function DepartmentArray::deinit ----------//</span>
00114 
00115 <span class="comment">//### fred 980921 ###//</span>
00116 <span class="comment">//--------- Begin of function DepartmentArray::init_data ----------//</span>
<a name="l00117"></a><a class="code" href="classDepartmentArray.html#a4">00117</a> <span class="keywordtype">void</span> <a class="code" href="classDepartmentArray.html#a4">DepartmentArray::init_data</a>() {
00118     <span class="keywordtype">int</span> i,j;
00119     memset(<a class="code" href="classDepartmentArray.html#m42">average_research_dollars</a>,0,<span class="keyword">sizeof</span>(<a class="code" href="classDepartmentArray.html#m42">average_research_dollars</a>));
00120 
00121     <span class="comment">// it's better to use db_school_array but not school_ex_array;</span>
00122     <span class="comment">// but it requires relocation of SchoolEx's active_research_dollars to School's active_research_dollars</span>
00123 
00124     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="OSCHLRES_8H.html#a0">MAX_SCHOOL_EX_FOR_INIT_CONDITION</a>; i++) {
00125         <a class="code" href="classSchoolEx.html">SchoolEx</a>  *schPtr = &amp;school_res.school_ex_array[i];
00126 
00127         <span class="keywordflow">for</span> (j=0; j&lt;<a class="code" href="Ofaculty_8h.html#a26a8">FACULTY_RANK_LEVEL_COUNT</a>; j++)
00128             <a class="code" href="classDepartmentArray.html#m42">average_research_dollars</a>[j] += schPtr-&gt;<a class="code" href="classSchoolEx.html#m50">school_faculty_array_ex</a>[j].<a class="code" href="classSchoolFacultyEx.html#m0">active_research_dollars</a>;
00129     }
00130 
00131     <span class="keywordflow">for</span> (j=0; j&lt;<a class="code" href="Ofaculty_8h.html#a26a8">FACULTY_RANK_LEVEL_COUNT</a>; j++)
00132         <span class="comment">// var for calc research norm</span>
00133         <a class="code" href="classDepartmentArray.html#m42">average_research_dollars</a>[j] /= <a class="code" href="OSCHLRES_8H.html#a0">MAX_SCHOOL_EX_FOR_INIT_CONDITION</a>;
00134 }
00135 
00136 <span class="comment">//---------- End of function DepartmentArray::init_data ----------//</span>
00137 <span class="comment">//### fred 980921 ###//</span>
00138 
00139 <span class="comment">//--------- Begin of function DepartmentArray::add ---------//</span>
<a name="l00140"></a><a class="code" href="classDepartmentArray.html#a7">00140</a> <span class="keywordtype">int</span> <a class="code" href="classDepartmentArray.html#a7">DepartmentArray::add</a>(<span class="keywordtype">int</span> departmentId) {
00141     <a class="code" href="classDepartment.html">Department</a>* newDept = <span class="keyword">new</span> <a class="code" href="classDepartment.html">Department</a>;
00142 
00143     <a class="code" href="classDynArrayB.html#a4">linkin</a>(&amp;newDept);
00144 
00145     ((Department*)<a class="code" href="classDynArray.html#a15">get_ptr</a>())-&gt;department_recno = <a class="code" href="classDynArray.html#a27">recno</a>();
00146 
00147     <a class="code" href="classDepartmentArray.html#m0">department_count</a>++;
00148 
00149     <a class="code" href="ALL_8H.html#a0">err_when</a>( <a class="code" href="classDepartmentArray.html#m0">department_count</a> &gt; <a class="code" href="Gamedef_8h.html#a10">MAX_DEPARTMENT</a> );
00150 
00151     <span class="keywordtype">int</span> recNo = <a class="code" href="classDynArray.html#a27">recno</a>();
00152 
00153     <span class="comment">//----------------------------------//</span>
00154 
00155     newDept-&gt;<a class="code" href="classDepartment.html#a0">init</a>(departmentId);
00156 
00157     <span class="keywordflow">if</span>(<a class="code" href="classDepartmentArray.html#m1">selected_recno</a>==0)
00158         <a class="code" href="classDepartmentArray.html#m1">selected_recno</a> = recNo;
00159 
00160     <span class="comment">//---- update total_elective_course_pref ------//</span>
00161 
00162     <span class="comment">//department_res.calc_total_elective_course_pref();</span>
00163 
00164     <span class="keywordflow">return</span> recNo;
00165 }
00166 
00167 <span class="comment">//----------- End of function DepartmentArray::add -----------//</span>
00168 
00169 <span class="comment">//--------- Begin of function DepartmentArray::create_dept ---------//</span>
<a name="l00174"></a><a class="code" href="classDepartmentArray.html#a9">00174</a> <span class="comment">int DepartmentArray::create_dept() {</span>
00175     <a class="code" href="classDepartment.html">Department</a> *deptPtr = <span class="keyword">new</span> <a class="code" href="classDepartment.html">Department</a>;
00176 
00177     linkin(&amp;deptPtr);
00178 
00179     <a class="code" href="ALL_8H.html#a0">err_when</a>( size() &gt; <a class="code" href="Gamedef_8h.html#a10">MAX_DEPARTMENT</a> );
00180 
00181     deptPtr-&gt;<a class="code" href="classDepartment.html#m3">department_recno</a> = recno();
00182 
00183     <span class="keywordflow">return</span> recno();
00184 }
00185 
00186 <span class="comment">//----------- End of function DepartmentArray::create_dept ---------//</span>
00187 
00188 <span class="comment">//--------- Begin of function DepartmentArray::del ---------//</span>
00189 
<a name="l00190"></a><a class="code" href="classDepartmentArray.html#a8">00190</a> <span class="keywordtype">void</span> <a class="code" href="classDepartmentArray.html#a8">DepartmentArray::del</a>(<span class="keywordtype">int</span> recNo) {
00191     Department* deptPtr = department_array[recNo];
00192 
00193     <span class="keyword">delete</span> deptPtr;
00194 
00195     <a class="code" href="classDynArrayB.html#a5">linkout</a>(recNo);
00196 
00197     <a class="code" href="classDepartmentArray.html#m0">department_count</a>--;
00198 
00199     <span class="comment">//--------------------------------//</span>
00200     <span class="keywordflow">if</span>( recNo == <a class="code" href="classDepartmentArray.html#m1">selected_recno</a> ) {
00201         <span class="comment">//---- set the selected recno to first existing department in the array ---//</span>
00202 
00203         <a class="code" href="classDepartmentArray.html#m1">selected_recno</a> = 0;
00204 
00205         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=1 ; i&lt;=<a class="code" href="classDynArray.html#a28">size</a>() ; i++ ) {
00206             <span class="keywordflow">if</span>( !<a class="code" href="classDepartmentArray.html#a11">is_deleted</a>(i) ) {
00207                 <a class="code" href="classDepartmentArray.html#m1">selected_recno</a> = i;
00208                 <span class="keywordflow">break</span>;
00209             }
00210         }
00211     }
00212 
00213     <span class="comment">//---- update total_elective_course_pref ------//</span>
00214 
00215     department_res.calc_total_elective_course_pref();
00216 }
00217 
00218 <span class="comment">//----------- End of function DepartmentArray::del -----------//</span>
00219 
00220 <span class="comment">//--------- Begin of function DepartmentArray::next_day ---------//</span>
00221 
<a name="l00222"></a><a class="code" href="classDepartmentArray.html#a10">00222</a> <span class="keywordtype">void</span> <a class="code" href="classDepartmentArray.html#a10">DepartmentArray::next_day</a>() {
00223     <span class="comment">//----- call individual department's next_day() function ----//</span>
00224 
00225     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=department_array.size() ; i&gt;0 ; i-- ) {
00226         <span class="keywordflow">if</span>( department_array.is_deleted(i) )
00227             <span class="keywordflow">continue</span>;
00228 
00229         department_array[i]-&gt;next_day();
00230     }
00231 
00232     <span class="comment">//##### begin fred 980914 ####//</span>
00233     <span class="comment">// start of a trimester</span>
00234     <span class="keywordflow">if</span> ( info.game_day == player_school.trimester_array[player_school.cur_trimester].start_day
00235          &amp;&amp; info.game_month == player_school.trimester_array[player_school.cur_trimester].start_month ) {
00236         <a class="code" href="classDepartmentArray.html#a18">update_history</a>(UPDATE_TRIMESTER);
00237     }
00238 
00239     <span class="comment">// start of a month</span>
00240     <span class="keywordflow">if</span> ( info.game_day == 1 ) {
00241         <span class="comment">//--- 990421 ---//</span>
00242 
00243         <span class="keywordflow">if</span> ( info.game_month == finance.fiscal_year_start_month )
00244             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="Odept_8h.html#a19a16">RESEARCH_STATUS_COUNT</a>; i++)
00245                 <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(<a class="code" href="classDepartmentArray.html#m44">research_y_history</a>[i], HISTORY_YEAR_COUNT);
00246 
00247         <span class="comment">//-------------//</span>
00248 
00249         <a class="code" href="classDepartmentArray.html#a18">update_history</a>(UPDATE_MONTH);
00250 
00251         <span class="comment">// start of a year</span>
00252         <span class="keywordflow">if</span> ( info.game_month == finance.fiscal_year_start_month ) {
00253 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00254 <span class="preprocessor"></span>            facility_office.begin_space_inventory();
00255 <span class="preprocessor">#endif</span>
00256 <span class="preprocessor"></span>            <a class="code" href="classDepartmentArray.html#a18">update_history</a>(UPDATE_YEAR);                <span class="comment">// pi and statistic calculated here</span>
00257         }
00258     }
00259     <span class="comment">//##### end fred 980914 ####//</span>
00260 }
00261 
00262 <span class="comment">//----------- End of function DepartmentArray::next_day -----------//</span>
00263 
00264 <span class="comment">//--------- Begin of function DepartmentArray::is_deleted ---------//</span>
00265 
<a name="l00266"></a><a class="code" href="classDepartmentArray.html#a11">00266</a> <span class="keywordtype">int</span> <a class="code" href="classDepartmentArray.html#a11">DepartmentArray::is_deleted</a>(<span class="keywordtype">int</span> recNo) {
00267     Department* departmentPtr = (Department*) <a class="code" href="classDynArray.html#a15">get_ptr</a>(recNo);
00268 
00269     <span class="keywordflow">if</span>( departmentPtr == <a class="code" href="OHELP_8H.html#a0">NULL</a> )
00270         <span class="keywordflow">return</span> 1;
00271 
00272     <span class="keywordflow">return</span> departmentPtr-&gt;<a class="code" href="classDepartment.html#m3">department_recno</a> == 0;
00273 }
00274 
00275 <span class="comment">//----------- End of function DepartmentArray::is_deleted -----------//</span>
00276 
00277 <span class="comment">//--------- Begin of function DepartmentArray::has_department ---------//</span>
<a name="l00282"></a><a class="code" href="classDepartmentArray.html#a12">00282</a> <span class="comment">int DepartmentArray::has_department(char* departmentName) {</span>
00283     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=size() ; i&gt;0 ; i-- ) {
00284         <span class="keywordflow">if</span>( is_deleted(i) )
00285             <span class="keywordflow">continue</span>;
00286 
00287         <span class="keywordflow">if</span>( strcmpi( department_res[ <span class="keyword">operator</span>[](i)-&gt;department_id ]-&gt;name, departmentName )==0 )
00288             <span class="keywordflow">return</span> i;
00289     }
00290 
00291     <span class="keywordflow">return</span> 0;
00292 }
00293 
00294 <span class="comment">//----------- End of function DepartmentArray::has_department -----------//</span>
00295 
00296 <span class="comment">//chwg ##1230</span>
00297 <span class="preprocessor">#ifdef DEBUG</span>
00298 <span class="preprocessor"></span>
00299 <span class="comment">//------- Begin of function DepartmentArray::operator[] -----//</span>
00300 
00301 Department* <a class="code" href="classDepartmentArray.html#a13">DepartmentArray::operator[]</a>(<span class="keywordtype">int</span> recNo) {
00302     Department* DepartmentPtr = (Department*) <a class="code" href="classDynArray.html#a15">get_ptr</a>(recNo);
00303 
00304     <span class="keywordflow">if</span>( !DepartmentPtr )
00305         err.run( <span class="stringliteral">"DepartmentArray[] is deleted"</span> );
00306 
00307     <span class="keywordflow">return</span> DepartmentPtr;
00308 }
00309 
00310 <span class="comment">//--------- End of function DepartmentArray::operator[] ----//</span>
00311 <span class="preprocessor">#endif</span>
00312 <span class="preprocessor"></span>
00313 <span class="comment">//------- Begin of function DepartmentArray::calc_course_pref -----//</span>
00314 
<a name="l00315"></a><a class="code" href="classDepartmentArray.html#a16">00315</a> <span class="keywordtype">void</span> <a class="code" href="classDepartmentArray.html#a16">DepartmentArray::calc_course_pref</a>() {
00316     <span class="comment">// 1105 see section req29a_course.txt and design notes 0830 section 6.9</span>
00317 
00318     <span class="keywordtype">int</span> d, i;
00319 
00320     <span class="keywordflow">for</span> ( d=<a class="code" href="classDynArray.html#a28">size</a>(); d&gt;0; d-- ) {
00321         <span class="keywordflow">if</span> ( <a class="code" href="classDepartmentArray.html#a11">is_deleted</a>(d) )
00322             <span class="keywordflow">continue</span>;
00323 
00324         Department* deptPtr = <a class="code" href="classDepartmentArray.html#a13">operator[]</a>(d);
00325 
00326         <a class="code" href="structCourseTemplate.html">CourseTemplate</a>* templ = course_res.get_template(deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m2">department_id</a>);
00327         <span class="keywordtype">float</span> rawPref[<a class="code" href="OCOURRES_8H.html#a8a2">COURSE_PREFERENCE_COUNT</a>] = {0,0,0};
00328         <span class="keywordtype">float</span> sumDev = 0;
00329         <span class="keywordtype">float</span> sumRawPref = 0;
00330         <span class="keyword">const</span> <span class="keywordtype">float</span> lamda = 0.6f;
00331 
00332         <span class="keywordtype">int</span> testsum = 0;
00333 
00334         <span class="keywordflow">for</span> ( i=0; i&lt;<a class="code" href="OCOURRES_8H.html#a8a2">COURSE_PREFERENCE_COUNT</a>; i++ ) {
00335             sumDev += math.safe_pow(<span class="keywordtype">float</span>(deptPtr-&gt;<a class="code" href="classDepartment.html#m14">course_preference_input</a>[i] - templ-&gt;<a class="code" href="structCourseTemplate.html#m1">target_preference</a>[i]), 2);
00336             testsum += deptPtr-&gt;<a class="code" href="classDepartment.html#m14">course_preference_input</a>[i];
00337         }
00338 
00339         <a class="code" href="ALL_8H.html#a0">err_when</a>(testsum &gt; 101 || testsum &lt; 97);
00340 
00341         <span class="keywordflow">if</span> ( sumDev &gt; 0 )
00342             <span class="keywordflow">for</span> ( i=0; i&lt;<a class="code" href="OCOURRES_8H.html#a8a2">COURSE_PREFERENCE_COUNT</a>; i++ ) {
00343                 <span class="keywordtype">float</span> dev = math.safe_pow(<span class="keywordtype">float</span>(deptPtr-&gt;<a class="code" href="classDepartment.html#m14">course_preference_input</a>[i] - templ-&gt;<a class="code" href="structCourseTemplate.html#m1">target_preference</a>[i]), 3);
00344                 rawPref[i] = templ-&gt;<a class="code" href="structCourseTemplate.html#m1">target_preference</a>[i] + dev / sumDev;
00345                 sumRawPref += rawPref[i];
00346             }
00347 
00348         <span class="keywordflow">if</span> ( sumRawPref &gt; 0 ) {
00349             <span class="keywordflow">for</span> ( i=0, sumDev=0; i&lt;<a class="code" href="OCOURRES_8H.html#a8a2">COURSE_PREFERENCE_COUNT</a>; i++ ) {
00350                 rawPref[i] = (char) player_school.latency_func(lamda, rawPref[i] * 100 / sumRawPref, deptPtr-&gt;<a class="code" href="classDepartment.html#m15">course_preference</a>[i]);
00351                 sumDev += rawPref[i];
00352             }
00353 
00354             <span class="keywordflow">if</span> ( sumDev &gt; 0 ) {
00355                 <span class="keywordflow">for</span> ( testsum=0, i=0; i&lt;<a class="code" href="OCOURRES_8H.html#a8a2">COURSE_PREFERENCE_COUNT</a>; i++ ) {
00356                     deptPtr-&gt;<a class="code" href="classDepartment.html#m15">course_preference</a>[i] = char( rawPref[i]*100/sumDev);
00357                     testsum += deptPtr-&gt;<a class="code" href="classDepartment.html#m15">course_preference</a>[i];
00358                 }
00359 
00360                 <a class="code" href="ALL_8H.html#a0">err_when</a>(testsum &gt; 101 || testsum &lt; 97);
00361 
00362                 <span class="comment">// fix type cast precision problem above</span>
00363                 deptPtr-&gt;<a class="code" href="classDepartment.html#m15">course_preference</a>[0] += 100 - testsum;
00364             }
00365         }
00366     }                                               <span class="comment">// end for</span>
00367 }
00368 
00369 <span class="comment">//--------- End of function DepartmentArray::calc_course_pref ----//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:24 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
