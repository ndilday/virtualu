<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>oquadprg.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>oquadprg.cpp</h1><a href="oquadprg_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">// filename    : OQUADPRG.CPP</span>
00002 <span class="comment">// Description : specialized quadratic programming for finance</span>
00003 
00004 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00005 <span class="preprocessor">#include &lt;math.h&gt;</span>
00006 <span class="preprocessor">#include &lt;OQUADPRG.H&gt;</span>
00007 
00008 <span class="comment">// ------ begin of function QuadProgramming::QuadProgramming ------ //</span>
00009 <span class="comment">//</span>
<a name="l00010"></a><a class="code" href="classQuadProgramming.html#a0">00010</a> <a class="code" href="classQuadProgramming.html#a0">QuadProgramming::QuadProgramming</a>() {
00011     memset( <span class="keyword">this</span>, 0, <span class="keyword">sizeof</span>(*<span class="keyword">this</span>) );
00012 }
00013 
00014 <span class="comment">// ------ end of function QuadProgramming::QuadProgramming ------ //</span>
00015 
00016 <span class="comment">// ------ begin of function QuadProgramming::~QuadProgramming ------ //</span>
00017 <span class="comment">//</span>
<a name="l00018"></a><a class="code" href="classQuadProgramming.html#a1">00018</a> <a class="code" href="classQuadProgramming.html#a1">QuadProgramming::~QuadProgramming</a>() {
00019     <a class="code" href="classQuadProgramming.html#m0">vars_count</a> = 0;
00020     <a class="code" href="classQuadProgramming.html#m7">constraint_count</a> = 0;
00021 
00022     <span class="keywordflow">if</span>( test_value ) {
00023         <a class="code" href="ALL_8H.html#a8">mem_del</a>(<a class="code" href="classQuadProgramming.html#m2">test_value</a>);
00024         <a class="code" href="classQuadProgramming.html#m2">test_value</a> = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00025     }
00026 
00027     <span class="keywordflow">if</span>( value_tol ) {
00028         <a class="code" href="ALL_8H.html#a8">mem_del</a>(<a class="code" href="classQuadProgramming.html#m3">value_tol</a>);
00029         <a class="code" href="classQuadProgramming.html#m3">value_tol</a> = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00030     }
00031 
00032     <span class="keywordflow">if</span>( nX1_vector ) {
00033         <a class="code" href="ALL_8H.html#a8">mem_del</a>(<a class="code" href="classQuadProgramming.html#m4">nX1_vector</a>);
00034         <a class="code" href="classQuadProgramming.html#m4">nX1_vector</a> = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00035     }
00036 
00037     <span class="keywordflow">if</span>( nXn_matrix ) {
00038         <a class="code" href="ALL_8H.html#a8">mem_del</a>(<a class="code" href="classQuadProgramming.html#m5">nXn_matrix</a>);
00039         <a class="code" href="classQuadProgramming.html#m5">nXn_matrix</a> = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00040     }
00041 
00042     <span class="keywordflow">if</span>( nom_matrix ) {
00043         <a class="code" href="ALL_8H.html#a8">mem_del</a>(<a class="code" href="classQuadProgramming.html#m6">nom_matrix</a>);
00044         <a class="code" href="classQuadProgramming.html#m6">nom_matrix</a> = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00045     }
00046 
00047     <span class="keywordflow">if</span>( constraint_sum ) {
00048         <a class="code" href="ALL_8H.html#a8">mem_del</a>(<a class="code" href="classQuadProgramming.html#m9">constraint_sum</a>);
00049         <a class="code" href="classQuadProgramming.html#m9">constraint_sum</a> = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00050     }
00051     <span class="keywordflow">if</span>( selected_i ) {
00052         <a class="code" href="ALL_8H.html#a8">mem_del</a>(<a class="code" href="classQuadProgramming.html#m10">selected_i</a>);
00053         <a class="code" href="classQuadProgramming.html#m10">selected_i</a> = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00054     }
00055     <span class="keywordflow">if</span>( lambda_c ) {
00056         <a class="code" href="ALL_8H.html#a8">mem_del</a>(<a class="code" href="classQuadProgramming.html#m11">lambda_c</a>);
00057         <a class="code" href="classQuadProgramming.html#m11">lambda_c</a> = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00058     }
00059     <span class="keywordflow">if</span>( mX1_vector ) {
00060         <a class="code" href="ALL_8H.html#a8">mem_del</a>(<a class="code" href="classQuadProgramming.html#m12">mX1_vector</a>);
00061         <a class="code" href="classQuadProgramming.html#m12">mX1_vector</a> = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00062     }
00063     <span class="keywordflow">if</span>( mXm_matrix ) {
00064         <a class="code" href="ALL_8H.html#a8">mem_del</a>(<a class="code" href="classQuadProgramming.html#m13">mXm_matrix</a>);
00065         <a class="code" href="classQuadProgramming.html#m13">mXm_matrix</a> = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00066     }
00067 
00068     <span class="keywordflow">if</span>( constraint_coefficient ) {
00069         <a class="code" href="ALL_8H.html#a8">mem_del</a>(<a class="code" href="classQuadProgramming.html#m14">constraint_coefficient</a>);
00070         <a class="code" href="classQuadProgramming.html#m14">constraint_coefficient</a> = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00071     }
00072 
00073     <span class="keywordflow">if</span>( lambda_p ) {
00074         <a class="code" href="ALL_8H.html#a8">mem_del</a>(<a class="code" href="classQuadProgramming.html#m15">lambda_p</a>);
00075         <a class="code" href="classQuadProgramming.html#m15">lambda_p</a> = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00076     }
00077 
00078     <span class="keywordflow">if</span>( determinant_swap_tmp ) {
00079         <a class="code" href="ALL_8H.html#a8">mem_del</a>(<a class="code" href="classQuadProgramming.html#m17">determinant_swap_tmp</a>);
00080         <a class="code" href="classQuadProgramming.html#m17">determinant_swap_tmp</a> = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00081     }
00082 
00083     <a class="code" href="classQuadProgramming.html#m16">determinant_row_alloc</a> = 0;
00084     <a class="code" href="classQuadProgramming.html#m8">constraint_alloc</a> = 0;
00085     <a class="code" href="classQuadProgramming.html#m1">vars_alloc</a> = 0;
00086 }
00087 
00088 <span class="comment">// ------ end of function QuadProgramming::~QuadProgramming ------ //</span>
00089 
00090 <span class="comment">// ------ begin of function QuadProgramming::sp_quadratic_programming ------ //</span>
00091 <span class="comment">//</span>
00092 <span class="comment">// input : lower and upper limit of each variable, and error tolerance of each (lowLimit, highLimit, tolLimit)</span>
00093 <span class="comment">// equality constraint (limitCoeff, limitSum)</span>
00094 <span class="comment">// objective function to minimize (cost2, cost1)</span>
00095 <span class="comment">//</span>
00096 <span class="comment">// if return true, result variable in resultValue</span>
00097 <span class="comment">//</span>
<a name="l00098"></a><a class="code" href="classQuadProgramming.html#a2">00098</a> <span class="keywordtype">int</span> <a class="code" href="classQuadProgramming.html#a2">QuadProgramming::sp_quadratic_programming</a>( <span class="keywordtype">int</span> vars,
00099                                                <span class="keywordtype">double</span> *resultValue,                              <span class="comment">// output : result</span>
00100                                                <span class="comment">// lower and upper limit of variables, and error tolerance</span>
00101                                                <span class="keywordtype">double</span> *lowLimit, <span class="keywordtype">double</span> *highLimit, <span class="keywordtype">double</span> *tolLimit,
00102                                                <span class="keywordtype">double</span> *limitCoeff, <span class="keywordtype">double</span> limitSum,              <span class="comment">// constraint : limitCoeff[i] * variable[i] = limitSum</span>
00103                                                <span class="keywordtype">double</span> *cost1,                                    <span class="comment">// to minimize cost1[i] * variable[i] + cost[i] * variable[i]^2</span>
00104                                                <span class="keywordtype">double</span> *cost2 ) {
00105     <span class="keywordtype">int</span> hasResult = 0;
00106 
00107     <span class="keywordtype">int</span> maxConstraints = vars + 1; {                <span class="comment">// 1 is limitCoeff&amp;limitSum constraint</span>
00108 
00109         <span class="comment">// check the lowLimit and highLimit is contradictory to limitCoeff[i] * variable[i] = limitSum</span>
00110         <span class="comment">// return before new to avoid leak</span>
00111         <span class="keywordtype">double</span> lowRange = 0.0;
00112         <span class="keywordtype">double</span> highRange = 0.0;
00113         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; vars; ++i ) {
00114             <span class="keywordflow">if</span>( limitCoeff[i] &gt;= 0 ) {
00115                 highRange += limitCoeff[i] * highLimit[i];
00116                 lowRange += limitCoeff[i] * lowLimit[i];
00117             }
00118             <span class="keywordflow">else</span> {
00119                 highRange += limitCoeff[i] * lowLimit[i];
00120                 lowRange += limitCoeff[i] * highLimit[i];
00121             }
00122         }
00123         <span class="keywordflow">if</span>( limitSum &gt; highRange || limitSum &lt; lowRange ) {
00124             <span class="keywordflow">return</span> 0;
00125         }
00126     }
00127 
00128     set_var_count( vars );
00129     set_constraint_count( maxConstraints );
00130 
00131     <span class="comment">// use double *test_value = new double[vars];</span>
00132     <span class="comment">// use double *value_tol = new double[vars];</span>
00133     <span class="comment">// use double *constraint_coefficient = new double[maxConstraints*vars]; // [constraints][vars]</span>
00134     <span class="comment">// use double *constraintSum = new double[maxConstraints];</span>
00135 
00136     <span class="keywordtype">int</span> constraintCount = 0;
00137 
00138     <span class="keywordtype">int</span> i;
00139 
00140     <a class="code" href="ALL_8H.html#a0">err_when</a>( vars &lt; 2 || vars &gt; 18 );              <span class="comment">// max limit is 19 variables, combinationCount will overflow</span>
00141 
00142     <span class="comment">// determinte tolerance of limitSum</span>
00143     <span class="keywordtype">double</span> limitTol = 0.0f;
00144     <span class="keywordflow">for</span>( i = 0; i &lt; vars; ++i ) {
00145         <a class="code" href="classQuadProgramming.html#m3">value_tol</a>[i] = tolLimit[i];
00146         limitTol += <a class="code" href="classQuadProgramming.html#m3">value_tol</a>[i] * <a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(limitCoeff[i]);
00147     }
00148     limitTol /= vars;
00149 
00150     <span class="comment">// initialize constraint set, add limitCoeff&amp;limitSum constraint</span>
00151 
00152     <span class="keywordflow">for</span>( i = 0; i &lt; vars; ++i )
00153         <a class="code" href="classQuadProgramming.html#m14">constraint_coefficient</a>[constraintCount * vars + i] = limitCoeff[i];
00154     <a class="code" href="classQuadProgramming.html#m9">constraint_sum</a>[constraintCount] = limitSum;
00155     ++constraintCount;
00156     <span class="keywordtype">int</span> equalityConstraintCount = constraintCount;
00157 
00158     <span class="comment">// try optimize, use lagrange multiplier to solve</span>
00159 
00160     <span class="keywordflow">while</span>(1) {
00161         <span class="keywordtype">int</span> solveFlag = 0;
00162         <span class="keywordflow">if</span>( constraintCount &lt; vars )
00163             solveFlag = <a class="code" href="classQuadProgramming.html#a3">lcqf_lagrange_multiplier</a>(vars, constraintCount, <a class="code" href="classQuadProgramming.html#m2">test_value</a>, <a class="code" href="classQuadProgramming.html#m14">constraint_coefficient</a>, <a class="code" href="classQuadProgramming.html#m9">constraint_sum</a>, cost1, cost2);
00164         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( constraintCount &gt;= vars )
00165             solveFlag = <a class="code" href="classQuadProgramming.html#a4">solve_linear_system</a>( vars, <a class="code" href="classQuadProgramming.html#m2">test_value</a>, <a class="code" href="classQuadProgramming.html#m14">constraint_coefficient</a>, <a class="code" href="classQuadProgramming.html#m9">constraint_sum</a> );
00166 
00167         <span class="keywordflow">if</span>( solveFlag ) {
00168             <span class="keywordtype">int</span> oldConstraintCount = constraintCount;
00169             <span class="comment">// reset constraint count, so as to remove inequality constraint</span>
00170             constraintCount = equalityConstraintCount;
00171 
00172             <span class="comment">// test break lower/upper limit constraint</span>
00173 
00174             <span class="keywordtype">int</span> passAllFlag = 1;
00175             <span class="keywordflow">for</span>( i = 0; i &lt; vars; ++i ) {
00176                 <span class="keywordflow">if</span>( <a class="code" href="classQuadProgramming.html#m2">test_value</a>[i] &lt; lowLimit[i] - <a class="code" href="classQuadProgramming.html#m3">value_tol</a>[i] ) {
00177                     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> k = 0; k &lt; vars; ++k )
00178                         <a class="code" href="classQuadProgramming.html#m14">constraint_coefficient</a>[constraintCount * vars + k] = 0.0;
00179                     <a class="code" href="classQuadProgramming.html#m14">constraint_coefficient</a>[constraintCount * vars + i] = 1.0;
00180                     <a class="code" href="classQuadProgramming.html#m9">constraint_sum</a>[constraintCount] = lowLimit[i];
00181                     ++constraintCount;
00182                     passAllFlag = 0;
00183                 }
00184                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classQuadProgramming.html#m2">test_value</a>[i] &gt; highLimit[i] + <a class="code" href="classQuadProgramming.html#m3">value_tol</a>[i] ) {
00185                     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> k = 0; k &lt; vars; ++k )
00186                         <a class="code" href="classQuadProgramming.html#m14">constraint_coefficient</a>[constraintCount * vars + k] = 0.0;
00187                     <a class="code" href="classQuadProgramming.html#m14">constraint_coefficient</a>[constraintCount * vars + i] = -1.0;
00188                     <a class="code" href="classQuadProgramming.html#m9">constraint_sum</a>[constraintCount] = -highLimit[i];
00189                     ++constraintCount;
00190                     passAllFlag = 0;
00191                 }
00192             }
00193 
00194             <span class="keywordflow">if</span>( passAllFlag || constraintCount &lt;= oldConstraintCount ) {
00195                 <span class="comment">// if loop back with same set of constraints, will become infinite loop, so also return a result</span>
00196                 <span class="keywordflow">for</span>( i = 0; i &lt; vars; ++i )
00197                     resultValue[i] = <a class="code" href="classQuadProgramming.html#m2">test_value</a>[i];
00198                 hasResult = 1;
00199                 <span class="keywordflow">break</span>;
00200             }
00201         }
00202         <span class="keywordflow">else</span> {
00203             hasResult = 0;
00204             <span class="keywordflow">break</span>;
00205         }
00206     }
00207 
00208     <span class="keywordflow">return</span> hasResult;
00209 }
00210 
00211 <span class="comment">// ------ end of function QuadProgramming::sp_quadratic_programming ------ //</span>
00212 
00213 <span class="comment">// ------ begin of function QuadProgramming::lcqf_lagrange_multiplier ------ //</span>
00214 <span class="comment">//</span>
00215 <span class="comment">// solve lagrange multiplier</span>
00216 <span class="comment">//</span>
00217 <span class="comment">// input : constraints, in constraintCoefficient and constraintSum</span>
00218 <span class="comment">// and objective function to minimize constraintSum</span>
00219 <span class="comment">//</span>
00220 <span class="comment">// see description in http://www.chass.utoronto.ca/~osborne/MathTutorial/MEMF.HTM</span>
00221 <span class="comment">//</span>
00222 <span class="keywordtype">int</span> <a class="code" href="classQuadProgramming.html#a3">QuadProgramming::lcqf_lagrange_multiplier</a>( <span class="keywordtype">int</span> vars, <span class="keywordtype">int</span> constraints,
00223                                                <span class="keywordtype">double</span> resultValue[],                             <span class="comment">// [vars], output : result</span>
00224                                                <span class="keywordtype">double</span> constraintCoefficient[],                   <span class="comment">// [constraints][vars] coefficient of linear constraint</span>
00225                                                <span class="keywordtype">double</span> constraintSum[],                           <span class="comment">// [constraints]</span>
00226                                                <span class="keywordtype">double</span> cost1[],                                   <span class="comment">// to minimize cost1[i] * variable[i] + cost[i] * variable[i]^2</span>
00227                                                <span class="keywordtype">double</span> cost2[] ) {
00228     <a class="code" href="ALL_8H.html#a0">err_when</a>( constraints &gt;= vars );                <span class="comment">// otherwise no need use optimize, just solve the constraints directly</span>
00229 
00230   <span class="comment">// resultValue will be p</span>
00231     <span class="keywordtype">int</span> n = vars;
00232     <span class="keywordtype">int</span> m = constraints;
00233     <span class="keywordtype">double</span> *Q = cost2;
00234     <span class="keywordtype">double</span> *c = cost1;
00235     <span class="keywordtype">double</span> *A = constraintCoefficient;
00236     <span class="keywordtype">double</span> *b = constraintSum;
00237 
00238   <span class="comment">// L(p[0],p[1],...p[N-1]) = Sum(i=0,n-1, Q[i]*p[i]^2 + c[i]*p[i]) - Sum(j=0,m-1,Lambda[j] * (Sum(i=0,n-1, A[j,i]*p[i]) - b[j]) )</span>
00239 
00240   <span class="comment">// 1st order condition (partial differetial)</span>
00241   <span class="comment">// for i = 0 to N-1, Sum(j=0,m-1, Lambda[j]*A[j,i]) = 2*Q[i]*p[i] + c[i]</span>
00242   <span class="comment">// ie : Lambda[0] * A[0,i] + lambda[1] * A[1,i] + lambda[2] * A[2,i] + ... + lambda[m-1] * A[2,m-1] = 2 * Q[i] * p[i] + c[i]</span>
00243 
00244   <span class="comment">// Lambda[j] is linear on each p[k] :</span>
00245   <span class="comment">// let Lambda[j] = Sum(k=0,n-1, LambdaP[j,k]*p[k]) + LambdaC[j]</span>
00246   <span class="comment">// ie : Lambda[j] = LambdaP[j,0] * p[0] + LambdaP[j,1] * p[1] + ... + LambdaP[j,n-1] * p[n-1] + LambdaC[j]</span>
00247   <span class="comment">//</span>
00248 
00249   <span class="comment">// equate coefficient of p[0] for j = 0 to m-1 :</span>
00250   <span class="comment">// for i = 0 to N-1, Sum(j=0,m-1, A[j,i]*LambdaC[j]) = c[i]</span>
00251   <span class="comment">// for i = 0 to N-1, for k = 0 to N-1, Sum(j=0,m-1, A[j,i]*LambdaP[j,k]) = 2*Qi (if k == i)</span>
00252   <span class="comment">//                                                                       = 0 (if k != i )</span>
00253 
00254   <span class="comment">// solving LambdaC, and LambdaP, but now find which m out of n 1st order conditions to solve</span>
00255 
00256     set_var_count( n );
00257     set_constraint_count( m );
00258 
00259   <span class="comment">// use int *selectedI = new int[m];</span>
00260   <span class="comment">// use double *lambdaC = new double[m]; // [M]</span>
00261   <span class="comment">// use double *lambdaP = new double[n*m]; // [N][M] // beware, transposed</span>
00262   <span class="comment">// use double *mXmMatrix = new double[m*m];</span>
00263   <span class="comment">// use double *mX1Vector = new double[m];</span>
00264   <span class="comment">// use double *nXnMatrix = new double[n*n];</span>
00265   <span class="comment">// use double *nX1Vector = new double[n];</span>
00266 
00267     <span class="keywordtype">int</span> i, j, k;
00268     <span class="keywordtype">int</span> selectI;
00269 
00270   <span class="comment">// select find m values from 0 to n (store in i) such that</span>
00271   <span class="comment">// the row mXmMatrix[i*m + j] = A[j*n+i] is not in ratio with previous rows added to mxmMatrix</span>
00272 
00273     <span class="keywordtype">int</span> rc = 0;
00274 
00275     <span class="comment">// generate combination (nCr)</span>
00276 
00277     <span class="keywordflow">for</span>( selectI = 0; selectI &lt; m; ++selectI )      <span class="comment">// set initial value</span>
00278         <a class="code" href="classQuadProgramming.html#m10">selected_i</a>[selectI] = selectI;
00279 
00280     <span class="keywordflow">while</span>(1) {
00281         <span class="comment">// set mXmMatrix;</span>
00282         <span class="keywordflow">for</span>( selectI = 0; selectI &lt; m; ++selectI ) {
00283             i = <a class="code" href="classQuadProgramming.html#m10">selected_i</a>[selectI];
00284             <span class="keywordflow">for</span>( j = 0; j &lt; m; ++j )
00285                 <a class="code" href="classQuadProgramming.html#m13">mXm_matrix</a>[selectI*m + j] = A[j*n + i];
00286         }
00287 
00288         <span class="keywordflow">if</span>( <a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(<a class="code" href="classQuadProgramming.html#a5">matrix_determinant</a>( m, m, <a class="code" href="classQuadProgramming.html#m13">mXm_matrix</a>) ) != 0.0 ) {
00289             rc = 1;
00290             <span class="keywordflow">break</span>;                                      <span class="comment">// a matrix is found</span>
00291         }
00292 
00293         <span class="comment">// matrix fail, select next combination</span>
00294         <span class="keywordflow">for</span>( j=m-1; j &gt;= 0; --j ) {
00295             <span class="keywordflow">if</span>( ++<a class="code" href="classQuadProgramming.html#m10">selected_i</a>[j] &lt; n+j-m+1 )
00296                 <span class="keywordflow">break</span>;
00297         }
00298         <span class="keywordflow">if</span>( j &lt; 0 )
00299             <span class="keywordflow">break</span>;                                      <span class="comment">// finish, no matrix is found</span>
00300 
00301         <span class="comment">// reset value after j</span>
00302         <span class="keywordflow">for</span>( ++j; j &lt; m; ++j )
00303             <a class="code" href="classQuadProgramming.html#m10">selected_i</a>[j] = <a class="code" href="classQuadProgramming.html#m10">selected_i</a>[j-1] + 1;
00304     }
00305 
00306     <span class="keywordflow">if</span>( rc ) {
00307         rc = 0;
00308 
00309         <span class="comment">// solving LambdaC</span>
00310 
00311         <span class="keywordflow">for</span>( selectI = 0; selectI &lt; m; ++selectI ) {
00312             i = <a class="code" href="classQuadProgramming.html#m10">selected_i</a>[selectI];
00313             <a class="code" href="classQuadProgramming.html#m12">mX1_vector</a>[selectI] = c[i];
00314             <span class="keywordflow">for</span>( j = 0; j &lt; m; ++j )
00315                 <a class="code" href="classQuadProgramming.html#m13">mXm_matrix</a>[selectI*m + j] = A[j*n + i];
00316         }
00317 
00318         <span class="keywordflow">if</span>( <a class="code" href="classQuadProgramming.html#a4">solve_linear_system</a>( m, <a class="code" href="classQuadProgramming.html#m11">lambda_c</a>, <a class="code" href="classQuadProgramming.html#m13">mXm_matrix</a>, <a class="code" href="classQuadProgramming.html#m12">mX1_vector</a> ) ) {
00319             <span class="comment">// solve lambdaP</span>
00320             <span class="keywordflow">for</span>(k = 0; k &lt; n; ++k ) {
00321                 <span class="comment">// for( i = 0; i &lt; m; ++i ) // use up to m constraint enough to solve</span>
00322                 <span class="keywordflow">for</span>( selectI = 0; selectI &lt; m; ++selectI ) {
00323                     i = <a class="code" href="classQuadProgramming.html#m10">selected_i</a>[selectI];
00324                     <a class="code" href="classQuadProgramming.html#m12">mX1_vector</a>[selectI] = (i == k) ? 2 * Q[i] : 0;
00325 
00326                     <span class="comment">// can keep using mXmMatrix from the above</span>
00327                     <span class="comment">//for( j = 0; j &lt; m; ++j )</span>
00328                     <span class="comment">//{</span>
00329                     <span class="comment">//  mXmMatrix[selectI*m + j] = A[j*n + i];</span>
00330                     <span class="comment">//}</span>
00331                 }
00332 
00333                 <span class="comment">// since use same mXmMatrix, solvable again</span>
00334                 <a class="code" href="classQuadProgramming.html#a4">solve_linear_system</a>( m, <a class="code" href="classQuadProgramming.html#m15">lambda_p</a> + k * m, <a class="code" href="classQuadProgramming.html#m13">mXm_matrix</a>, <a class="code" href="classQuadProgramming.html#m12">mX1_vector</a> );
00335             }
00336 
00337             <span class="comment">// finally solve</span>
00338             <span class="comment">// for(j=0 to m-1)  Sum(i=0,n-1, A[j,i] * p[i]) = b[j]          (constraints)</span>
00339             <span class="comment">// and remaining 1st order condition : for i not in selected_i, Sum(j=0,m-1, Lambda[j]*A[j,i] ) = 2 * Q[i] * p[i] + c[i]      (remaining 1st order condition)</span>
00340 
00341             <span class="keywordflow">for</span>( j = 0; j &lt; m; ++j ) {
00342                 <span class="keywordflow">for</span>( i = 0; i &lt; n; ++i ) {
00343                     <a class="code" href="classQuadProgramming.html#m5">nXn_matrix</a>[j * n + i] = A[j * n + i ];
00344                 }
00345                 <a class="code" href="classQuadProgramming.html#m4">nX1_vector</a>[j] = b[j];
00346             }
00347 
00348             <span class="comment">// now add n-m rows of 1st order constraint into nXn_matrix, representing coefficient of linear equations</span>
00349 
00350             <span class="comment">// for i not in selected_i,</span>
00351             <span class="comment">// Sum(j=0,m-1, Lambda[j]*A[j,i] ) = 2 * Q[i] * p[i] + c[i]</span>
00352             <span class="comment">// = Sum(j=0,m-1, Sum(k=0,n-1, LambdaP[j,k] * p[k]) * A[j,i] + LambdaC[j] * A[j,i] ) -  2*Q[i]*p[i] = c[i]</span>
00353             <span class="comment">// = Sum(j=0,m-1, Sum(k=0,n-1, LambdaP[j,k] * A[j,i] * p[k])) - 2*Q[i]*p[i] = c[i] - Sum(j=0,m-1, LambdaC[j] * A[j,i])</span>
00354             <span class="comment">// = Sum(k=0,n-1, Sum(j=0,m-1, LambdaP[j,k] * A[j,i]) * p[k]) - 2*Q[i]*p[i] = c[i] - Sum(j=0,m-1, LambdaC[j] * A[j,i])</span>
00355 
00356             <span class="keywordtype">int</span> eqCount = m;                            <span class="comment">// m row has been added</span>
00357             selectI = 0;
00358             <span class="keywordflow">for</span>( i = 0; i &lt; n; ++i ) {                  <span class="comment">// just do i row and copy to to n-th row</span>
00359                 <span class="comment">// see i is in selected_i, if inside, skip (assume selected_i is ascending)</span>
00360                 <span class="keywordflow">if</span>( selectI &lt; m &amp;&amp; i == <a class="code" href="classQuadProgramming.html#m10">selected_i</a>[selectI] ) {
00361                     ++selectI;
00362                     <span class="keywordflow">continue</span>;
00363                 }
00364 
00365                 <span class="keywordflow">for</span>(k = 0; k &lt; n; ++k ) {
00366                     <span class="keywordtype">double</span> nXnMatrixIK = 0.0;
00367                     <span class="keywordflow">for</span>( j = 0; j &lt; m; ++j ) {
00368                         nXnMatrixIK += <a class="code" href="classQuadProgramming.html#m15">lambda_p</a>[k * m + j] * A[j * n + i];
00369                     }
00370                     <a class="code" href="classQuadProgramming.html#m5">nXn_matrix</a>[eqCount * n + k] = nXnMatrixIK;
00371                 }
00372                 <a class="code" href="classQuadProgramming.html#m5">nXn_matrix</a>[eqCount * n + i] -= 2 * Q[i];
00373 
00374                 <span class="keywordtype">double</span> nX1VectorI = c[i];
00375                 <span class="keywordflow">for</span>( j = 0; j &lt; m; ++j ) {
00376                     nX1VectorI -= <a class="code" href="classQuadProgramming.html#m11">lambda_c</a>[j] * A[j * n + i];
00377                 }
00378                 <a class="code" href="classQuadProgramming.html#m4">nX1_vector</a>[eqCount] = nX1VectorI;
00379 
00380                 ++eqCount;
00381             }
00382 
00383             <span class="keywordflow">if</span>( <a class="code" href="classQuadProgramming.html#a4">solve_linear_system</a>( n, resultValue, <a class="code" href="classQuadProgramming.html#m5">nXn_matrix</a>, <a class="code" href="classQuadProgramming.html#m4">nX1_vector</a> ) ) {
00384                 rc = 1;
00385             }
00386         }
00387     }
00388 
00389     <span class="keywordflow">return</span> rc;
00390 }
00391 
00392 <span class="comment">// ------ end of function QuadProgramming::lcqf_lagrange_multiplier ------ //</span>
00393 
00394 <span class="comment">// ------ begin of function QuadProgramming::solve_linear_system ------ //</span>
00395 <span class="comment">//</span>
00396 <span class="keywordtype">int</span> <a class="code" href="classQuadProgramming.html#a4">QuadProgramming::solve_linear_system</a>( <span class="keywordtype">int</span> vars,
00397                                           <span class="keywordtype">double</span> resultValue[],                             <span class="comment">// [vars]</span>
00398                                           <span class="keywordtype">double</span> constraintCoefficient[],                   <span class="comment">// [vars][vars] coefficient of linear constraint</span>
00399                                           <span class="keywordtype">double</span> constraintSum[] ) {                        <span class="comment">// [vars] such that Summation(i, constraintCoefficient[j][i]) = constraintSum[j]</span>
00400     <span class="keywordtype">int</span> i, j;
00401 
00402     set_var_count( vars );                          <span class="comment">// change var_count</span>
00403     <span class="comment">// use nom_matrix</span>
00404 
00405     <span class="keywordtype">double</span> denom = <a class="code" href="classQuadProgramming.html#a5">matrix_determinant</a>( vars, vars, constraintCoefficient );
00406 
00407     <span class="keywordflow">if</span>( <a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(denom) == 0.0 )
00408         <span class="keywordflow">return</span> 0;
00409 
00410     <span class="keywordflow">for</span>( i = 0; i &lt; vars; ++i ) {
00411         <span class="comment">// copy row of matrix</span>
00412         memcpy( <a class="code" href="classQuadProgramming.html#m6">nom_matrix</a> + i * vars, constraintCoefficient + i * vars, vars * <span class="keyword">sizeof</span>(<a class="code" href="classQuadProgramming.html#m6">nom_matrix</a>[0]) );
00413     }
00414 
00415     <span class="keywordflow">for</span>( i = 0; i &lt; vars; ++i ) {
00416         <span class="comment">// copy one column of constraintSum to nomMatrix</span>
00417         <span class="keywordflow">for</span>( j = 0; j &lt; vars; ++j ) {
00418             <a class="code" href="classQuadProgramming.html#m6">nom_matrix</a>[j*vars + i] = constraintSum[j];
00419         }
00420 
00421         <span class="keywordtype">double</span> nominator = <a class="code" href="classQuadProgramming.html#a5">matrix_determinant</a>( vars, vars, <a class="code" href="classQuadProgramming.html#m6">nom_matrix</a> );
00422         resultValue[i] = nominator / denom;
00423 
00424         <span class="comment">// restore one column of constraintSum from constraintCoefficient</span>
00425         <span class="keywordflow">for</span>( j = 0; j &lt; vars; ++j ) {
00426             <a class="code" href="classQuadProgramming.html#m6">nom_matrix</a>[j*vars + i] = constraintCoefficient[j*vars + i];
00427         }
00428     }
00429 
00430     <span class="keywordflow">return</span> 1;
00431 }
00432 
00433 <span class="comment">// ------ end of function QuadProgramming::solve_linear_system ------ //</span>
00434 
00435 <span class="comment">// ------ begin of function QuadProgramming::matrix_determinant ------ //</span>
00436 <span class="comment">//</span>
00437 <span class="comment">// matrix[nSqSize][nSqSize] coefficient of linear constraint</span>
00438 <span class="comment">// coverted access element in matrix using to rowArray[row] * rowPitch + colArray[col]</span>
00439 <span class="comment">//</span>
00440 <span class="comment">// rowArray and colArray must be in separate memory location</span>
00441 <span class="comment">// they can be NULL, the function generate for vector for itself</span>
00442 <span class="comment">//</span>
<a name="l00443"></a><a class="code" href="classQuadProgramming.html#a5">00443</a> <span class="keywordtype">double</span> <a class="code" href="classQuadProgramming.html#a5">QuadProgramming::matrix_determinant</a>( <span class="keywordtype">int</span> nSqSize, <span class="keywordtype">int</span> rowPitch, <span class="keywordtype">double</span> *matrix ) {
00444     <span class="keywordtype">int</span> i;
00445     <span class="keywordtype">double</span> detSum = 0.0f;
00446 
00447 <span class="preprocessor">#define MATRIX_E(r,c) matrix[(r) * rowPitch + (c)]</span>
00448 <span class="preprocessor"></span>
00449     <span class="keywordflow">if</span>( nSqSize &lt;= 3 ) {
00450         <span class="keywordflow">if</span>( nSqSize == 1 ) {
00451             <span class="keywordflow">return</span> MATRIX_E(0, 0);
00452         }
00453         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( nSqSize == 2 ) {
00454             <span class="keywordflow">return</span> MATRIX_E(0, 0) * MATRIX_E(1, 1)
00455                 - MATRIX_E(1, 0) * MATRIX_E(0, 1);
00456         }
00457         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( nSqSize == 3 ) {
00458             <span class="keywordflow">return</span> MATRIX_E(0,0) * MATRIX_E(1,1) * MATRIX_E(2,2)
00459                 + MATRIX_E(1,0) * MATRIX_E(2,1) * MATRIX_E(0,2)
00460                 + MATRIX_E(2,0) * MATRIX_E(0,1) * MATRIX_E(1,2)
00461                 - MATRIX_E(0,0) * MATRIX_E(2,1) * MATRIX_E(1,2)
00462                 - MATRIX_E(1,0) * MATRIX_E(0,1) * MATRIX_E(2,2)
00463                 - MATRIX_E(2,0) * MATRIX_E(1,1) * MATRIX_E(0,2);
00464         }
00465 
00466         <a class="code" href="ALL_8H.html#a1">err_here</a>();
00467         <span class="keywordflow">return</span> 0.0;
00468     }
00469     <span class="keywordflow">else</span> {
00470         <span class="comment">/*</span>
00471 <span class="comment">          double pSum = 0.0;</span>
00472 <span class="comment">          int addSign = 1;</span>
00473 <span class="comment"></span>
00474 <span class="comment">          for( i = 0; i &lt; nSqSize; ++i, (addSign = !addSign) )</span>
00475 <span class="comment">          {</span>
00476 <span class="comment">          double row0I = MATRIX_E(0, i); // make a backup before change colArray,</span>
00477 <span class="comment"></span>
00478 <span class="comment">          // remove colArray[i]</span>
00479 <span class="comment">          int backupCol = colArray[i];</span>
00480 <span class="comment">          memmove( colArray+i, colArray+i+1, (nSqSize-i-1)*sizeof(colArray[0]) );</span>
00481 <span class="comment"></span>
00482 <span class="comment">          // use sum of each element in row 0 and its cofactor</span>
00483 <span class="comment">          if( addSign )</span>
00484 <span class="comment">          pSum += row0I * matrix_determinant( nSqSize-1, rowPitch, matrix, rowArray+1, colArray );</span>
00485 <span class="comment">          else</span>
00486 <span class="comment">          pSum -= row0I * matrix_determinant( nSqSize-1, rowPitch, matrix, rowArray+1, colArray );</span>
00487 <span class="comment"></span>
00488 <span class="comment">          // restore colArray[i], re-insert backupCol</span>
00489 <span class="comment">          memmove( colArray+i+1, colArray+i, (nSqSize-i-1)*sizeof(colArray[0]) );</span>
00490 <span class="comment">          colArray[i] = backupCol;</span>
00491 <span class="comment">          }</span>
00492 <span class="comment"></span>
00493 <span class="comment">          return pSum;</span>
00494 <span class="comment">        */</span>
00495 
00496         set_determinant_size( nSqSize );
00497 
00498         <span class="comment">// use each value on right most column and its co-factor</span>
00499         <span class="keywordtype">double</span> pSum = 0.0;
00500         <span class="keywordtype">int</span> mulSign = 1;                              <span class="comment">// add botton right corner * its co-factor</span>
00501 
00502         <span class="keywordflow">for</span>( i = nSqSize-1; i &gt;= 0; --i, (mulSign = -mulSign) ) {
00503             <span class="comment">// swap rows so next co-factor is moved to the upper left of the matrix</span>
00504             <span class="comment">// eg : original:</span>
00505             <span class="comment">// a11 a12 a13 a14</span>
00506             <span class="comment">// a21 a22 a23 a24</span>
00507             <span class="comment">// a31 a32 a33 a34</span>
00508             <span class="comment">// a41 a42 a43 a44  // we calculate a44 * A44 (=cofactor =  determinant of a11..a33)</span>
00509             <span class="comment">//</span>
00510             <span class="comment">// swap row 3 and 4</span>
00511             <span class="comment">// a11 a12 a13 a14</span>
00512             <span class="comment">// a21 a22 a23 a24</span>
00513             <span class="comment">// a41 a42 a43 a44</span>
00514             <span class="comment">// a31 a32 a33 a34  // we calculate a34 * A34</span>
00515             <span class="comment">//</span>
00516             <span class="comment">// swap row 2 and 4</span>
00517             <span class="comment">// a11 a12 a13 a14</span>
00518             <span class="comment">// a31 a32 a33 a34</span>
00519             <span class="comment">// a41 a42 a43 a44</span>
00520             <span class="comment">// a21 a22 a23 a24  // we calculate a24 * A24</span>
00521             <span class="comment">//</span>
00522             <span class="comment">// swap row 1 and 4</span>
00523             <span class="comment">// a21 a22 a23 a24</span>
00524             <span class="comment">// a31 a32 a33 a34</span>
00525             <span class="comment">// a41 a42 a43 a44</span>
00526             <span class="comment">// a11 a12 a13 a14  // we calculate a14 * A14</span>
00527             <span class="comment">//</span>
00528             <span class="comment">// cycle row 4 back to row 1 to restore to original</span>
00529 
00530             <span class="keywordtype">double</span> entryValue = MATRIX_E(nSqSize-1, nSqSize-1);
00531             <span class="keywordflow">if</span>( entryValue != 0.0 ) {                   <span class="comment">// skip if zero, safe time in recursion</span>
00532                 <span class="keywordflow">if</span>( mulSign &gt; 0 )                         <span class="comment">// +ve</span>
00533                     pSum += entryValue * <a class="code" href="classQuadProgramming.html#a5">matrix_determinant</a>( nSqSize-1, rowPitch, matrix );
00534                 <span class="keywordflow">else</span>
00535                     pSum -= entryValue * <a class="code" href="classQuadProgramming.html#a5">matrix_determinant</a>( nSqSize-1, rowPitch, matrix );
00536             }
00537 
00538             <span class="keywordflow">if</span>( i &gt; 0 ) {
00539                 <span class="comment">// swap i-1 th row nSqSize-1 row</span>
00540                 <span class="comment">// so next loop will calc MATRIX_E(i-1,nSqSize-1) * cofactor</span>
00541                 memcpy( <a class="code" href="classQuadProgramming.html#m17">determinant_swap_tmp</a>, &amp;MATRIX_E(i-1,0), nSqSize * <span class="keyword">sizeof</span>(matrix[0]) );
00542                 memcpy( &amp;MATRIX_E(i-1,0), &amp;MATRIX_E(nSqSize-1,0), nSqSize * <span class="keyword">sizeof</span>(matrix[0]) );
00543                 memcpy( &amp;MATRIX_E(nSqSize-1,0), <a class="code" href="classQuadProgramming.html#m17">determinant_swap_tmp</a>, nSqSize * <span class="keyword">sizeof</span>(matrix[0]) );
00544             }
00545             <span class="keywordflow">else</span> {
00546                 <span class="comment">// cycle last row to 1st row</span>
00547                 memcpy( <a class="code" href="classQuadProgramming.html#m17">determinant_swap_tmp</a>, &amp;MATRIX_E(nSqSize-1,0), nSqSize * <span class="keyword">sizeof</span>(matrix[0]) );
00548                 <span class="keywordflow">for</span>( <span class="keywordtype">int</span> j = nSqSize-1; j &gt; 0; --j )
00549                     memcpy( &amp;MATRIX_E(j,0), &amp;MATRIX_E(j-1,0), nSqSize * <span class="keyword">sizeof</span>(matrix[0]) );
00550                 memcpy( &amp;MATRIX_E(0,0), <a class="code" href="classQuadProgramming.html#m17">determinant_swap_tmp</a>, nSqSize * <span class="keyword">sizeof</span>(matrix[0]) );
00551             }
00552         }
00553 
00554         <span class="keywordflow">return</span> pSum;
00555     }
00556 }
00557 
00558 <span class="comment">// ------ end of function QuadProgramming::matrix_determinant ------ //</span>
00559 
00560 <span class="comment">// ------ begin of function QuadProgramming::set_var_count ------ //</span>
00561 <span class="comment">//</span>
00562 <span class="comment">// allocate temp array space</span>
00563 <span class="comment">//</span>
00564 <span class="keywordtype">void</span> QuadProgramming::set_var_count( <span class="keywordtype">int</span> newVarCount ) {
00565     <span class="keywordflow">if</span>( <a class="code" href="classQuadProgramming.html#m1">vars_alloc</a> &lt; newVarCount ) {
00566         <a class="code" href="classQuadProgramming.html#m1">vars_alloc</a> = newVarCount;
00567 
00568         <span class="comment">// [vars]</span>
00569         <a class="code" href="classQuadProgramming.html#m2">test_value</a> = (<span class="keywordtype">double</span> *)<a class="code" href="ALL_8H.html#a7">mem_resize</a>(<a class="code" href="classQuadProgramming.html#m2">test_value</a>, <a class="code" href="classQuadProgramming.html#m1">vars_alloc</a> * <span class="keyword">sizeof</span>(<a class="code" href="classQuadProgramming.html#m2">test_value</a>[0]) );
00570         <a class="code" href="classQuadProgramming.html#m3">value_tol</a> = (<span class="keywordtype">double</span> *)<a class="code" href="ALL_8H.html#a7">mem_resize</a>(<a class="code" href="classQuadProgramming.html#m3">value_tol</a>, <a class="code" href="classQuadProgramming.html#m1">vars_alloc</a> * <span class="keyword">sizeof</span>(<a class="code" href="classQuadProgramming.html#m3">value_tol</a>[0]) );
00571         <a class="code" href="classQuadProgramming.html#m4">nX1_vector</a> = (<span class="keywordtype">double</span> *)<a class="code" href="ALL_8H.html#a7">mem_resize</a>(<a class="code" href="classQuadProgramming.html#m4">nX1_vector</a>, <a class="code" href="classQuadProgramming.html#m1">vars_alloc</a> * <span class="keyword">sizeof</span>(<a class="code" href="classQuadProgramming.html#m4">nX1_vector</a>[0]) );
00572 
00573         <span class="comment">// [vars * vars];</span>
00574         <a class="code" href="classQuadProgramming.html#m5">nXn_matrix</a> = (<span class="keywordtype">double</span> *)<a class="code" href="ALL_8H.html#a7">mem_resize</a>(<a class="code" href="classQuadProgramming.html#m5">nXn_matrix</a>, <a class="code" href="classQuadProgramming.html#m1">vars_alloc</a> * <a class="code" href="classQuadProgramming.html#m1">vars_alloc</a> * <span class="keyword">sizeof</span>(<a class="code" href="classQuadProgramming.html#m5">nXn_matrix</a>[0]) );
00575         <a class="code" href="classQuadProgramming.html#m6">nom_matrix</a> = (<span class="keywordtype">double</span> *)<a class="code" href="ALL_8H.html#a7">mem_resize</a>(<a class="code" href="classQuadProgramming.html#m6">nom_matrix</a>, <a class="code" href="classQuadProgramming.html#m1">vars_alloc</a> * <a class="code" href="classQuadProgramming.html#m1">vars_alloc</a> * <span class="keyword">sizeof</span>(<a class="code" href="classQuadProgramming.html#m6">nom_matrix</a>[0]) );
00576 
00577         <span class="comment">// [constraints][vars]</span>
00578         <a class="code" href="classQuadProgramming.html#m14">constraint_coefficient</a> = (<span class="keywordtype">double</span> *)<a class="code" href="ALL_8H.html#a7">mem_resize</a>(<a class="code" href="classQuadProgramming.html#m14">constraint_coefficient</a>, <a class="code" href="classQuadProgramming.html#m8">constraint_alloc</a> * <a class="code" href="classQuadProgramming.html#m1">vars_alloc</a> * <span class="keyword">sizeof</span>(<a class="code" href="classQuadProgramming.html#m14">constraint_coefficient</a>[0]) );
00579 
00580         <span class="comment">// vars_count * constraint_count</span>
00581         <a class="code" href="classQuadProgramming.html#m15">lambda_p</a> = (<span class="keywordtype">double</span> *)<a class="code" href="ALL_8H.html#a7">mem_resize</a>(<a class="code" href="classQuadProgramming.html#m15">lambda_p</a>, <a class="code" href="classQuadProgramming.html#m1">vars_alloc</a> * <a class="code" href="classQuadProgramming.html#m8">constraint_alloc</a> * <span class="keyword">sizeof</span>(<a class="code" href="classQuadProgramming.html#m15">lambda_p</a>[0]) );
00582     }
00583 }
00584 
00585 <span class="comment">// ------ end of function QuadProgramming::set_var_count ------ //</span>
00586 
00587 <span class="comment">// ------ begin of function QuadProgramming::set_constraint_count ------ //</span>
00588 <span class="comment">//</span>
00589 <span class="keywordtype">void</span> QuadProgramming::set_constraint_count( <span class="keywordtype">int</span> newConstraintCount ) {
00590     <span class="keywordflow">if</span>( <a class="code" href="classQuadProgramming.html#m8">constraint_alloc</a> &lt; newConstraintCount ) {
00591         <a class="code" href="classQuadProgramming.html#m8">constraint_alloc</a> = newConstraintCount;
00592 
00593         <a class="code" href="classQuadProgramming.html#m9">constraint_sum</a> = (<span class="keywordtype">double</span> *)<a class="code" href="ALL_8H.html#a7">mem_resize</a>(<a class="code" href="classQuadProgramming.html#m9">constraint_sum</a>, <a class="code" href="classQuadProgramming.html#m8">constraint_alloc</a> * <span class="keyword">sizeof</span>(<a class="code" href="classQuadProgramming.html#m9">constraint_sum</a>[0]) );
00594         <a class="code" href="classQuadProgramming.html#m10">selected_i</a> = (<span class="keywordtype">int</span> *)<a class="code" href="ALL_8H.html#a7">mem_resize</a>(<a class="code" href="classQuadProgramming.html#m10">selected_i</a>, <a class="code" href="classQuadProgramming.html#m8">constraint_alloc</a> * <span class="keyword">sizeof</span>(<a class="code" href="classQuadProgramming.html#m10">selected_i</a>[0]) );
00595         <a class="code" href="classQuadProgramming.html#m11">lambda_c</a> = (<span class="keywordtype">double</span> *)<a class="code" href="ALL_8H.html#a7">mem_resize</a>(<a class="code" href="classQuadProgramming.html#m11">lambda_c</a>, <a class="code" href="classQuadProgramming.html#m8">constraint_alloc</a> * <span class="keyword">sizeof</span>(<a class="code" href="classQuadProgramming.html#m11">lambda_c</a>[0]) );
00596         <a class="code" href="classQuadProgramming.html#m12">mX1_vector</a> = (<span class="keywordtype">double</span> *)<a class="code" href="ALL_8H.html#a7">mem_resize</a>(<a class="code" href="classQuadProgramming.html#m12">mX1_vector</a>, <a class="code" href="classQuadProgramming.html#m8">constraint_alloc</a> * <span class="keyword">sizeof</span>(<a class="code" href="classQuadProgramming.html#m12">mX1_vector</a>[0]) );
00597 
00598         <span class="comment">// constraint_alloc * constraint_alloc</span>
00599         <a class="code" href="classQuadProgramming.html#m13">mXm_matrix</a> = (<span class="keywordtype">double</span> *)<a class="code" href="ALL_8H.html#a7">mem_resize</a>(<a class="code" href="classQuadProgramming.html#m13">mXm_matrix</a>, <a class="code" href="classQuadProgramming.html#m8">constraint_alloc</a> * <a class="code" href="classQuadProgramming.html#m8">constraint_alloc</a> * <span class="keyword">sizeof</span>(<a class="code" href="classQuadProgramming.html#m13">mXm_matrix</a>[0]) );
00600 
00601         <span class="comment">// [constraints][vars]</span>
00602         <a class="code" href="classQuadProgramming.html#m14">constraint_coefficient</a> = (<span class="keywordtype">double</span> *)<a class="code" href="ALL_8H.html#a7">mem_resize</a>(<a class="code" href="classQuadProgramming.html#m14">constraint_coefficient</a>, <a class="code" href="classQuadProgramming.html#m8">constraint_alloc</a> * <a class="code" href="classQuadProgramming.html#m1">vars_alloc</a> * <span class="keyword">sizeof</span>(<a class="code" href="classQuadProgramming.html#m14">constraint_coefficient</a>[0]) );
00603 
00604         <span class="comment">// vars_count * constraint_count</span>
00605         <a class="code" href="classQuadProgramming.html#m15">lambda_p</a> = (<span class="keywordtype">double</span> *)<a class="code" href="ALL_8H.html#a7">mem_resize</a>(<a class="code" href="classQuadProgramming.html#m15">lambda_p</a>, <a class="code" href="classQuadProgramming.html#m1">vars_alloc</a> * <a class="code" href="classQuadProgramming.html#m8">constraint_alloc</a> * <span class="keyword">sizeof</span>(<a class="code" href="classQuadProgramming.html#m15">lambda_p</a>[0]) );
00606     }
00607 }
00608 
00609 <span class="comment">// ------ end of function QuadProgramming::set_constraint_count ------ //</span>
00610 
00611 <span class="comment">// ------ begin of function QuadProgramming::set_determinant_size ------ //</span>
00612 <span class="comment">//</span>
00613 <span class="keywordtype">void</span> QuadProgramming::set_determinant_size( <span class="keywordtype">int</span> newMatrixSize ) {
00614     <span class="keywordflow">if</span>( <a class="code" href="classQuadProgramming.html#m16">determinant_row_alloc</a> &lt; newMatrixSize ) {
00615         <a class="code" href="classQuadProgramming.html#m16">determinant_row_alloc</a> = newMatrixSize;
00616 
00617         <a class="code" href="classQuadProgramming.html#m17">determinant_swap_tmp</a> = (<span class="keywordtype">double</span> *)<a class="code" href="ALL_8H.html#a7">mem_resize</a>( <a class="code" href="classQuadProgramming.html#m17">determinant_swap_tmp</a>, <a class="code" href="classQuadProgramming.html#m16">determinant_row_alloc</a> * <span class="keyword">sizeof</span>(<a class="code" href="classQuadProgramming.html#m17">determinant_swap_tmp</a>[0]) );
00618     }
00619 }
00620 
00621 <span class="comment">// ------ end of function QuadProgramming::set_determinant_size ------ //</span>
00622 
00623 <span class="comment">// testing code for lcqf_lagrange_multiplier</span>
00624 <span class="preprocessor">#if(0)</span>
00625 <span class="preprocessor"></span>
00626 <span class="keyword">const</span> VARS = 3;
00627 <span class="keyword">const</span> CONSTRAINTS = 2;
00628 <span class="keywordtype">double</span> resultValue[VARS];
00629 <span class="keywordtype">double</span> constraintCoefficient[CONSTRAINTS * VARS] = {
00630     1.0,  2.0,  1.0,
00631     2.0, -1.0, -3.0,
00632 };
00633 
00634 <span class="keywordtype">double</span> constraintSum[CONSTRAINTS] = { 1.0, 4.0 };
00635 <span class="keywordtype">double</span> cost1[VARS] = { 0.0, 0.0, 0.0 };
00636 <span class="keywordtype">double</span> cost2[VARS] = { 1.0, 1.0, 1.0 };
00637 
00638 <span class="keywordtype">int</span> lagRc = lcqf_lagrange_multiplier( VARS, CONSTRAINTS,
00639                                       resultValue, constraintCoefficient, constraintSum, cost1, cost2 );
00640 <span class="preprocessor">#endif</span>
00641 <span class="preprocessor"></span>
00642 <span class="preprocessor">#if(0)</span>
00643 <span class="preprocessor"></span><span class="comment">// testing code for sp_quadratic_programming</span>
00644 
00645 <span class="keyword">const</span> VARS = 3;
00646 <span class="keywordtype">double</span> resultValue[VARS];
00647 <span class="keywordtype">double</span> lowLimit[VARS] = { -1.0, -1.0, -1.0 };
00648 <span class="keywordtype">double</span> highLimit[VARS] = { 5.0, 4.0, 5.0 };
00649 <span class="keywordtype">double</span> limitCoeff[VARS] = {                       <span class="comment">// x+y+z = 6</span>
00650     1.0, 1.0, 1.0
00651 };
00652 <span class="keywordtype">double</span> limitSum = 7.0;
00653 <span class="keywordtype">double</span> cost1[VARS] = {                            <span class="comment">// (x-2)^2 + (y-2)^2 + (z-2)^2</span>
00654     -4.0, -4.0, -4.0
00655 };
00656 <span class="keywordtype">double</span> cost2[VARS] = { 1.0, 1.0, 1.0 };
00657 
00658 <span class="keywordtype">int</span> quadRc = sp_quadratic_programming( VARS, resultValue,
00659                                        lowLimit, highLimit, limitCoeff, limitSum, cost1, cost2 );
00660 <span class="keywordflow">return</span> 0;
00661 <span class="preprocessor">#endif</span>
00662 <span class="preprocessor"></span>
00663 <span class="preprocessor">#if(0)</span>
00664 <span class="preprocessor"></span>{
00665 <span class="comment">// test solve_linear_system</span>
00666 
00667     <span class="keyword">const</span> MAX_VARS = 10;
00668     <span class="keywordtype">int</span> varCount = 6+m.random(MAX_VARS-6+1);
00669     <span class="keywordtype">double</span> answer[MAX_VARS], resultValue[MAX_VARS];
00670     <span class="keywordtype">double</span> coeff[MAX_VARS*MAX_VARS];
00671     <span class="keywordtype">double</span> sumC[MAX_VARS];
00672     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; varCount; ++i )
00673         answer[i] = m.random(10);
00674     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> j = 0; j &lt; varCount; ++j ) {
00675         sumC[j] = 0;
00676         <span class="keywordflow">for</span>( i = 0; i &lt; varCount; ++i ) {
00677             coeff[j * varCount + i] = m.random(10);
00678             sumC[j] += coeff[j * varCount + i] * answer[i];
00679         }
00680     }
00681 
00682     <span class="keywordflow">if</span>( solve_linear_system( varCount, resultValue, coeff, sumC ) ) {
00683         <span class="keywordflow">for</span>(i = 0; i &lt; varCount; ++i ) {
00684             <a class="code" href="ALL_8H.html#a0">err_when</a>( <a class="code" href="OLINALG_8CPP.html#a2">fabs</a>( resultValue[i] - answer[i] ) &gt; 0.0001 );
00685         }
00686     }
00687 }
00688 <span class="preprocessor">#endif</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:17 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
