<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Obndsldr.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Obndsldr.cpp</h1><a href="Obndsldr_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OBNDSLDR.CPP</span>
00002 <span class="comment">//Description : Object BoundedSlider</span>
00003 
00004 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00005 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00007 <span class="preprocessor">#include &lt;OFONT.H&gt;</span>
00008 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00009 <span class="preprocessor">#include &lt;<a class="code" href="OMOUSECR_8H.html">OMOUSECR.H</a>&gt;</span>
00010 <span class="preprocessor">#include &lt;<a class="code" href="OBNDSLDR_8H.html">OBNDSLDR.H</a>&gt;</span>
00011 <span class="preprocessor">#include &lt;OIFACE.H&gt;</span>
00012 <span class="preprocessor">#include &lt;OAUDIO.H&gt;</span>
00013 <span class="preprocessor">#include &lt;OCONFIG.H&gt;</span>
00014 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>                                <span class="comment">//## chea 030999</span>
00015 
00016 <span class="comment">//-------------- Define static vars ------------//</span>
00017 
00018 <span class="keyword">static</span> <span class="keywordtype">char</span> paint_flag = 0;
00019 <span class="keyword">static</span> <span class="keywordtype">double</span> dummy_zero = 0.0;
00020 
00021 <span class="comment">//-------- Begin of function BoundedSlider::BoundedSlider --------//</span>
<a name="l00023"></a><a class="code" href="classBoundedSlider.html#a0">00023</a> <span class="comment">BoundedSlider::BoundedSlider() {</span>
00024     bounded_slider_bitmap = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00025     init_flag = 0;
00026 }
00027 
00028 <span class="comment">//---------- End of function BoundedSlider::BoundedSlider ----//</span>
00029 
00030 <span class="comment">//-------- Begin of function BoundedSlider::~BoundedSlider ---//</span>
<a name="l00032"></a><a class="code" href="classBoundedSlider.html#a1">00032</a> <span class="comment">BoundedSlider::~BoundedSlider() {</span>
00033     deinit();
00034 }
00035 
00036 <span class="comment">//---------- End of function BoundedSlider::~BoundedSlider ---//</span>
00037 
00038 <span class="comment">//-------- Begin of function BoundedSlider::init --------//</span>
00053 <span class="comment">void BoundedSlider::init( int x1, int y1, int barWidth, int barHeight,</span>
00054                           <span class="keywordtype">double</span> *varPtr, <span class="keywordtype">double</span> *loPtr, <span class="keywordtype">double</span> *upPtr,
00055                           <span class="keywordtype">double</span> minVal, <span class="keywordtype">double</span> maxVal, <span class="keywordtype">char</span> transparentFlag,
00056                           <span class="keywordtype">int</span> barColor, <span class="keywordtype">int</span> sliderColor ,<span class="keywordtype">int</span> dataFormat) {
00057     <a class="code" href="ALL_8H.html#a0">err_when</a>(minVal &gt;= maxVal || barWidth &lt; 0 || barHeight &lt; 0);
00058 
00059     bounded_slider_x1 = x1;
00060     bounded_slider_y1 = y1;
00061     bounded_slider_x2 = x1 + barWidth + 3;
00062     bounded_slider_y2 = y1 + barHeight + 2;
00063 
00064     bar_width = bounded_slider_x2 - bounded_slider_x1 - 8;
00065 
00066     slider_color = sliderColor;
00067     bar_color = barColor;
00068     data_fmt=dataFormat;
00069     result_flag=0;
00070     result_value=0;
00071     var_ptr = varPtr;
00072     <span class="keywordflow">if</span>(loPtr==<a class="code" href="OHELP_8H.html#a0">NULL</a>) {
00073         lo_ptr = &amp;dummy_zero;
00074         lower_bound_null_flag=1;
00075     }
00076     <span class="keywordflow">else</span> {
00077         lo_ptr = loPtr;
00078         lower_bound_null_flag=0;
00079     }
00080     up_ptr = upPtr;
00081     min_val = minVal;
00082     max_val = maxVal;
00083     val_range = maxVal - minVal;
00084 
00085     transparent_flag = transparentFlag;
00086     enable_flag=1;
00087 
00088 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00089 <span class="preprocessor"></span>    lock_max = lock_min = 0;
00090 <span class="preprocessor">#endif</span>
00091 <span class="preprocessor"></span>
00092     init_flag = 1;
00093 
00094     <span class="comment">//  paint();</span>
00095 }
00096 
00097 <span class="comment">//------------- End of function BoundedSlider::init -----------//</span>
00098 
00099 <span class="comment">//-------- Begin of function BoundedSlider::deinit ------------//</span>
<a name="l00101"></a><a class="code" href="classBoundedSlider.html#a3">00101</a> <span class="comment">void BoundedSlider::deinit() {</span>
00102     <span class="keywordflow">if</span> (bounded_slider_bitmap) {
00103         <a class="code" href="ALL_8H.html#a8">mem_del</a>(bounded_slider_bitmap);
00104         bounded_slider_bitmap = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00105     }
00106 
00107     init_flag = 0;
00108 }
00109 
00110 <span class="comment">//------------- End of function BoundedSlider::deinit ---------//</span>
00111 
00112 <span class="comment">//----------- Begin of function BoundedSlider::paint ----------//</span>
<a name="l00114"></a><a class="code" href="classBoundedSlider.html#a4">00114</a> <span class="comment">void BoundedSlider::paint() {</span>
00115     bounded_slider_bitmap = vga_back.save_area(bounded_slider_x1-15, bounded_slider_y1-6, bounded_slider_x2+20, bounded_slider_y2+6, bounded_slider_bitmap);
00116 
00117     paint_flag = 1;
00118 
00119     refresh();
00120 }
00121 
00122 <span class="comment">//------------- End of funcion BoundedSlider::paint -----------//</span>
00123 
00124 <span class="comment">//----------- Begin of function BoundedSlider::refresh --------//</span>
<a name="l00126"></a><a class="code" href="classBoundedSlider.html#a5">00126</a> <span class="comment">void BoundedSlider::refresh() {</span>
00127     <span class="comment">//  err_when(*var_ptr &gt; max_val);</span>
00128     <span class="comment">//  err_when(*var_ptr &lt; min_val);</span>
00129     <span class="comment">//  err_when(val_range &lt;= 0.0);</span>
00130 
00131     <span class="keywordtype">short</span> barWidth1 = 0;
00132     <span class="keywordtype">short</span> barWidth2 = 0;
00133     <span class="keywordtype">short</span> slidePos = 0;
00134     <span class="keywordtype">short</span> resSlidePos = 0;
00135 
00136     <span class="keywordflow">if</span>(val_range&gt;1e-5) {
00137         barWidth1 = short(<span class="keywordtype">double</span>(bar_width) * (*lo_ptr - min_val) / val_range);
00138         barWidth2 = short(<span class="keywordtype">double</span>(bar_width) * (*up_ptr - min_val) / val_range);
00139         slidePos = short(<span class="keywordtype">double</span>(bar_width) * (*var_ptr - min_val) / val_range);
00140         resSlidePos = short(<span class="keywordtype">double</span>(bar_width) * (result_value - min_val) / val_range);
00141     }
00142 
00143     <span class="keywordflow">if</span> (barWidth1 &lt; 0)
00144         barWidth1 = 0;
00145     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (barWidth1 &gt; barWidth2)
00146         barWidth1 = barWidth2;
00147 
00148     <span class="keywordflow">if</span> (barWidth2 &gt; bar_width)
00149         barWidth2 = bar_width;
00150     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (barWidth2 &lt; barWidth1)
00151         barWidth2 = barWidth1;
00152 
00153     <span class="comment">//  err_when(slidePos &gt; barWidth2 || slidePos &lt; barWidth1);</span>
00154 
00155     <span class="keywordflow">if</span>(slidePos &gt; barWidth2)slidePos=barWidth2;
00156     <span class="keywordflow">if</span>(slidePos &lt; barWidth1)slidePos=barWidth1;
00157     <span class="comment">//--------- draw the slider ----------//</span>
00158 
00159     vga_back.rest_area(bounded_slider_bitmap, 0, 0);
00160 
00161     <span class="keywordflow">if</span> (transparent_flag) {
00162         user_interface.brighten(bounded_slider_x1+3, bounded_slider_y1+3, bounded_slider_x2-2, bounded_slider_y2-2);
00163         user_interface.rect(bounded_slider_x1, bounded_slider_y1, bounded_slider_x2, bounded_slider_y2, 2);
00164     }
00165     <span class="keywordflow">else</span> {
00166         user_interface.bar(bounded_slider_x1, bounded_slider_y1, bounded_slider_x2, bounded_slider_y2);
00167         user_interface.panel(bounded_slider_x1+2, bounded_slider_y1+2, bounded_slider_x2-2, bounded_slider_y2-2);
00168     }
00169 
00170     <span class="comment">//----- paint the area inside the bound -----//</span>
00171 
00172     <span class="keywordflow">if</span> (barWidth2 &gt; barWidth1) {
00173         user_interface.bar(bounded_slider_x1+4+barWidth1, bounded_slider_y1+5,
00174                            bounded_slider_x1+4+barWidth2, bounded_slider_y2-3, bar_color);
00175     }
00176 
00177     <span class="comment">//-------- paint the slider pointer --------//</span>
00178     <span class="keywordtype">int</span> icolor;
00179     <span class="keywordflow">if</span>(highlight_indicator_flag==<a class="code" href="OBNDSLDR_8H.html#a4a1">INDICATOR</a>)
00180         icolor=<a class="code" href="COLOR_8H.html#a20">V_GREEN</a>;
00181     <span class="keywordflow">else</span>
00182         icolor=vga_back.translate_color(slider_color);
00183 
00184     vga_back.line(bounded_slider_x1+slidePos+3, bounded_slider_y1-2,
00185                   bounded_slider_x1+slidePos+3, bounded_slider_y2+4, icolor);
00186     vga_back.line(bounded_slider_x1+slidePos+3, bounded_slider_y1-2,
00187                   bounded_slider_x1+slidePos+5, bounded_slider_y1-2, icolor);
00188     vga_back.line(bounded_slider_x1+slidePos+3, bounded_slider_y2+4,
00189                   bounded_slider_x1+slidePos+5, bounded_slider_y2+4, icolor);
00190     vga_back.line(bounded_slider_x1+slidePos+5, bounded_slider_y1-2,
00191                   bounded_slider_x1+slidePos+5, bounded_slider_y2+4, icolor);
00192 
00193     <span class="keywordflow">if</span> (result_flag) {
00194         <span class="comment">//## chea 030999 bar draw here</span>
00195         <span class="comment">//## chea 030999 decided where the ribbon should be draw or not</span>
00196         <span class="keywordtype">int</span> draw = 1;
00197         <span class="keywordflow">if</span>(bounded_slider_x1 + 4 + resSlidePos &gt; bounded_slider_x2)
00198             draw = 0;
00199         <span class="keywordflow">if</span>(bounded_slider_x1 + 4 + resSlidePos &lt; bounded_slider_x1)
00200             draw = 0;
00201 
00202         <span class="keywordflow">if</span>(draw ==1) {
00203             user_interface.v_line(
00204                 bounded_slider_x1 + 4 + resSlidePos,
00205                 bounded_slider_y1 - 2,
00206                 bounded_slider_y2 - bounded_slider_y1 + 6,
00207                 1, <a class="code" href="COLOR_8H.html#a19">V_RED</a>,<a class="code" href="COLOR_8H.html#a19">V_RED</a>);                          <span class="comment">//## chea 030999 bar draw here</span>
00208         }
00209     }
00210 
00211     <span class="keywordflow">if</span>(highlight_indicator_flag==<a class="code" href="OBNDSLDR_8H.html#a4a3">UPPER</a>) {
00212         user_interface.bar(
00213             bounded_slider_x1+barWidth2-1,
00214             bounded_slider_y1+5,
00215             bounded_slider_x1+4+barWidth2,
00216             bounded_slider_y2-3,
00217             <a class="code" href="COLOR_8H.html#a20">V_GREEN</a>);
00218     }
00219     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(highlight_indicator_flag==<a class="code" href="OBNDSLDR_8H.html#a4a2">LOWER</a>) {
00220         user_interface.bar(
00221             bounded_slider_x1+4+barWidth1,
00222             bounded_slider_y1+5,
00223             bounded_slider_x1+barWidth1+9,
00224             bounded_slider_y2-3,
00225             <a class="code" href="COLOR_8H.html#a20">V_GREEN</a>);
00226     }
00227 
00228     <span class="keywordflow">if</span> (enable_flag==0)
00229         user_interface.darken(bounded_slider_x1, bounded_slider_y1, bounded_slider_x2+3, bounded_slider_y2+2);
00230 
00231     <span class="comment">//  font_small_san.put(bounded_slider_x1-4, bounded_slider_y1-8,m.format(min_val,data_fmt));</span>
00232     <span class="comment">//  font_small_san.put(bounded_slider_x2-12, bounded_slider_y1-8,m.format(max_val,data_fmt));</span>
00233     <span class="comment">//  font_small_san.put(bounded_slider_x1+slidePos+7, bounded_slider_y1-6, m.format(*var_ptr,data_fmt));</span>
00234 
00235     font_news.put(bounded_slider_x1-4, bounded_slider_y1-8,m.format(min_val,data_fmt));
00236     font_news.put(bounded_slider_x2-12, bounded_slider_y1-8,m.format(max_val,data_fmt));
00237 
00238     font_blue_san.put(bounded_slider_x1+slidePos-7,
00239                       (bounded_slider_y1+bounded_slider_y2)/2-6,
00240                       m.format(*var_ptr,data_fmt));
00241 
00242     <span class="keywordflow">if</span> (!paint_flag)
00243         vga.blt_buf(bounded_slider_x1-15, bounded_slider_y1-6, bounded_slider_x2+20, bounded_slider_y2+6);
00244     <span class="keywordflow">else</span>
00245         paint_flag = 0;
00246 }
00247 
00248 <span class="comment">//------------- End of function BoundedSlider::refresh ---------//</span>
00249 
00250 <span class="comment">//----------- Begin of function BoundedSlider::detect ----------//</span>
<a name="l00255"></a><a class="code" href="classBoundedSlider.html#a6">00255</a> <span class="comment">int BoundedSlider::detect() {</span>
00256 
00257     <span class="keywordflow">if</span> (!init_flag)
00258         <span class="keywordflow">return</span> 0;
00259 
00260     <span class="keywordflow">if</span> (!enable_flag)
00261         <span class="keywordflow">return</span> 0;
00262 
00263     <span class="comment">//  Notes:  cursor update is temporary disabled since cursor</span>
00264     <span class="comment">//                          resources are currently not available</span>
00265     <span class="comment">//                          curosr update code not tested</span>
00266     <span class="comment">// Norris 0716</span>
00267 
00268     <span class="keywordtype">short</span> sliderPos, loPos, upPos;
00269 
00270     <span class="comment">/*</span>
00271 <span class="comment">      static int old_cursor;</span>
00272 <span class="comment">      static char cursor_flag = 0;</span>
00273 <span class="comment"></span>
00274 <span class="comment">      //---- Cursor update -----//</span>
00275 <span class="comment"></span>
00276 <span class="comment">      char posDetected = 0;</span>
00277 <span class="comment"></span>
00278 <span class="comment">      if (mouse.in_area(bounded_slider_x1-2, bounded_slider_y1-3, bounded_slider_x2+2, bounded_slider_y2+2))</span>
00279 <span class="comment">      {</span>
00280 <span class="comment">      sliderPos = bounded_slider_x1 + int(double(bar_width) * (*var_ptr - min_val) / val_range) - 2;</span>
00281 <span class="comment">      loPos = bounded_slider_x1 + int(double(bar_width) * (*lo_ptr - min_val) / val_range) - 2;</span>
00282 <span class="comment">      upPos = bounded_slider_x1 + int(double(bar_width) * (*up_ptr - min_val) / val_range) - 2;</span>
00283 <span class="comment">      posDetected = 1;</span>
00284 <span class="comment"></span>
00285 <span class="comment">      if (!cursor_flag)</span>
00286 <span class="comment">      {</span>
00287 <span class="comment">      if (  mouse.in_area(sliderPos, bounded_slider_y1-3, sliderPos+4, bounded_slider_y2+2)</span>
00288 <span class="comment">      || mouse.in_area(loPos, bounded_slider_y1-5, loPos+4, bounded_slider_y2+2)</span>
00289 <span class="comment">      || mouse.in_area(upPos, bounded_slider_y1-5, upPos+4, bounded_slider_y2+2))</span>
00290 <span class="comment">      {</span>
00291 <span class="comment">      old_cursor = mouse_cursor.get_icon();</span>
00292 <span class="comment">      mouse_cursor.set_icon(CURSOR_UNIT);                       // temporary cursor</span>
00293 <span class="comment">      cursor_flag = 1;</span>
00294 <span class="comment">      }</span>
00295 <span class="comment">      }</span>
00296 <span class="comment">      else</span>
00297 <span class="comment">      {</span>
00298 <span class="comment">      if (  !mouse.in_area(sliderPos, bounded_slider_y1-3, sliderPos+4, bounded_slider_y2+2)</span>
00299 <span class="comment">      &amp;&amp; !mouse.in_area(loPos, bounded_slider_y1-5, loPos+4, bounded_slider_y2+2)</span>
00300 <span class="comment">      &amp;&amp; !mouse.in_area(upPos, bounded_slider_y1-5, upPos+4, bounded_slider_y2+2))</span>
00301 <span class="comment">      {</span>
00302 <span class="comment">      mouse_cursor.set_icon(old_cursor);</span>
00303 <span class="comment">      cursor_flag = 0;</span>
00304 <span class="comment">      }</span>
00305 <span class="comment">      }</span>
00306 <span class="comment">      }</span>
00307 <span class="comment">      else if (cursor_flag)</span>
00308 <span class="comment">      {</span>
00309 <span class="comment">      mouse_cursor.set_icon(old_cursor);</span>
00310 <span class="comment">      cursor_flag = 0;</span>
00311 <span class="comment">      }</span>
00312 <span class="comment">    */</span>
00313 
00314     <span class="comment">//---- Mouse clicked on the slider----//</span>
00315 
00316     <span class="comment">//  if (!mouse.press_area(bounded_slider_x1, bounded_slider_y1-2, bounded_slider_x2, bounded_slider_y2+2, 0))</span>
00317     <span class="comment">//          return 0;</span>
00318 
00319     <span class="comment">//  if (!posDetected)</span>
00320     <span class="comment">//  {</span>
00321     sliderPos = bounded_slider_x1 + short(<span class="keywordtype">double</span>(bar_width) * (*var_ptr - min_val) / val_range);
00322     loPos = bounded_slider_x1 + short(<span class="keywordtype">double</span>(bar_width) * (*lo_ptr - min_val) / val_range);
00323     upPos = bounded_slider_x1 + short(<span class="keywordtype">double</span>(bar_width) * (*up_ptr - min_val) / val_range);
00324     <span class="comment">//  }</span>
00325 
00326     <span class="comment">//---- Variable update? ----//</span>
00327 
00328 <span class="preprocessor">#define SENSITIVE_RANGE 6</span>
00329 <span class="preprocessor"></span>
00330     <span class="keywordflow">if</span> (mouse.press_area(sliderPos-SENSITIVE_RANGE, bounded_slider_y1-2, sliderPos+SENSITIVE_RANGE, bounded_slider_y2+6, 0)) {
00331         <span class="keywordtype">double</span> lastVar = *var_ptr;
00332         <span class="keywordflow">while</span> (mouse.left_press) {
00333             sys.yield();
00334             mouse.get_event();
00335             sys.blt_virtual_buf();
00336 
00337             *var_ptr = double(mouse.cur_x-bounded_slider_x1-4) / double(bar_width) * val_range + min_val;
00338 
00339             <span class="keywordflow">if</span> (upPos - loPos &lt; 6) {
00340                 <span class="keywordflow">if</span> (*var_ptr &lt; min_val)
00341                     *var_ptr = min_val;
00342                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*var_ptr &gt; max_val)
00343                     *var_ptr = max_val;
00344 
00345 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00346 <span class="preprocessor"></span>                <span class="keywordflow">if</span>( lock_min ) {
00347                     <span class="keywordflow">if</span> (*lo_ptr &gt; *var_ptr)
00348                         *var_ptr = *lo_ptr;                   <span class="comment">// *lo_ptr can't change when locked</span>
00349                 }
00350                 <span class="keywordflow">if</span>( lock_max ) {
00351                     <span class="keywordflow">if</span> (*up_ptr &lt; *var_ptr)
00352                         *var_ptr = *up_ptr;                   <span class="comment">// *up_ptr can't change when locked</span>
00353                 }
00354 <span class="preprocessor">#endif</span>
00355 <span class="preprocessor"></span>
00356                 <span class="keywordflow">if</span> (*lo_ptr &gt; *var_ptr)
00357                     *lo_ptr = *var_ptr;
00358                 <span class="keywordflow">if</span> (*up_ptr &lt; *var_ptr)
00359                     *up_ptr = *var_ptr;
00360                 <span class="keywordflow">if</span> (*up_ptr &lt; *lo_ptr) {
00361                     *up_ptr = *lo_ptr = *var_ptr;
00362                     lastVar = *var_ptr+1;
00363                 }
00364             }
00365             <span class="keywordflow">else</span> {
00366                 <span class="keywordflow">if</span> (*var_ptr &lt; *lo_ptr)
00367                     *var_ptr = *lo_ptr;
00368                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*var_ptr &gt; *up_ptr)
00369                     *var_ptr = *up_ptr;
00370 
00371                 <span class="keywordflow">if</span> (*up_ptr &lt; *lo_ptr) {
00372                     *up_ptr = *lo_ptr = *var_ptr;
00373                     lastVar = *var_ptr+1;
00374                 }
00375             }
00376 
00377             <span class="keywordflow">if</span> (lastVar != *var_ptr)
00378                 refresh();
00379         }
00380         <span class="keywordflow">return</span> 1;
00381     }
00382 
00383     <span class="keywordflow">if</span>(highlight_indicator_flag!=<a class="code" href="OBNDSLDR_8H.html#a4a1">INDICATOR</a>)
00384         <span class="keywordflow">if</span>(mouse.in_area(sliderPos-SENSITIVE_RANGE, bounded_slider_y1-2, sliderPos+SENSITIVE_RANGE, bounded_slider_y2+6)) {
00385             highlight_indicator_flag=<a class="code" href="OBNDSLDR_8H.html#a4a1">INDICATOR</a>;
00386             refresh();
00387             <span class="keywordflow">return</span> 0;
00388         }
00389     <span class="comment">//---- Lower bound update? ----//</span>
00390     <span class="keywordflow">if</span>(lower_bound_null_flag==0) {
00391 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00392 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ( !lock_min )
00393 <span class="preprocessor">#endif</span>
00394 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (mouse.press_area(loPos-SENSITIVE_RANGE, bounded_slider_y1-2, loPos+SENSITIVE_RANGE, bounded_slider_y2+2, 0)) {
00395                 <span class="keywordtype">double</span> lastVar = *lo_ptr;
00396                 <span class="keywordflow">while</span> (mouse.left_press) {
00397                     sys.yield();
00398                     mouse.get_event();
00399                     sys.blt_virtual_buf();
00400 
00401                     *lo_ptr = double(mouse.cur_x-bounded_slider_x1-4) / double(bar_width) * val_range + min_val;
00402 
00403                     <span class="keywordflow">if</span> (*lo_ptr &lt; min_val)
00404                         *lo_ptr = min_val;
00405                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*lo_ptr &gt; *var_ptr)
00406                         *lo_ptr = *var_ptr;
00407 
00408                     <span class="keywordflow">if</span> (*up_ptr &lt; *lo_ptr) {
00409                         *up_ptr = *lo_ptr = *var_ptr;
00410                         lastVar = *lo_ptr+1;
00411                     }
00412 
00413                     <span class="keywordflow">if</span> (lastVar != *lo_ptr)
00414                         refresh();
00415                 }
00416                 <span class="keywordflow">return</span> 1;
00417             }
00418 
00419         <span class="keywordflow">if</span>(highlight_indicator_flag!=<a class="code" href="OBNDSLDR_8H.html#a4a2">LOWER</a>)
00420             <span class="keywordflow">if</span>(mouse.in_area(loPos-SENSITIVE_RANGE, bounded_slider_y1-2, loPos+SENSITIVE_RANGE, bounded_slider_y2+2)) {
00421                 highlight_indicator_flag=<a class="code" href="OBNDSLDR_8H.html#a4a2">LOWER</a>;
00422                 refresh();
00423                 <span class="keywordflow">return</span> 0;
00424             }
00425     }
00426     <span class="comment">//---- Upper bound update? ----//</span>
00427 
00428     <span class="keywordflow">if</span> (mouse.press_area(upPos-SENSITIVE_RANGE, bounded_slider_y1-2, upPos+SENSITIVE_RANGE, bounded_slider_y2+2, 0)) {
00429 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00430 <span class="preprocessor"></span>        <span class="keywordflow">if</span>( !lock_max ) {
00431 <span class="preprocessor">#endif</span>
00432 <span class="preprocessor"></span>            <span class="keywordtype">double</span> lastVar = *up_ptr;
00433             <span class="keywordflow">while</span> (mouse.left_press) {
00434                 sys.yield();
00435                 mouse.get_event();
00436                 sys.blt_virtual_buf();
00437 
00438                 *up_ptr = double(mouse.cur_x-bounded_slider_x1-4) / double(bar_width) * val_range + min_val;
00439 
00440                 <span class="keywordflow">if</span> (*up_ptr &lt; *var_ptr)
00441                     *up_ptr = *var_ptr;
00442                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*up_ptr &gt; max_val)
00443                     *up_ptr = max_val;
00444 
00445                 <span class="keywordflow">if</span> (*up_ptr &lt; *lo_ptr) {
00446                     *up_ptr = *lo_ptr = *var_ptr;
00447                     lastVar = *up_ptr+1;
00448                 }
00449 
00450                 <span class="keywordflow">if</span> (lastVar != *up_ptr)
00451                     refresh();
00452             }
00453 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00454 <span class="preprocessor"></span>        }
00455 <span class="preprocessor">#endif</span>
00456 <span class="preprocessor"></span>        <span class="keywordflow">return</span> 1;
00457     }
00458 
00459     <span class="keywordflow">if</span>(highlight_indicator_flag!=<a class="code" href="OBNDSLDR_8H.html#a4a3">UPPER</a>)
00460         <span class="keywordflow">if</span> (mouse.in_area(upPos-SENSITIVE_RANGE, bounded_slider_y1-2, upPos+SENSITIVE_RANGE, bounded_slider_y2+2)) {
00461             highlight_indicator_flag=<a class="code" href="OBNDSLDR_8H.html#a4a3">UPPER</a>;
00462             refresh();
00463             <span class="keywordflow">return</span> 0;
00464         }
00465     highlight_indicator_flag=NONE;
00466     <span class="keywordflow">return</span> 0;
00467 }
00468 
00469 <span class="comment">//------------- End of function BoundedSlider::detect ----------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:16 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
