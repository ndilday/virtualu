<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OLOG.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>OLOG.CPP</h1><a href="OLOG_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">// Filename    : OLOG.CPP</span>
00002 <span class="comment">// Description : logging class</span>
00003 <span class="comment">// Owner       : Gilbert</span>
00004 
00005 <span class="preprocessor">#include &lt;<a class="code" href="OLOG_8H.html">OLOG.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;STDIO.H&gt;</span>
00007 <span class="preprocessor">#include &lt;<a class="code" href="OFILE_8H.html">OFILE.H</a>&gt;</span>
00008 
00009 <span class="comment">// -------- begin of function Log::Log ----------//</span>
<a name="l00010"></a><a class="code" href="classLog.html#a0">00010</a> <a class="code" href="classLog.html#a0">Log::Log</a>() {
00011 }
00012 
00013 <span class="comment">// -------- end of function Log::Log ----------//</span>
00014 
<a name="l00015"></a><a class="code" href="classLog.html#a1">00015</a> <a class="code" href="classLog.html#a1">Log::~Log</a>() {
00016 }
00017 
00018 <span class="comment">// -------- begin of function Log::mark_begin ----------//</span>
<a name="l00019"></a><a class="code" href="classLog.html#a2">00019</a> <span class="keywordtype">void</span> <a class="code" href="classLog.html#a2">Log::mark_begin</a>() {
00020     <span class="comment">// text_buffer[0] stores the latest log</span>
00021     text_buffer[0].<a class="code" href="classVLenQueue.html#a5">clear</a>();
00022     *(text_buffer[0].<a class="code" href="classVLenQueue.html#a6">reserve</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>))) = <span class="charliteral">'\0'</span>; <span class="comment">// put a null character in the buffer</span>
00023 }
00024 
00025 <span class="comment">// -------- end of function Log::mark_begin ----------//</span>
00026 
00027 <span class="comment">// -------- begin of function Log::mark_end ----------//</span>
<a name="l00028"></a><a class="code" href="classLog.html#a3">00028</a> <span class="keywordtype">void</span> <a class="code" href="classLog.html#a3">Log::mark_end</a>() {
00029     <span class="comment">// enable next line to trace hang</span>
00030     <span class="comment">// dump();</span>
00031 
00032     <span class="comment">// rotate buffers</span>
00033     text_buffer[LOG_VERSION-1].clear();
00034     <span class="comment">// put a null character in the buffer</span>
00035     *(text_buffer[LOG_VERSION-1].reserve(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>))) = <span class="charliteral">'\0'</span>;
00036     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> n = LOG_VERSION-1; n &gt; 0; --n) {
00037         text_buffer[n].<a class="code" href="classVLenQueue.html#a8">swap</a>(text_buffer[n-1]);
00038     }
00039 }
00040 
00041 <span class="comment">// -------- end of function Log::mark_end ----------//</span>
00042 
00043 <span class="comment">// -------- begin of function Log::mark ----------//</span>
<a name="l00044"></a><a class="code" href="classLog.html#a4">00044</a> <span class="keywordtype">void</span> <a class="code" href="classLog.html#a4">Log::mark</a>(<span class="keywordtype">char</span> *msg, <span class="keywordtype">char</span> *file, <span class="keywordtype">int</span> line) {
00045     log_text = msg;
00046     log_file = file;
00047     log_line = line;
00048 
00049     <a class="code" href="classString.html">String</a> t(log_text);
00050     t += <span class="stringliteral">"\r\n"</span>;
00051     strcpy( text_buffer[0].reserve(t.<a class="code" href="classString.html#a5">len</a>())-1, t ); <span class="comment">// minus 1 to remove the '\0' at the end</span>
00052 }
00053 
00054 <span class="comment">// -------- end of function Log::mark ----------//</span>
00055 
00056 <span class="comment">// -------- begin of function Log::mark ----------//</span>
<a name="l00057"></a><a class="code" href="classLog.html#a5">00057</a> <span class="keywordtype">void</span> <a class="code" href="classLog.html#a4">Log::mark</a>(<span class="keywordtype">int</span> n , <span class="keywordtype">char</span> *file, <span class="keywordtype">int</span> line) {
00058     log_text = n;
00059     log_file = file;
00060     log_line = line;
00061 
00062     <a class="code" href="classString.html">String</a> t(log_text);
00063     t += <span class="stringliteral">"\r\n"</span>;
00064     strcpy( text_buffer[0].reserve(t.<a class="code" href="classString.html#a5">len</a>())-1, t );
00065 }
00066 
00067 <span class="comment">// -------- end of function Log::mark ----------//</span>
00068 
00069 <span class="comment">// -------- begin of function Log::dump ----------//</span>
<a name="l00070"></a><a class="code" href="classLog.html#a6">00070</a> <span class="keywordtype">void</span> <a class="code" href="classLog.html#a6">Log::dump</a>() {
00071     <span class="comment">// write old_buffer</span>
00072     <span class="keywordtype">char</span> filename[20];
00073     strcpy(filename, <span class="stringliteral">"AM_A.LOG"</span>);
00074     <a class="code" href="classFile.html">File</a> f;
00075     <span class="comment">// AM_A.LOG, AM_B.LOG ...</span>
00076     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> n = LOG_VERSION-1; n &gt;= 0; --n, filename[3]++) {
00077         f.<a class="code" href="classFile.html#a3">file_create</a>(filename);
00078         f.<a class="code" href="classFile.html#a10">file_write</a>( text_buffer[n].queue_buf, text_buffer[n].length() );
00079         f.<a class="code" href="classFile.html#a5">file_close</a>();
00080     }
00081 }
00082 
00083 <span class="comment">// -------- end of function Log::dump ----------//</span>
00084 
00085 <span class="comment">// -------- begin of function Log::debug_log ----------//</span>
<a name="l00086"></a><a class="code" href="classLog.html#d0">00086</a> <span class="keywordtype">void</span> <a class="code" href="classLog.html#d0">Log::debug_log</a>(<span class="keywordtype">char</span> *msg) {
00087     <a class="code" href="classString.html">String</a> s;
00088     s = msg;
00089     s += <span class="stringliteral">"\r\n"</span>;
00090     OutputDebugString(s);
00091 }
00092 
<a name="l00093"></a><a class="code" href="classLog.html#d1">00093</a> <span class="keywordtype">void</span> <a class="code" href="classLog.html#d0">Log::debug_log</a>(<span class="keywordtype">int</span> n) {
00094     <a class="code" href="classString.html">String</a> s;
00095     s = n;
00096     s += <span class="stringliteral">"\r\n"</span>;
00097     OutputDebugString(s);
00098 }
00099 
00100 <span class="comment">// -------- end of function Log::debug_log ----------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:03 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
