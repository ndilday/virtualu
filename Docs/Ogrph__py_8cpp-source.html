<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Ogrph_py.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Ogrph_py.cpp</h1><a href="Ogrph__py_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OGRPH_PY.CPP</span>
00002 <span class="comment">//Description : Object GraphPerformanceIndicatorYear</span>
00003 <span class="comment">//Owner                 : Kevin(Ho)</span>
00004 
00005 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;<a class="code" href="COLOR_8H.html">COLOR.H</a>&gt;</span>
00007 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>
00008 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00010 <span class="preprocessor">#include &lt;OFONT.H&gt;</span>
00011 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00012 <span class="preprocessor">#include &lt;<a class="code" href="OGRPH__PY_8H.html">OGRPH_PY.H</a>&gt;</span>
00013 <span class="preprocessor">#include &lt;OIFACE.H&gt;</span>
00014 
00015 <span class="preprocessor">#include &lt;math.h&gt;</span>
00016 
00017 <span class="comment">//--------- Define macro constant -----------//</span>
00018 
<a name="l00019"></a><a class="code" href="Ogrph__py_8cpp.html#a0">00019</a> <span class="preprocessor">#define MAX_LEN_LABEL "0%"</span>
00020 <span class="preprocessor"></span>
00021 <span class="keyword">static</span> <span class="keywordtype">int</span> default_series_color[] = {
00022     <a class="code" href="COLOR_8H.html#a21">V_BLUE</a>,
00023     <a class="code" href="COLOR_8H.html#a20">V_GREEN</a>,
00024     <a class="code" href="COLOR_8H.html#a19">V_RED</a>,
00025     <a class="code" href="COLOR_8H.html#a25">V_YELLOW</a>,
00026     <a class="code" href="COLOR_8H.html#a22">V_VIOLET</a>,
00027     <a class="code" href="COLOR_8H.html#a23">V_BROWN</a>,
00028     <a class="code" href="COLOR_8H.html#a18">V_ORANGE</a>,
00029     <a class="code" href="COLOR_8H.html#a24">V_PINK</a>,
00030     <a class="code" href="COLOR_8H.html#a15">V_BLACK</a>,
00031     <a class="code" href="COLOR_8H.html#a17">V_WHITE</a>,
00032 };                                                <span class="comment">// 10 default series colors</span>
00033 
00034 <span class="keyword">enum</span> {  <a class="code" href="Ogrph__py_8cpp.html#a7a2">DEFAULT_SERIES_COLOR_NUM</a> = 10 };
00035 
00036 <span class="keyword">enum</span> {
00037     <a class="code" href="Ogrph__py_8cpp.html#a8a3">LEGEND_SIZE</a> = 11,
00038     <a class="code" href="Ogrph__py_8cpp.html#a8a4">LEGEND_X_SPACING</a> = 12,
00039     <a class="code" href="Ogrph__py_8cpp.html#a8a5">LEGEND_Y_SPACING</a> = 2,
00040 };
00041 
00042 <span class="keyword">enum</span> {  <a class="code" href="Ogrph__py_8cpp.html#a9a6">COMMON_OFFSET</a> = 2         };
00043 
00044 <span class="comment">//-------------- Define static vars ------------//</span>
00045 
00046 <span class="comment">//static char paint_flag = 0;</span>
00047 
00048 <span class="comment">//-------- Begin of function GraphPerformanceIndicatorYear::GraphPerformanceIndicatorYear ----//</span>
<a name="l00050"></a><a class="code" href="classGraphPerformanceIndicatorYear.html#a0">00050</a> <span class="comment">GraphPerformanceIndicatorYear::GraphPerformanceIndicatorYear() {</span>
00051     init_flag = 0;
00052     grapha_bitmap = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00053 }
00054 
00055 <span class="comment">//---------- End of function GraphPerformanceIndicatorYear::GraphPerformanceIndicatorYear ----//</span>
00056 
00057 <span class="comment">//-------- Begin of function GraphPerformanceIndicatorYear::~GraphPerformanceIndicatorYear -----//</span>
<a name="l00059"></a><a class="code" href="classGraphPerformanceIndicatorYear.html#a1">00059</a> <span class="comment">GraphPerformanceIndicatorYear::~GraphPerformanceIndicatorYear() {</span>
00060     deinit();
00061 }
00062 
00063 <span class="comment">//---------- End of function GraphPerformanceIndicatorYear::~GraphPerformanceIndicatorYear -----//</span>
00064 
00065 <span class="comment">//-------- Begin of function GraphPerformanceIndicatorYear::init --------//</span>
00088 <span class="comment">void GraphPerformanceIndicatorYear::init(int x1, int y1, int x2, int y2,</span>
00089                                          <span class="keywordtype">int</span> seriesNum, <span class="keywordtype">int</span> *dataNum,
00090                                          <span class="keywordtype">void</span> *dataArray,
00091                                          <span class="keywordtype">char</span> dataTypeFlag,
00092                                          <span class="keywordtype">char</span> transparentFlag,
00093                                          <span class="keywordtype">char</span> valueFlag,
00094                                          <span class="keywordtype">int</span> numFormat, <span class="keywordtype">int</span> *seriesColor, <span class="keywordtype">int</span> axisColor) {
00095     <a class="code" href="ALL_8H.html#a0">err_when</a>(seriesNum &gt; <a class="code" href="Ogrph__py_8cpp.html#a7a2">DEFAULT_SERIES_COLOR_NUM</a> &amp;&amp; !seriesColor);
00096     <a class="code" href="ALL_8H.html#a0">err_when</a>(seriesNum &lt;= 0);
00097 
00098     graph_width = x2 - x1 - 6;
00099 
00100     <a class="code" href="ALL_8H.html#a0">err_when</a>(graph_width &lt; 0);
00101 
00102     grapha_x1 = x1;
00103     grapha_y1 = y1;
00104     grapha_x2 = x2;
00105     grapha_y2 = y2;
00106     series_num = seriesNum;
00107     data_num = dataNum;
00108     data_array = dataArray;
00109     data_type_flag = dataTypeFlag;
00110     transparent_flag = transparentFlag;
00111     value_flag = valueFlag;
00112     num_format = numFormat;
00113     series_color = seriesColor ? seriesColor : default_series_color;
00114     axis_color = axisColor;
00115 
00116     init_flag = 1;
00117 
00118     <span class="keywordflow">if</span>(value_flag)
00119         y_label_max_len = font_chartsm.text_width(<a class="code" href="Ogrph__py_8cpp.html#a0">MAX_LEN_LABEL</a>);
00120     <span class="keywordflow">else</span>
00121         y_label_max_len = 0;
00122     set_font(&amp;font_chartsm);
00123 
00124 }
00125 
00126 <span class="comment">//------------- End of function GraphPerformanceIndicatorYear::init -----------//</span>
00127 
00128 <span class="comment">//-------- Begin of function GraphPerformanceIndicatorYear::deinit ------------//</span>
<a name="l00130"></a><a class="code" href="classGraphPerformanceIndicatorYear.html#a7">00130</a> <span class="comment">void GraphPerformanceIndicatorYear::deinit() {</span>
00131     <span class="keywordflow">if</span> (grapha_bitmap) {
00132         <a class="code" href="ALL_8H.html#a8">mem_del</a>(grapha_bitmap);
00133         grapha_bitmap = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00134     }
00135 
00136     init_flag = 0;
00137 }
00138 
00139 <span class="comment">//------------- End of function GraphPerformanceIndicatorYear::deinit ---------//</span>
00140 
00141 <span class="comment">//-------- Begin of function GraphPerformanceIndicatorYear::set_font ------------//</span>
<a name="l00143"></a><a class="code" href="classGraphPerformanceIndicatorYear.html#a10">00143</a> <span class="comment">void GraphPerformanceIndicatorYear::set_font(Font *fontPtr) {</span>
00144     <span class="keywordflow">if</span> (!init_flag)
00145         <span class="keywordflow">return</span>;
00146 
00147     font_ptr = fontPtr;
00148 
00149     calc_pos();
00150 }
00151 
00152 <span class="comment">//------------- End of function GraphPerformanceIndicatorYear::set_font ---------//</span>
00153 
00154 <span class="comment">//-------- Begin of function GraphPerformanceIndicatorYear::calc_pos ------------//</span>
<a name="l00159"></a><a class="code" href="classGraphPerformanceIndicatorYear.html#a11">00159</a> <span class="comment">void GraphPerformanceIndicatorYear::calc_pos() {</span>
00160     graph_height = grapha_y2 - grapha_y1 ;
00161     <span class="keywordtype">short</span> YLabelWidth =  -<a class="code" href="Ogrph__py_8cpp.html#a9a6">COMMON_OFFSET</a>;
00162     <span class="keywordtype">short</span> XLabelHeight = -<a class="code" href="Ogrph__py_8cpp.html#a9a6">COMMON_OFFSET</a>;
00163     series_x1 = grapha_x1 + 4 + <a class="code" href="Ogrph__py_8cpp.html#a9a6">COMMON_OFFSET</a>*2;
00164     series_y1 = grapha_y1 + 4 + <a class="code" href="Ogrph__py_8cpp.html#a9a6">COMMON_OFFSET</a>*4;
00165     series_x2 = grapha_x2 - 4 - <a class="code" href="Ogrph__py_8cpp.html#a9a6">COMMON_OFFSET</a>*2;
00166     series_y2 = grapha_y1 + graph_height - <a class="code" href="Ogrph__py_8cpp.html#a9a6">COMMON_OFFSET</a>*2;
00167 }
00168 
00169 <span class="comment">//------------ End of function GraphPerformanceIndicatorYear::calc_pos ---------//</span>
00170 
00171 <span class="comment">//-------- Begin of function GraphPerformanceIndicatorYear::paint --------------//</span>
<a name="l00173"></a><a class="code" href="classGraphPerformanceIndicatorYear.html#a8">00173</a> <span class="comment">void GraphPerformanceIndicatorYear::paint() {</span>
00174     <span class="keywordflow">if</span> (transparent_flag) {
00175         vga.use_back();
00176 
00177         user_interface.brighten(grapha_x1+4, grapha_y1+4, grapha_x2-2, grapha_y2-2);
00178         grapha_bitmap = vga_back.save_area(grapha_x1+4, grapha_y1+4, grapha_x2-2, grapha_y2-2, grapha_bitmap);
00179     }
00180     <span class="comment">//  paint_flag = 1;</span>
00181     refresh();
00182 }
00183 
00184 <span class="comment">//------------- End of function GraphPerformanceIndicatorYear::paint -----------//</span>
00185 
00186 <span class="comment">//-------- Begin of function GraphPerformanceIndicatorYear::refresh ------------//</span>
<a name="l00188"></a><a class="code" href="classGraphPerformanceIndicatorYear.html#a9">00188</a> <span class="comment">void GraphPerformanceIndicatorYear::refresh() {</span>
00189     <span class="comment">//  vga.use_back();</span>
00190 
00191     <span class="keywordflow">if</span> (transparent_flag) {
00192         user_interface.rect(grapha_x1, grapha_y1, grapha_x2, grapha_y2, 1);
00193         vga_back.rest_area(grapha_bitmap, 0, 0);
00194     }
00195     <span class="keywordflow">else</span> {
00196         user_interface.bar(grapha_x1, grapha_y1, grapha_x2, grapha_y2);
00197         user_interface.panel(grapha_x1+3, grapha_y1+3, grapha_x2-4, grapha_y2-4);
00198     }
00199     draw_scale();
00200     draw_series();
00201 
00202     <span class="comment">//  if (!paint_flag)</span>
00203     <span class="comment">//          vga.blt_buf(grapha_x1, grapha_y1, grapha_x2+2, grapha_y2+2);</span>
00204     <span class="comment">//  else</span>
00205     <span class="comment">//          paint_flag = 0;</span>
00206 }
00207 
00208 <span class="comment">//------------- End of function GraphPerformanceIndicatorYear::refresh ---------//</span>
00209 
00210 <span class="comment">//---------- Begin of function GraphPerformanceIndicatorYear::find_scale -------------//</span>
<a name="l00212"></a><a class="code" href="classGraphPerformanceIndicatorYear.html#b0">00212</a> <span class="comment">void GraphPerformanceIndicatorYear::find_scale() {</span>
00213     <span class="keywordtype">double</span> data, maxVal = 0.0;
00214     x_axis_pos = 0;
00215 
00216     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num * *data_num; i++) {
00217         <span class="keywordflow">switch</span> (data_type_flag) {
00218         <span class="keywordflow">case</span> DATA_DOUBLE:
00219             data = ((<span class="keywordtype">double</span>*)data_array)[i];
00220             <span class="keywordflow">break</span>;
00221         <span class="keywordflow">case</span> DATA_FLOAT:
00222             data = double(((<span class="keywordtype">float</span>*)data_array)[i]);
00223             <span class="keywordflow">break</span>;
00224         <span class="keywordflow">case</span> DATA_INT:
00225             data = double(((<span class="keywordtype">int</span>*)data_array)[i]);
00226             <span class="keywordflow">break</span>;
00227         <span class="keywordflow">case</span> DATA_LONG:
00228             data = double(((<span class="keywordtype">long</span>*)data_array)[i]);
00229             <span class="keywordflow">break</span>;
00230         }
00231         <span class="keywordflow">if</span> (<a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(data) &gt; maxVal)
00232             maxVal = <a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(data);
00233         <span class="keywordflow">if</span> (!x_axis_pos &amp;&amp; data &lt; 0.0)
00234             x_axis_pos = 1;
00235     }
00236     <span class="keywordflow">if</span> (maxVal&gt;10)
00237         max_scale = maxVal;
00238     <span class="keywordflow">else</span>
00239         max_scale = 10;
00240 }
00241 
00242 <span class="comment">//------------ End of function GraphPerformanceIndicatorYear::find_scale -------------//</span>
00243 
00244 <span class="comment">//---------- Begin of function GraphPerformanceIndicatorYear::draw_scale -------------//</span>
<a name="l00246"></a><a class="code" href="classGraphPerformanceIndicatorYear.html#b1">00246</a> <span class="comment">void GraphPerformanceIndicatorYear::draw_scale() {</span>
00247     find_scale();
00248     <span class="comment">//------ Draw y-axis -------//</span>
00249 
00250     <span class="keywordflow">if</span> (x_axis_pos)
00251         vga_back.bar(series_x1, series_y1-<a class="code" href="Ogrph__py_8cpp.html#a9a6">COMMON_OFFSET</a>*2, series_x1+1, series_y2+<a class="code" href="Ogrph__py_8cpp.html#a9a6">COMMON_OFFSET</a>*2, axis_color);
00252     <span class="keywordflow">else</span>
00253         vga_back.bar(series_x1, series_y1-<a class="code" href="Ogrph__py_8cpp.html#a9a6">COMMON_OFFSET</a>*2, series_x1+1, series_y2, axis_color);
00254 
00255     <span class="comment">//------ Draw x-axis -------//</span>
00256     <span class="keywordtype">int</span> currY;
00257     <span class="keywordflow">if</span> (x_axis_pos)
00258         currY = series_y2 - short(((<span class="keywordtype">float</span>(max_scale)) * <span class="keywordtype">float</span>(series_y2-series_y1) / <span class="keywordtype">float</span>(max_scale*2)));
00259     <span class="keywordflow">else</span>
00260         currY = series_y2;
00261 
00262     <span class="comment">//  if (x_axis_pos)</span>
00263     <span class="comment">//          vga_back.bar(series_x1, series_y2+COMMON_OFFSET*2, series_x2-COMMON_OFFSET, series_y2+COMMON_OFFSET*2+1, axis_color);</span>
00264     <span class="comment">//  else</span>
00265     vga_back.bar(series_x1, currY, series_x2-<a class="code" href="Ogrph__py_8cpp.html#a9a6">COMMON_OFFSET</a>, currY+1, axis_color);
00266 
00267     x_axis_step = (double)(series_x2-series_x1) / (*data_num-1);
00268 }
00269 
00270 <span class="comment">//------------ End of function GraphPerformanceIndicatorYear::draw_scale -------------//</span>
00271 
00272 <span class="comment">//---------- Begin of function GraphPerformanceIndicatorYear::draw_series ------------//</span>
<a name="l00274"></a><a class="code" href="classGraphPerformanceIndicatorYear.html#b2">00274</a> <span class="comment">void GraphPerformanceIndicatorYear::draw_series() {</span>
00275     <span class="keywordflow">switch</span> (data_type_flag) {
00276     <span class="keywordflow">case</span> DATA_FLOAT: draw_series_float(); <span class="keywordflow">break</span>;
00277     <span class="keywordflow">case</span> DATA_DOUBLE: draw_series_double(); <span class="keywordflow">break</span>;
00278     <span class="keywordflow">case</span> DATA_INT: draw_series_int(); <span class="keywordflow">break</span>;
00279     <span class="keywordflow">case</span> DATA_LONG: draw_series_long(); <span class="keywordflow">break</span>;
00280     }
00281 }
00282 
00283 <span class="comment">//------------ End of function GraphPerformanceIndicatorYear::draw_series ------------//</span>
00284 
00285 <span class="comment">//---------- Begin of function GraphPerformanceIndicatorYear::draw_series_float ------------//</span>
<a name="l00287"></a><a class="code" href="classGraphPerformanceIndicatorYear.html#b3">00287</a> <span class="comment">void GraphPerformanceIndicatorYear::draw_series_float() {</span>
00288     <span class="keywordtype">float</span> *dataArray = (<span class="keywordtype">float</span> *) data_array;
00289     <span class="keywordtype">short</span> prevX, prevY, currX, currY;
00290 
00291     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num; i++) {
00292         dataArray-=info.graph_year_passed;
00293         dataArray+=HISTORY_YEAR_COUNT;
00294         prevX = series_x1;
00295         <span class="keywordflow">if</span> (x_axis_pos)
00296             prevY = series_y2 - short(((*dataArray+<span class="keywordtype">float</span>(max_scale)) * <span class="keywordtype">float</span>(series_y2-series_y1) / <span class="keywordtype">float</span>(max_scale*2)));
00297         <span class="keywordflow">else</span>
00298             prevY = series_y2 - short(*dataArray * <span class="keywordtype">float</span>(series_y2-series_y1) / <span class="keywordtype">float</span>(max_scale));
00299 
00300         dataArray++;
00301         vga_back.thick_line(prevX-1, prevY, prevX+1, prevY, vga_back.translate_color(series_color[i]));
00302 
00303         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt; info.graph_year_passed; j++) {
00304             currX = series_x1 + (int)(x_axis_step*j);
00305             <span class="keywordflow">if</span> (x_axis_pos)
00306                 currY = series_y2 - short(((*dataArray+<span class="keywordtype">float</span>(max_scale)) * <span class="keywordtype">float</span>(series_y2-series_y1) / <span class="keywordtype">float</span>(max_scale*2)));
00307             <span class="keywordflow">else</span>
00308                 currY = series_y2 - short(*dataArray * <span class="keywordtype">float</span>(series_y2-series_y1) / <span class="keywordtype">float</span>(max_scale));
00309 
00310             vga_back.thick_line(prevX, prevY, currX, currY, vga_back.translate_color(series_color[i]));
00311 
00312             prevX = currX;
00313             prevY = currY;
00314             dataArray++;
00315         }
00316 
00317         <span class="keywordflow">if</span> (value_flag)
00318             draw_value(dataArray-1, vga_back.translate_color(<a class="code" href="COLOR_8H.html#a15">V_BLACK</a>), prevX+<a class="code" href="Ogrph__py_8cpp.html#a9a6">COMMON_OFFSET</a>-(int)(0.3f*x_axis_step), prevY-font_ptr-&gt;max_font_height/2, DATA_FLOAT);
00319     }
00320 }
00321 
00322 <span class="comment">//------------ End of function GraphPerformanceIndicatorYear::draw_series_float ------------//</span>
00323 
00324 <span class="comment">//---------- Begin of function GraphPerformanceIndicatorYear::draw_series_double ------------//</span>
<a name="l00326"></a><a class="code" href="classGraphPerformanceIndicatorYear.html#b4">00326</a> <span class="comment">void GraphPerformanceIndicatorYear::draw_series_double() {</span>
00327     <span class="keywordtype">double</span> *dataArray = (<span class="keywordtype">double</span> *) data_array;
00328     <span class="keywordtype">short</span> prevX, prevY, currX, currY;
00329 
00330     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num; i++) {
00331         dataArray-=info.graph_year_passed;
00332         dataArray+=HISTORY_YEAR_COUNT;
00333         prevX = series_x1;
00334         <span class="keywordflow">if</span> (x_axis_pos)
00335             prevY = series_y2 - short(((*dataArray+max_scale) * <span class="keywordtype">double</span>(series_y2-series_y1) / (max_scale*2)));
00336         <span class="keywordflow">else</span>
00337             prevY = series_y2 - short(*dataArray * <span class="keywordtype">double</span>(series_y2-series_y1) / max_scale);
00338 
00339         dataArray++;
00340         vga_back.thick_line(prevX-1, prevY, prevX+1, prevY, vga_back.translate_color(series_color[i]));
00341 
00342         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt; info.graph_year_passed; j++) {
00343             currX = series_x1 + (int)(x_axis_step*j);
00344             <span class="keywordflow">if</span> (x_axis_pos)
00345                 currY = series_y2 - short(((*dataArray+max_scale) * <span class="keywordtype">double</span>(series_y2-series_y1) / (max_scale*2)));
00346             <span class="keywordflow">else</span>
00347                 currY = series_y2 - short(*dataArray * <span class="keywordtype">double</span>(series_y2-series_y1) / max_scale);
00348 
00349             vga_back.thick_line(prevX, prevY, currX, currY, vga_back.translate_color(series_color[i]));
00350 
00351             prevX = currX;
00352             prevY = currY;
00353             dataArray++;
00354         }
00355 
00356         <span class="keywordflow">if</span> (value_flag)
00357             draw_value(dataArray-1, vga_back.translate_color(<a class="code" href="COLOR_8H.html#a15">V_BLACK</a>), prevX+<a class="code" href="Ogrph__py_8cpp.html#a9a6">COMMON_OFFSET</a>-(int)(0.3f*x_axis_step), prevY-font_ptr-&gt;max_font_height/2, DATA_DOUBLE);
00358     }
00359 }
00360 
00361 <span class="comment">//------------ End of function GraphPerformanceIndicatorYear::draw_series_double ------------//</span>
00362 
00363 <span class="comment">//---------- Begin of function GraphPerformanceIndicatorYear::draw_series_int ------------//</span>
<a name="l00365"></a><a class="code" href="classGraphPerformanceIndicatorYear.html#b5">00365</a> <span class="comment">void GraphPerformanceIndicatorYear::draw_series_int() {</span>
00366     <span class="keywordtype">int</span> *dataArray = (<span class="keywordtype">int</span> *) data_array;
00367     <span class="keywordtype">short</span> prevX, prevY, currX, currY;
00368 
00369     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num; i++) {
00370         dataArray-=info.graph_year_passed;
00371         dataArray+=HISTORY_YEAR_COUNT;
00372         prevX = series_x1;
00373         <span class="keywordflow">if</span> (x_axis_pos)
00374             prevY = series_y2 - ((*dataArray+int(max_scale)) * (series_y2-series_y1) / int(max_scale*2));
00375         <span class="keywordflow">else</span>
00376             prevY = series_y2 - *dataArray * (series_y2-series_y1) / int(max_scale);
00377 
00378         dataArray++;
00379         vga_back.thick_line(prevX-1, prevY, prevX+1, prevY, vga_back.translate_color(series_color[i]));
00380 
00381         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt; info.graph_year_passed; j++) {
00382             currX = series_x1 + (int)(x_axis_step*j);
00383             <span class="keywordflow">if</span> (x_axis_pos)
00384                 currY = series_y2 - ((*dataArray+int(max_scale)) * (series_y2-series_y1) / int(max_scale*2));
00385             <span class="keywordflow">else</span>
00386                 currY = series_y2 - *dataArray * (series_y2-series_y1) / int(max_scale);
00387 
00388             vga_back.thick_line(prevX, prevY, currX, currY, vga_back.translate_color(series_color[i]));
00389 
00390             prevX = currX;
00391             prevY = currY;
00392             dataArray++;
00393         }
00394 
00395         <span class="keywordflow">if</span> (value_flag)
00396             draw_value(dataArray-1, vga_back.translate_color(<a class="code" href="COLOR_8H.html#a15">V_BLACK</a>), prevX+<a class="code" href="Ogrph__py_8cpp.html#a9a6">COMMON_OFFSET</a>-(int)(0.3f*x_axis_step), prevY-font_ptr-&gt;max_font_height/2, DATA_INT);
00397     }
00398 }
00399 
00400 <span class="comment">//------------ End of function GraphPerformanceIndicatorYear::draw_series_int ------------//</span>
00401 
00402 <span class="comment">//---------- Begin of function GraphPerformanceIndicatorYear::draw_series_long ------------//</span>
<a name="l00404"></a><a class="code" href="classGraphPerformanceIndicatorYear.html#b6">00404</a> <span class="comment">void GraphPerformanceIndicatorYear::draw_series_long() {</span>
00405     <span class="keywordtype">long</span> *dataArray = (<span class="keywordtype">long</span> *) data_array;
00406     <span class="keywordtype">short</span> prevX, prevY, currX, currY;
00407 
00408     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num; i++) {
00409         dataArray-=info.graph_year_passed;
00410         dataArray+=HISTORY_YEAR_COUNT;
00411         prevX = series_x1;
00412         <span class="keywordflow">if</span> (x_axis_pos)
00413             prevY = series_y2 - short(((*dataArray+<span class="keywordtype">long</span>(max_scale)) * <span class="keywordtype">long</span>(series_y2-series_y1) / <span class="keywordtype">long</span>(max_scale*2)));
00414         <span class="keywordflow">else</span>
00415             prevY = series_y2 - short(*dataArray * <span class="keywordtype">long</span>(series_y2-series_y1) / <span class="keywordtype">long</span>(max_scale));
00416 
00417         dataArray++;
00418         vga_back.thick_line(prevX-1, prevY, prevX+1, prevY, vga_back.translate_color(series_color[i]));
00419 
00420         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt; info.graph_year_passed; j++) {
00421             currX = series_x1 + (int)(x_axis_step*j);
00422             <span class="keywordflow">if</span> (x_axis_pos)
00423                 currY = series_y2 - short(((*dataArray+<span class="keywordtype">long</span>(max_scale)) * <span class="keywordtype">long</span>(series_y2-series_y1) / <span class="keywordtype">long</span>(max_scale*2)));
00424             <span class="keywordflow">else</span>
00425                 currY = series_y2 - short(*dataArray * <span class="keywordtype">long</span>(series_y2-series_y1) / <span class="keywordtype">long</span>(max_scale));
00426 
00427             vga_back.thick_line(prevX, prevY, currX, currY, vga_back.translate_color(series_color[i]));
00428 
00429             prevX = currX;
00430             prevY = currY;
00431             dataArray++;
00432         }
00433 
00434         <span class="keywordflow">if</span> (value_flag)
00435             draw_value(dataArray-1, vga_back.translate_color(<a class="code" href="COLOR_8H.html#a15">V_BLACK</a>), prevX+<a class="code" href="Ogrph__py_8cpp.html#a9a6">COMMON_OFFSET</a>-(int)(0.3f*x_axis_step), prevY-font_ptr-&gt;max_font_height/2, DATA_LONG);
00436     }
00437 }
00438 
00439 <span class="comment">//------------ End of function GraphPerformanceIndicatorYear::draw_series_float ------------//</span>
00440 
00441 <span class="comment">//---------- Begin of function GraphPerformanceIndicatorYear::draw_value -------------------//</span>
<a name="l00443"></a><a class="code" href="classGraphPerformanceIndicatorYear.html#b7">00443</a> <span class="comment">void GraphPerformanceIndicatorYear::draw_value(void *value, int color, short x, short y, int dataType) {</span>
00444     <span class="keywordtype">char</span> *valueString;
00445     <span class="keywordflow">switch</span> (data_type_flag) {
00446     <span class="keywordflow">case</span> DATA_FLOAT:
00447         valueString = m.format(*((<span class="keywordtype">float</span> *) value), num_format); <span class="keywordflow">break</span>;
00448     <span class="keywordflow">case</span> DATA_DOUBLE:
00449         valueString = m.format(*((<span class="keywordtype">double</span> *) value), num_format); <span class="keywordflow">break</span>;
00450     <span class="keywordflow">case</span> DATA_INT:
00451         valueString = m.format(*((<span class="keywordtype">int</span> *) value), num_format); <span class="keywordflow">break</span>;
00452     <span class="keywordflow">case</span> DATA_LONG:
00453         valueString = m.format(*((<span class="keywordtype">long</span> *) value), num_format); <span class="keywordflow">break</span>;
00454     }
00455 
00456     <span class="keywordtype">short</span> textHeight = font_ptr-&gt;max_font_height;
00457     <span class="keywordtype">short</span> textWidth = font_ptr-&gt;text_width(valueString) + 1;
00458     <span class="comment">/*  </span>
00459 <span class="comment">        short *bitmap = (short *) sys.common_data_buf;</span>
00460 <span class="comment">        err_when( (2 + textWidth * textHeight) * sizeof(short) &gt; COMMON_DATA_BUF_SIZE );</span>
00461 <span class="comment">        *bitmap++ = textWidth;</span>
00462 <span class="comment">        *bitmap++ = textHeight;</span>
00463 <span class="comment"></span>
00464 <span class="comment">        short *shortPtr = bitmap;</span>
00465 <span class="comment">        for (int i = 0; i &lt; textWidth * textHeight; i++)</span>
00466 <span class="comment">        *shortPtr++ = transparent_code_w;</span>
00467 <span class="comment"></span>
00468 <span class="comment">        font_ptr-&gt;put_to_bufferW(bitmap, textWidth * sizeof(short), 0, 0, valueString);</span>
00469 <span class="comment"></span>
00470 <span class="comment">        shortPtr = bitmap;</span>
00471 <span class="comment">        for (i = 0; i &lt; textWidth * textHeight; i++, shortPtr++)</span>
00472 <span class="comment">        if (*shortPtr != transparent_code_w)</span>
00473 <span class="comment">        *shortPtr = color;</span>
00474 <span class="comment"></span>
00475 <span class="comment">        vga_back.put_bitmapW_trans(x, y, (short *) sys.common_data_buf);</span>
00476 <span class="comment">    */</span>
00477     font_chartsm.put(x+3,y,valueString);
00478 }
00479 
00480 <span class="comment">//---------- End of function GraphPerformanceIndicatorYear::draw_value -------------------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:51 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
