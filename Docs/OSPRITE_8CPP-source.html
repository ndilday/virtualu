<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OSPRITE.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>OSPRITE.CPP</h1><a href="OSPRITE_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OSprite.h</span>
00002 <span class="comment">//Description : Sprite Class Declaration</span>
00003 <span class="comment">//Owner       : Fred</span>
00004 
00005 <span class="preprocessor">#include &lt;memory.h&gt;</span>
00006 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00007 <span class="preprocessor">#include &lt;GAMEDEF.H&gt;</span>
00008 <span class="preprocessor">#include &lt;OMISC.H&gt;</span>
00009 <span class="preprocessor">#include &lt;<a class="code" href="ORECT_8H.html">ORECT.H</a>&gt;</span>
00010 <span class="preprocessor">#include &lt;<a class="code" href="OSPRITE_8H.html">OSPRITE.H</a>&gt;</span>
00011 <span class="preprocessor">#include &lt;<a class="code" href="OSPRTRES_8H.html">OSPRTRES.H</a>&gt;</span>
00012 <span class="preprocessor">#include &lt;<a class="code" href="OWORLD_8H.html">OWORLD.H</a>&gt;</span>
00013 <span class="preprocessor">#include &lt;OWORLDMT.H&gt;</span>
00014 <span class="preprocessor">#include &lt;OMATRIX.H&gt;</span>
00015 
00016 <span class="comment">// for this-&gt;draw()</span>
00017 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00018 <span class="comment">//#include &lt;OSTR.H&gt;</span>
00019 <span class="comment">//#include &lt;OFONT.H&gt;</span>
00020 
00021 <span class="comment">//-------- Begin of function Sprite::Sprite --------//</span>
<a name="l00022"></a><a class="code" href="classSprite.html#a0">00022</a> <a class="code" href="classSprite.html#a0">Sprite::Sprite</a>() {
00023     <span class="comment">// preserve virtual pointer</span>
00024     memset( (<span class="keywordtype">char</span> *)<span class="keyword">this</span> + <span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *), 0, <span class="keyword">sizeof</span>(<a class="code" href="classSprite.html">Sprite</a>) - <span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *) );
00025 }
00026 
00027 <span class="comment">//--------- End of function Sprite::Sprite --------//</span>
00028 
00029 <span class="comment">//-------- Begin of function Sprite::~Sprite --------//</span>
<a name="l00030"></a><a class="code" href="classSprite.html#a1">00030</a> <a class="code" href="classSprite.html#a1">Sprite::~Sprite</a>() {
00031     <a class="code" href="classSprite.html#a3">deinit</a>();
00032 }
00033 
00034 <span class="comment">//--------- End of function Sprite::~Sprite --------//</span>
00035 
00036 <span class="comment">//--------- Begin of function Sprite::init ---------//</span>
<a name="l00037"></a><a class="code" href="classSprite.html#a2">00037</a> <span class="keywordtype">void</span> <a class="code" href="classSprite.html#a2">Sprite::init</a>(<span class="keywordtype">short</span> spriteId, <span class="keywordtype">short</span> startXLoc, <span class="keywordtype">short</span> startYLoc, <span class="keywordtype">char</span> startSubXLoc, <span class="keywordtype">char</span> startSubYLoc) {
00038     <a class="code" href="classSprite.html#m0">sprite_id</a> = spriteId;
00039 
00040     <a class="code" href="classSprite.html#m10">go_x</a> = <a class="code" href="classSprite.html#m12">next_x</a> = <a class="code" href="classSprite.html#m8">cur_x</a> = startXLoc;
00041     <a class="code" href="classSprite.html#m11">go_y</a> = <a class="code" href="classSprite.html#m13">next_y</a> = <a class="code" href="classSprite.html#m9">cur_y</a> = startYLoc;
00042 
00043     <span class="comment">/*</span>
00044 <span class="comment">      cur_attack = 0;</span>
00045 <span class="comment">      cur_action = SPRITE_IDLE;</span>
00046 <span class="comment">      cur_dir     = m.random(GameDef::MAX_SPRITE_DIR_TYPE);     // facing any of the eight directions</span>
00047 <span class="comment">      cur_frame  = 1;</span>
00048 <span class="comment">      final_dir  = cur_dir;</span>
00049 <span class="comment">    */</span>
00050 
00051     <span class="comment">//----- clone vars from sprite_res for fast access -----//</span>
00052     <a class="code" href="classSprite.html#m0">sprite_id</a> = 1;                                  <span class="comment">//temp</span>
00053     <a class="code" href="ALL_8H.html#a1">err_here</a>();
00054     <span class="comment">//990511            sprite_info = sprite_res[sprite_id];</span>
00055 
00056     <a class="code" href="classSprite.html#m16">sprite_info</a>-&gt;<a class="code" href="classSpriteInfo.html#a1">load_bitmap_res</a>();
00057 
00058     <span class="comment">//----- set the sprite's location &amp; absolute positions on the map -----//</span>
00059 
00060     <a class="code" href="classSprite.html#a4">set_abs</a>(<a class="code" href="Gamedef_8h.html#a72a19">ZOOM_SMALL</a> , <a class="code" href="Oworldmt_8h.html#a8">MAP_LOC_WIDTH</a>   , <a class="code" href="Oworldmt_8h.html#a9">MAP_LOC_HEIGHT</a>);
00061     <a class="code" href="classSprite.html#a4">set_abs</a>(<a class="code" href="Gamedef_8h.html#a72a20">ZOOM_MEDIUM</a>, <a class="code" href="Oworldmt_8h.html#a18">ZOOM1_LOC_WIDTH</a>, <a class="code" href="Oworldmt_8h.html#a19">ZOOM1_LOC_HEIGHT</a>);
00062     <a class="code" href="classSprite.html#a4">set_abs</a>(<a class="code" href="Gamedef_8h.html#a72a21">ZOOM_LARGE</a> , <a class="code" href="Oworldmt_8h.html#a20">ZOOM2_LOC_WIDTH</a>, <a class="code" href="Oworldmt_8h.html#a21">ZOOM2_LOC_HEIGHT</a>);
00063 
00064     <a class="code" href="classSprite.html#m15">will_not_move_next_process</a> = 0;
00065 }
00066 
00067 <span class="comment">//----------- End of function Sprite::init -----------//</span>
00068 
00069 <span class="comment">//--------- Begin of function Sprite::deinit ---------//</span>
<a name="l00070"></a><a class="code" href="classSprite.html#a3">00070</a> <span class="keywordtype">void</span> <a class="code" href="classSprite.html#a3">Sprite::deinit</a>() {
00071     world.get_loc(<a class="code" href="classSprite.html#m8">cur_x</a>, <a class="code" href="classSprite.html#m9">cur_y</a>)-&gt;remove_sprite();
00072 }
00073 
00074 <span class="comment">//----------- End of function Sprite::deinit -----------//</span>
00075 
00076 <span class="comment">//--------- Begin of function Sprite::set_abs ---------//</span>
<a name="l00078"></a><a class="code" href="classSprite.html#a4">00078</a> <span class="comment">void Sprite::set_abs(int zoomLevel, int locWidth, int locHeight) {</span>
00079 }
00080 
00081 <span class="comment">//----------- End of function Sprite::set_abs ---------//</span>
00082 
00083 <span class="comment">//--------- Begin of function Sprite::cur_sprite_frame ---------//</span>
<a name="l00086"></a><a class="code" href="classSprite.html#a8">00086</a> <span class="comment">SpriteFrame* Sprite::cur_sprite_frame(int *needMirror) {</span>
00087     <span class="comment">/*</span>
00088 <span class="comment">      UCHAR curDir = display_dir();</span>
00089 <span class="comment">      SpriteStop *stopAction= sprite_info-&gt;stop_array +curDir;</span>
00090 <span class="comment"></span>
00091 <span class="comment">      return sprite_frame_res[0];       //temp</span>
00092 <span class="comment"></span>
00093 <span class="comment">      if ( cur_frame &gt; stopAction-&gt;frame_count )</span>
00094 <span class="comment">      return sprite_frame_res[stopAction-&gt;frame_recno];       // first frame</span>
00095 <span class="comment">      else            // only few sprite has stopAction-&gt;frame_count &gt; 1</span>
00096 <span class="comment">      return sprite_frame_res[stopAction-&gt;frame_recno+cur_frame-1];</span>
00097 <span class="comment">    */</span>
00098     <span class="keywordflow">return</span> <a class="code" href="OHELP_8H.html#a0">NULL</a>;                                    <span class="comment">//temp</span>
00099 
00100     <span class="comment">/*UCHAR curDir = display_dir();</span>
00101 <span class="comment">      if( needMirror)</span>
00102 <span class="comment">      *needMirror = need_mirror(curDir);</span>
00103 <span class="comment"></span>
00104 <span class="comment">      // do not update cur_dir as curDir</span>
00105 <span class="comment">      err_when(curDir&lt;0 || curDir&gt;=3*MAX_SPRITE_DIR_TYPE);</span>
00106 <span class="comment"></span>
00107 <span class="comment">      switch( cur_action )</span>
00108 <span class="comment">      {</span>
00109 <span class="comment">      case SPRITE_MOVE:</span>
00110 <span class="comment">      case SPRITE_SHIP_EXTRA_MOVE:</span>
00111 <span class="comment">      if( guard_count)</span>
00112 <span class="comment">      {</span>
00113 <span class="comment">      if( curDir &gt;= MAX_SPRITE_DIR_TYPE)</span>
00114 <span class="comment">      {</span>
00115 <span class="comment">      err_here();</span>
00116 <span class="comment">      curDir %= MAX_SPRITE_DIR_TYPE;</span>
00117 <span class="comment">      }</span>
00118 <span class="comment">      return sprite_frame_res[sprite_info-&gt;guard_move_array[curDir].first_frame_recno+cur_frame-1];</span>
00119 <span class="comment">      }</span>
00120 <span class="comment">      else</span>
00121 <span class="comment">      return sprite_frame_res[sprite_info-&gt;move_array[curDir].first_frame_recno+cur_frame-1];</span>
00122 <span class="comment"></span>
00123 <span class="comment">      case SPRITE_ATTACK:</span>
00124 <span class="comment">      err_when(curDir&lt;0 || curDir&gt;=MAX_SPRITE_DIR_TYPE);</span>
00125 <span class="comment">      return sprite_frame_res[sprite_info-&gt;attack_array[cur_attack][curDir].first_frame_recno+cur_frame-1];</span>
00126 <span class="comment"></span>
00127 <span class="comment">      case SPRITE_TURN:</span>
00128 <span class="comment">      case SPRITE_IDLE:</span>
00129 <span class="comment">      case SPRITE_WAIT:</span>
00130 <span class="comment">      // air unit needs it own stop frames to float on air</span>
00131 <span class="comment">      {</span>
00132 <span class="comment">      if( guard_count )</span>
00133 <span class="comment">      {</span>
00134 <span class="comment">      if( curDir &gt;= MAX_SPRITE_DIR_TYPE)</span>
00135 <span class="comment">      {</span>
00136 <span class="comment">      // if the sprite is turning, adjust direction to next</span>
00137 <span class="comment">      if( turn_delay &gt; 0)</span>
00138 <span class="comment">      curDir ++;</span>
00139 <span class="comment">      curDir %= MAX_SPRITE_DIR_TYPE;</span>
00140 <span class="comment">      }</span>
00141 <span class="comment"></span>
00142 <span class="comment">      SpriteGuardStop *guardStopAction = sprite_info-&gt;guard_stop_array + curDir;</span>
00143 <span class="comment">      return sprite_frame_res[guardStopAction-&gt;first_frame_recno+</span>
00144 <span class="comment">      min(guard_count,guardStopAction-&gt;frame_count)-1];</span>
00145 <span class="comment">      }</span>
00146 <span class="comment">      else</span>
00147 <span class="comment">      {</span>
00148 <span class="comment">      SpriteStop *stopAction= sprite_info-&gt;stop_array +curDir;</span>
00149 <span class="comment">      if(cur_frame &gt; stopAction-&gt;frame_count)</span>
00150 <span class="comment">      return sprite_frame_res[stopAction-&gt;frame_recno];       // first frame</span>
00151 <span class="comment">      else            // only few sprite has stopAction-&gt;frame_count &gt; 1</span>
00152 <span class="comment">      return sprite_frame_res[stopAction-&gt;frame_recno+cur_frame-1];</span>
00153 <span class="comment">      }</span>
00154 <span class="comment">      }</span>
00155 <span class="comment"></span>
00156 <span class="comment">      case SPRITE_DIE:</span>
00157 <span class="comment">      if(sprite_info-&gt;die.first_frame_recno)                    // only if this sprite has dying frame</span>
00158 <span class="comment">      {</span>
00159 <span class="comment">      if( needMirror)</span>
00160 <span class="comment">      *needMirror = 0;                  // no need to mirror at any direction</span>
00161 <span class="comment">      return sprite_frame_res[sprite_info-&gt;die.first_frame_recno+cur_frame-1];</span>
00162 <span class="comment">      }</span>
00163 <span class="comment"></span>
00164 <span class="comment">      default:</span>
00165 <span class="comment">      return sprite_frame_res[sprite_info-&gt;move_array[curDir].first_frame_recno+cur_frame-1];</span>
00166 <span class="comment">      }*/</span>
00167 }
00168 
00169 <span class="comment">//----------- End of function Sprite::cur_sprite_frame -----------//</span>
00170 
00171 <span class="comment">//--------- Begin of function Sprite::update_abs_pos ---------//</span>
<a name="l00174"></a><a class="code" href="classSprite.html#a7">00174</a> <span class="comment">void Sprite::update_abs_pos() {                   //</span>
00175 
00176     <span class="comment">/*</span>
00177 <span class="comment">      SpriteFrame       *spriteFrame;   //temp</span>
00178 <span class="comment">      if(!spriteFrame)</span>
00179 <span class="comment">      spriteFrame = cur_sprite_frame();</span>
00180 <span class="comment">    */</span>
00181 
00182     <span class="comment">/*</span>
00183 <span class="comment">      abs_x1 = sub_cur_x + spriteFrame-&gt;offset_x - world.zoom_matrix-&gt;top_x_loc*Location::SUB_LOC_WIDTH*GameDef::ZOOM_LOC_WIDTH;</span>
00184 <span class="comment">      abs_y1 = sub_cur_y + spriteFrame-&gt;offset_y - world.zoom_matrix-&gt;top_y_loc*Location::SUB_LOC_HEIGHT*GameDef::ZOOM_LOC_HEIGHT;</span>
00185 <span class="comment"></span>
00186 <span class="comment">      abs_x2 = abs_x1 + spriteFrame-&gt;width  - 1;</span>
00187 <span class="comment">      abs_y2 = abs_y1 + spriteFrame-&gt;height - 1;</span>
00188 <span class="comment">    */</span>
00189 }
00190 
00191 <span class="comment">//----------- End of function Sprite::update_abs_pos -----------//</span>
00192 
00193 <span class="comment">/*</span>
00194 <span class="comment"></span>
00195 <span class="comment">short Sprite::cur_x_loc()</span>
00196 <span class="comment">{ return sub_cur_x&gt;&gt;GameDef::ZOOM_X_SHIFT_COUNT; }</span>
00197 <span class="comment">short   Sprite::cur_y_loc()</span>
00198 <span class="comment">{ return sub_cur_y&gt;&gt;GameDef::ZOOM_Y_SHIFT_COUNT; }</span>
00199 <span class="comment"></span>
00200 <span class="comment">short   Sprite::next_x_loc()</span>
00201 <span class="comment">{ return sub_next_x&gt;&gt;GameDef::ZOOM_X_SHIFT_COUNT; }</span>
00202 <span class="comment">short   Sprite::next_y_loc()</span>
00203 <span class="comment">{ return sub_next_y&gt;&gt;GameDef::ZOOM_Y_SHIFT_COUNT; }</span>
00204 <span class="comment"></span>
00205 <span class="comment">short Sprite::go_x_loc()</span>
00206 <span class="comment">{ return sub_go_x&gt;&gt;GameDef::ZOOM_X_SHIFT_COUNT; }</span>
00207 <span class="comment">short Sprite::go_y_loc()</span>
00208 <span class="comment">{ return sub_go_y&gt;&gt;GameDef::ZOOM_Y_SHIFT_COUNT; }</span>
00209 <span class="comment"></span>
00210 <span class="comment">//------------------------------------------------------//</span>
00211 <span class="comment"></span>
00212 <span class="comment">short Sprite::cur_sub_x_loc()</span>
00213 <span class="comment">{ return sub_cur_x&gt;&gt;GameDef::ZOOM_SUB_X_SHIFT_COUNT; }</span>
00214 <span class="comment">short   Sprite::cur_sub_y_loc()</span>
00215 <span class="comment">{ return sub_cur_y&gt;&gt;GameDef::ZOOM_SUB_Y_SHIFT_COUNT; }</span>
00216 <span class="comment"></span>
00217 <span class="comment">short   Sprite::next_sub_x_loc()</span>
00218 <span class="comment">{ return sub_next_x&gt;&gt;GameDef::ZOOM_SUB_X_SHIFT_COUNT; }</span>
00219 <span class="comment">short   Sprite::next_sub_y_loc()</span>
00220 <span class="comment">{ return sub_next_y&gt;&gt;GameDef::ZOOM_SUB_Y_SHIFT_COUNT; }</span>
00221 <span class="comment"></span>
00222 <span class="comment">short Sprite::go_sub_x_loc()</span>
00223 <span class="comment">{ return sub_go_x&gt;&gt;GameDef::ZOOM_SUB_X_SHIFT_COUNT; }</span>
00224 <span class="comment">short Sprite::go_sub_y_loc()</span>
00225 <span class="comment">{ return sub_go_y&gt;&gt;GameDef::ZOOM_SUB_Y_SHIFT_COUNT; }</span>
00226 <span class="comment">*/</span>
00227 
00228 <span class="comment">//--------- Begin of function Sprite::draw ----------//</span>
<a name="l00232"></a><a class="code" href="classSprite.html#a5">00232</a> <span class="comment">void Sprite::draw(Matrix* matrixPtr) {</span>
00233     <span class="comment">//--------- draw sprite on the zoom window ---------//</span>
00234 
00235     <span class="comment">//int needMirror;</span>
00236 
00237     <span class="comment">//SpriteFrame* spriteFrame = cur_sprite_frame(&amp;needMirror);</span>
00238 
00239     <span class="comment">//-------- check if the firm is within the view area --------//</span>
00240 
00241     <span class="keywordtype">int</span> zoomLevel = matrixPtr-&gt;zoom_level;
00242     <span class="keywordtype">int</span> bmpWidth  = sprite_info-&gt;bitmap_width[zoomLevel];
00243     <span class="keywordtype">int</span> bmpHeight = sprite_info-&gt;bitmap_height[zoomLevel];
00244 
00245     <span class="comment">//char* bitmapPtr = sprite_info-&gt;res_bitmap.read_imported(spriteFrame-&gt;bitmap_offset);</span>
00246     <a class="code" href="ALL_8H.html#a0">err_when</a>( !sprite_info-&gt;res_bitmap[zoomLevel].init_flag );
00247     <span class="keywordtype">char</span>* bmpPtr  = sprite_info-&gt;bitmap_ptr[zoomLevel];
00248 
00249     <span class="comment">//update_abs_rect(zoomLevel);</span>
00250 
00251     <span class="keywordtype">int</span> x1 = abs_rect[zoomLevel].x1 - matrixPtr-&gt;abs_top_x;
00252 
00253     <span class="comment">// out of the view area, not even a slight part of it appears in the view area</span>
00254     <span class="keywordflow">if</span>( x1 &lt;= -bmpWidth || x1 &gt;= matrixPtr-&gt;win_width )
00255         <span class="keywordflow">return</span>;
00256 
00257     <span class="keywordtype">int</span> y1 = abs_rect[zoomLevel].y1 - matrixPtr-&gt;abs_top_y;
00258 
00259     <span class="keywordflow">if</span>( y1 &lt;= -bmpHeight || y1 &gt;= matrixPtr-&gt;win_height )
00260         <span class="keywordflow">return</span>;
00261 
00262     <span class="keywordtype">int</span> x2 = abs_rect[zoomLevel].x2 - matrixPtr-&gt;abs_top_x;
00263     <span class="keywordtype">int</span> y2 = abs_rect[zoomLevel].y2 - matrixPtr-&gt;abs_top_y;
00264 
00265     <span class="keywordflow">if</span>( x2 &lt; 0 || y2 &lt; 0 )
00266         <span class="keywordflow">return</span>;
00267 
00268     <span class="comment">//---- only portion of the sprite is inside the view area ------//</span>
00269 
00270     <span class="keywordflow">if</span>( x1 &lt; 0 || x2 &gt;= matrixPtr-&gt;win_width || y1 &lt; 0 || y2 &gt;= matrixPtr-&gt;win_height ) {
00271         vga_back.put_bitmap_area_trans_decompress( x1+matrixPtr-&gt;win_x1, y1+matrixPtr-&gt;win_y1, bmpPtr,
00272                                                    max(0,x1)-x1, max(0,y1)-y1, min(matrixPtr-&gt;win_width-1,x2)-x1, min(matrixPtr-&gt;win_height-1,y2)-y1);
00273     }
00274 
00275     <span class="comment">//---- the whole sprite is inside the view area ------//</span>
00276 
00277     <span class="keywordflow">else</span> {
00278         vga_back.put_bitmap_trans_decompress( x1+matrixPtr-&gt;win_x1, y1+matrixPtr-&gt;win_y1, bmpPtr);
00279 
00280         <span class="comment">/*</span>
00281 <span class="comment">          if( zoomLevel == 1 )</span>
00282 <span class="comment">          {</span>
00283 <span class="comment">          String str;</span>
00284 <span class="comment">          str  = "(";</span>
00285 <span class="comment">          str += loc_x1;</span>
00286 <span class="comment">          str += ",";</span>
00287 <span class="comment">          str += loc_y1;</span>
00288 <span class="comment">          str += ")";</span>
00289 <span class="comment"></span>
00290 <span class="comment">          vga.use_back();</span>
00291 <span class="comment">          font_san.put(x1+matrixPtr-&gt;win_x1, y1+matrixPtr-&gt;win_y1, str);</span>
00292 <span class="comment">          vga.use_front();</span>
00293 <span class="comment">          }</span>
00294 <span class="comment">        */</span>
00295     }
00296 }
00297 
00298 <span class="comment">//--------- End of function Sprite::draw -----------//</span>
00299 
00300 <span class="comment">//--------- Begin of function Sprite::process ---------//</span>
<a name="l00301"></a><a class="code" href="classSprite.html#a6">00301</a> <span class="keywordtype">void</span> <a class="code" href="classSprite.html#a6">Sprite::process</a>() {
00302     <span class="keywordflow">if</span> ( will_not_move_next_process ) {
00303         <a class="code" href="classSprite.html#m15">will_not_move_next_process</a> = (<a class="code" href="classSprite.html#m15">will_not_move_next_process</a>+1)%10;
00304         <span class="keywordflow">return</span>;
00305     }
00306     <span class="keywordflow">else</span>
00307         <a class="code" href="classSprite.html#m15">will_not_move_next_process</a> = 1;
00308 
00309     <span class="comment">// randomly move along walkable locations (road)</span>
00310     <span class="comment">//</span>
00311     <a class="code" href="classSprite.html#m10">go_x</a> = <a class="code" href="classSprite.html#m8">cur_x</a>;
00312     <a class="code" href="classSprite.html#m11">go_y</a> = <a class="code" href="classSprite.html#m9">cur_y</a>;
00313 
00314     <a class="code" href="classSprite.html#m10">go_x</a> += m.random(3) - 1;
00315     <a class="code" href="classSprite.html#m11">go_y</a> += m.random(3) - 1;
00316 
00317     <a class="code" href="classLocation.html">Location</a>* locPtr = world.get_valid_loc(<a class="code" href="classSprite.html#m10">go_x</a>, <a class="code" href="classSprite.html#m11">go_y</a>);
00318 
00319     <span class="keywordflow">if</span> ( !locPtr || !locPtr-&gt;<a class="code" href="classLocation.html#a11">is_walkable</a>() || locPtr-&gt;<a class="code" href="classLocation.html#a32">has_sprite</a>() )
00320         <span class="keywordflow">return</span>;
00321 
00322     world.get_loc(<a class="code" href="classSprite.html#m8">cur_x</a>, <a class="code" href="classSprite.html#m9">cur_y</a>)-&gt;remove_sprite();
00323     <a class="code" href="classSprite.html#m8">cur_x</a> = <a class="code" href="classSprite.html#m10">go_x</a>; <a class="code" href="classSprite.html#m9">cur_y</a> = <a class="code" href="classSprite.html#m11">go_y</a>;
00324     locPtr-&gt;<a class="code" href="classLocation.html#a30">set_sprite</a>(<a class="code" href="classSprite.html#m1">sprite_recno</a>);
00325 
00326     <a class="code" href="classSprite.html#a4">set_abs</a>(<a class="code" href="Gamedef_8h.html#a72a19">ZOOM_SMALL</a> , <a class="code" href="Oworldmt_8h.html#a8">MAP_LOC_WIDTH</a>   , <a class="code" href="Oworldmt_8h.html#a9">MAP_LOC_HEIGHT</a>);
00327     <a class="code" href="classSprite.html#a4">set_abs</a>(<a class="code" href="Gamedef_8h.html#a72a20">ZOOM_MEDIUM</a>, <a class="code" href="Oworldmt_8h.html#a18">ZOOM1_LOC_WIDTH</a>, <a class="code" href="Oworldmt_8h.html#a19">ZOOM1_LOC_HEIGHT</a>);
00328     <a class="code" href="classSprite.html#a4">set_abs</a>(<a class="code" href="Gamedef_8h.html#a72a21">ZOOM_LARGE</a> , <a class="code" href="Oworldmt_8h.html#a20">ZOOM2_LOC_WIDTH</a>, <a class="code" href="Oworldmt_8h.html#a21">ZOOM2_LOC_HEIGHT</a>);
00329 
00330 }
00331 
00332 <span class="comment">//----------- End of function Sprite::process -----------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:23 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
