<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Ofaculta.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Ofaculta.cpp</h1><a href="Ofaculta_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OFACULTA.CPP</span>
00002 <span class="comment">//Description : Faculty Array Class Definition</span>
00003 
00004 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00005 <span class="preprocessor">#include &lt;OFACULTY.H&gt;</span>
00006 
00007 <span class="comment">//##### begin fred 0819 #####//</span>
00008 <span class="preprocessor">#include &lt;OPSCHOOL.H&gt;</span>
00009 <span class="preprocessor">#include &lt;OFINANCE.H&gt;</span>
00010 <span class="preprocessor">#include &lt;ODEPT.H&gt;</span>
00011 <span class="comment">//##### end fred 0819 #####//</span>
00012 <span class="preprocessor">#include &lt;OMATH.H&gt;</span>                                <span class="comment">//## chea 221199 init talent</span>
00013 
00014 <span class="comment">//----------- Begin of function FacultyArray Constructor -----//</span>
<a name="l00016"></a><a class="code" href="classFacultyArray.html#a0">00016</a> <span class="comment">FacultyArray::FacultyArray() : DynArrayB(sizeof(Faculty), 100, DEFAULT_REUSE_INTERVAL_DAYS) {</span>
00017     faculty_count = 0;
00018 
00019     memset(talent_teaching,0,<span class="keyword">sizeof</span>(talent_teaching));
00020     memset(talent_scholarship,0,<span class="keyword">sizeof</span>(talent_teaching));
00021     memset(talent_research,0,<span class="keyword">sizeof</span>(talent_teaching));
00022 
00023     memset(performance_teaching,0,<span class="keyword">sizeof</span>(talent_teaching));
00024     memset(performance_scholarship,0,<span class="keyword">sizeof</span>(talent_teaching));
00025     memset(performance_research,0,<span class="keyword">sizeof</span>(talent_teaching));
00026 
00027     memset(satisfaction_index,0,<span class="keyword">sizeof</span>(satisfaction_index));
00028     memset(percent_research,0,<span class="keyword">sizeof</span>(percent_research));
00029 
00030     memset(teaching_contact_hour,0,<span class="keyword">sizeof</span>(teaching_contact_hour));
00031     memset(discretionary_hour_array, 0, <span class="keyword">sizeof</span>(discretionary_hour_array));
00032 
00033 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00034 <span class="preprocessor"></span>    time_shifted_scholarship = 0;
00035 <span class="preprocessor">#endif</span>
00036 <span class="preprocessor"></span>}
00037 
00038 <span class="comment">//------------- End of function FacultyArray Constructor -----//</span>
00039 
00040 <span class="comment">//----------- Begin of function FacultyArray Destructor ------//</span>
<a name="l00042"></a><a class="code" href="classFacultyArray.html#a1">00042</a> <span class="comment">FacultyArray::~FacultyArray() {</span>
00043     <span class="comment">//----------------------------------//</span>
00044 
00045     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=size() ; i&gt;0 ; i-- ) {
00046         <span class="keywordflow">if</span>( !is_deleted(i) )
00047 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00048 <span class="preprocessor"></span>            del(i,1);
00049 <span class="preprocessor">#else</span>
00050 <span class="preprocessor"></span>        del(i);
00051 <span class="preprocessor">#endif</span>
00052 <span class="preprocessor"></span>    }
00053 
00054     <span class="comment">//----------------------------------//</span>
00055 }
00056 
00057 <span class="comment">//------------- End of function FacultyArray Destructor ------//</span>
00058 
00059 <span class="comment">//--------- Begin of function FacultyArray::add ---------//</span>
00060 
<a name="l00061"></a><a class="code" href="classFacultyArray.html#a4">00061</a> <span class="keywordtype">int</span> <a class="code" href="classFacultyArray.html#a4">FacultyArray::add</a>(<span class="keywordtype">int</span> departmentRecno, <span class="keywordtype">int</span> rankLevel, <span class="keywordtype">int</span> genderEthnicGroup, <span class="keywordtype">int</span> facultyAge, <span class="keywordtype">int</span> startTeachingDate,
00062                       <span class="keywordtype">int</span> facultySalary, <span class="keywordtype">int</span> talentTeaching, <span class="keywordtype">int</span> talentScholarship, <span class="keywordtype">int</span> talentResearch) {
00063 
00064     <span class="comment">//## chea 221199 init all talent here</span>
00065     <span class="comment">//## chea 221099 init talentTeaching here</span>
00066     <span class="comment">//## chea 021299 modifiled from math.get_random_snd(1.0f, 0.05f)</span>
00067     <span class="keywordtype">int</span> talent_Teaching;
00068     talent_Teaching = (int)(talentTeaching * math.get_random_snd(1.0f, 0.10f));
00069     <span class="keywordflow">if</span>(talent_Teaching&gt;=100)
00070         talent_Teaching =100;
00071     <span class="keywordtype">int</span> talent_Scholarship = (int)(talentScholarship * math.get_random_snd(1.0f, 0.10f));
00072     <span class="keywordflow">if</span>(talent_Scholarship&gt;=100)
00073         talent_Scholarship =100;
00074     <span class="keywordtype">int</span> talent_Research    = (int)(talentResearch * math.get_random_snd(1.0f, 0.10f));
00075     <span class="keywordflow">if</span>(talent_Research&gt;=100)
00076         talent_Research =100;
00077 
00078     <a class="code" href="classFaculty.html">Faculty</a> faculty;
00079 
00080     faculty.<a class="code" href="classFaculty.html#a6">init</a>(departmentRecno, rankLevel, genderEthnicGroup, facultyAge, startTeachingDate, facultySalary, talent_Teaching, talent_Scholarship, talent_Research);
00081 
00082     <a class="code" href="classDynArrayB.html#a4">linkin</a>(&amp;faculty);
00083 
00084     ((<a class="code" href="classFaculty.html">Faculty</a>*) <a class="code" href="classDynArray.html#a13">get</a>())-&gt;faculty_recno = <a class="code" href="classDynArray.html#a27">recno</a>();
00085 
00086     <a class="code" href="classFacultyArray.html#m1">faculty_count</a>++;
00087 
00088 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00089 <span class="preprocessor"></span>    <span class="comment">// update display_faculty_array &amp;&amp; display_faculty_count in department</span>
00090     <a class="code" href="classDepartment.html">Department</a>* deptPtr = department_array[departmentRecno];
00091 
00092     <a class="code" href="classFaculty.html">Faculty</a>* orgPtr = this-&gt;<a class="code" href="classFacultyArray.html#a11">operator []</a>(<a class="code" href="classDynArray.html#a27">recno</a>());
00093 
00094     deptPtr-&gt;cur_faculty_array.linkin(orgPtr);
00095 
00096     <a class="code" href="classFaculty.html">Faculty</a>* facPtr = (<a class="code" href="classFaculty.html">Faculty</a>*) deptPtr-&gt;cur_faculty_array.get(deptPtr-&gt;cur_faculty_array.size());
00097 
00098     facPtr-&gt;employ_status = 0;                      <span class="comment">// New Hire</span>
00099 <span class="preprocessor">#endif</span>
00100 <span class="preprocessor"></span>
00101     <span class="keywordflow">return</span> <a class="code" href="classDynArray.html#a27">recno</a>();
00102 }
00103 
00104 <span class="comment">//----------- End of function FacultyArray::add -----------//</span>
00105 
00106 <span class="comment">//--------- Begin of function FacultyArray::del ---------//</span>
00107 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00108 <span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="classFacultyArray.html#a5">FacultyArray::del</a>(<span class="keywordtype">int</span> recNo, <span class="keywordtype">int</span> isQuiting)
00109 #<span class="keywordflow">else</span>
<a name="l00110"></a><a class="code" href="classFacultyArray.html#a5">00110</a>     <span class="keywordtype">void</span> <a class="code" href="classFacultyArray.html#a5">FacultyArray::del</a>(<span class="keywordtype">int</span> recNo)
00111 #endif
00112 {
00113 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00114 <span class="preprocessor"></span>    <a class="code" href="classFaculty.html">Faculty</a>*  orgPtr = operator[](recNo);
00115 
00116     <span class="comment">// update display_faculty_array &amp;&amp; display_faculty_count in department</span>
00117     <a class="code" href="classDepartment.html">Department</a>* deptPtr = department_array[orgPtr-&gt;<a class="code" href="classFaculty.html#m1">department_recno</a>];
00118 
00119     <span class="keywordflow">if</span> (!isQuiting) {
00120         deptPtr-&gt;cur_faculty_array.linkin( orgPtr );
00121 
00122         <span class="keywordtype">int</span> arraySize = deptPtr-&gt;cur_faculty_array.size();
00123 
00124         <a class="code" href="classFaculty.html">Faculty</a>* facPtr = (<a class="code" href="classFaculty.html">Faculty</a>*) deptPtr-&gt;cur_faculty_array.get(arraySize);
00125 
00126         facPtr-&gt;employ_status = 1;                    <span class="comment">// Department</span>
00127     }
00128 <span class="preprocessor">#endif</span>
00129 <span class="preprocessor"></span>
00130     faculty_count--;
00131 
00132     linkout(recNo);
00133 }
00134 
00135 <span class="comment">//----------- End of function FacultyArray::del -----------//</span>
00136 
00137 <span class="comment">//------ Begin of function FacultyArray::avg_discretionary_hour -----//</span>
<a name="l00142"></a><a class="code" href="classFacultyArray.html#a6">00142</a> <span class="comment">int FacultyArray::avg_discretionary_hour(int discretionaryType) {</span>
00143     <a class="code" href="classFaculty.html">Faculty</a>* facultyPtr;
00144 
00145     <span class="keywordtype">int</span> totalHour=0;
00146 
00147     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=size() ; i&gt;0 ; i-- ) {
00148         <span class="keywordflow">if</span>( is_deleted(i) )
00149             <span class="keywordflow">continue</span>;
00150 
00151         facultyPtr = operator[](i);
00152 
00153         totalHour += facultyPtr-&gt;<a class="code" href="classFaculty.html#m14">discretionary_hour_array</a>[discretionaryType];
00154     }
00155 
00156     <span class="comment">//##### begin fred 980813 #####//</span>
00157     <span class="keywordflow">if</span> ( faculty_count )
00158         <span class="keywordflow">return</span> totalHour / faculty_count;
00159     <span class="keywordflow">else</span>
00160         <span class="keywordflow">return</span> 0;
00161     <span class="comment">//##### end fred 980813 #####//</span>
00162 }
00163 
00164 <span class="comment">//--------- End of function FacultyArray::avg_discretionary_hour -----//</span>
00165 
00166 <span class="comment">//--------- Begin of function FacultyArray::next_day ---------//</span>
00167 
<a name="l00168"></a><a class="code" href="classFacultyArray.html#a7">00168</a> <span class="keywordtype">void</span> <a class="code" href="classFacultyArray.html#a7">FacultyArray::next_day</a>() {
00169     <span class="comment">//----- call individual faculty's next_day() function ----//</span>
00170 
00171     <span class="keywordflow">if</span>(info.prerun_year == 1 &amp;&amp; info.game_date == 1722034)
00172         <span class="keywordtype">int</span> fgdfg=0;
00173 
00174     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=<a class="code" href="classDynArray.html#a28">size</a>() ; i&gt;0 ; i-- ) {
00175         <span class="keywordflow">if</span>( <a class="code" href="classFacultyArray.html#a10">is_deleted</a>(i) )
00176             <span class="keywordflow">continue</span>;
00177 
00178         <a class="code" href="classFacultyArray.html#a11">operator[]</a>(i)-&gt;<a class="code" href="classFaculty.html#a10">next_day</a>();
00179     }
00180 
00181     <span class="comment">//##### begin fred 0819 #####//</span>
00182     <span class="comment">// start of a trimester</span>
00183     <span class="keywordflow">if</span> ( info.game_day == player_school.trimester_array[player_school.cur_trimester].start_day
00184          &amp;&amp; info.game_month == player_school.trimester_array[player_school.cur_trimester].start_month ) {
00185         <a class="code" href="classFacultyArray.html#a12">update_history</a>(UPDATE_TRIMESTER);
00186         think_summer_teaching();
00187     }
00188 
00189     <span class="comment">// start of a month</span>
00190     <span class="keywordflow">if</span> ( info.game_day == 1 ) {
00191         <a class="code" href="classFacultyArray.html#a12">update_history</a>(UPDATE_MONTH);
00192         sys.yield();
00193 
00194         <span class="comment">// start of a year</span>
00195         <span class="keywordflow">if</span> ( info.game_month == finance.fiscal_year_start_month )
00196             <a class="code" href="classFacultyArray.html#a12">update_history</a>(UPDATE_YEAR);
00197     }
00198     <span class="comment">//##### end fred 0819 #####//</span>
00199 }
00200 
00201 <span class="comment">//----------- End of function FacultyArray::next_day -----------//</span>
00202 
00203 <span class="comment">//--------- Begin of function FacultyArray::next_trimester ---------//</span>
00204 
<a name="l00205"></a><a class="code" href="classFacultyArray.html#a8">00205</a> <span class="keywordtype">void</span> <a class="code" href="classFacultyArray.html#a8">FacultyArray::next_trimester</a>() {
00206     <span class="keywordtype">int</span> i;
00207 
00208     <span class="comment">// for Faculty::think_discretionary_time()</span>
00209 
00210     <a class="code" href="classDepartment.html">Department</a>* deptPtr = department_array[<a class="code" href="classFacultyArray.html#m0">department_recno</a>];
00211     <span class="keywordtype">int</span> total=0;                                    <span class="comment">// = 0;     990419</span>
00212 
00213     <span class="keywordflow">for</span> ( i=0; i &lt; <a class="code" href="Ofaculty_8h.html#a28a14">DISCRETIONARY_TYPE_COUNT</a>; i++ )
00214         total += deptPtr-&gt;<a class="code" href="classDepartment.html#m10">priority_discretionary_hour_array</a>[i];
00215 
00216     <span class="keywordflow">if</span> ( total &gt; 0 ) {                              <span class="comment">// 990531</span>
00217         <span class="keywordflow">for</span> ( i=0; i &lt; <a class="code" href="Ofaculty_8h.html#a28a14">DISCRETIONARY_TYPE_COUNT</a>; i++ ) {
00218             deptPtr-&gt;<a class="code" href="classDepartment.html#m13">relative_priority_discretionary_hour_array</a>[i]
00219                 = deptPtr-&gt;<a class="code" href="classDepartment.html#m10">priority_discretionary_hour_array</a>[i] * 100.0f / total;
00220             <a class="code" href="ALL_8H.html#a0">err_when</a>(deptPtr-&gt;<a class="code" href="classDepartment.html#m13">relative_priority_discretionary_hour_array</a>[i] &lt; 0);
00221         }
00222     }
00223     <span class="keywordflow">else</span>
00224         <span class="keywordflow">for</span> ( i=0; i &lt; <a class="code" href="Ofaculty_8h.html#a28a14">DISCRETIONARY_TYPE_COUNT</a>; i++ )
00225             deptPtr-&gt;<a class="code" href="classDepartment.html#m13">relative_priority_discretionary_hour_array</a>[i] = 0;
00226 
00227     <a class="code" href="ALL_8H.html#a2">err_if</a> ( total &lt; 0 )                            <span class="comment">// 990531</span>
00228         <a class="code" href="ALL_8H.html#a1">err_here</a>();
00229 
00230     <span class="comment">//----- call individual faculty's next_trimester() function ----//</span>
00231 
00232     <span class="keywordflow">for</span>( i=<a class="code" href="classDynArray.html#a28">size</a>() ; i&gt;0 ; i-- ) {
00233         <span class="keywordflow">if</span>( <a class="code" href="classFacultyArray.html#a10">is_deleted</a>(i) )
00234             <span class="keywordflow">continue</span>;
00235 
00236         <span class="comment">//err_when(operator[](i)-&gt;faculty_recno != i);</span>
00237 
00238         <a class="code" href="classFacultyArray.html#a11">operator[]</a>(i)-&gt;<a class="code" href="classFaculty.html#a11">next_trimester</a>();
00239 
00240         sys.yield();
00241     }
00242 }
00243 
00244 <span class="comment">//----------- End of function FacultyArray::next_trimester -----------//</span>
00245 
00246 <span class="comment">//--------- Begin of function FacultyArray::is_deleted ---------//</span>
00247 
<a name="l00248"></a><a class="code" href="classFacultyArray.html#a10">00248</a> <span class="keywordtype">int</span> <a class="code" href="classFacultyArray.html#a10">FacultyArray::is_deleted</a>(<span class="keywordtype">int</span> recNo) {
00249     <a class="code" href="classFaculty.html">Faculty</a>* facultyPtr = (<a class="code" href="classFaculty.html">Faculty</a>*) <a class="code" href="classDynArray.html#a13">get</a>(recNo);
00250 
00251     <span class="keywordflow">if</span>( facultyPtr == <a class="code" href="OHELP_8H.html#a0">NULL</a> )
00252         <span class="keywordflow">return</span> 1;
00253 
00254     <span class="keywordflow">return</span> facultyPtr-&gt;<a class="code" href="classFaculty.html#m0">faculty_recno</a> == 0;
00255 }
00256 
00257 <span class="comment">//----------- End of function FacultyArray::is_deleted -----------//</span>
00258 
00259 <span class="comment">//-------- Begin of function FacultyArray::get_unpacked_person --------//</span>
<a name="l00264"></a><a class="code" href="classFacultyArray.html#a9">00264</a> <span class="comment">Faculty* FacultyArray::get_unpacked_faculty(int recNo) {</span>
00265     <span class="comment">//----- filter out deleted facultys --------//</span>
00266 
00267     <span class="keywordtype">int</span> i, facultyCount=0;
00268 
00269     <span class="keywordflow">for</span>( i=1 ; i&lt;=size() ; i++ ) {
00270         <span class="keywordflow">if</span>( !is_deleted(i) ) {
00271             <span class="keywordflow">if</span>( ++facultyCount == recNo )
00272                 <span class="keywordflow">return</span> operator[](i);
00273         }
00274     }
00275 
00276     <span class="comment">// ## begin chwg 0911</span>
00277     <span class="keywordflow">return</span> operator[](size());
00278     <span class="comment">// ## end chwg 0911</span>
00279 
00280     <a class="code" href="ALL_8H.html#a4">err_now</a>( <span class="stringliteral">"FacultyArray::get_unpacked_faculty"</span> );
00281     <span class="keywordflow">return</span> <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00282 }
00283 
00284 <span class="comment">//----------- End of static function get_unpacked_faculty -----------//</span>
00285 
00286 <span class="comment">//##### begin fred 0819 #####//</span>
00287 <span class="comment">//---------- Begin of function FacultyArray::update_history -----------//</span>
<a name="l00288"></a><a class="code" href="classFacultyArray.html#a12">00288</a> <span class="keywordtype">void</span> <a class="code" href="classFacultyArray.html#a12">FacultyArray::update_history</a>(<span class="keywordtype">char</span> update_flag) {
00289     <span class="keywordflow">switch</span> (update_flag) {
00290     <span class="keywordflow">case</span> UPDATE_MONTH:
00291         calc_history_monthly();
00292         <span class="keywordflow">break</span>;
00293     <span class="keywordflow">case</span> UPDATE_TRIMESTER:
00294         calc_history_trimester();
00295         <span class="keywordflow">break</span>;
00296     <span class="keywordflow">case</span> UPDATE_YEAR:
00297         <span class="keywordflow">break</span>;
00298     <span class="keywordflow">case</span> UPDATE_ALL:
00299         <a class="code" href="classFacultyArray.html#a12">update_history</a>(UPDATE_MONTH);
00300         <a class="code" href="classFacultyArray.html#a12">update_history</a>(UPDATE_TRIMESTER);
00301         <a class="code" href="classFacultyArray.html#a12">update_history</a>(UPDATE_YEAR);
00302         <span class="keywordflow">break</span>;
00303     <span class="keywordflow">default</span>:
00304         <a class="code" href="ALL_8H.html#a1">err_here</a>();
00305         <span class="keywordflow">break</span>;
00306     }
00307 }
00308 
00309 <span class="comment">//---------- End of function FacultyArray::update_history -----------//</span>
00310 
00311 <span class="comment">//---------- Begin of function FacultyArray::calc_history_trimester -----------//</span>
00312 <span class="keywordtype">void</span> FacultyArray::calc_history_trimester() {
00313     <span class="keywordtype">int</span> i,j;
00314 
00315     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(<a class="code" href="classFacultyArray.html#m2">talent_teaching</a>,HISTORY_TRIMESTER_COUNT);
00316     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(<a class="code" href="classFacultyArray.html#m3">talent_scholarship</a>,HISTORY_TRIMESTER_COUNT);
00317     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(<a class="code" href="classFacultyArray.html#m4">talent_research</a>,HISTORY_TRIMESTER_COUNT);
00318 
00319     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(<a class="code" href="classFacultyArray.html#m5">performance_teaching</a>,HISTORY_TRIMESTER_COUNT);
00320     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(<a class="code" href="classFacultyArray.html#m6">performance_scholarship</a>,HISTORY_TRIMESTER_COUNT);
00321     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(<a class="code" href="classFacultyArray.html#m7">performance_research</a>,HISTORY_TRIMESTER_COUNT);
00322     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(<a class="code" href="classFacultyArray.html#m9">percent_research</a>,HISTORY_TRIMESTER_COUNT);
00323 
00324     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(<a class="code" href="classFacultyArray.html#m10">teaching_contact_hour</a>,HISTORY_TRIMESTER_COUNT);
00325     <span class="keywordflow">for</span> ( j=0; j&lt;<a class="code" href="Ofaculty_8h.html#a30a21">DISCRETIONARY_TYPE_COUNT_N_TOTAL</a>; j++ )
00326         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(<a class="code" href="classFacultyArray.html#m11">discretionary_hour_array</a>[j], HISTORY_TRIMESTER_COUNT);
00327 
00328     <a class="code" href="classFaculty.html">Faculty</a>* facultyPtr;
00329     <span class="keywordtype">float</span> total[8];
00330     <span class="comment">// use int, not char</span>
00331     <span class="keywordtype">int</span> discretionaryHourTotal[<a class="code" href="Ofaculty_8h.html#a28a14">DISCRETIONARY_TYPE_COUNT</a>];
00332     <span class="keywordtype">int</span> facCount = 0;
00333 
00334     memset(total, 0, <span class="keyword">sizeof</span>(total));
00335     memset(discretionaryHourTotal, 0, <span class="keyword">sizeof</span>(discretionaryHourTotal));
00336 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00337 <span class="preprocessor"></span>    time_shifted_scholarship = 0;
00338     <span class="keywordtype">int</span> regularFacCount = 0;
00339 <span class="preprocessor">#endif</span>
00340 <span class="preprocessor"></span>
00341     <span class="keywordflow">for</span>( i=<a class="code" href="classDynArray.html#a28">size</a>() ; i&gt;0 ; i-- ) {
00342         <span class="keywordflow">if</span>( <a class="code" href="classFacultyArray.html#a10">is_deleted</a>(i) )
00343             <span class="keywordflow">continue</span>;
00344 
00345         facultyPtr = <a class="code" href="classFacultyArray.html#a11">operator[]</a>(i); facCount++;
00346 
00347 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00348 <span class="preprocessor"></span>        <span class="comment">// don't count adjunct in ver2</span>
00349         <span class="keywordflow">if</span>( facultyPtr-&gt;<a class="code" href="classFaculty.html#a3">is_regular</a>() ) {
00350 <span class="preprocessor">#endif</span>
00351 <span class="preprocessor"></span>            total[0] += facultyPtr-&gt;<a class="code" href="classFaculty.html#m27">talent_teaching</a>;
00352             total[1] += facultyPtr-&gt;<a class="code" href="classFaculty.html#m28">talent_scholarship</a>;
00353             total[2] += facultyPtr-&gt;<a class="code" href="classFaculty.html#m29">talent_research</a>;
00354             total[3] += facultyPtr-&gt;<a class="code" href="classFaculty.html#m30">performance_teaching</a>;
00355             total[4] += facultyPtr-&gt;<a class="code" href="classFaculty.html#m31">performance_scholarship</a>;
00356             total[5] += facultyPtr-&gt;<a class="code" href="classFaculty.html#m32">performance_research</a>;
00357 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00358 <span class="preprocessor"></span>            ++regularFacCount;
00359         }
00360 <span class="preprocessor">#endif</span>
00361 <span class="preprocessor"></span>
00362         total[6] += (facultyPtr-&gt;<a class="code" href="classFaculty.html#m20">research_proposal_count</a>) ? 1 : 0;
00363         total[7] += facultyPtr-&gt;<a class="code" href="classFaculty.html#m13">teaching_contact_hour</a>;
00364 
00365         <span class="keywordflow">for</span> ( j=0; j&lt;<a class="code" href="Ofaculty_8h.html#a28a14">DISCRETIONARY_TYPE_COUNT</a>; j++ )
00366             discretionaryHourTotal[j] += facultyPtr-&gt;<a class="code" href="classFaculty.html#m14">discretionary_hour_array</a>[j];
00367 
00368 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00369 <span class="preprocessor"></span>        time_shifted_scholarship += facultyPtr-&gt;time_shifted_scholarship;
00370 <span class="preprocessor">#endif</span>
00371 <span class="preprocessor"></span>    }
00372 
00373     <span class="keywordflow">if</span> ( !facCount )
00374         <span class="keywordflow">return</span>;
00375 
00376 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00377 <span class="preprocessor"></span>    <a class="code" href="classFacultyArray.html#m2">talent_teaching</a>[THIS_TRIMESTER] = math.safe_divide(total[0], (<span class="keywordtype">float</span>)regularFacCount);
00378     <a class="code" href="classFacultyArray.html#m3">talent_scholarship</a>[THIS_TRIMESTER] = math.safe_divide(total[1], (<span class="keywordtype">float</span>)regularFacCount);
00379     <a class="code" href="classFacultyArray.html#m4">talent_research</a>[THIS_TRIMESTER] = math.safe_divide(total[2], (<span class="keywordtype">float</span>)regularFacCount);
00380     <a class="code" href="classFacultyArray.html#m5">performance_teaching</a>[THIS_TRIMESTER] = math.safe_divide(total[3], (<span class="keywordtype">float</span>)regularFacCount);
00381     <a class="code" href="classFacultyArray.html#m6">performance_scholarship</a>[THIS_TRIMESTER] = math.safe_divide(total[4], (<span class="keywordtype">float</span>)regularFacCount);
00382     <a class="code" href="classFacultyArray.html#m7">performance_research</a>[THIS_TRIMESTER] = math.safe_divide(total[5], (<span class="keywordtype">float</span>)regularFacCount);
00383 <span class="preprocessor">#else</span>
00384 <span class="preprocessor"></span>    <a class="code" href="classFacultyArray.html#m2">talent_teaching</a>[THIS_TRIMESTER] = (total[0] / facCount);
00385     <a class="code" href="classFacultyArray.html#m3">talent_scholarship</a>[THIS_TRIMESTER] = (total[1] / facCount);
00386     <a class="code" href="classFacultyArray.html#m4">talent_research</a>[THIS_TRIMESTER] = (total[2] / facCount);
00387     <a class="code" href="classFacultyArray.html#m5">performance_teaching</a>[THIS_TRIMESTER] = (total[3] / facCount);
00388     <a class="code" href="classFacultyArray.html#m6">performance_scholarship</a>[THIS_TRIMESTER] = (total[4] / facCount);
00389     <a class="code" href="classFacultyArray.html#m7">performance_research</a>[THIS_TRIMESTER] = (total[5] / facCount);
00390 <span class="preprocessor">#endif</span>
00391 <span class="preprocessor"></span>    <a class="code" href="classFacultyArray.html#m9">percent_research</a>[THIS_TRIMESTER] = char(total[6] * 100 / facCount);
00392     <a class="code" href="classFacultyArray.html#m10">teaching_contact_hour</a>[THIS_TRIMESTER] = (total[7] / facCount);
00393 
00394     <span class="comment">// 990518</span>
00395     j = THIS_TRIMESTER;
00396     <span class="keywordflow">if</span>((player_school.cur_trimester == <a class="code" href="Gamedef_8h.html#a79a38">SUMMER</a>) &amp;&amp;
00397        <span class="comment">// TL_summer &lt; TL_spring</span>
00398        (<a class="code" href="classFacultyArray.html#m10">teaching_contact_hour</a>[j] &lt; <a class="code" href="classFacultyArray.html#m10">teaching_contact_hour</a>[j-1]) )
00399         <a class="code" href="classFacultyArray.html#m10">teaching_contact_hour</a>[j] = <a class="code" href="classFacultyArray.html#m10">teaching_contact_hour</a>[j-1];
00400 
00401     <span class="comment">// include teaching_contact_hour in TOTAL</span>
00402     <a class="code" href="classFacultyArray.html#m11">discretionary_hour_array</a>[<a class="code" href="Ofaculty_8h.html#a30a21">DISCRETIONARY_TYPE_COUNT_N_TOTAL</a>-1][THIS_TRIMESTER] = (total[7] / facCount);
00403 
00404 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00405 <span class="preprocessor"></span>    time_shifted_scholarship /= facCount;
00406     <span class="comment">// include time shifted from scholarship</span>
00407     <a class="code" href="classFacultyArray.html#m11">discretionary_hour_array</a>[<a class="code" href="Ofaculty_8h.html#a30a21">DISCRETIONARY_TYPE_COUNT_N_TOTAL</a>-1][THIS_TRIMESTER] += time_shifted_scholarship;
00408 <span class="preprocessor">#endif</span>
00409 <span class="preprocessor"></span>
00410     <span class="keywordflow">for</span> ( j=0; j&lt;<a class="code" href="Ofaculty_8h.html#a28a14">DISCRETIONARY_TYPE_COUNT</a>; j++ ) {
00411         <a class="code" href="classFacultyArray.html#m11">discretionary_hour_array</a>[j][THIS_TRIMESTER] = float(discretionaryHourTotal[j]) / facCount;
00412         <a class="code" href="classFacultyArray.html#m11">discretionary_hour_array</a>[<a class="code" href="Ofaculty_8h.html#a30a21">DISCRETIONARY_TYPE_COUNT_N_TOTAL</a>-1][THIS_TRIMESTER] += <a class="code" href="classFacultyArray.html#m11">discretionary_hour_array</a>[j][THIS_TRIMESTER];
00413     }
00414 
00415 }
00416 
00417 <span class="comment">//---------- End of function FacultyArray::calc_history_trimester -----------//</span>
00418 
00419 <span class="comment">//---------- Begin of function FacultyArray::calc_history_monthly -----------//</span>
00420 <span class="keywordtype">void</span> FacultyArray::calc_history_monthly() {
00421     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(<a class="code" href="classFacultyArray.html#m8">satisfaction_index</a>,HISTORY_MONTH_COUNT);
00422 
00423     <a class="code" href="classFaculty.html">Faculty</a> *facultyPtr;
00424     <span class="keywordtype">float</span> total = 0;
00425     <span class="keywordtype">int</span> i, facCount = 0;
00426 
00427     <span class="keywordflow">for</span>( i=<a class="code" href="classDynArray.html#a28">size</a>() ; i&gt;0 ; i-- ) {
00428         <span class="keywordflow">if</span>( <a class="code" href="classFacultyArray.html#a10">is_deleted</a>(i) )
00429             <span class="keywordflow">continue</span>;
00430 
00431         facultyPtr = <a class="code" href="classFacultyArray.html#a11">operator[]</a>(i); facCount++;
00432 
00433         total += facultyPtr-&gt;<a class="code" href="classFaculty.html#m35">satisfaction_index</a>;
00434 
00435     }
00436 
00437     <span class="keywordflow">if</span> ( !facCount )
00438         <span class="keywordflow">return</span>;
00439 
00440     <a class="code" href="classFacultyArray.html#m8">satisfaction_index</a>[THIS_MONTH] = total / facCount;
00441 }
00442 
00443 <span class="comment">//---------- End of function FacultyArray::calc_history_monthly -----------//</span>
00444 <span class="comment">//##### end fred 0819 #####//</span>
00445 
00446 <span class="comment">// ##### begin Marco#### //</span>
00447 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00448 <span class="preprocessor"></span><span class="comment">//---------- Begin of function FacultyArray::save_initial_data -----------//</span>
00449 <span class="keywordtype">void</span> FacultyArray::save_initial_data() {
00450     <span class="keywordtype">int</span> i;
00451 
00452     initial_teaching_contact_hour = <a class="code" href="classFacultyArray.html#m10">teaching_contact_hour</a>[HISTORY_TRIMESTER_COUNT-1];
00453     <span class="comment">//  a percentage from 0 to 100</span>
00454     initial_talent_teaching = <a class="code" href="classFacultyArray.html#m2">talent_teaching</a>[HISTORY_TRIMESTER_COUNT-1];
00455     initial_talent_scholarship = <a class="code" href="classFacultyArray.html#m3">talent_scholarship</a>[HISTORY_TRIMESTER_COUNT-1];
00456     initial_talent_research = <a class="code" href="classFacultyArray.html#m4">talent_research</a>[HISTORY_TRIMESTER_COUNT-1];
00457     <span class="comment">//  a percentage from 0 to 100</span>
00458     initial_performance_teaching = <a class="code" href="classFacultyArray.html#m5">performance_teaching</a>[HISTORY_TRIMESTER_COUNT-1];
00459     initial_performance_scholarship = <a class="code" href="classFacultyArray.html#m6">performance_scholarship</a>[HISTORY_TRIMESTER_COUNT-1];
00460     <span class="comment">// BUGHRE change to monthly as in Faculty::update_history()</span>
00461     initial_performance_research = <a class="code" href="classFacultyArray.html#m7">performance_research</a>[HISTORY_TRIMESTER_COUNT-1];
00462 
00463     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="Ofaculty_8h.html#a30a21">DISCRETIONARY_TYPE_COUNT_N_TOTAL</a>;i++) {
00464         initial_discretionary_hour_array[i] = <a class="code" href="classFacultyArray.html#m11">discretionary_hour_array</a>[i][HISTORY_TRIMESTER_COUNT-1];
00465     }
00466 
00467     initial_time_shifted_scholarship = time_shifted_scholarship;
00468 }
00469 
00470 <span class="comment">//---------- End of function FacultyArray::save_initial_data -----------//</span>
00471 <span class="preprocessor">#endif</span>
00472 <span class="preprocessor"></span><span class="comment">// ###### End Marco ###### //</span>
00473 
00474 <span class="preprocessor">#ifdef DEBUG</span>
00475 <span class="preprocessor"></span>
00476 <span class="comment">//------- Begin of function FacultyArray::operator[] -----//</span>
00477 
00478 <a class="code" href="classFaculty.html">Faculty</a>* <a class="code" href="classFacultyArray.html#a11">FacultyArray::operator[]</a>(<span class="keywordtype">int</span> recNo) {
00479     <a class="code" href="classFaculty.html">Faculty</a>* FacultyPtr = (<a class="code" href="classFaculty.html">Faculty</a>*) <a class="code" href="classDynArray.html#a13">get</a>(recNo);
00480 
00481     <span class="keywordflow">if</span>( !FacultyPtr )
00482         err.run( <span class="stringliteral">"FacultyArray[] is deleted"</span> );
00483 
00484     <span class="keywordflow">return</span> FacultyPtr;
00485 }
00486 
00487 <span class="comment">//--------- End of function FacultyArray::operator[] ----//</span>
00488 <span class="preprocessor">#endif</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:32 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
