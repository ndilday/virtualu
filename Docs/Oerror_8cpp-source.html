<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Oerror.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Oerror.cpp</h1><a href="Oerror_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OERR.CPP</span>
00002 <span class="comment">//Description : Object Error Handling</span>
00003 
00004 <span class="preprocessor">#include &lt;new.h&gt;</span>
00005 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00006 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00007 <span class="preprocessor">#include &lt;stdarg.h&gt;</span>
00008 <span class="preprocessor">#include &lt;windows.h&gt;</span>
00009 
00010 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00011 <span class="comment">//#include &lt;OBOX.H&gt;</span>
00012 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00013 <span class="preprocessor">#include &lt;<a class="code" href="OVGALOCK_8H.html">OVGALOCK.H</a>&gt;</span>
00014 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>                                  <span class="comment">// class Error is declared here</span>
00015 
00016 <span class="comment">//------------------------------------------------//</span>
00017 <span class="comment">//</span>
00018 <span class="comment">// There are several types of errors :</span>
00019 <span class="comment">//</span>
00020 <span class="comment">// 1. Internal Errors caused by bugs of the program</span>
00021 <span class="comment">// 2. Runtime Errors caused by using up of resources (memory) or</span>
00022 <span class="comment">//    unexpected environment errors. (disk error)</span>
00023 <span class="comment">//</span>
00024 <span class="comment">//------------------------------------------------//</span>
00025 
00026 <span class="keyword">static</span> <span class="keywordtype">int</span> new_func_handler(size_t);
00027 <span class="keyword">static</span> <span class="keywordtype">void</span> error_quit_game(<span class="keywordtype">char</span> *msg);
00028 
00029 <span class="comment">//---------- define static variable ----------//</span>
00030 
00031 <span class="keyword">static</span> <span class="keywordtype">char</span> error_flag=0;                         <span class="comment">// prevent error message dead loop</span>
00032 
00033 <span class="comment">//------- Begin of function new_func_handler ------------//</span>
00035 <span class="comment">static int new_func_handler(size_t allocSize) {</span>
00036     err.mem();
00037 
00038     <span class="keywordflow">return</span> 0;
00039 }
00040 
00041 <span class="comment">//-------- End of function new_func_handler --------------//</span>
00042 
00043 <span class="comment">//------- Begin of function error_quit_game ------------//</span>
00044 <span class="keyword">static</span> <span class="keywordtype">void</span> error_quit_game(<span class="keywordtype">char</span> *msg) {
00045     <span class="comment">//if( vga.is_inited() )</span>
00046     <span class="comment">//  box.msg( strBuf, 0 );</span>
00047 
00048     <span class="keywordflow">if</span>( vga_front.dd_buf ) {
00049         <a class="code" href="classVgaFrontLock.html">VgaFrontLock</a> vgaLock;
00050 
00051         ShowCursor(TRUE);
00052         MessageBox(sys.main_hwnd, msg, <a class="code" href="Gamedef_8h.html#a3">WIN_TITLE</a>, MB_OK | MB_ICONERROR);
00053         ShowCursor(FALSE);
00054     }
00055     <span class="keywordflow">else</span> {
00056         ShowCursor(TRUE);
00057         MessageBox(sys.main_hwnd, msg, <a class="code" href="Gamedef_8h.html#a3">WIN_TITLE</a>, MB_OK | MB_ICONERROR);
00058         ShowCursor(FALSE);
00059     }
00060 
00061     sys.deinit_directx();
00062 }
00063 
00064 <span class="comment">//------- End of function error_quit_game ------------//</span>
00065 
00066 <span class="comment">//------- Begin of function Error::Error ------------//</span>
<a name="l00071"></a><a class="code" href="classError.html#a0">00071</a> <span class="comment">Error::Error() {</span>
00072     _set_new_handler(new_func_handler);             <span class="comment">// set_new_handler() is a C++ function</span>
00073     <span class="comment">// ##### begin Gilbert 26/04/2001 #######//</span>
00074     _set_new_mode(1);                               <span class="comment">// malloc also call new_func_handler on error, useful for NO_MEM_CLASS</span>
00075     <span class="comment">// ##### end Gilbert 26/04/2001 #######//</span>
00076 
00077     extra_handler = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00078 }
00079 
00080 <span class="comment">//-------- End of function Error::Error --------------//</span>
00081 
00082 <span class="comment">//------- BEGIN OF FUNCTION Error::internal -----------//</span>
00083 <span class="comment">//</span>
00084 <span class="comment">// sample error message :</span>
00085 <span class="comment">//</span>
00086 <span class="comment">// Exit : Insufficient Memory</span>
00087 <span class="comment">// File : ODYNARR.CPP</span>
00088 <span class="comment">// Line : 453</span>
00089 <span class="comment">//</span>
00090 <span class="comment">// Continue ?</span>
00091 <span class="comment">//</span>
00092 <span class="comment">// &lt;char*&gt; errMsg   - the error message</span>
00093 <span class="comment">// &lt;char*&gt; fileName - the file name of the CPP function cause error</span>
00094 <span class="comment">//                    usually is __FILE__</span>
00095 <span class="comment">// &lt;int&gt;   lineNum  - the line number of program cause error</span>
00096 <span class="comment">//                    usually is __LINE__</span>
00097 <span class="comment">//</span>
<a name="l00098"></a><a class="code" href="classError.html#a1">00098</a> <span class="keywordtype">void</span> <a class="code" href="classError.html#a1">Error::internal</a>(<span class="keywordtype">char</span>* errMsg,<span class="keywordtype">char</span>* fileName,<span class="keywordtype">int</span> lineNum) {
00099     <span class="keywordflow">if</span>( error_flag )                                <span class="comment">// prevent error message dead loop</span>
00100         <span class="keywordflow">return</span>;
00101 
00102     error_flag=1;
00103 
00104     <span class="comment">//-------------------------------------------------//</span>
00105 
00106     <span class="keywordtype">char</span> strBuf[100];
00107 
00108     <span class="keywordflow">if</span>( extra_handler )                             <span class="comment">// all the extra error handler first</span>
00109         (*extra_handler)();
00110 
00111     <span class="keywordflow">if</span>( errMsg )
00112         sprintf(strBuf, <span class="stringliteral">"Error : %s\nFile : %s\nLine : %d\n"</span>, errMsg,fileName,lineNum );
00113     <span class="keywordflow">else</span>
00114         sprintf(strBuf, <span class="stringliteral">"Error on File : %s\nLine : %d\n"</span>,fileName,lineNum );
00115 
00116     <span class="comment">//-------- display error message -------//</span>
00117     OutputDebugString( strBuf );
00118 
00119     error_quit_game(strBuf);
00120     exit( -2 );
00121 }
00122 
00123 <span class="comment">//--------- END OF FUNCTION Error::internal ----------//</span>
00124 
00125 <span class="comment">//------- BEGIN OF FUNCTION Error::mem -----------//</span>
00126 <span class="comment">//</span>
00127 <span class="comment">// There is no memory left to save the screen, so don't use v_pop.ask(),</span>
00128 <span class="comment">// direct output to screen.</span>
00129 <span class="comment">//</span>
<a name="l00130"></a><a class="code" href="classError.html#a2">00130</a> <span class="keywordtype">void</span> <a class="code" href="classError.html#a2">Error::mem</a>() {
00131     <span class="keywordflow">if</span>( error_flag )                                <span class="comment">// prevent error message dead loop</span>
00132         <span class="keywordflow">return</span>;
00133 
00134     error_flag=1;
00135 
00136     <span class="comment">//-------------------------------------------------//</span>
00137 
00138     <span class="keywordflow">if</span>( extra_handler )
00139         (*extra_handler)();
00140 
00141     <span class="keywordtype">char</span>* strBuf = <span class="stringliteral">"Insufficient Memory, execution interrupt."</span>;
00142 
00143     <span class="comment">//-------- display error message -------//</span>
00144 
00145     OutputDebugString( strBuf );
00146     error_quit_game(strBuf);
00147     exit( -2 );
00148 }
00149 
00150 <span class="comment">//--------- END OF FUNCTION Error::mem ----------//</span>
00151 
00152 <span class="comment">//------- BEGIN OF FUNCTION Error::msg -----------//</span>
00153 <span class="comment">//</span>
00154 <span class="comment">// &lt;char*&gt; formated erorr message with % argument</span>
00155 <span class="comment">// &lt;....&gt;  the argument list</span>
00156 <span class="comment">//</span>
<a name="l00157"></a><a class="code" href="classError.html#a3">00157</a> <span class="keywordtype">void</span> <a class="code" href="classError.html#a3">Error::msg</a>( <span class="keywordtype">char</span> *format, ... ) {
00158     <span class="keywordflow">if</span>( error_flag )                                <span class="comment">// prevent error message dead loop</span>
00159         <span class="keywordflow">return</span>;
00160 
00161     error_flag=1;
00162 
00163     <span class="comment">//-------------------------------------------------//</span>
00164 
00165     <span class="comment">//---- translate the message and the arguments into one message ----//</span>
00166 
00167     <span class="keywordtype">char</span> strBuf[100];
00168 
00169     va_list argPtr;                                 <span class="comment">// the argument list structure</span>
00170 
00171     va_start( argPtr, format );
00172     vsprintf( strBuf, format, argPtr );
00173 
00174     va_end( argPtr );
00175 
00176     <span class="comment">//-------- display error message -------//</span>
00177 
00178     OutputDebugString( strBuf );
00179     error_quit_game(strBuf);
00180     error_flag = 0;                                 <span class="comment">// this error does not exit program</span>
00181 }
00182 
00183 <span class="comment">//--------- END OF FUNCTION Error::msg ----------//</span>
00184 
00185 <span class="comment">//------- BEGIN OF FUNCTION Error::run --------//</span>
00186 <span class="comment">//</span>
00187 <span class="comment">// &lt;char*&gt; formated erorr message with % argument</span>
00188 <span class="comment">// &lt;....&gt;  the argument list</span>
00189 <span class="comment">//</span>
<a name="l00190"></a><a class="code" href="classError.html#a4">00190</a> <span class="keywordtype">void</span> <a class="code" href="classError.html#a4">Error::run</a>( <span class="keywordtype">char</span> *format, ... ) {
00191     <span class="keywordflow">if</span>( error_flag )                                <span class="comment">// prevent error message dead loop</span>
00192         <span class="keywordflow">return</span>;
00193 
00194     error_flag=1;
00195 
00196     <span class="comment">//-------------------------------------------------//</span>
00197 
00198     <span class="keywordflow">if</span>( extra_handler )
00199         (*extra_handler)();
00200 
00201     <span class="comment">//---- translate the message and the arguments into one message ----//</span>
00202 
00203     <span class="keywordtype">char</span> strBuf[100];
00204 
00205     va_list argPtr;                                 <span class="comment">// the argument list structure</span>
00206 
00207     va_start( argPtr, format );
00208     vsprintf( strBuf, format, argPtr );
00209 
00210     va_end( argPtr );
00211 
00212     <span class="comment">//-------- display error message -------//</span>
00213 
00214     OutputDebugString( strBuf );
00215     error_quit_game(strBuf);
00216     exit( -2 );
00217 }
00218 
00219 <span class="comment">//---------- END OF FUNCTION Error::run -----------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:28 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
