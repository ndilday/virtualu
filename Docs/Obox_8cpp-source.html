<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Obox.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Obox.cpp</h1><a href="Obox_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OBOX.CPP</span>
00002 <span class="comment">//Description : A collection of box objects</span>
00003 
00004 <span class="preprocessor">#include &lt;string.h&gt;</span>
00005 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00006 <span class="preprocessor">#include &lt;stdarg.h&gt;</span>
00007 <span class="preprocessor">#include &lt;time.H&gt;</span>
00008 
00009 <span class="preprocessor">#include &lt;<a class="code" href="KEY_8H.html">KEY.H</a>&gt;</span>
00010 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00011 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00012 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00013 <span class="preprocessor">#include &lt;OFONT.H&gt;</span>
00014 <span class="preprocessor">#include &lt;OBUTTON.H&gt;</span>
00015 <span class="preprocessor">#include &lt;<a class="code" href="OIMGRES_8H.html">OIMGRES.H</a>&gt;</span>
00016 <span class="preprocessor">#include &lt;OIFACE.H&gt;</span>
00017 <span class="preprocessor">#include &lt;<a class="code" href="OPOWER_8H.html">OPOWER.H</a>&gt;</span>
00018 <span class="preprocessor">#include &lt;<a class="code" href="OBOX_8H.html">OBOX.H</a>&gt;</span>
00019 <span class="preprocessor">#include &lt;<a class="code" href="OMOUSECR_8H.html">OMOUSECR.H</a>&gt;</span>
00020 <span class="preprocessor">#include &lt;<a class="code" href="OVALSLDR_8H.html">OVALSLDR.H</a>&gt;</span>
00021 
00022 <span class="comment">//----------- Define constant -------------//</span>
00023 
00024 <span class="keyword">enum</span> {
00025     <a class="code" href="Obox_8cpp.html#a10a0">BOX_LINE_SPACE</a>    = 8,
00026     <a class="code" href="Obox_8cpp.html#a10a1">MAX_BOX_WIDTH</a>     = 600,
00027     <a class="code" href="Obox_8cpp.html#a10a2">BOX_X_MARGIN</a>      = 30,                         <span class="comment">// Horizontal margin</span>
00028     <a class="code" href="Obox_8cpp.html#a10a3">BOX_TOP_MARGIN</a>    = 20,
00029     <a class="code" href="Obox_8cpp.html#a10a4">BOX_BUTTON_MARGIN</a> = 32,
00030     <a class="code" href="Obox_8cpp.html#a10a5">BOX_BOTTOM_MARGIN</a> = 42                          <span class="comment">// margin for display the box button</span>
00031 };
00032 
00033 <span class="comment">//------- constant for arrow box ----------//</span>
00034 
00035 <span class="keyword">enum</span> {                                            <span class="comment">// Height of the thick end of the arrow</span>
00036     <a class="code" href="Obox_8cpp.html#a11a6">ARROW_HEIGHT</a>     = 20,
00037     <a class="code" href="Obox_8cpp.html#a11a7">ARROW_MARGIN</a>     = 10,                          <span class="comment">// Y margin of the arrow between the box top</span>
00038     <a class="code" href="Obox_8cpp.html#a11a8">ARROW_X_DISTANCE</a> = 40,                          <span class="comment">// X distance of the object to the box</span>
00039     <a class="code" href="Obox_8cpp.html#a11a9">ARROW_Y_DISTANCE</a> = 35                           <span class="comment">// Y distance of the object to the box</span>
00040 };
00041 
00042 <span class="comment">//----- Define static member variables ------//</span>
00043 
<a name="l00044"></a><a class="code" href="classBox.html#p0">00044</a> <span class="keywordtype">char</span> <a class="code" href="classBox.html#p0">Box::opened_flag</a>=0;
00045 
00046 <span class="comment">//----------- Begin of function Box::open ---------//</span>
<a name="l00056"></a><a class="code" href="classBox.html#a6">00056</a> <span class="comment">void Box::open(int inX1, int inY1, int inX2, int inY2, int downCentre) {</span>
00057     box_x1 = inX1;
00058     box_y1 = inY1;
00059     box_x2 = inX2;
00060     box_y2 = inY2;
00061 
00062     paint( downCentre );
00063 }
00064 
00065 <span class="comment">//------------ End of function Box::open -----------//</span>
00066 
00067 <span class="comment">//----------- Begin of function Box::open ---------//</span>
<a name="l00076"></a><a class="code" href="classBox.html#a7">00076</a> <span class="comment">void Box::open(int boxWidth, int boxHeight, int downCentre) {</span>
00077     box_x1 = (<a class="code" href="OVGA_8H.html#a0">VGA_WIDTH</a>-boxWidth) / 2;
00078     box_x2 = box_x1 + boxWidth - 1;
00079 
00080     box_y1 = (<a class="code" href="OVGA_8H.html#a1">VGA_HEIGHT</a>-boxHeight) / 2;
00081     box_y2 = box_y1 + boxHeight - 1;
00082 
00083     paint( downCentre );
00084 }
00085 
00086 <span class="comment">//------------ End of function Box::open -----------//</span>
00087 
00088 <span class="comment">//----------- Begin of function Box::paint ---------//</span>
00089 
<a name="l00090"></a><a class="code" href="classBox.html#a8">00090</a> <span class="keywordtype">void</span> <a class="code" href="classBox.html#a8">Box::paint</a>(<span class="keywordtype">int</span> downCentre) {
00091     <a class="code" href="ALL_8H.html#a0">err_when</a>(<a class="code" href="classBox.html#p0">opened_flag</a>);                          <span class="comment">// double open</span>
00092 
00093     <span class="comment">// save to Vga::image_buf</span>
00094     vga_front.save_area_common_buf( <a class="code" href="classBox.html#m0">box_x1</a>, <a class="code" href="classBox.html#m1">box_y1</a>, <a class="code" href="classBox.html#m2">box_x2</a>, <a class="code" href="classBox.html#m3">box_y2</a> );
00095 
00096     vga_front.d3_panel_up( <a class="code" href="classBox.html#m0">box_x1</a>, <a class="code" href="classBox.html#m1">box_y1</a>, <a class="code" href="classBox.html#m2">box_x2</a>, <a class="code" href="classBox.html#m3">box_y2</a>, 2 );
00097 
00098     <span class="keywordflow">if</span>( downCentre )
00099         vga_front.d3_panel_down( <a class="code" href="classBox.html#m0">box_x1</a>+4, <a class="code" href="classBox.html#m1">box_y1</a>+4, <a class="code" href="classBox.html#m2">box_x2</a>-4, <a class="code" href="classBox.html#m3">box_y2</a>-4, 1 );
00100 
00101     user_interface.rect( <a class="code" href="classBox.html#m0">box_x1</a>, <a class="code" href="classBox.html#m1">box_y1</a>, <a class="code" href="classBox.html#m2">box_x2</a>, <a class="code" href="classBox.html#m3">box_y2</a>-2, 2 );
00102 
00103     <a class="code" href="classBox.html#p0">opened_flag</a> = 1;
00104 }
00105 
00106 <span class="comment">//------------ End of function Box::paint -----------//</span>
00107 
00108 <span class="comment">//----------- Begin of function Box::close --------//</span>
<a name="l00112"></a><a class="code" href="classBox.html#a9">00112</a> <span class="comment">void Box::close() {</span>
00113     <a class="code" href="ALL_8H.html#a0">err_when</a>(!opened_flag);                         <span class="comment">// double open</span>
00114 
00115     vga_back.rest_area_common_buf();
00116     vga.blt_buf(box_x1, box_y1, box_x2, box_y2);
00117 
00118     mouse.get_event();                              <span class="comment">// post the click, prevent effect on other windows</span>
00119 
00120     opened_flag = 0;
00121 }
00122 
00123 <span class="comment">//------------ End of function Box::close -----------//</span>
00124 
00125 <span class="comment">//----------- Begin of function Box::calc_size ------//</span>
<a name="l00134"></a><a class="code" href="classBox.html#a10">00134</a> <span class="comment">void Box::calc_size(char* msgStr, int minHeight, int x1, int y1) {</span>
00135     <span class="keywordtype">int</span> width  = <a class="code" href="Obox_8cpp.html#a10a2">BOX_X_MARGIN</a>*2 + font_chartsm.text_width(msgStr, -1, <a class="code" href="Obox_8cpp.html#a10a1">MAX_BOX_WIDTH</a>-<a class="code" href="Obox_8cpp.html#a10a2">BOX_X_MARGIN</a>*2)+1;
00136     <span class="keywordtype">int</span> height = minHeight + font_chartsm.text_height(<a class="code" href="Obox_8cpp.html#a10a0">BOX_LINE_SPACE</a>);
00137 
00138     <span class="keywordflow">if</span>( x1 &lt; 0 ) {
00139         box_x1 = (<a class="code" href="OVGA_8H.html#a0">VGA_WIDTH</a>  - width)  / 2;
00140         box_y1 = (<a class="code" href="OVGA_8H.html#a1">VGA_HEIGHT</a> - height) / 2;
00141     }
00142     <span class="keywordflow">else</span> {
00143         box_x1 = x1;
00144         box_y1 = y1;
00145     }
00146 
00147     box_x2 = box_x1+width-1;
00148     box_y2 = box_y1+height;
00149 }
00150 
00151 <span class="comment">//---------- End of function Box::calc_size -------------//</span>
00152 
00153 <span class="comment">//---------- Begin of function Box::ok_button ---------//</span>
<a name="l00159"></a><a class="code" href="classBox.html#a13">00159</a> <span class="comment">void Box::ok_button(int timeOut) {</span>
00160     <a class="code" href="classButton.html">Button</a> button;
00161 
00162     button.<a class="code" href="classButton.html#a11">paint_text</a>( box_x1+(box_x2-box_x1+1)/2-10, box_y2-<a class="code" href="Obox_8cpp.html#a10a4">BOX_BUTTON_MARGIN</a>, <span class="stringliteral">"Ok"</span> );
00163 
00164     <span class="comment">//  if( sys.debug_session )</span>
00165     sys.blt_virtual_buf();
00166 
00167     button.<a class="code" href="classButton.html#a28">wait_press</a>(timeOut);
00168 }
00169 
00170 <span class="comment">//------------ End of function Box::ok_button ---------//</span>
00171 
00172 <span class="comment">//---------- Begin of function Box::ask_button ---------//</span>
<a name="l00181"></a><a class="code" href="classBox.html#a11">00181</a> <span class="comment">int Box::ask_button(char* buttonDes1, char* buttonDes2, int rightClickClose) {</span>
00182     <span class="keywordtype">int</span> width;
00183 
00184     width = box_x2-box_x1+1;
00185 
00186     <a class="code" href="classButton.html">Button</a> buttonOk, buttonCancel;
00187 
00188     <span class="keywordtype">int</span> buttonWidth1 = 20 + font_chartsm.text_width(buttonDes1 ? buttonDes1 : <span class="stringliteral">"Ok"</span>);
00189 
00190     buttonOk.<a class="code" href="classButton.html#a10">create_text</a>( box_x1+width/2-buttonWidth1-5, box_y2-<a class="code" href="Obox_8cpp.html#a10a4">BOX_BUTTON_MARGIN</a>,
00191                           (buttonDes1 ? buttonDes1 : <span class="stringliteral">"Ok"</span>) );
00192 
00193     <span class="comment">//## begin zhoubin  000329</span>
00194     <span class="comment">//   buttonCancel.create_text( box_x1+width/2-7 , box_y2-BOX_BUTTON_MARGIN,</span>
00195     <span class="comment">//                       (buttonDes2 ? buttonDes2 : "Cancel") );</span>
00196     buttonCancel.<a class="code" href="classButton.html#a10">create_text</a>( box_x1+width/2+5 , box_y2-<a class="code" href="Obox_8cpp.html#a10a4">BOX_BUTTON_MARGIN</a>,
00197                               (buttonDes2 ? buttonDes2 : <span class="stringliteral">"Cancel"</span>) );
00198     <span class="comment">//## end zhoubin    000329</span>
00199 
00200     buttonOk.<a class="code" href="classButton.html#a20">paint</a>();                               <span class="comment">// paint button</span>
00201     buttonCancel.<a class="code" href="classButton.html#a20">paint</a>();
00202 
00203     <span class="comment">//  if( sys.debug_session )</span>
00204     sys.blt_virtual_buf();
00205 
00206     <span class="comment">//..........................................//</span>
00207     mouse_cursor.set_icon(<a class="code" href="OMOUSECR_8H.html#a6a3">CURSOR_NORMAL</a>);
00208     <span class="keywordflow">while</span>( 1 ) {
00209         sys.yield();
00210         mouse.get_event();
00211 
00212         <span class="comment">//              if( sys.debug_session )</span>
00213         sys.blt_virtual_buf();
00214 
00215         <span class="keywordflow">if</span>( buttonOk.<a class="code" href="classButton.html#a21">detect</a>(buttonOk.<a class="code" href="classButton.html#m11">str_buf</a>[0], <a class="code" href="KEY_8H.html#a3">KEY_RETURN</a>) )
00216             <span class="keywordflow">return</span> 1;
00217 
00218         <span class="keywordflow">if</span>( buttonCancel.<a class="code" href="classButton.html#a21">detect</a>(buttonCancel.<a class="code" href="classButton.html#m11">str_buf</a>[0], <a class="code" href="KEY_8H.html#a2">KEY_ESC</a>)
00219             <span class="comment">// detect right button only when the button is "Cancel"</span>
00220             || (rightClickClose &amp;&amp; mouse.single_click(1)) ) {
00221             mouse.get_event();
00222             <span class="keywordflow">return</span> 0;
00223         }
00224     }
00225 }
00226 
00227 <span class="comment">//--------- End of function Box::ask_button --------//</span>
00228 
00229 <span class="comment">//---------- Begin of function Box::ask_button ---------//</span>
<a name="l00237"></a><a class="code" href="classBox.html#a12">00237</a> <span class="comment">void Box::ask_button(Button&amp; buttonOk, Button&amp; buttonCancel, char* strOk, char* strCancel ) {</span>
00238     <span class="keywordtype">int</span> width;
00239 
00240     width = box_x2-box_x1+1;
00241 
00242     buttonOk.<a class="code" href="classButton.html#a10">create_text</a>( box_x1+width/2-36, box_y2-<a class="code" href="Obox_8cpp.html#a10a4">BOX_BUTTON_MARGIN</a>,
00243                           (strOk ? strOk : <span class="stringliteral">"Ok"</span>) );
00244 
00245     buttonCancel.<a class="code" href="classButton.html#a10">create_text</a>( box_x1+width/2+2 , box_y2-<a class="code" href="Obox_8cpp.html#a10a4">BOX_BUTTON_MARGIN</a>,
00246                               (strCancel  ? strCancel  : <span class="stringliteral">"Cancel"</span>) );
00247 
00248     buttonOk.<a class="code" href="classButton.html#a20">paint</a>();                               <span class="comment">// paint button</span>
00249     buttonCancel.<a class="code" href="classButton.html#a20">paint</a>();
00250 
00251     <span class="comment">//  if( sys.debug_session )</span>
00252     sys.blt_virtual_buf();
00253 }
00254 
00255 <span class="comment">//--------- End of function Box::ask_button ---------//</span>
00256 
00257 <span class="comment">//------- Begin of function Box::ask ----------//</span>
<a name="l00273"></a><a class="code" href="classBox.html#a0">00273</a> <span class="comment">int Box::ask(char* msgStr, char* buttonDes1, char* buttonDes2, int x1, int y1) {</span>
00274     <span class="keywordtype">int</span> rc;
00275 
00276     <span class="comment">// calculate x1, y1, x2, y2 depended on the msgStr</span>
00277     calc_size(msgStr,<a class="code" href="Obox_8cpp.html#a10a3">BOX_TOP_MARGIN</a>+<a class="code" href="Obox_8cpp.html#a10a5">BOX_BOTTOM_MARGIN</a>,x1,y1);
00278 
00279     vga.use_front();
00280 
00281     paint(1);
00282 
00283     font_chartsm.put_paragraph( box_x1+<a class="code" href="Obox_8cpp.html#a10a2">BOX_X_MARGIN</a>, box_y1+<a class="code" href="Obox_8cpp.html#a10a3">BOX_TOP_MARGIN</a>, box_x2-<a class="code" href="Obox_8cpp.html#a10a2">BOX_X_MARGIN</a>,
00284                                 box_y2-<a class="code" href="Obox_8cpp.html#a10a5">BOX_BOTTOM_MARGIN</a>, msgStr, <a class="code" href="Obox_8cpp.html#a10a0">BOX_LINE_SPACE</a> );
00285 
00286     sys.yield();
00287 
00288     rc = ask_button(buttonDes1, buttonDes2);
00289 
00290     close();
00291 
00292     <span class="keywordflow">return</span> rc;
00293 }
00294 
00295 <span class="comment">//---------- End of function Box::ask ----------//</span>
00296 
00297 <span class="comment">//------- Begin of function Box::msg ----------//</span>
<a name="l00309"></a><a class="code" href="classBox.html#a1">00309</a> <span class="comment">void Box::msg(char* msgStr, int enableTimeOut, int x1, int y1) {</span>
00310     <span class="keywordtype">int</span> savedUseBack = vga.use_back_buf;
00311 
00312     vga.use_front();
00313 
00314     <span class="comment">// calculate x1, y1, x2, y2 depended on the msgStr</span>
00315     calc_size(msgStr,<a class="code" href="Obox_8cpp.html#a10a3">BOX_TOP_MARGIN</a>+<a class="code" href="Obox_8cpp.html#a10a5">BOX_BOTTOM_MARGIN</a>,x1,y1);
00316 
00317     paint(1);
00318 
00319     font_chartsm.put_paragraph( box_x1+<a class="code" href="Obox_8cpp.html#a10a2">BOX_X_MARGIN</a>, box_y1+<a class="code" href="Obox_8cpp.html#a10a3">BOX_TOP_MARGIN</a>, box_x2-<a class="code" href="Obox_8cpp.html#a10a2">BOX_X_MARGIN</a>,
00320                                 box_y2-<a class="code" href="Obox_8cpp.html#a10a5">BOX_BOTTOM_MARGIN</a>, msgStr, <a class="code" href="Obox_8cpp.html#a10a0">BOX_LINE_SPACE</a> );
00321 
00322     sys.blt_virtual_buf();                          <span class="comment">// blt tihe vrtual front buffer to the screen</span>
00323 
00324     ok_button(enableTimeOut);
00325     close();
00326 
00327     <span class="keywordflow">if</span>( savedUseBack )
00328         vga.use_back();
00329 }
00330 
00331 <span class="comment">//---------- End of function Box::msg ----------//</span>
00332 
00333 <span class="comment">//------- Begin of function Box::progress ----------//</span>
<a name="l00345"></a><a class="code" href="classBox.html#a2">00345</a> <span class="comment">void Box::progress(int progressVal, int enableTimeOut, int x1, int y1) {</span>
00346     <span class="keywordtype">int</span> savedUseBack = vga.use_back_buf;
00347     <span class="comment">//  static char msgStr1[80]="A new game is being generated ....";</span>
00348     <span class="comment">//  static char msgStr2[80]="Note that all dollars in the game are in thousands.";</span>
00349 
00350     progress_val=(int)(progressVal*8)/100;
00351 
00352     <span class="keywordflow">if</span>(progress_val&gt;7)progress_val=7;
00353     vga.use_front();
00354     image_interface.put_front(101,192,<span class="stringliteral">"IBASE"</span>);
00355 
00356     <a class="code" href="classString.html">String</a> str(<span class="stringliteral">"IBASE"</span>);
00357     str+=progress_val;
00358     <span class="keywordflow">if</span>(progress_val&gt;0)
00359         image_interface.put_front(236,250,str.<a class="code" href="classString.html#m0">str_buf</a>);
00360 
00361     <span class="comment">//  calc_size(msgStr2,BOX_TOP_MARGIN+BOX_BOTTOM_MARGIN,x1,y1);   // calculate x1, y1, x2, y2 depended on the msgStr</span>
00362     <span class="comment">//  box_y1-=30;</span>
00363     <span class="comment">//  vga_front.d3_panel_up( box_x1, box_y1, box_x2, box_y2, 2 );</span>
00364     <span class="comment">//  vga_front.d3_panel_down( box_x1+4, box_y1+4, box_x2-4, box_y2-4, 1 );</span>
00365 
00366     <span class="comment">//  ValueSlider slider1;</span>
00367     <span class="comment">//  slider1.init(box_x1+20,(box_y1+box_y2)/2-8, box_x2-box_x1-40, 17,</span>
00368     <span class="comment">//                                                                  0,100,&amp;progress_val,0, V_PINK,3);</span>
00369     <span class="comment">//  slider1.paint();</span>
00370 
00371     <span class="comment">//  font_chartsm.put( box_x1+BOX_X_MARGIN, box_y1+BOX_TOP_MARGIN, msgStr1);</span>
00372 
00373     <span class="comment">//  font_chartsm.put( box_x1+BOX_X_MARGIN, box_y2-BOX_TOP_MARGIN-10, msgStr2);</span>
00374 
00375     sys.blt_virtual_buf();                          <span class="comment">// blt the vrtual front buffer to the screen</span>
00376 
00377     <span class="keywordflow">if</span>( savedUseBack )
00378         vga.use_back();
00379 }
00380 
00381 <span class="comment">//---------- End of function Box::progress ----------//</span>
00382 
<a name="l00383"></a><a class="code" href="classBox.html#a3">00383</a> <span class="keywordtype">void</span> <a class="code" href="classBox.html#a3">Box::progress_update</a>(<span class="keywordtype">int</span> progressVal, <span class="keywordtype">int</span> enableTimeOut, <span class="keywordtype">int</span> x1, <span class="keywordtype">int</span> y1) {
00384     <span class="keywordtype">int</span> savedUseBack = vga.use_back_buf;
00385     <span class="comment">//  static int progress_val;</span>
00386     <a class="code" href="classBox.html#m7">progress_val</a>=min(progressVal,100);
00387 
00388     sys.yield();
00389     vga.use_front();
00390     <span class="comment">//  calc_size(msgStr,BOX_TOP_MARGIN+BOX_BOTTOM_MARGIN,x1,y1);   // calculate x1, y1, x2, y2 depended on the msgStr</span>
00391 
00392     <span class="comment">//  ValueSlider slider1;</span>
00393     <span class="comment">//  slider1.init(box_x1+20,(box_y1+box_y2)/2-8, box_x2-box_x1-40, 16,</span>
00394     <span class="comment">//                                                                  0,100,&amp;progress_val,0, V_PINK,3);</span>
00395     <span class="comment">//  slider1.paint();</span>
00396 
00397     <a class="code" href="classBox.html#m7">progress_val</a>=(int)(progressVal*8)/100;
00398 
00399     <span class="keywordflow">if</span>(<a class="code" href="classBox.html#m7">progress_val</a>&gt;7)<a class="code" href="classBox.html#m7">progress_val</a>=7;
00400     vga.use_front();
00401 
00402     <a class="code" href="classString.html">String</a> str(<span class="stringliteral">"IBASE"</span>);
00403     str+=<a class="code" href="classBox.html#m7">progress_val</a>;
00404     <span class="keywordflow">if</span>(<a class="code" href="classBox.html#m7">progress_val</a>&gt;0)
00405         image_interface.put_front(236,249,str.<a class="code" href="classString.html#m0">str_buf</a>);
00406 
00407     sys.blt_virtual_buf();                          <span class="comment">// blt the virtual front buffer to the screen</span>
00408 
00409     <span class="keywordflow">if</span>( savedUseBack )
00410         vga.use_back();
00411 }
00412 
00413 <span class="comment">//------- Begin of function Box::print ----------//</span>
<a name="l00420"></a><a class="code" href="classBox.html#a4">00420</a> <span class="comment">void Box::print(char* formatStr, ... ) {</span>
00421     <span class="comment">//---- format the message and the arguments into one message ----//</span>
00422 
00423     <span class="keyword">enum</span> { RESULT_STR_LEN=200 };
00424 
00425     <span class="keyword">static</span> <span class="keywordtype">char</span> resultStr[RESULT_STR_LEN+1];
00426 
00427     <span class="comment">// the length of the format string cannot &gt; 1/2 of the result string buffer length, the remaining 1/2 is reserved for substituted values.</span>
00428     <a class="code" href="ALL_8H.html#a0">err_when</a>( strlen(formatStr) &gt; RESULT_STR_LEN/2 );
00429 
00430     va_list argPtr;                                 <span class="comment">// the argument list structure</span>
00431 
00432     va_start( argPtr, formatStr );
00433     vsprintf( resultStr, formatStr, argPtr );
00434     va_end( argPtr );
00435 
00436     <span class="comment">//------------ display msg --------------//</span>
00437 
00438     msg(resultStr);
00439 }
00440 
00441 <span class="comment">//---------- End of function Box::print ----------//</span>
00442 
00443 <span class="comment">//------- Begin of function Box::tell ----------//</span>
<a name="l00453"></a><a class="code" href="classBox.html#a5">00453</a> <span class="comment">void Box::tell(char* tellStr, int x1, int y1) {</span>
00454     <span class="keywordtype">int</span> savedUseBack = vga.use_back_buf;
00455 
00456     vga.use_front();
00457 
00458     <span class="comment">// calculate x1, y1, x2, y2 depended on the tellStr</span>
00459     calc_size(tellStr,<a class="code" href="Obox_8cpp.html#a10a3">BOX_TOP_MARGIN</a>+<a class="code" href="Obox_8cpp.html#a10a5">BOX_BOTTOM_MARGIN</a>,x1,y1);
00460 
00461     opened_flag = 1;
00462 
00463     <span class="comment">// save to Vga::image_buf</span>
00464     vga_front.save_area_common_buf( box_x1, box_y1, box_x2, box_y2 );
00465     vga_front.d3_panel_up( box_x1, box_y1, box_x2, box_y2-20, 2 );
00466     vga_front.d3_panel_down( box_x1+4, box_y1+4, box_x2-4, box_y2-24, 1 );
00467     user_interface.rect( box_x1, box_y1, box_x2, box_y2-20, 2 );
00468 
00469     font_chartsm.put_paragraph(
00470         box_x1+<a class="code" href="Obox_8cpp.html#a10a2">BOX_X_MARGIN</a>, box_y1+<a class="code" href="Obox_8cpp.html#a10a3">BOX_TOP_MARGIN</a>, box_x2-<a class="code" href="Obox_8cpp.html#a10a2">BOX_X_MARGIN</a>,
00471         box_y2-<a class="code" href="Obox_8cpp.html#a10a5">BOX_BOTTOM_MARGIN</a>, tellStr, <a class="code" href="Obox_8cpp.html#a10a0">BOX_LINE_SPACE</a> );
00472 
00473     sys.blt_virtual_buf();                          <span class="comment">// blt tihe vrtual front buffer to the screen</span>
00474 
00475     <span class="keywordflow">if</span>( savedUseBack )
00476         vga.use_back();
00477 }
00478 
00479 <span class="comment">//---------- End of function Box::tell ----------//</span>
00480 
00481 <span class="comment">/*</span>
00482 <span class="comment"></span>
00483 <span class="comment">//-------- Begin of function Box::arrow_box ---------//</span>
00496 <span class="comment">void Box::arrow_box(char* boxText, char* boxTitle, int saveScrFlag)</span>
00497 <span class="comment">{</span>
00498 <span class="comment">save_scr_flag = saveScrFlag;</span>
00499 <span class="comment"></span>
00500 <span class="comment">if( saveScrFlag )</span>
00501 <span class="comment">{</span>
00502 <span class="comment">if( arrow_x == 0 )</span>
00503 <span class="comment">vga_front.save_scr( box_x1, box_y1, box_x2, box_y2 );</span>
00504 <span class="comment">else</span>
00505 <span class="comment">vga_front.save_scr( min(box_x1,arrow_x), min(box_y1,arrow_y), max(box_x2,arrow_x), max(box_y2,arrow_y) );</span>
00506 <span class="comment">}</span>
00507 <span class="comment"></span>
00508 <span class="comment">//------- Draw box (and arrow if specified object) ------//</span>
00509 <span class="comment"></span>
00510 <span class="comment">if( arrow_x )</span>
00511 <span class="comment">draw_arrow();</span>
00512 <span class="comment"></span>
00513 <span class="comment">vga_front.bar( box_x1, box_y1, box_x2, box_y2, V_WHITE );</span>
00514 <span class="comment"></span>
00515 <span class="comment">vga_front.bar( box_x1, box_y1, box_x2, box_y1+1, V_BLACK );        // Top border</span>
00516 <span class="comment">vga_front.bar( box_x1, box_y2-1, box_x2, box_y2, V_BLACK );        // Bottom border</span>
00517 <span class="comment">vga_front.bar( box_x1, box_y1, box_x1+1, box_y2, V_BLACK );        // Left border</span>
00518 <span class="comment">vga_front.bar( box_x2-1, box_y1, box_x2, box_y2, V_BLACK );        // Right border</span>
00519 <span class="comment"></span>
00520 <span class="comment">//--------- display description and text -----------//</span>
00521 <span class="comment"></span>
00522 <span class="comment">if( boxTitle &amp;&amp; boxTitle[0] )  // has tutor title</span>
00523 <span class="comment">{</span>
00524 <span class="comment">font_chartsm.put( box_x1+10, box_y1+10, boxTitle );</span>
00525 <span class="comment"></span>
00526 <span class="comment">vga_front.bar( box_x1, box_y1+ARROW_BOX_TITLE_HEIGHT, box_x2, box_y1+ARROW_BOX_TITLE_HEIGHT+1, V_BLACK );  // line between description and tutor text</span>
00527 <span class="comment"></span>
00528 <span class="comment">font_chartsm.put_paragraph( box_x1+ARROW_BOX_X_MARGIN, box_y1+ARROW_BOX_TITLE_HEIGHT+ARROW_BOX_Y_MARGIN,</span>
00529 <span class="comment">box_x2-ARROW_BOX_X_MARGIN, box_y2-ARROW_BOX_Y_MARGIN, boxText, ARROW_BOX_LINE_SPACE );</span>
00530 <span class="comment">}</span>
00531 <span class="comment">else</span>
00532 <span class="comment">{</span>
00533 <span class="comment">font_chartsm.put_paragraph( box_x1+ARROW_BOX_X_MARGIN, box_y1+ARROW_BOX_Y_MARGIN, box_x2-ARROW_BOX_X_MARGIN,</span>
00534 <span class="comment">box_y2-ARROW_BOX_Y_MARGIN, boxText, ARROW_BOX_LINE_SPACE );</span>
00535 <span class="comment">}</span>
00536 <span class="comment">}</span>
00537 <span class="comment">//---------- End of function Box::arrow_box ---------//</span>
00538 <span class="comment"></span>
00539 <span class="comment">//-------- Begin of function Box::close_arrow_box ---------//</span>
00540 <span class="comment"></span>
00541 <span class="comment">void Box::close_arrow_box()</span>
00542 <span class="comment">{</span>
00543 <span class="comment">if( save_scr_flag )</span>
00544 <span class="comment">{</span>
00545 <span class="comment">vga_front.rest_scr();</span>
00546 <span class="comment">save_scr_flag = 0;</span>
00547 <span class="comment">}</span>
00548 <span class="comment">}</span>
00549 <span class="comment">//-------- End of function Box::close_arrow_box ---------//</span>
00550 <span class="comment"></span>
00551 <span class="comment">//-------- Begin of function Box::calc_arrow_box ---------//</span>
00559 <span class="comment">void Box::calc_arrow_box(char* textPtr, int arrowX, int arrowY, int extraHeight)</span>
00560 <span class="comment">{</span>
00561 <span class="comment">int winWidth  = font_chartsm.text_width( textPtr, -1, ARROW_BOX_WIDTH-ARROW_BOX_X_MARGIN*2) + ARROW_BOX_X_MARGIN*2;</span>
00562 <span class="comment"></span>
00563 <span class="comment">int winHeight = ARROW_BOX_Y_MARGIN*2+font_chartsm.text_height(ARROW_BOX_LINE_SPACE);    // text_width() must be called before calling text_height()</span>
00564 <span class="comment"></span>
00565 <span class="comment">calc_arrow_box( winWidth, winHeight+extraHeight, arrowX, arrowY );</span>
00566 <span class="comment">}</span>
00567 <span class="comment">//--------- End of function Box::calc_arrow_box ---------//</span>
00568 <span class="comment"></span>
00569 <span class="comment">//-------- Begin of function Box::calc_arrow_box ---------//</span>
00576 <span class="comment">void Box::calc_arrow_box(int boxWidth, int boxHeight, int arrowX, int arrowY)</span>
00577 <span class="comment">{</span>
00578 <span class="comment">arrow_x = arrowX;</span>
00579 <span class="comment">arrow_y = arrowY;</span>
00580 <span class="comment"></span>
00581 <span class="comment">//---------- find the coordination of the arrow -------//</span>
00582 <span class="comment"></span>
00583 <span class="comment">if( arrow_x &lt; VGA_WIDTH/2 )</span>
00584 <span class="comment">{</span>
00585 <span class="comment">//------ Upper left part of the screen -------//</span>
00586 <span class="comment"></span>
00587 <span class="comment">if( arrow_y &lt; VGA_HEIGHT/2 )</span>
00588 <span class="comment">{</span>
00589 <span class="comment">box_x1  = arrow_x + ARROW_X_DISTANCE;</span>
00590 <span class="comment">box_y1  = arrow_y + ARROW_Y_DISTANCE;</span>
00591 <span class="comment">}</span>
00592 <span class="comment">else //----- Lower left part of the screen -------//</span>
00593 <span class="comment">{</span>
00594 <span class="comment">box_x1  = arrow_x + ARROW_X_DISTANCE;</span>
00595 <span class="comment">box_y1  = arrow_y - ARROW_Y_DISTANCE - boxHeight;</span>
00596 <span class="comment">}</span>
00597 <span class="comment">}</span>
00598 <span class="comment">else</span>
00599 <span class="comment">{</span>
00600 <span class="comment">//------- Upper right part of the screen ---------//</span>
00601 <span class="comment"></span>
00602 <span class="comment">if( arrow_y &lt; VGA_HEIGHT/2 )</span>
00603 <span class="comment">{</span>
00604 <span class="comment">box_x1  = arrow_x - ARROW_X_DISTANCE - boxWidth;</span>
00605 <span class="comment">box_y1  = arrow_y + ARROW_Y_DISTANCE;</span>
00606 <span class="comment">}</span>
00607 <span class="comment">else //----- Lower right part of the screen -------//</span>
00608 <span class="comment">{</span>
00609 <span class="comment">box_x1  = arrow_x - ARROW_X_DISTANCE - boxWidth;</span>
00610 <span class="comment">box_y1  = arrow_y - ARROW_Y_DISTANCE - boxHeight;</span>
00611 <span class="comment">}</span>
00612 <span class="comment">}</span>
00613 <span class="comment"></span>
00614 <span class="comment">//-----------------------------------------//</span>
00615 <span class="comment"></span>
00616 <span class="comment">box_x2 = box_x1 + boxWidth  - 1;</span>
00617 <span class="comment">box_y2 = box_y1 + boxHeight - 1;</span>
00618 <span class="comment"></span>
00619 <span class="comment">//-------- valid box_x1,box_y1,box_x2 and box_y2 ----------//</span>
00620 <span class="comment"></span>
00621 <span class="comment">if( box_x1 &lt; 0 )</span>
00622 <span class="comment">{</span>
00623 <span class="comment">box_x2 += -box_x1+10;</span>
00624 <span class="comment">box_x1 += -box_x1+10;</span>
00625 <span class="comment">}</span>
00626 <span class="comment"></span>
00627 <span class="comment">if( box_x2 &gt;= VGA_WIDTH )</span>
00628 <span class="comment">{</span>
00629 <span class="comment">box_x1 -= (box_x2-VGA_WIDTH)+10;</span>
00630 <span class="comment">box_x2 -= (box_x2-VGA_WIDTH)+10;</span>
00631 <span class="comment">}</span>
00632 <span class="comment"></span>
00633 <span class="comment">if( box_y1 &lt; 0 )</span>
00634 <span class="comment">{</span>
00635 <span class="comment">box_y2 += -box_y1+10;</span>
00636 <span class="comment">box_y1 += -box_y1+10;</span>
00637 <span class="comment">}</span>
00638 <span class="comment"></span>
00639 <span class="comment">if( box_y2 &gt;= VGA_HEIGHT )</span>
00640 <span class="comment">{</span>
00641 <span class="comment">box_y1 -= (box_y2-VGA_HEIGHT)+10;</span>
00642 <span class="comment">box_y2 -= (box_y2-VGA_HEIGHT)+10;</span>
00643 <span class="comment">}</span>
00644 <span class="comment">}</span>
00645 <span class="comment">//-------- End of function Box::calc_arrow_box ---------//</span>
00646 <span class="comment"></span>
00647 <span class="comment">//-------- Begin of function Box::draw_arrow ---------//</span>
00651 <span class="comment">void Box::draw_arrow()</span>
00652 <span class="comment">{</span>
00653 <span class="comment">    int tx2, ty2;</span>
00654 <span class="comment"></span>
00655 <span class="comment">//---------- find the coordination of the arrow -------//</span>
00656 <span class="comment"></span>
00657 <span class="comment">    if( arrow_x &lt; VGA_WIDTH/2 )</span>
00658 <span class="comment">    {</span>
00659 <span class="comment">//------ Upper left part of the screen -------//</span>
00660 <span class="comment"></span>
00661 <span class="comment">        if( arrow_y &lt; VGA_HEIGHT/2 )</span>
00662 <span class="comment">        {</span>
00663 <span class="comment">            tx2 = box_x1+1;</span>
00664 <span class="comment">            ty2 = box_y1+ARROW_MARGIN;</span>
00665 <span class="comment">        }</span>
00666 <span class="comment">        else //----- Lower left part of the screen -------//</span>
00667 <span class="comment">        {</span>
00668 <span class="comment">            tx2 = box_x1+1;</span>
00669 <span class="comment">            ty2 = box_y2-ARROW_MARGIN-ARROW_HEIGHT;</span>
00670 <span class="comment">        }</span>
00671 <span class="comment">    }</span>
00672 <span class="comment">    else</span>
00673 <span class="comment">    {</span>
00674 <span class="comment">//------- Upper right part of the screen ---------//</span>
00675 <span class="comment"></span>
00676 <span class="comment">        if( arrow_y &lt; VGA_HEIGHT/2 )</span>
00677 <span class="comment">        {</span>
00678 <span class="comment">            tx2 = box_x2-1;</span>
00679 <span class="comment">            ty2 = box_y1+ARROW_MARGIN;</span>
00680 <span class="comment">        }</span>
00681 <span class="comment">        else //----- Lower right part of the screen -------//</span>
00682 <span class="comment">        {</span>
00683 <span class="comment">            tx2 = box_x2-1;</span>
00684 <span class="comment">            ty2 = box_y2-ARROW_MARGIN-ARROW_HEIGHT;</span>
00685 <span class="comment">        }</span>
00686 <span class="comment">    }</span>
00687 <span class="comment"></span>
00688 <span class="comment">//-------- draw and fill the arrow --------//</span>
00689 <span class="comment"></span>
00690 <span class="comment">    int ty;</span>
00691 <span class="comment"></span>
00692 <span class="comment">    mouse.hide();</span>
00693 <span class="comment"></span>
00694 <span class="comment">    for( ty=ty2 ; ty&lt;=ty2+ARROW_HEIGHT ; ty++ )</span>
00695 <span class="comment">        VGAline( arrow_x, arrow_y, tx2, ty, V_WHITE );</span>
00696 <span class="comment"></span>
00697 <span class="comment">    VGAline( arrow_x, arrow_y, tx2, ty2, V_BLACK );</span>
00698 <span class="comment">    VGAline( arrow_x, arrow_y, tx2, ty2+ARROW_HEIGHT, V_BLACK );</span>
00699 <span class="comment"></span>
00700 <span class="comment">    mouse.show();</span>
00701 <span class="comment">}</span>
00702 <span class="comment">//---------- End of function Box::draw_arrow ---------//</span>
00703 <span class="comment"></span>
00704 <span class="comment">*/</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:16 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
