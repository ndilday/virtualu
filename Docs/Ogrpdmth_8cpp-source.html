<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Ogrpdmth.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Ogrpdmth.cpp</h1><a href="Ogrpdmth_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OGRPDMTH.CPP</span>
00002 <span class="comment">//Description : Object GraphDoubleBarMonth</span>
00003 <span class="comment">//Owner                 : Kevin(Ho)</span>
00004 
00005 <span class="comment">// The data is updated at 1st Sep of each year.</span>
00006 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00007 <span class="preprocessor">#include &lt;<a class="code" href="COLOR_8H.html">COLOR.H</a>&gt;</span>
00008 <span class="preprocessor">#include &lt;OFINANCE.H&gt;</span>
00009 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>
00010 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00011 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00012 <span class="preprocessor">#include &lt;OFONT.H&gt;</span>
00013 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00014 <span class="preprocessor">#include &lt;<a class="code" href="OGRPHYR_8H.html">OGRPHYR.H</a>&gt;</span>
00015 <span class="preprocessor">#include &lt;<a class="code" href="OGRPDMTH_8H.html">OGRPDMTH.H</a>&gt;</span>
00016 <span class="preprocessor">#include &lt;OIFACE.H&gt;</span>
00017 <span class="preprocessor">#include &lt;math.h&gt;</span>
00018 
00019 <span class="comment">//--------- Define macro constant -----------//</span>
00020 
<a name="l00021"></a><a class="code" href="Ogrpdmth_8cpp.html#a0">00021</a> <span class="preprocessor">#define MAX_LEN_LABEL "00,000,000"</span>
00022 <span class="preprocessor"></span>
00023 <span class="keyword">static</span> <span class="keywordtype">int</span> default_series_color[] = {
00024     <a class="code" href="COLOR_8H.html#a21">V_BLUE</a>,
00025     <a class="code" href="COLOR_8H.html#a20">V_GREEN</a>,
00026     <a class="code" href="COLOR_8H.html#a19">V_RED</a>,
00027     <a class="code" href="COLOR_8H.html#a25">V_YELLOW</a>,
00028     <a class="code" href="COLOR_8H.html#a22">V_VIOLET</a>,
00029     <a class="code" href="COLOR_8H.html#a23">V_BROWN</a>,
00030     <a class="code" href="COLOR_8H.html#a18">V_ORANGE</a>,
00031     <a class="code" href="COLOR_8H.html#a24">V_PINK</a>,
00032     <a class="code" href="COLOR_8H.html#a15">V_BLACK</a>,
00033     <a class="code" href="COLOR_8H.html#a17">V_WHITE</a>,
00034 };                                                <span class="comment">// 10 default series colors</span>
00035 
00036 <span class="keyword">enum</span> {  <a class="code" href="Ogrpdmth_8cpp.html#a8a3">DEFAULT_SERIES_COLOR_NUM</a> = 10 };
00037 
00038 <span class="keyword">enum</span> {
00039     <a class="code" href="Ogrpdmth_8cpp.html#a9a4">LEGEND_SIZE</a> = 11,
00040     <a class="code" href="Ogrpdmth_8cpp.html#a9a5">LEGEND_X_SPACING</a> = 12,
00041     <a class="code" href="Ogrpdmth_8cpp.html#a9a6">LEGEND_Y_SPACING</a> = 2,
00042 };
00043 
00044 <span class="keyword">enum</span> {  <a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a> = 2         };
00045 
00046 <span class="comment">//-------------- Define static vars ------------//</span>
00047 
00048 <span class="comment">//static char paint_flag = 0;</span>
00049 <span class="keyword">static</span> info_graph_doublebar_month;
00050 
00051 <span class="comment">//-------- Begin of function GraphDoubleBarMonth::GraphDoubleBarMonth ----//</span>
<a name="l00053"></a><a class="code" href="classGraphDoubleBarMonth.html#a0">00053</a> <span class="comment">GraphDoubleBarMonth::GraphDoubleBarMonth() {</span>
00054     init_flag = 0;
00055     graph_bitmap = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00056 }
00057 
00058 <span class="comment">//---------- End of function GraphDoubleBarMonth::GraphDoubleBarMonth ----//</span>
00059 
00060 <span class="comment">//-------- Begin of function GraphDoubleBarMonth::~GraphDoubleBarMonth -----//</span>
<a name="l00062"></a><a class="code" href="classGraphDoubleBarMonth.html#a1">00062</a> <span class="comment">GraphDoubleBarMonth::~GraphDoubleBarMonth() {</span>
00063     deinit();
00064 }
00065 
00066 <span class="comment">//---------- End of function GraphDoubleBarMonth::~GraphDoubleBarMonth -----//</span>
00067 
00068 <span class="comment">//-------- Begin of function GraphDoubleBarMonth::init --------//</span>
00102 <span class="comment">void GraphDoubleBarMonth::init(int x1, int y1, int x2, int y2,</span>
00103                                <span class="keywordtype">int</span> seriesNum, <span class="keywordtype">int</span> *dataNum,
00104                                <span class="keywordtype">void</span> *dataArray, <span class="keywordtype">char</span> dataTypeFlag,
00105                                <span class="keywordtype">int</span> thisMonthIndicator,
00106                                <span class="keywordtype">char</span> *xLabel, <span class="keywordtype">char</span> *yLabel,
00107                                <span class="keywordtype">char</span> **legendArray, <span class="keywordtype">char</span> transparentFlag,
00108                                <span class="keywordtype">char</span> orientationFlag, <span class="keywordtype">char</span> valueFlag,
00109                                <span class="keywordtype">int</span> numFormat, <span class="keywordtype">int</span> *seriesColor, <span class="keywordtype">int</span> axisColor) {
00110     <a class="code" href="ALL_8H.html#a0">err_when</a>(seriesNum &gt; <a class="code" href="Ogrpdmth_8cpp.html#a8a3">DEFAULT_SERIES_COLOR_NUM</a> &amp;&amp; !seriesColor);
00111     <a class="code" href="ALL_8H.html#a0">err_when</a>(seriesNum &lt;= 0);
00112 
00113     graph_width = x2 - x1 - 6;
00114 
00115     <a class="code" href="ALL_8H.html#a0">err_when</a>(graph_width &lt; 0);
00116 
00117     graph_x1 = x1;
00118     graph_y1 = y1;
00119     graph_x2 = x2;
00120     graph_y2 = y2;
00121     series_num = seriesNum;
00122     data_num = dataNum;
00123     data_array = dataArray;
00124     data_type_flag = dataTypeFlag;
00125 
00126     x_label = xLabel;
00127     y_label = yLabel;
00128     legend_array = legendArray;
00129 
00130     transparent_flag = transparentFlag;
00131     orientation_flag = orientationFlag;
00132     value_flag = valueFlag;
00133     num_format = numFormat;
00134 
00135     series_color = seriesColor ? seriesColor : default_series_color;
00136     axis_color = axisColor;
00137 
00138     init_flag = 1;
00139     this_month_indicator = thisMonthIndicator;
00140     y_label_max_len = font_chartsm.text_width(<a class="code" href="Ogrpdmth_8cpp.html#a0">MAX_LEN_LABEL</a>);
00141     set_font(&amp;font_chartsm);
00142 }
00143 
00144 <span class="comment">//------------- End of function GraphDoubleBarMonth::init -----------//</span>
00145 
00146 <span class="comment">//-------- Begin of function GraphDoubleBarMonth::deinit ------------//</span>
<a name="l00148"></a><a class="code" href="classGraphDoubleBarMonth.html#a7">00148</a> <span class="comment">void GraphDoubleBarMonth::deinit() {</span>
00149     <span class="keywordflow">if</span> (graph_bitmap) {
00150         <a class="code" href="ALL_8H.html#a8">mem_del</a>(graph_bitmap);
00151         graph_bitmap = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00152     }
00153 
00154     init_flag = 0;
00155 }
00156 
00157 <span class="comment">//------------- End of function GraphDoubleBarMonth::deinit ---------//</span>
00158 
00159 <span class="comment">//-------- Begin of function GraphDoubleBarMonth::set_font ------------//</span>
<a name="l00161"></a><a class="code" href="classGraphDoubleBarMonth.html#a10">00161</a> <span class="comment">void GraphDoubleBarMonth::set_font(Font *fontPtr) {</span>
00162     <span class="keywordflow">if</span> (!init_flag)
00163         <span class="keywordflow">return</span>;
00164 
00165     font_ptr = fontPtr;
00166 
00167     calc_pos();
00168 }
00169 
00170 <span class="comment">//------------- End of function GraphDoubleBarMonth::set_font ---------//</span>
00171 
00172 <span class="comment">//-------- Begin of function GraphDoubleBarMonth::calc_pos ------------//</span>
<a name="l00177"></a><a class="code" href="classGraphDoubleBarMonth.html#a11">00177</a> <span class="comment">void GraphDoubleBarMonth::calc_pos() {</span>
00178     <span class="keywordflow">if</span> (legend_array) {
00179         <span class="keywordtype">short</span> textWidth = 0, textHeight = font_ptr-&gt;max_font_height;
00180 
00181         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num; i++) {
00182             <span class="keywordflow">if</span> (font_ptr-&gt;text_width(legend_array[i]) &gt; textWidth)
00183                 textWidth = font_ptr-&gt;text_width(legend_array[i]);
00184         }
00185 
00186         <a class="code" href="ALL_8H.html#a0">err_when</a>(textWidth + <a class="code" href="Ogrpdmth_8cpp.html#a9a5">LEGEND_X_SPACING</a> * 2 &gt; graph_width);
00187 
00188         legend_x_num = (graph_width - <a class="code" href="Ogrpdmth_8cpp.html#a9a5">LEGEND_X_SPACING</a>*2) / (textWidth + <a class="code" href="Ogrpdmth_8cpp.html#a9a5">LEGEND_X_SPACING</a>*2);
00189         legend_y_num = (series_num / legend_x_num) + ((series_num % legend_x_num) ? 1 : 0);
00190 
00191         graph_height = graph_y2 - graph_y1 - legend_y_num * (textHeight + <a class="code" href="Ogrpdmth_8cpp.html#a9a6">LEGEND_Y_SPACING</a>) - 6;
00192 
00193         <a class="code" href="ALL_8H.html#a0">err_when</a>(graph_height &lt;= 0);
00194 
00195         legend_width = (graph_width - <a class="code" href="Ogrpdmth_8cpp.html#a9a5">LEGEND_X_SPACING</a>*2) / legend_x_num;
00196         legend_height = textHeight + <a class="code" href="Ogrpdmth_8cpp.html#a9a6">LEGEND_Y_SPACING</a>;
00197     }
00198     <span class="keywordflow">else</span> {
00199         legend_width = legend_height = legend_x_num = legend_y_num = 0;
00200         graph_height = graph_y2 - graph_y1 - 6;
00201     }
00202 
00203     <span class="keywordtype">short</span> YLabelWidth = y_label ? (orientation_flag ? font_ptr-&gt;max_font_height : font_ptr-&gt;text_width(y_label)) : -<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>;
00204     <span class="keywordtype">short</span> XLabelHeight = x_label ? (font_ptr-&gt;max_font_height) : -<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>;
00205     series_x1 = graph_x1 + 4 + <a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>*4 + YLabelWidth + y_label_max_len;
00206     series_y1 = graph_y1 + 4 + <a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>*6;
00207     series_x2 = graph_x2 - 4 - <a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>*16;
00208     series_y2 = graph_y1 + graph_height - <a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>*3 - (font_ptr-&gt;max_font_height);
00209 }
00210 
00211 <span class="comment">//------------ End of function GraphDoubleBarMonth::calc_pos ---------//</span>
00212 
00213 <span class="comment">//-------- Begin of function GraphDoubleBarMonth::paint --------------//</span>
<a name="l00215"></a><a class="code" href="classGraphDoubleBarMonth.html#a8">00215</a> <span class="comment">void GraphDoubleBarMonth::paint() {</span>
00216     <span class="keywordflow">if</span> (transparent_flag) {
00217         user_interface.brighten(graph_x1+4, graph_y1+4, graph_x2-2, graph_y2-2);
00218         <span class="keywordflow">if</span> (legend_array)
00219             draw_legend();
00220         draw_axis_label();
00221         graph_bitmap = vga_back.save_area(graph_x1+4, graph_y1+4, graph_x2-2, graph_y2-2, graph_bitmap);
00222     }
00223 
00224     <span class="comment">//  paint_flag = 1;</span>
00225     refresh();
00226 }
00227 
00228 <span class="comment">//------------- End of function GraphDoubleBarMonth::paint -----------//</span>
00229 
00230 <span class="comment">//-------- Begin of function GraphDoubleBarMonth::refresh ------------//</span>
<a name="l00232"></a><a class="code" href="classGraphDoubleBarMonth.html#a9">00232</a> <span class="comment">void GraphDoubleBarMonth::refresh() {</span>
00233     <span class="keywordflow">if</span> (transparent_flag) {
00234         user_interface.rect(graph_x1, graph_y1, graph_x2, graph_y2, 1);
00235         vga_back.rest_area(graph_bitmap, 0, 0);
00236     }
00237     <span class="keywordflow">else</span> {
00238         user_interface.bar(graph_x1, graph_y1, graph_x2, graph_y2);
00239         user_interface.panel(graph_x1+3, graph_y1+3, graph_x2-4, graph_y2-4);
00240     }
00241 
00242     <span class="keywordflow">if</span> (legend_array)
00243         draw_legend();
00244     draw_scale();
00245     draw_series();
00246 
00247     <span class="comment">//  if (!paint_flag)</span>
00248     <span class="comment">//          vga.blt_buf(graph_x1, graph_y1, graph_x2+2, graph_y2+2);</span>
00249     <span class="comment">//  else</span>
00250     <span class="comment">//          paint_flag = 0;</span>
00251 }
00252 
00253 <span class="comment">//------------- End of function GraphDoubleBarMonth::refresh ---------//</span>
00254 
00255 <span class="comment">//---------- Begin of function GraphDoubleBarMonth::draw_legend ------------//</span>
<a name="l00257"></a><a class="code" href="classGraphDoubleBarMonth.html#b0">00257</a> <span class="comment">void GraphDoubleBarMonth::draw_legend() {</span>
00258     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num; i++) {
00259         <span class="keywordtype">short</span> legendX = graph_x1 + 4 + (i % legend_x_num) * legend_width + <a class="code" href="Ogrpdmth_8cpp.html#a9a5">LEGEND_X_SPACING</a>;
00260         <span class="keywordtype">short</span> legendY = graph_y1 + 4 + graph_height + (i / legend_x_num) * legend_height;
00261         user_interface.bar( legendX+<a class="code" href="Ogrpdmth_8cpp.html#a9a5">LEGEND_X_SPACING</a>, legendY+<a class="code" href="Ogrpdmth_8cpp.html#a9a6">LEGEND_Y_SPACING</a>,
00262                             legendX+<a class="code" href="Ogrpdmth_8cpp.html#a9a5">LEGEND_X_SPACING</a>+<a class="code" href="Ogrpdmth_8cpp.html#a9a4">LEGEND_SIZE</a>, legendY+<a class="code" href="Ogrpdmth_8cpp.html#a9a6">LEGEND_Y_SPACING</a>+<a class="code" href="Ogrpdmth_8cpp.html#a9a4">LEGEND_SIZE</a>,
00263                             series_color[i] );
00264         font_ptr-&gt;put( legendX+<a class="code" href="Ogrpdmth_8cpp.html#a9a5">LEGEND_X_SPACING</a>*2+<a class="code" href="Ogrpdmth_8cpp.html#a9a4">LEGEND_SIZE</a>, legendY+<a class="code" href="Ogrpdmth_8cpp.html#a9a6">LEGEND_Y_SPACING</a>, legend_array[i] );
00265     }
00266 }
00267 
00268 <span class="comment">//------------ End of function GraphDoubleBarMonth::draw_legend ------------//</span>
00269 
00270 <span class="comment">//---------- Begin of function GraphDoubleBarMonth::draw_axis_label --------//</span>
<a name="l00272"></a><a class="code" href="classGraphDoubleBarMonth.html#b1">00272</a> <span class="comment">void GraphDoubleBarMonth::draw_axis_label() {</span>
00273     <span class="keywordtype">short</span> textHeight = font_ptr-&gt;max_font_height;
00274 
00275     <span class="keywordflow">if</span> (x_label) {
00276         font_ptr-&gt;center_put( series_x1, series_y2+<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>*2+textHeight,
00277                               series_x2, graph_y1+graph_height-<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>, x_label );
00278     }
00279 
00280     <span class="keywordflow">if</span> (y_label) {
00281         <span class="keywordtype">short</span> textWidth = font_ptr-&gt;text_width(y_label) + 1;
00282 
00283         <span class="keywordflow">if</span> (orientation_flag) {
00284             <span class="keywordtype">short</span> *fontBuf = (<span class="keywordtype">short</span> *) sys.common_data_buf;
00285             <a class="code" href="ALL_8H.html#a0">err_when</a>(textWidth * textHeight * <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>) &gt; <a class="code" href="Osys_8h.html#a40a2">COMMON_DATA_BUF_SIZE</a>);
00286 
00287             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; textWidth * textHeight; i++)
00288                 *fontBuf++ = transparent_code_w;
00289 
00290             font_ptr-&gt;put_to_bufferW(fontBuf = (<span class="keywordtype">short</span> *) sys.common_data_buf, textWidth * <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>), 0, 0, y_label);
00291 
00292             <span class="keywordtype">short</span> xStart = graph_x1 + 4 + <a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a> * 2;
00293             <span class="keywordtype">short</span> yStart = (series_y1 + series_y2 - textWidth) / 2;
00294 
00295             <span class="keywordflow">for</span> (<span class="keywordtype">short</span> x = 0; x &lt; textHeight; x++) {
00296                 <span class="keywordflow">for</span> (<span class="keywordtype">short</span> y = textWidth - 1; y &gt;= 0; y--, fontBuf++) {
00297                     <span class="keywordflow">if</span> (*fontBuf != transparent_code_w)
00298                         *vga_back.buf_ptr(xStart+x, yStart+y) = *fontBuf;
00299                 }
00300             }
00301         }
00302         <span class="keywordflow">else</span> {
00303             font_ptr-&gt;center_put( graph_x1+4+<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>*2, series_y1,
00304                                   graph_x1+4+<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>*2+textWidth, series_y2, y_label);
00305         }
00306     }
00307 }
00308 
00309 <span class="comment">//------------ End of function GraphDoubleBarMonth::draw_axis_label --------//</span>
00310 
00311 <span class="comment">//---------- Begin of function GraphDoubleBarMonth::find_scale -------------//</span>
<a name="l00313"></a><a class="code" href="classGraphDoubleBarMonth.html#b2">00313</a> <span class="comment">void GraphDoubleBarMonth::find_scale() {</span>
00314     <span class="keywordtype">double</span> data, maxVal = 0.0,minVal = 0.0;
00315 
00316     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num * HISTORY_MONTH_COUNT; i++) {
00317         <span class="keywordflow">switch</span> (data_type_flag) {
00318         <span class="keywordflow">case</span> DATA_DOUBLE:
00319             data = ((<span class="keywordtype">double</span>*)data_array)[i];
00320             <span class="keywordflow">break</span>;
00321         <span class="keywordflow">case</span> DATA_FLOAT:
00322             data = double(((<span class="keywordtype">float</span>*)data_array)[i]);
00323             <span class="keywordflow">break</span>;
00324         <span class="keywordflow">case</span> DATA_INT:
00325             data = double(((<span class="keywordtype">int</span>*)data_array)[i]);
00326             <span class="keywordflow">break</span>;
00327         <span class="keywordflow">case</span> DATA_LONG:
00328             data = double(((<span class="keywordtype">long</span>*)data_array)[i]);
00329             <span class="keywordflow">break</span>;
00330         }
00331         <span class="keywordflow">if</span> (data &gt; maxVal)
00332             maxVal = data;
00333         <span class="keywordflow">if</span> (data &lt; minVal)
00334             minVal = data;
00335     }
00336 
00337     <span class="keywordflow">if</span>(maxVal&gt;1.0)
00338         max_scale = maxVal;
00339     <span class="keywordflow">else</span>
00340         max_scale = 1;
00341 
00342     <span class="keywordflow">if</span> (minVal&lt;0)
00343         min_scale = minVal;
00344     <span class="keywordflow">else</span>
00345         min_scale = 0;
00346 
00347 }
00348 
00349 <span class="comment">//------------ End of function GraphDoubleBarMonth::find_scale -------------//</span>
00350 
00351 <span class="comment">//---------- Begin of function GraphDoubleBarMonth::draw_scale -------------//</span>
<a name="l00353"></a><a class="code" href="classGraphDoubleBarMonth.html#b3">00353</a> <span class="comment">void GraphDoubleBarMonth::draw_scale() {</span>
00354     find_scale();
00355 
00356     <span class="comment">//------ Draw y-axis -------//</span>
00357     vga_back.bar(series_x1, series_y1-<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>*2, series_x1+1, series_y2+<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>, axis_color);
00358 
00359     xAxisPos=(short)(series_y1+(series_y2-series_y1)*(max_scale)/(max_scale-min_scale));
00360 
00361     posScaleNum = (xAxisPos-series_y1-font_ptr-&gt;max_font_height) / (font_ptr-&gt;max_font_height*3/2);
00362     <span class="keywordflow">if</span> ( posScaleNum &gt; 0 )
00363         posScaleNum = short(pow(2,floor(log10(<span class="keywordtype">double</span>(posScaleNum))/log10(2.0))));
00364     <span class="keywordflow">else</span>
00365         posScaleNum = 0;
00366     negScaleNum = (series_y2-xAxisPos-font_ptr-&gt;max_font_height) / (font_ptr-&gt;max_font_height*3/2);
00367     <span class="keywordflow">if</span> ( negScaleNum &gt; 0 )
00368         negScaleNum = short(pow(2,ceil(log10(<span class="keywordtype">double</span>(negScaleNum))/log10(2.0))));
00369     <span class="keywordflow">else</span>
00370         negScaleNum = 0;
00371 
00372 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00373 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( posScaleNum + negScaleNum &lt;= 0) {
00374         posScaleNum = 1;
00375         negScaleNum = 0;
00376     }
00377 <span class="preprocessor">#endif</span>
00378 <span class="preprocessor"></span>
00379     <span class="keywordtype">short</span> posScaleStep;
00380     <span class="keywordtype">short</span> negScaleStep;
00381 
00382     <span class="keywordflow">if</span>(posScaleNum&lt;1) {
00383         posScaleStep = 0;
00384         posScaleInc = 0;
00385     }
00386     <span class="keywordflow">else</span> {
00387         posScaleStep  = (xAxisPos-series_y1) / posScaleNum;
00388         posScaleInc   = max_scale / posScaleNum;
00389 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00390 <span class="preprocessor"></span>        <span class="keywordflow">if</span>( data_type_flag==DATA_INT || data_type_flag==DATA_LONG )
00391             negScaleInc = ceil(negScaleInc);            <span class="comment">// don't like integer type to have non-integral negScaleInc</span>
00392 <span class="preprocessor">#endif</span>
00393 <span class="preprocessor"></span>    }
00394 
00395     <span class="keywordflow">if</span>(negScaleNum&lt;1) {
00396         negScaleStep = 0;
00397         negScaleInc = 0;
00398     }
00399     <span class="keywordflow">else</span> {
00400         negScaleStep = (series_y2-xAxisPos) / negScaleNum;
00401         negScaleInc   = -min_scale / negScaleNum;
00402 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00403 <span class="preprocessor"></span>        <span class="keywordflow">if</span>( data_type_flag==DATA_INT || data_type_flag==DATA_LONG )
00404             negScaleInc = ceil(negScaleInc);            <span class="comment">// don't like integer type to have non-integral negScaleInc</span>
00405 <span class="preprocessor">#endif</span>
00406 <span class="preprocessor"></span>    }
00407 
00408     <span class="keywordflow">if</span>(posScaleNum+negScaleNum&lt;1) {
00409         scaleStep = 0;
00410         scaleInc   = 0;
00411     }
00412     <span class="keywordflow">else</span> {
00413         scaleStep = (short)((series_y2-series_y1)/(posScaleNum+negScaleNum));
00414         scaleInc =  ((max_scale-min_scale)/(posScaleNum+negScaleNum));
00415 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00416 <span class="preprocessor"></span>        <span class="keywordflow">if</span>( data_type_flag==DATA_INT || data_type_flag==DATA_LONG )
00417             scaleInc = max(posScaleInc, negScaleInc);
00418 <span class="preprocessor">#endif</span>
00419 <span class="preprocessor"></span>    }
00420 
00421     <span class="keywordtype">double</span> scaleValue;
00422 
00423     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = -negScaleNum,ycheck=xAxisPos-i*scaleStep;
00424          ycheck&gt;graph_y1;
00425          i++,ycheck-=scaleStep) {
00426 
00427         vga_back.bar(series_x1, ycheck, series_x1+<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>*2, ycheck, axis_color);
00428 
00429         scaleValue = i*scaleInc;
00430 
00431         <span class="keywordflow">switch</span> (data_type_flag) {
00432         <span class="keywordflow">case</span> DATA_FLOAT:
00433         <span class="keywordflow">case</span> DATA_DOUBLE:
00434             font_ptr-&gt;right_put(series_x1-<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>, ycheck-font_ptr-&gt;max_font_height/2, m.format(scaleValue,num_format));
00435             <span class="keywordflow">break</span>;
00436         <span class="keywordflow">case</span> DATA_INT:
00437         <span class="keywordflow">case</span> DATA_LONG:
00438             font_ptr-&gt;right_put(series_x1-<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>, ycheck-font_ptr-&gt;max_font_height/2, m.format(<span class="keywordtype">long</span>(scaleValue),num_format));
00439         }
00440     }
00441 
00442     <span class="comment">//------ Draw x-axis -------//</span>
00443     vga_back.bar(series_x1, xAxisPos+<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>, series_x2+1, xAxisPos+2*<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>, axis_color);
00444 
00445     <span class="comment">// show x-axis scale</span>
00446 
00447     <span class="keywordtype">int</span> shown_month=*data_num;                      <span class="comment">// max number of months will be shown</span>
00448 
00449     info_graph_doublebar_month=                     <span class="comment">// depending on info.graph_month, number of months will be shown</span>
00450         (info.graph_month-2&gt;shown_month)?
00451         shown_month:
00452     info.graph_month-2;
00453 
00454     <span class="comment">// show x-axis scale</span>
00455     <span class="keywordtype">double</span> actual_end;
00456     <span class="keywordflow">if</span> (this_month_indicator&lt;0)
00457         actual_end=((double)info.game_month-1)/12.0+info.game_year;
00458     <span class="keywordflow">else</span>
00459         actual_end=(((double)info.game_month-1)+this_month_indicator)/12.0+info.game_year;
00460 
00461     <span class="keywordtype">int</span> show_end=(int)(actual_end);
00462 
00463     <span class="keywordtype">short</span> maxLabelWidth = font_ptr-&gt;text_width(m.format(show_end, 16))+<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>*2;
00464     x_axis_step = ((float)series_x2-series_x1) / (shown_month+1);
00465 
00466     <span class="keywordtype">double</span> actual_start = actual_end-(double)(info_graph_doublebar_month)/12.0;
00467 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00468 <span class="preprocessor"></span>    <span class="comment">// if finanical year</span>
00469     <span class="comment">// draw yr.i at i+(8.0/12.0) which is &gt; actual_start</span>
00470     <span class="comment">// then i &gt; actual_start-(8.0/12.0)</span>
00471     <span class="comment">// double financialYearOffset = ((financial.fiscal_year_start_month-1.0)/12.0); // for year start in sept</span>
00472     <span class="keywordtype">double</span> financialYearOffset = 8.0/12.0;          <span class="comment">// for year start in sept</span>
00473     <span class="keywordtype">int</span> show_start = (int)(actual_start - financialYearOffset) + 1;
00474     <span class="keywordtype">double</span> show_year_offset = (double)show_start + financialYearOffset - actual_start;
00475 <span class="preprocessor">#else</span>
00476 <span class="preprocessor"></span>    <span class="keywordtype">double</span> show_year_offset=1.0-(actual_start-(int)actual_start)-0.0/12.0;
00477     <span class="keywordtype">int</span> show_start=(int)(actual_start)+1;
00478 <span class="preprocessor">#endif</span>
00479 <span class="preprocessor"></span>
00480     show_end=show_start+1;
00481 
00482     <span class="keywordtype">short</span> displayInc = 0;
00483     <span class="keywordflow">while</span> (displayInc * x_axis_step * 12.0&lt; maxLabelWidth) displayInc++;
00484 
00485     <span class="comment">//------ Draw x-axis -------//</span>
00486     <span class="keywordflow">for</span> (i = 0; i &lt; 12 ; i++) {
00487         <span class="keywordtype">int</span> this_x=(int)(series_x1+(double)(i*x_axis_step));
00488         vga_back.bar(
00489             this_x,
00490             xAxisPos-<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>,
00491             this_x+1,
00492             xAxisPos+<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>*2, axis_color);
00493     }
00494 
00495     <span class="keywordflow">for</span> (i = show_start; i &lt;=show_end ; i+=displayInc) {
00496         <span class="keywordtype">int</span> this_x;
00497         <span class="keywordflow">if</span>((this_x = (int)(series_x1+((double)(i-show_start)+show_year_offset)*x_axis_step*12))&lt;series_x2) {
00498             vga_back.bar(
00499                 this_x,
00500                 xAxisPos-<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>*2,
00501                 this_x+1,
00502                 xAxisPos+<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>*2, axis_color);
00503             font_ptr-&gt;center_put(
00504                 this_x-maxLabelWidth/2-<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>+4,
00505                 xAxisPos+<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>+2,
00506                 this_x+maxLabelWidth/2-<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>+4,
00507                 xAxisPos+<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>+2+font_ptr-&gt;max_font_height,
00508                 m.format(i,16));
00509         }
00510     }
00511 
00512     <span class="comment">//---- Draw this year indicators ----//</span>
00513     <span class="keywordflow">if</span>((this_month_indicator&gt;=0)&amp;&amp;(this_month_indicator&lt;*data_num))
00514         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=series_y1;j&lt;series_y2+<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>;j+=8)
00515             vga_back.bar(
00516                 (<span class="keywordtype">int</span>)(series_x1+(info_graph_doublebar_month-this_month_indicator+1)*x_axis_step),
00517                 j,
00518                 (<span class="keywordtype">int</span>)(series_x1+(info_graph_doublebar_month-this_month_indicator+1)*x_axis_step),
00519                 j+4,
00520                 axis_color);
00521 }
00522 
00523 <span class="comment">//------------ End of function GraphDoubleBarMonth::draw_scale -------------//</span>
00524 
00525 <span class="comment">//---------- Begin of function GraphDoubleBarMonth::draw_series ------------//</span>
<a name="l00527"></a><a class="code" href="classGraphDoubleBarMonth.html#b4">00527</a> <span class="comment">void GraphDoubleBarMonth::draw_series() {</span>
00528     <span class="keywordflow">switch</span> (data_type_flag) {
00529     <span class="keywordflow">case</span> DATA_FLOAT: draw_series_float(); <span class="keywordflow">break</span>;
00530     <span class="keywordflow">case</span> DATA_DOUBLE: draw_series_double(); <span class="keywordflow">break</span>;
00531     <span class="keywordflow">case</span> DATA_INT: draw_series_int(); <span class="keywordflow">break</span>;
00532     <span class="keywordflow">case</span> DATA_LONG: draw_series_long(); <span class="keywordflow">break</span>;
00533     }
00534 }
00535 
00536 <span class="comment">//------------ End of function GraphDoubleBarMonth::draw_series ------------//</span>
00537 
00538 <span class="comment">//---------- Begin of function GraphDoubleBarMonth::draw_series_float ------------//</span>
<a name="l00540"></a><a class="code" href="classGraphDoubleBarMonth.html#b5">00540</a> <span class="comment">void GraphDoubleBarMonth::draw_series_float() {</span>
00541     <span class="keywordtype">float</span> *dataArray = (<span class="keywordtype">float</span> *) data_array;
00542     <span class="keywordtype">short</span> currX, currY;
00543     <span class="keywordtype">int</span> barWidth = (int)(x_axis_step/(series_num+1));
00544 
00545     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num; i++) {
00546         dataArray-=(info_graph_doublebar_month);
00547         dataArray+=HISTORY_MONTH_COUNT;
00548         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; (info_graph_doublebar_month); j++) {
00549             currX = (short)(series_x1 + (j+0.5) * x_axis_step + i * barWidth);
00550             <span class="keywordflow">if</span> (x_axis_pos)
00551                 currY = xAxisPos+(short)(*dataArray * scaleStep/scaleInc)-<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>+2;
00552             <span class="keywordflow">else</span>
00553                 currY = xAxisPos-(short)(*dataArray * scaleStep/scaleInc)-<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>+2; {
00554 
00555                 <span class="comment">//                      if(*dataArray&gt;0)</span>
00556                 vga_back.bar( (<span class="keywordtype">int</span>)(currX-0.5*barWidth), currY,
00557                               (<span class="keywordtype">int</span>)(currX+0.5*barWidth)-<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>, xAxisPos,
00558                               series_color[i]);
00559                 <span class="comment">//                                                      vga_back.translate_color(series_color[i]));</span>
00560             }
00561             dataArray++;
00562         }
00563 
00564         <span class="keywordflow">if</span> (value_flag)
00565             draw_value(dataArray-1, vga_back.translate_color(series_color[i]), currX+<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>-(int)(0.3f*x_axis_step), currY-font_ptr-&gt;max_font_height/2, DATA_FLOAT);
00566     }
00567 }
00568 
00569 <span class="comment">//------------ End of function GraphDoubleBarMonth::draw_series_float ------------//</span>
00570 
00571 <span class="comment">//---------- Begin of function GraphDoubleBarMonth::draw_series_double ------------//</span>
<a name="l00573"></a><a class="code" href="classGraphDoubleBarMonth.html#b6">00573</a> <span class="comment">void GraphDoubleBarMonth::draw_series_double() {</span>
00574     <span class="keywordtype">double</span> *dataArray = (<span class="keywordtype">double</span> *) data_array;
00575     <span class="keywordtype">short</span> currX, currY;
00576     <span class="keywordtype">int</span> barWidth = (int)(x_axis_step/(series_num+1));
00577 
00578     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num; i++) {
00579         dataArray-=(info_graph_doublebar_month);
00580         dataArray+=HISTORY_MONTH_COUNT;
00581         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; (info_graph_doublebar_month); j++) {
00582             currX = (short)(series_x1 + (j+0.5) * x_axis_step + i * barWidth);
00583             <span class="keywordflow">if</span> (x_axis_pos)
00584                 currY = xAxisPos+(short)(*dataArray * (double)scaleStep/scaleInc)-<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>+2;
00585             <span class="keywordflow">else</span>
00586                 currY = xAxisPos-(short)(*dataArray * (double)scaleStep/scaleInc)-<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>+2; {
00587 
00588                 <span class="comment">//                      if(*dataArray&gt;0)</span>
00589                 vga_back.bar( (<span class="keywordtype">int</span>)(currX-0.5*barWidth), currY,
00590                               (<span class="keywordtype">int</span>)(currX+0.5*barWidth)-<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>, xAxisPos,
00591                               series_color[i]);
00592                 <span class="comment">//                                                      vga_back.translate_color(series_color[i]));</span>
00593             }
00594             dataArray++;
00595         }
00596 
00597         <span class="keywordflow">if</span> (value_flag)
00598             draw_value(dataArray-1, vga_back.translate_color(series_color[i]), currX+<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>-(int)(0.3f*x_axis_step), currY-font_ptr-&gt;max_font_height/2, DATA_DOUBLE);
00599     }
00600 }
00601 
00602 <span class="comment">//------------ End of function GraphDoubleBarMonth::draw_series_double ------------//</span>
00603 
00604 <span class="comment">//---------- Begin of function GraphDoubleBarMonth::draw_series_int ------------//</span>
<a name="l00606"></a><a class="code" href="classGraphDoubleBarMonth.html#b7">00606</a> <span class="comment">void GraphDoubleBarMonth::draw_series_int() {</span>
00607     <span class="keywordtype">int</span> *dataArray = (<span class="keywordtype">int</span> *) data_array;
00608     <span class="keywordtype">short</span> currX, currY;
00609     <span class="keywordtype">int</span> barWidth = (int)(x_axis_step/(series_num+1));
00610 
00611     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num; i++) {
00612         dataArray-=(info_graph_doublebar_month);
00613         dataArray+=HISTORY_MONTH_COUNT;
00614         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; (info_graph_doublebar_month); j++) {
00615 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00616 <span class="preprocessor"></span>            <span class="comment">// shift half bar</span>
00617             currX = (short)(series_x1 + j * x_axis_step + i * barWidth + barWidth);
00618 <span class="preprocessor">#else</span>
00619 <span class="preprocessor"></span>            currX = (short)(series_x1 + (j+0.5) * x_axis_step + i * barWidth);
00620 <span class="preprocessor">#endif</span>
00621 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (x_axis_pos)
00622                 currY = (short)(xAxisPos+(int)(*dataArray * scaleStep/scaleInc))-<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>+2;
00623             <span class="keywordflow">else</span>
00624                 currY = (short)(xAxisPos-(int)(*dataArray * scaleStep/scaleInc))-<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>+2; {
00625 
00626                 <span class="comment">//                      if(*dataArray&gt;0)</span>
00627                 vga_back.bar( (<span class="keywordtype">int</span>)(currX-0.5*barWidth), currY,
00628                               (<span class="keywordtype">int</span>)(currX+0.5*barWidth)-<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>, xAxisPos,
00629                               series_color[i]);
00630                 <span class="comment">//                                                      vga_back.translate_color(series_color[i]));</span>
00631             }
00632             dataArray++;
00633         }
00634 
00635         <span class="keywordflow">if</span> (value_flag)
00636             draw_value(dataArray-1, vga_back.translate_color(series_color[i]), currX+<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>-(int)(0.3f*x_axis_step), currY-font_ptr-&gt;max_font_height/2, DATA_INT);
00637     }
00638 }
00639 
00640 <span class="comment">//------------ End of function GraphDoubleBarMonth::draw_series_int ------------//</span>
00641 
00642 <span class="comment">//---------- Begin of function GraphDoubleBarMonth::draw_series_long ------------//</span>
<a name="l00644"></a><a class="code" href="classGraphDoubleBarMonth.html#b8">00644</a> <span class="comment">void GraphDoubleBarMonth::draw_series_long() {</span>
00645     <span class="keywordtype">long</span> *dataArray = (<span class="keywordtype">long</span> *) data_array;
00646     <span class="keywordtype">short</span> currX, currY;
00647     <span class="keywordtype">int</span> barWidth = (int)(x_axis_step/(series_num+1));
00648 
00649     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num; i++) {
00650         dataArray-=(info_graph_doublebar_month);
00651         dataArray+=HISTORY_MONTH_COUNT;
00652         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; (info_graph_doublebar_month); j++) {
00653             currX = (short)(series_x1 + (j+0.5) * x_axis_step + i * barWidth);
00654             <span class="keywordflow">if</span> (x_axis_pos)
00655                 currY = xAxisPos+(short)(*dataArray * scaleStep/scaleInc)-<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>+2;
00656             <span class="keywordflow">else</span>
00657                 currY = xAxisPos-(short)(*dataArray * scaleStep/scaleInc)-<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>+2; {
00658                 <span class="comment">//                      if(*dataArray&gt;0)</span>
00659                 vga_back.bar( (<span class="keywordtype">int</span>)(currX-0.5*barWidth), currY,
00660                               (<span class="keywordtype">int</span>)(currX+0.5*barWidth)-<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>, xAxisPos,
00661                               series_color[i]);
00662                 <span class="comment">//                                                      vga_back.translate_color(series_color[i]));</span>
00663             }
00664             dataArray++;
00665         }
00666 
00667         <span class="keywordflow">if</span> (value_flag)
00668             draw_value(dataArray-1, vga_back.translate_color(series_color[i]), currX+<a class="code" href="Ogrpdmth_8cpp.html#a10a7">COMMON_OFFSET</a>-(int)(0.3f*x_axis_step), currY-font_ptr-&gt;max_font_height/2, DATA_LONG);
00669     }
00670 }
00671 
00672 <span class="comment">//------------ End of function GraphDoubleBarMonth::draw_series_float ------------//</span>
00673 
00674 <span class="comment">//---------- Begin of function GraphDoubleBarMonth::draw_value -------------------//</span>
<a name="l00676"></a><a class="code" href="classGraphDoubleBarMonth.html#b9">00676</a> <span class="comment">void GraphDoubleBarMonth::draw_value(void *value, int color, short x, short y, int dataType) {</span>
00677     <span class="keywordtype">char</span> *valueString;
00678     <span class="keywordflow">switch</span> (data_type_flag) {
00679     <span class="keywordflow">case</span> DATA_FLOAT:
00680         valueString = m.format(*((<span class="keywordtype">float</span> *) value), num_format); <span class="keywordflow">break</span>;
00681     <span class="keywordflow">case</span> DATA_DOUBLE:
00682         valueString = m.format(*((<span class="keywordtype">double</span> *) value), num_format); <span class="keywordflow">break</span>;
00683     <span class="keywordflow">case</span> DATA_INT:
00684         valueString = m.format(*((<span class="keywordtype">int</span> *) value), num_format); <span class="keywordflow">break</span>;
00685     <span class="keywordflow">case</span> DATA_LONG:
00686         valueString = m.format(*((<span class="keywordtype">long</span> *) value), num_format); <span class="keywordflow">break</span>;
00687     }
00688 
00689     <span class="keywordtype">short</span> textHeight = font_ptr-&gt;max_font_height;
00690     <span class="keywordtype">short</span> textWidth = font_ptr-&gt;text_width(valueString) + 1;
00691     <span class="comment">/*  </span>
00692 <span class="comment">        short *bitmap = (short *) sys.common_data_buf;</span>
00693 <span class="comment">        err_when( (2 + textWidth * textHeight) * sizeof(short) &gt; COMMON_DATA_BUF_SIZE );</span>
00694 <span class="comment">        *bitmap++ = textWidth;</span>
00695 <span class="comment">        *bitmap++ = textHeight;</span>
00696 <span class="comment"></span>
00697 <span class="comment">        short *shortPtr = bitmap;</span>
00698 <span class="comment">        for (int i = 0; i &lt; textWidth * textHeight; i++)</span>
00699 <span class="comment">        *shortPtr++ = transparent_code_w;</span>
00700 <span class="comment"></span>
00701 <span class="comment">        font_ptr-&gt;put_to_bufferW(bitmap, textWidth * sizeof(short), 0, 0, valueString);</span>
00702 <span class="comment"></span>
00703 <span class="comment">        shortPtr = bitmap;</span>
00704 <span class="comment">        for (i = 0; i &lt; textWidth * textHeight; i++, shortPtr++)</span>
00705 <span class="comment">        if (*shortPtr != transparent_code_w)</span>
00706 <span class="comment">        *shortPtr = color;</span>
00707 <span class="comment"></span>
00708 <span class="comment">        vga_back.put_bitmapW_trans(x, y, (short *) sys.common_data_buf);</span>
00709 <span class="comment">    */</span>
00710     font_chartsm.put(x+3,y,valueString);
00711 }
00712 
00713 <span class="comment">//---------- End of function GraphDoubleBarMonth::draw_value -------------------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:50 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
