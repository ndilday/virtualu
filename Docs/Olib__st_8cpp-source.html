<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Olib_st.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Olib_st.cpp</h1><a href="Olib__st_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : Olib_st.cpp</span>
00002 <span class="comment">//Description : LibTech Class Definition related to Simulation and Statistics/History</span>
00003 <span class="comment">//Owner       : Fred</span>
00004 
00005 <span class="comment">// ES header file</span>
00006 <span class="preprocessor">#include &lt;OMATH.H&gt;</span>
00007 
00008 <span class="comment">// CU header file</span>
00009 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>
00010 <span class="preprocessor">#include &lt;OENROLL.H&gt;</span>
00011 <span class="preprocessor">#include &lt;OPSCHOOL.H&gt;</span>
00012 <span class="preprocessor">#include &lt;ODEPT.H&gt;</span>
00013 <span class="preprocessor">#include &lt;OFACULTY.H&gt;</span>
00014 <span class="preprocessor">#include &lt;OFinance.H&gt;</span>
00015 <span class="preprocessor">#include "<a class="code" href="Olibtech_8h.html">Olibtech.h</a>"</span>
00016 <span class="preprocessor">#include "OStuOff.h"</span>
00017 
00018 <span class="comment">//----------- Define static variables -------------//</span>
00019 <span class="comment">//----------- Define static functions -------------//</span>
00020 <span class="comment">//----------- Define static class member variables -------------//</span>
00021 
00022 <span class="comment">//----------- Begin of function LibTech::init_data -----//</span>
<a name="l00027"></a><a class="code" href="classLibTech.html#a9">00027</a> <span class="comment">void LibTech::init_data() {</span>
00028     <span class="comment">//assume called: memset(this, 0, sizeof(LibTech));</span>
00029     <span class="comment">//assume finance and enrollment called first</span>
00030 
00031     <span class="comment">// IF input</span>
00032     faculty_incentive_using_it = 50;                <span class="comment">// = [0:100]</span>
00033 
00034     <span class="comment">// IF output</span>
00035 
00036     <span class="keywordtype">float</span> remap[] = { 2, 1, 0.5f };
00037     <span class="keywordtype">int</span> enrollment = enroll_res.total_student_count;
00038 
00039     <span class="comment">// 1221; update from latest email</span>
00040     volumns_count_library = int(76.60429808f * exp(math.get_random_snd(0,<a class="code" href="Opschool_8h.html#a1">PSCH_SD</a>(0.1f))) * enrollment *remap[player_school.relative_wealth] );
00041 
00042     <span class="comment">//------------// graph</span>
00043 
00044     update_history(UPDATE_ALL);
00045 }
00046 
00047 <span class="comment">//------------- End of function LibTech::init_data -----//</span>
00048 
00049 <span class="comment">//----------- Begin of function LibTech::next_day ------//</span>
<a name="l00051"></a><a class="code" href="classLibTech.html#a10">00051</a> <span class="comment">void LibTech::next_day() {</span>
00052     <span class="comment">// start of a month</span>
00053     <span class="keywordflow">if</span> ( info.game_day == 1 ) {
00054         <span class="comment">// start of a year</span>
00055         <span class="keywordflow">if</span> ( info.game_month == finance.fiscal_year_start_month )
00056             update_history(UPDATE_YEAR);
00057 
00058         update_history(UPDATE_MONTH);
00059     }
00060 
00061     <span class="comment">// start of a trimester</span>
00062     <span class="keywordflow">if</span> ( info.game_day == player_school.trimester_array[player_school.cur_trimester].start_day
00063          &amp;&amp; info.game_month == player_school.trimester_array[player_school.cur_trimester].start_month ) {
00064         update_history(UPDATE_TRIMESTER);
00065     }
00066 }
00067 
00068 <span class="comment">//------------- End of function LibTech::next_day ------//</span>
00069 
00070 <span class="comment">//---------- Begin of function LibTech::update_history -----------//</span>
<a name="l00076"></a><a class="code" href="classLibTech.html#a11">00076</a> <span class="comment">void LibTech::update_history(char update_flag) {</span>
00077     <span class="keywordflow">switch</span> (update_flag) {
00078     <span class="keywordflow">case</span> UPDATE_MONTH:
00079         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(library_history, HISTORY_MONTH_COUNT);
00080         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(it_history,HISTORY_MONTH_COUNT);
00081         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(overall_history,HISTORY_MONTH_COUNT);
00082         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(volumns_count_library_history,HISTORY_MONTH_COUNT);
00083         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(percent_faculty_using_it_history,HISTORY_MONTH_COUNT);
00084         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(internet_quality_history,HISTORY_MONTH_COUNT);
00085         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(tech_utilization_history,HISTORY_MONTH_COUNT);
00086 
00087         update_history_monthly();
00088 
00089         volumns_count_library_history[THIS_MONTH] = volumns_count_library;
00090         percent_faculty_using_it_history[THIS_MONTH] = percent_faculty_using_it;
00091         internet_quality_history[THIS_MONTH] = internet_quality;
00092         tech_utilization_history[THIS_MONTH] = tech_utilization;
00093         <span class="keywordflow">break</span>;
00094 
00095     <span class="keywordflow">case</span> UPDATE_TRIMESTER:
00096         calc_it_usage();
00097 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00098 <span class="preprocessor"></span>        <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(net_dl_expenditures_history, HISTORY_TRIMESTER_COUNT);
00099         net_dl_expenditures_history[<a class="code" href="Gamedef_8h.html#a84a63">H_PREV_TRIMESTER</a>] = (float) finance.net_distance_learning_expense.total/1000;
00100         net_dl_expenditures_history[<a class="code" href="Gamedef_8h.html#a84a64">H_THIS_TRIMESTER</a>] = (float) finance.projected_net_distance_learning_expense.this_year.total/1000;
00101         net_dl_expenditures_history[<a class="code" href="Gamedef_8h.html#a84a65">H_NEXT_TRIMESTER</a>] = (float) finance.projected_net_distance_learning_expense.next_year.total/1000;
00102         <span class="keywordflow">if</span> ( info.prerun_year )                     <span class="comment">// delete the abnormal large record due to initial game data</span>
00103             net_dl_expenditures_history[19] = 0;
00104 <span class="preprocessor">#endif</span>
00105 <span class="preprocessor"></span>        <span class="keywordflow">break</span>;
00106 
00107     <span class="keywordflow">case</span> UPDATE_YEAR:
00108         <span class="keywordflow">break</span>;
00109 
00110     <span class="keywordflow">case</span> UPDATE_ALL:
00111         update_history(UPDATE_YEAR);
00112         update_history(UPDATE_TRIMESTER);
00113         update_history(UPDATE_MONTH);
00114         <span class="keywordflow">break</span>;
00115     <span class="keywordflow">default</span>:
00116         <a class="code" href="ALL_8H.html#a1">err_here</a>();
00117         <span class="keywordflow">break</span>;
00118     }
00119 }
00120 
00121 <span class="comment">//---------- End of function Department::update_history -----------//</span>
00122 
00123 <span class="comment">//----------- Begin of function LibTech::update_history_monthly ------//</span>
<a name="l00125"></a><a class="code" href="classLibTech.html#a12">00125</a> <span class="comment">void LibTech::update_history_monthly() {</span>
00126     <span class="keywordtype">int</span> i, j; {
00127 
00128         <span class="comment">//----//</span>
00129 
00130         library_history[<a class="code" href="Gamedef_8h.html#a83a58">H_PREV_MONTH</a>] = (float) finance.expense_array[<a class="code" href="Ofinance_8h.html#a104a47">AC_LIBRARIES</a>].total;
00131         it_history[<a class="code" href="Gamedef_8h.html#a83a58">H_PREV_MONTH</a>] = (float) finance.expense_array[<a class="code" href="Ofinance_8h.html#a104a48">AC_IT_RESOURCES</a>].total;
00132         overall_history[<a class="code" href="Gamedef_8h.html#a83a58">H_PREV_MONTH</a>] = (float) it_history[<a class="code" href="Gamedef_8h.html#a83a58">H_PREV_MONTH</a>] + library_history[<a class="code" href="Gamedef_8h.html#a83a58">H_PREV_MONTH</a>]; {
00133         }
00134 
00135         <span class="comment">//----//</span>
00136 
00137         library_history[<a class="code" href="Gamedef_8h.html#a83a59">H_THIS_MONTH</a>] = (float) finance.projected_expense_array[<a class="code" href="Ofinance_8h.html#a104a47">AC_LIBRARIES</a>].this_year.total;
00138         it_history[<a class="code" href="Gamedef_8h.html#a83a59">H_THIS_MONTH</a>] = (float) finance.projected_expense_array[<a class="code" href="Ofinance_8h.html#a104a48">AC_IT_RESOURCES</a>].this_year.total;
00139         overall_history[<a class="code" href="Gamedef_8h.html#a83a59">H_THIS_MONTH</a>] = it_history[<a class="code" href="Gamedef_8h.html#a83a59">H_THIS_MONTH</a>] + library_history[<a class="code" href="Gamedef_8h.html#a83a59">H_THIS_MONTH</a>];
00140     }
00141 
00142     <span class="comment">//----//</span>
00143     library_history[<a class="code" href="Gamedef_8h.html#a83a60">H_NEXT_MONTH</a>] = (float) finance.projected_expense_array[<a class="code" href="Ofinance_8h.html#a104a47">AC_LIBRARIES</a>].next_year.total;
00144     it_history[<a class="code" href="Gamedef_8h.html#a83a60">H_NEXT_MONTH</a>] = (float) finance.projected_expense_array[<a class="code" href="Ofinance_8h.html#a104a48">AC_IT_RESOURCES</a>].next_year.total;
00145     overall_history[<a class="code" href="Gamedef_8h.html#a83a60">H_NEXT_MONTH</a>] = library_history[<a class="code" href="Gamedef_8h.html#a83a60">H_NEXT_MONTH</a>] + it_history[<a class="code" href="Gamedef_8h.html#a83a60">H_NEXT_MONTH</a>];
00146 
00147     <span class="comment">//----------//</span>
00148     <span class="comment">// input or output</span>
00149     <span class="keywordtype">float</span> oldInternetQuality = internet_quality_percent;
00150 
00151     internet_quality_percent = it_history[<a class="code" href="Gamedef_8h.html#a83a59">H_THIS_MONTH</a>] * 100 / (float) finance.total_operating_expense.total * 5;
00152     <span class="comment">//  internet_quality_percent = math.dual_response_func( 0,50,100,3.02f,2.35f,2.01f,5.54f,internet_quality_percent);</span>
00153     internet_quality_percent = math.dual_response_func( 0,50,100,3.02f,2.35f,2.01f,15.54f,internet_quality_percent);
00154 
00155     <span class="comment">//## chea 201099</span>
00156     <span class="comment">//  internet_quality_percent = min(100.0f,math.latency_func( 0.96f, oldInternetQuality, internet_quality_percent));// min &amp; max bug chea   7.87</span>
00157     <span class="comment">// min &amp; max bug chea   7.87</span>
00158     internet_quality_percent = min(100.0f,player_school.latency_func( 0.94f, oldInternetQuality, internet_quality_percent));
00159 
00160     internet_quality = char(internet_quality_percent * (<a class="code" href="Olibtech_8h.html#a0">INTERNET_QUALITY_LEVEL_COUNT</a>-1) / 100);
00161 
00162     <span class="comment">//----------//</span>
00163     <span class="keywordtype">float</span> growth = library_history[<a class="code" href="Gamedef_8h.html#a83a59">H_THIS_MONTH</a>] / volumns_count_library;
00164     growth = math.single_response_func(0.0f,0.90f,140,75,growth);
00165 
00166     volumns_count_library = int(volumns_count_library * (1+growth/100));
00167 
00168     <a class="code" href="ALL_8H.html#a0">err_when</a>(volumns_count_library == 0);
00169 
00170     <span class="comment">//----------//</span>
00171     <span class="keywordtype">float</span> totalPercent = 0;
00172     <span class="keywordtype">int</span> totalFacultyCount = 0;
00173 
00174     <span class="keywordflow">for</span> ( i=department_array.size(); i&gt;0; i-- ) {
00175         <span class="keywordflow">if</span> ( department_array.is_deleted(i) )
00176             <span class="keywordflow">continue</span>;
00177 
00178         <a class="code" href="classDepartment.html">Department</a>* deptPtr = department_array[i];
00179 
00180         <span class="keywordtype">float</span> percentIT = 0;
00181         <span class="keywordtype">int</span> facultyCount = 0;
00182 
00183         <span class="keywordflow">for</span>( j=deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classDynArray.html#a28">size</a>() ; j&gt;0 ; j-- ) {
00184             <span class="keywordflow">if</span> ( deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#a10">is_deleted</a>(i) )
00185                 <span class="keywordflow">continue</span>;
00186 
00187             percentIT += deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>[j]-&gt;p_discretionary_hour_it_percent;
00188             facultyCount++;
00189         }
00190 
00191         totalFacultyCount += facultyCount;
00192         totalPercent += percentIT;
00193     }
00194 
00195     <span class="keywordflow">if</span> ( totalFacultyCount )
00196         percent_faculty_using_it = (totalPercent)/totalFacultyCount;
00197     <span class="keywordflow">else</span>
00198         percent_faculty_using_it = 0;
00199 
00200     <span class="comment">//----------//</span>
00201 }
00202 
00203 <span class="comment">//------------- End of function LibTech::update_history_monthly ------//</span>
00204 
00205 <span class="comment">//----------- Begin of function LibTech::calc_it_usage ------//</span>
<a name="l00209"></a><a class="code" href="classLibTech.html#a13">00209</a> <span class="comment">void LibTech::calc_it_usage() {</span>
00210     <span class="keywordtype">int</span> i,j;
00211 
00212 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00213 <span class="preprocessor"></span>    <span class="comment">// Item 8d iii)</span>
00214     <span class="comment">// calculate tech_utilization for display</span>
00215     <span class="keywordtype">float</span> totalEdDevHrs=0;
00216     <span class="keywordtype">int</span> deptCount=0;
00217     <span class="keywordflow">for</span> ( i=department_array.size(); i&gt;0; i-- ) {
00218         <span class="keywordflow">if</span> ( department_array.is_deleted(i) )
00219             <span class="keywordflow">continue</span>;
00220 
00221         totalEdDevHrs += department_array[i]-&gt;p_tech_utilization;
00222         deptCount++;
00223     }
00224 
00225     <span class="keywordflow">if</span> ( deptCount != 0 )
00226         tech_utilization = totalEdDevHrs / deptCount;
00227     <span class="keywordflow">else</span>
00228         tech_utilization = 0;
00229 
00230 <span class="preprocessor">#else</span>
00231 <span class="preprocessor"></span>    <span class="comment">//----------//</span>
00232     <span class="keywordtype">float</span> totalPercent = 0;
00233     <span class="keywordtype">int</span> totalEnroll = 0;
00234 
00235     <span class="keywordflow">for</span> ( i=department_array.size(); i&gt;0; i-- ) {
00236         <span class="keywordflow">if</span> ( department_array.is_deleted(i) )
00237             <span class="keywordflow">continue</span>;
00238 
00239         <a class="code" href="classDepartment.html">Department</a>* deptPtr = department_array[i];
00240 
00241         <span class="keywordtype">int</span> subTotalEnroll = 0;
00242 
00243         <span class="keywordflow">for</span>( j=deptPtr-&gt;<a class="code" href="classDepartment.html#m1">course_array</a>.<a class="code" href="classDynArray.html#a28">size</a>() ; j&gt;0 ; j-- ) {
00244             subTotalEnroll += deptPtr-&gt;<a class="code" href="classDepartment.html#m1">course_array</a>[j]-&gt;<a class="code" href="classCourseArray.html#m3">convention_student_count</a>;
00245         }
00246 
00247         totalEnroll += subTotalEnroll;
00248         totalPercent += subTotalEnroll * deptPtr-&gt;<a class="code" href="classDepartment.html#m41">p_tech_utilization</a>;
00249     }
00250 
00251     <span class="keywordflow">if</span> ( totalEnroll )
00252         tech_utilization = totalPercent/totalEnroll;
00253     <span class="keywordflow">else</span>
00254         tech_utilization = 0;
00255 <span class="preprocessor">#endif</span>
00256 <span class="preprocessor"></span>}
00257 
00258 <span class="comment">//------------- End of function LibTech::calc_it_usage ------//</span>
00259 
00260 <span class="comment">//----------- Begin of function LibTech::init --------//</span>
00264 <span class="comment"></span>
00265 <span class="comment">//}</span>
00266 <span class="comment">//------------- End of function LibTech::init --------//</span>
00267 
00268 <span class="comment">// ##### Begin Marco ##### //</span>
00269 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00270 <span class="preprocessor"></span><span class="comment">//----------- Begin of function LibTech::save_initial_data  --------//</span>
00272 <span class="comment">void LibTech::save_initial_data() {</span>
00273     initial_volumns_count_library = volumns_count_library;
00274     initial_percent_faculty_using_it = percent_faculty_using_it;
00275     initial_internet_quality_percent = internet_quality_percent;
00276     initial_tech_utilization = tech_utilization;
00277     initial_faculty_incentive_using_it = faculty_incentive_using_it;
00278     initial_percent_dl_tuition = percent_dl_tuition;
00279 }
00280 
00281 <span class="comment">//------------- End of function LibTech::save_initial_data --------//</span>
00282 <span class="preprocessor">#endif</span>
00283 <span class="preprocessor"></span><span class="comment">// ##### End Marco ##### //</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:02 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
