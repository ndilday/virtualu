<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SVD.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>SVD.CPP</h1><a href="SVD_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Owner: Fred</span>
00002 <span class="comment">//$$svd.cpp                           singular value decomposition</span>
00003 
00004 <span class="comment">// Copyright (C) 1991,2,3,4,5: R B Davies</span>
00005 <span class="comment">// Updated 17 July, 1995</span>
00006 
<a name="l00007"></a><a class="code" href="SVD_8CPP.html#a0">00007</a> <span class="preprocessor">#define WANT_MATH</span>
00008 <span class="preprocessor"></span>
00009 <span class="preprocessor">#include "include.h"</span>
00010 <span class="preprocessor">#include "newmat.h"</span>
00011 <span class="preprocessor">#include "newmatrm.h"</span>
00012 <span class="preprocessor">#include "precisio.h"</span>
00013 
00014 <span class="preprocessor">#ifdef use_namespace</span>
00015 <span class="preprocessor"></span><span class="keyword">namespace </span>NEWMAT {
00016 <span class="preprocessor">#endif</span>
00017 <span class="preprocessor"></span>
00018     <span class="keyword">static</span> <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> pythag(<a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> f, <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> g, <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>&amp; c, <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>&amp; s) {
00019         <span class="comment">// return z=sqrt(f*f+g*g), c=f/z, s=g/z</span>
00020         <span class="comment">// set c=1,s=0 if z==0</span>
00021         <span class="comment">// avoid floating point overflow or divide by zero</span>
00022         <span class="keywordflow">if</span> (f==0 &amp;&amp; g==0) { c=1.0; s=0.0; <span class="keywordflow">return</span> 0.0; }
00023         <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> af = f&gt;=0 ? f : -f;
00024         <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> ag = g&gt;=0 ? g : -g;
00025         <span class="keywordflow">if</span> (ag&lt;af) {
00026             <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> h = g/f; <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> <a class="code" href="OCOLTBL_8CPP.html#a4">sq</a> = sqrt(1.0+h*h);
00027             <span class="keywordflow">if</span> (f&lt;0) <a class="code" href="OCOLTBL_8CPP.html#a4">sq</a> = -<a class="code" href="OCOLTBL_8CPP.html#a4">sq</a>;                          <span class="comment">// make return value non-negative</span>
00028             c = 1.0/<a class="code" href="OCOLTBL_8CPP.html#a4">sq</a>; s = h/<a class="code" href="OCOLTBL_8CPP.html#a4">sq</a>; <span class="keywordflow">return</span> <a class="code" href="OCOLTBL_8CPP.html#a4">sq</a>*f;
00029         }
00030         <span class="keywordflow">else</span> {
00031             <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> h = f/g; <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> <a class="code" href="OCOLTBL_8CPP.html#a4">sq</a> = sqrt(1.0+h*h);
00032             <span class="keywordflow">if</span> (g&lt;0) <a class="code" href="OCOLTBL_8CPP.html#a4">sq</a> = -<a class="code" href="OCOLTBL_8CPP.html#a4">sq</a>;
00033             s = 1.0/<a class="code" href="OCOLTBL_8CPP.html#a4">sq</a>; c = h/<a class="code" href="OCOLTBL_8CPP.html#a4">sq</a>; <span class="keywordflow">return</span> <a class="code" href="OCOLTBL_8CPP.html#a4">sq</a>*g;
00034         }
00035     }
00036 
<a name="l00037"></a><a class="code" href="namespaceNEWMAT.html#a87">00037</a>     <span class="keywordtype">void</span> <a class="code" href="namespaceNEWMAT.html#a87">SVD</a>(<span class="keyword">const</span> <a class="code" href="classNEWMAT_1_1Matrix.html">Matrix</a>&amp; A, <a class="code" href="classNEWMAT_1_1DiagonalMatrix.html">DiagonalMatrix</a>&amp; Q, <a class="code" href="classNEWMAT_1_1Matrix.html">Matrix</a>&amp; U, <a class="code" href="classNEWMAT_1_1Matrix.html">Matrix</a>&amp; V,
00038              <span class="keywordtype">bool</span> withU, <span class="keywordtype">bool</span> withV) {
00039         <span class="comment">// from Wilkinson and Reinsch: "Handbook of Automatic Computation"</span>
00040         <a class="code" href="classTracer.html">Tracer</a> trace(<span class="stringliteral">"SVD"</span>);
00041         <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> eps = FloatingPointPrecision::Epsilon();
00042         <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> tol = FloatingPointPrecision::Minimum()/eps;
00043 
00044         <span class="keywordtype">int</span> m = A.<a class="code" href="classNEWMAT_1_1GeneralMatrix.html#a2">Nrows</a>(); <span class="keywordtype">int</span> n = A.<a class="code" href="classNEWMAT_1_1GeneralMatrix.html#a3">Ncols</a>();
00045         <span class="keywordflow">if</span> (m&lt;n)
00046             Throw(<a class="code" href="classNEWMAT_1_1ProgramException.html">ProgramException</a>(<span class="stringliteral">"Want no. Rows &gt;= no. Cols"</span>, A));
00047 
00048         U = A; <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> g = 0.0; <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> f,h; <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> x = 0.0; <span class="keywordtype">int</span> i;
00049         <a class="code" href="classNEWMAT_1_1RowVector.html">RowVector</a> E(n); <a class="code" href="classRectMatrixRow.html">RectMatrixRow</a> EI(E,0); Q.<a class="code" href="classNEWMAT_1_1DiagonalMatrix.html#a25">ReSize</a>(n);
00050         <a class="code" href="classRectMatrixCol.html">RectMatrixCol</a> UCI(U,0); <a class="code" href="classRectMatrixRow.html">RectMatrixRow</a> URI(U,0,1,n-1);
00051 
00052         <span class="keywordflow">for</span> (i=0; i&lt;n; i++) {
00053             EI.<a class="code" href="classRectMatrixRowCol.html#a8">First</a>() = g; <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> ei = g; EI.<a class="code" href="classRectMatrixRow.html#a6">Right</a>(); <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> s = UCI.<a class="code" href="classRectMatrixRowCol.html#a7">SumSquare</a>();
00054             <span class="keywordflow">if</span> (s&lt;tol) Q.<a class="code" href="classNEWMAT_1_1DiagonalMatrix.html#a11">element</a>(i) = 0.0;
00055             <span class="keywordflow">else</span> {
00056                 f = UCI.<a class="code" href="classRectMatrixRowCol.html#a8">First</a>(); g = -<a class="code" href="NEWMATRM_8H.html#a2">sign</a>(sqrt(s), f); h = f*g-s; UCI.<a class="code" href="classRectMatrixRowCol.html#a8">First</a>() = f-g;
00057                 Q.<a class="code" href="classNEWMAT_1_1DiagonalMatrix.html#a11">element</a>(i) = g; <a class="code" href="classRectMatrixCol.html">RectMatrixCol</a> UCJ = UCI; <span class="keywordtype">int</span> j=n-i;
00058                 <span class="keywordflow">while</span> (--j) { UCJ.<a class="code" href="classRectMatrixCol.html#a5">Right</a>(); UCJ.<a class="code" href="classRectMatrixRowCol.html#a1">AddScaled</a>(UCI, (UCI*UCJ)/h); }
00059             }
00060 
00061             s = URI.<a class="code" href="classRectMatrixRowCol.html#a7">SumSquare</a>();
00062             <span class="keywordflow">if</span> (s&lt;tol) g = 0.0;
00063             <span class="keywordflow">else</span> {
00064                 f = URI.<a class="code" href="classRectMatrixRowCol.html#a8">First</a>(); g = -<a class="code" href="NEWMATRM_8H.html#a2">sign</a>(sqrt(s), f); URI.<a class="code" href="classRectMatrixRowCol.html#a8">First</a>() = f-g;
00065                 EI.<a class="code" href="classRectMatrixRowCol.html#a2">Divide</a>(URI,f*g-s); <a class="code" href="classRectMatrixRow.html">RectMatrixRow</a> URJ = URI; <span class="keywordtype">int</span> j=m-i;
00066                 <span class="keywordflow">while</span> (--j) { URJ.<a class="code" href="classRectMatrixRow.html#a5">Down</a>(); URJ.<a class="code" href="classRectMatrixRowCol.html#a1">AddScaled</a>(EI, URI*URJ); }
00067             }
00068 
00069             <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> y = <a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(Q.<a class="code" href="classNEWMAT_1_1DiagonalMatrix.html#a11">element</a>(i)) + <a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(ei); <span class="keywordflow">if</span> (x&lt;y) x = y;
00070             UCI.<a class="code" href="classRectMatrixRowCol.html#a9">DownDiag</a>(); URI.<a class="code" href="classRectMatrixRowCol.html#a9">DownDiag</a>();
00071         }
00072 
00073         <span class="keywordflow">if</span> (withV) {
00074             V.<a class="code" href="classNEWMAT_1_1Matrix.html#a21">ReSize</a>(n,n); V = 0.0; <a class="code" href="classRectMatrixCol.html">RectMatrixCol</a> VCI(V,n,n,0);
00075             <span class="keywordflow">for</span> (i=n-1; i&gt;=0; i--) {
00076                 URI.<a class="code" href="classRectMatrixRowCol.html#a10">UpDiag</a>(); VCI.<a class="code" href="classRectMatrixCol.html#a7">Left</a>();
00077                 <span class="keywordflow">if</span> (g!=0.0) {
00078                     VCI.<a class="code" href="classRectMatrixRowCol.html#a2">Divide</a>(URI, URI.<a class="code" href="classRectMatrixRowCol.html#a8">First</a>()*g); <span class="keywordtype">int</span> j = n-i;
00079                     <a class="code" href="classRectMatrixCol.html">RectMatrixCol</a> VCJ = VCI;
00080                     <span class="keywordflow">while</span> (--j) { VCJ.<a class="code" href="classRectMatrixCol.html#a5">Right</a>(); VCJ.<a class="code" href="classRectMatrixRowCol.html#a1">AddScaled</a>( VCI, (URI*VCJ) ); }
00081                 }
00082                 VCI.<a class="code" href="classRectMatrixRowCol.html#a5">Zero</a>(); VCI.<a class="code" href="classRectMatrixCol.html#a6">Up</a>(); VCI.<a class="code" href="classRectMatrixRowCol.html#a8">First</a>() = 1.0; g=E.<a class="code" href="classNEWMAT_1_1RowVector.html#a9">element</a>(i);
00083             }
00084         }
00085 
00086         <span class="keywordflow">if</span> (withU) {
00087             <span class="keywordflow">for</span> (i=n-1; i&gt;=0; i--) {
00088                 UCI.<a class="code" href="classRectMatrixRowCol.html#a10">UpDiag</a>(); g = Q.<a class="code" href="classNEWMAT_1_1DiagonalMatrix.html#a11">element</a>(i); URI.<a class="code" href="classRectMatrixRow.html#a2">Reset</a>(U,i,i+1,n-i-1); URI.<a class="code" href="classRectMatrixRowCol.html#a5">Zero</a>();
00089                 <span class="keywordflow">if</span> (g!=0.0) {
00090                     h=UCI.<a class="code" href="classRectMatrixRowCol.html#a8">First</a>()*g; <span class="keywordtype">int</span> j=n-i; <a class="code" href="classRectMatrixCol.html">RectMatrixCol</a> UCJ = UCI;
00091                     <span class="keywordflow">while</span> (--j) {
00092                         UCJ.<a class="code" href="classRectMatrixCol.html#a5">Right</a>(); UCI.<a class="code" href="classRectMatrixCol.html#a4">Down</a>(); UCJ.<a class="code" href="classRectMatrixCol.html#a4">Down</a>(); <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> s = UCI*UCJ;
00093                         UCI.<a class="code" href="classRectMatrixCol.html#a6">Up</a>(); UCJ.<a class="code" href="classRectMatrixCol.html#a6">Up</a>(); UCJ.<a class="code" href="classRectMatrixRowCol.html#a1">AddScaled</a>(UCI,s/h);
00094                     }
00095                     UCI.<a class="code" href="classRectMatrixRowCol.html#a2">Divide</a>(g);
00096                 }
00097                 <span class="keywordflow">else</span> UCI.<a class="code" href="classRectMatrixRowCol.html#a5">Zero</a>();
00098                 UCI.<a class="code" href="classRectMatrixRowCol.html#a8">First</a>() += 1.0;
00099             }
00100         }
00101 
00102         eps *= x;
00103         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=n-1; k&gt;=0; k--) {
00104             <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> z; <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> y; <span class="keywordtype">int</span> limit = 50; <span class="keywordtype">int</span> l;
00105             <span class="keywordflow">while</span> (limit--) {
00106                 <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> c, s; <span class="keywordtype">int</span> i; <span class="keywordtype">int</span> l1=k; <span class="keywordtype">bool</span> tfc=<span class="keyword">false</span>;
00107                 <span class="keywordflow">for</span> (l=k; l&gt;=0; l--) {
00108                     <span class="comment">//          if (fabs(E.element(l))&lt;=eps) goto test_f_convergence;</span>
00109                     <span class="keywordflow">if</span> (<a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(E.<a class="code" href="classNEWMAT_1_1RowVector.html#a9">element</a>(l))&lt;=eps) { tfc=<span class="keyword">true</span>; <span class="keywordflow">break</span>; }
00110                     <span class="keywordflow">if</span> (<a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(Q.<a class="code" href="classNEWMAT_1_1DiagonalMatrix.html#a11">element</a>(l-1))&lt;=eps) { l1=l; <span class="keywordflow">break</span>; }
00111                 }
00112                 <span class="keywordflow">if</span> (!tfc) {
00113                     l=l1; l1=l-1; s = -1.0; c = 0.0;
00114                     <span class="keywordflow">for</span> (i=l; i&lt;=k; i++) {
00115                         f = - s * E.<a class="code" href="classNEWMAT_1_1RowVector.html#a9">element</a>(i); E.<a class="code" href="classNEWMAT_1_1RowVector.html#a9">element</a>(i) *= c;
00116                         <span class="comment">//             if (fabs(f)&lt;=eps) goto test_f_convergence;</span>
00117                         <span class="keywordflow">if</span> (<a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(f)&lt;=eps) <span class="keywordflow">break</span>;
00118                         g = Q.<a class="code" href="classNEWMAT_1_1DiagonalMatrix.html#a11">element</a>(i); h = pythag(g,f,c,s); Q.<a class="code" href="classNEWMAT_1_1DiagonalMatrix.html#a11">element</a>(i) = h;
00119                         <span class="keywordflow">if</span> (withU) {
00120                             <a class="code" href="classRectMatrixCol.html">RectMatrixCol</a> UCI(U,i); <a class="code" href="classRectMatrixCol.html">RectMatrixCol</a> UCJ(U,l1);
00121                             <a class="code" href="NEWMATRM_8CPP.html#a0">ComplexScale</a>(UCJ, UCI, c, s);
00122                         }
00123                     }
00124                 }
00125                 <span class="comment">//    test_f_convergence: z = Q.element(k); if (l==k) goto convergence;</span>
00126                 z = Q.<a class="code" href="classNEWMAT_1_1DiagonalMatrix.html#a11">element</a>(k);  <span class="keywordflow">if</span> (l==k) <span class="keywordflow">break</span>;
00127 
00128                 x = Q.<a class="code" href="classNEWMAT_1_1DiagonalMatrix.html#a11">element</a>(l); y = Q.<a class="code" href="classNEWMAT_1_1DiagonalMatrix.html#a11">element</a>(k-1);
00129                 g = E.<a class="code" href="classNEWMAT_1_1RowVector.html#a9">element</a>(k-1); h = E.<a class="code" href="classNEWMAT_1_1RowVector.html#a9">element</a>(k);
00130                 f = ((y-z)*(y+z) + (g-h)*(g+h)) / (2*h*y);
00131                 <span class="keywordflow">if</span> (f&gt;1)         g = f * sqrt(1 + <a class="code" href="namespaceNEWMAT.html#a1">square</a>(1/f));
00132                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (f&lt;-1)   g = -f * sqrt(1 + <a class="code" href="namespaceNEWMAT.html#a1">square</a>(1/f));
00133                 <span class="keywordflow">else</span>             g = sqrt(f*f + 1);
00134                 f = ((x-z)*(x+z) + h*(y / ((f&lt;0.0) ? f-g : f+g)-h)) / x;
00135 
00136                 c = 1.0; s = 1.0;
00137                 <span class="keywordflow">for</span> (i=l+1; i&lt;=k; i++) {
00138                     g = E.<a class="code" href="classNEWMAT_1_1RowVector.html#a9">element</a>(i); y = Q.<a class="code" href="classNEWMAT_1_1DiagonalMatrix.html#a11">element</a>(i); h = s*g; g *= c;
00139                     z = pythag(f,h,c,s); E.<a class="code" href="classNEWMAT_1_1RowVector.html#a9">element</a>(i-1) = z;
00140                     f = x*c + g*s; g = -x*s + g*c; h = y*s; y *= c;
00141                     <span class="keywordflow">if</span> (withV) {
00142                         <a class="code" href="classRectMatrixCol.html">RectMatrixCol</a> VCI(V,i); <a class="code" href="classRectMatrixCol.html">RectMatrixCol</a> VCJ(V,i-1);
00143                         <a class="code" href="NEWMATRM_8CPP.html#a0">ComplexScale</a>(VCI, VCJ, c, s);
00144                     }
00145                     z = pythag(f,h,c,s); Q.<a class="code" href="classNEWMAT_1_1DiagonalMatrix.html#a11">element</a>(i-1) = z;
00146                     f = c*g + s*y; x = -s*g + c*y;
00147                     <span class="keywordflow">if</span> (withU) {
00148                         <a class="code" href="classRectMatrixCol.html">RectMatrixCol</a> UCI(U,i); <a class="code" href="classRectMatrixCol.html">RectMatrixCol</a> UCJ(U,i-1);
00149                         <a class="code" href="NEWMATRM_8CPP.html#a0">ComplexScale</a>(UCI, UCJ, c, s);
00150                     }
00151                 }
00152                 E.<a class="code" href="classNEWMAT_1_1RowVector.html#a9">element</a>(l) = 0.0; E.<a class="code" href="classNEWMAT_1_1RowVector.html#a9">element</a>(k) = f; Q.<a class="code" href="classNEWMAT_1_1DiagonalMatrix.html#a11">element</a>(k) = x;
00153             }
00154             <span class="keywordflow">if</span> (l!=k) { Throw(<a class="code" href="classNEWMAT_1_1ConvergenceException.html">ConvergenceException</a>(A)); }
00155             <span class="comment">// convergence:</span>
00156             <span class="keywordflow">if</span> (z &lt; 0.0) {
00157                 Q.<a class="code" href="classNEWMAT_1_1DiagonalMatrix.html#a11">element</a>(k) = -z;
00158                 <span class="keywordflow">if</span> (withV) { <a class="code" href="classRectMatrixCol.html">RectMatrixCol</a> VCI(V,k); VCI.<a class="code" href="classRectMatrixRowCol.html#a4">Negate</a>(); }
00159             }
00160         }
00161     }
00162 
<a name="l00163"></a><a class="code" href="namespaceNEWMAT.html#a88">00163</a>     <span class="keywordtype">void</span> <a class="code" href="namespaceNEWMAT.html#a87">SVD</a>(<span class="keyword">const</span> <a class="code" href="classNEWMAT_1_1Matrix.html">Matrix</a>&amp; A, <a class="code" href="classNEWMAT_1_1DiagonalMatrix.html">DiagonalMatrix</a>&amp; D)
00164     { <a class="code" href="classNEWMAT_1_1Matrix.html">Matrix</a> U; <a class="code" href="namespaceNEWMAT.html#a87">SVD</a>(A, D, U, U, <span class="keyword">false</span>, <span class="keyword">false</span>); }
00165 
00166 <span class="preprocessor">#ifdef use_namespace</span>
00167 <span class="preprocessor"></span>}
00168 <span class="preprocessor">#endif</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:38 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
