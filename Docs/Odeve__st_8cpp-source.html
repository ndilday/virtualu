<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Odeve_st.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Odeve_st.cpp</h1><a href="Odeve__st_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : ODeve_st.cpp</span>
00002 <span class="comment">//Description : Development Class Definition related to Simulation and Statistics/History</span>
00003 <span class="comment">//Owner       : Fred</span>
00004 
00005 <span class="comment">// ES library header file</span>
00006 <span class="preprocessor">#include &lt;OMATH.H&gt;</span>
00007 
00008 <span class="comment">// CU header file</span>
00009 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>
00010 <span class="preprocessor">#include &lt;OCHANCE.H&gt;</span>
00011 <span class="preprocessor">#include &lt;OCHANCE.H&gt;</span>
00012 <span class="preprocessor">#include &lt;OPSCHOOL.H&gt;</span>
00013 <span class="preprocessor">#include &lt;<a class="code" href="OPEERSCH_8H.html">OPEERSCH.H</a>&gt;</span>
00014 <span class="preprocessor">#include &lt;<a class="code" href="OSCHLRES_8H.html">OSCHLRES.H</a>&gt;</span>
00015 <span class="preprocessor">#include &lt;OFinance.H&gt;</span>
00016 
00017 <span class="preprocessor">#include &lt;OATHLETI.H&gt;</span>
00018 <span class="preprocessor">#include "ODevelop.h"</span>
00019 
00020 <span class="comment">//----------- Define static variables -------------//</span>
00021 <span class="comment">//----------- Define static functions -------------//</span>
00022 <span class="comment">//----------- Define static class member variables -------------//</span>
00023 
00024 <span class="comment">//----------- Begin of function Development::init_data -----//</span>
<a name="l00029"></a><a class="code" href="classDevelopment.html#a9">00029</a> <span class="comment">void Development::init_data() {</span>
00030     <span class="comment">//assume called: memset(this, 0, sizeof(Development));</span>
00031     allocation_policy.cur_operations = 0.50f;
00032     allocation_policy.endowment = 0.30f;
00033     allocation_policy.facilities = 0.20f;
00034 
00035     <span class="comment">/*</span>
00036 <span class="comment">      last_year.total = (float) finance.revenue_array[AC_GIFTS].total;</span>
00037 <span class="comment">      last_year.cur_operations = last_year.total * allocation_policy.cur_operations ;</span>
00038 <span class="comment">      last_year.endowment = last_year.total * allocation_policy.endowment ;</span>
00039 <span class="comment">      last_year.facilities = last_year.total * allocation_policy.facilities ;</span>
00040 <span class="comment">      this_month_total_gift = (float) finance.revenue_array[AC_GIFTS].total / 12;</span>
00041 <span class="comment">      //next_month_total_gift = this_month_total_gift;</span>
00042 <span class="comment">    */</span>
00043 
00044     <span class="comment">// 990417</span>
00045 
00046     last_year.total = (float) finance.revenue_array[<a class="code" href="Ofinance_8h.html#a101a36">AC_GIFTS</a>].total / allocation_policy.cur_operations;
00047     last_year.cur_operations = last_year.total * allocation_policy.cur_operations ;
00048     last_year.endowment = last_year.total * allocation_policy.endowment ;
00049     last_year.facilities = last_year.total * allocation_policy.facilities ;
00050     this_month_total_gift = last_year.cur_operations / 12;
00051 
00052     <a class="code" href="ALL_8H.html#a0">err_when</a>(this_month_total_gift &lt;= 0);
00053     memcpy(&amp;this_year, &amp;last_year, <span class="keyword">sizeof</span>(<a class="code" href="structGiftComponent.html">GiftComponent</a>));
00054 
00055     <a class="code" href="structGiftComponent.html">GiftComponent</a> saveLastYear;
00056     memcpy(&amp;saveLastYear, &amp;last_year, <span class="keyword">sizeof</span>(<a class="code" href="structGiftComponent.html">GiftComponent</a>));
00057 
00058     init_inst_advancement = (int)finance.expense_array[<a class="code" href="Ofinance_8h.html#a104a51">AC_INST_ADVANCEMENT</a>].total;
00059     init_prestige = (int) school_res.player_peer_school-&gt;prestige;
00060 
00061     update_history(UPDATE_ALL);
00062 
00063     <span class="comment">// call after update_history</span>
00064     memcpy(&amp;last_year, &amp;saveLastYear, <span class="keyword">sizeof</span>(<a class="code" href="structGiftComponent.html">GiftComponent</a>));
00065 
00066     <a class="code" href="ALL_8H.html#a0">err_when</a>(this_year.total&lt;=0||init_inst_advancement&lt;=0 || init_prestige&lt;=0);
00067 }
00068 
00069 <span class="comment">//------------- End of function Development::init_data -----//</span>
00070 
00071 <span class="comment">//----------- Begin of function Development::next_day ------//</span>
<a name="l00073"></a><a class="code" href="classDevelopment.html#a10">00073</a> <span class="comment">void Development::next_day() {</span>
00074     <span class="comment">// start of a month</span>
00075     <span class="keywordflow">if</span> ( info.game_day == 1 ) {
00076         <span class="comment">// start of a year</span>
00077         <span class="keywordflow">if</span> ( info.game_month == finance.fiscal_year_start_month )
00078             update_history(UPDATE_YEAR);
00079 
00080         <span class="comment">//              update_history_sub();           // this line shouldn't be called by init_data()!!??</span>
00081         update_history(UPDATE_MONTH);
00082 
00083     }
00084 
00085     <span class="comment">// start of a trimester</span>
00086     <span class="keywordflow">if</span> ( info.game_day == player_school.trimester_array[player_school.cur_trimester].start_day
00087          &amp;&amp; info.game_month == player_school.trimester_array[player_school.cur_trimester].start_month ) {
00088         update_history(UPDATE_TRIMESTER);
00089     }
00090 }
00091 
00092 <span class="comment">//------------- End of function Developmen::next_day ------//</span>
00093 
00094 <span class="comment">//----------- Begin of function Development::init --------//</span>
00100 <span class="comment"></span>
00101 <span class="comment">//----------- Begin of function Development::update_history_sub --------//</span>
00103 <span class="comment">void Development::update_history_sub() {</span>
00104     history_value[<a class="code" href="Gamedef_8h.html#a82a55">FIRST_H_THIS_YEAR</a>-1] = (float) last_year.total;
00105     history_value[<a class="code" href="Gamedef_8h.html#a82a56">SECOND_H_THIS_YEAR</a>-1] = (float) finance.expense_array[<a class="code" href="Ofinance_8h.html#a104a51">AC_INST_ADVANCEMENT</a>].total;
00106 
00107     history_value[<a class="code" href="Gamedef_8h.html#a82a55">FIRST_H_THIS_YEAR</a>] = (float) this_year.total;
00108     history_value[<a class="code" href="Gamedef_8h.html#a82a56">SECOND_H_THIS_YEAR</a>] = (float) finance.projected_expense_array[<a class="code" href="Ofinance_8h.html#a104a51">AC_INST_ADVANCEMENT</a>].this_year.total;
00109 
00110     history_value[<a class="code" href="Gamedef_8h.html#a82a55">FIRST_H_THIS_YEAR</a>+1] = (float) gift_total_next_year;
00111     history_value[<a class="code" href="Gamedef_8h.html#a82a56">SECOND_H_THIS_YEAR</a>+1] = (float) finance.projected_expense_array[<a class="code" href="Ofinance_8h.html#a104a51">AC_INST_ADVANCEMENT</a>].next_year.total;
00112 }
00113 
00114 <span class="comment">//------------- End of function Development::update_history_sub --------//</span>
00115 
00116 <span class="comment">//----------- Begin of function Development::update_history ------//</span>
00121 <span class="comment">void Development::update_history(char update_flag) {</span>
00122     <span class="comment">//int h;</span>
00123 
00124     <span class="keywordflow">switch</span> (update_flag) {
00125     <span class="keywordflow">case</span> UPDATE_MONTH:
00126         <span class="comment">//              shift_history(history_value, HISTORY_YEAR_COUNT2);</span>
00127         calc_gift_growth_rate();
00128         calc_gift_all();
00129         update_history_sub();
00130 
00131         <span class="keywordflow">break</span>;
00132 
00133     <span class="keywordflow">case</span> UPDATE_TRIMESTER:
00134         <span class="keywordflow">break</span>;
00135 
00136     <span class="keywordflow">case</span> UPDATE_YEAR:
00137         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(percent_alumni_gave_gift_history, HISTORY_YEAR_COUNT);
00138         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(alumni_morale_history, HISTORY_YEAR_COUNT);
00139 
00140         <span class="comment">//-----------//</span>
00141 
00142         calc_percent_alumni_gave_gift();
00143         percent_alumni_gave_gift_history[THIS_YEAR] = percent_alumni_gave_gift;
00144 
00145         calc_alumni_morale();
00146         alumni_morale_history[THIS_YEAR] = alumni_morale;
00147 
00148         <span class="comment">//-----------//</span>
00149 
00150         memcpy(&amp;last_year, &amp;this_year, <span class="keyword">sizeof</span>(<a class="code" href="structGiftComponent.html">GiftComponent</a>));
00151         memset(&amp;this_year, 0, <span class="keyword">sizeof</span>(<a class="code" href="structGiftComponent.html">GiftComponent</a>));
00152 
00153         <span class="comment">//## chea 091299 7.2.1 try to disp the graph</span>
00154         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(history_value, HISTORY_YEAR_COUNT2);
00155 
00156         calc_gift_growth_rate();
00157         calc_gift_all();
00158 
00159         <span class="comment">//-----------//</span>
00160         <span class="comment">// 1 of 2: shift history to "left"</span>
00161         <span class="comment">//</span>
00162         <span class="comment">//## chea 031299 7.2.1 try to disp the graph</span>
00163         <span class="comment">//              shift_history(history_value, HISTORY_YEAR_COUNT2);</span>
00164         <span class="comment">//              shift_history(history_value, HISTORY_YEAR_COUNT2);</span>
00165 
00166         <span class="comment">// 2 of 2: update current year values</span>
00167 
00168         update_history_sub();
00169         <span class="keywordflow">break</span>;
00170 
00171     <span class="keywordflow">case</span> UPDATE_ALL:
00172         update_history(UPDATE_YEAR);
00173         update_history(UPDATE_TRIMESTER);
00174         update_history(UPDATE_MONTH);
00175         <span class="keywordflow">break</span>;
00176     <span class="keywordflow">default</span>:
00177         <a class="code" href="ALL_8H.html#a1">err_here</a>();
00178         <span class="keywordflow">break</span>;
00179     }
00180 }
00181 
00182 <span class="comment">//------------- End of function Development::update_history ------//</span>
00183 
00184 <span class="comment">//---------- Begin of function Development::calc_gift_growth_rate -----------//</span>
00185 <span class="keywordtype">void</span> Development::calc_gift_growth_rate() {
00186     <span class="keyword">const</span> <span class="keywordtype">char</span> M_VAR_COUNT=3;
00187     <span class="keywordtype">int</span> i;
00188     <span class="keywordtype">float</span> input[M_VAR_COUNT];
00189     memset(input, 0, <span class="keyword">sizeof</span>(input));
00190     <span class="comment">//--------------//</span>
00191     input[0] = (float) finance.expense_array[<a class="code" href="Ofinance_8h.html#a104a51">AC_INST_ADVANCEMENT</a>].total / init_inst_advancement;
00192 
00193     <span class="comment">//----//</span>
00194     input[0] *= (float) finance.cost_rise_policy_array[<a class="code" href="Ofinance_8h.html#a112a82">PL_INST_ADVANCEMENT</a>].penalty_multiplier1;
00195 
00196     <span class="comment">//--------------//</span>
00197 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00198 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( info.prerun_year )
00199         input[1] = float( school_res.player_peer_school-&gt;prestige )/ init_prestige;
00200     <span class="keywordflow">else</span>
00201         input[1] = float( player_school.sub_score[<a class="code" href="Opschool_8h.html#a65a39">S_PRESTIGE</a>][THIS_MONTH] ) / player_school.sub_score_start[<a class="code" href="Opschool_8h.html#a65a39">S_PRESTIGE</a>];
00202 <span class="preprocessor">#else</span>
00203 <span class="preprocessor"></span>    input[1] = float( school_res.player_peer_school-&gt;prestige )/ init_prestige;
00204 <span class="preprocessor">#endif</span>
00205 <span class="preprocessor"></span>
00206     <span class="comment">//--------------//</span>
00207     input[2] = athletics_office.avg_percent_win;
00208 
00209     <span class="comment">//--------------//</span>
00210 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00211 <span class="preprocessor"></span>    input[0] = math.single_response_func(-0.012f,0.020f,1.000f,1.007f, input[0]);
00212     input[1] = math.dual_response_func(-0.012f,0.0048f,0.020f,5.516f,0.337f,0.588f,1.493f, input[1]);
00213     input[2] = math.dual_response_func(-0.012f,-0.0002f,0.020f,25.89f,28.74f,20.00f,75.00f, input[2]);
00214 <span class="preprocessor">#else</span>
00215 <span class="preprocessor"></span>    input[0] = math.single_response_func(-0.0083f,0.0125f,1.000f,1.007f, input[0]);
00216     input[1] = math.dual_response_func(-0.0083f,0.0048f,0.0125f,5.516f,0.337f,0.588f,1.493f, input[1]);
00217     input[2] = math.dual_response_func(-0.0083f,-0.0002f,0.0125f,25.89f,28.74f,20.00f,75.00f, input[2]);
00218 <span class="preprocessor">#endif</span>
00219 <span class="preprocessor"></span>
00220     <span class="keywordtype">float</span> weight[M_VAR_COUNT] = {0.35f, 0.45f, 0.15f, };
00221 
00222     <span class="comment">//Adjust the weight based on the current NCAA level of competition:</span>
00223     <span class="comment">//top level = weight as given (.15); mid-level = .05; lowest level = 0;</span>
00224     <span class="comment">//redistribute the reduced values to the other items proportionally.</span>
00225     <span class="keywordflow">if</span> ( athletics_office.ncaa_level_input == <a class="code" href="Gamedef_8h.html#a73a23">INPUT_MEDIUM</a> )
00226         weight[2] = 0.05f;
00227     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( athletics_office.ncaa_level_input == <a class="code" href="Gamedef_8h.html#a73a22">INPUT_LOW</a> )
00228         weight[2] = 0.0f;
00229 
00230     <span class="keywordtype">float</span> remainWeight = 1 - weight[0] - weight[1] - weight[2];
00231     weight[0] += remainWeight/2;
00232     weight[1] += remainWeight/2;
00233 
00234     <span class="keywordtype">float</span> newValue = 0;
00235     <span class="keywordflow">for</span>(i=0; i&lt;M_VAR_COUNT; i++)
00236         newValue += weight[i] * input[i];
00237 
00238     <span class="comment">//gift_growth_rate = math.latency_func( 0.9f, gift_growth_rate, newValue);</span>
00239     <span class="comment">//## chea 300899 change latency_func(HE.RespF_Defs.Rev 230899 E-mail)</span>
00240     <a class="code" href="classDevelopment.html#m14">gift_growth_rate</a> = player_school.latency_func( 0.85f, <a class="code" href="classDevelopment.html#m14">gift_growth_rate</a>, newValue);
00241 
00242 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00243 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( chance_event.gift_growth_rate_multiplier )
00244         <a class="code" href="classDevelopment.html#m14">gift_growth_rate</a> *= chance_event.gift_growth_rate_multiplier;
00245 <span class="preprocessor">#else</span>
00246 <span class="preprocessor"></span>    <a class="code" href="classDevelopment.html#m14">gift_growth_rate</a> *= chance_event.gift_growth_rate_multiplier;
00247 <span class="preprocessor">#endif</span>
00248 <span class="preprocessor"></span>}
00249 
00250 <span class="comment">//---------- End of function Development::calc_gift_growth_rate -----------//</span>
00251 
00252 <span class="comment">//---------- Begin of function Development::calc_gift_all -----------//</span>
00253 <span class="keywordtype">void</span> Development::calc_gift_all() {
00254 
00255     <span class="comment">//--------------//</span>
00256     <span class="comment">// value[t] = (1+inflation+realGR)*value[t-1]</span>
00257     <span class="comment">//  value[0] = initialization value of total gifts DIVIDED BY 12</span>
00258 
00259     <span class="comment">//static float next_month_total_gift;</span>
00260 
00261     <span class="comment">//this_month_total_gift = next_month_total_gift;</span>
00262 
00263     <span class="comment">//0115: moved this to finance: next_month_total_gift = float(1+finance.inflation_rate/1200+gift_growth_rate)</span>
00264     <span class="comment">//                                                          * this_month_total_gift;</span>
00265 
00266     <span class="comment">//this_year.total += this_month_total_gift;</span>
00267 
00268     <span class="comment">/*</span>
00269 <span class="comment">      //## chea orig. method it doesn't work</span>
00270 <span class="comment"></span>
00271 <span class="comment">      float curOp = (float) finance.projected_revenue_array[AC_GIFTS].this_year.total;</span>
00272 <span class="comment">      if (allocation_policy.cur_operations &lt;= 0)</span>
00273 <span class="comment">      allocation_policy.cur_operations = 0.01f;</span>
00274 <span class="comment">      this_year.total = curOp / allocation_policy.cur_operations;</span>
00275 <span class="comment"></span>
00276 <span class="comment">      //--------------//</span>
00277 <span class="comment">      float mean = allocation_policy.cur_operations;</span>
00278 <span class="comment">      this_year.cur_operations = curOp; //990417                //this_year.total * max(0, min(1,                       // 0115: "= this_year.total" replaced "+= this_month_total_gift"</span>
00279 <span class="comment">      //math.get_random_snd(mean, float(0.1*sqrt(mean*(1-mean))))</span>
00280 <span class="comment">      //));</span>
00281 <span class="comment"></span>
00282 <span class="comment">      //--------------//</span>
00283 <span class="comment">      mean = allocation_policy.endowment;</span>
00284 <span class="comment">      this_year.endowment = this_year.total* max(0.0f,</span>
00285 <span class="comment">      min(1.0f,math.get_random_snd(mean, float(0.1*sqrt(mean*(1-mean))))  //min &amp; max bug chea</span>
00286 <span class="comment">      ));</span>
00287 <span class="comment"></span>
00288 <span class="comment">      //--------------//</span>
00289 <span class="comment"></span>
00290 <span class="comment">      this_year.facilities = this_year.total    - this_year.endowment - this_year.cur_operations;</span>
00291 <span class="comment">    */</span>
00292 
00293     <span class="comment">//## chea 180899 same alg. but diff method to avoid bug err_when(last_year.asset_array[AC_ENDOWMENT] &lt;=0) 8.1.1;</span>
00294     <span class="comment">//   still not work because finance.projected_revenue_array[AC_GIFTS].this_year.total is not = gift_total</span>
00295     <span class="comment">/*</span>
00296 <span class="comment">      if (finance.projected_revenue_array[AC_GIFTS].this_year.total&gt;0)</span>
00297 <span class="comment">      {</span>
00298 <span class="comment">      float gift_total = (float) finance.projected_revenue_array[AC_GIFTS].this_year.total;</span>
00299 <span class="comment">      this_year.cur_operations = gift_total * allocation_policy.cur_operations;</span>
00300 <span class="comment">      this_year.endowment = gift_total * allocation_policy.endowment;</span>
00301 <span class="comment">      this_year.facilities = gift_total * allocation_policy.facilities;</span>
00302 <span class="comment">      this_year.total = gift_total;</span>
00303 <span class="comment">      }</span>
00304 <span class="comment">      else</span>
00305 <span class="comment">      {</span>
00306 <span class="comment"></span>
00307 <span class="comment">      //## assign 1 to gift_total to avoid bug</span>
00308 <span class="comment"></span>
00309 <span class="comment">      float gift_tot = 1.0f;</span>
00310 <span class="comment">      finance.projected_revenue_array[AC_GIFTS].this_year.total = 1.0f;</span>
00311 <span class="comment">      this_year.cur_operations = gift_tot * allocation_policy.cur_operations;</span>
00312 <span class="comment">      this_year.endowment = gift_tot * allocation_policy.endowment;</span>
00313 <span class="comment">      this_year.facilities = gift_tot * allocation_policy.facilities;</span>
00314 <span class="comment">      this_year.total = gift_tot;</span>
00315 <span class="comment"></span>
00316 <span class="comment">      //                finance.projected_revenue_array[AC_GIFTS].this_year.total = 0.0f;</span>
00317 <span class="comment">      //                this_year.cur_operations = 0.0f;</span>
00318 <span class="comment">      //                allocation_policy.cur_operations = 0.0f;</span>
00319 <span class="comment">      //                this_year.endowment = 0.0f;</span>
00320 <span class="comment">      //                allocation_policy.endownment = 0,0f;</span>
00321 <span class="comment">      //                this_year.facilities = 0.0f;</span>
00322 <span class="comment">      //                allocation_policy.facilities = 0.0f;</span>
00323 <span class="comment">      //                this_year.total = 0.0f;</span>
00324 <span class="comment"></span>
00325 <span class="comment">      }</span>
00326 <span class="comment">    */</span>
00327     <span class="comment">//------- calculate this year gifts ---------//</span>
00328 
00329     <span class="keywordflow">if</span>(info.game_month == 9 &amp;&amp; info.game_day ==1)
00330         finance.revenue_array[<a class="code" href="Ofinance_8h.html#a101a36">AC_GIFTS</a>].total = <a class="code" href="classDevelopment.html#m3">last_year</a>.<a class="code" href="structGiftComponent.html#m1">cur_operations</a>;
00331 
00332     <span class="comment">//## use last_year.total to calc. this _year total  //## chea 240899</span>
00333 
00334     <span class="keywordtype">int</span> month_left=0;
00335 
00336     <span class="keywordflow">if</span> (info.game_month &gt;=9 &amp;&amp; info.game_month &lt;=12)
00337         month_left = info.game_month - 9;
00338     <span class="keywordflow">else</span>
00339         month_left = info.game_month + 3;
00340 
00341     <span class="comment">// happen last year</span>
00342     <span class="keywordflow">if</span>( chance_event.alumni_die_financial_year == info.financial_year()-1 )
00343         <a class="code" href="classDevelopment.html#m2">this_year</a>.<a class="code" href="structGiftComponent.html#m0">total</a> = (<a class="code" href="classDevelopment.html#m3">last_year</a>.<a class="code" href="structGiftComponent.html#m0">total</a> - chance_event.alumni_die_gift) * (1+<a class="code" href="classDevelopment.html#m14">gift_growth_rate</a>);
00344     <span class="keywordflow">else</span>
00345         <a class="code" href="classDevelopment.html#m2">this_year</a>.<a class="code" href="structGiftComponent.html#m0">total</a> = <a class="code" href="classDevelopment.html#m3">last_year</a>.<a class="code" href="structGiftComponent.html#m0">total</a> * (1+<a class="code" href="classDevelopment.html#m14">gift_growth_rate</a>);
00346 
00347     <a class="code" href="classDevelopment.html#m2">this_year</a>.<a class="code" href="structGiftComponent.html#m0">total</a> += chance_event.gift_modifier;
00348 
00349     <a class="code" href="classDevelopment.html#m11">gift_total_next_year</a> = <a class="code" href="classDevelopment.html#m2">this_year</a>.<a class="code" href="structGiftComponent.html#m0">total</a> * (1+<a class="code" href="classDevelopment.html#m14">gift_growth_rate</a>);
00350 
00351     <span class="comment">//          this_year_total_up2date = this_year.total /12 * month_left;</span>
00352     <span class="comment">// chea 201299 change by b.massy in H.K.</span>
00353     <span class="comment">//  this_year_total_up2date = this_year.total;</span>
00354 
00355     <span class="comment">//----------- chance card effects -----------//</span>
00356 
00357     <span class="comment">//## chea begin 160699</span>
00358     <span class="keywordflow">if</span> ( chance_event.scandal_in_alt_drop_gift ) {
00359         <a class="code" href="classDevelopment.html#m2">this_year</a>.<a class="code" href="structGiftComponent.html#m0">total</a> -= chance_event.scandal_in_alt_drop_gift;
00360         <span class="keywordflow">if</span>(<a class="code" href="classDevelopment.html#m2">this_year</a>.<a class="code" href="structGiftComponent.html#m0">total</a>&lt;=0)
00361             <a class="code" href="classDevelopment.html#m2">this_year</a>.<a class="code" href="structGiftComponent.html#m0">total</a> = 0;
00362     }
00363     <span class="comment">//## chea end 160699</span>
00364     <span class="comment">//## chea 180899 same alg. but diff method to avoid bug err_when(last_year.asset_array[AC_ENDOWMENT] &lt;=0);</span>
00365 
00366     <span class="keywordflow">if</span> ( chance_event.alumni_die_gift &amp;&amp;
00367          chance_event.alumni_die_financial_year == info.financial_year() ) {
00368         <a class="code" href="classDevelopment.html#m2">this_year</a>.<a class="code" href="structGiftComponent.html#m0">total</a>+= chance_event.alumni_die_gift;
00369 
00370         <span class="keywordflow">if</span>(<a class="code" href="classDevelopment.html#m2">this_year</a>.<a class="code" href="structGiftComponent.html#m0">total</a>&lt;=0)
00371             <a class="code" href="classDevelopment.html#m2">this_year</a>.<a class="code" href="structGiftComponent.html#m0">total</a> = 0;
00372     }
00373 
00374     <span class="comment">//--------------------------------------------------------------//</span>
00375 
00376     <a class="code" href="classDevelopment.html#m2">this_year</a>.<a class="code" href="structGiftComponent.html#m1">cur_operations</a> = <a class="code" href="classDevelopment.html#m2">this_year</a>.<a class="code" href="structGiftComponent.html#m0">total</a> * <a class="code" href="classDevelopment.html#m4">allocation_policy</a>.<a class="code" href="structGiftComponent.html#m1">cur_operations</a>;
00377     <a class="code" href="classDevelopment.html#m2">this_year</a>.<a class="code" href="structGiftComponent.html#m2">endowment</a> = <a class="code" href="classDevelopment.html#m2">this_year</a>.<a class="code" href="structGiftComponent.html#m0">total</a> * <a class="code" href="classDevelopment.html#m4">allocation_policy</a>.<a class="code" href="structGiftComponent.html#m2">endowment</a>;
00378     <a class="code" href="classDevelopment.html#m2">this_year</a>.<a class="code" href="structGiftComponent.html#m3">facilities</a> = <a class="code" href="classDevelopment.html#m2">this_year</a>.<a class="code" href="structGiftComponent.html#m0">total</a> * <a class="code" href="classDevelopment.html#m4">allocation_policy</a>.<a class="code" href="structGiftComponent.html#m3">facilities</a>;
00379 
00380     <span class="comment">//## chea 191099 begin</span>
00381 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00382 <span class="preprocessor"></span>    finance.projected_revenue_array[<a class="code" href="Ofinance_8h.html#a101a36">AC_GIFTS</a>].this_year.total = <a class="code" href="classDevelopment.html#m2">this_year</a>.<a class="code" href="structGiftComponent.html#m1">cur_operations</a>*(1+finance.inflation_rate/1200+<a class="code" href="classDevelopment.html#m14">gift_growth_rate</a>) ;
00383 <span class="preprocessor">#else</span>
00384 <span class="preprocessor"></span>    finance.projected_revenue_array[<a class="code" href="Ofinance_8h.html#a101a36">AC_GIFTS</a>].this_year.total = <a class="code" href="classDevelopment.html#m2">this_year</a>.<a class="code" href="structGiftComponent.html#m1">cur_operations</a> ;
00385 <span class="preprocessor">#endif</span>
00386 <span class="preprocessor"></span>    finance.projected_revenue_array[<a class="code" href="Ofinance_8h.html#a101a36">AC_GIFTS</a>].next_year.total = <a class="code" href="classDevelopment.html#m11">gift_total_next_year</a> * <a class="code" href="classDevelopment.html#m4">allocation_policy</a>.<a class="code" href="structGiftComponent.html#m1">cur_operations</a>;
00387 
00388     <span class="keywordtype">float</span> last = (float)finance.revenue_array[<a class="code" href="Ofinance_8h.html#a101a36">AC_GIFTS</a>].total;
00389     <span class="keywordtype">float</span> thisy = (float)finance.projected_revenue_array[<a class="code" href="Ofinance_8h.html#a101a36">AC_GIFTS</a>].this_year.total;
00390     <span class="keywordtype">float</span> next = (float)finance.projected_revenue_array[<a class="code" href="Ofinance_8h.html#a101a36">AC_GIFTS</a>].next_year.total;
00391     <span class="keywordtype">float</span> bud = (float)finance.budget_revenue_array[<a class="code" href="Ofinance_8h.html#a101a36">AC_GIFTS</a>].total;
00392 
00393     finance.projected_revenue_array[<a class="code" href="Ofinance_8h.html#a101a36">AC_GIFTS</a>].change_last_year.total = finance.calc_change(thisy , last);
00394 
00395     finance.projected_revenue_array[<a class="code" href="Ofinance_8h.html#a101a36">AC_GIFTS</a>].change_budget_year.total = finance.calc_change(bud , last);
00396 
00397     finance.projected_revenue_array[<a class="code" href="Ofinance_8h.html#a101a36">AC_GIFTS</a>].change_next_year.total = finance.calc_change(next , thisy);
00398 
00399     <span class="keywordtype">float</span> dev_last = <a class="code" href="classDevelopment.html#m3">last_year</a>.<a class="code" href="structGiftComponent.html#m0">total</a>;
00400     <span class="keywordtype">float</span> dev_this = <a class="code" href="classDevelopment.html#m2">this_year</a>.<a class="code" href="structGiftComponent.html#m0">total</a>;
00401     <span class="keywordtype">float</span> dev_next = <a class="code" href="classDevelopment.html#m11">gift_total_next_year</a>;
00402 
00403     <a class="code" href="classDevelopment.html#m12">gift_change_last_year</a> = (float)finance.calc_change(dev_this , dev_last);
00404     <a class="code" href="classDevelopment.html#m13">gift_change_next_year</a> = (float)finance.calc_change(dev_next , dev_this);
00405 
00406     <span class="comment">//## chea 191099 end</span>
00407 
00408     <span class="comment">//  this_year.facilities = this_year.total  - this_year.endowment - this_year.cur_operations;</span>
00409 }
00410 
00411 <span class="comment">//---------- End of function Development::calc_gift_all -----------//</span>
00412 
00413 <span class="comment">//---------- Begin of function Development::calc_percent_alumni_gave_gift -----------//</span>
00414 <span class="keywordtype">void</span> Development::calc_percent_alumni_gave_gift() {
00415     <span class="keyword">const</span> <span class="keywordtype">char</span> M_VAR_COUNT = 4;
00416     <span class="keywordtype">int</span> i;
00417     <span class="keywordtype">float</span> input[M_VAR_COUNT];
00418     memset(input, 0, <span class="keyword">sizeof</span>(input));
00419 
00420     <span class="comment">//--------------//</span>
00421     <span class="comment">// input[0] = float( finance.expense_array[AC_INST_ADVANCEMENT].total / float(finance.total_operating_expense.total));</span>
00422     <span class="comment">//## chwg290699</span>
00423 
00424     <span class="keywordflow">if</span>(info.game_year==1)
00425         <span class="keywordflow">if</span>(info.game_month==9)
00426             <a class="code" href="classDevelopment.html#m10">initializationValueAC_INST_ADVANCEMENT</a>=(float)finance.expense_array[<a class="code" href="Ofinance_8h.html#a104a51">AC_INST_ADVANCEMENT</a>].total;
00427     input[0] = float(finance.expense_array[<a class="code" href="Ofinance_8h.html#a104a51">AC_INST_ADVANCEMENT</a>].total)/
00428         (<a class="code" href="classDevelopment.html#m10">initializationValueAC_INST_ADVANCEMENT</a>*(1+math.get_random_snd(0.0f, <a class="code" href="Opschool_8h.html#a1">PSCH_SD</a>(0.05f))));
00429 
00430     <span class="comment">//--------------//</span>
00431     input[1] = float( school_res.player_peer_school-&gt;prestige );
00432 
00433     <span class="comment">//--------------//</span>
00434     input[2] = <a class="code" href="classDevelopment.html#m6">alumni_morale</a>;
00435 
00436     <span class="comment">//--------------//</span>
00437     input[3] = athletics_office.avg_percent_win;
00438 
00439     <span class="comment">//--------------//</span>
00440     <span class="comment">//  input[0] = math.dual_response_func(0,39.94f,100,2.87f,4.91f,3.79f,7.60f, input[0]);</span>
00441     <span class="comment">// chwg290699</span>
00442     input[0] = math.dual_response_func(0,60.8f,100,1.60f,1.50f,0.65f,1.40f, input[0]);
00443     input[3] = math.dual_response_func(0,40,100,19.97f,30.00f,20.00f,75.00f, input[3]);
00444 
00445     <span class="keywordtype">float</span> weight[M_VAR_COUNT] = {0.25f, 0.40f, 0.20f, 0.15f, };
00446 
00447     <span class="keywordtype">float</span> newValue = 0;
00448     <span class="keywordflow">for</span>(i=0; i&lt;M_VAR_COUNT; i++)
00449         newValue += weight[i] * input[i];
00450 
00451     multiplier_alumni = (char) player_school.latency_func( 0.5f, multiplier_alumni, newValue);
00452 
00453     <span class="comment">//The actual percentage should equal the multiplier times the following:</span>
00454     <span class="comment">//Public institutions: 0.40</span>
00455     <span class="comment">//Private institutions: 0.70</span>
00456     <span class="keywordtype">float</span> ratio = ( player_school.control == <a class="code" href="Opschool_8h.html#a61a16">PUBLIC</a> ) ? 0.4f : 0.7f;
00457     <a class="code" href="classDevelopment.html#m5">percent_alumni_gave_gift</a> = ratio * multiplier_alumni;
00458 }
00459 
00460 <span class="comment">//---------- End of function Development::calc_percent_alumni_gave_gift -----------//</span>
00461 
00462 <span class="comment">//---------- Begin of function Development::calc_alumni_morale -----------//</span>
<a name="l00463"></a><a class="code" href="classDevelopment.html#a11">00463</a> <span class="keywordtype">void</span> <a class="code" href="classDevelopment.html#a11">Development::calc_alumni_morale</a>() {
00464     <span class="keyword">const</span> <span class="keywordtype">char</span> M_VAR_COUNT=3;
00465     <span class="keywordtype">int</span> i;
00466     <span class="keywordtype">float</span> input[M_VAR_COUNT];
00467     memset(input, 0, <span class="keyword">sizeof</span>(input));
00468 
00469     <span class="comment">//--------------//</span>
00470     input[0] = float( school_res.player_peer_school-&gt;prestige );
00471 
00472     <span class="comment">//--------------//</span>
00473     input[1] = float(finance.last_year.surplus_deficit) / float(finance.total_operating_expense.total);
00474     <span class="comment">//--------------//</span>
00475     input[2] = athletics_office.avg_percent_win;
00476 
00477     <span class="comment">//--------------//</span>
00478     input[1] = math.dual_response_func(0,60,100,0.486f,0.782f,-0.931f,1.000f, input[1]);
00479     input[2] = math.dual_response_func(0,40,100,19.97f,30.00f,20.00f,75.00f, input[2]);
00480 
00481     <span class="keywordtype">float</span> weight[M_VAR_COUNT] = { 0.40f, 0.40f, 0.20f, };
00482 
00483     <span class="keywordtype">float</span> newValue = 0;
00484 
00485     <span class="keywordflow">for</span>(i=0; i&lt;M_VAR_COUNT; i++)
00486         newValue += weight[i] * input[i];
00487 
00488     <span class="comment">//-------- pass throught the latency function ---------//</span>
00489 
00490     <span class="comment">//## chea 091199 change to adpot chance event</span>
00491     <a class="code" href="classDevelopment.html#m6">alumni_morale</a> = player_school.latency_func( 0.60f, <a class="code" href="classDevelopment.html#m6">alumni_morale</a>, newValue);
00492 
00493     <span class="comment">//---------- extra effect brought the chance cards ------------//</span>
00494 
00495     <span class="keywordflow">if</span>( chance_event.extra_effect_alumni_morale ) {
00496         <a class="code" href="classDevelopment.html#m6">alumni_morale</a> *= chance_event.extra_effect_alumni_morale;
00497 
00498         chance_event.extra_effect_alumni_morale += (1.0f - chance_event.extra_effect_alumni_morale) * 0.3f;
00499 
00500         <a class="code" href="classDevelopment.html#m6">alumni_morale</a> = max(0, min(100,<a class="code" href="classDevelopment.html#m6">alumni_morale</a>) );
00501 
00502         <a class="code" href="classDevelopment.html#m8">alumni_morale_history</a>[THIS_YEAR] = <a class="code" href="classDevelopment.html#m6">alumni_morale</a>;
00503     }
00504 }
00505 
00506 <span class="comment">//---------- End of function Development::calc_alumni_morale -----------//</span>
00507 
00508 <span class="comment">// ##### Begin MArco ##### //</span>
00509 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00510 <span class="preprocessor"></span><span class="comment">//---------- Begin of function Development::save_initial_data -----------//</span>
00511 <span class="keywordtype">void</span> Development::save_initial_data() {
00512     initial_percent_alumni_gave_gift = <a class="code" href="classDevelopment.html#m5">percent_alumni_gave_gift</a>;
00513     initial_alumni_morale = <a class="code" href="classDevelopment.html#m6">alumni_morale</a>;
00514     initial_gift_total = <a class="code" href="classDevelopment.html#m3">last_year</a>.<a class="code" href="structGiftComponent.html#m0">total</a>;
00515 
00516     <span class="comment">//  initial_last_year = last_year;</span>
00517     initial_last_year_endowment = <a class="code" href="classDevelopment.html#m3">last_year</a>.<a class="code" href="structGiftComponent.html#m2">endowment</a>;
00518 }
00519 
00520 <span class="comment">//---------- End of function Development::save_initial_data -----------//</span>
00521 <span class="preprocessor">#endif</span>
00522 <span class="preprocessor"></span><span class="comment">// ##### End Marco ###### //</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:25 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
