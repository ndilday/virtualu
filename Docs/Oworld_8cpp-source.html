<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Oworld.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Oworld.cpp</h1><a href="Oworld_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OWORLD.CPP</span>
00002 <span class="comment">//Description : class World functions</span>
00003 
00004 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00005 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00006 <span class="preprocessor">#include &lt;<a class="code" href="OMOUSECR_8H.html">OMOUSECR.H</a>&gt;</span>
00007 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00008 <span class="preprocessor">#include &lt;OCONFIG.H&gt;</span>
00009 <span class="preprocessor">#include &lt;<a class="code" href="OTERRAIN_8H.html">OTERRAIN.H</a>&gt;</span>
00010 <span class="preprocessor">#include &lt;<a class="code" href="OWORLD_8H.html">OWORLD.H</a>&gt;</span>
00011 
00012 <span class="comment">//----------- Begin of function World::World ----------//</span>
00013 
<a name="l00014"></a><a class="code" href="classWorld.html#a0">00014</a> <a class="code" href="classWorld.html#a0">World::World</a>() {
00015     <a class="code" href="classWorld.html#m0">loc_matrix</a> = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00016 }
00017 
00018 <span class="comment">//------------- End of function World::World -----------//</span>
00019 
00020 <span class="comment">//----------- Begin of function World::~World ----------//</span>
00021 
<a name="l00022"></a><a class="code" href="classWorld.html#a1">00022</a> <a class="code" href="classWorld.html#a1">World::~World</a>() {
00023     <a class="code" href="classWorld.html#a3">deinit</a>();
00024 }
00025 
00026 <span class="comment">//------------- End of function World::~World -----------//</span>
00027 
00028 <span class="comment">//----------- Begin of function World::init ------------//</span>
<a name="l00030"></a><a class="code" href="classWorld.html#a2">00030</a> <span class="comment">void World::init() {</span>
00031     <span class="comment">//----------- initialize loc_matrix -----------//</span>
00032 
00033     loc_matrix = (<a class="code" href="classLocation.html">Location</a>*) <a class="code" href="ALL_8H.html#a5">mem_add</a>( <span class="keyword">sizeof</span>(<a class="code" href="classLocation.html">Location</a>) * <a class="code" href="Oworldmt_8h.html#a0">MAX_WORLD_X_LOC</a> * <a class="code" href="Oworldmt_8h.html#a1">MAX_WORLD_Y_LOC</a> );
00034 
00035     memset( loc_matrix, 0, <span class="keyword">sizeof</span>(<a class="code" href="classLocation.html">Location</a>) * <a class="code" href="Oworldmt_8h.html#a0">MAX_WORLD_X_LOC</a> * <a class="code" href="Oworldmt_8h.html#a1">MAX_WORLD_Y_LOC</a> );
00036 
00037     max_x_loc = <a class="code" href="Oworldmt_8h.html#a0">MAX_WORLD_X_LOC</a>;
00038     max_y_loc = <a class="code" href="Oworldmt_8h.html#a1">MAX_WORLD_Y_LOC</a>;
00039 
00040     <span class="comment">//---------- initialize matrix classes --------//</span>
00041 
00042     map_matrix.init( <a class="code" href="Oworldmt_8h.html#a2">MAP_X1</a>, <a class="code" href="Oworldmt_8h.html#a3">MAP_Y1</a>, <a class="code" href="Oworldmt_8h.html#a4">MAP_X2</a>, <a class="code" href="Oworldmt_8h.html#a5">MAP_Y2</a>,
00043                      <a class="code" href="Oworldmt_8h.html#a8">MAP_LOC_WIDTH</a>, <a class="code" href="Oworldmt_8h.html#a9">MAP_LOC_HEIGHT</a>,
00044                      <span class="comment">// 1-use image buffer</span>
00045                      loc_matrix, max_x_loc, max_y_loc, <a class="code" href="Gamedef_8h.html#a72a19">ZOOM_SMALL</a>, 1 );
00046 
00047     zoom1_matrix.init( <a class="code" href="Oworldmt_8h.html#a12">ZOOM_X1</a>, <a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a>, <a class="code" href="Oworldmt_8h.html#a14">ZOOM_X2</a>, <a class="code" href="Oworldmt_8h.html#a15">ZOOM_Y2</a>,
00048                        <a class="code" href="Oworldmt_8h.html#a18">ZOOM1_LOC_WIDTH</a>, <a class="code" href="Oworldmt_8h.html#a19">ZOOM1_LOC_HEIGHT</a>,
00049                        loc_matrix, max_x_loc, max_y_loc, <a class="code" href="Gamedef_8h.html#a72a20">ZOOM_MEDIUM</a> );
00050 
00051     zoom2_matrix.init( <a class="code" href="Oworldmt_8h.html#a12">ZOOM_X1</a>, <a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a>, <a class="code" href="Oworldmt_8h.html#a14">ZOOM_X2</a>, <a class="code" href="Oworldmt_8h.html#a15">ZOOM_Y2</a>,
00052                        <a class="code" href="Oworldmt_8h.html#a20">ZOOM2_LOC_WIDTH</a>, <a class="code" href="Oworldmt_8h.html#a21">ZOOM2_LOC_HEIGHT</a>,
00053                        loc_matrix, max_x_loc, max_y_loc, <a class="code" href="Gamedef_8h.html#a72a21">ZOOM_LARGE</a> );
00054 
00055     <span class="comment">//------- initialize vars -----------//</span>
00056 
00057     show_map = 1;
00058 
00059     set_zoom_level(1);                              <span class="comment">// set the zoom level to 1</span>
00060 
00061     <span class="comment">//-------- init terrain ---------//</span>
00062 
00063     init_terrain();
00064 }
00065 
00066 <span class="comment">//------------ End of function World::init -------------//</span>
00067 
00068 <span class="comment">//----------- Begin of function World::deinit ------------//</span>
<a name="l00070"></a><a class="code" href="classWorld.html#a3">00070</a> <span class="comment">void World::deinit() {</span>
00071     <span class="keywordflow">if</span>( loc_matrix ) {
00072         <a class="code" href="ALL_8H.html#a8">mem_del</a>( loc_matrix );
00073         loc_matrix = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00074     }
00075 
00076     <span class="comment">//  Matrix::disp_sort_array.deinit();</span>
00077 }
00078 
00079 <span class="comment">//------------ End of function World::deinit -------------//</span>
00080 
00081 <span class="comment">//----------- Begin of function World::set_zoom_level ------------//</span>
<a name="l00083"></a><a class="code" href="classWorld.html#a10">00083</a> <span class="comment">void World::set_zoom_level(int newZoomLevel) {</span>
00084     zoom_level = newZoomLevel;
00085 
00086     <span class="keywordflow">if</span>( zoom_level==1 )
00087         active_zoom_matrix = &amp;zoom1_matrix;
00088     <span class="keywordflow">else</span>
00089         active_zoom_matrix = &amp;zoom2_matrix;
00090 
00091     sys.redraw_zoom_flag = 1;
00092 }
00093 
00094 <span class="comment">//----------- End of function World::set_zoom_level ------------//</span>
00095 
00096 <span class="comment">//----------- Begin of function World::set_show_map ------------//</span>
<a name="l00098"></a><a class="code" href="classWorld.html#a9">00098</a> <span class="comment">void World::set_show_map(int showMapFlag) {</span>
00099     show_map = showMapFlag;
00100 
00101     sys.redraw_all_flag = 1;
00102 }
00103 
00104 <span class="comment">//----------- End of function World::set_show_map ------------//</span>
00105 
00106 <span class="comment">//----------- Begin of function World::init_terrain ------------//</span>
00108 <span class="comment">void World::init_terrain() {</span>
00109     <span class="keywordtype">int</span> terrainTypeCount = terrain_res.terrain_count;
00110 
00111     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;<a class="code" href="Oworldmt_8h.html#a0">MAX_WORLD_X_LOC</a>*<a class="code" href="Oworldmt_8h.html#a1">MAX_WORLD_Y_LOC</a> ; i++ ) {
00112         loc_matrix[i].set_terrain(m.random(terrainTypeCount)+1);
00113     }
00114 }
00115 
00116 <span class="comment">//----------- End of function World::init_terrain ------------//</span>
00117 
00118 <span class="comment">//----------- Begin of function World::draw_all ------------//</span>
<a name="l00120"></a><a class="code" href="classWorld.html#a4">00120</a> <span class="comment">void World::draw_all() {</span>
00121     active_zoom_matrix-&gt;draw_all();
00122 
00123     <span class="keywordflow">if</span>( show_map ) {
00124         vga_back.bar( <a class="code" href="Oworldmt_8h.html#a2">MAP_X1</a>, <a class="code" href="Oworldmt_8h.html#a3">MAP_Y1</a>, <a class="code" href="Oworldmt_8h.html#a4">MAP_X2</a>, <a class="code" href="Oworldmt_8h.html#a5">MAP_Y2</a>, <a class="code" href="COLOR_8H.html#a17">V_WHITE</a> );
00125 
00126         vga_back.rect( <a class="code" href="Oworldmt_8h.html#a2">MAP_X1</a>-<a class="code" href="Oworldmt_8h.html#a10">MAP_BORDER_WIDTH</a>, <a class="code" href="Oworldmt_8h.html#a3">MAP_Y1</a>-<a class="code" href="Oworldmt_8h.html#a11">MAP_BORDER_HEIGHT</a>,
00127                        <a class="code" href="Oworldmt_8h.html#a4">MAP_X2</a>+<a class="code" href="Oworldmt_8h.html#a10">MAP_BORDER_WIDTH</a>, <a class="code" href="Oworldmt_8h.html#a5">MAP_Y2</a>+<a class="code" href="Oworldmt_8h.html#a11">MAP_BORDER_HEIGHT</a>, 2, <a class="code" href="COLOR_8H.html#a15">V_BLACK</a> );
00128 
00129         map_matrix.draw_all();
00130     }
00131 }
00132 
00133 <span class="comment">//----------- End of function World::draw_all ------------//</span>
00134 
00135 <span class="comment">//----------- Begin of function World::draw_update ------------//</span>
<a name="l00137"></a><a class="code" href="classWorld.html#a5">00137</a> <span class="comment">void World::draw_update() {</span>
00138     active_zoom_matrix-&gt;draw_update();
00139 
00140     <span class="keywordflow">if</span>( show_map )
00141         map_matrix.draw_update();
00142 }
00143 
00144 <span class="comment">//----------- End of function World::draw_update ------------//</span>
00145 
00146 <span class="comment">//----------- Begin of function World::detect ------------//</span>
<a name="l00153"></a><a class="code" href="classWorld.html#a6">00153</a> <span class="comment">int World::detect() {</span>
00154     <span class="comment">//---------- detect map -----------//</span>
00155 
00156     <span class="keywordflow">if</span>( show_map ) {
00157         <span class="keywordflow">if</span>( map_matrix.detect() )
00158             <span class="keywordflow">return</span> 1;
00159     }
00160 
00161     <span class="comment">//------- detect zoom view --------//</span>
00162 
00163     <span class="keywordflow">if</span>( active_zoom_matrix-&gt;detect() )
00164         <span class="keywordflow">return</span> 1;
00165 
00166     <span class="keywordflow">return</span> 0;
00167 }
00168 
00169 <span class="comment">//----------- End of function World::detect ------------//</span>
00170 
00171 <span class="comment">//--------- Begin of function World::get_loc --------//</span>
<a name="l00173"></a><a class="code" href="classWorld.html#a7">00173</a> <span class="comment">Location* World::get_loc(int xLoc, int yLoc) {</span>
00174     <a class="code" href="ALL_8H.html#a0">err_when</a>( xLoc&lt;0 || xLoc&gt;=<a class="code" href="Oworldmt_8h.html#a0">MAX_WORLD_X_LOC</a> );
00175     <a class="code" href="ALL_8H.html#a0">err_when</a>( yLoc&lt;0 || yLoc&gt;=<a class="code" href="Oworldmt_8h.html#a1">MAX_WORLD_Y_LOC</a> );
00176 
00177     <span class="keywordflow">return</span> loc_matrix + <a class="code" href="Oworldmt_8h.html#a0">MAX_WORLD_X_LOC</a> * yLoc + xLoc;
00178 }
00179 
00180 <span class="comment">//----------- End of function World::get_loc --------//</span>
00181 
00182 <span class="comment">//--------- Begin of function World::is_loc_valid --------//</span>
<a name="l00184"></a><a class="code" href="classWorld.html#a8">00184</a> <span class="comment">Location* World::get_valid_loc(int xLoc, int yLoc) {</span>
00185     <span class="keywordflow">if</span> ( xLoc&gt;=0 &amp;&amp; xLoc&lt;<a class="code" href="Oworldmt_8h.html#a0">MAX_WORLD_X_LOC</a>
00186          &amp;&amp; yLoc&gt;=0 &amp;&amp; yLoc&lt;<a class="code" href="Oworldmt_8h.html#a1">MAX_WORLD_Y_LOC</a>) {
00187         <span class="keywordflow">return</span> loc_matrix + <a class="code" href="Oworldmt_8h.html#a0">MAX_WORLD_X_LOC</a> * yLoc + xLoc;
00188     }
00189     <span class="keywordflow">else</span>
00190         <span class="keywordflow">return</span> <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00191 }
00192 
00193 <span class="comment">//----------- End of function World::is_loc_valid --------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:36 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
