<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OGET.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>OGET.CPP</h1><a href="OGET_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : Get.CPP</span>
00002 <span class="comment">//Description : Object Get</span>
00003 
00004 <span class="preprocessor">#include &lt;string.h&gt;</span>
00005 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00006 <span class="preprocessor">#include &lt;ctype.h&gt;</span>
00007 <span class="preprocessor">#include &lt;time.h&gt;</span>
00008 
00009 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00010 <span class="preprocessor">#include &lt;<a class="code" href="KEY_8H.html">KEY.H</a>&gt;</span>
00011 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00012 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00013 <span class="preprocessor">#include &lt;OFONT.H&gt;</span>
00014 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00015 <span class="preprocessor">#include &lt;<a class="code" href="OGET_8H.html">OGET.H</a>&gt;</span>
00016 
00017 <span class="comment">//-------- Define constant ----------//</span>
00018 
<a name="l00019"></a><a class="code" href="OGET_8CPP.html#a0">00019</a> <span class="preprocessor">#define DEFAULT_DATE "DD/MM/YY"</span>
<a name="l00020"></a><a class="code" href="OGET_8CPP.html#a1">00020</a> <span class="preprocessor"></span><span class="preprocessor">#define PICTURE_CHRS "!9#ALNYXCMD"</span>
00021 <span class="preprocessor"></span>
00022 <span class="comment">//------- BEGIN OF FUNCTION Get::Get -----------//</span>
00023 
<a name="l00024"></a><a class="code" href="classGet.html#a0">00024</a> <a class="code" href="classGet.html#a0">Get::Get</a>() {                                      <span class="comment">// constructor</span>
00025     memset( <span class="keyword">this</span>, 0, <span class="keyword">sizeof</span>(<a class="code" href="classGet.html">Get</a>) );
00026 
00027     font_ptr = &amp;font_std;
00028 }
00029 
00030 <span class="comment">//--------- END OF FUNCTION Get::Get-------------//</span>
00031 
00032 <span class="comment">//-------- Begin of function Get::field -----------//</span>
<a name="l00044"></a><a class="code" href="classGet.html#a13">00044</a> <span class="comment">void Get::field(int desX, int y1, char* fldDes, int fldX1, char* dataPtr,</span>
00045                 <span class="keywordtype">int</span> dataWidth, <span class="keywordtype">int</span> fldX2) {
00046     <span class="comment">//-------------------------------------//</span>
00047 
00048     fld_x1 = fldX1;                                 <span class="comment">// for detect()</span>
00049     fld_y1 = y1;
00050     fld_x2 = fldX2;
00051     fld_y2 = y1+font_ptr-&gt;<a class="code" href="classFont.html#a4">height</a>()+5;
00052 
00053   <span class="comment">//-------------------------------------//</span>
00054 
00055     init( 1, 0 );                                   <span class="comment">// one field only for this get, 1-no updown exit</span>
00056 
00057     <span class="comment">// field description</span>
00058     vga.d3_panel_up( desX, fld_y1, fld_x1, fld_y2, 1 );
00059 
00060     font_ptr-&gt;put( desX+3, fld_y1+3, fldDes );
00061 
00062                                                   <span class="comment">// field content</span>
00063     vga.d3_panel_down( fld_x1+4, fld_y1, fld_x2, fld_y2 );
00064 
00065     add  ( fld_x1+8, fld_y1+4, dataPtr, <span class="charliteral">'C'</span>, fld_x2-3 );
00066     width( dataWidth, dataWidth );
00067 
00068     display();
00069 }
00070 
00071 <span class="comment">//----------- End of function Get::field -------------//</span>
00072 
00073 <span class="comment">//-------- Begin of function Get::field -----------//</span>
<a name="l00084"></a><a class="code" href="classGet.html#a14">00084</a> <span class="comment">void Get::field(int x1, int y1, char* dataPtr, int dataWidth, int x2) {</span>
00085     <span class="comment">//-------------------------------------//</span>
00086 
00087     fld_x1 = x1;                                    <span class="comment">// for detect()</span>
00088     fld_y1 = y1;
00089     fld_x2 = x2;
00090     fld_y2 = y1+font_ptr-&gt;height()+5;
00091 
00092     <span class="comment">//-------------------------------------//</span>
00093 
00094     init( 1, 0 );                                   <span class="comment">// one field only for this get, 1-no updown exit</span>
00095 
00096     <span class="comment">// field content</span>
00097     vga.d3_panel_down( fld_x1, fld_y1, fld_x2, fld_y2 );
00098 
00099     add  ( fld_x1+4, fld_y1+4, dataPtr, <span class="charliteral">'C'</span>, fld_x2-3 );
00100     width( dataWidth, dataWidth );
00101 
00102     display();
00103 }
00104 
00105 <span class="comment">//----------- End of function Get::field -------------//</span>
00106 
00107 <span class="comment">//-------- Begin of function Get::detect -----------//</span>
<a name="l00109"></a><a class="code" href="classGet.html#a15">00109</a> <span class="comment">int Get::detect() {</span>
00110     <span class="keywordflow">if</span>( get_num==0 )
00111         <span class="keywordflow">return</span> 0;
00112 
00113     <span class="keywordflow">if</span>( mouse.single_click(fld_x1, fld_y1, fld_x2, fld_y2 ) )
00114         <span class="keywordflow">return</span> read();
00115 
00116     <span class="keywordflow">return</span> 0;
00117 }
00118 
00119 <span class="comment">//----------- End of function Get::detect -------------//</span>
00120 
00121 <span class="comment">//-------- BEGIN OF FUNCTION Get::init --------------//</span>
00122 <span class="comment">//</span>
00123 <span class="comment">// Description : Initiate all setting, allocate memory,</span>
00124 <span class="comment">//               this is called when a new GET object is defined.</span>
00125 <span class="comment">//</span>
00126 <span class="comment">// &lt;int&gt; = the no. of gets</span>
00127 <span class="comment">// &lt;int&gt; = exit when UP or DOWN is pressed at the first or last field</span>
00128 <span class="comment">//</span>
<a name="l00129"></a><a class="code" href="classGet.html#a2">00129</a> <span class="keywordtype">void</span> <a class="code" href="classGet.html#a2">Get::init</a>(<span class="keywordtype">int</span> maxGetNum,<span class="keywordtype">int</span> updownExitFlag) {
00130     <a class="code" href="ALL_8H.html#a0">err_when</a>( maxGetNum==0 );
00131 
00132     <a class="code" href="classGet.html#a3">deinit</a>();
00133 
00134     fld_array = (<a class="code" href="structGetFld.html">GetFld</a>*) <a class="code" href="ALL_8H.html#a5">mem_add</a>( <span class="keyword">sizeof</span>(<a class="code" href="structGetFld.html">GetFld</a>) * maxGetNum );
00135     memset(fld_array, <a class="code" href="OHELP_8H.html#a0">NULL</a>, <span class="keyword">sizeof</span>(<a class="code" href="structGetFld.html">GetFld</a>) * maxGetNum );
00136 
00137     max_get_num  = maxGetNum;
00138     up_down_exit = updownExitFlag;
00139 
00140     get_num=0;                                      <span class="comment">// get_num is increased first, so that after running Get::add(), the get_num is still pointing to the last get</span>
00141 }
00142 
00143 <span class="comment">//------------- END OF FUNCTION Get::init --------------//</span>
00144 
00145 <span class="comment">//-------- BEGIN OF FUNCTION Get::deinit -----------//</span>
00146 <span class="comment">//</span>
<a name="l00147"></a><a class="code" href="classGet.html#a3">00147</a> <span class="keywordtype">void</span> <a class="code" href="classGet.html#a3">Get::deinit</a>() {
00148     <span class="keywordflow">if</span> (get_num&gt;0 || max_get_num&gt;0 ) {
00149         get_num=0;
00150         max_get_num=0;
00151     }
00152 
00153     <span class="keywordflow">if</span>( fld_array ) {
00154         <a class="code" href="ALL_8H.html#a8">mem_del</a>( fld_array );
00155         fld_array = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00156     }
00157 }
00158 
00159 <span class="comment">//-------- END OF FUNCTION Get::deinit ------------//</span>
00160 
00161 <span class="comment">//----------- Begin of function Get::set_font ------------//</span>
<a name="l00168"></a><a class="code" href="classGet.html#a4">00168</a> <span class="comment">void Get::set_font(Font* fontPtr) {</span>
00169     font_ptr = fontPtr;
00170 }
00171 
00172 <span class="comment">//------------- End of function Get::set_font ------------//</span>
00173 
00174 <span class="comment">//-------- BEGIN OF FUNCTION Get::add -----------//</span>
00175 <span class="comment">//</span>
00176 <span class="comment">// Description : add a GET element</span>
00177 <span class="comment">//</span>
00178 <span class="comment">// Syntax      : add( &lt;int&gt;,&lt;int&gt;,&lt;void*&gt;,&lt;char&gt;,[char] )</span>
00179 <span class="comment">//</span>
00180 <span class="comment">// &lt;int&gt;   = x</span>
00181 <span class="comment">// &lt;int&gt;   = y</span>
00182 <span class="comment">// &lt;void*&gt; = the data to be got</span>
00183 <span class="comment">// &lt;char&gt;  = type</span>
00184 <span class="comment">// &lt;int&gt;   = x2 of the field</span>
00185 <span class="comment">//</span>
00186 <span class="comment">// 'C'-Character</span>
00187 <span class="comment">// 'D'-Date</span>
00188 <span class="comment">// 'L'-Logical</span>
00189 <span class="comment">// 'N'-Numerical</span>
00190 <span class="comment">// 'l'-long</span>
00191 <span class="comment">// 'i'-integer</span>
00192 <span class="comment">// 'c'-char integer ( -128 - 127 )</span>
00193 <span class="comment">//</span>
00194 <span class="comment">// ** Note : Currently it only support "Character" type</span>
00195 <span class="comment">//</span>
<a name="l00196"></a><a class="code" href="classGet.html#a5">00196</a> <span class="keywordtype">void</span> <a class="code" href="classGet.html#a5">Get::add</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">void</span>* data, <span class="keywordtype">char</span> type, <span class="keywordtype">int</span> x2) {
00197     <a class="code" href="ALL_8H.html#a0">err_when</a>( get_num&lt;0 || get_num &gt;= max_get_num );
00198 
00199     <a class="code" href="ALL_8H.html#a2">err_if</a>( type != <span class="charliteral">'C'</span> )
00200         <a class="code" href="ALL_8H.html#a4">err_now</a>( <span class="stringliteral">"Get class now only support Character type"</span> );
00201 
00202     fld_ptr = fld_array + get_num;
00203 
00204     fld_ptr-&gt;<a class="code" href="structGetFld.html#m0">x</a>     = x;
00205     fld_ptr-&gt;<a class="code" href="structGetFld.html#m1">y</a>     = y;
00206     fld_ptr-&gt;<a class="code" href="structGetFld.html#m3">data</a>  = data;
00207     fld_ptr-&gt;<a class="code" href="structGetFld.html#m4">type</a>  = type;
00208     fld_ptr-&gt;<a class="code" href="structGetFld.html#m2">x2</a>    = x2;
00209 
00210     get_num++;
00211 }
00212 
00213 <span class="comment">//----------- END OF FUNCTION Get::add -------------//</span>
00214 
00215 <span class="comment">//-------- BEGIN OF FUNCTION Get::picture ----------//</span>
00216 <span class="comment">//</span>
00217 <span class="comment">// Description : add a picture to the last get</span>
00218 <span class="comment">//</span>
00219 <span class="comment">// Syntax      : picture( &lt;char*&gt;,&lt;int&gt; )</span>
00220 <span class="comment">//</span>
00221 <span class="comment">// &lt;char*&gt; = picture</span>
00222 <span class="comment">// &lt;int&gt;   = convert all characters to upper case (default : 0)</span>
00223 <span class="comment">//</span>
<a name="l00224"></a><a class="code" href="classGet.html#a6">00224</a> <span class="keywordtype">void</span> <a class="code" href="classGet.html#a6">Get::picture</a>( <span class="keywordtype">char</span>* in_picture,<span class="keywordtype">int</span> upper_convert ) {
00225     <a class="code" href="ALL_8H.html#a0">err_when</a>( get_num&lt;1 || get_num&gt;max_get_num );
00226 
00227     fld_ptr-&gt;<a class="code" href="structGetFld.html#m8">picture</a>       = in_picture;
00228     fld_ptr-&gt;<a class="code" href="structGetFld.html#m9">upper_convert</a> = upper_convert;
00229 }
00230 
00231 <span class="comment">//---------- END OF FUNCTION Get::picture -------------//</span>
00232 
00233 <span class="comment">//------- BEGIN OF FUNCTION Get::call -------------//</span>
00234 <span class="comment">//</span>
00235 <span class="comment">// Description : add the call routine pointer to the last get</span>
00236 <span class="comment">//</span>
00237 <span class="comment">// Syntax      : call( &lt;*()&gt;,&lt;int&gt; )</span>
00238 <span class="comment">//</span>
00239 <span class="comment">//</span>
<a name="l00240"></a><a class="code" href="classGet.html#a7">00240</a> <span class="keywordtype">void</span> <a class="code" href="classGet.html#a7">Get::call</a>( <a class="code" href="OGET_8H.html#a0">GetCall</a> *callPtr, <span class="keywordtype">int</span> callData ) {
00241     <a class="code" href="ALL_8H.html#a0">err_when</a>( get_num&lt;1 || get_num&gt;max_get_num );
00242 
00243     fld_ptr-&gt;<a class="code" href="structGetFld.html#m11">call_ptr</a>  = callPtr;
00244     fld_ptr-&gt;<a class="code" href="structGetFld.html#m12">call_data</a> = callData;
00245 }
00246 
00247 <span class="comment">//-------- END OF FUNCTION Get::call --------------//</span>
00248 
00249 <span class="comment">//-------- BEGIN OF FUNCTION Get::valid  ----------//</span>
00250 <span class="comment">//</span>
00251 <span class="comment">// Description : add a valid function pointer to the last get</span>
00252 <span class="comment">//</span>
00253 <span class="comment">// Syntax      : valid( &lt;*()&gt; )</span>
00254 <span class="comment">//</span>
00255 <span class="comment">// &lt;*()&gt; = the valid function pointer</span>
00256 <span class="comment">//</span>
<a name="l00257"></a><a class="code" href="classGet.html#a8">00257</a> <span class="keywordtype">void</span> <a class="code" href="classGet.html#a8">Get::valid</a>( <span class="keywordtype">char</span> (*validPtr)() ) {
00258     <a class="code" href="ALL_8H.html#a0">err_when</a>( get_num&lt;1 || get_num&gt;max_get_num );
00259 
00260     fld_ptr-&gt;<a class="code" href="structGetFld.html#m10">valid_ptr</a> = validPtr;
00261 }
00262 
00263 <span class="comment">//-------- END OF FUNCTION Get::valid --------------//</span>
00264 
00265 <span class="comment">//------ BEGIN OF FUNCTION Get::width -------------//</span>
00266 <span class="comment">//</span>
00267 <span class="comment">// Description : Set the width of the last get field</span>
00268 <span class="comment">//</span>
00269 <span class="comment">// Syntax : width( &lt;int&gt;,&lt;int&gt; )</span>
00270 <span class="comment">//</span>
00271 <span class="comment">// &lt;int&gt; = the width of the data   ( width_data )</span>
00272 <span class="comment">// &lt;int&gt; = the width of the screen ( width_scr  )</span>
00273 <span class="comment">//</span>
<a name="l00274"></a><a class="code" href="classGet.html#a9">00274</a> <span class="keywordtype">void</span> <a class="code" href="classGet.html#a9">Get::width</a>( <span class="keywordtype">int</span> widthData, <span class="keywordtype">int</span> widthScr ) {
00275     <a class="code" href="ALL_8H.html#a0">err_when</a>( get_num&lt;1 || get_num&gt;max_get_num ||
00276               widthData &gt; <a class="code" href="OGET_8H.html#a2a1">MAX_GET_WIDTH</a> || widthScr &gt; widthData );
00277 
00278     <span class="keywordflow">if</span> ( widthData &gt; 0)
00279         fld_ptr-&gt;<a class="code" href="structGetFld.html#m5">width_data</a> = widthData;
00280 
00281     <span class="keywordflow">if</span> ( widthScr &gt; 0)
00282         fld_ptr-&gt;<a class="code" href="structGetFld.html#m6">width_scr</a>  = widthScr;
00283 }
00284 
00285 <span class="comment">//------- END OF FUNCTION Get::width -------------//</span>
00286 
00287 <span class="comment">//------ BEGIN OF FUNCTION Get::check_data -----------//</span>
00288 <span class="comment">//</span>
00289 <span class="comment">// Description : check_data the len, type of the data</span>
00290 <span class="comment">//</span>
00291 <span class="comment">// Syntax      : check_data(&lt;char*&gt;)</span>
00292 <span class="comment">//</span>
00293 <span class="comment">// &lt;char*&gt; = the get pointer</span>
00294 <span class="comment">//</span>
00295 <span class="keywordtype">void</span> Get::check_data( <a class="code" href="structGetFld.html">GetFld</a>* getPtr ) {
00296     <span class="keywordtype">int</span>   i, pictLen;
00297     <span class="keywordtype">char</span>* ptr;
00298 
00299     <span class="keywordflow">if</span> ( getPtr-&gt;<a class="code" href="structGetFld.html#m8">picture</a> == <a class="code" href="OHELP_8H.html#a0">NULL</a> )                  <span class="comment">// get the length of the picture</span>
00300         pictLen = 0;
00301     <span class="keywordflow">else</span>
00302         pictLen = strlen( getPtr-&gt;<a class="code" href="structGetFld.html#m8">picture</a> );
00303 
00304     <span class="comment">// if length of picture &gt; 0, then the length of the get is equal to it</span>
00305     <span class="comment">// if not, than the length of the get is equal to the length of the data</span>
00306 
00307     <span class="keywordflow">switch</span>( getPtr-&gt;<a class="code" href="structGetFld.html#m4">type</a> ) {
00308     <span class="keywordflow">case</span> <span class="charliteral">'C'</span>:
00309     <span class="keywordflow">case</span> <span class="charliteral">'N'</span>:
00310     <span class="keywordflow">case</span> <span class="charliteral">'D'</span>:
00311 
00312         <span class="comment">//....... set data length ...........//</span>
00313 
00314         <span class="keywordflow">if</span>( getPtr-&gt;<a class="code" href="structGetFld.html#m5">width_data</a> &lt;= 0 )
00315             getPtr-&gt;<a class="code" href="structGetFld.html#m5">width_data</a> = pictLen;             <span class="comment">// if the length of the data is not defined picture length</span>
00316 
00317         <span class="keywordflow">if</span>( getPtr-&gt;<a class="code" href="structGetFld.html#m5">width_data</a> &lt;= 0 ) {             <span class="comment">// fill with the length of the data</span>
00318             <span class="keywordflow">if</span>( getPtr-&gt;<a class="code" href="structGetFld.html#m4">type</a> == <span class="charliteral">'D'</span> )
00319                 getPtr-&gt;<a class="code" href="structGetFld.html#m5">width_data</a> = strlen(<a class="code" href="OGET_8CPP.html#a0">DEFAULT_DATE</a>);
00320             <span class="keywordflow">else</span>
00321                 getPtr-&gt;<a class="code" href="structGetFld.html#m5">width_data</a> = strlen( (<span class="keywordtype">char</span>*) getPtr-&gt;<a class="code" href="structGetFld.html#m3">data</a> );
00322         }
00323 
00324         <span class="keywordflow">if</span> ( getPtr-&gt;<a class="code" href="structGetFld.html#m5">width_data</a> &lt;= 0 )
00325             getPtr-&gt;<a class="code" href="structGetFld.html#m5">width_data</a> = 1;
00326 
00327         <span class="comment">//....... set data screen length ...........//</span>
00328 
00329         <span class="keywordflow">if</span> (getPtr-&gt;<a class="code" href="structGetFld.html#m6">width_scr</a> &lt;= 0 || getPtr-&gt;<a class="code" href="structGetFld.html#m6">width_scr</a> &gt; getPtr-&gt;<a class="code" href="structGetFld.html#m5">width_data</a> )
00330             getPtr-&gt;<a class="code" href="structGetFld.html#m6">width_scr</a> = getPtr-&gt;<a class="code" href="structGetFld.html#m5">width_data</a>;
00331 
00332         <span class="comment">//....... Decimal place ..............//</span>
00333 
00334         <span class="keywordflow">if</span> ( getPtr-&gt;<a class="code" href="structGetFld.html#m4">type</a> == <span class="charliteral">'N'</span> ) {
00335             <span class="keywordflow">if</span> ( pictLen &gt; 0 )
00336                 ptr = getPtr-&gt;<a class="code" href="structGetFld.html#m8">picture</a>;
00337             <span class="keywordflow">else</span>
00338                 ptr = (<span class="keywordtype">char</span>*) getPtr-&gt;<a class="code" href="structGetFld.html#m3">data</a>;
00339 
00340             <span class="keywordflow">for</span>( i=1; i&lt;= getPtr-&gt;<a class="code" href="structGetFld.html#m5">width_data</a> &amp;&amp; *ptr ; i++,ptr++)
00341                 <span class="keywordflow">if</span> (*ptr == <span class="charliteral">'.'</span>) {
00342                     getPtr-&gt;<a class="code" href="structGetFld.html#m7">dec_num</a> = getPtr-&gt;<a class="code" href="structGetFld.html#m5">width_data</a> - i;
00343                     <span class="keywordflow">break</span>;
00344                 }
00345 
00346             <span class="keywordflow">if</span> ( getPtr-&gt;<a class="code" href="structGetFld.html#m7">dec_num</a> &lt; 0 )
00347                 getPtr-&gt;<a class="code" href="structGetFld.html#m7">dec_num</a> = 0 ;
00348         }
00349         <span class="keywordflow">break</span>;
00350 
00351     <span class="keywordflow">case</span> <span class="charliteral">'L'</span>:
00352         getPtr-&gt;<a class="code" href="structGetFld.html#m5">width_data</a> = getPtr-&gt;<a class="code" href="structGetFld.html#m6">width_scr</a> = 1 ;
00353         <span class="keywordflow">break</span>;
00354 
00355     <span class="keywordflow">case</span> <span class="charliteral">'l'</span>:
00356     <span class="keywordflow">case</span> <span class="charliteral">'i'</span>:
00357     <span class="keywordflow">case</span> <span class="charliteral">'c'</span>:
00358         <span class="keywordflow">if</span> ( getPtr-&gt;<a class="code" href="structGetFld.html#m6">width_scr</a> &lt;= 0) {
00359             <span class="keywordflow">if</span> ( pictLen &gt; 0 )
00360                 getPtr-&gt;<a class="code" href="structGetFld.html#m6">width_scr</a> = pictLen;
00361             <span class="keywordflow">else</span> {
00362                 <span class="keywordflow">switch</span>( getPtr-&gt;<a class="code" href="structGetFld.html#m4">type</a> ) {
00363                 <span class="keywordflow">case</span> <span class="charliteral">'l'</span> :
00364                     getPtr-&gt;<a class="code" href="structGetFld.html#m6">width_scr</a> = 8;
00365                 <span class="keywordflow">case</span> <span class="charliteral">'i'</span> :
00366                     getPtr-&gt;<a class="code" href="structGetFld.html#m6">width_scr</a> = 4;
00367                 <span class="keywordflow">case</span> <span class="charliteral">'c'</span> :
00368                     getPtr-&gt;<a class="code" href="structGetFld.html#m6">width_scr</a> = 2;              <span class="comment">// maximum 99</span>
00369                 }
00370             }
00371         }
00372         getPtr-&gt;<a class="code" href="structGetFld.html#m5">width_data</a> = getPtr-&gt;<a class="code" href="structGetFld.html#m6">width_scr</a> ;
00373         <span class="keywordflow">break</span>;
00374 
00375     <span class="keywordflow">case</span> <span class="charliteral">'d'</span>:
00376         <span class="keywordflow">if</span> ( pictLen &gt; 0 ) {
00377             ptr = strchr( getPtr-&gt;<a class="code" href="structGetFld.html#m8">picture</a>, <span class="charliteral">'.'</span> );
00378             <span class="keywordflow">if</span> ( ptr == <a class="code" href="OHELP_8H.html#a0">NULL</a> )
00379                 getPtr-&gt;<a class="code" href="structGetFld.html#m7">dec_num</a> = 0 ;
00380             <span class="keywordflow">else</span>
00381                 getPtr-&gt;<a class="code" href="structGetFld.html#m7">dec_num</a> = pictLen - (int) getPtr-&gt;<a class="code" href="structGetFld.html#m8">picture</a> - 1;
00382 
00383             getPtr-&gt;<a class="code" href="structGetFld.html#m6">width_scr</a> = pictLen;
00384         }
00385         <span class="keywordflow">else</span> {
00386             <span class="keywordflow">if</span> ( getPtr-&gt;<a class="code" href="structGetFld.html#m6">width_scr</a> &lt;= 0 )
00387                 getPtr-&gt;<a class="code" href="structGetFld.html#m6">width_scr</a> = 8;
00388 
00389             <span class="keywordflow">if</span> ( getPtr-&gt;<a class="code" href="structGetFld.html#m7">dec_num</a> &lt; 0 )
00390                 getPtr-&gt;<a class="code" href="structGetFld.html#m7">dec_num</a> = 2;
00391 
00392             <span class="keywordflow">if</span> ( getPtr-&gt;<a class="code" href="structGetFld.html#m7">dec_num</a> &gt;= getPtr-&gt;<a class="code" href="structGetFld.html#m6">width_scr</a> )
00393                 getPtr-&gt;<a class="code" href="structGetFld.html#m7">dec_num</a> = 0;
00394         }
00395 
00396         getPtr-&gt;<a class="code" href="structGetFld.html#m5">width_data</a> = getPtr-&gt;<a class="code" href="structGetFld.html#m6">width_scr</a> ;
00397         <span class="keywordflow">break</span>;
00398     }
00399 }
00400 
00401 <span class="comment">//--------- END OF FUNCTION Get::check_data ----------//</span>
00402 
00403 <span class="comment">//------- BEGIN OF FUNCTION Get::load_data ---------//</span>
00404 <span class="comment">//</span>
00405 <span class="comment">// Description : convert the raw data to pictured data</span>
00406 <span class="comment">//</span>
00407 <span class="comment">// Syntax : load_data( &lt;GetFld*&gt;, &lt;char*&gt; )</span>
00408 <span class="comment">//</span>
00409 <span class="comment">// &lt;GetFld*&gt; = the pointer to the get</span>
00410 <span class="comment">//</span>
00411 <span class="comment">// &lt;char*&gt;   = the destination buffer to store the pictured data</span>
00412 <span class="comment">//</span>
00413 <span class="comment">//</span>
00414 <span class="keywordtype">int</span> Get::load_data( <a class="code" href="structGetFld.html">GetFld</a> *getPtr, <span class="keywordtype">char</span> *chr_buf ) {
00415     <span class="comment">//------- Currently it only support "Character" type -----//</span>
00416     <span class="comment">/*</span>
00417 <span class="comment">      char* pict_char;</span>
00418 <span class="comment">      int   len;</span>
00419 <span class="comment"></span>
00420 <span class="comment">      if ( getPtr-&gt;type == 'd' )</span>
00421 <span class="comment">      {</span>
00422 <span class="comment">      ptr = c1dtoa( * ((double *) getPtr-&gt;data), getPtr-&gt;width_scr,</span>
00423 <span class="comment">      getPtr-&gt;dec_num);</span>
00424 <span class="comment">      memcpy( chr_buf, ptr, (size_t) getPtr-&gt;width_scr ) ;</span>
00425 <span class="comment">      return( getPtr-&gt;width_scr ) ;</span>
00426 <span class="comment">      }</span>
00427 <span class="comment"></span>
00428 <span class="comment">      if ( getPtr-&gt;type == 'l' )</span>
00429 <span class="comment">      {</span>
00430 <span class="comment">      c1ltoa( * ((long *) getPtr-&gt;data), chr_buf, getPtr-&gt;width_scr ) ;</span>
00431 <span class="comment">      return( getPtr-&gt;width_scr ) ;</span>
00432 <span class="comment">      }</span>
00433 <span class="comment"></span>
00434 <span class="comment">      if ( getPtr-&gt;type == 'i' )</span>
00435 <span class="comment">      {</span>
00436 <span class="comment">      c1ltoa((long) (* ((int *)getPtr-&gt;data)), chr_buf, getPtr-&gt;width_scr) ;</span>
00437 <span class="comment">      return( getPtr-&gt;width_scr ) ;</span>
00438 <span class="comment">      }</span>
00439 <span class="comment"></span>
00440 <span class="comment">      if ( getPtr-&gt;type == 'c' )</span>
00441 <span class="comment">      {</span>
00442 <span class="comment">      c1ltoa((long) (* ((char *)getPtr-&gt;data)), chr_buf, getPtr-&gt;width_scr) ;</span>
00443 <span class="comment">      return( getPtr-&gt;width_scr ) ;</span>
00444 <span class="comment">      }</span>
00445 <span class="comment"></span>
00446 <span class="comment">      if ( getPtr-&gt;type == 'D' )</span>
00447 <span class="comment">      {</span>
00448 <span class="comment">      if ( getPtr-&gt;picture == (char *) 0 )</span>
00449 <span class="comment">      {</span>
00450 <span class="comment">      ptr =  c1dt_format( (char *) getPtr-&gt;data, DEFAULT_DATE ) ;</span>
00451 <span class="comment">      len =  (int) strlen(DEFAULT_DATE ) ;</span>
00452 <span class="comment">      }</span>
00453 <span class="comment">      else</span>
00454 <span class="comment">      {</span>
00455 <span class="comment">      ptr =  c1dt_format( (char *) getPtr-&gt;data, getPtr-&gt;picture ) ;</span>
00456 <span class="comment">      len =  (int) strlen( getPtr-&gt;picture ) ;</span>
00457 <span class="comment">      }</span>
00458 <span class="comment"></span>
00459 <span class="comment">      memcpy( chr_buf, ptr, (size_t) len ) ;</span>
00460 <span class="comment">      return( len ) ;</span>
00461 <span class="comment">      }</span>
00462 <span class="comment"></span>
00463 <span class="comment">      if ( getPtr-&gt;type == 'L' )</span>
00464 <span class="comment">      {</span>
00465 <span class="comment">      if ( getPtr-&gt;picture == (char *) 0 )</span>
00466 <span class="comment">      pict_char =  'L' ;</span>
00467 <span class="comment">      else</span>
00468 <span class="comment">      pict_char =  getPtr-&gt;picture[0] ;</span>
00469 <span class="comment"></span>
00470 <span class="comment">      if ( * ((int *) getPtr-&gt;data) )</span>
00471 <span class="comment">      {</span>
00472 <span class="comment">      if ( pict_char == 'L' )</span>
00473 <span class="comment">      chr_buf[0] = 'T' ;</span>
00474 <span class="comment">      else</span>
00475 <span class="comment">      chr_buf[0] = 'Y' ;</span>
00476 <span class="comment">      }</span>
00477 <span class="comment">      else</span>
00478 <span class="comment">      {</span>
00479 <span class="comment">      if ( pict_char == 'L' )</span>
00480 <span class="comment">      chr_buf[0] =  'F' ;</span>
00481 <span class="comment">      else</span>
00482 <span class="comment">      chr_buf[0] =  'N' ;</span>
00483 <span class="comment">      }</span>
00484 <span class="comment">      return 1 ;</span>
00485 <span class="comment">      }</span>
00486 <span class="comment"></span>
00487 <span class="comment">      if ( getPtr-&gt;type == 'N' &amp;&amp; getPtr-&gt;dec_num &gt; 0 )</span>
00488 <span class="comment">      {</span>
00489 <span class="comment">      ( (char *)getPtr-&gt;data )</span>
00490 <span class="comment">      [ getPtr-&gt;width_data - getPtr-&gt;dec_num - 1] = '.' ;</span>
00491 <span class="comment">      }</span>
00492 <span class="comment">    */</span>
00493 
00494     <span class="comment">//------- Currently it only support "Character" type -----//</span>
00495 
00496     <a class="code" href="ALL_8H.html#a0">err_when</a>( (<span class="keywordtype">int</span>) strlen((<span class="keywordtype">char</span>*)getPtr-&gt;<a class="code" href="structGetFld.html#m3">data</a>) &gt; (<span class="keywordtype">int</span>) getPtr-&gt;<a class="code" href="structGetFld.html#m5">width_data</a> );
00497 
00498     <span class="comment">//---- fill the string with tailing space in the whole data width ---//</span>
00499 
00500     memset( chr_buf, <span class="charliteral">' '</span>, getPtr-&gt;<a class="code" href="structGetFld.html#m5">width_data</a> );     <span class="comment">// char after the NULL will be unknown in the original data</span>
00501 
00502     <span class="keywordflow">if</span>( mask_flag )
00503         <span class="comment">// masked the field for displaying hidden data (like password)</span>
00504         memset( chr_buf, <span class="charliteral">'*'</span>, strlen((<span class="keywordtype">char</span>*)getPtr-&gt;<a class="code" href="structGetFld.html#m3">data</a>) );
00505     <span class="keywordflow">else</span>
00506         <span class="comment">// don't copy the NULL character</span>
00507         memcpy( chr_buf, (<span class="keywordtype">char</span>*)getPtr-&gt;<a class="code" href="structGetFld.html#m3">data</a>, strlen((<span class="keywordtype">char</span>*)getPtr-&gt;<a class="code" href="structGetFld.html#m3">data</a>) );
00508 
00509     chr_buf[getPtr-&gt;<a class="code" href="structGetFld.html#m5">width_data</a>] = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00510 
00511     <span class="comment">//---- if has picture, process the character buf with the picture ----//</span>
00512 
00513     <span class="keywordtype">char</span>* ptr = getPtr-&gt;<a class="code" href="structGetFld.html#m8">picture</a>;
00514 
00515     <span class="keywordflow">if</span>( ptr ) {
00516         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i= 0; *ptr != <span class="charliteral">'\0'</span>; i++, ptr++ ) {
00517             <span class="keywordflow">if</span> ( strchr( <a class="code" href="OGET_8CPP.html#a1">PICTURE_CHRS</a>, *ptr) == (<span class="keywordtype">char</span> *) 0 )
00518                 chr_buf[i] =  getPtr-&gt;<a class="code" href="structGetFld.html#m8">picture</a>[i] ;
00519         }
00520     }
00521 
00522     <span class="keywordflow">return</span>( getPtr-&gt;<a class="code" href="structGetFld.html#m5">width_data</a> ) ;
00523 }
00524 
00525 <span class="comment">//--------- END OF FUNCTION Get::load_data ----------//</span>
00526 
00527 <span class="comment">//------- BEGIN OF FUNCTION Get::display_get ---------//</span>
00528 <span class="comment">//</span>
00529 <span class="comment">// Description : display one get a time</span>
00530 <span class="comment">//</span>
00531 <span class="comment">// Syntax      : display_get( &lt;GetFld*&gt;,&lt;int&gt; )</span>
00532 <span class="comment">//</span>
00533 <span class="comment">// &lt;GetFld*&gt; = the pointer to get</span>
00534 <span class="comment">// &lt;int&gt;     = 1-Getting field, 0-Displaying field</span>
00535 <span class="comment">//</span>
00536 <span class="comment">//</span>
00537 <span class="keywordtype">void</span> Get::display_get( <a class="code" href="structGetFld.html">GetFld</a> *getPtr,<span class="keywordtype">int</span> getting) {
00538     <span class="keywordtype">char</span>  buf[<a class="code" href="OGET_8H.html#a2a1">MAX_GET_WIDTH</a>+1] ;
00539 
00540     load_data( getPtr, buf ) ;
00541 
00542     <span class="keywordflow">if</span>( getting || getPtr-&gt;<a class="code" href="structGetFld.html#m3">data</a> )
00543         font_ptr-&gt;<a class="code" href="classFont.html#a32">disp</a>( getPtr-&gt;<a class="code" href="structGetFld.html#m0">x</a>, getPtr-&gt;<a class="code" href="structGetFld.html#m1">y</a>, buf, getPtr-&gt;<a class="code" href="structGetFld.html#m2">x2</a> );
00544 
00545     sys.blt_virtual_buf();
00546 }
00547 
00548 <span class="comment">//-------- END OF FUNCTION Get::display_get ------------//</span>
00549 
00550 <span class="comment">//------ BEGIN OF FUNCTION Get::display ---------------//</span>
00551 <span class="comment">//</span>
00552 <span class="comment">// Description : display all gets without read</span>
00553 <span class="comment">//</span>
00554 <span class="comment">// Syntax      : display()</span>
00555 <span class="comment">//</span>
<a name="l00556"></a><a class="code" href="classGet.html#a11">00556</a> <span class="keywordtype">void</span> <a class="code" href="classGet.html#a11">Get::display</a>() {
00557     <a class="code" href="structGetFld.html">GetFld</a> *getPtr ;
00558     <span class="keywordtype">int</span>    i      ;
00559 
00560     <span class="keywordflow">for</span> (i=0; i&lt;get_num ; i++ ) {
00561         getPtr = fld_array + i;
00562 
00563         check_data( getPtr );
00564         display_get( getPtr, 0 );
00565     }
00566 }
00567 
00568 <span class="comment">//-------- END OF FUNCTION Get::display ---------------//</span>
00569 
00570 <span class="comment">//-------- BEGIN OF FUNCTION Get::store_data --------------//</span>
00571 <span class="comment">//</span>
00572 <span class="comment">// Description : fill the get buffer with data</span>
00573 <span class="comment">//</span>
00574 <span class="comment">// Syntax      : store_data( &lt;GetFld*&gt;,&lt;char*&gt;,&lt;char*&gt;)</span>
00575 <span class="comment">//</span>
00576 <span class="comment">// &lt;GetFld*&gt; = get pointer</span>
00577 <span class="comment">// &lt;char*&gt;   = buffer pointer</span>
00578 <span class="comment">// &lt;char*&gt;   = picture pointer</span>
00579 <span class="comment">//</span>
00580 
00581 <span class="keywordtype">void</span> Get::store_data( <a class="code" href="structGetFld.html">GetFld</a> *getPtr, <span class="keywordtype">char</span> *buffer, <span class="keywordtype">char</span> *pict ) {
00582     <span class="comment">//------- Currently it only support "Character" type -----//</span>
00583 
00584     <span class="comment">/*</span>
00585 <span class="comment">      // Transfer Back to  getPtr-&gt;data //</span>
00586 <span class="comment">      switch ( getPtr-&gt;type )</span>
00587 <span class="comment">      {</span>
00588 <span class="comment">      case 'd':</span>
00589 <span class="comment">      *((double *)getPtr-&gt;data) =</span>
00590 <span class="comment">      c1atod( buffer, getPtr-&gt;width_scr ) ;</span>
00591 <span class="comment">      break ;</span>
00592 <span class="comment"></span>
00593 <span class="comment">      case 'N':</span>
00594 <span class="comment">      memcpy( getPtr-&gt;data,</span>
00595 <span class="comment">      c1dtoa( c1atod(buffer, getPtr-&gt;width_data),</span>
00596 <span class="comment">      getPtr-&gt;width_data, getPtr-&gt;dec_num),</span>
00597 <span class="comment">      (size_t) getPtr-&gt;width_data ) ;</span>
00598 <span class="comment">      break ;</span>
00599 <span class="comment"></span>
00600 <span class="comment">      case 'c':</span>
00601 <span class="comment">      *((char*)getPtr-&gt;data) =</span>
00602 <span class="comment">      (char) c1atoi( (char *) buffer, getPtr-&gt;width_scr ) ;</span>
00603 <span class="comment">      break ;</span>
00604 <span class="comment"></span>
00605 <span class="comment">      case 'i':</span>
00606 <span class="comment">      *((int *)getPtr-&gt;data) =</span>
00607 <span class="comment">      (int) c1atoi( (char *) buffer, getPtr-&gt;width_scr ) ;</span>
00608 <span class="comment">      break ;</span>
00609 <span class="comment"></span>
00610 <span class="comment">      case 'l':</span>
00611 <span class="comment">      buffer[getPtr-&gt;width_scr] =  '\0' ;</span>
00612 <span class="comment">      *((long *)getPtr-&gt;data) =  (long) atol( (char *) buffer ) ;</span>
00613 <span class="comment">      break ;</span>
00614 <span class="comment"></span>
00615 <span class="comment">      case 'D':</span>
00616 <span class="comment">      memcpy( getPtr-&gt;data, c1dt_unformat((char *) buffer, pict), 8) ;</span>
00617 <span class="comment">      break;</span>
00618 <span class="comment"></span>
00619 <span class="comment">      case 'L':</span>
00620 <span class="comment">      if ( buffer[0] == (int) 'Y'  ||  buffer[0] == (int) 'T' ||</span>
00621 <span class="comment">      buffer[0] == (int) 't' || buffer[0] == (int) 'y' )</span>
00622 <span class="comment">      *((int *)getPtr-&gt;data) =  1 ;</span>
00623 <span class="comment">      else</span>
00624 <span class="comment">      *((int *)getPtr-&gt;data) =  0 ;</span>
00625 <span class="comment">      break ;</span>
00626 <span class="comment"></span>
00627 <span class="comment">      default:</span>
00628 <span class="comment">      memcpy( getPtr-&gt;data, buffer, getPtr-&gt;width_data ) ;</span>
00629 <span class="comment">      getPtr-&gt;data[getPtr-&gt;width_data]=NULL;</span>
00630 <span class="comment">      break ;</span>
00631 <span class="comment">      }</span>
00632 <span class="comment">    */</span>
00633     <span class="comment">//------- Currently it only support "Character" type -----//</span>
00634 
00635     <span class="keywordflow">if</span>( getPtr-&gt;<a class="code" href="structGetFld.html#m4">type</a>==<span class="charliteral">'C'</span> ) {
00636         memcpy( getPtr-&gt;<a class="code" href="structGetFld.html#m3">data</a>, buffer, getPtr-&gt;<a class="code" href="structGetFld.html#m5">width_data</a> ) ;
00637 
00638         ((<span class="keywordtype">char</span>*)getPtr-&gt;<a class="code" href="structGetFld.html#m3">data</a>)[getPtr-&gt;<a class="code" href="structGetFld.html#m5">width_data</a>] = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00639 
00640         m.rtrim( (<span class="keywordtype">char</span>*) getPtr-&gt;<a class="code" href="structGetFld.html#m3">data</a> );              <span class="comment">// right rtrim the character</span>
00641     }
00642 }
00643 
00644 <span class="comment">//---------- END OF FUNCTION Get::store_data -------------//</span>
00645 
00646 <span class="comment">//-------- BEGIN OF FUNCTION Get::right_pos --------------//</span>
00647 <span class="comment">//</span>
00648 <span class="comment">// Description : calculate the correct cursor position by passing</span>
00649 <span class="comment">//              by the picture digit (e.g. "(999)", than pass '(' and ')' )</span>
00650 <span class="comment">//</span>
00651 <span class="comment">// Syntax      : right_pos( &lt;int&gt;,&lt;int&gt;,&lt;char*&gt; )</span>
00652 <span class="comment">//</span>
00653 <span class="comment">// &lt;int&gt;   = buffer position</span>
00654 <span class="comment">// &lt;int&gt;   = the length of the buffer</span>
00655 <span class="comment">// &lt;char*&gt; = picture pointer</span>
00656 <span class="comment">//</span>
00657 <span class="keywordtype">int</span> Get::right_pos( <span class="keywordtype">int</span> buffer_pos, <span class="keywordtype">int</span> len, <span class="keywordtype">char</span> *pict ) {
00658     buffer_pos++ ;
00659 
00660     <span class="keywordflow">while</span> ( buffer_pos &lt; len ) {
00661         <span class="keywordflow">if</span> ( strchr(<a class="code" href="OGET_8CPP.html#a1">PICTURE_CHRS</a>,pict[buffer_pos]) == 0)
00662             buffer_pos++ ;
00663         <span class="keywordflow">else</span>
00664             <span class="keywordflow">break</span> ;
00665     }
00666 
00667     <span class="keywordflow">if</span> ( buffer_pos == len) {
00668         buffer_pos-- ;
00669 
00670         <span class="keywordflow">while</span> (buffer_pos &gt; 0 &amp;&amp;
00671                strchr(<a class="code" href="OGET_8CPP.html#a1">PICTURE_CHRS</a>,pict[buffer_pos]) == 0) {
00672             buffer_pos-- ;
00673         }
00674     }
00675 
00676     <span class="keywordflow">return</span>  buffer_pos ;
00677 }
00678 
00679 <span class="comment">//------ END OF FUNCTION Get::right_pos -------------//</span>
00680 
00681 <span class="comment">//-------- BEGIN OF FUNCTION Get::num_pos -------------//</span>
00682 <span class="comment">//</span>
00683 <span class="comment">// Description : Counts the Number of Positions to the Next Picture Data Character</span>
00684 <span class="comment">//</span>
00685 <span class="comment">// Syntax      : num_pos( &lt;int&gt;,&lt;int&gt;,&lt;char*&gt; )</span>
00686 <span class="comment">//</span>
00687 <span class="comment">// &lt;int&gt;   = buffer position</span>
00688 <span class="comment">// &lt;int&gt;   = the length of the buffer</span>
00689 <span class="comment">// &lt;char*&gt; = picture pointer</span>
00690 <span class="comment">//</span>
00691 <span class="keywordtype">int</span> Get::num_pos( <span class="keywordtype">int</span> bufPos, <span class="keywordtype">int</span> len, <span class="keywordtype">char</span> *pict ) {
00692     <span class="keywordtype">int</span>  on_pos ;
00693 
00694     on_pos =  bufPos ;
00695 
00696     <span class="keywordflow">while</span> ( on_pos &lt; len ) {
00697         <span class="keywordflow">if</span> ( strchr(<a class="code" href="OGET_8CPP.html#a1">PICTURE_CHRS</a>,pict[on_pos]) == 0)
00698             <span class="keywordflow">break</span> ;
00699         <span class="keywordflow">else</span>
00700             on_pos++ ;
00701     }
00702 
00703     <span class="keywordflow">return</span> ( on_pos - bufPos ) ;
00704 }
00705 
00706 <span class="comment">//-------- END OF FUNCTION Get::num_pos -------------//</span>
00707 
00708 <span class="comment">//--------- BEGIN OF FUNCTION Get::read ------------//</span>
00709 <span class="comment">//</span>
00710 <span class="comment">// Description : read the pre-defined gets</span>
00711 <span class="comment">//</span>
00712 <span class="comment">// Syntax      : read([int])</span>
00713 <span class="comment">//</span>
00714 <span class="comment">// [int] = the field to be read first</span>
00715 <span class="comment">//         (default : the first field in the get list, 1)</span>
00716 <span class="comment">//</span>
00717 <span class="comment">// Return : &lt;int&gt; the last key pressed for exiting read</span>
00718 <span class="comment">//                e.g. ESC, ENTER.</span>
00719 <span class="comment">//</span>
<a name="l00720"></a><a class="code" href="classGet.html#a12">00720</a> <span class="keywordtype">int</span> <a class="code" href="classGet.html#a12">Get::read</a>(<span class="keywordtype">int</span> firstRead) {
00721     <span class="keywordtype">int</span>    firstFlag, firstKey;
00722     <span class="keywordtype">int</span>    bufPos, curPos;
00723     <span class="keywordtype">int</span>    bufOffset, bufWidth;
00724     <span class="keywordtype">int</span>    fldId;                                   <span class="comment">// id. of the GetFld in the fld_array</span>
00725     <span class="keywordtype">int</span>    num;                                     <span class="comment">// temp value for location character</span>
00726     <span class="keywordtype">int</span>    keyCode;
00727 
00728     <a class="code" href="structGetFld.html">GetFld</a> *getPtr ;
00729     <span class="keywordtype">char</span>   dataBuf[<a class="code" href="OGET_8H.html#a2a1">MAX_GET_WIDTH</a>+1], pictBuf[<a class="code" href="OGET_8H.html#a2a1">MAX_GET_WIDTH</a>+1] ;
00730 
00731     <span class="comment">//-------------- init vars -------------------//</span>
00732 
00733     <a class="code" href="ALL_8H.html#a0">err_when</a>( get_num == 0 );
00734 
00735     firstFlag = 1;                                  <span class="comment">// whether it's the first time on the field or not</span>
00736     firstKey  = 1;                                  <span class="comment">// If the firstFlag key press is not cursor key, clear the field content, it can be any one of the types c,i,l,d,N</span>
00737     fldId     = firstRead;
00738     getPtr    = fld_array + fldId - 1;
00739 
00740     display_get( getPtr, 1 );                       <span class="comment">// display current getting field</span>
00741 
00742     <span class="comment">//--------------------------------------------//</span>
00743 
00744     <span class="keywordflow">for</span> (;;) {
00745         <span class="comment">//------ it's the first time on this field --------//</span>
00746 
00747         <span class="keywordflow">if</span> (firstFlag) {
00748             <span class="keywordflow">if</span> ( getPtr-&gt;<a class="code" href="structGetFld.html#m4">type</a> == <span class="charliteral">'s'</span> )
00749                 cursor_type(0);
00750             <span class="keywordflow">else</span> {
00751                 <span class="keywordflow">if</span> ( insert_flag )
00752                     cursor_type(2) ;
00753                 <span class="keywordflow">else</span>
00754                     cursor_type(1) ;
00755             }
00756         }
00757         <span class="keywordflow">else</span>
00758             firstKey = 0;                               <span class="comment">// firstKey is for clearing numerical field if the first key stroke is not cursor key</span>
00759 
00760         <span class="comment">//--------------------------------------------//</span>
00761 
00762         <span class="keywordflow">if</span> ( firstFlag ) {                            <span class="comment">// First time for this 'get'</span>
00763             init_field(dataBuf, pictBuf, getPtr, bufPos, bufOffset, bufWidth);
00764             firstFlag = 0 ;
00765         }
00766 
00767         <span class="comment">//--------- second time ( firstFlag == 0 ) ---------//</span>
00768 
00769         keyCode = get_next_key( dataBuf, pictBuf, getPtr, bufPos, bufOffset,
00770                                 bufWidth );
00771 
00772         <span class="keywordflow">if</span>( !keyCode )
00773             <span class="keywordflow">continue</span>;
00774 
00775         <span class="comment">//------------ cusror movement function keys ------------//</span>
00776 
00777         <span class="keywordflow">if</span>( process_field_key(keyCode, getPtr, dataBuf, pictBuf, curPos, bufPos) ) {
00778             <span class="comment">// return 1 if field movement key</span>
00779             <span class="keywordflow">continue</span>;                                   <span class="comment">// return 0 if alphabetical key / inter-field control key</span>
00780         }
00781 
00782         <span class="comment">//----------- Normal Alphanumerical keys --------------//</span>
00783 
00784         <span class="keywordflow">if</span> ( keyCode &gt;= 0x20 &amp;&amp; keyCode &lt;= 0xFF ) {
00785             <span class="comment">//------ Check the Picture Template -------//</span>
00786 
00787             <span class="keywordflow">if</span>( valid_pict(keyCode, getPtr, dataBuf, pictBuf, bufPos) ) {
00788                 <span class="comment">//----- insert or Replace the character ---------//</span>
00789 
00790                 <span class="comment">// If the firstFlag key press is not cursor key, clear the field content, it can be any one of the types c,i,l,d,N</span>
00791                 <span class="keywordflow">if</span> ( m.str_chr(<span class="stringliteral">"cildNC"</span>, getPtr-&gt;<a class="code" href="structGetFld.html#m4">type</a>) ) {
00792                     <span class="keywordflow">if</span> ( firstKey )
00793                         memset(dataBuf,<span class="charliteral">' '</span>,getPtr-&gt;<a class="code" href="structGetFld.html#m5">width_data</a>);
00794                 }
00795 
00796                 <span class="keywordflow">if</span> ( insert_flag ) {
00797                     <span class="comment">// Insert the Character //</span>
00798                     num = num_pos( bufPos, getPtr-&gt;<a class="code" href="structGetFld.html#m5">width_data</a>, pictBuf) ;
00799 
00800                     <span class="keywordflow">if</span> ( num &gt; 1 )
00801                         memmove( dataBuf+bufPos+1, dataBuf+bufPos, (size_t) num-1) ;
00802                 }
00803 
00804                 dataBuf[bufPos] = keyCode;
00805 
00806                 <span class="keywordflow">if</span> ( bufPos &lt; bufWidth-1 )
00807                     bufPos++;
00808             }
00809 
00810             <span class="keywordflow">continue</span>;
00811         }
00812         <span class="keywordflow">else</span> {                                        <span class="comment">//--------- field movement function keys -----------//</span>
00813             <span class="keywordtype">int</span> rc = process_inter_field_key( keyCode, getPtr, firstFlag, firstKey, fldId, bufPos);
00814 
00815             <span class="keywordflow">if</span>( rc != -1 ) {                            <span class="comment">// -1 means exit read() immediately</span>
00816                 <span class="keywordtype">int</span> rc = store_and_valid( keyCode, dataBuf, pictBuf, getPtr, firstFlag );
00817 
00818                 <span class="keywordflow">if</span>( !rc )                                 <span class="comment">// not valid</span>
00819                     <span class="keywordflow">continue</span>;
00820             }
00821 
00822             <span class="comment">//......... Exit Get and Return last pressed key .............//</span>
00823 
00824             <span class="keywordflow">if</span>( rc == -1 ) {                            <span class="comment">// -1 means exit read() immediately</span>
00825                 store_data( getPtr, dataBuf, pictBuf ) ;  <span class="comment">// save the previous field dataBuf data</span>
00826 
00827                 display_get(getPtr,0);
00828 
00829                 cursor_type( 1 ) ;
00830                 <span class="keywordflow">return</span> keyCode;
00831             }
00832 
00833             <span class="keywordflow">continue</span> ;
00834         }
00835     }
00836 }
00837 
00838 <span class="comment">//--------- END OF FUNCTION Get::read ----------------//</span>
00839 
00840 <span class="comment">//-------- BEGIN OF FUNCTION Get::cursor_type -----------//</span>
00841 <span class="comment">//</span>
00842 <span class="comment">// Description : Set cursor type, represent insert mode or overwrite mode</span>
00843 <span class="comment">// Syntax      : cursor_type()</span>
00844 <span class="comment">//</span>
00845 <span class="comment">// Remark : hasn't be implemented yet</span>
00846 <span class="comment">//</span>
00847 <span class="keywordtype">void</span> Get::cursor_type(<span class="keywordtype">int</span> newType) {
00848     newType++;
00849 }
00850 
00851 <span class="comment">//-------- END OF FUNCTION Get::cursor_type ------------//</span>
00852 
00853 <span class="comment">//------- Begin of function Get::process_field_key -----------//</span>
00860 <span class="comment">int Get::process_field_key( int keyCode, GetFld* getPtr, char* dataBuf,</span>
00861                             <span class="keywordtype">char</span>* pictBuf, <span class="keywordtype">int</span>&amp; curPos, <span class="keywordtype">int</span>&amp; bufPos) {
00862     <span class="keywordtype">int</span> num;
00863 
00864     <span class="keywordflow">switch</span> ( keyCode ) {
00865     <span class="keywordflow">case</span> <a class="code" href="KEY_8H.html#a14">KEY_INS</a>:
00866         insert_flag =  ! insert_flag ;
00867         <span class="keywordflow">if</span> ( insert_flag )
00868             cursor_type( 2 ) ;
00869         <span class="keywordflow">else</span>
00870             cursor_type( 1 ) ;
00871         <span class="keywordflow">return</span> 1;
00872 
00873     <span class="keywordflow">case</span> <a class="code" href="KEY_8H.html#a0">KEY_BACK_SPACE</a>:
00874     <span class="keywordflow">case</span> <a class="code" href="KEY_8H.html#a11">KEY_LEFT</a>:
00875         curPos =  bufPos - 1 ;
00876 
00877         <span class="keywordflow">while</span> (curPos &gt;= 0) {
00878             <span class="keywordflow">if</span> ( strchr(<a class="code" href="OGET_8CPP.html#a1">PICTURE_CHRS</a>,pictBuf[curPos]) == 0 )
00879                 curPos-- ;
00880             <span class="keywordflow">else</span>
00881                 <span class="keywordflow">break</span>;
00882         }
00883 
00884         <span class="keywordflow">if</span> ( curPos &lt; 0 )
00885             <span class="keywordflow">return</span> 1 ;
00886 
00887         bufPos =  curPos ;
00888         <span class="comment">// ####### begin Gilbert 24/7 ########//</span>
00889         <span class="keywordflow">if</span> ( keyCode == <a class="code" href="KEY_8H.html#a11">KEY_LEFT</a> )                  <span class="comment">// || keyCode == KEY_CTRL_S )</span>
00890             <span class="keywordflow">return</span> 1 ;
00891         <span class="comment">// ####### end Gilbert 24/7 ########//</span>
00892 
00893         <span class="comment">// BACK_SPACE is a LEFT and a DEL //</span>
00894 
00895     <span class="keywordflow">case</span> <a class="code" href="KEY_8H.html#a15">KEY_DEL</a>:
00896         num =  num_pos( bufPos, getPtr-&gt;<a class="code" href="structGetFld.html#m5">width_data</a>, pictBuf) ;
00897         <span class="keywordflow">if</span> ( num == 0 )
00898             <span class="keywordflow">return</span> 1 ;
00899         memcpy( dataBuf+bufPos, dataBuf+bufPos+1, num ) ;
00900         dataBuf[bufPos+num-1] = <span class="charliteral">' '</span> ;
00901 
00902         <a class="code" href="ALL_8H.html#a0">err_when</a>( bufPos+num &gt; getPtr-&gt;<a class="code" href="structGetFld.html#m5">width_data</a> );
00903 
00904         <span class="keywordflow">return</span> 1;
00905 
00906         <span class="comment">// ####### begin Gilbert 24/7 ########//</span>
00907         <span class="comment">/*</span>
00908 <span class="comment">          case KEY_CTRL_Y:</span>
00909 <span class="comment">          curPos =  bufPos ;</span>
00910 <span class="comment">          memset( dataBuf + bufPos, (int) ' ',</span>
00911 <span class="comment">          (size_t) num_pos( bufPos, getPtr-&gt;width_data, pictBuf));</span>
00912 <span class="comment">          return 1;</span>
00913 <span class="comment">        */</span>
00914         <span class="comment">// ####### end Gilbert 24/7 ########//</span>
00915 
00916     <span class="keywordflow">case</span> <a class="code" href="KEY_8H.html#a10">KEY_RIGHT</a>:
00917         bufPos =
00918             right_pos( bufPos, getPtr-&gt;<a class="code" href="structGetFld.html#m5">width_data</a>, pictBuf);
00919         <span class="keywordflow">return</span> 1 ;
00920 
00921     <span class="keywordflow">case</span> <a class="code" href="KEY_8H.html#a4">KEY_HOME</a>:
00922         bufPos = 0;
00923         <span class="keywordflow">return</span> 1;
00924 
00925     <span class="keywordflow">case</span> <a class="code" href="KEY_8H.html#a5">KEY_END</a>:
00926         bufPos =  getPtr-&gt;<a class="code" href="structGetFld.html#m5">width_data</a> - 1;
00927 
00928         <span class="keywordflow">while</span> ( bufPos &gt;= 0 ) {
00929             <span class="keywordflow">if</span> (dataBuf[bufPos] == <span class="charliteral">' '</span> || dataBuf[bufPos] == <span class="charliteral">'\0'</span>)
00930                 bufPos-- ;
00931             <span class="keywordflow">else</span>
00932                 <span class="keywordflow">break</span>;
00933         }
00934 
00935         bufPos =
00936             right_pos( bufPos, getPtr-&gt;<a class="code" href="structGetFld.html#m5">width_data</a>, pictBuf);
00937         <span class="keywordflow">return</span> 1 ;
00938     }
00939 
00940     <span class="keywordflow">return</span> 0;
00941 }
00942 
00943 <span class="comment">//------- End of function Get::process_field_key -----------//</span>
00944 
00945 <span class="comment">//------- Begin of function Get::valid_pict -----------//</span>
00952 <span class="comment">int Get::valid_pict( int keyCode, GetFld* getPtr, char* dataBuf,</span>
00953                      <span class="keywordtype">char</span>* pictBuf, <span class="keywordtype">int</span>&amp; bufPos ) {
00954     <span class="keywordflow">if</span>( !pictBuf[bufPos] )
00955         <span class="keywordflow">return</span> 1;
00956 
00957     <span class="keywordtype">int</span> ok=0, i, num;
00958 
00959     <span class="keywordflow">switch</span>( pictBuf[bufPos] ) {
00960     <span class="keywordflow">case</span> <span class="charliteral">'9'</span>:
00961     <span class="keywordflow">case</span> <span class="charliteral">'#'</span>:
00962         <span class="keywordflow">if</span> ( (keyCode &gt;= <span class="charliteral">'0'</span> &amp;&amp; keyCode &lt;= <span class="charliteral">'9'</span>) || keyCode == <span class="charliteral">'-'</span> )
00963             ok = 1 ;
00964 
00965         <span class="keywordflow">if</span> ( (keyCode == <span class="charliteral">'+'</span> || keyCode == <span class="charliteral">'-'</span> || keyCode == <span class="charliteral">' '</span>)    &amp;&amp;
00966              pictBuf[bufPos] == <span class="charliteral">'#'</span>) {
00967             ok =  1 ;
00968         }
00969 
00970         <span class="keywordflow">if</span> ( keyCode == <span class="charliteral">'.'</span>  &amp;&amp;  getPtr-&gt;<a class="code" href="structGetFld.html#m7">dec_num</a> &gt; 0 ) {
00971             <span class="keywordtype">int</span>  num_shift ;
00972 
00973             num_shift =  getPtr-&gt;<a class="code" href="structGetFld.html#m6">width_scr</a> - getPtr-&gt;<a class="code" href="structGetFld.html#m7">dec_num</a> -
00974                 bufPos - 1 ;
00975 
00976             <span class="keywordflow">if</span> ( --bufPos &lt; 0 )  bufPos = 0 ;
00977 
00978             <span class="keywordflow">if</span> ( num_shift &gt; 0  &amp;&amp;  dataBuf[bufPos] != <span class="charliteral">' '</span> ) {
00979                 memmove( dataBuf+ num_shift, dataBuf,
00980                          (size_t) (getPtr-&gt;<a class="code" href="structGetFld.html#m6">width_scr</a> - num_shift) ) ;
00981                 memset( dataBuf, (<span class="keywordtype">int</span>) <span class="charliteral">' '</span>, (size_t) num_shift ) ;
00982             }
00983 
00984             bufPos = getPtr-&gt;<a class="code" href="structGetFld.html#m6">width_scr</a> - getPtr-&gt;<a class="code" href="structGetFld.html#m7">dec_num</a>-1;
00985             memset( dataBuf+ bufPos+1, (<span class="keywordtype">int</span>) <span class="charliteral">'0'</span>,
00986                     (size_t) getPtr-&gt;<a class="code" href="structGetFld.html#m7">dec_num</a>);
00987             ok = 1 ;
00988         }
00989         <span class="keywordflow">break</span> ;
00990 
00991     <span class="keywordflow">case</span> <span class="charliteral">'A'</span>:
00992         <span class="keywordflow">if</span> ( keyCode &gt;= <span class="charliteral">'A'</span> &amp;&amp; keyCode &lt;= <span class="charliteral">'Z'</span>  ||
00993              keyCode &gt;= <span class="charliteral">'a'</span> &amp;&amp; keyCode &lt;= <span class="charliteral">'z'</span> ) {
00994             ok =  1 ;
00995         }
00996         <span class="keywordflow">break</span> ;
00997 
00998     <span class="keywordflow">case</span> <span class="charliteral">'L'</span>:
00999         keyCode =  (char) m.upper( keyCode ) ;
01000         <span class="keywordflow">if</span> ( keyCode == <span class="charliteral">'Y'</span> || keyCode == <span class="charliteral">'N'</span> || keyCode == <span class="charliteral">'T'</span> || keyCode == <span class="charliteral">'F'</span> )
01001             ok = 1;
01002         <span class="keywordflow">break</span> ;
01003 
01004     <span class="keywordflow">case</span> <span class="charliteral">'N'</span>:
01005         <span class="keywordflow">if</span> ( keyCode &gt;= <span class="charliteral">'A'</span> &amp;&amp; keyCode &lt;= <span class="charliteral">'Z'</span>  ||
01006              keyCode &gt;= <span class="charliteral">'a'</span> &amp;&amp; keyCode &lt;= <span class="charliteral">'z'</span>  ||
01007              keyCode &gt;= <span class="charliteral">'0'</span> &amp;&amp; keyCode &lt;= <span class="charliteral">'9'</span>  ) {
01008             ok =  1 ;
01009         }
01010         <span class="keywordflow">break</span> ;
01011 
01012     <span class="keywordflow">case</span> <span class="charliteral">'Y'</span>:
01013         <span class="keywordflow">if</span> ( getPtr-&gt;<a class="code" href="structGetFld.html#m4">type</a> == <span class="charliteral">'D'</span> ) {                <span class="comment">// Date Type: 'Y' for year //</span>
01014             <span class="keywordflow">if</span> ( keyCode &gt;= <span class="charliteral">'0'</span>  &amp;&amp;  keyCode &lt;= <span class="charliteral">'9'</span> || keyCode == <span class="charliteral">' '</span> )
01015                 ok =  1 ;
01016         }
01017         <span class="keywordflow">else</span> {
01018             keyCode =  (char) m.upper( keyCode ) ;
01019 
01020             <span class="keywordflow">if</span> ( keyCode == <span class="charliteral">'Y'</span> ||  keyCode == <span class="charliteral">'N'</span> )
01021                 ok =  1 ;
01022         }
01023         <span class="keywordflow">break</span> ;
01024 
01025     <span class="keywordflow">case</span> <span class="charliteral">'X'</span>:
01026     <span class="keywordflow">case</span> <span class="charliteral">'!'</span>:
01027         ok =  1 ;
01028         <span class="keywordflow">break</span> ;
01029 
01030     <span class="keywordflow">case</span> <span class="charliteral">'C'</span>:
01031     <span class="keywordflow">case</span> <span class="charliteral">'D'</span>:
01032         <span class="keywordflow">if</span> ( getPtr-&gt;<a class="code" href="structGetFld.html#m4">type</a> == <span class="charliteral">'D'</span> &amp;&amp;
01033              (keyCode &gt;= <span class="charliteral">'0'</span>  &amp;&amp;  keyCode &lt;= <span class="charliteral">'9'</span> ||  keyCode == <span class="charliteral">' '</span>)  ) {
01034             ok =  1 ;
01035         }
01036         <span class="keywordflow">break</span> ;
01037 
01038     <span class="keywordflow">case</span> <span class="charliteral">'M'</span>:
01039         <span class="keywordflow">if</span> ( getPtr-&gt;<a class="code" href="structGetFld.html#m4">type</a> == <span class="charliteral">'D'</span> ) {
01040             <span class="keywordflow">if</span> ( keyCode == <span class="charliteral">' '</span> ) {
01041                 ok = 1 ;
01042                 <span class="keywordflow">break</span> ;
01043             }
01044 
01045             <span class="keywordflow">for</span> ( num=0, i=0; pictBuf[i] != <span class="charliteral">'\0'</span>; i++ )
01046                 <span class="keywordflow">if</span> ( pictBuf[i] == <span class="charliteral">'M'</span> ) num++ ;
01047 
01048             <span class="keywordflow">if</span> ( num &gt; 2 ) {
01049                 <span class="keywordflow">if</span> ( keyCode &gt;= <span class="charliteral">'A'</span> &amp;&amp; keyCode &lt;= <span class="charliteral">'Z'</span>  ||
01050                      keyCode &gt;= <span class="charliteral">'a'</span> &amp;&amp; keyCode &lt;= <span class="charliteral">'z'</span>) {
01051                     ok =  1;
01052                 }
01053             }
01054             <span class="keywordflow">else</span> {
01055                 <span class="keywordflow">if</span> ( keyCode &gt;= <span class="charliteral">'0'</span> &amp;&amp; keyCode &lt;= <span class="charliteral">'9'</span>)
01056                     ok =  1;
01057             }
01058         }
01059         <span class="keywordflow">break</span> ;
01060     }
01061 
01062     <span class="keywordflow">return</span> ok;
01063 }
01064 
01065 <span class="comment">//------- End of function Get::valid_pict -----------//</span>
01066 
01067 <span class="comment">//------- Begin of function Get::process_inter_field_key -----------//</span>
01075 <span class="comment">int Get::process_inter_field_key( int keyCode, GetFld* getPtr, int&amp; firstFlag,</span>
01076                                   <span class="keywordtype">int</span>&amp; firstKey, <span class="keywordtype">int</span>&amp; fldId, <span class="keywordtype">int</span>&amp; bufPos ) {
01077     <span class="keywordtype">int</span> newFldId=0;                                 <span class="comment">// newFldId is set when user move to other field, compare fldId and newFldId, we can know the change</span>
01078 
01079     <span class="keywordflow">switch</span>( keyCode ) {
01080         <span class="comment">// ####### begin Gilbert 24/7 ########//</span>
01081         <span class="comment">/*</span>
01082 <span class="comment">          case KEY_CTRL_HOME:</span>
01083 <span class="comment">          firstFlag = firstKey = 1;      // firstFlag time for this field</span>
01084 <span class="comment">          newFldId  = 1;   // get number is the firstFlag one</span>
01085 <span class="comment">          break;</span>
01086 <span class="comment"></span>
01087 <span class="comment">          case KEY_CTRL_END:</span>
01088 <span class="comment">          firstFlag = firstKey = 1 ;</span>
01089 <span class="comment">          newFldId  = get_num;   // last one</span>
01090 <span class="comment">          break;</span>
01091 <span class="comment">        */</span>
01092         <span class="comment">// ####### begin Gilbert 24/7 ########//</span>
01093 
01094     <span class="keywordflow">case</span> <a class="code" href="KEY_8H.html#a8">KEY_UP</a>:
01095         <span class="comment">// ####### begin Gilbert 24/7 ########//</span>
01096         <span class="comment">// case KEY_CTRL_Z:</span>
01097         <span class="comment">// ####### end Gilbert 24/7 ########//</span>
01098         firstFlag = firstKey = 1 ;
01099         newFldId = fldId-1;
01100         <span class="keywordflow">break</span>;
01101 
01102     <span class="keywordflow">case</span> <a class="code" href="KEY_8H.html#a9">KEY_DOWN</a>:
01103     <span class="keywordflow">case</span> <a class="code" href="KEY_8H.html#a3">KEY_RETURN</a>:
01104     <span class="keywordflow">case</span> <a class="code" href="KEY_8H.html#a1">KEY_TAB</a>:
01105         <span class="comment">// ####### begin Gilbert 24/7 ########//</span>
01106         <span class="comment">// case KEY_CTRL_B:</span>
01107         <span class="comment">// ####### end Gilbert 24/7 ########//</span>
01108         firstFlag = firstKey = 1;
01109         bufPos =  0 ;
01110         newFldId = fldId+1;
01111         <span class="keywordflow">break</span>;
01112 
01113     <span class="keywordflow">case</span> <a class="code" href="KEY_8H.html#a6">KEY_PGUP</a>:
01114     <span class="keywordflow">case</span> <a class="code" href="KEY_8H.html#a7">KEY_PGDN</a>:
01115         <span class="keywordflow">if</span> (up_down_exit)
01116             <span class="keywordflow">return</span> -1;                                <span class="comment">// exit read()</span>
01117         <span class="keywordflow">break</span>;
01118     }
01119 
01120     <span class="comment">//-------- Also Return if a Function Key was Pressed -------//</span>
01121 
01122     <span class="keywordflow">if</span> (
01123         <span class="comment">// ####### begin Gilbert 24/7 ########//</span>
01124         <span class="comment">// keyCode == KEY_CTRL_W  ||   keyCode == KEY_CTRL_Q  ||</span>
01125         <span class="comment">// ####### begin Gilbert 24/7 ########//</span>
01126         keyCode == <a class="code" href="KEY_8H.html#a2">KEY_ESC</a>     ||   keyCode == <a class="code" href="KEY_8H.html#a25">KEY_F10</a>     ||
01127         ( keyCode &gt;= <a class="code" href="KEY_8H.html#a16">KEY_F1</a> &amp;&amp; keyCode &lt;= <a class="code" href="KEY_8H.html#a24">KEY_F9</a> &amp;&amp; up_down_exit ) ||
01128         keyCode &lt; 0  ) {
01129         <span class="keywordflow">return</span> -1;                                    <span class="comment">// exit read()</span>
01130     }
01131 
01132     <span class="comment">//--------- press up in the upper most field --------//</span>
01133 
01134     <span class="keywordflow">if</span> ( newFldId &gt; get_num ) {
01135         <span class="keywordflow">if</span>( keyCode == <a class="code" href="KEY_8H.html#a3">KEY_RETURN</a> || keyCode == <a class="code" href="KEY_8H.html#a1">KEY_TAB</a> || up_down_exit )
01136             <span class="keywordflow">return</span> -1;                                  <span class="comment">// exit read()</span>
01137         <span class="keywordflow">else</span>
01138             newFldId = get_num;                         <span class="comment">// down or TAB is pressed and up_down_exit flag is not set</span>
01139     }
01140 
01141     <span class="comment">//------ or down key in the bottom most field -------//</span>
01142 
01143     <span class="keywordflow">if</span> ( newFldId &lt; 1 ) {
01144         <span class="keywordflow">if</span> ( up_down_exit )                           <span class="comment">// exit when up is pressed at the firstFlag field</span>
01145             <span class="keywordflow">return</span> -1;                                  <span class="comment">// exit read()</span>
01146         <span class="keywordflow">else</span>
01147             newFldId = 1;                               <span class="comment">// else than reassign it to fist field</span>
01148     }
01149 
01150     <span class="comment">//------- assign the new field pointer ---------//</span>
01151 
01152     <span class="keywordflow">if</span>( newFldId ) {
01153         <span class="keywordflow">if</span> (fldId != newFldId) {
01154             display_get( getPtr, 0 );
01155             fldId = newFldId;
01156             getPtr = fld_array + fldId - 1;
01157             display_get( getPtr, 1 );
01158         }
01159 
01160         <span class="keywordflow">return</span> 1;
01161     }
01162 
01163     <span class="keywordflow">return</span> 0;
01164 }
01165 
01166 <span class="comment">//------- End of function Get::process_inter_field_key -----------//</span>
01167 
01168 <span class="comment">//------- Begin of function Get::init_field -----------//</span>
01172 <span class="comment">void Get::init_field(char* dataBuf, char* pictBuf  , GetFld* getPtr,</span>
01173                      <span class="keywordtype">int</span>&amp; bufPos , <span class="keywordtype">int</span>&amp;  bufOffset, <span class="keywordtype">int</span> &amp;bufWidth ) {
01174     bufPos    = 0;
01175     bufOffset = 0;
01176 
01177     <span class="comment">//-- Buffer is filled and the width is returned by 'load_data' -//</span>
01178 
01179     bufWidth =  load_data( getPtr, dataBuf ) ;
01180     dataBuf[bufWidth] =  <span class="charliteral">'\0'</span> ;
01181 
01182   <span class="comment">//----- picture buffer is filled --------//</span>
01183 
01184     memset( pictBuf, 0, bufWidth+1 );
01185 
01186     <span class="keywordflow">if</span> ( getPtr-&gt;<a class="code" href="structGetFld.html#m8">picture</a> != (<span class="keywordtype">char</span> *) 0 ) {
01187         strncpy( pictBuf, getPtr-&gt;<a class="code" href="structGetFld.html#m8">picture</a>, bufWidth );
01188     }
01189     <span class="keywordflow">else</span> {
01190         <span class="keywordflow">switch</span>( getPtr-&gt;<a class="code" href="structGetFld.html#m4">type</a> ) {
01191         <span class="keywordflow">case</span> <span class="charliteral">'D'</span>:
01192             strcpy( pictBuf, <a class="code" href="OGET_8CPP.html#a0">DEFAULT_DATE</a> ) ;
01193             <span class="keywordflow">break</span> ;
01194 
01195         <span class="keywordflow">case</span> <span class="charliteral">'N'</span>:
01196         <span class="keywordflow">case</span> <span class="charliteral">'d'</span>:
01197         <span class="keywordflow">case</span> <span class="charliteral">'i'</span>:
01198         <span class="keywordflow">case</span> <span class="charliteral">'c'</span>:
01199             memset( pictBuf, (<span class="keywordtype">int</span>) <span class="charliteral">'#'</span>, (size_t) getPtr-&gt;<a class="code" href="structGetFld.html#m6">width_scr</a> ) ;
01200 
01201             <span class="keywordflow">if</span> ( getPtr-&gt;<a class="code" href="structGetFld.html#m7">dec_num</a> &gt; 0) {
01202                 <span class="keywordtype">int</span> t = getPtr-&gt;<a class="code" href="structGetFld.html#m6">width_scr</a> - getPtr-&gt;<a class="code" href="structGetFld.html#m7">dec_num</a> - 1 ;
01203 
01204                 dataBuf[t] = <span class="charliteral">'.'</span>;
01205                 pictBuf[t] = <span class="charliteral">'.'</span>;
01206             }
01207             <span class="keywordflow">break</span> ;
01208 
01209         <span class="keywordflow">case</span> <span class="charliteral">'L'</span>:
01210             pictBuf[0] = <span class="charliteral">'L'</span> ;
01211             pictBuf[1] = <span class="charliteral">'\0'</span> ;
01212             <span class="keywordflow">break</span> ;
01213         }
01214     }
01215 }
01216 
01217 <span class="comment">//------- End of function Get::init_field -----------//</span>
01218 
01219 <span class="comment">//------- Begin of function Get::get_next_key ---------//</span>
01226 <span class="comment">int Get::get_next_key( char* dataBuf, char* pictBuf, GetFld* getPtr,</span>
01227                        <span class="keywordtype">int</span>&amp;  bufPos , <span class="keywordtype">int</span>&amp;  bufOffset, <span class="keywordtype">int</span> &amp;bufWidth ) {
01228     <span class="keywordtype">int</span> keyCode;
01229 
01230     <span class="keywordflow">if</span> ( bufPos &gt;= bufWidth ) {                     <span class="comment">// the cursor exceeds the field width</span>
01231         keyCode = <a class="code" href="KEY_8H.html#a3">KEY_RETURN</a> ;                        <span class="comment">// than simulate a RETURN key to next field</span>
01232         font_ptr-&gt;disp( getPtr-&gt;<a class="code" href="structGetFld.html#m0">x</a>, getPtr-&gt;<a class="code" href="structGetFld.html#m1">y</a>, dataBuf, getPtr-&gt;<a class="code" href="structGetFld.html#m2">x2</a> );
01233     }
01234     <span class="keywordflow">else</span> {
01235         keyCode =  0 ;
01236 
01237         <span class="comment">// if the picture has a mask like e.g. "(999) 9999-999" then the '(',')' and '-' position will not be got.</span>
01238 
01239         <span class="keywordflow">if</span> ( strchr( <a class="code" href="OGET_8CPP.html#a1">PICTURE_CHRS</a>, pictBuf[bufPos] ) == (<span class="keywordtype">char</span> *) 0  &amp;&amp;
01240              (int) pictBuf[bufPos] &gt;= 0x20  &amp;&amp;
01241              (int) pictBuf[bufPos] &lt;= 0xFF) {
01242             dataBuf[bufPos] = pictBuf[bufPos] ;
01243             <span class="keywordflow">if</span> ( bufPos &lt; bufWidth-1 )
01244                 bufPos++ ;
01245 
01246             <span class="keywordflow">return</span> 0;
01247         }
01248 
01249         <span class="comment">//------ otherwise, check bufOffset --------//</span>
01250 
01251         <span class="keywordflow">if</span> ( bufOffset &lt;= bufPos - getPtr-&gt;<a class="code" href="structGetFld.html#m6">width_scr</a> )
01252             bufOffset =  1+ bufPos - getPtr-&gt;<a class="code" href="structGetFld.html#m6">width_scr</a> ;
01253 
01254         <span class="keywordflow">if</span> ( bufPos &lt; bufOffset )
01255             bufOffset =  bufPos ;
01256 
01257         <span class="comment">//--------- Say field content ------------//</span>
01258 
01259         font_ptr-&gt;disp( getPtr-&gt;<a class="code" href="structGetFld.html#m0">x</a>, getPtr-&gt;<a class="code" href="structGetFld.html#m1">y</a>, dataBuf+bufOffset, getPtr-&gt;<a class="code" href="structGetFld.html#m2">x2</a> );
01260 
01261         <span class="keywordtype">int</span> cursorX = getPtr-&gt;<a class="code" href="structGetFld.html#m0">x</a> + font_ptr-&gt;text_width( dataBuf, bufPos-bufOffset );
01262 
01263         <span class="comment">//-------- Call defined function before entering the field ------//</span>
01264 
01265         <span class="keywordflow">if</span> ( getPtr-&gt;<a class="code" href="structGetFld.html#m11">call_ptr</a> ) {
01266             dataBuf[bufWidth] = <span class="charliteral">'\0'</span> ;
01267             keyCode = (*getPtr-&gt;<a class="code" href="structGetFld.html#m11">call_ptr</a>)( getPtr, dataBuf, getPtr-&gt;<a class="code" href="structGetFld.html#m12">call_data</a>);
01268 
01269             <span class="keywordflow">if</span> ( keyCode == -1 )
01270                 <span class="keywordflow">return</span> 0;
01271         }
01272 
01273         <span class="comment">//--- Get key from keyboard and convert to upper case if necessary ----//</span>
01274 
01275         <span class="keywordflow">if</span> ( keyCode == 0 ) {
01276             sys.yield();
01277 
01278             DWORD nextTime=m.get_time();
01279             <span class="keywordtype">int</span>   cursorDisplay=1;
01280 
01281             <span class="comment">// ####### begin Gilbert 25/7 ##########//</span>
01282             <span class="comment">// while waitingfor input, flash the cursor</span>
01283             <span class="keywordflow">while</span>( mouse.is_key_event() ? ((keyCode = mouse.key_code),mouse.get_event(),0) : 1 ) {
01284                 <span class="comment">// ####### end Gilbert 25/7 ##########//</span>
01285                 <span class="keywordflow">if</span>( m.get_time() &gt;= nextTime ) {
01286                     <span class="keywordflow">if</span>( cursorDisplay )                     <span class="comment">// currently display -&gt; vanish</span>
01287                         vga.active_buf-&gt;bar( cursorX-1, getPtr-&gt;<a class="code" href="structGetFld.html#m1">y</a>, cursorX, getPtr-&gt;<a class="code" href="structGetFld.html#m1">y</a>+font_ptr-&gt;height()-1, <a class="code" href="COLOR_8H.html#a17">V_WHITE</a> );
01288                     <span class="keywordflow">else</span>                                    <span class="comment">// currently vanish -&gt; display</span>
01289                         vga.active_buf-&gt;bar_down( cursorX-1, getPtr-&gt;<a class="code" href="structGetFld.html#m1">y</a>, cursorX, getPtr-&gt;<a class="code" href="structGetFld.html#m1">y</a>+font_ptr-&gt;height()-1 );
01290 
01291                     cursorDisplay = !cursorDisplay;
01292                     nextTime = m.get_time() + 300;          <span class="comment">// flash frequency : 0.3 seconds</span>
01293                 }
01294 
01295                 sys.yield();
01296                 mouse.get_event();
01297 
01298                 sys.blt_virtual_buf();
01299 
01300                 <span class="comment">//----- if the mouse is press outside the field, exit ----//</span>
01301 
01302                 <span class="keywordflow">if</span>( mouse.any_click() ) {
01303                     <span class="keywordflow">if</span>( mouse.click_x() &lt; fld_x1 || mouse.click_x() &gt; fld_x2 ||
01304                         mouse.click_y() &lt; fld_y1 || mouse.click_y() &gt; fld_y2 ) {
01305                         keyCode = <a class="code" href="KEY_8H.html#a25">KEY_F10</a>;                    <span class="comment">// simulate a F10 to exit</span>
01306                         <span class="keywordflow">break</span>;
01307                     }
01308                 }
01309             }
01310 
01311             <span class="keywordflow">if</span>( !cursorDisplay )                        <span class="comment">// last time is display, then erase it</span>
01312                 vga.active_buf-&gt;bar_down( cursorX-1, getPtr-&gt;<a class="code" href="structGetFld.html#m1">y</a>, cursorX, getPtr-&gt;<a class="code" href="structGetFld.html#m1">y</a>+font_ptr-&gt;height()-1 );
01313 
01314             sys.blt_virtual_buf();
01315         }
01316 
01317         <span class="keywordflow">if</span> ( (getPtr-&gt;<a class="code" href="structGetFld.html#m9">upper_convert</a> ||  pictBuf[bufPos] == <span class="charliteral">'!'</span>)  &amp;&amp;  keyCode &gt;= 0x20  &amp;&amp;  keyCode &lt;= 0xFF )
01318             keyCode = m.upper( keyCode ) ;
01319     }
01320 
01321     <span class="keywordflow">return</span> keyCode;
01322 }
01323 
01324 <span class="comment">//------- End of function Get::get_next_key ---------//</span>
01325 
01326 <span class="comment">//------- Begin of function Get::store_and_valid ---------//</span>
01334 <span class="comment">int Get::store_and_valid( int keyCode, char* dataBuf, char* pictBuf, GetFld* getPtr,</span>
01335                           <span class="keywordtype">int</span>&amp; firstFlag) {
01336     <span class="keywordflow">if</span>( firstFlag ) {
01337         store_data( getPtr, dataBuf, pictBuf ) ;      <span class="comment">// save the previous field dataBuf data</span>
01338 
01339         <span class="comment">//-------- Call Check Validation function ----------//</span>
01340 
01341         <span class="comment">// ####### begin Gilbert 24/7 ########//</span>
01342         <span class="comment">// &amp;&amp; keyCode != KEY_CTRL_Q )</span>
01343         <span class="keywordflow">if</span> ( getPtr-&gt;<a class="code" href="structGetFld.html#m10">valid_ptr</a>  &amp;&amp; keyCode != <a class="code" href="KEY_8H.html#a2">KEY_ESC</a> ) {
01344             <span class="comment">// ####### end Gilbert 24/7 ########//</span>
01345             <span class="keywordflow">if</span> (!( (*getPtr-&gt;<a class="code" href="structGetFld.html#m10">valid_ptr</a>)() ) )
01346                 <span class="keywordflow">return</span> 0;
01347         }
01348 
01349         <span class="comment">//-------- Check validation of date content ---------//</span>
01350 
01351         <span class="comment">//------- Currently it only support "Character" type -----//</span>
01352         <span class="comment">/*</span>
01353 <span class="comment">          if ( getPtr-&gt;type == 'D' &amp;&amp; keyCode != KEY_ESC &amp;&amp; keyCode != KEY_CTRL_Q )</span>
01354 <span class="comment">          {</span>
01355 <span class="comment">          double  temp_data ;</span>
01356 <span class="comment">          int     date_rc ;</span>
01357 <span class="comment"></span>
01358 <span class="comment">          // Date Check</span>
01359 <span class="comment">          date_rc =  c1dt_julian( (char *) getPtr-&gt;data, &amp;temp_data ) ;</span>
01360 <span class="comment"></span>
01361 <span class="comment">          if ( date_rc == -1 )</span>
01362 <span class="comment">          {</span>
01363 <span class="comment">          dataBuf[bufWidth] = '\0' ;</span>
01364 <span class="comment">          return 0;</span>
01365 <span class="comment">          }</span>
01366 <span class="comment">          }</span>
01367 <span class="comment">        */</span>
01368         <span class="comment">//------- Currently it only support "Character" type -----//</span>
01369     }
01370 
01371     <span class="keywordflow">return</span> 1;
01372 }
01373 
01374 <span class="comment">//------- End of function Get::store_and_valid ---------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:45 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
