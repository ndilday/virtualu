<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>oiface.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>oiface.cpp</h1><a href="oiface_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OIFACE.CPP</span>
00002 <span class="comment">//Description : UserInterface class</span>
00003 
00004 <span class="comment">// Comments:    general functions for user interface manipulation</span>
00005 <span class="comment">//                                      refer to "admissions and financial aid office", &lt;Oadm_off&gt;</span>
00006 <span class="comment">// Norris 0714</span>
00007 
00008 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00010 <span class="preprocessor">#include &lt;OWORLDMT.H&gt;</span>
00011 <span class="preprocessor">#include &lt;OIFACE.H&gt;</span>
00012 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00013 <span class="preprocessor">#include &lt;<a class="code" href="COLOR_8H.html">COLOR.H</a>&gt;</span>
00014 <span class="preprocessor">#include &lt;<a class="code" href="OCOLTBL_8H.html">OCOLTBL.H</a>&gt;</span>
00015 <span class="preprocessor">#include &lt;<a class="code" href="OIMGRES_8H.html">OIMGRES.H</a>&gt;</span>
00016 <span class="preprocessor">#include &lt;OFONT.H&gt;</span>
00017 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>
00018 <span class="preprocessor">#include &lt;<a class="code" href="OFILE_8H.html">OFILE.H</a>&gt;</span>
00019 <span class="preprocessor">#include &lt;<a class="code" href="ORESX_8H.html">ORESX.H</a>&gt;</span>
00020 <span class="preprocessor">#include &lt;<a class="code" href="OBITMAPW_8H.html">OBITMAPW.H</a>&gt;</span>
00021 
00022 <span class="comment">//--------- define constant ---------//</span>
00023 
<a name="l00024"></a><a class="code" href="oiface_8cpp.html#a0">00024</a> <span class="preprocessor">#define BG_FILENAME "IFACE"                       // background images filename prefix</span>
<a name="l00025"></a><a class="code" href="oiface_8cpp.html#a1">00025</a> <span class="preprocessor"></span><span class="preprocessor">#define NUM_BG_IMG  19                            // number of background images</span>
00026 <span class="preprocessor"></span>
00027 <span class="keyword">enum</span> {
00028     <a class="code" href="oiface_8cpp.html#a4a2">BRIGHTENING_IDX</a> = 6,
00029     <a class="code" href="oiface_8cpp.html#a4a3">DARKENING_IDX</a> = -2
00030 };
00031 
00032 <span class="comment">//-------- Begin of function UserInterface::UserInterface ------//</span>
<a name="l00034"></a><a class="code" href="classUserInterface.html#a0">00034</a> <span class="comment">UserInterface::UserInterface() {</span>
00035     memset(<span class="keyword">this</span>, 0, <span class="keyword">sizeof</span>(<a class="code" href="classUserInterface.html">UserInterface</a>));
00036     color_table = <span class="keyword">new</span> <a class="code" href="classColorTable.html">ColorTable</a>;
00037     backgd_flag = 1;
00038     cur_img_id = 0;
00039     <span class="comment">// ##### begin Gilbert 26/04/2001 ######//</span>
00040     save_area_buffer = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00041     save_area_buffer_size = 0;;
00042     <span class="comment">// ##### end Gilbert 26/04/2001 ######//</span>
00043 }
00044 
00045 <span class="comment">//---------- End of function UserInterface::UserInterface ------//</span>
00046 
00047 <span class="comment">//-------- Begin of function UserInterface::~UserInterface -----//</span>
<a name="l00049"></a><a class="code" href="classUserInterface.html#a1">00049</a> <span class="comment">UserInterface::~UserInterface() {</span>
00050     <span class="comment">// ##### begin Gilbert 26/04/2001 ######//</span>
00051     <span class="keywordflow">if</span>( save_area_buffer )
00052         <a class="code" href="ALL_8H.html#a8">mem_del</a>(save_area_buffer);
00053     save_area_buffer = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00054     save_area_buffer_size = 0;
00055     <span class="comment">// ##### end Gilbert 26/04/2001 ######//</span>
00056     <span class="keyword">delete</span> color_table;
00057 }
00058 
00059 <span class="comment">//---------- End of function UserInterface::~UserInterface -----//</span>
00060 
00061 <span class="comment">//-------- Begin of function UserInterface::bg_img ------------//</span>
<a name="l00067"></a><a class="code" href="classUserInterface.html#a2">00067</a> <span class="comment">void UserInterface::bg_img(int imgId, VgaBuf *vgaBufPtr) {</span>
00068     <a class="code" href="ALL_8H.html#a0">err_when</a>(imgId &lt;= 0 || imgId &gt; <a class="code" href="oiface_8cpp.html#a1">NUM_BG_IMG</a>);
00069 
00070     <span class="keywordflow">if</span>(backgd_flag==0) {
00071         <span class="comment">//              vgaBufPtr-&gt;bar(ZOOM_X1, ZOOM_Y1,ZOOM_X2, ZOOM_Y2, V_WHITE);</span>
00072         vgaBufPtr-&gt;barW_fast(<a class="code" href="Oworldmt_8h.html#a12">ZOOM_X1</a>, <a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a>,<a class="code" href="Oworldmt_8h.html#a14">ZOOM_X2</a>, <a class="code" href="Oworldmt_8h.html#a15">ZOOM_Y2</a>,0xFFFF);
00073         <span class="comment">//              info.disp_column_bitmap(vgaBufPtr);</span>
00074         <span class="keywordflow">return</span>;
00075     }
00076 
00077     <a class="code" href="classString.html">String</a> imgName = <a class="code" href="oiface_8cpp.html#a0">BG_FILENAME</a>;
00078     imgName += long(imgId);
00079 
00080     <span class="keywordtype">int</span> dataSize;
00081     <a class="code" href="classFile.html">File</a>* filePtr = image_interface.get_file(imgName, dataSize);
00082 
00083     <span class="keywordflow">if</span> (imgId != cur_img_id) {
00084         <span class="keywordtype">short</span> header = filePtr-&gt;<a class="code" href="classFile.html#a11">file_get_short</a>();
00085 
00086         <a class="code" href="ALL_8H.html#a0">err_when</a>( header != -1 );                     <span class="comment">// must use own color palette</span>
00087 
00088         filePtr-&gt;<a class="code" href="classFile.html#a9">file_read</a>(palette, 256 * 3);
00089 
00090         <a class="code" href="structPalDesc.html">PalDesc</a> palDesc(palette, 3, 256, 6);
00091         color_table-&gt;generate_table_fast(<a class="code" href="OVGA_8H.html#a3">MAX_BRIGHTNESS_ADJUST_DEGREE</a>, palDesc, <a class="code" href="classColorTable.html#d0">ColorTable::bright_func</a>);
00092         remap_table = (<span class="keywordtype">short</span> *) color_table-&gt;get_table(0);
00093 
00094         cur_img_id = imgId;
00095     }
00096     <span class="keywordflow">else</span> {
00097         filePtr-&gt;<a class="code" href="classFile.html#a7">file_seek</a>(filePtr-&gt;<a class="code" href="classFile.html#a8">file_pos</a>() + 256 * 3 + <span class="keyword">sizeof</span>(short));
00098     }
00099 
00100     vgaBufPtr-&gt;put_large_bitmap(<a class="code" href="Oworldmt_8h.html#a12">ZOOM_X1</a>, <a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a>, filePtr, remap_table);
00101 
00102     info.disp_column_bitmap(vgaBufPtr);
00103 }
00104 
00105 <span class="comment">//---------- End of function UserInterface::bg_img ------------//</span>
00106 
00107 <span class="comment">/*</span>
00108 <span class="comment">//-------- Begin of function UserInterface::construct_palette_brighten ------//</span>
00110 <span class="comment">void UserInterface::construct_palette_brighten()</span>
00111 <span class="comment">{</span>
00112 <span class="comment">  double rgbR, rgbG, rgbB;</span>
00113 <span class="comment">  double yiqY, yiqI, yiqQ;</span>
00114 <span class="comment">  unsigned char *palettePtr = palette, *paletteBrightenPtr = palette_brighten;</span>
00115 <span class="comment">  for (int i = 0; i &lt; 256; i++)</span>
00116 <span class="comment">  {</span>
00117 <span class="comment">    yiqY = 0.2990*(rgbR=double(*palettePtr++)/63.0);</span>
00118 <span class="comment">yiqY += 0.5870*(rgbG=double(*palettePtr++)/63.0);</span>
00119 <span class="comment">yiqY += 0.1140*(rgbB=double(*palettePtr++)/63.0) + BRIGHTEN_IDX;</span>
00120 <span class="comment">yiqI = 0.5960*rgbR - 0.2750*rgbG - 0.3210*rgbB;</span>
00121 <span class="comment">yiqQ = 0.2120*rgbR - 0.5230*rgbG + 0.3110*rgbB;</span>
00122 <span class="comment">rgbR = yiqY + 0.9557*yiqI + 0.6199*yiqQ;</span>
00123 <span class="comment">rgbG = yiqY - 0.2716*yiqI - 0.6469*yiqQ;</span>
00124 <span class="comment">rgbB = yiqY - 1.1082*yiqI + 1.7051*yiqQ;</span>
00125 <span class="comment">(*paletteBrightenPtr++) = (rgbR &gt; 1.0) ? 63 : short(rgbR*63.0);</span>
00126 <span class="comment">(*paletteBrightenPtr++) = (rgbG &gt; 1.0) ? 63 : short(rgbG*63.0);</span>
00127 <span class="comment">(*paletteBrightenPtr++) = (rgbB &gt; 1.0) ? 63 : short(rgbB*63.0);</span>
00128 <span class="comment">}</span>
00129 <span class="comment">PalDesc palDesc(palette_brighten, 3, 256, 6);</span>
00130 <span class="comment">color_table_brighten-&gt;generate_table_fast(MAX_BRIGHTNESS_ADJUST_DEGREE, palDesc, ColorTable::bright_func);</span>
00131 <span class="comment">remap_table_brighten = (short *) color_table_brighten-&gt;get_table(0);</span>
00132 <span class="comment">}</span>
00133 <span class="comment">//---------- End of function UserInterface::construct_palette_brighten ------//</span>
00134 <span class="comment">*/</span>
00135 
00136 <span class="comment">//-------- Begin of function UserInterface::rect ------------//</span>
00144 <span class="comment">void UserInterface::rect(int x1, int y1, int x2, int y2, int width, int borderColor, int shadowColor, VgaBuf *vgaBufPtr) {</span>
00145     <span class="comment">//  vgaBufPtr-&gt;bar(x1+width, y1+width, x2-width, y1+width+1, shadowColor);</span>
00146     <span class="comment">//  vgaBufPtr-&gt;bar(x1+width, y1+width+2, x1+width+1, y2-width, shadowColor);</span>
00147     <span class="comment">//  vgaBufPtr-&gt;bar(x1+1, y2+1, x2+2, y2+2, shadowColor);</span>
00148     <span class="comment">//  vgaBufPtr-&gt;bar(x2+1, y1+1, x2+2, y2, shadowColor);</span>
00149     <span class="comment">//  vgaBufPtr-&gt;bar(x1, y1, x2, y1+(--width), borderColor);</span>
00150     <span class="comment">//  vgaBufPtr-&gt;bar(x1, y1+width+1, x1+width, y2, borderColor);</span>
00151     <span class="comment">//  vgaBufPtr-&gt;bar(x1+width+1, y2-width, x2, y2, borderColor);</span>
00152     <span class="comment">//  vgaBufPtr-&gt;bar(x2-width, y1+width+1, x2, y2-width-1, borderColor);</span>
00153     <span class="keywordtype">int</span> w=width+1;
00154     <span class="keywordflow">if</span>(w&lt;2)w=2;
00155     <span class="comment">// - 1</span>
00156     vgaBufPtr-&gt;bar(x1+w, y1+w, x2-w, y1+w, shadowColor);
00157     <span class="comment">// | 1</span>
00158     vgaBufPtr-&gt;bar(x1+w, y1+w+1, x1+w, y2-w+2, shadowColor);
00159     vgaBufPtr-&gt;bar(x1, y2+2, x2, y2+2, shadowColor);<span class="comment">// - 2</span>
00160     vgaBufPtr-&gt;bar(x2, y1, x2, y2+2, shadowColor);  <span class="comment">// | 2</span>
00161     w--;
00162     <span class="comment">// RGB = 75,60,31, Idx =5 (187,150,75)</span>
00163     <span class="comment">// ref to : /ccres/pal/pal.std</span>
00164     vgaBufPtr-&gt;bar(x1+w, y1+w, x2-w, y1+w, 5);      <span class="comment">// - 1</span>
00165     vgaBufPtr-&gt;bar(x1+w, y1+w+1, x1+w, y2-w+1, 5);  <span class="comment">// | 1</span>
00166     vgaBufPtr-&gt;bar(x1, y2+1, x2-1, y2+1, 5);        <span class="comment">// - 2</span>
00167     vgaBufPtr-&gt;bar(x2-1, y1, x2-1, y2+1, 5);        <span class="comment">// | 2</span>
00168     w--;
00169 
00170 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00171 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( borderColor == <a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;<a class="code" href="classVgaBuf.html#p3">color_up</a> ) {
00172         <span class="comment">// RGB = 94,87,69 , Idx = 193 (250,217,173)</span>
00173         vgaBufPtr-&gt;bar(x1, y1, x2-2, y1+w, 193);      <span class="comment">// - 1</span>
00174         vgaBufPtr-&gt;bar(x1, y1+w, x1+w, y2-w, 193);    <span class="comment">// | 1</span>
00175         vgaBufPtr-&gt;bar(x1, y2-w, x2-2, y2, 193);      <span class="comment">// - 2</span>
00176         vgaBufPtr-&gt;bar(x2-w-2, y1, x2-2, y2, 193);    <span class="comment">// | 2</span>
00177     }
00178     <span class="keywordflow">else</span> {
00179         <span class="comment">// RGB = 94,87,69 , Idx = 193 (250,217,173)</span>
00180         <span class="comment">// - 1</span>
00181         vgaBufPtr-&gt;bar(x1, y1, x2-2, y1+w, borderColor);
00182         <span class="comment">// | 1</span>
00183         vgaBufPtr-&gt;bar(x1, y1+w, x1+w, y2-w, borderColor);
00184         <span class="comment">// - 2</span>
00185         vgaBufPtr-&gt;bar(x1, y2-w, x2-2, y2, borderColor);
00186         <span class="comment">// | 2</span>
00187         vgaBufPtr-&gt;bar(x2-w-2, y1, x2-2, y2, borderColor);
00188     }
00189 <span class="preprocessor">#else</span>
00190 <span class="preprocessor"></span>    <span class="comment">// RGB = 94,87,69 , Idx = 193 (250,217,173)</span>
00191     vgaBufPtr-&gt;bar(x1, y1, x2-2, y1+w, 193);        <span class="comment">// - 1</span>
00192     vgaBufPtr-&gt;bar(x1, y1+w, x1+w, y2-w, 193);      <span class="comment">// | 1</span>
00193     vgaBufPtr-&gt;bar(x1, y2-w, x2-2, y2, 193);        <span class="comment">// - 2</span>
00194     vgaBufPtr-&gt;bar(x2-w-2, y1, x2-2, y2, 193);      <span class="comment">// | 2</span>
00195 <span class="preprocessor">#endif</span>
00196 <span class="preprocessor"></span>    <span class="comment">//  vgaBufPtr-&gt;bar(x1+w, y1+w, x2-1, y1+w, V_BROWN);    // - 1</span>
00197     <span class="comment">//  vgaBufPtr-&gt;bar(x1+w, y1+w+1, x1+w, y2-1, V_BROWN);       // | 1</span>
00198     <span class="comment">//  vgaBufPtr-&gt;bar(x1, y2+w, x2+w+1, y2+w, V_BROWN);                 // - 2</span>
00199     <span class="comment">//  vgaBufPtr-&gt;bar(x2+w, y1, x2+w, y2+w-1, V_BROWN);         // | 2</span>
00200     <span class="comment">//  w--;</span>
00201     <span class="comment">//  vgaBufPtr-&gt;bar(x1, y1, x2, y1+w, V_ORANGE);                     // - 1</span>
00202     <span class="comment">//  vgaBufPtr-&gt;bar(x1, y1+w, x1+w, y2, V_ORANGE);           // | 1</span>
00203     <span class="comment">//  vgaBufPtr-&gt;bar(x1, y2, x2+w, y2+w, V_ORANGE);           // - 2</span>
00204     <span class="comment">//  vgaBufPtr-&gt;bar(x2, y1, x2+w, y2, V_ORANGE);             // | 2</span>
00205 
00206     <span class="comment">//  vgaBufPtr-&gt;bar(x1+width, y1+width, x2-width, y1+width+1, shadowColor);</span>
00207     <span class="comment">//  vgaBufPtr-&gt;bar(x1+width, y1+width+2, x1+width+1, y2-width, shadowColor);</span>
00208     <span class="comment">//  vgaBufPtr-&gt;bar(x1+1, y2+1, x2+2, y2+2, shadowColor);</span>
00209     <span class="comment">//  vgaBufPtr-&gt;bar(x2+1, y1+1, x2+2, y2, shadowColor);</span>
00210     <span class="comment">//  vgaBufPtr-&gt;bar(x1, y1, x2, y1+(--width), V_BROWN);</span>
00211     <span class="comment">//  vgaBufPtr-&gt;bar(x1, y1+width+1, x1+width, y2, V_BROWN);</span>
00212     <span class="comment">//  vgaBufPtr-&gt;bar(x1+width+1, y2-width, x2, y2, V_BROWN);</span>
00213     <span class="comment">//  vgaBufPtr-&gt;bar(x2-width, y1+width+1, x2, y2-width-1, V_BROWN);</span>
00214     <span class="comment">//  vgaBufPtr-&gt;bar(x1, y1, x2, y1+(--width), V_ORANGE);</span>
00215     <span class="comment">//  vgaBufPtr-&gt;bar(x1, y1+width+1, x1+width, y2, V_ORANGE);</span>
00216     <span class="comment">//  vgaBufPtr-&gt;bar(x1+width+1, y2-width, x2, y2, V_ORANGE);</span>
00217     <span class="comment">//  vgaBufPtr-&gt;bar(x2-width, y1+width+1, x2, y2-width-1, V_ORANGE);</span>
00218 }
00219 
00220 <span class="comment">//---------- End of function UserInterface::rect ------------//</span>
00221 
00222 <span class="comment">//-------- Begin of function UserInterface::h_line ------------//</span>
00231 <span class="comment">void UserInterface::h_line(int x1, int y1, int length, int width, int borderColor, int shadowColor, VgaBuf *vgaBufPtr) {</span>
00232     <span class="comment">//borderColor);</span>
00233     vgaBufPtr-&gt;bar(x1, y1, x1+length-1, y1+width-1, 193);
00234     <span class="comment">// shadowColor);</span>
00235     vgaBufPtr-&gt;bar(x1+1, y1+width, x1+length+1, y1+width+1,5);
00236     <span class="comment">// shadowColor);</span>
00237     vgaBufPtr-&gt;bar(x1+length+1, y1+1, x1+length+2, y1+width,5);
00238 }
00239 
00240 <span class="comment">//---------- End of function UserInterface::h_line ------------//</span>
00241 
00242 <span class="comment">//-------- Begin of function UserInterface::v_line ------------//</span>
00251 <span class="comment">void UserInterface::v_line(int x1, int y1, int height, int width, int borderColor, int shadowColor, VgaBuf *vgaBufPtr) {</span>
00252     <span class="keywordflow">if</span> (borderColor &gt;0 || shadowColor&gt;0) {
00253         vgaBufPtr-&gt;bar(x1, y1, x1+width-1, y1+height-1, borderColor);
00254         vgaBufPtr-&gt;bar(x1+width+1, y1+1, x1+width+2, y1+height+1, shadowColor);
00255         vgaBufPtr-&gt;bar(x1+1, y1+height, x1+width, y1+height+1, shadowColor);
00256     }
00257     <span class="keywordflow">else</span> {
00258         <span class="comment">//borderColor);</span>
00259         vgaBufPtr-&gt;bar(x1, y1, x1+width-1, y1+height-1, 193);
00260         <span class="comment">// shadowColor);</span>
00261         vgaBufPtr-&gt;bar(x1+width+1, y1+1, x1+width+2, y1+height+1, 5);
00262         <span class="comment">//shadowColor);</span>
00263         vgaBufPtr-&gt;bar(x1+1, y1+height, x1+width, y1+height+1, 5);
00264     }
00265 }
00266 
00267 <span class="comment">//---------- End of function UserInterface::v_line ------------//</span>
00268 
00269 <span class="comment">//-------- Begin of function UserInterface::bar ------------//</span>
00277 <span class="comment">void UserInterface::bar(int x1, int y1, int x2, int y2, int barColor, int shadowColor, VgaBuf *vgaBufPtr) {</span>
00278     vgaBufPtr-&gt;bar(x1, y1, x2, y2, barColor);
00279     vgaBufPtr-&gt;bar(x1, y2+1, x2, y2+2, shadowColor);
00280     vgaBufPtr-&gt;bar(x2+1, y1, x2+2, y2+2, shadowColor);
00281 }
00282 
00283 <span class="comment">//---------- End of function UserInterface::bar ------------//</span>
00284 
00285 <span class="comment">//-------- Begin of function UserInterface::panel ------------//</span>
00293 <span class="comment">void UserInterface::panel(int x1, int y1, int x2, int y2, int panelColor, int lightColor, int shadowColor, VgaBuf *vgaBufPtr) {</span>
00294     vgaBufPtr-&gt;bar(x1, y1, x2, y1, shadowColor);
00295     vgaBufPtr-&gt;bar(x1, y1+1, x1, y2, shadowColor);
00296     vgaBufPtr-&gt;bar(x1+1, y2, x2, y2, lightColor);
00297     vgaBufPtr-&gt;bar(x2, y1+1, x2, y2-1, lightColor);
00298     vgaBufPtr-&gt;bar(x1+1, y1+1, x2-1, y2-1, panelColor);
00299 }
00300 
00301 <span class="comment">//---------- End of function UserInterface::panel ------------//</span>
00302 
00303 <span class="comment">//-------- Begin of function UserInterface::paint ------------//</span>
00309 <span class="comment">void UserInterface::paint(int x1, int y1, int x2, int y2, int paintColor, VgaBuf *vgaBufPtr) {</span>
00310     vgaBufPtr-&gt;bar(x1, y1, x2, y2, paintColor);
00311 }
00312 
00313 <span class="comment">//---------- End of function UserInterface::paint ------------//</span>
00314 
00315 <span class="comment">/*</span>
00316 <span class="comment">//-------- Begin of function UserInterface::brighten ----------//</span>
00323 <span class="comment">void UserInterface::brighten(short *bufPtr)</span>
00324 <span class="comment">{</span>
00325 <span class="comment">  int bufSize = int(*bufPtr++);</span>
00326 <span class="comment">bufSize *= int(*bufPtr++);</span>
00327 <span class="comment"></span>
00328 <span class="comment">if (cur_img_id &lt;= 0 || cur_img_id &gt; NUM_BG_IMG)</span>
00329 <span class="comment">return;</span>
00330 <span class="comment"></span>
00331 <span class="comment">if (!palette_flag)</span>
00332 <span class="comment">{</span>
00333 <span class="comment">construct_palette_brighten();</span>
00334 <span class="comment">palette_flag = 1;</span>
00335 <span class="comment">}</span>
00336 <span class="comment"></span>
00337 <span class="comment">for (int i = 0; i &lt; bufSize; i++, bufPtr++)</span>
00338 <span class="comment">{</span>
00339 <span class="comment">for (int j = 0; j &lt; 256; j++)</span>
00340 <span class="comment">{</span>
00341 <span class="comment">if (*bufPtr == remap_table[j])</span>
00342 <span class="comment">{</span>
00343 <span class="comment">*bufPtr = remap_table_brighten[j];</span>
00344 <span class="comment">break;</span>
00345 <span class="comment">}</span>
00346 <span class="comment">}</span>
00347 <span class="comment">}</span>
00348 <span class="comment">}</span>
00349 <span class="comment">//---------- End of function UserInterface::brighten ---------//</span>
00350 <span class="comment">*/</span>
00351 
00352 <span class="comment">//--------- Begin of function UserInterface::adjust_brigheness -------//</span>
<a name="l00354"></a><a class="code" href="classUserInterface.html#a15">00354</a> <span class="comment">void UserInterface::adjust_brightness(int x1, int y1, int x2, int y2, int brightness, VgaBuf *vgaBufPtr) {</span>
00355 <span class="preprocessor">#if( MAX_BRIGHTNESS_ADJUST_DEGREE &gt; 10 )</span>
00356 <span class="preprocessor"></span>    brightness *= <a class="code" href="OVGA_8H.html#a3">MAX_BRIGHTNESS_ADJUST_DEGREE</a> / 10;
00357 <span class="preprocessor">#endif</span>
00358 <span class="preprocessor"></span>
00359     <a class="code" href="ALL_8H.html#a0">err_when</a>( brightness &lt; -<a class="code" href="OVGA_8H.html#a3">MAX_BRIGHTNESS_ADJUST_DEGREE</a> ||
00360               brightness &gt;  <a class="code" href="OVGA_8H.html#a3">MAX_BRIGHTNESS_ADJUST_DEGREE</a> );
00361 
00362     <a class="code" href="IMGFUN_8H.html#a29">IMGbrightBar</a>( vgaBufPtr-&gt;buf_ptr(), vgaBufPtr-&gt;buf_true_pitch(), x1, y1, x2, y2, brightness);
00363 
00364     <span class="comment">/*</span>
00365 <span class="comment">      if ((x2 - x1 + 1) * (y2 - y1 + 1) &gt; COMMON_DATA_BUF_SIZE)</span>
00366 <span class="comment">      {</span>
00367 <span class="comment">      for (short i = y1; i &lt;= y2; i++)</span>
00368 <span class="comment">      {</span>
00369 <span class="comment">      vgaBufPtr-&gt;save_area_common_buf(x1, i, x2, i);</span>
00370 <span class="comment">      IMGcopyWbright( vgaBufPtr-&gt;buf_ptr(), vgaBufPtr-&gt;buf_true_pitch(),</span>
00371 <span class="comment">      ((short*)sys.common_data_buf)+6, *((short*)sys.common_data_buf),</span>
00372 <span class="comment">      x1, i, x2, i, brightness);</span>
00373 <span class="comment">      }</span>
00374 <span class="comment">      }</span>
00375 <span class="comment">      else</span>
00376 <span class="comment">      {</span>
00377 <span class="comment">      vgaBufPtr-&gt;save_area_common_buf(x1, y1, x2, y2);</span>
00378 <span class="comment">      IMGcopyWbright( vgaBufPtr-&gt;buf_ptr(), vgaBufPtr-&gt;buf_true_pitch(),</span>
00379 <span class="comment">      ((short*)sys.common_data_buf)+6, *((short*)sys.common_data_buf),</span>
00380 <span class="comment">      x1, y1, x2, y2, brightness);</span>
00381 <span class="comment">      }</span>
00382 <span class="comment">    */</span>
00383 }
00384 
00385 <span class="comment">//----------- End of function UserInterface::adjust_brightness -------//</span>
00386 
00387 <span class="comment">//--------- Begin of function UserInterface::brighten -------//</span>
<a name="l00389"></a><a class="code" href="classUserInterface.html#a16">00389</a> <span class="comment">void UserInterface::brighten(int x1, int y1, int x2, int y2, VgaBuf *vgaBufPtr) {</span>
00390     <span class="keywordflow">if</span>(backgd_flag==0)<span class="keywordflow">return</span>;
00391     adjust_brightness(x1, y1, x2, y2, <a class="code" href="oiface_8cpp.html#a4a2">BRIGHTENING_IDX</a>, vgaBufPtr);
00392 }
00393 
00394 <span class="comment">//----------- End of function UserInterface::brighten -------//</span>
00395 
00396 <span class="comment">//--------- Begin of function UserInterface::darken -------//</span>
<a name="l00398"></a><a class="code" href="classUserInterface.html#a17">00398</a> <span class="comment">void UserInterface::darken(int x1, int y1, int x2, int y2, VgaBuf *vgaBufPtr) {</span>
00399     adjust_brightness(x1, y1, x2, y2, <a class="code" href="oiface_8cpp.html#a4a3">DARKENING_IDX</a>, vgaBufPtr);
00400 }
00401 
00402 <span class="comment">//----------- End of function UserInterface::darken -------//</span>
00403 
00404 <span class="comment">//---------- Begin of funcion UserInterface::create_button_bitmap -------//</span>
00405 <span class="comment">//</span>
00406 <span class="comment">//      &lt;int&gt;                   x1, y1, x2, y2                  coordinates of the button</span>
00407 <span class="comment">// &lt;char*&gt;              label                                           text label of the button</span>
00408 <span class="comment">// &lt;short**&gt;    upBitmapPtr                             ptr to button-up bitmap (to use: upBitmapPtr+4)</span>
00409 <span class="comment">// &lt;short**&gt;    downBitmapPtr                   ptr to button-down bitmap (to use: downBitmapPtr+4)</span>
00410 <span class="comment">//      [VgaBuf*]       vgaBufPtr                               ptr to VgaBuf (default = Vga::active_buf)</span>
00411 <span class="comment">// [Font*]              fontPtr                                 ptr to font to be used (default = &amp;font_san)</span>
00412 <span class="comment">//</span>
<a name="l00413"></a><a class="code" href="classUserInterface.html#a18">00413</a> <span class="keywordtype">void</span> <a class="code" href="classUserInterface.html#a18">UserInterface::create_button_bitmap</a>(<span class="keywordtype">int</span> x1, <span class="keywordtype">int</span> y1, <span class="keywordtype">int</span> x2, <span class="keywordtype">int</span> y2, <span class="keywordtype">char</span> *label, <span class="keywordtype">short</span> **upBitmapPtr, <span class="keywordtype">short</span> **downBitmapPtr, <a class="code" href="classVgaBuf.html">VgaBuf</a> *vgaBufPtr, <a class="code" href="classFont.html">Font</a> *fontPtr) {
00414     x1++;
00415     y1++;
00416     x2--;
00417     y2--;
00418 
00419     <span class="comment">// ##### begin Gilbert 26/04/2001 ######//</span>
00420     <span class="comment">// reduce mem_add/mem_del</span>
00421     <span class="comment">// short *saveAreaBuf = vgaBufPtr-&gt;save_area(x1, y1, x2+2, y2+2);  //## chea 070999 BUGHERE if the button is @ the bottom of the screen</span>
00422     <span class="keywordtype">int</span> saveAreaSize = <a class="code" href="classBitmapW.html#a7">BitmapW::size</a>(x2+2-x1+1, y2+2-y1+1);
00423     <span class="keywordflow">if</span>( saveAreaSize &gt; save_area_buffer_size ) {
00424         save_area_buffer_size = saveAreaSize + 0x1000;<span class="comment">// allocate 1K byte more</span>
00425         save_area_buffer = (<span class="keywordtype">short</span> *)<a class="code" href="ALL_8H.html#a7">mem_resize</a>( save_area_buffer, save_area_buffer_size );
00426     }
00427     vgaBufPtr-&gt;<a class="code" href="classVgaBuf.html#a83">read_bitmapW</a>(x1, y1, x2+2, y2+2, save_area_buffer );
00428     <span class="comment">// ##### end Gilbert 26/04/2001 ######//</span>
00429 
00430     <a class="code" href="classUserInterface.html#a3">rect</a>(x1, y1, x2+2, y2,1);
00431 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00432 <span class="preprocessor"></span>    <span class="keywordtype">short</span> lineCount = 1;
00433     <span class="keywordtype">char</span> labelLocal[123];
00434     strcpy( labelLocal, label );
00435     <span class="keywordtype">short</span> breakPos[2]= {                            <span class="comment">// Assume can divide into 3 rows</span>
00436         strlen(label),strlen(label)
00437     };
00438     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=0; i&lt;strlen(label)-1; i++ ) {
00439         <span class="keywordflow">if</span> ( label[i] == <span class="charliteral">'\n'</span> ) {                     <span class="comment">// there should be a line break</span>
00440             breakPos[lineCount-1] = i-1;                <span class="comment">// will copy strings till i</span>
00441             lineCount++;
00442         }
00443     }
00444     <span class="keywordtype">char</span> oneRowLabel[123]=<span class="stringliteral">"\0"</span>;
00445     <span class="keywordtype">char</span>* tail = <span class="stringliteral">"\0"</span>;
00446     <span class="keywordtype">int</span>  startY,endY;
00447     <span class="keywordflow">for</span> ( i=0; i&lt;lineCount; i++ ) {
00448         strcpy ( oneRowLabel, <span class="stringliteral">""</span> );
00449         <span class="comment">// copy the text need to display</span>
00450         strncpy( oneRowLabel, labelLocal, breakPos[i]+1 );
00451         strcpy( oneRowLabel+breakPos[i]+1, tail );
00452         startY = ((y2+1-(y1+2))/lineCount)*i+(y1+2);
00453         endY   = ((y2+1-(y1+2))/lineCount)*(i+1)+(y1+2);
00454         fontPtr-&gt;<a class="code" href="classFont.html#a16">center_put</a>( x1+2, startY, x2, endY, oneRowLabel );
00455         <span class="comment">// Shorten the label</span>
00456         strcpy( labelLocal, label+breakPos[i]+1 );
00457     }
00458 <span class="preprocessor">#else</span>
00459 <span class="preprocessor"></span>    fontPtr-&gt;<a class="code" href="classFont.html#a16">center_put</a>(x1+2, y1+2, x2, y2+1, label);
00460 <span class="preprocessor">#endif</span>
00461 <span class="preprocessor"></span>    *downBitmapPtr = vgaBufPtr-&gt;<a class="code" href="classVgaBuf.html#a50">save_area</a>(x1-1, y1-1, x2+2, y2+2, *downBitmapPtr);
00462     <span class="comment">// ##### begin Gilbert 26/04/2001 ######//</span>
00463     <span class="comment">// vgaBufPtr-&gt;rest_area(saveAreaBuf, 0);</span>
00464     vgaBufPtr-&gt;<a class="code" href="classVgaBuf.html#a85">put_bitmapW</a>( x1,y1, save_area_buffer );
00465     <span class="comment">// ##### end Gilbert 26/04/2001 ######//</span>
00466     <a class="code" href="classUserInterface.html#a16">brighten</a>(x1, y1, x2+2, y2);
00467     <a class="code" href="classUserInterface.html#a3">rect</a>(x1, y1, x2+2, y2,1);
00468 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00469 <span class="preprocessor"></span>    strcpy( labelLocal, label );
00470     strcpy(oneRowLabel,<span class="stringliteral">"\0"</span>);
00471     tail = <span class="stringliteral">"\0"</span>;
00472     startY,endY;
00473     <span class="keywordflow">for</span> ( i=0; i&lt;lineCount; i++ ) {
00474         strcpy( oneRowLabel, <span class="stringliteral">""</span> );
00475         <span class="comment">// copy the text need to display</span>
00476         strncpy( oneRowLabel, labelLocal, breakPos[i]+1 );
00477         strcpy( oneRowLabel+breakPos[i]+1, tail );
00478         startY = ((y2+1-(y1+2))/lineCount)*i+(y1+2);
00479         endY   = ((y2+1-(y1+2))/lineCount)*(i+1)+(y1+2);
00480         fontPtr-&gt;<a class="code" href="classFont.html#a16">center_put</a>( x1+2, startY, x2, endY, oneRowLabel );
00481         <span class="comment">// Shorten the label</span>
00482         strcpy( labelLocal, label+breakPos[i]+1 );
00483     }
00484 <span class="preprocessor">#else</span>
00485 <span class="preprocessor"></span>    fontPtr-&gt;<a class="code" href="classFont.html#a16">center_put</a>(x1+2, y1+2, x2, y2+1, label);
00486 <span class="preprocessor">#endif</span>
00487 <span class="preprocessor"></span>    *upBitmapPtr = vgaBufPtr-&gt;<a class="code" href="classVgaBuf.html#a50">save_area</a>(x1-1, y1-1, x2+2, y2+2, *upBitmapPtr);
00488     <span class="comment">// ##### begin Gilbert 26/04/2001 ######//</span>
00489     <span class="comment">// vgaBufPtr-&gt;rest_area(saveAreaBuf, 1);</span>
00490     vgaBufPtr-&gt;<a class="code" href="classVgaBuf.html#a85">put_bitmapW</a>( x1,y1, save_area_buffer );
00491     <span class="comment">// ##### end Gilbert 26/04/2001 ######//</span>
00492 }
00493 
00494 <span class="comment">//----------- End of function UserInterface::create_button_bitmap -------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:58 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
