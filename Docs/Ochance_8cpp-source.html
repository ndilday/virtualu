<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Ochance.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Ochance.cpp</h1><a href="Ochance_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OCHANCE.CPP</span>
00002 <span class="comment">//Description : Random events (refer to chance card specifications (WFM: March 10,1999)</span>
00003 <span class="comment">//Owner                 : Fred</span>
00004 
00005 <span class="preprocessor">#include &lt;OMISC.H&gt;</span>
00006 <span class="preprocessor">#include &lt;OMATH.H&gt;</span>
00007 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00008 <span class="preprocessor">#include &lt;<a class="code" href="ODATE_8H.html">ODATE.H</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;<a class="code" href="OGCONFIG_8H.html">OGCONFIG.H</a>&gt;</span>
00010 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>
00011 <span class="preprocessor">#include &lt;ONEWS.H&gt;</span>
00012 <span class="preprocessor">#include &lt;<a class="code" href="OTASK_8H.html">OTASK.H</a>&gt;</span> 
00013 <span class="preprocessor">#include &lt;ODEVELOP.H&gt;</span>
00014 <span class="preprocessor">#include &lt;ODEVELOP.H&gt;</span>
00015 <span class="preprocessor">#include &lt;OENROLL.H&gt;</span>
00016 <span class="preprocessor">#include &lt;OINVEST.H&gt;</span>
00017 <span class="preprocessor">#include &lt;ODEVELOP.H&gt;</span>
00018 <span class="preprocessor">#include &lt;OFACILIT.H&gt;</span>
00019 <span class="preprocessor">#include &lt;OSTUDENT.H&gt;</span>
00020 <span class="preprocessor">#include &lt;OATHLETI.H&gt;</span>
00021 <span class="preprocessor">#include &lt;ODEPT.H&gt;</span>
00022 <span class="preprocessor">#include &lt;OPSCHOOL.H&gt;</span>
00023 <span class="preprocessor">#include &lt;OFINANCE.H&gt;</span>
00024 <span class="preprocessor">#include &lt;<a class="code" href="OPEERSCH_8H.html">OPEERSCH.H</a>&gt;</span>
00025 <span class="preprocessor">#include &lt;<a class="code" href="OSCHLRES_8H.html">OSCHLRES.H</a>&gt;</span>
00026 
00027 <span class="preprocessor">#include &lt;OCHANCE.H&gt;</span>
00028 
00029 <span class="comment">//------ Define functions------//</span>
00030 
00031 <span class="keyword">static</span> <a class="code" href="Ochance_8h.html#a1">EventF</a> alumni_die, rape_in_campus, retrofit_facilities, earth_quake, congress_research, stock_market, scandalous_fund_use,
00032     new_governor, court_limit_minority, rise_performance_rating,
00033     risky_research,scandal_in_athletics,
00034     research_prize,technology_transfer,capital_campaign,student_loans,
00035     plagiarism_scandal,
00036     for_profit_competition,minority_student_percentage_falls,successful_grad,media_obtain_information,
00037     rise_educational_quality,rise_student_morale, rise_department_morale, rise_faculty_research_Per,
00038     <span class="comment">//## chea 220999</span>
00039     rise_faculty_diversity_index, rise_use_of_IT, rise_staff_morale;
00040 
00041 <span class="keyword">static</span> <span class="keywordtype">char</span> get_random_event_id();
00042 
00043 <span class="keyword">static</span> <span class="keywordtype">void</span> get_best_research_dept(<span class="keywordtype">float</span>&amp; bestPrefResearch, <span class="keywordtype">int</span>&amp; bestDeptRecno, <span class="keywordtype">int</span>&amp; bestFacultyRecno, <span class="keywordtype">short</span>* fieldList);
00044 
00045 <span class="keyword">static</span> <span class="keywordtype">void</span> set_task(<span class="keywordtype">int</span> taskId, <span class="keywordtype">int</span> src, <span class="keywordtype">int</span>&amp; target, <span class="keywordtype">int</span>&amp; year, <span class="keywordtype">int</span>&amp; month, <span class="keywordtype">int</span>&amp; bonus, <span class="keywordtype">int</span>&amp; ratingType);
00046 
00047 <span class="comment">//------ Define static function pointers array ------//</span>
00048 
<a name="l00049"></a><a class="code" href="Ochance_8cpp.html#a28">00049</a> <a class="code" href="structEventStruct.html">EventStruct</a> <a class="code" href="Ochance_8cpp.html#a28">news_event_function_array</a>[<a class="code" href="Onews_8h.html#a51a34">NEWS_ID_COUNT_ONLY_CHANCE</a>] = { 
00050     <span class="comment">//1                                                           //## chea 091199 checked</span>
00051     {  &amp;alumni_die, 25 },
00052     <span class="comment">//2 // = 20 if 100 and 2 if administrative_performance = 0  //## chea 091199 checked</span>
00053   
00054     {  &amp;rape_in_campus, 20 },
00055     <span class="comment">//3                                                           //## chea 091199 checked</span>
00056  
00057     { &amp;retrofit_facilities, 25 },
00058     <span class="comment">//4                                                           //## chea 091199 checked</span>
00059   
00060     { &amp;earth_quake, 50 },
00061     <span class="comment">//5                                                           //## chea 091199 checked</span>
00062   
00063     { &amp;congress_research, 18 }, 
00064     <span class="comment">//6                                                           //## chea 091199 checked</span>
00065   
00066     { &amp;stock_market, 15 },
00067     <span class="comment">//7 // = 30 if 100 and 1 if administrative_performance = 0  //## chea 091199 checked</span>
00068   
00069     { &amp;scandalous_fund_use, 30 },
00070     <span class="comment">//8 // = 0 or impossible if private school                  //## chea 091199 checked</span>
00071   
00072     { &amp;new_governor, 12 },
00073     <span class="comment">//9 // = 0 after occurs once                                //## chea 091199 checked</span>
00074   
00075     { &amp;court_limit_minority, 20 },
00076     <span class="comment">//10        //  //## chea 150699                                    //## chea 091199 checked</span>
00077   
00078     { &amp;risky_research, 20 },
00079     <span class="comment">//11        //  //## chea 150699                                    //## chea 091199 checked</span>
00080   
00081     { &amp;scandal_in_athletics, 25 },
00082     <span class="comment">//12                                                           //## chea 091199 checked</span>
00083   
00084     { &amp;research_prize,10 },
00085     <span class="comment">//13                                                           //## chea 091199 checked</span>
00086   
00087     { technology_transfer,20 },
00088     <span class="comment">//14                                                           //## chea 091199 checked</span>
00089   
00090     { &amp;capital_campaign,20 },
00091     <span class="comment">//15                                                           //## chea 091199 checked</span>
00092   
00093     { &amp;student_loans,15 },
00094     <span class="comment">//16                                                                        //## chwg 17Jun99                     //## chea 091199 checked</span>
00095   
00096 
00097     { &amp;plagiarism_scandal,15 },
00098     <span class="comment">//17                                                                        //## chwg 19Jun99                     //## chea 091199 checked</span>
00099   
00100     { &amp;for_profit_competition,20 },
00101     <span class="comment">//18                                                //## chwg 21Jun99                     //## chea 091199 checked</span>
00102   
00103     { &amp;minority_student_percentage_falls,20 },
00104     <span class="comment">//19                                                                        //## chwg 21Jun99                     //## chea 091199 checked</span>
00105   
00106     { &amp;successful_grad,100 },
00107     <span class="comment">//20                                                                        //## chwg 21Jun99                     //## chea this has no effect at all</span>
00108   
00109     { &amp;media_obtain_information,20 },
00110   
00111 };
00112 
00113 <span class="keyword">static</span> <a class="code" href="Ochance_8h.html#a0">EventFP</a> task_event_function_array[<a class="code" href="OTASK_8H.html#a0">TASK_COUNT</a>] = {
00114     &amp;rise_performance_rating,                       <span class="comment">//21</span>
00115     &amp;rise_educational_quality,                      <span class="comment">//## chea 220999  //22</span>
00116     &amp;rise_student_morale,                           <span class="comment">//23</span>
00117     &amp;rise_department_morale,                        <span class="comment">//24</span>
00118     &amp;rise_faculty_research_Per,                     <span class="comment">//25</span>
00119     &amp;rise_faculty_diversity_index,                  <span class="comment">//26</span>
00120     &amp;rise_use_of_IT,                                <span class="comment">//27</span>
00121     &amp;rise_staff_morale,                             <span class="comment">//28</span>
00122 };
00123 
00124 <span class="comment">//------ Begin of function ChanceEvent::init -----//</span>
<a name="l00126"></a><a class="code" href="classChanceEvent.html#a0">00126</a> <span class="comment">void ChanceEvent::init() {</span>
00127     memset(<span class="keyword">this</span>, 0, <span class="keyword">sizeof</span>(<a class="code" href="classChanceEvent.html">ChanceEvent</a>));
00128 
00129     research_adjust_multiplier = 1;
00130     capital_campaign_end_year  = -1;
00131 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00132 <span class="preprocessor"></span>    alumni_budget_increase = 1.0f;
00133 <span class="preprocessor">#endif</span>
00134 <span class="preprocessor"></span>}
00135 
00136 <span class="comment">//------- End of function ChanceEvent::init -----//</span>
00137 
00138 <span class="comment">//------ Begin of function ChanceEvent::deinit -----//</span>
<a name="l00140"></a><a class="code" href="classChanceEvent.html#a1">00140</a> <span class="comment">void ChanceEvent::deinit() {</span>
00141 }
00142 
00143 <span class="comment">//------- End of function ChanceEvent::deinit -----//</span>
00144 
00145 <span class="comment">//------ Begin of function ChanceEvent::next_day -----//</span>
<a name="l00147"></a><a class="code" href="classChanceEvent.html#a4">00147</a> <span class="comment">void ChanceEvent::next_day() {</span>
00148     process_chance_event();
00149     process_objective_event();
00150 }
00151 
00152 <span class="comment">//------- End of function ChanceEvent::next_day -----//</span>
00153 
00154 <span class="comment">//------ Begin of function ChanceEvent::process_chance_event -------//</span>
00156 <span class="comment">void ChanceEvent::process_chance_event() {</span>
00157     <span class="keywordflow">if</span> (info.prerun_year==1)                        <span class="comment">// during initialization</span>
00158         <span class="keywordflow">return</span>;
00159 
00160     <span class="keywordflow">if</span>( player_school.scenario_id &gt; <a class="code" href="Opschool_8h.html#a63a21">SCN_NONE</a> )      <span class="comment">// never happen if this is a scenario game</span>
00161         <span class="keywordflow">return</span>;
00162 
00163     update_chance_vars();
00164     process_individual_chance();                    <span class="comment">// process individual chance cards</span>
00165 
00166     <span class="keywordflow">if</span>( info.game_day == 1 || info.game_day &gt; 27 )  <span class="comment">// avoid Performance indicator calculation at 1st of each month or the end of each month</span>
00167         <span class="keywordflow">return</span>;
00168 
00169     <span class="comment">//---- if a chance event has been triggered by hotkey ------//</span>
00170 
00171     <span class="keywordtype">int</span> eventId;
00172 
00173     <span class="keywordflow">if</span>( chance_event.test_chance &amp;&amp;
00174         <span class="comment">// NEWS_FOOTBALL_GAME &amp; NEWS_BASKETBALL_GAME are triggered elsewhere</span>
00175         chance_event.test_chance != <a class="code" href="Onews_8h.html#a51a38">NEWS_FOOTBALL_GAME</a> &amp;&amp;
00176         chance_event.test_chance != <a class="code" href="Onews_8h.html#a51a39">NEWS_BASKETBALL_GAME</a> ) {
00177         eventId = chance_event.test_chance-1;         <span class="comment">// eventId starts with 0 while test_chance starts with 1.</span>
00178     }
00179     <span class="keywordflow">else</span> {                                          <span class="comment">//--- otherwise, randomly choose one with consideration of the event's odds ---//</span>
00180         <span class="comment">//------------ determine the chance based on the frequency setting ----//</span>
00181 
00182         <span class="comment">// if frequency is set to none</span>
00183         <span class="keywordflow">if</span>( player_school.chance_event_frequency == 0 ) {
00184             <span class="keywordflow">return</span>;
00185         }
00186         <span class="comment">// occasional</span>
00187         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( player_school.chance_event_frequency == 1 ) {
00188             <span class="comment">// don't have two in a row within a year</span>
00189             <span class="keywordflow">if</span>( info.game_date &lt; any_task_last_happen_date+365 )
00190                 <span class="keywordflow">return</span>;
00191 
00192             <span class="keywordflow">if</span>( m.random(60) &gt; 0 )
00193                 <span class="keywordflow">return</span>;
00194         }
00195         <span class="comment">// frequent</span>
00196         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( player_school.chance_event_frequency == 2 ) {
00197             <span class="comment">// don't have two in a row within 100 days</span>
00198             <span class="keywordflow">if</span>( info.game_date &lt; any_task_last_happen_date+120 )
00199                 <span class="keywordflow">return</span>;
00200 
00201             <span class="keywordflow">if</span>( m.random(20) &gt; 0 )
00202                 <span class="keywordflow">return</span>;
00203         }
00204 
00205         <span class="comment">//-------- randomly pick an event --------//</span>
00206 
00207         eventId = m.random(<a class="code" href="Onews_8h.html#a51a34">NEWS_ID_COUNT_ONLY_CHANCE</a>);
00208 
00209         <span class="comment">// don't happen twice in 10 years</span>
00210         <span class="keywordflow">if</span>( event_last_happen_date[eventId] + 10*360 &gt; info.game_date )
00211             <span class="keywordflow">return</span>;
00212     }
00213 
00214     <span class="comment">//------------- run the event now -----------//</span>
00215 
00216     <span class="keywordtype">int</span> oldNewsSize = news_array.size();
00217 
00218     <a class="code" href="Ochance_8h.html#a0">EventFP</a> eventFP = news_event_function_array[eventId].<a class="code" href="structEventStruct.html#m0">event_func</a>;
00219 
00220     (*eventFP)();                                   <span class="comment">// run the event</span>
00221 
00222     chance_event.test_chance = 0;
00223 
00224     <span class="comment">//------- display the news -------//</span>
00225 
00226     <span class="keywordtype">int</span> newsSize = news_array.size();
00227 
00228     <span class="keywordflow">if</span>( newsSize &gt; oldNewsSize ) {
00229         sys.set_news_pop_up();
00230 
00231         <a class="code" href="structNews.html">News</a>* newsPtr = news_array[newsSize];
00232         news_str=newsPtr-&gt;<a class="code" href="structNews.html#a1">msg</a>();
00233 
00234         news_news_str=news_str;
00235 
00236         <span class="comment">// memcpy(news_date_str,date.date_str(newsPtr-&gt;news_date),55);</span>
00237         strncpy( news_date_str, info.date_str_julian(newsPtr-&gt;<a class="code" href="structNews.html#m4">news_date</a>), 55 );
00238         news_date_str[55-1] = <span class="charliteral">'\0'</span>;
00239         <span class="comment">// date_str=date.date_str( newsPtr-&gt;news_date, 1, 0 );</span>
00240         date_str=info.date_str_julian(newsPtr-&gt;<a class="code" href="structNews.html#m4">news_date</a>, <a class="code" href="Oinfo_8h.html#a114a96">INFO_DATE_DEFAULT</a>|<a class="code" href="Oinfo_8h.html#a114a92">INFO_DATE_SHORT_MONTH</a>|<a class="code" href="Oinfo_8h.html#a114a90">INFO_DATE_NO_DAY</a> );
00241 
00242         <span class="comment">//------- update last happen dates --------//</span>
00243 
00244         any_event_last_happen_date      = info.game_date;
00245         event_last_happen_date[eventId] = info.game_date;
00246     }
00247 }
00248 
00249 <span class="comment">//------ End of function ChanceEvent::process_chance_event -------//</span>
00250 
00251 <span class="comment">//------ Begin of function ChanceEvent::process_objective_event -------//</span>
00253 <span class="comment">void ChanceEvent::process_objective_event() {</span>
00254     <span class="keywordflow">if</span>( !task_array.can_add_more_task() )
00255         <span class="keywordflow">return</span>;
00256 
00257     <span class="comment">//------------ determine the chance based on the frequency setting ----//</span>
00258 
00259     <span class="comment">// if frequency is set to none</span>
00260     <span class="keywordflow">if</span>( player_school.chance_objective_frequency == 0 ) {
00261         <span class="keywordflow">return</span>;
00262     }
00263     <span class="comment">// occasional</span>
00264     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( player_school.chance_objective_frequency == 1 ) {
00265         <span class="comment">// don't have two in a row within a year</span>
00266         <span class="keywordflow">if</span>( info.game_date &lt; any_task_last_happen_date+365 )
00267             <span class="keywordflow">return</span>;
00268 
00269         <span class="keywordflow">if</span>( m.random(365) &gt; 0 )
00270             <span class="keywordflow">return</span>;
00271     }
00272     <span class="comment">// frequency</span>
00273     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( player_school.chance_objective_frequency == 2 ) {
00274         <span class="comment">// don't have two in a row within 100 days</span>
00275         <span class="keywordflow">if</span>( info.game_date &lt; any_task_last_happen_date+120 )
00276             <span class="keywordflow">return</span>;
00277 
00278         <span class="keywordflow">if</span>( m.random(120) &gt; 0 )
00279             <span class="keywordflow">return</span>;
00280     }
00281 
00282     <span class="comment">//------------ randomly choose an objective -------------//</span>
00283 
00284     <span class="keywordtype">int</span> taskId = m.random(<a class="code" href="OTASK_8H.html#a0">TASK_COUNT</a>);
00285 
00286     <span class="comment">// don't have same objective in 20 years</span>
00287     <span class="keywordflow">if</span>( task_last_happen_date[taskId] + 365*20 &gt; info.game_date )
00288         <span class="keywordflow">return</span>;
00289 
00290     <span class="comment">//------ run the task function now ---------//</span>
00291 
00292     <a class="code" href="Ochance_8h.html#a0">EventFP</a> eventFP = task_event_function_array[taskId];
00293 
00294     (*eventFP)();                                   <span class="comment">// ini the task; ASSUME the task is added</span>
00295 
00296     sys.set_news_pop_up();
00297     <a class="code" href="structTask.html">Task</a>* taskPtr = task_array[task_array.size()];
00298     news_str=taskPtr-&gt;<a class="code" href="structNews.html#a3">get_task_msg</a>();
00299     news_news_str=news_str;
00300 
00301     <span class="comment">// display in 200? format</span>
00302     <span class="keywordtype">int</span> thisDate = date.julian( date.year(taskPtr-&gt;<a class="code" href="structNews.html#m4">news_date</a>),
00303                                 date.month(taskPtr-&gt;<a class="code" href="structNews.html#m4">news_date</a>), date.day(taskPtr-&gt;<a class="code" href="structNews.html#m4">news_date</a>) );
00304 
00305     <span class="comment">// memcpy(news_date_str,date.date_str(thisDate),55);</span>
00306     strncpy( news_date_str, info.date_str_julian(thisDate), 55 );
00307     news_date_str[55-1] = <span class="charliteral">'\0'</span>;
00308     <span class="comment">// date_str=date.date_str(taskPtr-&gt;news_date,1,0);</span>
00309     date_str=info.date_str_julian(taskPtr-&gt;<a class="code" href="structNews.html#m4">news_date</a>, <a class="code" href="Oinfo_8h.html#a114a96">INFO_DATE_DEFAULT</a>|<a class="code" href="Oinfo_8h.html#a114a92">INFO_DATE_SHORT_MONTH</a>|<a class="code" href="Oinfo_8h.html#a114a90">INFO_DATE_NO_DAY</a>);
00310 
00311     <span class="comment">//------- update last happen dates --------//</span>
00312 
00313     any_task_last_happen_date   = info.game_date;
00314     task_last_happen_date[taskId] = info.game_date;
00315 
00316     <span class="keywordflow">return</span>;
00317 }
00318 
00319 <span class="comment">//------ End of function ChanceEvent::process_objective_event -------//</span>
00320 
00321 <span class="comment">//------ Begin of function ChanceEvent::update_chance_vars -------//</span>
00323 <span class="comment">void ChanceEvent::update_chance_vars() {</span>
00324     <span class="comment">//------ update minority student percentage falls counter ------//</span>
00325 
00326     <span class="keywordflow">if</span> ( info.game_day == 1 &amp;&amp; info.game_month == 10 ) {
00327         <span class="keywordtype">int</span> sum=0,sumLastYear=0;
00328 
00329         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;<a class="code" href="Ostudent_8h.html#a0">MAX_STUDENT_LEVEL</a>;i++) {
00330             sum += department_array.student_gender_history[i][HISTORY_YEAR_COUNT-1];
00331             sumLastYear += department_array.student_gender_history[i][HISTORY_YEAR_COUNT-2];
00332         }
00333 
00334         <span class="keywordtype">int</span> nonminorityCount=0,nonminorityCountLastYear=0;
00335         nonminorityCount += department_array.student_gender_history[<a class="code" href="Gamedef_8h.html#a75a27">NONMINORITY_MALE</a>][HISTORY_YEAR_COUNT-1];
00336         nonminorityCount += department_array.student_gender_history[<a class="code" href="Gamedef_8h.html#a75a28">NONMINORITY_FEMALE</a>][HISTORY_YEAR_COUNT-1];
00337         nonminorityCountLastYear += department_array.student_gender_history[<a class="code" href="Gamedef_8h.html#a75a27">NONMINORITY_MALE</a>][HISTORY_YEAR_COUNT-2];
00338         nonminorityCountLastYear += department_array.student_gender_history[<a class="code" href="Gamedef_8h.html#a75a28">NONMINORITY_FEMALE</a>][HISTORY_YEAR_COUNT-2];
00339 
00340         <span class="keywordtype">float</span> percentLastYear=((float)nonminorityCountLastYear)/sumLastYear;
00341         <span class="keywordtype">float</span> percent=((float)nonminorityCount)/sum;
00342 
00343         <span class="keywordflow">if</span>((percent-percentLastYear)&lt;0)
00344             minority_student_percentage_falls_consYrs++;
00345         <span class="keywordflow">else</span>
00346             minority_student_percentage_falls_consYrs=0;
00347     }
00348 
00349     <span class="comment">//----- reset variables at the beginning of a financial year ----//</span>
00350 
00351     <span class="keywordflow">if</span> ( info.game_day == 1 &amp;&amp; info.game_month == 9 ) {
00352         scandal_in_alt_drop_gift =0;                  <span class="comment">// the effect of this is lasting so we don't set it to negative to cancel the previous effect.</span>
00353 
00354         football_game_bonus = 0;
00355         basketball_game_bonus = 0;
00356 
00357         operating_reserve_modifier = 0;
00358 
00359         <span class="keywordflow">if</span>( gift_modifier &lt; 0 )
00360             gift_modifier = -gift_modifier / 2.0f;      <span class="comment">// recover 50% next year</span>
00361         <span class="keywordflow">else</span>
00362             gift_modifier = 0;                          <span class="comment">// diminish every year</span>
00363 
00364         gift_growth_rate_multiplier = 0;
00365     }
00366 }
00367 
00368 <span class="comment">//------ End of function ChanceEvent::update_chance_vars -------//</span>
00369 
00370 <span class="comment">//------ Begin of function ChanceEvent::process_individual_chance -------//</span>
00372 <span class="comment">void ChanceEvent::process_individual_chance() {</span>
00373     <span class="comment">//--------------- chance_event.profit_competition_act --------//</span>
00374 
00375     <span class="keywordflow">if</span>(chance_event.profit_competition_act == 1 ) {
00376         <span class="keywordflow">if</span>( chance_event.profit_competition_end_date &lt; info.game_date ) {
00377             <span class="comment">//unlock</span>
00378             <a class="code" href="structFinancePolicy.html">FinancePolicy</a> *policy;
00379             policy = finance.get_policy_var(1, 0);
00380             policy-&gt;<a class="code" href="structFinancePolicy.html#m4">required_flag</a> = <span class="keyword">false</span>;
00381             policy-&gt;<a class="code" href="structFinancePolicy.html#m6">applied_flag</a> = <a class="code" href="Ofinanc2_8h.html#a38a5">P_NONE</a>;
00382             policy-&gt;<a class="code" href="structFinancePolicy.html#m3">import_weight</a> = <a class="code" href="Ofinanc2_8h.html#a1">OPT_MID_WEIGHT</a>;
00383             policy-&gt;<a class="code" href="structFinancePolicy.html#m1">lower_bound</a> = policy-&gt;<a class="code" href="structFinancePolicy.html#m7">lower_limit</a>;
00384             policy-&gt;<a class="code" href="structFinancePolicy.html#m2">upper_bound</a> = policy-&gt;<a class="code" href="structFinancePolicy.html#m8">upper_limit</a>;
00385 
00386             sys.redraw_all_flag=1;
00387             chance_event.profit_competition_act = 0;
00388             chance_event.profit_competition_end_date = 0;
00389         }
00390 
00391         <span class="keywordflow">if</span>( chance_event.profit_competition_end_date &gt; info.game_date) {
00392             <span class="comment">//lock back after a new year</span>
00393             <a class="code" href="structFinancePolicy.html">FinancePolicy</a> *policy;
00394             policy = finance.get_policy_var(1, 0);
00395 
00396             <span class="keywordflow">if</span>(policy-&gt;<a class="code" href="structFinancePolicy.html#m4">required_flag</a> != <span class="keyword">true</span>) {         <span class="comment">// original: policy-&gt;required_flag = true, BUG FIXED in 2.0</span>
00397                 policy-&gt;<a class="code" href="structFinancePolicy.html#m4">required_flag</a> = <span class="keyword">true</span>;
00398                 policy-&gt;<a class="code" href="structFinancePolicy.html#m6">applied_flag</a> = <a class="code" href="Ofinanc2_8h.html#a38a8">P_IMPLEMENT</a>;
00399             }
00400         }
00401     }
00402 }
00403 
00404 <span class="comment">//------ End of function ChanceEvent::process_individual_chance -------//</span>
00405 
00406 <span class="comment">//------ Begin of function alumni_die -------//</span>
<a name="l00408"></a><a class="code" href="Ochance_8cpp.html#a33">00408</a> <span class="comment">void alumni_die() {</span>
00409     <span class="keywordflow">if</span>( m.random(25) &amp;&amp; !chance_event.test_chance ) <span class="comment">// odds: 25:1</span>
00410         <span class="keywordflow">return</span>;
00411 
00412     <span class="comment">// at least after 2 years for another instance</span>
00413     <span class="keywordflow">if</span>( info.financial_year() &lt;= chance_event.alumni_die_financial_year+1 )
00414         <span class="keywordflow">return</span>;
00415 
00416     <span class="comment">//---------- 1/3 gen random parameters --------//</span>
00417 
00418     <a class="code" href="ALL_8H.html#a0">err_when</a>( <a class="code" href="Gamedef_8h.html#a76a31">GENDER_MALE</a> != 0 );
00419 
00420     <span class="keywordtype">int</span> gender = m.random(2);
00421 
00422     <span class="comment">// $(000)</span>
00423     <span class="keywordtype">int</span> bequest = int( development_office.this_year.total * m.fmin(0.3f, math.get_random_snd(0.75f, 0.2f)));
00424 
00425     <span class="comment">//---------- 2/3 add news --------//</span>
00426 
00427     news_array.alumni_die(gender, bequest);
00428 
00429     <span class="comment">//---------- 3/3 action --------//</span>
00430 
00431     chance_event.alumni_die_gift += bequest;
00432     chance_event.alumni_die_financial_year = info.financial_year();
00433 
00434     <a class="code" href="ALL_8H.html#a0">err_when</a>(bequest&lt;0);
00435 }
00436 
00437 <span class="comment">//------ End of function alumni_die -------//</span>
00438 
00439 <span class="comment">//------ Begin of function rape_in_campus -------//</span>
<a name="l00441"></a><a class="code" href="Ochance_8cpp.html#a34">00441</a> <span class="comment">void rape_in_campus() {</span>
00442     <span class="comment">//---       Scale the odds to be 20:1 for administrative performance=100 and 2:1 for administrative performance=0. (The chance card text should say there have been multiple rapes - that this is a serious matter.)</span>
00443 
00444     <span class="keywordtype">int</span> oddsChance = (short) (2 + (18/100.0f) * player_school.administrative_performance );
00445 
00446     <span class="keywordflow">if</span>( m.random(oddsChance) &amp;&amp; !chance_event.test_chance )
00447         <span class="keywordflow">return</span>;
00448 
00449     <span class="comment">//---------- add news --------//</span>
00450 
00451     news_array.rape_in_campus();
00452 
00453     <span class="comment">//---       Loop through the SL1 student sims and reduce their student life satisfaction index ----//</span>
00454 
00455     <span class="keywordtype">int</span> i,j;
00456     <a class="code" href="classStudentArray.html">StudentArray</a>* stuArr;
00457     <a class="code" href="classStudent.html">Student</a> *stuPtr;
00458 
00459     <a class="code" href="ALL_8H.html#a0">err_when</a>( department_array.size() == 0 );
00460 
00461     <span class="keywordflow">for</span> ( i=department_array.size(); i&gt;=0; i-- ) {
00462         <span class="keywordflow">if</span> (i) {
00463             <span class="keywordflow">if</span> ( department_array.is_deleted(i) )
00464                 <span class="keywordflow">continue</span>;
00465 
00466             stuArr = &amp;(department_array[i]-&gt;student_array);
00467         }
00468         <span class="keywordflow">else</span> {
00469             stuArr = &amp;(department_res.general_dept.student_array);
00470         }
00471 
00472         sys.yield();
00473 
00474         <span class="comment">// loop student</span>
00475         <span class="keywordflow">for</span> (j=stuArr-&gt;<a class="code" href="classDynArray.html#a28">size</a>(); j&gt;0; j--) {
00476             <span class="keywordflow">if</span> ( stuArr-&gt;<a class="code" href="classStudentArray.html#a9">is_deleted</a>(j) )
00477                 <span class="keywordflow">continue</span>;
00478 
00479             stuPtr = stuArr-&gt;operator[](j);
00480 
00481             <span class="comment">//--- Min[80%,RandNormDev(60%,7%)] if Female ---//</span>
00482 
00483             <span class="keywordflow">if</span>( stuPtr-&gt;<a class="code" href="classStudent.html#m3">gender_ethnic_group</a> == <a class="code" href="Gamedef_8h.html#a75a28">NONMINORITY_FEMALE</a> ||
00484                 stuPtr-&gt;<a class="code" href="classStudent.html#m3">gender_ethnic_group</a> == <a class="code" href="Gamedef_8h.html#a75a30">MINORITY_FEMALE</a> ) {
00485                 stuPtr-&gt;<a class="code" href="classStudent.html#m24">satisfaction_student_life</a> = char( (<span class="keywordtype">float</span>) stuPtr-&gt;<a class="code" href="classStudent.html#m24">satisfaction_student_life</a> * m.fmin( 0.65f, math.get_random_snd(0.50f, 0.05f)));
00486             }
00487             <span class="keywordflow">else</span> {                                      <span class="comment">//--- Min[95%,RandNormDev(90%,2.5%)] if Male ---//</span>
00488                 stuPtr-&gt;<a class="code" href="classStudent.html#m24">satisfaction_student_life</a> = char( (<span class="keywordtype">float</span>) stuPtr-&gt;<a class="code" href="classStudent.html#m24">satisfaction_student_life</a> * m.fmin( 0.75f, math.get_random_snd(0.60f, 0.04f)));
00489             }
00490         }
00491     }
00492 
00493     <span class="comment">//--- Multiply current media attitudes and alumni morale by Min[95%,RandNormDev(90%,2.5%)] ---//</span>
00494 
00495     chance_event.extra_effect_media_att    = m.fmin(0.95f, math.get_random_snd(0.7f, 0.025f));
00496     chance_event.extra_effect_alumni_morale = m.fmin(0.95f, math.get_random_snd(0.7f, 0.025f));
00497 
00498     player_school.calc_media_attitudes();
00499     development_office.calc_alumni_morale();
00500 
00501     <span class="comment">//---       Multiply the current "Monthly campus crime index" by Min[110%,RandNormDev(130%,7%)] ---//</span>
00502 
00503     facility_office.crime_index[THIS_MONTH] = (char) int(facility_office.crime_index[THIS_MONTH] * m.fmax(1.10f, math.get_random_snd(1.3f, 0.07f)) );
00504 }
00505 
00506 <span class="comment">//------ End of function rape_in_campus -------//</span>
00507 
00508 <span class="comment">//------ Begin of function retrofit_facilities -------//</span>
<a name="l00510"></a><a class="code" href="Ochance_8cpp.html#a35">00510</a> <span class="comment">void retrofit_facilities() {</span>
00511     <span class="comment">//-- Odds: 25:1 [Please replace "elderly" by "physically challenged" in the Chance Card text.] ---//</span>
00512 
00513     <span class="keywordflow">if</span>( m.random(25) &amp;&amp; !chance_event.test_chance  )<span class="comment">// odds: 50:1</span>
00514         <span class="keywordflow">return</span>;
00515 
00516     <span class="comment">//---------- 1/3 gen random parameters --------//</span>
00517 
00518     <span class="keywordtype">int</span> dollarLost = int( finance.this_year.asset_array[<a class="code" href="Ofinance_8h.html#a97a23">AC_BUILDINGS</a>]
00519                           * m.fmin(0.1f, math.get_random_snd(0.04f, 0.01f)) );
00520 
00521     <span class="keywordflow">if</span>( dollarLost &lt;= 0 )
00522         <span class="keywordflow">return</span>;
00523 
00524     chance_event.operating_reserve_modifier = (float) -dollarLost;
00525     finance.this_year.asset_array[<a class="code" href="Ofinance_8h.html#a97a20">AC_OPERATING_RESERVE</a>] -= (float) dollarLost;
00526     finance.calc_asset_total();
00527 
00528     <span class="comment">//---------- 2/3 add news --------//</span>
00529 
00530     news_array.retrofit_facilities(dollarLost);
00531 }
00532 
00533 <span class="comment">//------ End of function retrofit_facilities -------//</span>
00534 
00535 <span class="comment">//------ Begin of function earth_quake -------//</span>
<a name="l00537"></a><a class="code" href="Ochance_8cpp.html#a36">00537</a> <span class="comment">void earth_quake() {</span>
00538     <span class="keywordflow">if</span>( m.random(50) &amp;&amp; !chance_event.test_chance  )<span class="comment">// odds: 50:1</span>
00539         <span class="keywordflow">return</span>;
00540 
00541     news_array.earth_quake();
00542 
00543     <span class="comment">//---- multiply the current square footage for each department by a uniformly distributed random variable between 60% and 100% ---//</span>
00544 
00545     <a class="code" href="structDepartmentInfo.html">DepartmentInfo</a> *deptInfo;
00546 
00547     <span class="keywordtype">int</span> deptCount = department_array.department_count;
00548 
00549     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;=deptCount; i++ ) {
00550         <span class="keywordflow">if</span> ( i )
00551             deptInfo  = (department_res.info_array+department_array[i]-&gt;department_id - 1);
00552         <span class="keywordflow">else</span>
00553             deptInfo = &amp;department_res.general_dept_info;
00554 
00555         deptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m19">actual_sf</a> = int(deptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m19">actual_sf</a> * ( 60 + m.random(41) ) / 100.0f );
00556     }
00557 }
00558 
00559 <span class="comment">//------ End of function earth_quake -------//</span>
00560 
00561 <span class="comment">//------ Begin of function congress_research -------//</span>
<a name="l00563"></a><a class="code" href="Ochance_8cpp.html#a37">00563</a> <span class="comment">void congress_research() {</span>
00564     <span class="keywordflow">if</span>( m.random(18) &amp;&amp; !chance_event.test_chance ) <span class="comment">// odds: 18:1</span>
00565         <span class="keywordflow">return</span>;
00566 
00567     <span class="comment">//---------- 1/3 gen random parameters --------//</span>
00568 
00569     <span class="keywordtype">char</span> dir = ( math.get_random_float() &gt; 0.4 ) ? -1 : 1;
00570 
00571     <span class="comment">//---------- 2/3 add news --------//</span>
00572 
00573     news_array.congress_research(dir);
00574 
00575     <span class="comment">//---------- 3/3 action --------//</span>
00576 
00577     chance_event.research_adjust_multiplier = 1 + dir * m.fmin(0.1f, math.get_random_snd(0.5f, 0.1f));
00578 }
00579 
00580 <span class="comment">//------ End of function congress_research -------//</span>
00581 
00582 <span class="comment">//------ Begin of function stock_market -------//</span>
<a name="l00584"></a><a class="code" href="Ochance_8cpp.html#a38">00584</a> <span class="comment">void stock_market() {</span>
00585     <span class="keywordflow">if</span>( m.random(15) &amp;&amp; !chance_event.test_chance ) <span class="comment">// odds: 15:1</span>
00586         <span class="keywordflow">return</span>;
00587 
00588     <span class="comment">//---------- 1/3 gen random parameters --------//</span>
00589 
00590     <span class="keywordtype">char</span> dir = ( math.get_random_float() &gt; 0.5 ) ? -1 : 1;
00591 
00592     chance_event.stock_dir = (int) dir;
00593 
00594     <span class="comment">//---------- 2/3 add news --------//</span>
00595 
00596     news_array.stock_market(dir);
00597 
00598     <span class="comment">//---------- 3/3 action --------//</span>
00599 
00600     <span class="comment">// do the action in oinve_st.cpp</span>
00601     <span class="comment">//  investment_office.s_n_p_history[THIS_MONTH] *= 1 + dir * max(0.04f, math.get_random_snd(0.16f, 0.04f));</span>
00602 
00603 }
00604 
00605 <span class="comment">//------ End of function stock_market -------//</span>
00606 
00607 <span class="comment">//------ Begin of function scandalous_fund_use -------//</span>
<a name="l00609"></a><a class="code" href="Ochance_8cpp.html#a39">00609</a> <span class="comment">void scandalous_fund_use() {</span>
00610     <span class="keywordtype">int</span> oddsChance = (short) (1 + (29/100.0f) * player_school.administrative_performance );
00611 
00612     <span class="keywordflow">if</span>( m.random(oddsChance) &amp;&amp; !chance_event.test_chance )
00613         <span class="keywordflow">return</span>;
00614 
00615     <span class="comment">//-- reduce the operating reserve by: ---//</span>
00616 
00617     <span class="keywordtype">float</span> t = math.get_random_snd(2.0f, 0.5f);
00618 
00619     <span class="keywordtype">int</span> dollarLost = int( 1000.0f * max(0.4f, t) );
00620 
00621     chance_event.operating_reserve_modifier = (float) -dollarLost;
00622     finance.this_year.asset_array[<a class="code" href="Ofinance_8h.html#a97a20">AC_OPERATING_RESERVE</a>] -= (float) dollarLost;
00623     finance.calc_asset_total();
00624 
00625     <span class="comment">//------ multiply the current level of gifts by -----//</span>
00626 
00627     chance_event.gift_modifier = development_office.this_year.total * -(1.0f - math.get_random_snd(0.667f,0.05f));
00628 
00629     development_office.this_year.total += chance_event.gift_modifier;
00630     development_office.gift_change_next_year = (float)finance.calc_change(development_office.gift_total_next_year, development_office.this_year.total);
00631 
00632     <span class="comment">//------------ show news ---------------//</span>
00633 
00634     news_array.scandalous_fund_use(dollarLost);
00635 
00636     <span class="comment">//------  change staff morale, alumni morale and media attitudes  -----//</span>
00637 
00638     chance_event.extra_effect_staff_morale  = m.fmin(0.95f, math.get_random_snd(0.7f, 0.05f));
00639 
00640     chance_event.extra_effect_media_att    = m.fmin(0.97f, math.get_random_snd(0.7f, 0.03f));
00641     chance_event.extra_effect_alumni_morale = m.fmin(0.97f, math.get_random_snd(0.7f, 0.03f));
00642 
00643     player_school.calc_staff_morale();              <span class="comment">// update the values now</span>
00644     player_school.calc_media_attitudes();
00645     development_office.calc_alumni_morale();
00646 }
00647 
00648 <span class="comment">//------ End of function scandalous_fund_use -------//</span>
00649 
00650 <span class="comment">//------ Begin of function new_governor -------//</span>
<a name="l00652"></a><a class="code" href="Ochance_8cpp.html#a40">00652</a> <span class="comment">void new_governor() {</span>
00653     <span class="keywordflow">if</span>( !player_school.is_public() )
00654         <span class="keywordflow">return</span>;
00655 
00656     <span class="keywordflow">if</span>( m.random(12) &amp;&amp; !chance_event.test_chance ) <span class="comment">// odds: 12:1</span>
00657         <span class="keywordflow">return</span>;
00658 
00659     <span class="comment">//---------- 1/3 gen random parameters --------//</span>
00660 
00661     <span class="keywordtype">char</span> dir = (float) ( math.get_random_float() &gt; 0.33 ) ? -1 : 1;
00662 
00663     <span class="comment">//---------- 2/3 add news --------//</span>
00664 
00665     news_array.new_governor(dir);
00666 
00667     <span class="comment">//---------- 3/3 action --------//</span>
00668 
00669     <span class="keywordtype">float</span> change = (float) finance.budget_revenue_array[<a class="code" href="Ofinance_8h.html#a101a41">AC_STATE_APPROPRIATION</a>].total *
00670         (float) dir * m.fmin(0.5f, math.get_random_snd(0.13f, 0.05f));
00671 
00672     finance.budget_revenue_array[<a class="code" href="Ofinance_8h.html#a101a41">AC_STATE_APPROPRIATION</a>].total += change;
00673     finance.projected_revenue_array[<a class="code" href="Ofinance_8h.html#a101a41">AC_STATE_APPROPRIATION</a>].this_year.total += change;
00674 
00675     finance.budget_calc_total();
00676     finance.budget_calc_percent();
00677     finance.budget_calc_change();
00678 
00679     finance.calc_projected_total_n_percent(1);      <span class="comment">// 1-recalculate</span>
00680 }
00681 
00682 <span class="comment">//------ End of function new_governor -------//</span>
00683 
00684 <span class="comment">//------ Begin of function court_limit_minority -------//</span>
<a name="l00686"></a><a class="code" href="Ochance_8cpp.html#a41">00686</a> <span class="comment">void court_limit_minority() {</span>
00687     <span class="keywordflow">if</span>( m.random(20) &amp;&amp; !chance_event.test_chance ) <span class="comment">// odds: 20:1</span>
00688         <span class="keywordflow">return</span>;
00689 
00690     <span class="comment">//---------- 2/3 add news --------//</span>
00691 
00692     news_array.court_limit_minority();
00693 
00694     <span class="comment">//---------- 3/3 action --------//</span>
00695     <span class="comment">// to lock out "high" for these two buttons Aand set them to none.</span>
00696 
00697     enroll_res.minority_offers_special = <a class="code" href="Oenroll_8h.html#a35a27">SET_LOW</a>;
00698     enroll_res.minority_aid_special = <a class="code" href="Oenroll_8h.html#a35a27">SET_LOW</a>;
00699 
00700     chance_event.court_limit_minority_flag = 1;
00701 
00702     sys.redraw_all_flag=1;
00703 }
00704 
00705 <span class="comment">//------ End of function court_limit_minority -------//</span>
00706 
00707 <span class="comment">//------ Begin of function risky_research-------//</span>
00708 
<a name="l00709"></a><a class="code" href="Ochance_8cpp.html#a42">00709</a> <span class="keywordtype">void</span> <a class="code" href="Ochance_8cpp.html#a42">risky_research</a>() {
00710     <span class="comment">//--- get the department with the highest research performance ---//</span>
00711 
00712     <span class="keywordtype">short</span> fieldList[] = { <a class="code" href="OFIELD_8H.html#a29a17">FIELD_APPLIED_SCIENCE</a>, <a class="code" href="OFIELD_8H.html#a29a20">FIELD_ENGINEERING</a>, <a class="code" href="OFIELD_8H.html#a29a23">FIELD_MATH_AND_COMPUTER_SCIENCE</a>, <a class="code" href="OFIELD_8H.html#a29a24">FIELD_NATURAL_SCIENCE</a>, 0 };
00713 
00714     <span class="keywordtype">float</span> bestPrefResearch;
00715     <span class="keywordtype">int</span> bestDeptRecno, bestFacultyRecno;
00716 
00717     get_best_research_dept( bestPrefResearch, bestDeptRecno, bestFacultyRecno, fieldList );
00718 
00719     <span class="comment">//--- Odds: pick the science, engineering, or agriculture department with the highest research performance; scale the odds to be 20:1 for research performance=100 and 90:1 for research performance=0. The text should say which department is chosen (note that we no longer refer specifically to genetic research).</span>
00720 
00721     <span class="comment">// fix in version 2, bestDeptRecno may be zero</span>
00722     <span class="keywordflow">if</span>( !bestDeptRecno || m.random( <span class="keywordtype">int</span>(20 + 80 * (100-bestPrefResearch) / 100) ) &amp;&amp; !chance_event.test_chance )
00723         <span class="keywordflow">return</span>;
00724 
00725     <span class="comment">//---       Reduce the operating reserve by Min[$1.0million,RandNormDev($2.0million,$0.25million)]. ---//</span>
00726 
00727     <span class="keywordtype">int</span> moneyLost = int(1000* m.fmin(1.00f, math.get_random_snd(2.00f, 0.25f)));
00728 
00729     chance_event.operating_reserve_modifier = (float) -moneyLost;
00730     finance.this_year.asset_array[<a class="code" href="Ofinance_8h.html#a97a20">AC_OPERATING_RESERVE</a>] -= (float) moneyLost;
00731     finance.calc_asset_total();
00732 
00733     <span class="comment">//----------- add the news ----------//</span>
00734 
00735     news_array.risky_research(moneyLost);
00736 
00738 
00739     <a class="code" href="classFacultyArray.html">FacultyArray</a>* facultyArray = &amp;department_array[bestDeptRecno]-&gt;faculty_array;
00740 
00741     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=facultyArray-&gt;<a class="code" href="classDynArray.html#a28">size</a>() ; i&gt;0 ; i-- ) {
00742         <span class="keywordflow">if</span>( facultyArray-&gt;<a class="code" href="classFacultyArray.html#a10">is_deleted</a>(i) )
00743             <span class="keywordflow">continue</span>;
00744 
00745         <a class="code" href="classFaculty.html">Faculty</a>* facultyPtr = facultyArray-&gt;operator[](i);
00746 
00747         facultyPtr-&gt;<a class="code" href="classFaculty.html#m37">extra_effect_satisfaction_index</a> = m.fmin( 1.00f, math.get_random_snd(0.85f, 0.05f) );
00748         facultyPtr-&gt;<a class="code" href="classFaculty.html#a20">calc_satisfaction_index</a>();
00749     }
00750 
00751     <span class="comment">//------  change staff morale, alumni morale and media attitudes  -----//</span>
00752 
00753     chance_event.extra_effect_media_att    = m.fmin(1.0f, math.get_random_snd(0.75f, 0.05f) );
00754     chance_event.extra_effect_alumni_morale = m.fmin(1.0f, math.get_random_snd(0.75f, 0.05f) );
00755 
00756     player_school.calc_media_attitudes();
00757     development_office.calc_alumni_morale();
00758 }
00759 
00760 <span class="comment">//------ End of function risky_research -------//</span>
00761 
00762 <span class="comment">//------ Begin of function scandal_in_athletics-------//</span>
00763 
<a name="l00764"></a><a class="code" href="Ochance_8cpp.html#a43">00764</a> <span class="keywordtype">void</span> <a class="code" href="Ochance_8cpp.html#a43">scandal_in_athletics</a>() {
00765     <span class="comment">//-----     Odds are 25:1 if athletics level of competition is 1; 50:1 if 2; and 75:1 if level of competition is 3.---//</span>
00766 
00767     <span class="keywordflow">if</span>( !chance_event.test_chance ) {
00768         <span class="keywordtype">int</span> oddsChance[] = { 25, 50, 75 };
00769 
00770         <span class="keywordflow">if</span>( m.random(oddsChance[athletics_office.ncaa_level_input-1]) &gt; 0 )
00771             <span class="keywordflow">return</span>;
00772     }
00773 
00774     <span class="comment">//---------- display news --------//</span>
00775 
00776     news_array.scandal_in_athletics();
00777 
00778     <span class="comment">//---       Convert "Special treatment for athletes" in admissions and financial aid to "no special treatment" for the next three admissions cycles. -----//</span>
00779 
00780     enroll_res.athlete_offers_special=<a class="code" href="Oenroll_8h.html#a35a27">SET_LOW</a>;      <span class="comment">//set to none</span>
00781     enroll_res.athlete_aid_special=<a class="code" href="Oenroll_8h.html#a35a27">SET_LOW</a>;         <span class="comment">//set to none</span>
00782     chance_event.athlete_special_ban_year=3;        <span class="comment">//set a chance flag for interface</span>
00783     sys.redraw_all_flag=1;
00784 
00785     <span class="comment">//---- Loop through the sims for SL1. For each top athlete (athletic talent &gt; _), force immediate dropout with probability = 0.5. ---//</span>
00786 
00787     <span class="keywordtype">int</span> i,j;
00788     <a class="code" href="classStudentArray.html">StudentArray</a>* stuArr;
00789     <a class="code" href="classStudent.html">Student</a> *stuPtr;
00790     <span class="keywordtype">char</span> sl;
00791 
00792     <a class="code" href="ALL_8H.html#a0">err_when</a>( department_array.size() == 0 );
00793 
00794     <span class="keywordflow">for</span> ( i=department_array.size(); i&gt;=0; i-- ) {
00795         <span class="keywordflow">if</span> (i) {
00796             <span class="keywordflow">if</span> ( department_array.is_deleted(i) )
00797                 <span class="keywordflow">continue</span>;
00798 
00799             stuArr = &amp;(department_array[i]-&gt;student_array);
00800         }
00801         <span class="keywordflow">else</span> {
00802             stuArr = &amp;(department_res.general_dept.student_array);
00803         }
00804 
00805         <span class="comment">// loop student</span>
00806         <span class="keywordflow">for</span> (j=stuArr-&gt;<a class="code" href="classDynArray.html#a28">size</a>(); j&gt;0; j--) {
00807             <span class="keywordflow">if</span> ( stuArr-&gt;<a class="code" href="classStudentArray.html#a9">is_deleted</a>(j) )
00808                 <span class="keywordflow">continue</span>;
00809 
00810             sys.yield();
00811 
00812             stuPtr = stuArr-&gt;operator[](j);
00813 
00814             sl = stuPtr-&gt;<a class="code" href="classStudent.html#m2">student_level</a>;
00815 
00816             <span class="keywordflow">if</span> (sl==<a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>) {
00817                 <span class="keywordtype">char</span> check = stuPtr-&gt;<a class="code" href="classStudent.html#m22">talent_athletics</a>;
00818 
00819                 <span class="keywordflow">if</span> (check&gt;60) {
00820                     <span class="comment">//----- remove the student from student_array -----//</span>
00821 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00822 <span class="preprocessor"></span>                    <span class="keyword">const</span> <span class="keywordtype">char</span> level2Degree[] = {<a class="code" href="Ostudent_8h.html#a33a9">BACHELOR_DEGREE</a>, <a class="code" href="Ostudent_8h.html#a33a9">BACHELOR_DEGREE</a>, <a class="code" href="Ostudent_8h.html#a33a10">MASTER_DEGREE</a>, <a class="code" href="Ostudent_8h.html#a33a11">DOCTOR_DEGREE</a>, -1};
00823 <span class="preprocessor">#else</span>
00824 <span class="preprocessor"></span>                    <span class="keyword">const</span> <span class="keywordtype">char</span> level2Degree[] = {<a class="code" href="Ostudent_8h.html#a33a9">BACHELOR_DEGREE</a>, <a class="code" href="Ostudent_8h.html#a33a9">BACHELOR_DEGREE</a>, <a class="code" href="Ostudent_8h.html#a33a10">MASTER_DEGREE</a>, <a class="code" href="Ostudent_8h.html#a33a11">DOCTOR_DEGREE</a>, <a class="code" href="Ostudent_8h.html#a33a9">BACHELOR_DEGREE</a>};
00825 <span class="preprocessor">#endif</span>
00826 <span class="preprocessor"></span>
00827                     <span class="keywordflow">if</span> ( level2Degree[stuPtr-&gt;<a class="code" href="classStudent.html#m2">student_level</a>] &gt;=0 ) {
00828 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00829 <span class="preprocessor"></span>                        stuArr-&gt;last_year_dropout[stuPtr-&gt;<a class="code" href="classStudent.html#m2">student_level</a>]++;
00830 <span class="preprocessor">#endif</span>
00831 <span class="preprocessor"></span>                        stuArr-&gt;<a class="code" href="classStudentArray.html#m18">cur_dropout</a>[level2Degree[stuPtr-&gt;<a class="code" href="classStudent.html#m2">student_level</a>]]++;
00832                     }
00833 
00834                     stuArr-&gt;<a class="code" href="classStudentArray.html#a5">del</a>(stuPtr-&gt;<a class="code" href="classStudent.html#m0">student_recno</a>);
00835                 }
00836             }
00837         }
00838     }
00839 
00840     <span class="comment">//--- Multiply the current level of gifts by Min[95%,RandNormDev(80%,5%)]. The change takes effect in the next game month and carries over as the prior value for the following month in the usual way. (This procedure applies wherever the current value of a variable is adjusted.) //</span>
00841 
00842     <span class="keywordtype">int</span> aidDrop = int( development_office.this_year.total *
00843                        (1 - m.fmin(0.85f, math.get_random_snd(0.70f, 0.05f)) ) );
00844 
00845     chance_event.scandal_in_alt_drop_gift += aidDrop;
00846 
00847     <span class="comment">//------  change alumni morale and media attitudes  -----//</span>
00848 
00849     chance_event.extra_effect_media_att    = m.fmin(0.90f, math.get_random_snd(0.7f, 0.025f) );
00850     chance_event.extra_effect_alumni_morale = m.fmin(0.90f, math.get_random_snd(0.7f, 0.025f) );
00851 
00852     player_school.calc_media_attitudes();
00853     development_office.calc_alumni_morale();
00854 }
00855 
00856 <span class="comment">//------ End of function scandal_in_athletics -------//</span>
00857 
00858 <span class="comment">//------ Begin of function plagiarism_scandal -------//</span>
00859 
<a name="l00860"></a><a class="code" href="Ochance_8cpp.html#a44">00860</a> <span class="keywordtype">void</span> <a class="code" href="Ochance_8cpp.html#a44">plagiarism_scandal</a>() {
00861     <span class="comment">//------- odds: 20: 1 --------//</span>
00862 
00863     <span class="keywordflow">if</span>( m.random(20) &amp;&amp; !chance_event.test_chance )
00864         <span class="keywordflow">return</span>;
00865 
00866     <span class="comment">//-- Randomly select and dismiss "n" student sims (regardless of student level), effective immediately, where n = Min[20,RandNormDev(100,25)] --//</span>
00867     <span class="comment">//--------------------------------//</span>
00868 
00869     <a class="code" href="classStudentArray.html">StudentArray</a>* stuArr;
00870     <a class="code" href="classStudent.html">Student</a> *stuPtr;
00871     chance_event.plagiarism_scandal_n=0;
00872 
00873     <span class="keywordtype">int</span> n= (int)m.fmax(20.0f,math.get_random_snd(100.0f, 25.0f));
00874 
00875     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0,timeout=0;(i&lt;n)&amp;&amp;(timeout&lt;n*10);i++,timeout++) {
00876         <span class="keywordtype">int</span> j=m.random(department_array.size())+1;
00877 
00878         <span class="keywordflow">if</span> ( department_array.is_deleted(j) ) {
00879             i--;
00880             <span class="keywordflow">continue</span>;
00881         }
00882 
00883         <span class="keywordflow">if</span>(department_array.size()!=0)
00884             stuArr = &amp;(department_array[j]-&gt;student_array);
00885         <span class="keywordflow">else</span>
00886             stuArr = &amp;(department_res.general_dept.student_array);
00887 
00888         <span class="keywordtype">int</span> k=m.random(stuArr-&gt;<a class="code" href="classDynArray.html#a28">size</a>())+1;
00889 
00890         <span class="keywordflow">if</span> (stuArr-&gt;<a class="code" href="classStudentArray.html#a9">is_deleted</a>(k)) {
00891             i--;
00892             <span class="keywordflow">continue</span>;
00893         }
00894         stuArr-&gt;<a class="code" href="classStudentArray.html#a5">del</a>(k);
00895         chance_event.plagiarism_scandal_n++;
00896     }
00897 
00898     <span class="comment">//---------- add news --------//</span>
00899 
00900     news_array.plagiarism_scandal(chance_event.plagiarism_scandal_n);
00901 
00902     <span class="comment">//---       Multiply the "Academic satisfaction index" for all remaining student sims by Min[95%,RandNormDev(80%,5%)].---//</span>
00903 
00904     <a class="code" href="ALL_8H.html#a0">err_when</a>( department_array.size() == 0 );
00905 
00906     <span class="keywordflow">for</span> (i=department_array.size(); i&gt;=0; i-- ) {
00907         <span class="keywordflow">if</span> (i) {
00908             <span class="keywordflow">if</span> ( department_array.is_deleted(i) )
00909                 <span class="keywordflow">continue</span>;
00910 
00911             stuArr = &amp;(department_array[i]-&gt;student_array);
00912         }
00913         <span class="keywordflow">else</span>
00914             stuArr = &amp;(department_res.general_dept.student_array);
00915 
00916         <span class="comment">// loop student</span>
00917         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=stuArr-&gt;<a class="code" href="classDynArray.html#a28">size</a>(); j&gt;0; j--) {
00918             <span class="keywordflow">if</span> ( stuArr-&gt;<a class="code" href="classStudentArray.html#a9">is_deleted</a>(j) )
00919                 <span class="keywordflow">continue</span>;
00920 
00921             sys.yield();
00922 
00923             stuPtr = stuArr-&gt;operator[](j);
00924 
00925             stuPtr-&gt;<a class="code" href="classStudent.html#m32">extra_effect_satisfaction_academic</a> = m.fmin(0.95f,math.get_random_snd(0.8f, 0.05f));
00926             stuPtr-&gt;<a class="code" href="classStudent.html#a10">calc_satisfaction_academic</a>();
00927         }
00928     }
00929 
00930     <span class="comment">//---- Multiply current media attitudes and alumni morale by Min[97%,RandNormDev(90%,3%)] ---//</span>
00931 
00932     chance_event.extra_effect_media_att    = m.fmin(0.97f, math.get_random_snd(0.7f, 0.03f) );
00933     chance_event.extra_effect_alumni_morale = m.fmin(0.97f, math.get_random_snd(0.7f, 0.03f) );
00934 
00935     player_school.calc_media_attitudes();
00936     development_office.calc_alumni_morale();
00937 
00938     <span class="comment">//-------- Update History ----------//</span>
00939 
00940     <a class="code" href="classDepartment.html">Department</a>* deptPtr;
00941 
00942     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;<a class="code" href="Ofaculty_8h.html#a30a22">FACULTY_RANK_LEVEL_COUNT_N_TOTAL</a>; j++)
00943         department_array.faculty_level_history[j][THIS_YEAR] =0;
00944 
00945     <span class="keywordflow">for</span> (j=0;j&lt;<a class="code" href="Ostudent_8h.html#a34a12">MAX_STUDENT_LEVEL_N_TOTAL</a>; j++)
00946         department_array.student_level_history[j][THIS_YEAR] =0;
00947 
00948     <span class="keywordflow">for</span> (j=0;j&lt;<a class="code" href="Gamedef_8h.html#a77a33">GENDER_ETHNIC_TYPE_COUNT_N_TOTAL</a>; j++) {
00949         department_array.faculty_gender_history[j][THIS_YEAR] =0;
00950         department_array.student_gender_history[j][THIS_YEAR] =0;
00951     }
00952 
00953     <span class="keywordflow">for</span> ( i=department_array.size(); i&gt;0; i-- ) {
00954         <span class="keywordflow">if</span> ( department_array.is_deleted(i) )
00955             <span class="keywordflow">continue</span>;
00956 
00957         deptPtr = department_array[i];
00958 
00959         deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#a6">calc_student_history</a>();
00960 
00961         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;<a class="code" href="Ofaculty_8h.html#a30a22">FACULTY_RANK_LEVEL_COUNT_N_TOTAL</a>; j++)
00962             department_array.faculty_level_history[j][THIS_YEAR] += deptPtr-&gt;<a class="code" href="classDepartment.html#m64">faculty_level_history</a>[j][THIS_YEAR];
00963 
00964         <span class="keywordflow">for</span> (j=0;j&lt;<a class="code" href="Ostudent_8h.html#a34a12">MAX_STUDENT_LEVEL_N_TOTAL</a>; j++)
00965             department_array.student_level_history[j][THIS_YEAR] += deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m5">student_level_history</a>[j][THIS_YEAR];
00966 
00967         <span class="keywordflow">for</span> (j=0;j&lt;<a class="code" href="Gamedef_8h.html#a77a33">GENDER_ETHNIC_TYPE_COUNT_N_TOTAL</a>; j++) {
00968             department_array.faculty_gender_history[j][THIS_YEAR] += deptPtr-&gt;<a class="code" href="classDepartment.html#m65">faculty_gender_history</a>[j][THIS_YEAR];
00969             department_array.student_gender_history[j][THIS_YEAR] += deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m6">student_gender_history</a>[j][THIS_YEAR];
00970         }
00971         sys.yield();
00972     }
00973 
00974     <span class="comment">//------ multiply the current level of gifts by -----//</span>
00975 
00976     chance_event.gift_modifier = development_office.this_year.total * -(1.0f - math.get_random_snd(0.667f,0.05f));
00977 
00978     development_office.this_year.total += chance_event.gift_modifier;
00979     development_office.gift_change_next_year = (float)finance.calc_change(development_office.gift_total_next_year, development_office.this_year.total);
00980 }
00981 
00982 <span class="comment">//------ End of function scandal_in_athletics -------//</span>
00983 
00984 <span class="comment">//------ Begin of for_profit_competition -------//</span>
<a name="l00985"></a><a class="code" href="Ochance_8cpp.html#a45">00985</a> <span class="keywordtype">void</span> <a class="code" href="Ochance_8cpp.html#a45">for_profit_competition</a>() {
00986     <span class="comment">//-- Scale the odds to be 15:1 for institutional prestige=100 and 1:1 for institutional prestige =0. ---//</span>
00987 
00988     <span class="keywordtype">int</span> oddsChance = (short) (1 + (14/100.0f) * player_school.prestige );
00989 
00990     <span class="keywordflow">if</span>( m.random(oddsChance) &amp;&amp; !chance_event.test_chance )
00991         <span class="keywordflow">return</span>;
00992 
00993     <span class="comment">//--        Choose a student level at random: Pr[SL1]=30%; Pr[SL2]=50%; Pr[SL3]=20%. (The choice should show up in the Chance Card text.) ---//</span>
00994 
00995     <span class="keywordtype">int</span> a_random_student_level;
00996     <span class="keywordtype">int</span> prob;
00997 
00998     prob=m.random(100);
00999     <span class="keywordflow">if</span>(prob&lt;30)
01000         a_random_student_level=<a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>;
01001     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(prob&lt;80)
01002         a_random_student_level=<a class="code" href="Ostudent_8h.html#a32a4">UG_NONTRADITION</a>;
01003     <span class="keywordflow">else</span>
01004         a_random_student_level=<a class="code" href="Ostudent_8h.html#a32a5">MASTER</a>;
01005 
01006     <span class="comment">//--- Multiply the applications preference multiplier variable (e.g., as used in Equation 1 of Td_3.4 for SL1) for the chosen SL by Min[105%,RandNormDev(115%,4%)]. ---//</span>
01007 
01008     <span class="comment">//--- Multiply the yield preference variable (e.g., as used in Equation 4 of Td_3.4 for SL1) for the chosen SL by Min[110%,RandNormDev(125%,5%)]. ---//</span>
01009 
01010     enroll_res.app_multiplier[a_random_student_level]*=m.fmin(1.05f,math.get_random_snd(1.15f, 0.04f));
01011     enroll_res.yield_multiplier[a_random_student_level]*=m.fmin(1.10f,math.get_random_snd(1.25f, 0.05f));
01012 
01013     chance_event.yield_for_profit_competition=enroll_res.yield_multiplier[a_random_student_level];
01014 
01015     enroll_res.update_enroll_history(1<span class="comment">/*no shift*/</span>); <span class="comment">// chwg0621  added a noshift flag. </span>
01016 
01017     <span class="comment">//---------- add news --------//</span>
01018 
01019     news_array.for_profit_competition();
01020 
01021     <span class="comment">//------- after effects -------//</span>
01022 
01023     chance_event.profit_competition_end_date = info.game_date + (365*3);
01024 
01025     <a class="code" href="structFinancePolicy.html">FinancePolicy</a> *policy;
01026     policy = finance.get_policy_var(1, 0);
01027     policy-&gt;<a class="code" href="structFinancePolicy.html#m4">required_flag</a> = <span class="keyword">true</span>;
01028     policy-&gt;<a class="code" href="structFinancePolicy.html#m6">applied_flag</a> = <a class="code" href="Ofinanc2_8h.html#a38a8">P_IMPLEMENT</a>;
01029 
01030     chance_event.profit_competition_act = 1;    <span class="comment">//## chea 091199 4 chance only</span>
01031 
01032     sys.redraw_all_flag=1;
01033 }
01034 <span class="comment">//------ End of function for_profit_competition -------//</span>
01035 
01036 
01037 <span class="comment">//------ Begin of minority_student_percentage_falls -------//</span>
01038 
<a name="l01039"></a><a class="code" href="Ochance_8cpp.html#a46">01039</a> <span class="keywordtype">void</span> <a class="code" href="Ochance_8cpp.html#a46">minority_student_percentage_falls</a>()
01040 {
01041     <span class="comment">// comment out because we have difficulties in modifying current applications and current yield rate. </span>
01042 <span class="comment">/*</span>
01043 <span class="comment">  //-------- odds: 20: 1 ----------//</span>
01044 <span class="comment"></span>
01045 <span class="comment">  if( m.random(20) &amp;&amp; !chance_event.test_chance )</span>
01046 <span class="comment">  return;</span>
01047 <span class="comment"></span>
01048 <span class="comment">        //---  Loop through the SL1 student sims. For each sim multiply the current student life satisfaction index by: ---//</span>
01049 <span class="comment"></span>
01050 <span class="comment">        int i,j;</span>
01051 <span class="comment">        StudentArray* stuArr;</span>
01052 <span class="comment">        Student *stuPtr;</span>
01053 <span class="comment">        char sl;</span>
01054 <span class="comment">        </span>
01055 <span class="comment">        err_when( department_array.size() == 0 );</span>
01056 <span class="comment">        </span>
01057 <span class="comment">        for ( i=department_array.size(); i&gt;=0; i-- )</span>
01058 <span class="comment">        {</span>
01059 <span class="comment">        if (i)</span>
01060 <span class="comment">        {</span>
01061 <span class="comment">        if ( department_array.is_deleted(i) )</span>
01062 <span class="comment">        continue;</span>
01063 <span class="comment"></span>
01064 <span class="comment">        stuArr = &amp;(department_array[i]-&gt;student_array);</span>
01065 <span class="comment">        }</span>
01066 <span class="comment">        else</span>
01067 <span class="comment">        stuArr = &amp;(department_res.general_dept.student_array);</span>
01068 <span class="comment"></span>
01069 <span class="comment">        // loop student</span>
01070 <span class="comment">        for (j=stuArr-&gt;size(); j&gt;0; j--)</span>
01071 <span class="comment">        {</span>
01072 <span class="comment">        if ( stuArr-&gt;is_deleted(j) )</span>
01073 <span class="comment">        continue;</span>
01074 <span class="comment"></span>
01075 <span class="comment">        sys.yield();</span>
01076 <span class="comment"></span>
01077 <span class="comment">        stuPtr = stuArr-&gt;operator[](j);</span>
01078 <span class="comment"></span>
01079 <span class="comment">        sl = stuPtr-&gt;gender_ethnic_group;</span>
01080 <span class="comment"></span>
01081 <span class="comment">        if(stuPtr-&gt;satisfaction_student_life!=-1)</span>
01082 <span class="comment">        {</span>
01083 <span class="comment">        if((sl==MINORITY_MALE)||(sl==MINORITY_FEMALE))</span>
01084 <span class="comment">        stuPtr-&gt;satisfaction_student_life=(char)(((float)chance_event.minority_student_percentage_falls_consYrs*min(0.98f, math.get_random_snd(0.04f, 0.005f)))*stuPtr-&gt;satisfaction_student_life);</span>
01085 <span class="comment">        else if((sl==NONMINORITY_MALE)||(sl==NONMINORITY_FEMALE))</span>
01086 <span class="comment">        stuPtr-&gt;satisfaction_student_life=(char)(((float)chance_event.minority_student_percentage_falls_consYrs*min(1.00f, math.get_random_snd(0.02f, 0.003f)))*stuPtr-&gt;satisfaction_student_life);</span>
01087 <span class="comment">        }                       </span>
01088 <span class="comment">        }       // end for j</span>
01089 <span class="comment">        }</span>
01090 <span class="comment"></span>
01091 <span class="comment">        //---- Multiply current media attitudes by ----//</span>
01092 <span class="comment"></span>
01093 <span class="comment">        chance_event.extra_effect_media_att              = min(0.97f, math.get_random_snd(0.9f, 0.03f)) );</span>
01094 <span class="comment">        chance_event.extra_effect_alumni_morale = min(0.97f, math.get_random_snd(0.9f, 0.03f)) );</span>
01095 <span class="comment"></span>
01096 <span class="comment">        player_school.calc_media_attitudes();</span>
01097 <span class="comment">        development_office.calc_alumni_morale();</span>
01098 <span class="comment"></span>
01099 <span class="comment">        //---------- add news --------//</span>
01100 <span class="comment"></span>
01101 <span class="comment">        news_array.minority_student_percentage_falls();</span>
01102 <span class="comment">*/</span>
01103 }
01104 <span class="comment">//------ End of minority_student_percentage_falls -------//</span>
01105 
01106 
01107 <span class="comment">//---------- Begin of successful_grad -------------//</span>
01108 
<a name="l01109"></a><a class="code" href="Ochance_8cpp.html#a47">01109</a> <span class="keywordtype">void</span> <a class="code" href="Ochance_8cpp.html#a47">successful_grad</a>()
01110 {
01111     <span class="comment">// comment out because we have difficulties in modifying current applications and current yield rate. </span>
01112 <span class="comment">/*</span>
01113 <span class="comment">  //-- Scale the odds to be 2:1 for institutional prestige=100 and 100:1 for institutional prestige =0. ----//</span>
01114 <span class="comment"></span>
01115 <span class="comment">  int oddsChance = (short) (1 + (99/100.0f) * player_school.prestige );</span>
01116 <span class="comment"></span>
01117 <span class="comment">  if( m.random(oddsChance) &amp;&amp; !chance_event.test_chance )</span>
01118 <span class="comment">  return;</span>
01119 <span class="comment"></span>
01120 <span class="comment">        //--- Multiply current institutional prestige by Min[105%,RandNormDev(115%,4%)]; truncate the result at 100. ---//</span>
01121 <span class="comment"></span>
01122 <span class="comment">        school_res.player_peer_school-&gt;prestige *= min(1.25f, math.get_random_snd(1.15f, 0.04f)) ;  //## chea 091199 try to higher th diff.</span>
01123 <span class="comment"></span>
01124 <span class="comment">        if(school_res.player_peer_school-&gt;prestige&gt;=100.0f)</span>
01125 <span class="comment">        school_res.player_peer_school-&gt;prestige = 100.0f;</span>
01126 <span class="comment"></span>
01127 <span class="comment">        //---   Multiply current media attitudes and alumni morale by Min[105%,RandNormDev(115%,4%)]; truncate the result at 100. ---//</span>
01128 <span class="comment"></span>
01129 <span class="comment">        chance_event.alumni_morale_rise++;   //## chea 091199 to ccount how many time should media_attitudes deduce</span>
01130 <span class="comment"></span>
01131 <span class="comment">        chance_event.media_att_count_up++;   //## chea 091199 to ccount how many time should media_attitudes increase</span>
01132 <span class="comment"></span>
01133 <span class="comment">        //----------- add news --------------//</span>
01134 <span class="comment"></span>
01135 <span class="comment">        news_array.successful_grad();</span>
01136 <span class="comment">*/</span>
01137 }
01138 <span class="comment">//------ End of successful_grad -------//</span>
01139 
01140 
01141 <span class="comment">//------ Begin of media_obtain_infomation -------//</span>
<a name="l01142"></a><a class="code" href="Ochance_8cpp.html#a48">01142</a> <span class="keywordtype">void</span> <a class="code" href="Ochance_8cpp.html#a48">media_obtain_information</a>()
01143 {
01144     <span class="comment">// comment out because we have difficulty in implementing many areas of it. </span>
01145 <span class="comment">/*</span>
01146 <span class="comment">  float deptResFr,instrExp,deptResExp,totResFr;</span>
01147 <span class="comment"></span>
01148 <span class="comment">  deptResFr=(float)department_array.discretionary_hour_array[DT_RESEARCH][HISTORY_TRIMESTER_COUNT-1]</span>
01149 <span class="comment">  /(department_array.discretionary_hour_array[DT_INSTITUTIONAL_AND_PUBLIC_SERVICE][HISTORY_TRIMESTER_COUNT-1]</span>
01150 <span class="comment">  -department_array.discretionary_hour_array[DISCRETIONARY_TYPE_COUNT_N_TOTAL][HISTORY_TRIMESTER_COUNT-1]);</span>
01151 <span class="comment"></span>
01152 <span class="comment">  instrExp=(float)((1.0f-deptResFr)*finance.expense_array[AC_ACADEMIC_DEPARTMENTS].total);</span>
01153 <span class="comment"></span>
01154 <span class="comment">  deptResExp=(float)(deptResFr*finance.expense_array[AC_ACADEMIC_DEPARTMENTS].total);</span>
01155 <span class="comment"></span>
01156 <span class="comment">  totResFr = (float)((deptResExp+finance.expense_array[AC_SPONSORED_RESEARCH_EXPENSE].total)</span>
01157 <span class="comment">  /(finance.expense_array[AC_ACADEMIC_DEPARTMENTS].total</span>
01158 <span class="comment">  +finance.expense_array[AC_SPONSORED_RESEARCH_EXPENSE].total));</span>
01159 <span class="comment"></span>
01160 <span class="comment">  chance_event.true_cost_education = instrExp + (1.0f-totResFr)*((float)finance.total_expense.total-(float)finance.expense_array[AC_SPONSORED_RESEARCH_EXPENSE].total-(float)finance.expense_array[AC_ACADEMIC_DEPARTMENTS].total);</span>
01161 <span class="comment"></span>
01162 <span class="comment">  chance_event.media_att_count_down++;   //## chea 091199 to ccount how many time should media_attitudes deduce</span>
01163 <span class="comment"></span>
01164 <span class="comment">  news_array.media_obtain_information(chance_event.true_cost_education);</span>
01165 <span class="comment">*/</span>
01166 }
01167 <span class="comment">//------ End of media_obtain_infomation -------//</span>
01168 
01169 
01170 <span class="comment">//------ Begin of research_prize -------//</span>
01171 
<a name="l01172"></a><a class="code" href="Ochance_8cpp.html#a49">01172</a> <span class="keywordtype">void</span> <a class="code" href="Ochance_8cpp.html#a49">research_prize</a>()
01173 {
01174     <span class="comment">//--- get the department with the highest research performance ---//</span>
01175 
01176     <span class="keywordtype">short</span> fieldList[] = { <a class="code" href="OFIELD_8H.html#a29a17">FIELD_APPLIED_SCIENCE</a>, <a class="code" href="OFIELD_8H.html#a29a20">FIELD_ENGINEERING</a>, <a class="code" href="OFIELD_8H.html#a29a23">FIELD_MATH_AND_COMPUTER_SCIENCE</a>, <a class="code" href="OFIELD_8H.html#a29a24">FIELD_NATURAL_SCIENCE</a>, 0 };
01177 
01178     <span class="keywordtype">float</span> bestPrefResearch;
01179     <span class="keywordtype">int</span> bestDeptRecno, bestFacultyRecno;
01180 
01181     get_best_research_dept( bestPrefResearch, bestDeptRecno, bestFacultyRecno, fieldList );
01182 
01183     <span class="comment">//-- Odds: pick the science, engineering, or agriculture department with the highest research performance; scale the odds to be 20:1 for research performance=100 and 90:1 for research performance=0. The text should say which department is chosen (note that we no longer refer specifically to genetic research) --//</span>
01184 
01185         <span class="comment">// fix in version 2, bestDeptRecno may be zero</span>
01186     <span class="keywordflow">if</span>( !bestDeptRecno || bestPrefResearch &lt; 50 )
01187         <span class="keywordflow">return</span>;
01188 
01189     <span class="keywordflow">if</span>( m.random( <span class="keywordtype">int</span>(10 + 40 * (100-bestPrefResearch) / 50) ) &amp;&amp; !chance_event.test_chance )
01190         <span class="keywordflow">return</span>;
01191 
01192     chance_event.research_prize_dept_recno = bestDeptRecno;
01193     chance_event.research_prize_faculty_recno = bestFacultyRecno;
01194 
01195         <span class="comment">//--------- add news now ------------//</span>
01196 
01197     news_array.research_prize(bestDeptRecno, bestFacultyRecno); 
01198 
01199     <span class="comment">//--- Multiply the named professor's research performance index by Min[120%,RandNormDev(140%,10%)], truncating the result at 100%. ---//</span>
01200 
01201     <a class="code" href="classFaculty.html">Faculty</a>* facultyPtr = department_array[bestDeptRecno]-&gt;faculty_array[bestFacultyRecno];
01202         
01203     facultyPtr-&gt;<a class="code" href="classFaculty.html#m38">extra_effect_performance_research</a> = m.fmin(1.20f, math.get_random_snd(1.40f, 0.10f));
01204     facultyPtr-&gt;<a class="code" href="classFaculty.html#a19">calc_performance_research</a>();
01205 
01206     <span class="comment">//--- Multiply current gifts, alumni morale, and media satisfaction by Min[110%,RandNormDev(115%,5%)], truncating alumni morale at 100%. ---//</span>
01207 
01208     chance_event.extra_effect_media_att          = m.fmin(1.1f, math.get_random_snd(1.25f, 0.05f) );
01209     chance_event.extra_effect_alumni_morale = m.fmin(1.1f, math.get_random_snd(1.25f, 0.05f) );
01210 
01211     player_school.calc_media_attitudes();
01212     development_office.calc_alumni_morale();
01213 
01214         <span class="comment">//-----------------------------------------------------//</span>
01215 
01216     chance_event.research_prize_flag=1;
01217         
01218     chance_event.research_prize_happen_date=info.game_day;
01219     chance_event.research_prize_happen_month=info.game_month;
01220     chance_event.research_prize_happen_year=info.game_year;
01221 
01222         <span class="comment">//--- Multiply current institutional prestige by Min[105%,RandNormDev(115%,4%)]; truncate the result at 100. ---//</span>
01223 
01224     school_res.player_peer_school-&gt;prestige *= 
01225         m.fmax(1.0f, (1 + m.fmin(0.1f, math.get_random_snd(0.3f,0.05f)) ) );
01226 
01227     <span class="keywordflow">if</span>(school_res.player_peer_school-&gt;prestige&gt;=100.0f)
01228         school_res.player_peer_school-&gt;prestige = 100.0f;
01229 }
01230 <span class="comment">//------ End of function research_prize ------//</span>
01231 
01232 
01233 <span class="comment">// ------ Begin of technology_transfer------------//</span>
<a name="l01234"></a><a class="code" href="Ochance_8cpp.html#a50">01234</a> <span class="keywordtype">void</span> <a class="code" href="Ochance_8cpp.html#a50">technology_transfer</a>()
01235 {
01236     <span class="comment">//--- get the department with the highest research performance ---//</span>
01237 
01238     <span class="keywordtype">short</span> fieldList[] = { <a class="code" href="OFIELD_8H.html#a29a17">FIELD_APPLIED_SCIENCE</a>, <a class="code" href="OFIELD_8H.html#a29a20">FIELD_ENGINEERING</a>, <a class="code" href="OFIELD_8H.html#a29a23">FIELD_MATH_AND_COMPUTER_SCIENCE</a>, <a class="code" href="OFIELD_8H.html#a29a24">FIELD_NATURAL_SCIENCE</a>, 0 };
01239 
01240     <span class="keywordtype">float</span> bestPrefResearch;
01241     <span class="keywordtype">int</span> bestDeptRecno, bestFacultyRecno;
01242 
01243     get_best_research_dept( bestPrefResearch, bestDeptRecno, bestFacultyRecno, fieldList );
01244 
01245     <span class="comment">//--- Odds: pick the science, engineering, computer science, or agriculture department with the highest research performance; scale the odds to be 20:1 for research performance=100 and 50:1 for research performance=50 (zero for performance less than 50). The text should name the department and the amount of the revenue increment. </span>
01246 
01247         <span class="comment">// fix in version 2, bestDeptRecno may be zero</span>
01248     <span class="keywordflow">if</span>( !bestDeptRecno || bestPrefResearch &lt; 50 )
01249         <span class="keywordflow">return</span>;
01250 
01251     <span class="keywordflow">if</span>( m.random( <span class="keywordtype">int</span>(20 + 30 * (100-bestPrefResearch) / 50) ) &amp;&amp; !chance_event.test_chance )
01252         <span class="keywordflow">return</span>;
01253 
01254         <span class="comment">//------- set effect vars ------------//</span>
01255 
01256     <span class="keywordtype">float</span> randomValue = math.get_random_snd(4.0f, 1.0f);
01257 
01258     chance_event.dept_technology_transfer_research_amount = (1000 * m.fmax(1.5f, randomValue));
01259 
01260    <span class="comment">// decided the end year</span>
01261     chance_event.dept_technology_transfer_start_year=info.game_year;
01262     chance_event.dept_technology_transfer_start_month=info.game_month;
01263 
01264         <span class="comment">//---- add news -----/</span>
01265 
01266     news_array.technology_transfer( bestDeptRecno, chance_event.dept_technology_transfer_research_amount );
01267 }
01268 <span class="comment">//------ End of technology_transfer------//</span>
01269 
01270 
01271 <span class="comment">// ----------- Begin of capital_campaign---------------//</span>
01272 <span class="comment">//</span>
<a name="l01273"></a><a class="code" href="Ochance_8cpp.html#a51">01273</a> <span class="keywordtype">void</span> <a class="code" href="Ochance_8cpp.html#a51">capital_campaign</a>()
01274 {
01275     <span class="comment">//-------- odds: 20: 1----------//</span>
01276 
01277     <span class="keywordflow">if</span>( m.random(20) &amp;&amp; !chance_event.test_chance )
01278         <span class="keywordflow">return</span>;
01279 
01280         <span class="comment">//------ display news -----------//</span>
01281 
01282     news_array.capital_campaign();
01283 
01284     <span class="comment">//--        Multiply the "Institutional advancement" budget by Min[150%,RandNormDev(200%,10%)], effective immediately. Lock the percent change in the institutional advancement budget at zero for five years, then remove the lock. (Player will have to reduce the budget manually after five years if desired.) ---//</span>
01285 
01286     chance_event.capital_campaign_lock_ins_pect = m.fmax(1.50f, math.get_random_snd(2.00f, 0.10f)); <span class="comment">//## chea 101199 this should be max to make a diff.</span>
01287 
01288     finance.projected_expense_array[<a class="code" href="Ofinance_8h.html#a104a51">AC_INST_ADVANCEMENT</a>].this_year.total*= chance_event.capital_campaign_lock_ins_pect;
01289     finance.projected_expense_array[<a class="code" href="Ofinance_8h.html#a104a51">AC_INST_ADVANCEMENT</a>].this_year.other = finance.projected_expense_array[<a class="code" href="Ofinance_8h.html#a104a51">AC_INST_ADVANCEMENT</a>].this_year.total 
01290         - finance.projected_expense_array[<a class="code" href="Ofinance_8h.html#a104a51">AC_INST_ADVANCEMENT</a>].this_year.staff 
01291         - finance.projected_expense_array[<a class="code" href="Ofinance_8h.html#a104a51">AC_INST_ADVANCEMENT</a>].this_year.faculty;
01292     finance.projected_expense_array[<a class="code" href="Ofinance_8h.html#a104a51">AC_INST_ADVANCEMENT</a>].change_budget_year.total=(chance_event.capital_campaign_lock_ins_pect-1.0f)*10;
01293 
01294     finance.projected_expense_array[<a class="code" href="Ofinance_8h.html#a104a51">AC_INST_ADVANCEMENT</a>].year_to_date = finance.projected_expense_array[<a class="code" href="Ofinance_8h.html#a104a51">AC_INST_ADVANCEMENT</a>].this_year;
01295 
01296     finance.calc_projected_total_n_percent(1);                  <span class="comment">// 1-recalc </span>
01297 
01298     <span class="comment">//------ gift growth rate multiplier ----//</span>
01299 
01300     chance_event.gift_growth_rate_multiplier = m.fmin( 1.3f, math.get_random_snd(2.0f, 0.3f) );
01301 
01302     chance_event.capital_campaign_end_year = info.game_year+4;          <span class="comment">// last for 5 years, +4 is the last year </span>
01303 }
01304 <span class="comment">//------ End of capital_campaign------//</span>
01305 
01306 
01307 <span class="comment">// ------ Begin of student_loans------------//</span>
<a name="l01308"></a><a class="code" href="Ochance_8cpp.html#a52">01308</a> <span class="keywordtype">void</span> <a class="code" href="Ochance_8cpp.html#a52">student_loans</a>()
01309 {
01310     <span class="comment">// comment out because we have difficulty in implementing it. </span>
01311 <span class="comment">/*</span>
01312 <span class="comment">  return;               // BUGHERE, not implemented </span>
01313 <span class="comment"></span>
01314 <span class="comment">        //-------- odds: 15: 1 ---------//</span>
01315 <span class="comment"></span>
01316 <span class="comment">        if( m.random(15) )</span>
01317 <span class="comment">        return;</span>
01318 <span class="comment"></span>
01319 <span class="comment">   //---------- 1/3 gen random parameters --------//</span>
01320 <span class="comment">        </span>
01321 <span class="comment">   int isIncrease = (m.random(100) &gt; 60) ? 1 : 0;</span>
01322 <span class="comment">  </span>
01323 <span class="comment">   //---------- 2/3 add news --------//</span>
01324 <span class="comment"></span>
01325 <span class="comment">   news_array.student_loans(isIncrease);</span>
01326 <span class="comment">*/</span>
01327 }
01328 <span class="comment">//------ End of student_loans------//</span>
01329 
01330 
01331 <span class="comment">//------------------------ TASKS --------------------------------//</span>
01332 
01333 
01334 <span class="comment">//------ Begin of function set_task -------//</span>
01336 <span class="comment">void set_task(int taskId, int src, int&amp; target, int&amp; year, int&amp; month, int&amp; bonus, int&amp; ratingType)</span>
01337 {
01338     target      = src + goal_config.goal_task(taskId)-&gt;get_value();
01339     target      = min(100,target);
01340 
01341     month               = info.game_month;
01342     year                = info.game_year + goal_config.goal_task(taskId)-&gt;get_years();
01343 
01344     bonus               = goal_config.goal_task(taskId)-&gt;bonus;
01345     ratingType = taskId;        
01346 }
01347 <span class="comment">//------ End of function set_task -------//</span>
01348 
01349 
01350 <span class="comment">//------ Begin of function rise_performance_rating -------//</span>
<a name="l01352"></a><a class="code" href="Ochance_8cpp.html#a53">01352</a> <span class="comment">void rise_performance_rating()</span>
01353 {
01354     <span class="comment">//---------- 1/3 gen random parameters --------//</span>
01355     <span class="keywordtype">int</span> deptRecno = 0, ratingType;
01356     <span class="keywordtype">int</span> target, src, month, year, bonus;
01357 
01358     <span class="keywordtype">int</span> i;
01359 
01360     <span class="keywordflow">for</span> (i = department_array.department_count * 2; i &gt; 0; i--)
01361     {
01362         <span class="keywordtype">int</span> rec = 1+m.random(department_array.department_count);
01363 
01364         <span class="keywordflow">if</span> (department_array.is_deleted( rec ))
01365             <span class="keywordflow">continue</span>;
01366 
01367         <span class="keywordflow">if</span> ( department_array[rec]-&gt;p_academic_standing &lt; 60 )
01368         {
01369             deptRecno = rec;
01370             <span class="keywordflow">break</span>;
01371         }
01372     }
01373 
01374     <span class="keywordflow">if</span> ( deptRecno == 0 )
01375         deptRecno = 3;
01376 
01377         <span class="comment">//-------- set objective settings --------//</span>
01378 
01379     src = int(department_array[deptRecno]-&gt;p_academic_standing);
01380 
01381     set_task(<a class="code" href="OTASK_8H.html#a14a4">TASK_RISE_PERFORMANCE_RATING</a>, src, target, year, month, bonus, ratingType);
01382 
01383         <span class="comment">//---------- 2/3 add news --------//</span>
01384 
01385     task_array.rise_performance_rating(deptRecno, ratingType, target, src, month, year, bonus);
01386 
01387     <span class="comment">//---------- 3/3 action --------//</span>
01388     <span class="comment">// no immediate action for task     </span>
01389 }
01390 <span class="comment">//------ End of function rise_performance_rating -------//</span>
01391 
01392 
01393 <span class="comment">//------ Begin of function rise_educational_quality -------//</span>
<a name="l01395"></a><a class="code" href="Ochance_8cpp.html#a54">01395</a> <span class="comment">void rise_educational_quality()</span>
01396 {
01397 
01398     <span class="keywordtype">int</span> deptRecno = 0, rRecno, ratingType;
01399     <span class="keywordtype">int</span> target, src, month, year, bonus;
01400 
01401     <span class="comment">//---------- 1/3 gen random parameters --------//</span>
01402 
01403     rRecno = m.random(department_array.department_count);  <span class="comment">//m.random(3) = 0,1,2</span>
01404 
01405     deptRecno= department_array.p_educational_quality_sort[rRecno];
01406     <a class="code" href="classDepartment.html">Department</a>* cur_dept_ptr = department_array[deptRecno];
01407 
01408     <span class="comment">//-------- set objective settings --------//</span>
01409 
01410     src         = int(cur_dept_ptr-&gt;<a class="code" href="classDepartment.html#m42">p_educational_quality</a>);    <span class="comment">//value now</span>
01411 
01412     set_task(<a class="code" href="OTASK_8H.html#a14a5">RISE_EDUCATIONAL_QUALITY</a>, src, target, year, month, bonus, ratingType);
01413 
01414     <span class="comment">//---------- 2/3 add news --------//</span>
01415 
01416     task_array.rise_educational_quality(deptRecno, ratingType, target, src, month, year, bonus);  
01417 
01418     <span class="comment">//---------- 3/3 action --------//</span>
01419     <span class="comment">// no immediate action for task     </span>
01420 }
01421 <span class="comment">//------ End of function rise_educational_quality -------//</span>
01422 
01423 
01424 <span class="comment">//------ Begin of function rise_student_morale -------//</span>
<a name="l01426"></a><a class="code" href="Ochance_8cpp.html#a55">01426</a> <span class="comment">void rise_student_morale()</span>
01427 {
01428 
01429     <span class="keywordtype">int</span> deptRecno, ratingType;
01430     <span class="keywordtype">int</span> target, src, month, year, bonus;
01431 
01432     <span class="comment">//---------- 1/3 gen random parameters --------//</span>
01433 
01434     src = (int)player_school.sub_score[<a class="code" href="Opschool_8h.html#a65a46">S_STUDENT_MORALE</a>][HISTORY_MONTH_COUNT-1];
01435 
01436     deptRecno= department_array.p_educational_quality_sort[0];  <span class="comment">//## chea 230999 this is not going to use</span>
01437 
01438     <span class="comment">//-------- set objective settings --------//</span>
01439 
01440     set_task(<a class="code" href="OTASK_8H.html#a14a6">RISE_STUDENT_MORALE</a>, src, target, year, month, bonus, ratingType);
01441 
01442     <span class="comment">//---------- 2/3 add news --------//</span>
01443 
01444     task_array.rise_student_morale(deptRecno, ratingType, target, src, month, year, bonus);  
01445 
01446     <span class="comment">//---------- 3/3 action --------//</span>
01447     <span class="comment">// no immediate action for task     </span>
01448 }
01449 <span class="comment">//------ End of function rise_student_morale -------//</span>
01450 
01451 <span class="comment">//------ Begin of function rise_department_morale -------//</span>
<a name="l01453"></a><a class="code" href="Ochance_8cpp.html#a56">01453</a> <span class="comment">void rise_department_morale()</span>
01454 {
01455 
01456     <span class="keywordtype">int</span> deptRecno = 0, rRecno, ratingType;
01457     <span class="keywordtype">int</span> target, src, month, year, bonus;
01458 
01459     <span class="comment">//---------- 1/3 gen random parameters --------//</span>
01460 
01461     rRecno = m.random(department_array.department_count);  <span class="comment">//m.random(3) = 0,1,2</span>
01462 
01463     deptRecno= department_array.p_educational_quality_sort[rRecno];   <span class="comment">// no use here</span>
01464 
01465     <span class="comment">//-------- set objective settings --------//</span>
01466 
01467     src = int(department_array.p_faculty_morale_history[47]);    <span class="comment">//value now</span>
01468 
01469     set_task(<a class="code" href="OTASK_8H.html#a14a7">RISE_DEPARTMENT_MORALE</a>, src, target, year, month, bonus, ratingType);
01470 
01471     <span class="comment">//---------- 2/3 add news --------//</span>
01472 
01473     task_array.rise_department_morale(deptRecno, ratingType, target, src, month, year, bonus);  
01474 
01475     <span class="comment">//---------- 3/3 action --------//</span>
01476     <span class="comment">// no immediate action for task     </span>
01477 }
01478 <span class="comment">//------ End of function rise_department_morale -------//</span>
01479 
01480 <span class="comment">//------ Begin of function rise_faculty_research_Per -------//</span>
<a name="l01482"></a><a class="code" href="Ochance_8cpp.html#a57">01482</a> <span class="comment">void rise_faculty_research_Per()</span>
01483 {
01484 
01485     <span class="keywordtype">int</span> deptRecno = 0, rRecno, ratingType;
01486     <span class="keywordtype">int</span> target, src, month, year, bonus;
01487 
01488     <span class="comment">//---------- 1/3 gen random parameters --------//</span>
01489 
01490     rRecno = m.random(department_array.department_count);  <span class="comment">//m.random(3) = 0,1,2</span>
01491 
01492     deptRecno= department_array.p_educational_quality_sort[rRecno];
01493 
01494     <span class="comment">//-------- set objective settings --------//</span>
01495 
01496     src = int(department_array.p_faculty_research_history[THIS_MONTH]);    <span class="comment">//value now</span>
01497 
01498     set_task(<a class="code" href="OTASK_8H.html#a14a8">RISE_FACULTY_RESEARCH</a>, src, target, year, month, bonus, ratingType);
01499 
01500     <span class="comment">//---------- 2/3 add news --------//</span>
01501 
01502     task_array.rise_faculty_research_Per(deptRecno, ratingType, target, src, month, year, bonus);  <span class="comment">//## chea 220999</span>
01503 
01504     <span class="comment">//---------- 3/3 action --------//</span>
01505     <span class="comment">// no immediate action for task     </span>
01506 }
01507 <span class="comment">//------ End of function rise_faculty_research_Per -------//</span>
01508 
01509 
01510 <span class="comment">//------ Begin of function rise_faculty_diversity_index -------//</span>
<a name="l01512"></a><a class="code" href="Ochance_8cpp.html#a58">01512</a> <span class="comment">void rise_faculty_diversity_index()</span>
01513 {
01514 
01515     <span class="keywordtype">int</span> deptRecno = 0, rRecno, ratingType;
01516     <span class="keywordtype">int</span> target, src, month, year, bonus;
01517 
01518     <span class="comment">//---------- 1/3 gen random parameters --------//</span>
01519 
01520 <span class="comment">//      rRecno = m.random(department_array.department_count);  //m.random(3) = 0,1,2</span>
01521     rRecno = department_array.department_count-1;  <span class="comment">//the lowest department </span>
01522 
01523     deptRecno= department_array.p_faculty_diversity_sort[rRecno];
01524 
01525     <span class="comment">//-------- set objective settings --------//</span>
01526 
01527     src = int(department_array[deptRecno]-&gt;p_faculty_diversity_history[7]);    <span class="comment">//value now</span>
01528 
01529     set_task(<a class="code" href="OTASK_8H.html#a14a9">RISE_FACULTY_DIVERSITY_INDEX</a>, src, target, year, month, bonus, ratingType);
01530 
01531     <span class="comment">//---------- 2/3 add news --------//</span>
01532 
01533     task_array.rise_faculty_diversity_index(deptRecno, ratingType, target, src, month, year, bonus);  
01534 
01535     <span class="comment">//---------- 3/3 action --------//</span>
01536     <span class="comment">// no immediate action for task     </span>
01537 }
01538 <span class="comment">//------ End of function rise_faculty_diversity_index -------//</span>
01539 
01540 
01541 <span class="comment">//------ Begin of function rise_use_of_IT -------//</span>
<a name="l01543"></a><a class="code" href="Ochance_8cpp.html#a59">01543</a> <span class="comment">void rise_use_of_IT()</span>
01544 {
01545 
01546     <span class="keywordtype">int</span> deptRecno = 0, rRecno, ratingType;
01547     <span class="keywordtype">int</span> target, src, month, year, bonus;
01548 
01549     <span class="comment">//---------- 1/3 gen random parameters --------//</span>
01550 
01551     rRecno = m.random(department_array.department_count);  <span class="comment">//m.random(3) = 0,1,2</span>
01552     deptRecno= department_array.p_faculty_diversity_sort[rRecno];
01553     <a class="code" href="classDepartment.html">Department</a>* cur_dept_ptr = department_array[deptRecno];
01554 
01555     <span class="comment">//-------- set objective settings --------//</span>
01556 
01557     src =(int)(cur_dept_ptr-&gt;<a class="code" href="classDepartment.html#m58">var_educational_quality_history</a>[4][23]);    <span class="comment">//value now</span>
01558 
01559     set_task(<a class="code" href="OTASK_8H.html#a14a10">RISE_USE_OF_IT</a>, src, target, year, month, bonus, ratingType);
01560 
01561     <span class="comment">//---------- 2/3 add news --------//</span>
01562 
01563     task_array.rise_use_of_IT(deptRecno, ratingType, target, src, month, year, bonus);  
01564 
01565     <span class="comment">//---------- 3/3 action --------//</span>
01566     <span class="comment">// no immediate action for task     </span>
01567 }
01568 <span class="comment">//------ End of function rise_use_of_IT -------//</span>
01569 
01570 
01571 <span class="comment">//------ Begin of function rise_staff_morale -------//</span>
<a name="l01573"></a><a class="code" href="Ochance_8cpp.html#a60">01573</a> <span class="comment">void rise_staff_morale()</span>
01574 {
01575 
01576     <span class="keywordtype">int</span> deptRecno = 0, rRecno, ratingType;
01577     <span class="keywordtype">int</span> target, src, month, year, bonus;
01578 
01579     <span class="comment">//---------- 1/3 gen random parameters --------//</span>
01580 
01581     rRecno = m.random(department_array.department_count);  <span class="comment">//m.random(3) = 0,1,2</span>
01582     deptRecno= department_array.p_faculty_diversity_sort[rRecno];
01583 
01584     <span class="comment">//-------- set objective settings --------//</span>
01585 
01586     src =(int)(player_school.sub_score[<a class="code" href="Opschool_8h.html#a65a47">S_STAFF_MORALE</a>][THIS_MONTH]);    <span class="comment">//value now</span>
01587 
01588     set_task(<a class="code" href="OTASK_8H.html#a14a11">RISE_STAFF_MORALE</a>, src, target, year, month, bonus, ratingType);
01589 
01590     <span class="comment">//---------- 2/3 add news --------//</span>
01591 
01592     task_array.rise_staff_morale(deptRecno, ratingType, target, src, month, year, bonus);  
01593 
01594     <span class="comment">//---------- 3/3 action --------//</span>
01595     <span class="comment">// no immediate action for task     </span>
01596 }
01597 <span class="comment">//------ End of function rise_staff_morale -------//</span>
01598 
01599 
01600 <span class="comment">//------- Begin of get_best_research_dept ------//</span>
01601 
01602 <span class="keywordtype">void</span> get_best_research_dept(<span class="keywordtype">float</span>&amp; bestPrefResearch, <span class="keywordtype">int</span>&amp; bestDeptRecno, <span class="keywordtype">int</span>&amp; bestFacultyRecno, <span class="keywordtype">short</span>* fieldList)
01603 {
01604     <span class="comment">//----- loop through the departments --------//     </span>
01605 
01606     <a class="code" href="classFacultyArray.html">FacultyArray</a>* facultyArr;
01607         
01608     bestPrefResearch = 0;
01609     bestDeptRecno = 0;
01610 
01611     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=department_array.size(); i&gt;0; i-- )
01612     {
01613         <span class="keywordflow">if</span> ( department_array.is_deleted(i) )
01614             <span class="keywordflow">continue</span>;
01615 
01616         <span class="comment">//--- only scan departments whose fields are in the field list ---//</span>
01617 
01618         <span class="keywordtype">int</span> fieldId = department_res[department_array[i]-&gt;department_id]-&gt;field_id;
01619 
01620         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> j=0 ; fieldList[j] ; j++ )
01621         {
01622             <span class="keywordflow">if</span>( fieldList[j] == fieldId )
01623                 <span class="keywordflow">break</span>;
01624         }
01625 
01626         <span class="keywordflow">if</span>( !fieldList[j] )
01627             <span class="keywordflow">continue</span>;
01628 
01629         <span class="comment">//--- loop through the faculty of each department ---//</span>
01630 
01631         facultyArr = &amp;(department_array[i]-&gt;faculty_array);
01632 
01633         <span class="keywordflow">for</span>( j=facultyArr-&gt;<a class="code" href="classDynArray.html#a28">size</a>() ; j&gt;0 ; j-- )
01634         {
01635             <span class="keywordflow">if</span>( facultyArr-&gt;<a class="code" href="classFacultyArray.html#a10">is_deleted</a>(j) )
01636                 <span class="keywordflow">continue</span>;
01637 
01638             <span class="keywordflow">if</span>( facultyArr-&gt;operator[](j)-&gt;<a class="code" href="classFacultyArray.html#m7">performance_research</a> &gt; bestPrefResearch )
01639             {
01640                 bestPrefResearch = facultyArr-&gt;operator[](j)-&gt;<a class="code" href="classFacultyArray.html#m7">performance_research</a>;
01641                 bestDeptRecno = i;
01642                 bestFacultyRecno = j;
01643             }
01644         }
01645     }
01646 
01647     <span class="comment">// allow return 0, fix in version 2</span>
01648     <span class="comment">// err_when( !bestDeptRecno );</span>
01649 }
01650 <span class="comment">//------- End of function get_best_research_dept ------//</span>
01651 
01652 
01653 
01654 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
01655 <span class="preprocessor"></span><span class="comment">// these two event has no news associated, thus not randomly generated</span>
01656 <span class="comment">// see OPSCH_PO.CPP PlayerSchool::think_protagonist</span>
01657 
01658 <span class="comment">// percent increase in alumni budget (100 for 100%)</span>
01659 
01660 <span class="keywordtype">void</span> ChanceEvent::signal_alumni_budget_increase(<span class="keywordtype">float</span> percentInc, <span class="keywordtype">int</span> financialYear)
01661 {
01662     <span class="comment">// refer to capital_campaign()</span>
01663 
01664     <span class="comment">//--        Multiply the "Institutional advancement" budget by Min[150%,RandNormDev(200%,10%)], effective immediately. Lock the percent change in the institutional advancement budget at zero for five years, then remove the lock. (Player will have to reduce the budget manually after five years if desired.) ---//</span>
01665 
01666     alumni_budget_increase *= (1.0f + percentInc);
01667 
01668 <span class="comment">//      finance.projected_expense_array[AC_INST_ADVANCEMENT].this_year.total*= (1.0f + percentInc);</span>
01669 <span class="comment">//      finance.projected_expense_array[AC_INST_ADVANCEMENT].this_year.other = finance.projected_expense_array[AC_INST_ADVANCEMENT].this_year.total </span>
01670 <span class="comment">//                                                                                                                                                                                              - finance.projected_expense_array[AC_INST_ADVANCEMENT].this_year.staff </span>
01671 <span class="comment">//                                                                                                                                                                                              - finance.projected_expense_array[AC_INST_ADVANCEMENT].this_year.faculty;</span>
01672 <span class="comment">//      finance.projected_expense_array[AC_INST_ADVANCEMENT].change_budget_year.total=percentInc*10;</span>
01673 <span class="comment">//      finance.projected_expense_array[AC_INST_ADVANCEMENT].year_to_date += finance.projected_expense_array[AC_INST_ADVANCEMENT].this_year;</span>
01674 
01675     <span class="keywordtype">float</span> totalInc = finance.projected_expense_array[<a class="code" href="Ofinance_8h.html#a104a51">AC_INST_ADVANCEMENT</a>].this_year.total * percentInc;
01676     finance.projected_expense_array[<a class="code" href="Ofinance_8h.html#a104a51">AC_INST_ADVANCEMENT</a>].this_year.total += totalInc;
01677     finance.projected_expense_array[<a class="code" href="Ofinance_8h.html#a104a51">AC_INST_ADVANCEMENT</a>].change_last_year.other = finance.calc_change( finance.projected_expense_array[<a class="code" href="Ofinance_8h.html#a104a51">AC_INST_ADVANCEMENT</a>].this_year.other, finance.expense_array[<a class="code" href="Ofinance_8h.html#a104a51">AC_INST_ADVANCEMENT</a>].other );
01678     finance.projected_expense_array[<a class="code" href="Ofinance_8h.html#a104a51">AC_INST_ADVANCEMENT</a>].this_year.other += totalInc;
01679     finance.projected_expense_array[<a class="code" href="Ofinance_8h.html#a104a51">AC_INST_ADVANCEMENT</a>].change_last_year.total = finance.calc_change( finance.projected_expense_array[<a class="code" href="Ofinance_8h.html#a104a51">AC_INST_ADVANCEMENT</a>].this_year.total, finance.expense_array[<a class="code" href="Ofinance_8h.html#a104a51">AC_INST_ADVANCEMENT</a>].total );
01680     finance.projected_expense_array[<a class="code" href="Ofinance_8h.html#a104a51">AC_INST_ADVANCEMENT</a>].year_to_date.other += totalInc;
01681     <span class="comment">// update finance.projected_expense_array[i].change_last_year</span>
01682 
01683     finance.calc_projected_total_n_percent(1);                  <span class="comment">// 1-recalc </span>
01684 
01685     <span class="comment">//------ gift growth rate multiplier ----//</span>
01686 
01687         <span class="comment">// chance_event.gift_growth_rate_multiplier = m.fmin( 1.3f, math.get_random_snd(2.0f, 0.3f) );</span>
01688 
01689     alumni_budget_financial_year = financialYear;
01690 }
01691 
01692 <span class="comment">// amount added to next year athetcis budget</span>
01693 
01694 <span class="keywordtype">void</span> ChanceEvent::signal_athletics_budget_amount(<span class="keywordtype">float</span> amount, <span class="keywordtype">int</span> financialYear)
01695 {
01696     athletics_budget_amount += amount;
01697 
01698     <span class="keywordtype">float</span> totalInc = amount;
01699     finance.projected_expense_array[<a class="code" href="Ofinance_8h.html#a104a50">AC_ATHLETICS</a>].this_year.total += totalInc;
01700     finance.projected_expense_array[<a class="code" href="Ofinance_8h.html#a104a50">AC_ATHLETICS</a>].change_last_year.other = finance.calc_change( finance.projected_expense_array[<a class="code" href="Ofinance_8h.html#a104a50">AC_ATHLETICS</a>].this_year.other, finance.expense_array[<a class="code" href="Ofinance_8h.html#a104a50">AC_ATHLETICS</a>].other );
01701     finance.projected_expense_array[<a class="code" href="Ofinance_8h.html#a104a50">AC_ATHLETICS</a>].this_year.other += totalInc;
01702     finance.projected_expense_array[<a class="code" href="Ofinance_8h.html#a104a50">AC_ATHLETICS</a>].change_last_year.total = finance.calc_change( finance.projected_expense_array[<a class="code" href="Ofinance_8h.html#a104a50">AC_ATHLETICS</a>].this_year.total, finance.expense_array[<a class="code" href="Ofinance_8h.html#a104a50">AC_ATHLETICS</a>].total );
01703     finance.projected_expense_array[<a class="code" href="Ofinance_8h.html#a104a50">AC_ATHLETICS</a>].year_to_date.other += totalInc;
01704 
01705     finance.calc_projected_total_n_percent(1);                  <span class="comment">// 1-recalc </span>
01706 
01707     athletics_budget_financial_year = financialYear;
01708 }
01709 <span class="preprocessor">#endif</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:17 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
