<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OVBROWSE.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>OVBROWSE.CPP</h1><a href="OVBROWSE_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OVBROWSE.CPP</span>
00002 <span class="comment">//Description : Object Visual Browse</span>
00003 
00004 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00005 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>
00006 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00007 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00008 <span class="preprocessor">#include &lt;OFONT.H&gt;</span>
00009 <span class="preprocessor">#include &lt;<a class="code" href="OPOWER_8H.html">OPOWER.H</a>&gt;</span>
00010 <span class="preprocessor">#include &lt;<a class="code" href="OVBROWSE_8H.html">OVBROWSE.H</a>&gt;</span>
00011 <span class="preprocessor">#include &lt;OIFACE.H&gt;</span>
00012 
00013 <span class="comment">//---------- Define static class variables -------//</span>
<a name="l00014"></a><a class="code" href="classVBrowse.html#p0">00014</a> <span class="keywordtype">char</span>    <a class="code" href="classVBrowse.html#p0">VBrowse::press_record</a>=0;                  <span class="comment">// for detecting pulling records upwards and downloads</span>
<a name="l00015"></a><a class="code" href="classVBrowse.html#p1">00015</a> <a class="code" href="classVBrowse.html">VBrowse</a>* <a class="code" href="classVBrowse.html#p1">VBrowse::press_vbrowse_ptr</a>;
00016 
00017 <span class="comment">//--------- Begin of function VBrowse::init --------//</span>
<a name="l00035"></a><a class="code" href="classVBrowse.html#a1">00035</a> <span class="comment">void VBrowse::init(int inX1, int inY1, int inX2, int inY2,</span>
00036                    <span class="keywordtype">int</span> recWidth, <span class="keywordtype">int</span> recHeight,
00037                    <span class="keywordtype">int</span> totalRec, BrowDispFP dispFunc,
00038                    BrowDetectFP detectFunc,
00039                    <span class="keywordtype">int</span> dispFrame, <span class="keywordtype">int</span> minInterSpace) {
00040     x1 = inX1;
00041     y1 = inY1;
00042     x2 = inX2;
00043     y2 = inY2;
00044 
00045     ix1 = x1+6;                                     <span class="comment">// content area coordination</span>
00046     iy1 = y1+6;
00047     ix2 = x2-6-SCROLL_BAR_WIDTH;
00048     iy2 = y2-6;
00049 
00050     <span class="comment">//---------------------------------------------//</span>
00051 
00052     <span class="keywordflow">if</span>( recWidth &lt;= 0 )
00053         rec_width = ix2-ix1+1;
00054     <span class="keywordflow">else</span>
00055         rec_width = recWidth;
00056 
00057     rec_height = recHeight;
00058 
00059     disp_rec_func   = dispFunc;
00060     disp_frame      = dispFrame;
00061 
00062     x_max_rec = (ix2-ix1+minInterSpace+1) / (rec_width +minInterSpace);
00063     y_max_rec = (iy2-iy1+minInterSpace+1) / (rec_height+minInterSpace);
00064 
00065     detect_pull_flag = 1;                           <span class="comment">// whether detect pulling records or not</span>
00066 
00067     <a class="code" href="ALL_8H.html#a2">err_if</a>( x_max_rec &lt;= 0 || y_max_rec &lt;= 0 )
00068         <a class="code" href="ALL_8H.html#a4">err_now</a>( <span class="stringliteral">"VBrowse::init() error : disp_max_rec &lt;= 0"</span> );
00069 
00070     <span class="comment">//--- calculate the suitable inter-record space -------//</span>
00071 
00072     <span class="keywordflow">if</span>( x_max_rec &gt; 1 )
00073         rec_x_space = minInterSpace + (ix2-ix1+minInterSpace+1) % (rec_width +minInterSpace)/(x_max_rec-1);
00074     <span class="keywordflow">else</span>
00075         rec_x_space = minInterSpace;
00076 
00077     <span class="keywordflow">if</span>( y_max_rec &gt; 1 )
00078         rec_y_space = minInterSpace + (iy2-iy1+minInterSpace+1) % (rec_height+minInterSpace)/(y_max_rec-1);
00079     <span class="keywordflow">else</span>
00080         rec_y_space = minInterSpace;
00081 
00082     init_var(totalRec,-1);
00083 
00084     init_flag = 1;
00085 
00086     <span class="comment">//------- paint the list box --------//</span>
00087 
00088     paint();
00089 }
00090 
00091 <span class="comment">//---------- End of function VBrowse::init ---------//</span>
00092 
00093 <span class="comment">//---------- Begin of function VBrowse::init_var -------//</span>
<a name="l00097"></a><a class="code" href="classVBrowse.html#b0">00097</a> <span class="comment">void VBrowse::init_var(int totalRec, int recNo) {</span>
00098     <span class="keywordflow">if</span>( totalRec &gt;= 0 ) {                           <span class="comment">// if totalRec == -1, then no change</span>
00099         none_record = totalRec==0;
00100 
00101         <span class="keywordflow">if</span>( totalRec == 0 )
00102             total_rec_num = 1;                          <span class="comment">// prevent divided by zero if it is a closed box</span>
00103         <span class="keywordflow">else</span>
00104             total_rec_num = totalRec;
00105     }
00106 
00107     <span class="comment">//--- maximum records can be display on a browse box ---//</span>
00108 
00109     disp_max_rec = x_max_rec * y_max_rec;
00110 
00111     <span class="keywordflow">if</span>( disp_max_rec &gt; total_rec_num )
00112         disp_max_rec = total_rec_num;
00113 
00114     <span class="comment">//------- changable variables --------//</span>
00115 
00116     rec_no     = recNo;
00117 
00118     top_rec_no = recNo - disp_max_rec/2;
00119     top_rec_no = max(1,top_rec_no);
00120 
00121     <span class="comment">// if there is an empty area at the lower part of the browser</span>
00122     <span class="keywordflow">if</span>( top_rec_no+disp_max_rec-1 &gt; total_rec_num ) {
00123         top_rec_no = total_rec_num-disp_max_rec+1;
00124         top_rec_no = max(top_rec_no,1);
00125     }
00126 
00127     <span class="comment">//------------- initialize scroll bar ---------------//</span>
00128     <span class="comment">//</span>
00129     <span class="comment">// If display frame      , then scroll unit is 1 record</span>
00130     <span class="comment">// If don't display frame, then the scroll unit is disp_max_rec record</span>
00131     <span class="comment">//</span>
00132     <span class="comment">//---------------------------------------------------//</span>
00133 
00134     scroll_bar.init( 1, x2-SCROLL_BAR_WIDTH, y1, x2, y2, disp_max_rec,
00135                      (disp_frame &amp;&amp; x_max_rec==1 ? 1 : disp_max_rec),<span class="comment">// only use record as scroller unit when it's a vertical browser with frame</span>
00136                      total_rec_num, 1 );
00137 }
00138 
00139 <span class="comment">//----------- End of function VBrowse::init_var ----------//</span>
00140 
00141 <span class="comment">//--------- Begin of function VBrowse::open ---------//</span>
<a name="l00153"></a><a class="code" href="classVBrowse.html#a2">00153</a> <span class="comment">void VBrowse::open(int recNo, int newTotalRec) {</span>
00154     state = 1;                                      <span class="comment">// state = OPENED</span>
00155 
00156     <span class="keywordflow">if</span>( newTotalRec &gt;= 0 )
00157         total_rec_num = newTotalRec;
00158 
00159     <span class="keywordflow">if</span>( recNo &gt; 0 )                                 <span class="comment">// keep current record no.</span>
00160         rec_no = recNo;
00161 
00162     <span class="keywordflow">if</span>( rec_no&lt;1 )
00163         rec_no=1;
00164 
00165     <span class="keywordflow">if</span>( rec_no &gt; total_rec_num )
00166         rec_no = total_rec_num;
00167 
00168     <span class="comment">//------- set the top recno ----------//</span>
00169 
00170     <span class="keywordflow">if</span>( !newTotalRec ) {
00171         top_rec_no = rec_no - disp_max_rec/2;
00172         top_rec_no = max(1,top_rec_no);
00173     }
00174     <span class="keywordflow">else</span> {                                          <span class="comment">// keep the original top_rec_no</span>
00175         <span class="keywordflow">if</span>( rec_no &gt; top_rec_no+disp_max_rec-1 )
00176             top_rec_no = rec_no-disp_max_rec+1;
00177 
00178         <span class="keywordflow">if</span>( rec_no &lt; top_rec_no )
00179             top_rec_no = rec_no;
00180     }
00181 
00182     <span class="comment">// if there is an empty area at the lower part of the browser</span>
00183     <span class="keywordflow">if</span>( top_rec_no+disp_max_rec-1 &gt; total_rec_num ) {
00184         top_rec_no = total_rec_num-disp_max_rec+1;
00185         top_rec_no = max(top_rec_no,1);
00186     }
00187 
00188     <span class="comment">//------- display all records -------//</span>
00189 
00190     disp_all();
00191 }
00192 
00193 <span class="comment">//--------- End of function VBrowse::open ---------//</span>
00194 
00195 <span class="comment">//--------- Begin of function VBrowse::close ---------//</span>
<a name="l00199"></a><a class="code" href="classVBrowse.html#a3">00199</a> <span class="comment">void VBrowse::close() {</span>
00200     state = 0;                                      <span class="comment">// state = CLOSED</span>
00201 
00202     <span class="comment">//-------- paint the closed outlook of the list box -------//</span>
00203 
00204     <span class="comment">// the place a large block on the list content box</span>
00205     <a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;<a class="code" href="classVgaBuf.html#a41">d3_panel_up</a>( x1+1, y1+1, x2-SCROLL_BAR_WIDTH-3, y2-1  );
00206 }
00207 
00208 <span class="comment">//--------- End of function VBrowse::close ---------//</span>
00209 
00210 <span class="comment">//--------- Begin of function VBrowse::paint ---------//</span>
<a name="l00214"></a><a class="code" href="classVBrowse.html#a10">00214</a> <span class="comment">void VBrowse::paint() {</span>
00215     <span class="comment">// the list content box</span>
00216     <a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;<a class="code" href="classVgaBuf.html#a42">d3_panel_down</a>( x1, y1, x2-SCROLL_BAR_WIDTH-3, y2 );
00217 
00218     <a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;<a class="code" href="classVgaBuf.html#a27">bar</a>( x2-SCROLL_BAR_WIDTH-2, y1, x2-SCROLL_BAR_WIDTH-1, y2, <a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;color_up );
00219     scroll_bar.paint();
00220 }
00221 
00222 <span class="comment">//--------- End of function VBrowse::paint ---------//</span>
00223 
00224 <span class="comment">//------- Begin of function VBrowse::refresh ---------//</span>
<a name="l00233"></a><a class="code" href="classVBrowse.html#a8">00233</a> <span class="comment">void VBrowse::refresh(int newRecNo, int newTotalRec) {</span>
00234     disp_one(rec_no,CLEAR_HIGH);
00235 
00236     <span class="keywordflow">if</span>( newRecNo&gt;=0 || newTotalRec&gt;=0 ) {           <span class="comment">// if current recno and total recno has no change, don't do the recalculation</span>
00237         <span class="keywordflow">if</span>( newRecNo &gt;= 1 )
00238             rec_no = newRecNo;
00239 
00240         <span class="keywordflow">if</span>( newTotalRec != -1 &amp;&amp; rec_no &gt; newTotalRec )
00241             rec_no = newTotalRec;
00242 
00243         <span class="keywordflow">if</span>( rec_no==0 &amp;&amp; newTotalRec&gt;0 )              <span class="comment">// if originally rec_no==0, and total_rec is also 0, when the new total_rec is &gt; 0, the rec_no should also be adjusted</span>
00244             rec_no=1;
00245 
00246         init_var(newTotalRec,rec_no);
00247     }
00248 
00249     disp_all();
00250 }
00251 
00252 <span class="comment">//---------- End of function VBrowse::refresh ----------//</span>
00253 
00254 <span class="comment">//------- Begin of function VBrowse::update ---------//</span>
<a name="l00258"></a><a class="code" href="classVBrowse.html#a9">00258</a> <span class="comment">void VBrowse::update() {</span>
00259     <span class="keywordtype">int</span> recNo, x, y;
00260 
00261     <span class="keywordflow">if</span>( none_record )
00262         <span class="keywordflow">return</span>;
00263 
00264     <span class="keywordflow">for</span>( recNo=top_rec_no ; recNo&lt;=total_rec_num &amp;&amp; recNo&lt;top_rec_no+disp_max_rec ; recNo++ ) {
00265         y = iy1 + (recNo-top_rec_no)/x_max_rec * (rec_height+rec_y_space);
00266         x = ix1 + (recNo-top_rec_no)%x_max_rec * (rec_width+rec_x_space);
00267 
00268         disp_rec( recNo, x, y, <a class="code" href="Gamedef_8h.html#a71a17">INFO_UPDATE</a> );         <span class="comment">// call user defined function</span>
00269     }
00270 }
00271 
00272 <span class="comment">//---------- End of function VBrowse::update ----------//</span>
00273 
00274 <span class="comment">//--------- Begin of function VBrowse::detect ------//</span>
<a name="l00281"></a><a class="code" href="classVBrowse.html#a6">00281</a> <span class="comment">int VBrowse::detect() {</span>
00282     <span class="keywordtype">int</span> recNo=0, rc;
00283 
00284     double_click = 0;
00285 
00286     <span class="keywordflow">if</span>( state == 0 || none_record )                 <span class="comment">// closed</span>
00287         <span class="keywordflow">return</span> 0;
00288 
00289     <span class="comment">//-- Detect pulling on record if the browser is with frame --//</span>
00290 
00291     <span class="comment">// only pull when the vbrowser is vertical, horizontal is technically possible, but not used practically</span>
00292     <span class="keywordflow">if</span>( detect_pull_flag &amp;&amp; disp_frame &amp;&amp; x_max_rec==1 ) {
00293         <span class="keywordflow">if</span>( detect_pull() )
00294             <span class="keywordflow">return</span> rec_no;
00295     }
00296 
00297     <span class="comment">//--------- Detect pressing on record if disp_frame is 1 ---------//</span>
00298 
00299     <span class="keywordflow">if</span>( disp_frame ) {
00300 
00301         <span class="keywordflow">if</span>( mouse.any_click(ix1, iy1, ix2, iy2) ) {
00302             recNo = top_rec_no +
00303                 (mouse.click_y()-iy1) / (rec_height+rec_y_space) * x_max_rec +
00304                 (mouse.click_x()-ix1) / (rec_width +rec_x_space);
00305 
00306             <span class="keywordflow">if</span>( detect_pull_flag )
00307                 press_record = 1;
00308 
00309             press_vbrowse_ptr = <span class="keyword">this</span>;
00310         }
00311 
00312         <span class="keywordflow">if</span>( mouse.press_area(ix1, iy1, ix2, iy2) ) {
00313             recNo = top_rec_no +
00314                 (mouse.cur_y-iy1) / (rec_height+rec_y_space) * x_max_rec +
00315                 (mouse.cur_x-ix1) / (rec_width +rec_x_space);
00316 
00317             <span class="keywordflow">if</span>( detect_pull_flag )
00318                 press_record = 1;
00319 
00320             press_vbrowse_ptr = <span class="keyword">this</span>;
00321         }
00322 
00323         <span class="comment">// if it is not in the empty browser area</span>
00324         <span class="keywordflow">if</span>( recNo&gt;0 &amp;&amp; recNo&lt;=top_rec_no-1+disp_max_rec ) {
00325             <span class="keywordflow">if</span>( mouse.click_count()==2 )                <span class="comment">// double clicked</span>
00326                 double_click = 1;
00327 
00328             <span class="keywordflow">if</span>( recNo != rec_no ) {                     <span class="comment">// if user point to a new record</span>
00329                 disp_one(rec_no, CLEAR_HIGH);
00330                 disp_one(recNo , DISP_HIGH );             <span class="comment">// 2 means display record content only</span>
00331 
00332                 rec_no = recNo;
00333                 <span class="keywordflow">return</span> rec_no;
00334             }
00335 
00336             <span class="keywordflow">if</span>( double_click )                          <span class="comment">// even if current record no. doesn't change, return recno if double clicked</span>
00337                 <span class="keywordflow">return</span> rec_no;
00338         }
00339     }
00340     <span class="keywordflow">else</span> {                                          <span class="comment">//---- when disp_frame is 0, fast scrolling is enabled ----//</span>
00341         <span class="keywordflow">if</span>( mouse.any_click( ix1, iy1, ix2, iy2 ) ) {
00342             <span class="keywordtype">int</span> newTopRec;
00343 
00344             <span class="keywordflow">if</span>( mouse.click_y() &lt; iy1+ ( (iy2-iy1) &gt;&gt; 1 ) )
00345                 newTopRec = scroll_bar.page_up();         <span class="comment">// page up</span>
00346             <span class="keywordflow">else</span>
00347                 newTopRec = scroll_bar.page_down();       <span class="comment">// page down</span>
00348 
00349             <span class="keywordflow">if</span>( top_rec_no != newTopRec ) {
00350                 double_click = mouse.click_count()==2;    <span class="comment">// double clicked</span>
00351 
00352                 rec_no = top_rec_no = newTopRec;
00353                 disp_all();
00354 
00355                 <span class="keywordflow">return</span> rec_no;
00356             }
00357         }
00358     }
00359 
00360     <span class="comment">//------- detect for pressing on scroll bar -----//</span>
00361 
00362     <span class="keywordflow">if</span>( ( rc=scroll_bar.detect() ) &gt; 0 ) {
00363         disp_one(rec_no,CLEAR_HIGH);
00364         rec_no = rc;
00365 
00366         <span class="keywordflow">if</span>( disp_frame &amp;&amp; x_max_rec==1 ) {            <span class="comment">// only use record as scroller unit when it's a vertical browser with frame, refer to scroll_bar.init() in VBrowse::init_var()</span>
00367             <span class="keywordflow">if</span>( rec_no &lt; top_rec_no ) {
00368                 top_rec_no = rec_no;
00369                 disp_all();
00370             }
00371 
00372             <span class="keywordflow">else</span> <span class="keywordflow">if</span>( rec_no &gt;= top_rec_no + disp_max_rec ) {
00373                 top_rec_no = rec_no - disp_max_rec + 1;
00374                 <span class="keywordflow">if</span>( top_rec_no &lt; 1 )
00375                     top_rec_no = 1;
00376                 disp_all();
00377             }
00378 
00379             <span class="keywordflow">else</span>
00380                 disp_one(rec_no,DISP_HIGH);
00381         }
00382         <span class="keywordflow">else</span> {
00383             top_rec_no = rc;
00384             disp_all();
00385         }
00386 
00387         <span class="keywordflow">return</span> rec_no;
00388     }
00389 
00390     <span class="keywordflow">return</span> 0;
00391 }
00392 
00393 <span class="comment">//----------- End of function VBrowse::detect -------//</span>
00394 
00395 <span class="comment">//---------- Begin of function VBrowse::detect_pull ---------//</span>
<a name="l00399"></a><a class="code" href="classVBrowse.html#b4">00399</a> <span class="comment">int VBrowse::detect_pull() {</span>
00400     <span class="keywordflow">if</span>( press_record ) {                            <span class="comment">// test whether user continue pressing it</span>
00401         press_record = mouse.left_press;
00402 
00403         <span class="keywordflow">if</span>( press_record )
00404             press_vbrowse_ptr = <span class="keyword">this</span>;
00405     }
00406 
00407     <span class="keywordflow">if</span>( !( mouse.left_press || mouse.click_count() ) )
00408         <span class="keywordflow">return</span> 0;
00409 
00410     <span class="keywordflow">if</span>( !press_record )
00411         <span class="keywordflow">return</span> 0;
00412 
00413     <span class="comment">//--------- detect for pulling record upwards ---------//</span>
00414 
00415     <span class="keywordflow">if</span>( ( x_max_rec==1 &amp;&amp; mouse.press_area( x1, 0 , x2, y1 ) ) ||
00416         ( y_max_rec==1 &amp;&amp; mouse.press_area(  0, y1, x1, y2 ) ) ) {
00417         <span class="keywordflow">if</span>( rec_no &gt; 1 ) {
00418             disp_one(rec_no, CLEAR_HIGH);
00419 
00420             rec_no--;
00421             <span class="keywordflow">if</span>( rec_no &lt; top_rec_no )
00422                 top_rec_no--;
00423 
00424             disp_all();
00425             <span class="keywordflow">return</span> 1;
00426         }
00427     }
00428 
00429     <span class="comment">//---- detect for pressing down button or pulling record downwards ---//</span>
00430 
00431     <span class="keywordflow">if</span>( ( x_max_rec==1 &amp;&amp; mouse.press_area( x1, y2, x2, <a class="code" href="OVGA_8H.html#a1">VGA_HEIGHT</a>-1 ) ) ||
00432         ( y_max_rec==1 &amp;&amp; mouse.press_area( x2, y1, <a class="code" href="OVGA_8H.html#a0">VGA_WIDTH</a>-1, y2  ) ) ) {
00433         <span class="keywordflow">if</span>( rec_no &lt; total_rec_num ) {
00434             disp_one(rec_no, CLEAR_HIGH);
00435 
00436             rec_no++;
00437             <span class="keywordflow">if</span>( rec_no &gt;= top_rec_no+disp_max_rec )
00438                 top_rec_no++;
00439 
00440             disp_all();
00441             <span class="keywordflow">return</span> 1;
00442         }
00443     }
00444 
00445     <span class="keywordflow">return</span> 0;
00446 }
00447 
00448 <span class="comment">//---------- End of function VBrowse::detect_pull ---------//</span>
00449 
00450 <span class="comment">//--------- Begin of function VBrowse::detect_right ------//</span>
<a name="l00457"></a><a class="code" href="classVBrowse.html#a7">00457</a> <span class="comment">int VBrowse::detect_right() {</span>
00458     <span class="keywordflow">if</span>( state == 0 || none_record )                 <span class="comment">// closed</span>
00459         <span class="keywordflow">return</span> 0;
00460 
00461     <span class="comment">// 1-right mouse button</span>
00462     <span class="keywordflow">if</span>( mouse.single_click( ix1, iy1, ix2, iy2, 1 ) ) {
00463         <span class="keywordtype">int</span> recNo;
00464 
00465         recNo = top_rec_no +
00466             (mouse.click_y(1)-iy1) / (rec_height+rec_y_space) * x_max_rec +
00467             (mouse.click_x(1)-ix1) / (rec_width +rec_x_space);
00468 
00469         <span class="keywordflow">if</span>( recNo &lt;= top_rec_no-1+disp_max_rec ) {
00470             disp_one(rec_no,CLEAR_HIGH);
00471             disp_one(recNo, DISP_HIGH);                 <span class="comment">// 2 means display record content only</span>
00472 
00473             rec_no = recNo;
00474             <span class="keywordflow">return</span> recNo;
00475         }
00476     }
00477 
00478     <span class="keywordflow">return</span> 0;
00479 }
00480 
00481 <span class="comment">//----------- End of function VBrowse::detect_right -------//</span>
00482 
00483 <span class="comment">//-------- Begin of function VBrowse::disp_all ----------//</span>
<a name="l00487"></a><a class="code" href="classVBrowse.html#b1">00487</a> <span class="comment">void VBrowse::disp_all() {</span>
00488     <span class="keywordtype">int</span> recNo;
00489 
00490     <span class="comment">// clear background</span>
00491     <a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;<a class="code" href="classVgaBuf.html#a27">bar</a>( ix1, iy1, ix2, iy2, VBROWSE_COLOR_BACK );
00492 
00493     <span class="keywordtype">int</span> scrollRecno = (disp_frame &amp;&amp; x_max_rec==1) ? rec_no : top_rec_no;
00494 
00495     scroll_bar.refresh( scrollRecno, 1, disp_max_rec,
00496                         (disp_frame &amp;&amp; x_max_rec==1 ? 1 : disp_max_rec),
00497                         total_rec_num );
00498 
00499     <span class="keywordflow">for</span>( recNo=top_rec_no ; recNo&lt;=total_rec_num &amp;&amp; recNo&lt;top_rec_no+disp_max_rec ; recNo++ ) {
00500         disp_one( recNo, DISP_REC );
00501 
00502         <span class="keywordflow">if</span>( recNo == rec_no )
00503             disp_one( recNo, DISP_HIGH );
00504     }
00505 }
00506 
00507 <span class="comment">//--------- End of function VBrowse::disp_all ----------//</span>
00508 
00509 <span class="comment">//-------- Begin of function VBrowse::disp_one ----------//</span>
<a name="l00516"></a><a class="code" href="classVBrowse.html#b2">00516</a> <span class="comment">void VBrowse::disp_one(int recNo, int dispType) {</span>
00517     <span class="keywordflow">if</span>( none_record )
00518         <span class="keywordflow">return</span>;
00519 
00520     <span class="keywordtype">int</span> x,y;
00521 
00522     y = iy1 + (recNo-top_rec_no)/x_max_rec * (rec_height+rec_y_space);
00523     x = ix1 + (recNo-top_rec_no)%x_max_rec * (rec_width+rec_x_space);
00524 
00525     <span class="comment">//---- put a outline rect around the record if it is highlight ---//</span>
00526 
00527     <span class="keywordflow">if</span>( disp_frame &amp;&amp; dispType == CLEAR_HIGH )
00528         <a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;<a class="code" href="classVgaBuf.html#a39">rect</a>( x-2, y-2, x+rec_width+1, y+rec_height+1, 2, VBROWSE_COLOR_BACK );
00529 
00530     <span class="comment">// ## chwg1111</span>
00531     <span class="comment">//   if( disp_frame &amp;&amp; dispType == DISP_HIGH )</span>
00532     <span class="comment">//          vga_front.d3_panel_up( x-2, y-2, x+rec_width-2, y+rec_height-2, 2 );</span>
00533 
00534     <span class="comment">//  if( dispType == DISP_REC )</span>
00535     disp_rec( recNo, x, y, <a class="code" href="Gamedef_8h.html#a71a16">INFO_REPAINT</a> );          <span class="comment">// call user defined function</span>
00536 
00537     <span class="keywordflow">if</span>( disp_frame &amp;&amp; dispType == DISP_HIGH ) {
00538         <span class="comment">// ## chwg1111</span>
00539         <span class="comment">//              Vga::active_buf-&gt;rect( x-2, y-2, x+rec_width+1, y+rec_height+1, 2, VBROWSE_COLOR_HIGH );</span>
00540 
00541         <span class="keywordtype">int</span> scrollRecno = (disp_frame &amp;&amp; x_max_rec==1) ? recNo : top_rec_no;
00542 
00543         scroll_bar.refresh( scrollRecno, 0, disp_max_rec,
00544                             (disp_frame &amp;&amp; x_max_rec==1 ? 1 : disp_max_rec),
00545                             total_rec_num );
00546 
00547         <span class="comment">// ## chwg1111</span>
00548         user_interface.adjust_brightness( x-2, y-2, x+rec_width-2, y+rec_height-2,-2);
00549     }
00550 }
00551 
00552 <span class="comment">//--------- End of function VBrowse::disp_one ----------//</span>
00553 
00554 <span class="comment">//-------- Begin of function VBrowse::disp_rec --------//</span>
<a name="l00556"></a><a class="code" href="classVBrowse.html#b3">00556</a> <span class="comment">void VBrowse::disp_rec(int recNo, int x, int y, int refreshFlag) {</span>
00557     (*disp_rec_func)( recNo, x, y, refreshFlag );   <span class="comment">// call user defined function</span>
00558 }
00559 
00560 <span class="comment">//----------- End of function VBrowse::disp_rec -----------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:33 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
