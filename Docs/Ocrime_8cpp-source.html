<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Ocrime.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Ocrime.cpp</h1><a href="Ocrime_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00002 <span class="preprocessor">#include &lt;OCONFIG.H&gt;</span>
00003 <span class="preprocessor">#include &lt;OCRIME.H&gt;</span>
00004 <span class="preprocessor">#include &lt;OWORLDMT.H&gt;</span>
00005 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;<a class="code" href="COLOR_8H.html">COLOR.H</a>&gt;</span>
00007 <span class="preprocessor">#include &lt;OFONT.H&gt;</span>
00008 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00009 <span class="preprocessor">#include &lt;<a class="code" href="OMOUSE2_8H.html">OMOUSE2.H</a>&gt;</span>
00010 <span class="preprocessor">#include &lt;OIFACE.H&gt;</span>
00011 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>
00012 <span class="preprocessor">#include &lt;<a class="code" href="OGRPHMTH_8H.html">OGRPHMTH.H</a>&gt;</span>
00013 <span class="preprocessor">#include &lt;OFACILIT.H&gt;</span>
00014 <span class="preprocessor">#include &lt;OBUTTON.H&gt;</span>
00015 <span class="preprocessor">#include &lt;OSPINNER.H&gt;</span>
00016 <span class="preprocessor">#include &lt;OFINANCE.H&gt;</span>
00017 
00018 <span class="keyword">enum</span> {                                            <span class="comment">// screen coordinates</span>
00019     <a class="code" href="Ocrime_8cpp.html#a13a3">REPORT_X1</a> = <a class="code" href="Oworldmt_8h.html#a12">ZOOM_X1</a>+15,
00020     <a class="code" href="Ocrime_8cpp.html#a13a4">REPORT_Y1</a> = <a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a>+25,
00021     <a class="code" href="Ocrime_8cpp.html#a13a5">REPORT_X2</a> = <a class="code" href="Oworldmt_8h.html#a14">ZOOM_X2</a>-15,
00022     <a class="code" href="Ocrime_8cpp.html#a13a6">REPORT_Y2</a> = <a class="code" href="Oworldmt_8h.html#a15">ZOOM_Y2</a>-55
00023 };
00024 
00025 <span class="keyword">enum</span> {
00026     <a class="code" href="Ocrime_8cpp.html#a14a7">BUTTON_X0</a> = <a class="code" href="Ocrime_8cpp.html#a13a3">REPORT_X1</a>+100,
00027     <a class="code" href="Ocrime_8cpp.html#a14a8">BOTTOM_Y1</a> = <a class="code" href="Ocrime_8cpp.html#a13a6">REPORT_Y2</a>+25,
00028 };
00029 
00030 <span class="keyword">enum</span> {
00031     <a class="code" href="Ocrime_8cpp.html#a15a9">BOTTOM_BUTTON_WIDTH</a> = 80,
00032     <a class="code" href="Ocrime_8cpp.html#a15a10">BOTTOM_BUTTON_HEIGHT</a> = 25,
00033     <a class="code" href="Ocrime_8cpp.html#a15a11">BOTTOM_BUTTON_DISTANCE</a> = 10,
00034 };
00035 
00036 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00037 <span class="preprocessor"></span><span class="keyword">enum</span> {
00038     MODE_FINANCIAL_BOX1_HEIGHT = 10,
00039     MODE_FINANCIAL_BOX2_HEIGHT = 270,
00040     MODE_FINANCIAL_GRAPH_WIDTH = 400,
00041     MODE_FINANCIAL_GRAPH_HEIGHT = 160,
00042     MODE_FINANCIAL_LEGEND_HEIGHT = 26,
00043     MODE_FINANCIAL_LEGEND_WIDTH = 400,
00044 
00045     MODE_FINANCIAL_TAB1 = 15,
00046     MODE_FINANCIAL_TAB2 = 280,
00047     MODE_FINANCIAL_TAB3 = 360,
00048     MODE_FINANCIAL_TAB4 = 490,
00049     MODE_FINANCIAL_TAB5 = 520,
00050     MODE_FINANCIAL_TAB6 = 600,
00051 };
00052 
00053 <span class="keyword">enum</span> {
00054     FINANCIAL_BUTTON_X1 = <a class="code" href="Ocrime_8cpp.html#a13a3">REPORT_X1</a>+MODE_FINANCIAL_TAB4,
00055     FINANCIAL_BUTTON_Y1 = <a class="code" href="Ocrime_8cpp.html#a13a4">REPORT_Y1</a>+MODE_FINANCIAL_BOX1_HEIGHT+180,
00056     FINANCIAL_BUTTON_X2 = <a class="code" href="Ocrime_8cpp.html#a13a5">REPORT_X2</a>,
00057     FINANCIAL_BUTTON_Y2 = <a class="code" href="Ocrime_8cpp.html#a13a6">REPORT_Y2</a>-40
00058 };
00059 
00060 <span class="keyword">enum</span> {
00061     FINANCIAL_BUTTON_WIDTH = 200,
00062     FINANCIAL_BUTTON_HEIGHT = 23,
00063     FINANCIAL_BUTTON_DISTANCE
00064     = (FINANCIAL_BUTTON_Y2-FINANCIAL_BUTTON_Y1-FINANCIAL_BUTTON_HEIGHT*4)/3
00065 };
00066 <span class="preprocessor">#endif</span>
00067 <span class="preprocessor"></span>
00068 <span class="keyword">enum</span> {                                            <span class="comment">// the bg image id</span>
00069     <a class="code" href="Ocrime_8cpp.html#a16a12">BG_PIC_ID</a> = 2
00070 };
00071 
00072 <span class="keyword">static</span> <span class="keywordtype">char</span> crime_init_flag;
00073 <span class="keyword">static</span> <a class="code" href="classGraphMonth.html">GraphMonth</a> crime_index;
00074 
00075 <span class="keyword">static</span> <span class="keywordtype">char</span> *legend_label[] = {
00076     <span class="stringliteral">"Crime Index"</span>,
00077 };
00078 
00079 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00080 <span class="preprocessor"></span><span class="keyword">static</span> <a class="code" href="classSpinner.html">Spinner</a> financial_spinner_budget1;
00081 
00082 <span class="keyword">static</span> <a class="code" href="classButtonGroup.html">ButtonGroup</a> financial_button_group(3);
00083 <span class="keyword">static</span> <span class="keywordtype">short</span> *financial_button_up_bitmap[3];
00084 <span class="keyword">static</span> <span class="keywordtype">short</span> *financial_button_down_bitmap[3];
00085 <span class="keyword">static</span> <span class="keywordtype">char</span> *financial_button_label[] = {
00086     <span class="stringliteral">"Consider for next year"</span>, <span class="stringliteral">"Promise for next year"</span>, <span class="stringliteral">"Implement now"</span>
00087 };
00088 <span class="preprocessor">#endif</span>
00089 <span class="preprocessor"></span>
00090 <span class="comment">//------- Begin of function Crime::Crime -----------//</span>
<a name="l00092"></a><a class="code" href="classCrime.html#a0">00092</a> <span class="comment">Crime::Crime() {</span>
00093     init();
00094 
00095 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00096 <span class="preprocessor"></span>    <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; 3; ++i ) {
00097         financial_button_up_bitmap[i] = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00098         financial_button_down_bitmap[i] = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00099     }
00100 <span class="preprocessor">#endif</span>
00101 <span class="preprocessor"></span>}
00102 
00103 <span class="comment">//--------- End of function Crime::Crime -----------//</span>
00104 
00105 <span class="comment">//------- Begin of function Crime::~Crime -----------//</span>
<a name="l00107"></a><a class="code" href="classCrime.html#a1">00107</a> <span class="comment">Crime::~Crime() {</span>
00108     deinit();
00109 }
00110 
00111 <span class="comment">//--------- End of function Crime::~Crime -----------//</span>
00112 
00113 <span class="comment">//------- Begin of function Crime::deinit ---------------//</span>
<a name="l00115"></a><a class="code" href="classCrime.html#a3">00115</a> <span class="comment">void Crime::deinit() {</span>
00116     crime_index.<a class="code" href="classGraphMonth.html#a7">deinit</a>();
00117 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00118 <span class="preprocessor"></span>    financial_spinner_budget1.<a class="code" href="classSpinner.html#a3">deinit</a>();
00119     financial_button_group.<a class="code" href="classButtonGroup.html#a2">deinit_buttons</a>();
00120 
00121     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; 3; ++i ) {
00122         <span class="keywordflow">if</span>( financial_button_up_bitmap[i] ) {
00123             <a class="code" href="ALL_8H.html#a8">mem_del</a>(financial_button_up_bitmap[i]);
00124             financial_button_up_bitmap[i] = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00125         }
00126         <span class="keywordflow">if</span>( financial_button_down_bitmap[i] ) {
00127             <a class="code" href="ALL_8H.html#a8">mem_del</a>(financial_button_down_bitmap[i]);
00128             financial_button_down_bitmap[i] = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00129         }
00130     }
00131 <span class="preprocessor">#endif</span>
00132 <span class="preprocessor"></span>    crime_init_flag = 0;
00133 }
00134 
00135 <span class="comment">//--------- End of function Crime::deinit ---------------//</span>
00136 
00137 <span class="comment">//------- Begin of function Crime::init -----------------//</span>
<a name="l00139"></a><a class="code" href="classCrime.html#a2">00139</a> <span class="comment">void Crime::init() {</span>
00140     crime_init_flag = 0;
00141     spinner_var1 = 0.0;
00142 }
00143 
00144 <span class="comment">//--------- End of function Crime::init -----------------//</span>
00145 
00146 <span class="comment">//---------- Begin of function Crime::eval_letter_report ------------//</span>
<a name="l00148"></a><a class="code" href="classCrime.html#a4">00148</a> <span class="comment">void Crime::crime_report(int refreshFlag) {</span>
00149     <span class="keywordtype">int</span> tab1=<a class="code" href="Ocrime_8cpp.html#a13a3">REPORT_X1</a>,tab2=<a class="code" href="Ocrime_8cpp.html#a13a3">REPORT_X1</a>+100,
00150         tab3=<a class="code" href="Ocrime_8cpp.html#a13a3">REPORT_X1</a>+200,tab4=<a class="code" href="Ocrime_8cpp.html#a13a3">REPORT_X1</a>+700;
00151     <span class="keywordtype">int</span> vtab1=<a class="code" href="Ocrime_8cpp.html#a13a4">REPORT_Y1</a>+15,vtab2=<a class="code" href="Ocrime_8cpp.html#a13a4">REPORT_Y1</a>+70,
00152         vtab3=<a class="code" href="Ocrime_8cpp.html#a13a4">REPORT_Y1</a>+100,vtab4=<a class="code" href="Ocrime_8cpp.html#a13a4">REPORT_Y1</a>+350;
00153 
00154     <span class="keyword">static</span> <span class="keywordtype">int</span> data_num=HISTORY_MONTH_COUNT;
00155     <span class="keywordtype">int</span> dataArray1[HISTORY_MONTH_COUNT];
00156 
00157     vga.use_back();
00158 
00159     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;HISTORY_MONTH_COUNT;i++)
00160         dataArray1[i]=facility_office.crime_index[i];
00161 
00162     sys.is_institution_report=1;
00163     <span class="keywordflow">if</span> (refreshFlag == <a class="code" href="Gamedef_8h.html#a71a16">INFO_REPAINT</a>) {
00164         <span class="keywordflow">if</span>(crime_init_flag )
00165             deinit();
00166 
00167         <span class="comment">//------------- paint the background ----------------//</span>
00168         <span class="keywordflow">if</span> (!crime_init_flag) {
00169             user_interface.bg_img(<a class="code" href="Ocrime_8cpp.html#a16a12">BG_PIC_ID</a>, &amp;vga_back);
00170             info.disp_column_bitmap(&amp;vga_back);
00171             crime_init_flag = 1;
00172             font_charts.put(tab3+120,<a class="code" href="Ocrime_8cpp.html#a13a4">REPORT_Y1</a>,<span class="stringliteral">"Crime Report"</span>);
00173             user_interface.brighten(
00174                 <a class="code" href="Ocrime_8cpp.html#a13a3">REPORT_X1</a>+200, <a class="code" href="Ocrime_8cpp.html#a13a4">REPORT_Y1</a>+50,
00175                 <a class="code" href="Ocrime_8cpp.html#a13a5">REPORT_X2</a>-220, <a class="code" href="Ocrime_8cpp.html#a13a6">REPORT_Y2</a>-50);
00176 
00177             crime_index.<a class="code" href="classGraphMonth.html#a2">init</a>(
00178                 <a class="code" href="Ocrime_8cpp.html#a13a3">REPORT_X1</a>+20, <a class="code" href="Ocrime_8cpp.html#a13a4">REPORT_Y1</a>+50,
00179                 <a class="code" href="Ocrime_8cpp.html#a13a5">REPORT_X2</a>-220, <a class="code" href="Ocrime_8cpp.html#a13a6">REPORT_Y2</a>-50,
00180                 1, &amp;data_num, dataArray1,1,
00181                 <a class="code" href="OHELP_8H.html#a0">NULL</a>, <a class="code" href="OHELP_8H.html#a0">NULL</a>, legend_label, 1, 1, 1, 4);
00182             crime_index.<a class="code" href="classGraphMonth.html#a8">paint</a>();
00183 
00184 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00185 <span class="preprocessor"></span>
00186             <span class="comment">// print "Adjust administration budget"</span>
00187             font_charts.center_put( FINANCIAL_BUTTON_X1, 200,
00188                                     FINANCIAL_BUTTON_X1+FINANCIAL_BUTTON_WIDTH, 230,
00189                                     <span class="stringliteral">"Adjust administration budget"</span> );
00190 
00191             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++) {
00192                 financial_button_up_bitmap[i] = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00193                 financial_button_down_bitmap[i] = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00194             }
00195 
00196             <span class="keywordtype">short</span> y = FINANCIAL_BUTTON_Y1;
00197             <span class="keywordflow">for</span> (i = 0; i &lt; 3; i++, y+=FINANCIAL_BUTTON_HEIGHT+FINANCIAL_BUTTON_DISTANCE) {
00198                 user_interface.create_button_bitmap(FINANCIAL_BUTTON_X1,y,
00199                                                     FINANCIAL_BUTTON_X1+FINANCIAL_BUTTON_WIDTH,y+FINANCIAL_BUTTON_HEIGHT,
00200                                                     financial_button_label[i], &amp;financial_button_up_bitmap[i],
00201                                                     &amp;financial_button_down_bitmap[i], &amp;vga_back);
00202 
00203                 financial_button_group[i].create_bitmapW(FINANCIAL_BUTTON_X1,y,
00204                                                          FINANCIAL_BUTTON_X1+FINANCIAL_BUTTON_WIDTH,y+FINANCIAL_BUTTON_HEIGHT,
00205                                                          (financial_button_up_bitmap[i])+4,0);
00206             }
00207 
00208             financial_spinner_budget1.<a class="code" href="classSpinner.html#a2">init</a>(
00209                 <a class="code" href="Ocrime_8cpp.html#a13a3">REPORT_X1</a>+MODE_FINANCIAL_TAB4+30,
00210                 <a class="code" href="Ocrime_8cpp.html#a13a4">REPORT_Y1</a>+MODE_FINANCIAL_BOX1_HEIGHT+140,
00211                 <a class="code" href="Ocrime_8cpp.html#a13a3">REPORT_X1</a>+MODE_FINANCIAL_TAB4+150,
00212                 <a class="code" href="Ocrime_8cpp.html#a13a4">REPORT_Y1</a>+MODE_FINANCIAL_BOX1_HEIGHT+170 ,
00213                 <span class="comment">//### begin zhoubin 02/25/99</span>
00214                 &amp;crime.spinner_var1,
00215                 <span class="comment">//### end zhoubin 02/25/99</span>
00216                 <span class="comment">//                              -100.0f,100.0f,0.1f,0,NULL,23);</span>
00217                 -5.0f,5.0f,0.1f,0,<a class="code" href="OHELP_8H.html#a0">NULL</a>,25);               <span class="comment">//## chea 170999</span>
00218 
00219             font_chartsm.put_paragraph( <a class="code" href="Ocrime_8cpp.html#a13a3">REPORT_X1</a>+20, <a class="code" href="Ocrime_8cpp.html#a13a6">REPORT_Y2</a>-30, <a class="code" href="Ocrime_8cpp.html#a13a5">REPORT_X2</a>-220, <a class="code" href="Ocrime_8cpp.html#a13a6">REPORT_Y2</a>+10,
00220                                         <span class="stringliteral">"Increased crime may be combated by increasing money spent on administration, which includes spending on campus security."</span> );
00221 <span class="preprocessor">#endif</span>
00222 <span class="preprocessor"></span>        }
00223     }
00224     crime_index.<a class="code" href="classGraphMonth.html#a9">refresh</a>();
00225 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00226 <span class="preprocessor"></span>    <span class="keywordflow">for</span> ( i=0; i&lt;3; i++ )
00227         financial_button_group[i].<a class="code" href="classButtonGroup.html#a3">paint</a>();
00228     financial_spinner_budget1.<a class="code" href="classSpinner.html#a4">paint</a>();
00229 
00230     <span class="keywordflow">for</span>(i=0;i&lt;3;i++) {
00231         financial_button_group[i].pop();
00232         financial_button_group[i].body_ptr=
00233             (<span class="keywordtype">void</span>*)(financial_button_up_bitmap[i]+4);
00234     }
00235 <span class="preprocessor">#endif</span>
00236 <span class="preprocessor"></span>    <span class="comment">//------- blt the back buffer to front buffer -------//</span>
00237     vga.blt_buf(<a class="code" href="Oworldmt_8h.html#a12">ZOOM_X1</a>, <a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a>, <a class="code" href="Oworldmt_8h.html#a14">ZOOM_X2</a>, <a class="code" href="Oworldmt_8h.html#a15">ZOOM_Y2</a>);
00238 }
00239 
00240 <span class="comment">//---------- End of function Development::eval_letter_report ------------//</span>
00241 
00243 
<a name="l00244"></a><a class="code" href="classCrime.html#a5">00244</a> <span class="keywordtype">int</span> <a class="code" href="classCrime.html#a5">Crime::crime_detect</a>() {
00245     <span class="keywordtype">int</span> tab1=<a class="code" href="Ocrime_8cpp.html#a13a3">REPORT_X1</a>,tab2=<a class="code" href="Ocrime_8cpp.html#a13a3">REPORT_X1</a>+100,
00246         tab3=<a class="code" href="Ocrime_8cpp.html#a13a3">REPORT_X1</a>+200,tab4=<a class="code" href="Ocrime_8cpp.html#a13a3">REPORT_X1</a>+600;
00247     <span class="keywordtype">int</span> vtab1=<a class="code" href="Ocrime_8cpp.html#a13a4">REPORT_Y1</a>+15,vtab2=<a class="code" href="Ocrime_8cpp.html#a13a4">REPORT_Y1</a>+70,
00248         vtab3=<a class="code" href="Ocrime_8cpp.html#a13a4">REPORT_Y1</a>+100,vtab4=<a class="code" href="Ocrime_8cpp.html#a13a4">REPORT_Y1</a>+350;
00249 
00250     <span class="keywordflow">if</span> (financial_spinner_budget1.<a class="code" href="classSpinner.html#a6">detect</a>())
00251         <span class="keywordflow">return</span> 1;
00252     <span class="comment">//  if (financial_spinner_budget2.detect())</span>
00253     <span class="comment">//          return 1;</span>
00254 
00255     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;3;i++)
00256         <span class="keywordflow">if</span>(financial_button_group[i].<a class="code" href="classButtonGroup.html#a4">detect</a>()) {
00257             financial_button_group[i].body_ptr =
00258                 (<span class="keywordtype">void</span> *) (financial_button_down_bitmap[i] + 4);
00259             <span class="comment">//  Communicate with Sim Engine</span>
00260             finance.change_budget(i,<span class="keyword">false</span>, <a class="code" href="Ofinance_8h.html#a104a52">AC_ADMINISTRATION_N_OTHER_OPERATING_EXPENSE</a>,(*financial_spinner_budget1.<a class="code" href="classSpinner.html#m7">var_ptr</a>));
00261             <span class="comment">//##        begin zhoubin 000329</span>
00262             *financial_spinner_budget1.<a class="code" href="classSpinner.html#m7">var_ptr</a>=0;
00263             <span class="comment">//##        end zhoubin 000329</span>
00264         }
00265 
00266     <span class="keywordflow">if</span> (!crime_init_flag)
00267         <span class="keywordflow">return</span> 0;
00268 
00269     <span class="keywordflow">return</span> 0;
00270 }
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:20 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
