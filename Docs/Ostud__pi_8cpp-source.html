<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Ostud_pi.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Ostud_pi.cpp</h1><a href="Ostud__pi_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OSTUD_PI.cpp</span>
00002 <span class="comment">//Description : STUDENT Class Definition</span>
00003 <span class="comment">//Owner       : Fred</span>
00004 
00005 <span class="preprocessor">#include &lt;OMATH.H&gt;</span>
00006 
00007 <span class="preprocessor">#include &lt;ODEPT.H&gt;</span>
00008 <span class="preprocessor">#include &lt;<a class="code" href="ODEPTRES_8H.html">ODEPTRES.H</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;OENROLL.H&gt;</span>                              <span class="comment">// student_count</span>
00010 <span class="preprocessor">#include &lt;<a class="code" href="OSCHLRES_8H.html">OSCHLRES.H</a>&gt;</span>
00011 <span class="preprocessor">#include &lt;OPSCHOOL.H&gt;</span>                             <span class="comment">// subscore[]; player_peer_school</span>
00012 <span class="preprocessor">#include &lt;<a class="code" href="OPEERSCH_8H.html">OPEERSCH.H</a>&gt;</span>
00013 <span class="preprocessor">#include &lt;OFINANCE.H&gt;</span>
00014 <span class="preprocessor">#include &lt;OATHLETI.H&gt;</span>
00015 <span class="preprocessor">#include &lt;OLIBTECH.H&gt;</span>
00016 <span class="preprocessor">#include &lt;OCHANCE.H&gt;</span>
00017 <span class="preprocessor">#include &lt;OSTUDENT.H&gt;</span>
00018 
00019 <span class="keyword">static</span> <a class="code" href="classStudentArray.html">StudentArray</a> *get_student_array(<span class="keywordtype">int</span> deptRecno) {
00020     <span class="keywordflow">if</span> (deptRecno)
00021         <span class="keywordflow">return</span> &amp;(department_array[deptRecno]-&gt;student_array);
00022     <span class="keywordflow">else</span>
00023         <span class="keywordflow">return</span> &amp;department_res.general_dept.student_array;
00024 }
00025 
00026 <span class="comment">//---------- Begin of function Student::update_history -----------//</span>
<a name="l00032"></a><a class="code" href="classStudent.html#a9">00032</a> <span class="comment">void Student::update_history(char update_flag) {</span>
00033     <span class="keywordflow">switch</span> (update_flag) {
00034     <span class="keywordflow">case</span> UPDATE_MONTH:
00035         calc_satisfaction_student_life();
00036         calc_satisfaction_athletics();
00037         calc_satisfaction_overall();
00038         calc_faculty_workweek();
00039         <span class="keywordflow">break</span>;
00040     <span class="keywordflow">case</span> UPDATE_TRIMESTER:
00041         calc_satisfaction_academic();
00042 
00043         <span class="comment">// called when value is needed</span>
00044         <span class="comment">//calc_probability_change_major();</span>
00045         <span class="comment">//calc_multiplier_on_dropout_prob();</span>
00046         <span class="keywordflow">break</span>;
00047     <span class="keywordflow">case</span> UPDATE_YEAR:
00048         reaction_summer_course_last = reaction_summer_course;
00049         <span class="keywordflow">break</span>;
00050     <span class="keywordflow">case</span> UPDATE_ALL:
00051         update_history(UPDATE_MONTH);
00052         update_history(UPDATE_TRIMESTER);
00053         update_history(UPDATE_YEAR);
00054         <span class="keywordflow">break</span>;
00055     <span class="keywordflow">default</span>:
00056         <a class="code" href="ALL_8H.html#a1">err_here</a>();
00057         <span class="keywordflow">break</span>;
00058     }
00059 }
00060 
00061 <span class="comment">//---------- End of function Student::update_history -----------//</span>
00062 
00063 <span class="comment">//---------- Begin of function Student::calc_satisfaction_academic -----------//</span>
<a name="l00064"></a><a class="code" href="classStudent.html#a10">00064</a> <span class="keywordtype">void</span> <a class="code" href="classStudent.html#a10">Student::calc_satisfaction_academic</a>() {
00065     <span class="comment">// for SL 1-3</span>
00066 <span class="preprocessor">#define VAR_COUNT_SL1 5</span>
00067 <span class="preprocessor"></span>    <span class="keywordtype">int</span> i, count;
00068     <span class="keywordtype">float</span> input[VAR_COUNT_SL1];
00069     memset(input, 0, <span class="keyword">sizeof</span>(input));
00070 
00071     <span class="comment">//--------------//</span>
00072     <span class="comment">// ave educational quality of departments in which the student is taking courses this trimester: CAN WE APPLY THIS FUNCTION SEPARATELY TO EACH DEPARTMENT AND WEIGHT THE RESULT BY THE NUMBER OF COURSES TAKEN IN THE DEPARTMENT BY THE STUDENT SPRITE?</span>
00073 
00074     <span class="keywordflow">for</span> (count=0, i=department_array.size(); i&gt;0; i--) {
00075         <span class="keywordflow">if</span> ( department_array.is_deleted(i) )
00076             <span class="keywordflow">continue</span>;
00077 
00078         <span class="keywordflow">if</span> ( <a class="code" href="classStudent.html#m15">course_taking_array</a>[i-1] &gt; 0 ) {
00079             input[0] += department_array[i]-&gt;p_educational_quality;
00080             count++;
00081         }
00082     }
00083     <span class="keywordflow">if</span> ( count &gt; 0 )
00084         input[0] /= count;
00085 
00086     <span class="comment">//--------------//</span>
00087     <span class="comment">//  input[1] = float( float(finance.expense_array[AC_LIBRARIES].total) / finance.total_operating_expense.total);</span>
00088 
00089     <span class="comment">//## chwg290699</span>
00090 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00091 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( <a class="code" href="classStudent.html#m9">initializationValueAC_LIBRARIES</a> == 0 )
00092 <span class="preprocessor">#else</span>
00093 <span class="preprocessor"></span>        <span class="keywordflow">if</span>(info.game_year==1)
00094             <span class="keywordflow">if</span>(info.game_month==9)
00095 <span class="preprocessor">#endif</span>
00096 <span class="preprocessor"></span>                <a class="code" href="classStudent.html#m9">initializationValueAC_LIBRARIES</a>=(float)finance.expense_array[<a class="code" href="Ofinance_8h.html#a104a47">AC_LIBRARIES</a>].total;
00097     input[1] = float(finance.expense_array[<a class="code" href="Ofinance_8h.html#a104a47">AC_LIBRARIES</a>].total)/
00098         (<a class="code" href="classStudent.html#m9">initializationValueAC_LIBRARIES</a>*(1+math.get_random_snd(0.0f, <a class="code" href="Opschool_8h.html#a1">PSCH_SD</a>(0.05f))));
00099     <span class="comment">//--------------//</span>
00100     <span class="keywordflow">if</span> (department_recno)
00101         input[2] = (department_array[<a class="code" href="classStudent.html#m1">department_recno</a>]-&gt;p_tech_utilization);
00102     <span class="keywordflow">else</span>
00103         input[2] = library_tech_office.tech_utilization;
00104 
00105     <span class="comment">//--------------//</span>
00106     <span class="comment">//course denials this tri</span>
00107     input[3] = <a class="code" href="classStudent.html#m17">course_denials_this_trimester</a>;
00108 
00109     <span class="comment">//--------------//</span>
00110     <span class="comment">//course failures this tri</span>
00111     input[4] = <a class="code" href="classStudent.html#m18">course_failures_this_trimester</a>;
00112 
00113     <span class="comment">//--------------//</span>
00114     input[0] = math.dual_response_func(1,50,100,29.30f,32.83f,20.19f,76.09f, input[0]);
00115     <span class="comment">//  input[1] = math.single_response_func(1,100, 3.9900f,1.8250f, input[1]);</span>
00116     <span class="comment">// ## chwg290699</span>
00117     input[1] = math.single_response_func(1,100, 0.5200f,1.030f, input[1]);
00118     input[2] = math.dual_response_func(0,49.8f,100,40.49f,29.41f,20.04f,85.05f, input[2]);
00119     input[3] = math.single_response_func(1,100,-1.4230f,0.9125f, input[3]);
00120     input[4] = math.single_response_func(1,100,-1.1857f,0.7756f, input[4]);
00121 
00122     <span class="keywordtype">float</span> newValue = 0;
00123     <span class="keywordtype">float</span> weight[VAR_COUNT_SL1] = {0.40f, 0.10f, 0.1f, 0.20f, 0.20f, };
00124 
00125     <span class="keywordflow">for</span>(i=0; i&lt;VAR_COUNT_SL1; i++)
00126         newValue += weight[i] * input[i];
00127 
00128     <span class="comment">//-------------------// 980924</span>
00129     <span class="comment">// for SL 1-3</span>
00130     <span class="keywordflow">if</span> ( <a class="code" href="classStudent.html#m2">student_level</a> &lt;= <a class="code" href="Ostudent_8h.html#a32a5">MASTER</a> ) {
00131     }
00132     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="classStudent.html#m2">student_level</a> == <a class="code" href="Ostudent_8h.html#a32a6">DOCTOR</a> ) {
00133         newValue = 0.5f * newValue + 0.5f * (<a class="code" href="classStudent.html#m1">department_recno</a> ? department_array[<a class="code" href="classStudent.html#m1">department_recno</a>]-&gt;p_academic_standing_no_latency : 0);
00134     }
00135     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="classStudent.html#m2">student_level</a> == <a class="code" href="Ostudent_8h.html#a32a7">DISTANCE_LEARN</a> ) {
00136         newValue = 0;
00137         <span class="keywordtype">float</span> weightSL5[VAR_COUNT_SL1] = { 0.30f, 0.30f, 0, 0.2f, 0.20f, };
00138 
00139         <span class="keywordflow">for</span>(i=0; i&lt;VAR_COUNT_SL1; i++)
00140             newValue += weightSL5[i] * input[i];
00141     }
00142     <span class="keywordflow">else</span>
00143         <a class="code" href="ALL_8H.html#a1">err_here</a>();
00144 
00145     <span class="comment">//## chea 300899 change latency_func(HE.RespF_Defs.Rev 230899 E-mail)</span>
00146     <a class="code" href="classStudent.html#m23">satisfaction_academic</a> = (char) player_school.latency_func( 0.60f, <a class="code" href="classStudent.html#m23">satisfaction_academic</a>, newValue);
00147 
00148     <span class="comment">//---------- extra effect brought the chance cards ------------//</span>
00149 
00150     <span class="keywordflow">if</span>( extra_effect_satisfaction_academic ) {
00151         <a class="code" href="classStudent.html#m23">satisfaction_academic</a> *= <a class="code" href="classStudent.html#m32">extra_effect_satisfaction_academic</a>;
00152 
00153         <a class="code" href="classStudent.html#m32">extra_effect_satisfaction_academic</a> += (1.0f - <a class="code" href="classStudent.html#m32">extra_effect_satisfaction_academic</a>) * 0.3f;
00154 
00155         <a class="code" href="classStudent.html#m23">satisfaction_academic</a> = max(0, min(100,<a class="code" href="classStudent.html#m23">satisfaction_academic</a> ) );
00156     }
00157 }
00158 
00159 <span class="comment">//---------- End of function Student::calc_satisfaction_academic -----------//</span>
00160 
00161 <span class="comment">//---------- Begin of function Student::calc_satisfaction_student_life -----------//</span>
00162 <span class="keywordtype">void</span> Student::calc_satisfaction_student_life() {
00163     <span class="keywordflow">if</span> ( <a class="code" href="classStudent.html#m2">student_level</a> != <a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a> ) {
00164         <a class="code" href="classStudent.html#m24">satisfaction_student_life</a> = -1;               <span class="comment">// -1: invalid for student level</span>
00165         <span class="keywordflow">return</span>;
00166     }
00167 
00168     <span class="keywordtype">int</span> <span class="keyword">const</span> SL_VAR_COUNT = 4;
00169     <span class="keywordtype">int</span> i;
00170     <span class="keywordtype">float</span> input[SL_VAR_COUNT];
00171     memset(input, 0, <span class="keyword">sizeof</span>(input));
00172 
00173     <span class="comment">//--------------//</span>
00174     <span class="keywordflow">if</span> ( 0 &lt; enroll_res.student_count[<a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>] + enroll_res.student_count[<a class="code" href="Ostudent_8h.html#a32a4">UG_NONTRADITION</a>] )
00175         input[0] = float(finance.expense_array[<a class="code" href="Ofinance_8h.html#a104a49">AC_STUDENT_LIFE</a>].total) / (enroll_res.student_count[<a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>] + enroll_res.student_count[<a class="code" href="Ostudent_8h.html#a32a4">UG_NONTRADITION</a>] );
00176 
00177     <span class="comment">//--------------//</span>
00178     input[1] = get_student_array(<a class="code" href="classStudent.html#m1">department_recno</a>)-&gt;<a class="code" href="classStudentArray.html#m24">ave_satisfaction_student_life</a>[<a class="code" href="classStudent.html#m2">student_level</a>];
00179 
00180     <span class="comment">//--------------//</span>
00181     <span class="comment">//  input[2] = float(finance.expense_array[AC_ATHLETICS].total) / float(finance.total_operating_expense.total);</span>
00182     <span class="comment">//## chwg290699</span>
00183 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00184 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( <a class="code" href="classStudent.html#m10">initializationValueAC_ATHLETICS</a> == 0 )
00185 <span class="preprocessor">#else</span>
00186 <span class="preprocessor"></span>        <span class="keywordflow">if</span>(info.game_year==1)
00187             <span class="keywordflow">if</span>(info.game_month==9)
00188 <span class="preprocessor">#endif</span>
00189 <span class="preprocessor"></span>                <a class="code" href="classStudent.html#m10">initializationValueAC_ATHLETICS</a>=(float)finance.expense_array[<a class="code" href="Ofinance_8h.html#a104a50">AC_ATHLETICS</a>].total;
00190     input[2] = float(finance.expense_array[<a class="code" href="Ofinance_8h.html#a104a50">AC_ATHLETICS</a>].total)/
00191         (<a class="code" href="classStudent.html#m10">initializationValueAC_ATHLETICS</a>*(1+math.get_random_snd(0.0f, <a class="code" href="Opschool_8h.html#a1">PSCH_SD</a>(0.05f))));
00192 
00193     <span class="comment">//--------------//</span>
00194     input[3] = <a class="code" href="classStudent.html#m21">talent_extracurricular</a>;
00195 
00196     <span class="comment">//--------------//</span>
00197     input[0] = math.single_response_func(1,100,9.885f,5.475f, input[0]);
00198     <span class="comment">// ## chwg290699</span>
00199     input[2] = math.single_response_func(1,100,0.5200f,1.030f, input[2]);
00200     <span class="comment">//  input[2] = math.single_response_func(1,100,5.884f,2.738f, input[2]);</span>
00201 
00202     <span class="keywordtype">float</span> newValue = 0;
00203     <span class="keywordtype">float</span> weight[SL_VAR_COUNT] = {0.40f, 0.20f, 0.15f, 0.25f, };
00204 
00205     <span class="keywordflow">for</span>(i=0; i&lt;SL_VAR_COUNT; i++)
00206         newValue += weight[i] * input[i];
00207 
00208     <span class="comment">//--- if a rape event happen in the last 365 days ----//</span>
00209 
00210     <span class="keywordflow">if</span>( chance_event.event_last_happen_date[<a class="code" href="Onews_8h.html#a51a14">NEWS_RAPE_IN_CAMPUS</a>-1] &gt; info.game_date-365 ) {
00211         <span class="comment">//--- increase the latency, slow down the recovery ----//</span>
00212 
00213         <a class="code" href="classStudent.html#m24">satisfaction_student_life</a> = (char) player_school.latency_func( 0.10f, <a class="code" href="classStudent.html#m24">satisfaction_student_life</a>, newValue);
00214     }
00215     <span class="keywordflow">else</span>
00216         <span class="comment">//## chea 300899 change latency_func(HE.RespF_Defs.Rev 230899 E-mail)</span>
00217         <a class="code" href="classStudent.html#m24">satisfaction_student_life</a> = (char) player_school.latency_func( 0.90f, <a class="code" href="classStudent.html#m24">satisfaction_student_life</a>, newValue);
00218 
00219     <span class="comment">//--------------//</span>
00220 
00221     <a class="code" href="classStudent.html#m24">satisfaction_student_life</a> = char(<a class="code" href="classStudent.html#m24">satisfaction_student_life</a> * finance.cost_rise_policy_array[<a class="code" href="Ofinance_8h.html#a112a80">PL_STUDENT_LIFE</a>].penalty_multiplier1);
00222 
00223     <a class="code" href="classStudent.html#m24">satisfaction_student_life</a> = max(0,min(100,<a class="code" href="classStudent.html#m24">satisfaction_student_life</a>));
00224 }
00225 
00226 <span class="comment">//---------- End of function Student::calc_satisfaction_student_life -----------//</span>
00227 
00228 <span class="comment">//---------- Begin of function Student::calc_satisfaction_athletics -----------//</span>
00229 <span class="keywordtype">void</span> Student::calc_satisfaction_athletics() {
00230     <span class="keywordflow">if</span> ( <a class="code" href="classStudent.html#m2">student_level</a> != <a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a> ) {
00231         <a class="code" href="classStudent.html#m25">satisfaction_athletics</a> = -1;                  <span class="comment">// -1: invalid for student level</span>
00232         <span class="keywordflow">return</span>;
00233     }
00234 
00235     <span class="keywordtype">float</span> input[2];
00236     memset(input, 0, <span class="keyword">sizeof</span>(input));
00237 
00238     <span class="comment">//--------------//</span>
00239     input[0] = athletics_office.avg_percent_win;
00240 
00241     <span class="comment">//--------------//</span>
00242     input[1] = float(<a class="code" href="classStudent.html#m22">talent_athletics</a>);
00243 
00244     <span class="comment">//--------------//</span>
00245     input[0] = math.dual_response_func(1,50,100,34.12f,27.83f,24.44f,79.95f, input[0]);
00246 
00247     <span class="keywordtype">float</span> newValue = 0.5f * input[0] + 0.5f * input[1];
00248 
00249     <span class="comment">//  satisfaction_athletics = (char) math.latency_func( 0.97f, satisfaction_athletics, newValue);</span>
00250     <span class="comment">//## chea 300899 change latency_func(HE.RespF_Defs.Rev 230899 E-mail)</span>
00251     <a class="code" href="classStudent.html#m25">satisfaction_athletics</a> = (char) player_school.latency_func( 0.85f, <a class="code" href="classStudent.html#m25">satisfaction_athletics</a>, newValue);
00252 
00253     <span class="comment">//--------------//</span>
00254     <a class="code" href="classStudent.html#m25">satisfaction_athletics</a> = char(<a class="code" href="classStudent.html#m25">satisfaction_athletics</a> * finance.cost_rise_policy_array[<a class="code" href="Ofinance_8h.html#a112a81">PL_ATHLETICS</a>].penalty_multiplier1);
00255 
00256     <a class="code" href="classStudent.html#m25">satisfaction_athletics</a> = max(0,min(100,<a class="code" href="classStudent.html#m25">satisfaction_athletics</a>));
00257 }
00258 
00259 <span class="comment">//---------- End of function Student::calc_satisfaction_athletics -----------//</span>
00260 
00261 <span class="comment">//---------- Begin of function Student::calc_satisfaction_overall -----------//</span>
00262 <span class="keywordtype">void</span> Student::calc_satisfaction_overall() {
00263     <span class="keywordtype">int</span> i;
00264 
00265     <span class="keywordflow">if</span> ( <a class="code" href="classStudent.html#m2">student_level</a> != <a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a> ) {
00266         <span class="keyword">const</span> <span class="keywordtype">int</span> VAR_COUNT = 2;
00267 
00268         <span class="keywordtype">float</span> input[2];
00269 
00270         <span class="comment">//--------------//</span>
00271         input[0] = <a class="code" href="classStudent.html#m23">satisfaction_academic</a>;
00272 
00273         <span class="comment">//--------------//</span>
00274         <span class="comment">// student diversity index (see Departmental Performance Indicators for definition): for the student level</span>
00275 
00276         input[1] = 0;                                 <span class="comment">//askbill</span>
00277 
00278         <span class="comment">//--------------//</span>
00279         <span class="keywordtype">float</span> newValue = 0;
00280         <span class="keywordtype">float</span> weight[VAR_COUNT] = {0.40f, 0.05f,};
00281         <span class="keywordtype">float</span> weightMinority[VAR_COUNT] = {0.45f, 0.10f,};
00282 
00283         <span class="keywordflow">if</span> ( <a class="code" href="classStudent.html#m3">gender_ethnic_group</a> == <a class="code" href="Gamedef_8h.html#a75a27">NONMINORITY_MALE</a> ) {
00284             <span class="keywordflow">for</span>(i=0; i&lt;VAR_COUNT; i++)
00285                 newValue += weight[i] * input[i];
00286         }
00287         <span class="keywordflow">else</span> {
00288             <span class="keywordflow">for</span>(i=0; i&lt;VAR_COUNT; i++)
00289                 newValue += weightMinority[i] * input[i];
00290         }
00291 
00292         <a class="code" href="classStudent.html#m26">satisfaction_overall</a> = (char) player_school.latency_func( 0.95f, <a class="code" href="classStudent.html#m26">satisfaction_overall</a>, newValue);
00293 
00294         <span class="comment">//--------------//</span>
00295         <span class="keywordflow">return</span>;
00296     }
00297 
00298     <span class="keyword">const</span> <span class="keywordtype">int</span> OVERALL_VAR_COUNT = 6;
00299     <span class="keywordtype">float</span> input[OVERALL_VAR_COUNT];
00300     memset(input, 0, <span class="keyword">sizeof</span>(input));
00301 
00302     <span class="comment">//--------------//</span>
00303     input[0] = <a class="code" href="classStudent.html#m23">satisfaction_academic</a>;
00304     input[1] = <a class="code" href="classStudent.html#m24">satisfaction_student_life</a>;
00305     input[2] = <a class="code" href="classStudent.html#m25">satisfaction_athletics</a>;
00306 
00307     <span class="comment">//--------------//</span>
00308     <span class="comment">// student diversity index (see Departmental Performance Indicators for definition): SL-1</span>
00309     input[3] = player_school.sub_score[<a class="code" href="Opschool_8h.html#a65a42">S_STUDENT_DIVERSITY</a>][THIS_MONTH];
00310 
00311     <span class="comment">//--------------//</span>
00312     <span class="comment">// Fac. DIVERSITY index (see Departmental Performance Indicators for definition): whole institution</span>
00313     input[4] = <a class="code" href="classStudent.html#m1">department_recno</a> ? department_array[<a class="code" href="classStudent.html#m1">department_recno</a>]-&gt;p_faculty_diversity :0;
00314 
00315     <span class="comment">//--------------//</span>
00316     <span class="comment">//Let x[t] = the value of the emphasis variable (0,1,2, or 3) at month t;</span>
00317     <span class="comment">//y[t]=the value of the reaction. Then:</span>
00318 
00319     <span class="comment">//char      emphasis_var, emphasis_var_last;                // changed monthly // to put it to "student Union"?</span>
00320     <span class="comment">//emphasis_var_last = emphasis_var = 1;</span>
00321 
00322     <span class="keyword">const</span> <span class="keywordtype">float</span> lamda = 0.975f;
00323 
00324     <a class="code" href="classStudent.html#m28">reaction_summer_course</a> = (char) max(0.0f,
00325                                         (1-lamda)*(-10)*(player_school.summer_emphasis*player_school.summer_emphasis - player_school.summer_emphasis_last*player_school.summer_emphasis_last)
00326                                         + lamda*<a class="code" href="classStudent.html#m29">reaction_summer_course_last</a>);         <span class="comment">// min &amp; max bug chea</span>
00327 
00328     input[5] = (float) <a class="code" href="classStudent.html#m28">reaction_summer_course</a>;
00329 
00330     <span class="comment">//--------------//</span>
00331     input[3] = math.dual_response_func(1,49.48f,100,20.74f,29.48f,20.30f,75.12f, input[3]);
00332     input[4] = math.dual_response_func(1,49.48f,100,20.74f,29.48f,20.30f,75.12f, input[4]);
00333 
00334     <span class="keywordtype">float</span> newValue = 0;
00335 
00336     <span class="keywordtype">float</span> weight[OVERALL_VAR_COUNT] = {0.40f, 0.35f, 0.10f, 0.05f, 0.05f, 0.05f, };
00337     <span class="keywordtype">float</span> weightMinority[OVERALL_VAR_COUNT] = {0.45f, 0.25f, 0.10f, 0.10f, 0.10f, 0.05f,};
00338 
00339     <span class="keywordflow">if</span> ( <a class="code" href="classStudent.html#m3">gender_ethnic_group</a> == <a class="code" href="Gamedef_8h.html#a75a27">NONMINORITY_MALE</a> ) {
00340         <span class="keywordflow">for</span>(i=0; i&lt;OVERALL_VAR_COUNT; i++)
00341             newValue += weight[i] * input[i];
00342     }
00343     <span class="keywordflow">else</span> {
00344         <span class="keywordflow">for</span>(i=0; i&lt;OVERALL_VAR_COUNT; i++)
00345             newValue += weightMinority[i] * input[i];
00346     }
00347 
00348     <span class="comment">//  satisfaction_overall = (char) math.latency_func( 0.95f, satisfaction_overall, newValue);</span>
00349     <span class="comment">//## chea 300899 change latency_func(HE.RespF_Defs.Rev 230899 E-mail) //## chea 280999 find bug so back to org.</span>
00350     <a class="code" href="classStudent.html#m26">satisfaction_overall</a> = (char) player_school.latency_func( 0.67f, <a class="code" href="classStudent.html#m26">satisfaction_overall</a>, newValue);
00351 
00352     <span class="comment">//---------------//</span>
00353     <a class="code" href="classStudent.html#m26">satisfaction_overall</a> = char(<a class="code" href="classStudent.html#m26">satisfaction_overall</a> * finance.revenue_policy_array[<a class="code" href="Ofinance_8h.html#a108a65">PL_TUITION_RATE_GROWTH</a>].penalty_multiplier1);
00354     <a class="code" href="classStudent.html#m26">satisfaction_overall</a> = char(<a class="code" href="classStudent.html#m26">satisfaction_overall</a> * finance.revenue_policy_array[<a class="code" href="Ofinance_8h.html#a108a66">PL_FINANCIAL_AID</a>].penalty_multiplier1);
00355 
00356     <span class="comment">//----//</span>
00357     <a class="code" href="classStudent.html#m26">satisfaction_overall</a> = char(<a class="code" href="classStudent.html#m26">satisfaction_overall</a> * finance.cost_rise_policy_array[<a class="code" href="Ofinance_8h.html#a112a78">PL_LIBRARIES</a>].penalty_multiplier2);
00358 
00359     <span class="comment">//----//</span>
00360 
00361     <a class="code" href="classStudent.html#m26">satisfaction_overall</a> = max(0,min(100,<a class="code" href="classStudent.html#m26">satisfaction_overall</a>));
00362 }
00363 
00364 <span class="comment">//---------- End of function Student::calc_satisfaction_overall -----------//</span>
00365 
00366 <span class="comment">//---------- Begin of function Student::calc_faculty_workweek -----------//</span>
00367 <span class="keywordtype">void</span> Student::calc_faculty_workweek() {
00368     <span class="keywordtype">float</span> input;
00369 
00370     <span class="comment">//--------------//</span>
00371     input = <a class="code" href="classStudent.html#m1">department_recno</a> ? department_array[<a class="code" href="classStudent.html#m1">department_recno</a>]-&gt;p_faculty_morale_history[THIS_MONTH] : 0;
00372 
00373     <span class="comment">//--------------//</span>
00374     input = math.dual_response_func(30,44,60,20.18f,24.18f,19.88f,83.89f, input);
00375 
00376     <span class="comment">//  faculty_workweek = (char) math.latency_func( 0.89f, faculty_workweek, input);</span>
00377     <span class="comment">//## chea 300899 change latency_func(HE.RespF_Defs.Rev 230899 E-mail)</span>
00378     <a class="code" href="classStudent.html#m27">faculty_workweek</a> = (char) player_school.latency_func( 0.84f, <a class="code" href="classStudent.html#m27">faculty_workweek</a>, input);
00379 
00380 }
00381 
00382 <span class="comment">//---------- End of function Student::calc_faculty_workweek -----------//</span>
00383 
00384 <span class="comment">//---------- Begin of function Student::calc_probability_change_major -----------//</span>
00385 <span class="keywordtype">void</span> Student::calc_probability_change_major() {
00386     <span class="keyword">const</span> <span class="keywordtype">char</span> M_VAR_COUNT = 2;
00387     <span class="keywordtype">int</span> i;
00388     <span class="keywordtype">float</span> input[M_VAR_COUNT];
00389     memset(input, 0, <span class="keyword">sizeof</span>(input));
00390     <span class="comment">//--------------//</span>
00391     input[0] = (float) <a class="code" href="classStudent.html#m26">satisfaction_overall</a>;
00392 
00393     <span class="comment">//--------------//</span>
00394     <span class="keywordtype">int</span> requiredCourseCount;
00395 
00396     <span class="keywordflow">switch</span>( student_level ) {
00397     <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>:
00398     <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a4">UG_NONTRADITION</a>:
00399         requiredCourseCount = <a class="code" href="Ocourse_8h.html#a6">COURSE_COUNT_REQUIRED_FOR_BACHELOR</a>;
00400         <span class="keywordflow">break</span>;
00401 
00402     <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a5">MASTER</a>:
00403         requiredCourseCount = <a class="code" href="Ocourse_8h.html#a7">COURSE_COUNT_REQUIRED_FOR_MASTER</a>;
00404         <span class="keywordflow">break</span>;
00405 
00406     <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a6">DOCTOR</a>:
00407         requiredCourseCount = <a class="code" href="Ocourse_8h.html#a8">COURSE_COUNT_REQUIRED_FOR_DOCTOR</a>;
00408         <span class="keywordflow">break</span>;
00409 
00410     <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a7">DISTANCE_LEARN</a>:
00411         <span class="keywordflow">return</span>;
00412     }
00413 
00414     <span class="comment">// course remained to take</span>
00415     input[1] = float(requiredCourseCount - <a class="code" href="classStudent.html#m12">total_course_all</a>);
00416 
00417     <span class="comment">//--------------//</span>
00418     input[0] = math.dual_response_func(0.000f,0.189f,0.500f,-28.960f,-29.670f,80.010f,24.990f, input[0]);
00419     input[1] = math.single_response_func(0.00f,0.50f,25.00f,12.54f, input[1]);
00420 
00421     <span class="keywordtype">float</span> weight[M_VAR_COUNT] = {0.6f, 0.4f };
00422 
00423     <span class="keywordtype">float</span> newValue = 0;
00424     <span class="keywordflow">for</span>(i=0; i&lt;M_VAR_COUNT; i++)
00425         newValue += weight[i] * input[i];
00426 
00427     <a class="code" href="classStudent.html#m30">probability_change_major</a> = player_school.latency_func( 0.3f, <a class="code" href="classStudent.html#m30">probability_change_major</a>, newValue);
00428 }
00429 
00430 <span class="comment">//---------- End of function Student::calc_probability_change_major -----------//</span>
00431 
00432 <span class="comment">//---------- Begin of function Student::calc_multiplier_on_dropout_prob -----------//</span>
00433 <span class="keywordtype">void</span> Student::calc_multiplier_on_dropout_prob() {
00434     <span class="keyword">const</span> <span class="keywordtype">char</span> D_VAR_COUNT = 3;
00435     <span class="keywordtype">int</span> i;
00436     <span class="keywordtype">float</span> input[D_VAR_COUNT];
00437     memset(input, 0, <span class="keyword">sizeof</span>(input));
00438 
00439     <span class="comment">//--------------//</span>
00440     input[0] = (float) <a class="code" href="classStudent.html#m26">satisfaction_overall</a>;
00441 
00442     <span class="comment">//--------------//</span>
00443     <span class="comment">// failed_course_count = accumulated count</span>
00444     input[1] = float(<a class="code" href="classStudent.html#m16">failed_course_count</a>) / ( 8 * <a class="code" href="classStudent.html#m6">year_in_program</a>);
00445 
00446     <span class="comment">//--------------//</span>
00447     input[2] = player_school.sub_score[<a class="code" href="Opschool_8h.html#a65a42">S_STUDENT_DIVERSITY</a>][THIS_MONTH];
00448 
00449     <span class="comment">//--------------//</span>
00450     input[0] = math.dual_response_func(0.500f,0.950f,2.000f,-31.945f,-38.384f,79.997f,39.993f, input[0]);
00451     <span class="comment">//  input[1] = math.single_response_func(0.500f,2.000f,0.096f,0.056f, input[1]);</span>
00452     <span class="comment">//## chea 151099 want to change to this but I am lost</span>
00453     input[1] = math.single_response_func(0.500f,1.000f,0.096f,0.056f, input[1]);
00454     input[2] = math.dual_response_func(0.500f,1.001f,2.000f,-29.947f,-29.945f,75.015f,19.970f, input[2]);
00455 
00456     <span class="keywordtype">float</span> weight[D_VAR_COUNT] = {0.50f, 0.50f, };
00457     <span class="keywordtype">float</span> weightMinority[D_VAR_COUNT] = {0.30f, 0.50f, 0.2f, };
00458     <span class="keywordtype">float</span> newValue = 0;
00459 
00460     <span class="keywordflow">if</span> ( <a class="code" href="classStudent.html#m3">gender_ethnic_group</a> == <a class="code" href="Gamedef_8h.html#a75a27">NONMINORITY_MALE</a> ) {
00461         <span class="keywordflow">for</span>(i=0; i&lt;D_VAR_COUNT; i++)
00462             newValue += weight[i] * input[i];
00463     }
00464     <span class="keywordflow">else</span> {
00465         <span class="keywordflow">for</span>(i=0; i&lt;D_VAR_COUNT; i++)
00466             newValue += weightMinority[i] * input[i];
00467     }
00468 
00469     <a class="code" href="classStudent.html#m31">multiplier_on_dropout_prob</a> = player_school.latency_func( 0.67f, <a class="code" href="classStudent.html#m31">multiplier_on_dropout_prob</a>, newValue);
00470 }
00471 
00472 <span class="comment">//---------- End of function Student::calc_multiplier_on_dropout_prob -----------//</span>
00473 
00474 <span class="comment">//===============================================================================//</span>
00475 <span class="comment">//===============================================================================//</span>
00476 
00477 <span class="comment">//---------- Begin of function StudentArray::update_history -----------//</span>
<a name="l00478"></a><a class="code" href="classStudentArray.html#a12">00478</a> <span class="keywordtype">void</span> <a class="code" href="classStudentArray.html#a12">StudentArray::update_history</a>(<span class="keywordtype">char</span> update_flag) {
00479 
00480     <span class="comment">//----- for calc performance indicator -----//</span>
00481     <span class="comment">// called before next day?</span>
00482 
00483     <span class="comment">// should this be put in player school</span>
00484     <a class="code" href="classStudent.html">Student</a> *studentPtr;
00485     <span class="keywordtype">int</span> i, sl;
00486     <span class="keywordtype">int</span> studentCount[<a class="code" href="Ostudent_8h.html#a0">MAX_STUDENT_LEVEL</a>];
00487 
00488     memset(studentCount, 0, <span class="keyword">sizeof</span>(studentCount));
00489     memset(<a class="code" href="classStudentArray.html#m24">ave_satisfaction_student_life</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="classStudentArray.html#m24">ave_satisfaction_student_life</a>));
00490 
00491     <span class="keywordflow">for</span>( i=<a class="code" href="classDynArray.html#a28">size</a>() ; i&gt;0 ; i-- ) {
00492         <span class="keywordflow">if</span>( <a class="code" href="classStudentArray.html#a9">is_deleted</a>(i) )
00493             <span class="keywordflow">continue</span>;
00494 
00495         studentPtr = <a class="code" href="classStudentArray.html#a10">operator[]</a>(i);
00496 
00497         sl = studentPtr-&gt;<a class="code" href="classStudent.html#m2">student_level</a>;
00498 
00499         <a class="code" href="ALL_8H.html#a0">err_when</a>(sl&lt;0 || sl&gt;=<a class="code" href="Ostudent_8h.html#a0">MAX_STUDENT_LEVEL</a>);
00500 
00501         <span class="keywordflow">if</span> ( sl != <a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a> )
00502             <span class="keywordflow">continue</span>;
00503 
00504         studentCount[sl]++;
00505         <a class="code" href="classStudentArray.html#m24">ave_satisfaction_student_life</a>[sl] += studentPtr-&gt;<a class="code" href="classStudent.html#m24">satisfaction_student_life</a>;
00506     }
00507 
00508     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Ostudent_8h.html#a0">MAX_STUDENT_LEVEL</a>; i++) {
00509         <span class="keywordflow">if</span> ( studentCount[i] )
00510             <a class="code" href="classStudentArray.html#m24">ave_satisfaction_student_life</a>[i] /= studentCount[i];
00511         <span class="keywordflow">else</span>
00512             <a class="code" href="ALL_8H.html#a0">err_when</a>( <a class="code" href="classStudentArray.html#m24">ave_satisfaction_student_life</a>[i] != 0 );
00513     }
00514 
00515     <span class="comment">//----------------------------------------//</span>
00516     <a class="code" href="classPeerSchool.html">PeerSchool</a> *player;
00517 
00518     <span class="keywordflow">switch</span> (update_flag) {
00519     <span class="keywordflow">case</span> UPDATE_MONTH:
00520         <a class="code" href="classStudentArray.html#a13">calc_student_performance</a>();
00521         <span class="keywordflow">break</span>;
00522     <span class="keywordflow">case</span> UPDATE_TRIMESTER:
00523         <span class="keywordflow">break</span>;
00524     <span class="keywordflow">case</span> UPDATE_YEAR:
00525         <a class="code" href="classStudentArray.html#a14">calc_degree_awarded</a>();
00526         <span class="keywordflow">break</span>;
00527     <span class="keywordflow">case</span> UPDATE_ALL:
00528         <span class="comment">// UPDATE_ALL: assumed called only once for each battle</span>
00529         <span class="comment">// update degree info for last year(97-98)</span>
00530 
00531         player = school_res.player_peer_school;
00532 
00533         <span class="comment">// since there's a bug in course selection, too few degrees awarded during game, hence the graphs are not "good" looking</span>
00534         <a class="code" href="classStudentArray.html#m20">cur_bachelor_degree</a> = player-&gt;<a class="code" href="classSchool.html#m91">total_bach_degrees</a> / department_array.department_count;
00535         <a class="code" href="classStudentArray.html#m21">cur_master_degree</a>   = player-&gt;<a class="code" href="classSchool.html#m92">total_masters_and_prof_degree</a> / department_array.department_count;
00536         <a class="code" href="classStudentArray.html#m22">cur_doctor_degree</a>   = player-&gt;<a class="code" href="classSchool.html#m93">total_doctoral_degrees</a> / department_array.department_count;
00537         <span class="comment">/*</span>
00538 <span class="comment">          {</span>
00539 <span class="comment">          // 990416</span>
00540 <span class="comment"></span>
00541 <span class="comment">          char y;</span>
00542 <span class="comment">          int stuCount[MAX_STUDENT_LEVEL][MAX_GRADUATE_YEARS];</span>
00543 <span class="comment">          memset(stuCount, 0, sizeof(stuCount));</span>
00544 <span class="comment"></span>
00545 <span class="comment">          for (i=size(); i&gt;0; i--)</span>
00546 <span class="comment">          {</span>
00547 <span class="comment">          if ( is_deleted(i) )</span>
00548 <span class="comment">          continue;</span>
00549 <span class="comment"></span>
00550 <span class="comment">          Student* stuPtr = operator[](i);</span>
00551 <span class="comment">          y = min(MAX_GRADUATE_YEARS, stuPtr-&gt;year_in_program);</span>
00552 <span class="comment">          stuCount[stuPtr-&gt;student_level][y]++;</span>
00553 <span class="comment">          }</span>
00554 <span class="comment"></span>
00555 <span class="comment">          //--//</span>
00556 <span class="comment"></span>
00557 <span class="comment">          cur_bachelor_degree = 0;</span>
00558 <span class="comment">          cur_master_degree = 0;</span>
00559 <span class="comment">          cur_doctor_degree = 0;</span>
00560 <span class="comment"></span>
00561 <span class="comment">          for (char sl=0; sl&lt;MASTER; sl++)</span>
00562 <span class="comment">          for (i=0; i&lt;MAX_GRADUATE_YEARS; i++)</span>
00563 <span class="comment">          cur_bachelor_degree += int(player_school.grad_trans_prob[sl][i] * stuCount[sl][i]);</span>
00564 <span class="comment"></span>
00565 <span class="comment">          sl = MASTER;</span>
00566 <span class="comment">          for (i=0; i&lt;MAX_GRADUATE_YEARS; i++)</span>
00567 <span class="comment">          cur_master_degree += int(player_school.grad_trans_prob[sl][i] * stuCount[sl][i]);</span>
00568 <span class="comment"></span>
00569 <span class="comment">          sl = DOCTOR;</span>
00570 <span class="comment">          DepartmentInfo* deptInfo = department_res[department_array[department_recno]-&gt;department_id];</span>
00571 <span class="comment">          for (i=0; i&lt;MAX_GRADUATE_YEARS; i++)</span>
00572 <span class="comment">          cur_doctor_degree += int(deptInfo-&gt;doctor_graduate_trans_prob[i] * stuCount[sl][i]);</span>
00573 <span class="comment"></span>
00574 <span class="comment">          sl = DISTANCE_LEARN;</span>
00575 <span class="comment">          for (i=0; i&lt;MAX_GRADUATE_YEARS; i++)</span>
00576 <span class="comment">          cur_bachelor_degree += int(player_school.grad_trans_prob[UG_NONTRADITION][i] * stuCount[sl][i]);</span>
00577 <span class="comment"></span>
00578 <span class="comment">          }</span>
00579 <span class="comment">        */</span>
00580 
00581         <a class="code" href="classStudentArray.html#a12">update_history</a>(UPDATE_MONTH);
00582         <a class="code" href="classStudentArray.html#a12">update_history</a>(UPDATE_TRIMESTER);
00583         <a class="code" href="classStudentArray.html#a12">update_history</a>(UPDATE_YEAR);
00584 
00585         <span class="comment">//-----------//</span>
00586 
00587         <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Ostudent_8h.html#a33a8">DEGREE_TYPE_COUNT</a>; i++) {       <span class="comment">// see 0919 noets Q6.</span>
00588 
00589             <span class="comment">// from db</span>
00590             <a class="code" href="classStudentArray.html#m11">time_to_degree</a>[<a class="code" href="Ostudent_8h.html#a33a9">BACHELOR_DEGREE</a>][THIS_YEAR] = 4.37f;
00591             <span class="comment">// from db</span>
00592             <a class="code" href="classStudentArray.html#m11">time_to_degree</a>[<a class="code" href="Ostudent_8h.html#a33a10">MASTER_DEGREE</a>][THIS_YEAR] = 1.05f;
00593             <span class="comment">//## chea 281099 student no.</span>
00594             <a class="code" href="classStudentArray.html#m11">time_to_degree</a>[<a class="code" href="Ostudent_8h.html#a33a11">DOCTOR_DEGREE</a>][THIS_YEAR] = player-&gt;<a class="code" href="classSchool.html#m129">doc_time_to_degree</a>;
00595 
00596             <span class="comment">/*</span>
00597 <span class="comment">              dropout_rate[BACHELOR_DEGREE][THIS_YEAR] = 100-100*(player-&gt;target_grad_rate_sl[UG_TRADITION] / 100.0f</span>
00598 <span class="comment">              + ( 1-player-&gt;target_grad_rate_sl[UG_TRADITION] / 100.0f )</span>
00599 <span class="comment">              * ( 1-0.9f ));            // 0.9f: from db</span>
00600 <span class="comment"></span>
00601 <span class="comment">              dropout_rate[MASTER_DEGREE][THIS_YEAR] = 100 - player-&gt;target_grad_rate_sl[MASTER];</span>
00602 <span class="comment">              dropout_rate[DOCTOR_DEGREE][THIS_YEAR] = 100 - player-&gt;target_grad_rate_sl[DOCTOR];</span>
00603 <span class="comment">              BUGHERE 990408 */</span>
00604         }
00605 
00606         <span class="keywordflow">break</span>;
00607 
00608     <span class="keywordflow">default</span>:
00609         <a class="code" href="ALL_8H.html#a1">err_here</a>();
00610         <span class="keywordflow">break</span>;
00611     }
00612 }
00613 
00614 <span class="comment">//---------- End of function StudentArray::update_history -----------//</span>
00615 
00616 <span class="comment">//---------- Begin of function StudentArray::calc_student_performance -----------//</span>
<a name="l00618"></a><a class="code" href="classStudentArray.html#a13">00618</a> <span class="comment">void StudentArray::calc_student_performance() {</span>
00619     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(talent_academic, HISTORY_MONTH_COUNT);
00620     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(talent_extracurricular, HISTORY_MONTH_COUNT);
00621     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(talent_athletics, HISTORY_MONTH_COUNT);
00622 
00623     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(satisfaction_academic, HISTORY_MONTH_COUNT);
00624     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(satisfaction_student_life, HISTORY_MONTH_COUNT);
00625     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(satisfaction_athletics, HISTORY_MONTH_COUNT);
00626 
00627     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(satisfaction_overall, HISTORY_MONTH_COUNT);
00628 
00629     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> d=0; d&lt;<a class="code" href="Ostudent_8h.html#a33a8">DEGREE_TYPE_COUNT</a>; d++)
00630         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(talent_academic_all[d], HISTORY_MONTH_COUNT);
00631 
00632     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(performance_academic_ug, HISTORY_MONTH_COUNT);
00633 
00634     <span class="comment">//-----------------//</span>
00635 
00636     <a class="code" href="classStudent.html">Student</a> *stuPtr;
00637     <span class="keyword">const</span> <span class="keywordtype">char</span>  AVG_VAR_COUNT = 11;
00638     <span class="keywordtype">int</span> total[AVG_VAR_COUNT];
00639     <span class="keywordtype">int</span> i, ugtStuCount=0, ugAllCount=0, stuCount = 0, docCount=0, masCount=0;
00640 
00641     memset(total, 0, <span class="keyword">sizeof</span>(total));
00642 
00643     <span class="keywordflow">for</span>( i=size() ; i&gt;0 ; i-- ) {
00644         <span class="keywordflow">if</span>( is_deleted(i) )
00645             <span class="keywordflow">continue</span>;
00646 
00647         stuPtr = operator[](i);
00648 
00649         <span class="keywordflow">if</span> ( stuPtr-&gt;<a class="code" href="classStudent.html#m2">student_level</a> == <a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a> ) {
00650             total[0] += stuPtr-&gt;<a class="code" href="classStudent.html#m20">talent_academic</a>;
00651             total[1] += stuPtr-&gt;<a class="code" href="classStudent.html#m21">talent_extracurricular</a>;
00652             total[2] += stuPtr-&gt;<a class="code" href="classStudent.html#m22">talent_athletics</a>;
00653 
00654             total[3] += stuPtr-&gt;<a class="code" href="classStudent.html#m23">satisfaction_academic</a>;
00655             total[4] += stuPtr-&gt;<a class="code" href="classStudent.html#m24">satisfaction_student_life</a>;
00656             total[5] += stuPtr-&gt;<a class="code" href="classStudent.html#m25">satisfaction_athletics</a>;
00657             total[6] += stuPtr-&gt;<a class="code" href="classStudent.html#m26">satisfaction_overall</a>;
00658             ugtStuCount++;
00659         }
00660 
00661         <span class="keywordflow">if</span> ( (stuPtr-&gt;<a class="code" href="classStudent.html#m2">student_level</a>) == <a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a> ) {
00662             total[7] += (int) stuPtr-&gt;<a class="code" href="classStudent.html#m7">academic_achievement</a>;
00663             total[8] += stuPtr-&gt;<a class="code" href="classStudent.html#m20">talent_academic</a>;
00664             <span class="comment">//ugtCount++;</span>
00665         }
00666         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( stuPtr-&gt;<a class="code" href="classStudent.html#m2">student_level</a> == <a class="code" href="Ostudent_8h.html#a32a5">MASTER</a> ) {
00667             total[9] += stuPtr-&gt;<a class="code" href="classStudent.html#m20">talent_academic</a>;
00668             masCount++;
00669         }
00670         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( stuPtr-&gt;<a class="code" href="classStudent.html#m2">student_level</a> == <a class="code" href="Ostudent_8h.html#a32a6">DOCTOR</a> ) {
00671             total[10] += stuPtr-&gt;<a class="code" href="classStudent.html#m20">talent_academic</a>;
00672             docCount++;
00673         }
00674 
00675         stuCount++;
00676     }
00677 
00678     <span class="keywordflow">if</span> (!stuCount)
00679         <span class="keywordflow">return</span>;
00680 
00681     <span class="keywordflow">if</span> ( ugtStuCount ) {
00682         <span class="comment">//## 071299 chea 1.12.1</span>
00683         talent_academic[THIS_MONTH] = char(total[0] / ugtStuCount);
00684         talent_extracurricular [THIS_MONTH] = char(total[1] / ugtStuCount);
00685         talent_athletics [THIS_MONTH] = char(total[2] / ugtStuCount);
00686 
00687         satisfaction_academic [THIS_MONTH] = char(total[3] / ugtStuCount);
00688         satisfaction_student_life [THIS_MONTH] = char(total[4] / ugtStuCount);
00689         satisfaction_athletics [THIS_MONTH] = char(total[5] / ugtStuCount);
00690         satisfaction_overall [THIS_MONTH] = char(total[6] / ugtStuCount);
00691 
00692         <span class="comment">//              talent_academic[THIS_MONTH] = char(total[0] / stuCount);</span>
00693         <span class="comment">//              talent_extracurricular [THIS_MONTH] = char(total[1] / stuCount);</span>
00694         <span class="comment">//              talent_athletics [THIS_MONTH] = char(total[2] / stuCount);</span>
00695 
00696         <span class="comment">//              satisfaction_academic [THIS_MONTH] = char(total[3] / stuCount);</span>
00697         <span class="comment">//              satisfaction_student_life [THIS_MONTH] = char(total[4] / stuCount);</span>
00698         <span class="comment">//              satisfaction_athletics [THIS_MONTH] = char(total[5] / stuCount);</span>
00699         <span class="comment">//              satisfaction_overall [THIS_MONTH] = char(total[6] / stuCount);</span>
00700     }
00701 
00702     <span class="keywordflow">if</span> ( ugtStuCount ) {
00703         performance_academic_ug[THIS_MONTH] = char(total[7] / ugtStuCount);
00704         talent_academic_all[<a class="code" href="Ostudent_8h.html#a33a9">BACHELOR_DEGREE</a>][THIS_MONTH] = char(total[8] / ugtStuCount);
00705     }
00706 
00707     <span class="keywordflow">if</span> ( masCount )
00708         talent_academic_all[<a class="code" href="Ostudent_8h.html#a33a10">MASTER_DEGREE</a>][THIS_MONTH] = char(total[9] / masCount);
00709 
00710     <span class="keywordflow">if</span> ( docCount )
00711         talent_academic_all[<a class="code" href="Ostudent_8h.html#a33a11">DOCTOR_DEGREE</a>][THIS_MONTH] = char(total[10] / docCount);
00712 
00713     <span class="comment">/*</span>
00714 <span class="comment">      talent_academic</span>
00715 <span class="comment">      talent_extracurricular</span>
00716 <span class="comment">      talent_athletics</span>
00717 <span class="comment">      satisfaction_academic</span>
00718 <span class="comment">      satisfaction_student_life</span>
00719 <span class="comment">      satisfaction_athletics</span>
00720 <span class="comment">    */</span>
00721 
00722 }
00723 
00724 <span class="comment">//---------- End of function StudentArray::calc_student_performance -----------//</span>
00725 
00726 <span class="comment">//---------- Begin of function StudentArray::calc_degree_awarded -----------//</span>
<a name="l00727"></a><a class="code" href="classStudentArray.html#a14">00727</a> <span class="keywordtype">void</span> <a class="code" href="classStudentArray.html#a14">StudentArray::calc_degree_awarded</a>() {
00728     <span class="comment">//-----------------------------------------//</span>
00729 
00730     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(<a class="code" href="classStudentArray.html#m14">bachelor_degree</a>, HISTORY_YEAR_COUNT);
00731 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00732 <span class="preprocessor"></span>    <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(non_ug_bachelor_degree, HISTORY_YEAR_COUNT );
00733 <span class="preprocessor">#endif</span>
00734 <span class="preprocessor"></span>    <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(<a class="code" href="classStudentArray.html#m15">master_degree</a>, HISTORY_YEAR_COUNT);
00735     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(<a class="code" href="classStudentArray.html#m16">doctor_degree</a>, HISTORY_YEAR_COUNT);
00736 
00737     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y=0; y&lt;<a class="code" href="Ostudent_8h.html#a33a8">DEGREE_TYPE_COUNT</a>; y++) {
00738         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(<a class="code" href="classStudentArray.html#m11">time_to_degree</a>[y], HISTORY_YEAR_COUNT);
00739         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(<a class="code" href="classStudentArray.html#m13">fake_disp_time_to_degree</a>[y], HISTORY_YEAR_COUNT);
00740         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(<a class="code" href="classStudentArray.html#m12">dropout_rate</a>[y], HISTORY_YEAR_COUNT);
00741     }
00742 
00743     <span class="comment">//-----------------------------------------//</span>
00744     <span class="comment">//</span>
00745     <span class="comment">// The [THIS_YEAR] element in all historical array</span>
00746     <span class="comment">// is always the latest obtainable value of the</span>
00747     <span class="comment">// variables. Some will have values for the</span>
00748     <span class="comment">// current year, some will have values for the</span>
00749     <span class="comment">// last year. So THIS_YEAR does not mean the</span>
00750     <span class="comment">// current year.</span>
00751     <span class="comment">//</span>
00752     <span class="comment">// As for the graduation rate, the value is</span>
00753     <span class="comment">// graduation rate of the last year as the value</span>
00754     <span class="comment">// for the current year hasn't been known yet.</span>
00755     <span class="comment">//</span>
00756     <span class="comment">//-----------------------------------------//</span>
00757 
00758     <a class="code" href="classStudentArray.html#m14">bachelor_degree</a>[THIS_YEAR] = <a class="code" href="classStudentArray.html#m20">cur_bachelor_degree</a>;
00759 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00760 <span class="preprocessor"></span>    non_ug_bachelor_degree[THIS_YEAR] = cur_non_ug_bachelor_degree;
00761 <span class="preprocessor">#endif</span>
00762 <span class="preprocessor"></span>    <a class="code" href="classStudentArray.html#m15">master_degree</a> [THIS_YEAR]  = <a class="code" href="classStudentArray.html#m21">cur_master_degree</a>;
00763     <a class="code" href="classStudentArray.html#m16">doctor_degree</a> [THIS_YEAR]  = <a class="code" href="classStudentArray.html#m22">cur_doctor_degree</a>;
00764 
00765     <span class="comment">//---- special handling: the first year, the master &amp; doctor degrees are too low, artificially increase them ---//</span>
00766 
00767 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00768 <span class="preprocessor"></span>    <span class="keywordflow">if</span>( info.prerun_year &amp;&amp; info.game_year == 1 )
00769 <span class="preprocessor">#else</span>
00770 <span class="preprocessor"></span>        <span class="keywordflow">if</span>( info.prerun_year )
00771 <span class="preprocessor">#endif</span>
00772 <span class="preprocessor"></span>        {
00773             <span class="comment">//--- count the number of master &amp; doctor students in this department ---//</span>
00774 
00775             <span class="keywordtype">int</span> masterCount=0, doctorCount=0;
00776 
00777             <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=<a class="code" href="classDynArray.html#a28">size</a>() ; i&gt;0 ; i-- ) {
00778                 <span class="keywordflow">if</span>( <a class="code" href="classStudentArray.html#a9">is_deleted</a>(i) )
00779                     <span class="keywordflow">continue</span>;
00780 
00781                 <a class="code" href="classStudent.html">Student</a>* stuPtr = <a class="code" href="classStudentArray.html#a10">operator[]</a>(i);
00782 
00783                 <span class="keywordflow">if</span>( stuPtr-&gt;<a class="code" href="classStudent.html#m2">student_level</a> == <a class="code" href="Ostudent_8h.html#a32a5">MASTER</a> )
00784                     masterCount++;
00785                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>( stuPtr-&gt;<a class="code" href="classStudent.html#m2">student_level</a> == <a class="code" href="Ostudent_8h.html#a32a6">DOCTOR</a> )
00786                     doctorCount++;
00787             }
00788 
00789             <span class="comment">// divided by the average # of years to get a degree</span>
00790             <a class="code" href="classStudentArray.html#m15">master_degree</a>[THIS_YEAR]  = int( (<span class="keywordtype">float</span>) masterCount / 1.6f);
00791             <a class="code" href="classStudentArray.html#m16">doctor_degree</a> [THIS_YEAR] = doctorCount/5;
00792         }
00793 
00794     <span class="comment">//---- see design note 0919 section 6 -----//</span>
00795 
00796     <a class="code" href="classStudentArray.html#m11">time_to_degree</a>[<a class="code" href="Ostudent_8h.html#a33a9">BACHELOR_DEGREE</a>][THIS_YEAR] = math.safe_divide(<a class="code" href="classStudentArray.html#m17">time_to_degree_cumm</a>[<a class="code" href="Ostudent_8h.html#a33a9">BACHELOR_DEGREE</a>], <a class="code" href="classStudentArray.html#m20">cur_bachelor_degree</a>);
00797     <a class="code" href="classStudentArray.html#m11">time_to_degree</a>[<a class="code" href="Ostudent_8h.html#a33a10">MASTER_DEGREE</a>][THIS_YEAR] = math.safe_divide(<a class="code" href="classStudentArray.html#m17">time_to_degree_cumm</a>[<a class="code" href="Ostudent_8h.html#a33a10">MASTER_DEGREE</a>], <a class="code" href="classStudentArray.html#m21">cur_master_degree</a>);
00798     <a class="code" href="classStudentArray.html#m11">time_to_degree</a>[<a class="code" href="Ostudent_8h.html#a33a11">DOCTOR_DEGREE</a>][THIS_YEAR] = math.safe_divide(<a class="code" href="classStudentArray.html#m17">time_to_degree_cumm</a>[<a class="code" href="Ostudent_8h.html#a33a11">DOCTOR_DEGREE</a>], <a class="code" href="classStudentArray.html#m22">cur_doctor_degree</a>);
00799 
00800     <span class="comment">//--- special case handling: smooth the graph for bachelor Time to Degree ---//</span>
00801 
00802     <a class="code" href="classStudentArray.html#m13">fake_disp_time_to_degree</a>[<a class="code" href="Ostudent_8h.html#a33a9">BACHELOR_DEGREE</a>][THIS_YEAR] = m.fmax( <a class="code" href="classStudentArray.html#m11">time_to_degree</a>[<a class="code" href="Ostudent_8h.html#a33a9">BACHELOR_DEGREE</a>][THIS_YEAR], math.get_random_snd(4.3f, 0.07f) );
00803 
00804     <span class="comment">//-----------------------------------------//</span>
00805     <span class="keywordtype">int</span> curSize[<a class="code" href="Ostudent_8h.html#a33a8">DEGREE_TYPE_COUNT</a>];                 <span class="comment">// new student count this year</span>
00806     <span class="keyword">const</span> <span class="keywordtype">char</span> degMap[<a class="code" href="Ostudent_8h.html#a0">MAX_STUDENT_LEVEL</a>] = { <a class="code" href="Ostudent_8h.html#a33a9">BACHELOR_DEGREE</a>, -1, <a class="code" href="Ostudent_8h.html#a33a10">MASTER_DEGREE</a>, <a class="code" href="Ostudent_8h.html#a33a11">DOCTOR_DEGREE</a>, -1};
00807 
00808     memset(curSize,0,<span class="keyword">sizeof</span>(curSize));
00809 
00810     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=<a class="code" href="classDynArray.html#a28">size</a>(); i&gt;0; i--) {
00811         <span class="keywordflow">if</span> ( <a class="code" href="classStudentArray.html#a9">is_deleted</a>(i) )
00812             <span class="keywordflow">continue</span>;
00813 
00814         <a class="code" href="classStudent.html">Student</a>* stuPtr = <a class="code" href="classStudentArray.html#a10">operator[]</a>(i);
00815 
00816         <span class="comment">// assume called after next_trimester and then enrollment</span>
00817         <span class="keywordflow">if</span> ( stuPtr-&gt;<a class="code" href="classStudent.html#m6">year_in_program</a> == 1 ) {
00818             <span class="keywordtype">char</span> deg = degMap[stuPtr-&gt;<a class="code" href="classStudent.html#m2">student_level</a>];
00819 
00820             <span class="keywordflow">if</span> (deg &gt;= 0)
00821                 curSize[deg]++;
00822         }
00823     }
00824 
00825     <span class="keyword">const</span> <span class="keywordtype">float</span> lamda[] = { 0.775f, 0.1f, 0.8f };
00826 
00827     <span class="keywordflow">for</span> (y=0; y&lt;<a class="code" href="Ostudent_8h.html#a33a8">DEGREE_TYPE_COUNT</a>; y++) {
00828         <span class="comment">//990408 ave_entering_class[y] = math.latency_func(lamda[y], (float) curSize[y], ave_entering_class[y]);</span>
00829 
00830         <span class="comment">//990408 dropout_rate[y][THIS_YEAR] = math.safe_divide((float)cur_dropout[y], ave_entering_class[y]);</span>
00831 
00832         <a class="code" href="classStudentArray.html#m12">dropout_rate</a>[y][THIS_YEAR] = (float) <a class="code" href="classStudentArray.html#m18">cur_dropout</a>[y];
00833     }
00834 
00835     <span class="comment">//-----------------------------------------//</span>
00836 
00837     <a class="code" href="classStudentArray.html#m20">cur_bachelor_degree</a> = 0;                        <span class="comment">// reset it, it will be incremented as students graduate</span>
00838 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00839 <span class="preprocessor"></span>    cur_non_ug_bachelor_degree = 0;
00840 <span class="preprocessor">#endif</span>
00841 <span class="preprocessor"></span>    <a class="code" href="classStudentArray.html#m21">cur_master_degree</a>   = 0;
00842     <a class="code" href="classStudentArray.html#m22">cur_doctor_degree</a>   = 0;
00843 
00844     <span class="keywordflow">for</span> (y=0; y&lt;<a class="code" href="Ostudent_8h.html#a33a8">DEGREE_TYPE_COUNT</a>; y++) {
00845         <a class="code" href="classStudentArray.html#m17">time_to_degree_cumm</a>[y] = 0;
00846         <a class="code" href="classStudentArray.html#m18">cur_dropout</a>[y] = 0;
00847 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00848 <span class="preprocessor"></span>        last_year_dropout[y]=0;
00849         last_year_dropout[y+1]=0;
00850         last_year_degree[y]=0;
00851         last_year_degree[y+1]=0;
00852 <span class="preprocessor">#endif</span>
00853 <span class="preprocessor"></span>    }
00854 
00855     <a class="code" href="classStudentArray.html#m23">ave_time_to_graduation_for_ug</a> = 0;
00856 }
00857 
00858 <span class="comment">//---------- End of function Student::calc_degree_awarded -----------//</span>
00859 
00860 <span class="comment">/*</span>
00861 <span class="comment">//---------- Begin of function Student::calc_faculty_workweek -----------//</span>
00862 <span class="comment">void Template::template()</span>
00863 <span class="comment">{</span>
00864 <span class="comment">  const char M_VAR_COUNT=6;</span>
00865 <span class="comment">  int i;</span>
00866 <span class="comment">  float input[M_VAR_COUNT];</span>
00867 <span class="comment">  memset(input, 0, sizeof(input));</span>
00868 <span class="comment">  //--------------//</span>
00869 <span class="comment">  //--------------//</span>
00870 <span class="comment">  //--------------//</span>
00871 <span class="comment">//--------------//</span>
00872 <span class="comment"></span>
00873 <span class="comment">= math.dual_response_func(, input);</span>
00874 <span class="comment">= math.single_response_func(, input);</span>
00875 <span class="comment"></span>
00876 <span class="comment">float weight[M_VAR_COUNT] = {0.40f, 0.20f, 0.15f, 0.25f, };</span>
00877 <span class="comment"></span>
00878 <span class="comment">float newValue = 0;</span>
00879 <span class="comment">for(i=0; i&lt;M_VAR_COUNT; i++)</span>
00880 <span class="comment">newValue += weight[i] * input[i];</span>
00881 <span class="comment"></span>
00882 <span class="comment">= math.latency_func( 0.f, , newValue);</span>
00883 <span class="comment">}</span>
00884 <span class="comment">//---------- End of function Student::calc_faculty_workweek -----------//</span>
00885 <span class="comment">*/</span>
00886 
00887 <span class="comment">// ##### Begin MArco #### //</span>
00888 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00889 <span class="preprocessor"></span><span class="comment">// -------- Begin of function StudentArray::save_initial_data ------ //</span>
00890 <span class="keywordtype">void</span> StudentArray::save_initial_data() {
00891     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="Ostudent_8h.html#a33a8">DEGREE_TYPE_COUNT</a>; i++) {
00892         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; HISTORY_MONTH_COUNT; j++)
00893             initial_talent_academic_all[i][j] = <a class="code" href="classStudentArray.html#m2">talent_academic_all</a>[i][j];
00894 
00895         <span class="keywordflow">for</span> (j = 0; j &lt; HISTORY_YEAR_COUNT; j++) {
00896             initial_fake_disp_time_to_degree[i][j] = <a class="code" href="classStudentArray.html#m13">fake_disp_time_to_degree</a>[i][j];
00897             initial_time_to_degree[i][j] = <a class="code" href="classStudentArray.html#m11">time_to_degree</a>[i][j];
00898             initial_dropout_rate[i][j] = <a class="code" href="classStudentArray.html#m12">dropout_rate</a>[i][j];
00899         }
00900     }
00901 
00902     <span class="keywordflow">for</span> (i = 0; i &lt; HISTORY_MONTH_COUNT; i++) {
00903         initial_performance_academic_ug[i] = <a class="code" href="classStudentArray.html#m3">performance_academic_ug</a>[i];
00904         <span class="comment">//              initial_talent_academic_all[i] = talent_academic_all[BACHELOR_DEGREE][i];               //NEW</span>
00905     }
00906 
00907     <span class="keywordflow">for</span> (i = 0; i &lt; HISTORY_YEAR_COUNT; i++) {
00908         <span class="comment">//              initial_fake_disp_time_to_degree[j] = fake_disp_time_to_degree[BACHELOR_DEGREE][j];             //NEW</span>
00909 
00910         initial_bachelor_degree[i] = <a class="code" href="classStudentArray.html#m14">bachelor_degree</a>[i]+non_ug_bachelor_degree[i];
00911         initial_master_degree[i] = <a class="code" href="classStudentArray.html#m15">master_degree</a>[i];
00912         initial_doctor_degree[i] = <a class="code" href="classStudentArray.html#m16">doctor_degree</a>[i];
00913     }
00914 
00915 }
00916 
00917 <span class="comment">// -------- End of function StudentArray::save_initial_data ------ //</span>
00918 <span class="preprocessor">#endif</span>
00919 <span class="preprocessor"></span><span class="comment">// ##### End Marco ##### //</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:26 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
