<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OPLANT.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>OPLANT.CPP</h1><a href="OPLANT_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OPLANT.CPP</span>
00002 <span class="comment">//Description : PlantRes Class Definition</span>
00003 
00004 <span class="preprocessor">#include &lt;All.h&gt;</span>
00005 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00007 <span class="preprocessor">#include &lt;OSTR.h&gt;</span>
00008 <span class="preprocessor">#include &lt;OMISC.h&gt;</span>
00009 <span class="preprocessor">#include &lt;<a class="code" href="OGAMESET_8H.html">OGAMESET.H</a>&gt;</span>
00010 <span class="preprocessor">#include &lt;OPLANT.h&gt;</span>
00011 
00012 <span class="comment">//----------- Define constants -------------//</span>
00013 
<a name="l00014"></a><a class="code" href="OPLANT_8CPP.html#a0">00014</a> <span class="preprocessor">#define PLANT_DB      "PLANT"</span>
00015 <span class="preprocessor"></span>
00016 <span class="comment">//----------- Begin of function PlantRes Constructor -----//</span>
<a name="l00018"></a><a class="code" href="classPlantRes.html#a0">00018</a> <span class="comment">PlantRes::PlantRes() {</span>
00019     init_flag=0;
00020 }
00021 
00022 <span class="comment">//------------- End of function PlantRes Constructor -----//</span>
00023 
00024 <span class="comment">//----------- Begin of function PlantRes Destructor ------//</span>
00026 <span class="comment"></span>
<a name="l00027"></a><a class="code" href="classPlantRes.html#a1">00027</a> <a class="code" href="classPlantRes.html#a1">PlantRes::~PlantRes</a>() {
00028     <a class="code" href="classPlantRes.html#a3">deinit</a>();
00029 }
00030 
00031 <span class="comment">//------------- End of function PlantRes Destructor ------//</span>
00032 
00033 <span class="comment">//----------- Begin of function PlantRes::init --------//</span>
<a name="l00035"></a><a class="code" href="classPlantRes.html#a2">00035</a> <span class="comment">void PlantRes::init() {</span>
00036     <span class="keywordflow">if</span> ( init_flag )
00037         <span class="keywordflow">return</span>;
00038 
00039     <span class="comment">//----- read info from PLANT.DBF ------//</span>
00040 
00041     load_info();
00042 
00043     <span class="comment">//---- open bitmap resource of different resolutions ----//</span>
00044 
00045     load_res( <a class="code" href="Gamedef_8h.html#a72a19">ZOOM_SMALL</a> , <span class="stringliteral">"PLANT"</span>, <span class="stringliteral">"S"</span> );
00046     load_res( <a class="code" href="Gamedef_8h.html#a72a20">ZOOM_MEDIUM</a>, <span class="stringliteral">"PLANT"</span>, <span class="stringliteral">"M"</span> );
00047     load_res( <a class="code" href="Gamedef_8h.html#a72a21">ZOOM_LARGE</a> , <span class="stringliteral">"PLANT"</span>, <span class="stringliteral">"L"</span> );
00048 
00049     <span class="comment">//----------------------------------------//</span>
00050 
00051     init_flag=1;
00052 }
00053 
00054 <span class="comment">//------------- End of function PlantRes::init --------//</span>
00055 
00056 <span class="comment">//----------- Begin of function PlantRes::deinit --------//</span>
<a name="l00058"></a><a class="code" href="classPlantRes.html#a3">00058</a> <span class="comment">void PlantRes::deinit() {</span>
00059     <span class="keywordflow">if</span>( init_flag ) {
00060         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;<a class="code" href="Gamedef_8h.html#a9">MAX_ZOOM_LEVEL</a> ; i++ )
00061             res_bitmap[i].deinit();
00062 
00063         <a class="code" href="ALL_8H.html#a8">mem_del</a>(info_array);
00064 
00065         init_flag=0;
00066     }
00067 }
00068 
00069 <span class="comment">//------------- End of function PlantRes::deinit --------//</span>
00070 
00071 <span class="comment">//----------- Begin of function PlantRes::load_info -------//</span>
00075 <span class="comment">void PlantRes::load_info() {</span>
00076     <a class="code" href="structPlantRec.html">PlantRec</a>  *plantRec;
00077     <a class="code" href="structPlantInfo.html">PlantInfo</a> *plantInfo;
00078     <span class="keywordtype">int</span>      i;
00079     <a class="code" href="classDatabase.html">Database</a> *dbPlant = game_set.open_db(<a class="code" href="OPLANT_8CPP.html#a0">PLANT_DB</a>);
00080 
00081     plant_count = (short) dbPlant-&gt;<a class="code" href="classDatabase.html#a7">rec_count</a>();
00082     info_array = (<a class="code" href="structPlantInfo.html">PlantInfo</a>*) <a class="code" href="ALL_8H.html#a5">mem_add</a>( <span class="keyword">sizeof</span>(<a class="code" href="structPlantInfo.html">PlantInfo</a>)*plant_count );
00083 
00084     <span class="comment">//------ read in plant bitmap info array -------//</span>
00085 
00086     memset( info_array, 0, <span class="keyword">sizeof</span>(<a class="code" href="structPlantInfo.html">PlantInfo</a>) * plant_count );
00087 
00088     <span class="keywordflow">for</span>( i=0 ; i&lt;plant_count ; i++ ) {
00089         plantRec  = (<a class="code" href="structPlantRec.html">PlantRec</a>*) dbPlant-&gt;<a class="code" href="classDatabase.html#a4">read</a>(i+1);
00090         plantInfo = info_array+i;
00091 
00092         m.rtrim_fld( plantInfo-&gt;<a class="code" href="structPlantInfo.html#m0">file_name</a>, plantRec-&gt;<a class="code" href="structPlantRec.html#m0">file_name</a>, plantRec-&gt;<a class="code" href="structPlantRec.html#s6s0">FILE_NAME_LEN</a> );
00093     }
00094 }
00095 
00096 <span class="comment">//----------- End of function PlantRes::load_info -------//</span>
00097 
00098 <span class="comment">//----------- Begin of function PlantRes::load_res --------//</span>
00100 <span class="comment">void PlantRes::load_res(int zoomLevel, char* namePrefix, char* nameSuffix) {</span>
00101     <span class="comment">//------ read bitmaps into memory -----//</span>
00102 
00103     <a class="code" href="classString.html">String</a> str2;
00104 
00105     str2  = <a class="code" href="Gamedef_8h.html#a4">DIR_RES</a>;
00106     str2 += namePrefix;
00107     str2 += <span class="stringliteral">"_"</span>;
00108     str2 += nameSuffix;
00109 
00110     str2 += <span class="stringliteral">".RES"</span>;
00111 
00112     res_bitmap[zoomLevel].init( str2, 1 );          <span class="comment">// 1-read all bitmaps into memory</span>
00113 
00114     <span class="comment">//-------- set PlantInfo::bitmap_ptr[] --------//</span>
00115 
00116     <span class="keywordtype">char</span>* bmpPtr;
00117 
00118     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;plant_count ; i++ ) {
00119         bmpPtr = res_bitmap[zoomLevel].read( info_array[i].file_name );
00120 
00121         info_array[i].bitmap_ptr[zoomLevel] = bmpPtr;
00122     }
00123 }
00124 
00125 <span class="comment">//------------- End of function PlantRes::load_res --------//</span>
00126 
00127 <span class="comment">//---------- Begin of function PlantRes::operator[] -----------//</span>
00128 
<a name="l00129"></a><a class="code" href="classPlantRes.html#a4">00129</a> <a class="code" href="structPlantInfo.html">PlantInfo</a>* <a class="code" href="classPlantRes.html#a4">PlantRes::operator[]</a>(<span class="keywordtype">int</span> plantId) {
00130     <a class="code" href="ALL_8H.html#a2">err_if</a>( plantId&lt;1 || plantId&gt;<a class="code" href="classPlantRes.html#m1">plant_count</a> )
00131         <a class="code" href="ALL_8H.html#a4">err_now</a>( <span class="stringliteral">"PlantRes::operator[]"</span> );
00132 
00133     <span class="keywordflow">return</span> <a class="code" href="classPlantRes.html#m2">info_array</a>+plantId-1;
00134 }
00135 
00136 <span class="comment">//------------ End of function PlantRes::operator[] -----------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:10 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
