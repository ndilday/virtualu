<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Ospinner.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Ospinner.cpp</h1><a href="Ospinner_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OSPINNER.CPP</span>
00002 <span class="comment">//Description : Spinner class</span>
00003 
00004 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00005 <span class="preprocessor">#include &lt;<a class="code" href="KEY_8H.html">KEY.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00007 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00008 <span class="preprocessor">#include &lt;OCONFIG.H&gt;</span>
00009 <span class="preprocessor">#include &lt;OFONT.H&gt;</span>
00010 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00011 <span class="preprocessor">#include &lt;OSPINNER.H&gt;</span>
00012 <span class="preprocessor">#include &lt;OIFACE.H&gt;</span>
00013 <span class="preprocessor">#include &lt;<a class="code" href="OIMGRES_8H.html">OIMGRES.H</a>&gt;</span>
00014 <span class="preprocessor">#include &lt;OBUTTON.H&gt;</span>
00015 <span class="preprocessor">#include &lt;OMISC.H&gt;</span>
00016 <span class="preprocessor">#include &lt;<a class="code" href="OSTR_8H.html">OSTR.H</a>&gt;</span>
00017 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00018 
00019 <span class="comment">//--------- define constant ---------//</span>
00020 
00021 <span class="keyword">enum</span> {
00022     <a class="code" href="Ospinner_8cpp.html#a3a0">BUTTON_WIDTH</a> = 12,
00023     <a class="code" href="Ospinner_8cpp.html#a3a1">GET_A_FIELD_OFFSET</a> = 15,
00024     <a class="code" href="Ospinner_8cpp.html#a3a2">FIELD_WIDTH</a> = 15
00025 };
00026 
00027 <span class="comment">//-------------- Define static vars ------------//</span>
00028 
00029 <span class="comment">//### begin zb 02/23/99</span>
<a name="l00030"></a><a class="code" href="classSpinner.html#p0">00030</a> <span class="keywordtype">char</span> <a class="code" href="classSpinner.html#p0">Spinner::focus</a>=0;
<a name="l00031"></a><a class="code" href="classSpinner.html#p1">00031</a> <a class="code" href="classSpinner.html">Spinner</a>* <a class="code" href="classSpinner.html#p1">Spinner::which</a>=<a class="code" href="OHELP_8H.html#a0">NULL</a>;
00032 <span class="comment">//### end zb 02/23/99</span>
00033 
00034 <span class="comment">//-------- Begin of function Spinner::Spinner ------//</span>
<a name="l00036"></a><a class="code" href="classSpinner.html#a0">00036</a> <span class="comment">Spinner::Spinner() {</span>
00037     button_up_bitmap = NULL;
00038     button_down_bitmap = NULL;
00039     button_up_pressed_bitmap = NULL;
00040     button_down_pressed_bitmap = NULL;
00041     button_up_disable_bitmap = NULL;
00042     button_down_disable_bitmap = NULL;
00043     field_bitmap = NULL;
00044 
00045     get_a_field = <span class="keyword">new</span> <span class="keywordtype">char</span>[<a class="code" href="Ospinner_8cpp.html#a3a2">FIELD_WIDTH</a>+1];
00046     paint_flag = 0;
00047     <span class="comment">// ##### begin Gilbert 01/09/2001 ######//</span>
00048     pause_when_focus = 1;                           <span class="comment">// modify pause_when_focus before init</span>
00049     <span class="comment">// ##### end Gilbert 01/09/2001 ######//</span>
00050     <span class="comment">// ##### begin Gilbert 06/03/2001 ######//</span>
00051     original_game_speed = -1;
00052     <span class="comment">// ##### end Gilbert 06/03/2001 ######//</span>
00053     init_flag = 0;
00054 }
00055 
00056 <span class="comment">//---------- End of function Spinner::Spinner ------//</span>
00057 
00058 <span class="comment">//-------- Begin of function Spinner::~Spinner -----//</span>
<a name="l00060"></a><a class="code" href="classSpinner.html#a1">00060</a> <span class="comment">Spinner::~Spinner() {</span>
00061     deinit();
00062     <span class="comment">// #### begin Gilbert 29/08/2001 //</span>
00063     <span class="keyword">delete</span>[] get_a_field;
00064     <span class="comment">// #### end Gilbert 29/08/2001 //</span>
00065 }
00066 
00067 <span class="comment">//---------- End of function Spinner::~Spinner -----//</span>
00068 
00069 <span class="comment">//-------- Begin of function Spinner::deinit -------//</span>
<a name="l00071"></a><a class="code" href="classSpinner.html#a3">00071</a> <span class="comment">void Spinner::deinit() {</span>
00072     <span class="comment">// ##### begin Gilbert 01/09/2001 ######//</span>
00073     <span class="keywordflow">if</span>( pause_when_focus ) {
00074         <span class="comment">// ##### end Gilbert 01/09/2001 ######//</span>
00075         <span class="comment">//### begin zb 02/23/99</span>
00076         focus=0;
00077         which=NULL;
00078         <span class="comment">// ##### begin Gilbert 06/03/2002 ######//</span>
00079         <span class="keywordflow">if</span>(sys.main_hwnd!=NULL&amp;&amp;config.frame_speed==0 &amp;&amp; original_game_speed!=-1 )
00080             <span class="comment">// ##### end Gilbert 06/03/2002 ######//</span>
00081             sys.set_speed(original_game_speed);
00082         <span class="comment">//### end zb 02/23/99</span>
00083     }
00084 
00085     <span class="comment">// ##### begin Gilbert 27/04/2001 #######//</span>
00086     button_up.deinit();
00087     button_down.deinit();
00088     <span class="comment">// ##### end Gilbert 27/04/2001 #######//</span>
00089     <span class="keywordflow">if</span> (button_up_bitmap) {
00090         <a class="code" href="ALL_8H.html#a8">mem_del</a>(button_up_bitmap);
00091         <a class="code" href="ALL_8H.html#a8">mem_del</a>(button_down_bitmap);
00092         <a class="code" href="ALL_8H.html#a8">mem_del</a>(button_up_pressed_bitmap);
00093         <a class="code" href="ALL_8H.html#a8">mem_del</a>(button_down_pressed_bitmap);
00094         <a class="code" href="ALL_8H.html#a8">mem_del</a>(button_up_disable_bitmap);
00095         <a class="code" href="ALL_8H.html#a8">mem_del</a>(button_down_disable_bitmap);
00096         button_up_bitmap = NULL;
00097         button_down_bitmap = NULL;
00098         button_up_pressed_bitmap = NULL;
00099         button_down_pressed_bitmap = NULL;
00100         button_up_disable_bitmap = NULL;
00101         button_down_disable_bitmap = NULL;
00102     }
00103     <span class="keywordflow">if</span> (field_bitmap) {
00104         <a class="code" href="ALL_8H.html#a8">mem_del</a>(field_bitmap);
00105         field_bitmap = NULL;
00106     }
00107 
00108     init_flag = 0;
00109 }
00110 
00111 <span class="comment">//---------- End of function Spinner::deinit ----------//</span>
00112 
00113 <span class="comment">//-------- Begin of function Spinner::init ------------//</span>
<a name="l00128"></a><a class="code" href="classSpinner.html#a2">00128</a> <span class="comment">void Spinner::init(int x1, int y1, int x2, int y2, float *varPtr, float minVal, float maxVal, float stepVal, char transparentFlag, int fillColor, int formatType) {</span>
00129     <span class="comment">//### begin zb 02/23/99</span>
00130     focus=0;
00131     which=NULL;
00132     <span class="comment">//### end zb 02/23/99</span>
00133 
00134     <a class="code" href="ALL_8H.html#a0">err_when</a> (x2 - x1 &lt; <a class="code" href="Ospinner_8cpp.html#a3a0">BUTTON_WIDTH</a>);
00135 
00136     spinner_x1 = x1;
00137     spinner_y1 = y1;
00138     spinner_x2 = x2;
00139     spinner_y2 = y2;
00140     var_ptr = varPtr;
00141     min_val = minVal;
00142     max_val = maxVal;
00143     step_val = stepVal;
00144 
00145     <span class="comment">//---- BUGHERE, override all from 0.1 to 0.5 for Virtual U project only ---//</span>
00146 
00147     <span class="keywordflow">if</span>( step_val == 0.1f )
00148         step_val = 0.5f;
00149 
00150     <span class="comment">//-------------------------------------------------//</span>
00151 
00152     transparent_flag = transparentFlag;
00153     fill_color = fillColor;
00154     format_type = formatType;
00155 
00156     font_ptr = &amp;font_charts;
00157 
00158     deinit();
00159 
00160     <span class="comment">// ##### begin Gilbert 06/03/2001 ######//</span>
00161     original_game_speed = -1;
00162     <span class="comment">// ##### end Gilbert 06/03/2001 ######//</span>
00163     init_flag = 1;
00164 
00165     cursor_flag = 0;
00166     input_flag = 0;
00167 
00168     <span class="keywordflow">if</span> (transparent_flag) {
00169         button_up.create_bitmapW(spinner_x2-<a class="code" href="Ospinner_8cpp.html#a3a0">BUTTON_WIDTH</a>-1, spinner_y1+5, spinner_x2-2, (spinner_y1+spinner_y2)/2, button_up_bitmap);
00170         button_down.create_bitmapW(spinner_x2-<a class="code" href="Ospinner_8cpp.html#a3a0">BUTTON_WIDTH</a>-1, (spinner_y1+spinner_y2)/2+1, spinner_x2-2, spinner_y2-2, button_down_bitmap);
00171     }
00172     <span class="keywordflow">else</span> {
00173         button_up.create_bitmapW(spinner_x2-<a class="code" href="Ospinner_8cpp.html#a3a0">BUTTON_WIDTH</a>-1, spinner_y1+5, spinner_x2-2, (spinner_y1+spinner_y2)/2, NULL);
00174         button_down.create_bitmapW(spinner_x2-<a class="code" href="Ospinner_8cpp.html#a3a0">BUTTON_WIDTH</a>-1, (spinner_y1+spinner_y2)/2+1, spinner_x2-2, spinner_y2-2, NULL);
00175     }
00176 
00177     image_interface.put_back(spinner_x2-<a class="code" href="Ospinner_8cpp.html#a3a0">BUTTON_WIDTH</a>, spinner_y1+5, <span class="stringliteral">"SPIN_U_O"</span> );
00178     image_interface.put_back(spinner_x2-<a class="code" href="Ospinner_8cpp.html#a3a0">BUTTON_WIDTH</a>, (spinner_y1+spinner_y2)/2+1, <span class="stringliteral">"SPIN_D_O"</span> );
00179     button_up_bitmap = vga_back.save_area(
00180         spinner_x2-<a class="code" href="Ospinner_8cpp.html#a3a0">BUTTON_WIDTH</a>, spinner_y1+5,
00181         spinner_x2, spinner_y1+5+<a class="code" href="Ospinner_8cpp.html#a3a0">BUTTON_WIDTH</a>, button_up_bitmap);
00182     button_down_bitmap = vga_back.save_area(
00183         spinner_x2-<a class="code" href="Ospinner_8cpp.html#a3a0">BUTTON_WIDTH</a>, (spinner_y1+spinner_y2)/2+1,
00184         spinner_x2, (spinner_y1+spinner_y2)/2+1+<a class="code" href="Ospinner_8cpp.html#a3a0">BUTTON_WIDTH</a>, button_down_bitmap);
00185     image_interface.put_back(spinner_x2-<a class="code" href="Ospinner_8cpp.html#a3a0">BUTTON_WIDTH</a>, spinner_y1+5, <span class="stringliteral">"SPIN_U_F"</span> );
00186     image_interface.put_back(spinner_x2-<a class="code" href="Ospinner_8cpp.html#a3a0">BUTTON_WIDTH</a>, (spinner_y1+spinner_y2)/2+1, <span class="stringliteral">"SPIN_D_F"</span> );
00187     button_up_pressed_bitmap = vga_back.save_area(
00188         spinner_x2-<a class="code" href="Ospinner_8cpp.html#a3a0">BUTTON_WIDTH</a>, spinner_y1+5,
00189         spinner_x2, spinner_y1+5+<a class="code" href="Ospinner_8cpp.html#a3a0">BUTTON_WIDTH</a>, button_up_pressed_bitmap);
00190     button_down_pressed_bitmap = vga_back.save_area(
00191         spinner_x2-<a class="code" href="Ospinner_8cpp.html#a3a0">BUTTON_WIDTH</a>, (spinner_y1+spinner_y2)/2+1,
00192         spinner_x2, (spinner_y1+spinner_y2)/2+1+<a class="code" href="Ospinner_8cpp.html#a3a0">BUTTON_WIDTH</a>, button_down_pressed_bitmap);
00193     image_interface.put_back(spinner_x2-<a class="code" href="Ospinner_8cpp.html#a3a0">BUTTON_WIDTH</a>, spinner_y1+5, <span class="stringliteral">"SPIN_DIS"</span> );
00194     image_interface.put_back(spinner_x2-<a class="code" href="Ospinner_8cpp.html#a3a0">BUTTON_WIDTH</a>, (spinner_y1+spinner_y2)/2+1, <span class="stringliteral">"SPIN_DIS"</span> );
00195     user_interface.darken(spinner_x2-<a class="code" href="Ospinner_8cpp.html#a3a0">BUTTON_WIDTH</a>, spinner_y1+5,
00196                           spinner_x2, (spinner_y1+spinner_y2)/2+1+<a class="code" href="Ospinner_8cpp.html#a3a0">BUTTON_WIDTH</a>  );
00197     button_up_disable_bitmap = vga_back.save_area(
00198         spinner_x2-<a class="code" href="Ospinner_8cpp.html#a3a0">BUTTON_WIDTH</a>, spinner_y1+5,
00199         spinner_x2, spinner_y1+5+<a class="code" href="Ospinner_8cpp.html#a3a0">BUTTON_WIDTH</a>, button_up_disable_bitmap);
00200     button_down_disable_bitmap = vga_back.save_area(
00201         spinner_x2-<a class="code" href="Ospinner_8cpp.html#a3a0">BUTTON_WIDTH</a>, (spinner_y1+spinner_y2)/2+1,
00202         spinner_x2, (spinner_y1+spinner_y2)/2+1+<a class="code" href="Ospinner_8cpp.html#a3a0">BUTTON_WIDTH</a>, button_down_disable_bitmap);
00203 
00204     get_a.init(spinner_x1+<a class="code" href="Ospinner_8cpp.html#a3a1">GET_A_FIELD_OFFSET</a>, (spinner_y1+2+spinner_y2-font_ptr-&gt;font_height)/2, spinner_x2-<a class="code" href="Ospinner_8cpp.html#a3a1">GET_A_FIELD_OFFSET</a>-<a class="code" href="Ospinner_8cpp.html#a3a0">BUTTON_WIDTH</a>, get_a_field, <a class="code" href="Ospinner_8cpp.html#a3a2">FIELD_WIDTH</a>, font_ptr, -1, 0);
00205     get_a.cursor_pos = 0;
00206     get_a.mark_cursor_pos = 0;
00207 
00208     <span class="keywordflow">if</span> (transparent_flag)
00209         paint();
00210 }
00211 
00212 <span class="comment">//---------- End of function Spinner::init ------------//</span>
00213 
00214 <span class="comment">//-------- Begin of function Spinner::paint ------------//</span>
<a name="l00216"></a><a class="code" href="classSpinner.html#a4">00216</a> <span class="comment">void Spinner::paint() {</span>
00217     <span class="keywordflow">if</span>(transparent_flag) {
00218         user_interface.brighten(spinner_x1+4, spinner_y1+4, spinner_x2-<a class="code" href="Ospinner_8cpp.html#a3a0">BUTTON_WIDTH</a>-3, spinner_y2-2);
00219         field_bitmap = vga_back.save_area(spinner_x1+4, spinner_y1+4, spinner_x2-<a class="code" href="Ospinner_8cpp.html#a3a0">BUTTON_WIDTH</a>-3, spinner_y2-2, field_bitmap);
00220     }
00221     paint_flag = 1;
00222     refresh();
00223 }
00224 
00225 <span class="comment">//---------- End of function Spinner::paint ------------//</span>
00226 
00227 <span class="comment">//-------- Begin of function Spinner::refresh ------------//</span>
<a name="l00229"></a><a class="code" href="classSpinner.html#a5">00229</a> <span class="comment">void Spinner::refresh() {</span>
00230     <span class="comment">//  err_when(*var_ptr &lt; min_val);  //## chea 300899 should handle below</span>
00231     <span class="comment">//  err_when(*var_ptr &gt; max_val);</span>
00232 
00233     <span class="keywordflow">if</span> (*var_ptr &gt;= max_val)
00234         button_up.body_ptr =  (<span class="keywordtype">void</span>*) (button_up_disable_bitmap+4);
00235     <span class="keywordflow">else</span>
00236         button_up.body_ptr =  (<span class="keywordtype">void</span>*) (button_up_bitmap+4);
00237     <span class="keywordflow">if</span> (*var_ptr &lt;= min_val)
00238         button_down.body_ptr =(<span class="keywordtype">void</span>*) (button_down_disable_bitmap+4);
00239     <span class="keywordflow">else</span>
00240         button_down.body_ptr =(<span class="keywordtype">void</span>*) (button_down_bitmap+4);
00241 
00242     <span class="keywordflow">if</span> (transparent_flag) {
00243         user_interface.rect(spinner_x1, spinner_y1, spinner_x2+3, spinner_y2, 2);
00244         user_interface.paint(spinner_x2-<a class="code" href="Ospinner_8cpp.html#a3a0">BUTTON_WIDTH</a>-2, spinner_y1+4, spinner_x2-3, spinner_y2-3);
00245         vga_back.rest_area(field_bitmap, 0, 0);
00246     }
00247     <span class="keywordflow">else</span> {
00248         user_interface.rect(spinner_x1, spinner_y1, spinner_x2+3, spinner_y2);
00249         user_interface.panel(spinner_x1+3, spinner_y1+3, spinner_x2-<a class="code" href="Ospinner_8cpp.html#a3a0">BUTTON_WIDTH</a>-3, spinner_y2-2, &amp;vga_back);
00250     }
00251 
00252     button_up.paint();
00253     button_down.paint();
00254 
00255     <span class="keywordflow">if</span> (!input_flag)
00256         strncpy(get_a_field, m.format(*var_ptr, format_type), <a class="code" href="Ospinner_8cpp.html#a3a2">FIELD_WIDTH</a>);
00257 
00258     get_a.paint(cursor_flag);
00259 
00260     <span class="comment">//  vga.use_front();</span>
00261     <span class="keywordflow">if</span> (!paint_flag)
00262         vga.blt_buf(spinner_x1, spinner_y1, spinner_x2+2, spinner_y2+2);
00263     <span class="keywordflow">else</span>
00264         paint_flag = 0;
00265 }
00266 
00267 <span class="comment">//---------- End of function Spinner::refresh ------------//</span>
00268 
00269 <span class="comment">//-------- Begin of function Spinner::detect -------------//</span>
<a name="l00274"></a><a class="code" href="classSpinner.html#a6">00274</a> <span class="comment">int Spinner::detect() {</span>
00275     <span class="keywordflow">if</span> (!init_flag)
00276         <span class="keywordflow">return</span> 0;
00277 
00278     <span class="comment">//### begin zb 02/23/99</span>
00279     <span class="keywordtype">char</span> del=0;
00280     <span class="keywordflow">if</span>(focus)
00281         <span class="keywordflow">if</span>(which!=<span class="keyword">this</span>)
00282             <span class="keywordflow">return</span> 0;
00283     <span class="comment">//### end zb 02/23/99</span>
00284 
00285     <span class="keywordflow">if</span> (cursor_flag || mouse.in_area(spinner_x1, spinner_y1, spinner_x2, spinner_y2)) {
00286         <span class="keywordflow">switch</span> (get_a.detect()) {
00287         <span class="keywordflow">case</span> 0:
00288             <span class="keywordflow">if</span> (mouse.is_press_button_event()) {
00289                 <span class="comment">// Out focus</span>
00290                 cursor_flag = 0;
00291                 <span class="comment">//### begin zb 02/23/99</span>
00292                 del=1;
00293                 focus=0;
00294                 which=NULL;
00295                 <span class="comment">//### end zb 02/23/99</span>
00296                 <span class="comment">// ##### begin Gilbert 01/09/2001 ######//</span>
00297                 <span class="keywordflow">if</span>( pause_when_focus ) {
00298                     <span class="comment">// ##### end Gilbert 01/09/2001 ######//</span>
00299                     <span class="comment">// ##### begin Gilbert 06/03/2002 ######//</span>
00300                     <span class="keywordflow">if</span>(config.frame_speed==0 &amp;&amp; original_game_speed!=-1 )
00301                         <span class="comment">// ##### end Gilbert 06/03/2002 ######//</span>
00302                         sys.set_speed(original_game_speed);
00303                 }
00304 
00305                 <span class="keywordflow">if</span> (input_flag) {
00306                     input_flag = 0;
00307                     get_a.cursor_pos = 0;
00308                     get_a.mark_cursor_pos = 0;
00309 
00310                     <span class="keywordflow">if</span>(get_a_field[0]==<span class="charliteral">'('</span>) {
00311                         sscanf(get_a_field+1, <span class="stringliteral">"%f"</span>, var_ptr);
00312                         (*var_ptr)*=-1;
00313                     }
00314                     <span class="keywordflow">else</span>
00315                         sscanf(get_a_field, <span class="stringliteral">"%f"</span>, var_ptr);
00316 
00317                     <span class="keywordflow">if</span> (*var_ptr &gt;= max_val) {
00318                         *var_ptr = max_val;
00319                         button_up.disable();
00320                         button_down.enable();
00321                         button_up.body_ptr = (<span class="keywordtype">void</span>*) (button_up_disable_bitmap+4);
00322                         button_down.body_ptr = (<span class="keywordtype">void</span>*) (button_up_bitmap+4);
00323                     }
00324                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*var_ptr &lt;= min_val) {
00325                         *var_ptr = min_val;
00326                         button_up.enable();
00327                         button_down.disable();
00328                         button_up.body_ptr = (<span class="keywordtype">void</span>*) (button_up_bitmap+4);
00329                         button_down.body_ptr = (<span class="keywordtype">void</span>*) (button_up_disable_bitmap+4);
00330                     }
00331                     <span class="keywordflow">else</span> {
00332                         button_up.enable();
00333                         button_down.enable();
00334                         button_down.body_ptr = (<span class="keywordtype">void</span>*) (button_down_bitmap+4);
00335                         button_up.body_ptr = (<span class="keywordtype">void</span>*) (button_up_bitmap+4);
00336                     }
00337 
00338                     <span class="keywordflow">return</span> 1;
00339                 }
00340             }
00341             <span class="keywordflow">break</span>;
00342 
00343         <span class="keywordflow">case</span> 1:
00344             cursor_flag = 1;
00345             <span class="comment">//### begin zb 02/23/99</span>
00346             focus=1;
00347             which=<span class="keyword">this</span>;
00348             <span class="comment">//### end zb 02/23/99</span>
00349             <span class="comment">// ##### begin Gilbert 01/09/2001 ######//</span>
00350             <span class="keywordflow">if</span>( pause_when_focus ) {
00351                 <span class="comment">// ##### end Gilbert 01/09/2001 ######//</span>
00352                 <span class="comment">// turn off speed</span>
00353                 <span class="keywordflow">if</span>(cursor_flag) {
00354                     original_game_speed=config.frame_speed;
00355                     sys.set_speed(0);
00356                 }
00357             }
00358             mouse.clear_event();
00359             <span class="keywordflow">return</span> 1;
00360 
00361         <span class="keywordflow">case</span> <span class="charliteral">'.'</span>:
00362         <span class="keywordflow">case</span> <span class="charliteral">'-'</span>:
00363         <span class="keywordflow">case</span> <span class="charliteral">'0'</span>:
00364         <span class="keywordflow">case</span> <span class="charliteral">'1'</span>:
00365         <span class="keywordflow">case</span> <span class="charliteral">'2'</span>:
00366         <span class="keywordflow">case</span> <span class="charliteral">'3'</span>:
00367         <span class="keywordflow">case</span> <span class="charliteral">'4'</span>:
00368         <span class="keywordflow">case</span> <span class="charliteral">'5'</span>:
00369         <span class="keywordflow">case</span> <span class="charliteral">'6'</span>:
00370         <span class="keywordflow">case</span> <span class="charliteral">'7'</span>:
00371         <span class="keywordflow">case</span> <span class="charliteral">'8'</span>:
00372         <span class="keywordflow">case</span> <span class="charliteral">'9'</span>:
00373         <span class="keywordflow">case</span> <a class="code" href="KEY_8H.html#a15">KEY_DEL</a>:
00374         <span class="keywordflow">case</span> <a class="code" href="KEY_8H.html#a0">KEY_BACK_SPACE</a>:
00375             <span class="keywordflow">if</span> (cursor_flag) {
00376                 input_flag = 1;
00377                 mouse.clear_event();
00378                 <span class="keywordflow">return</span> 1;
00379             }
00380 
00381         <span class="keywordflow">case</span> <a class="code" href="KEY_8H.html#a3">KEY_RETURN</a>:
00382             <span class="comment">//### begin zb 02/23/99</span>
00383             focus=0;
00384             which=NULL;
00385             cursor_flag = 0;
00386 
00387             <span class="keywordflow">if</span> (input_flag) {
00388                 input_flag = 0;
00389                 get_a.cursor_pos = 0;
00390                 get_a.mark_cursor_pos = 0;
00391 
00392                 <span class="keywordflow">if</span>(get_a_field[0]==<span class="charliteral">'('</span>) {
00393                     sscanf(get_a_field+1, <span class="stringliteral">"%f"</span>, var_ptr);
00394                     (*var_ptr)*=-1;
00395                 }
00396                 <span class="keywordflow">else</span>
00397                     sscanf(get_a_field, <span class="stringliteral">"%f"</span>, var_ptr);
00398 
00399                 <span class="keywordflow">if</span> (*var_ptr &gt;= max_val) {
00400                     *var_ptr = max_val;
00401                     button_up.disable();
00402                     button_down.enable();
00403                     button_up.body_ptr = (<span class="keywordtype">void</span>*) (button_up_disable_bitmap+4);
00404                     button_down.body_ptr = (<span class="keywordtype">void</span>*) (button_up_bitmap+4);
00405                 }
00406                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*var_ptr &lt;= min_val) {
00407                     *var_ptr = min_val;
00408                     button_up.enable();
00409                     button_down.disable();
00410                     button_up.body_ptr = (<span class="keywordtype">void</span>*) (button_up_bitmap+4);
00411                     button_down.body_ptr = (<span class="keywordtype">void</span>*) (button_up_disable_bitmap+4);
00412                 }
00413                 <span class="keywordflow">else</span> {
00414                     button_up.enable();
00415                     button_down.enable();
00416                     button_down.body_ptr = (<span class="keywordtype">void</span>*) (button_down_bitmap+4);
00417                     button_up.body_ptr = (<span class="keywordtype">void</span>*) (button_up_bitmap+4);
00418                 }
00419 
00420                 <span class="comment">// ##### begin Gilbert 01/09/2001 ######//</span>
00421                 <span class="keywordflow">if</span>( pause_when_focus ) {
00422                     <span class="comment">// ##### end Gilbert 01/09/2001 ######//</span>
00423                     <span class="comment">// ##### begin Gilbert 06/03/2002 ######//</span>
00424                     <span class="keywordflow">if</span>(config.frame_speed==0 &amp;&amp; original_game_speed!=-1)
00425                         <span class="comment">// ##### end Gilbert 06/03/2002 ######//</span>
00426                         sys.set_speed(original_game_speed);
00427                 }
00428                 mouse.clear_event();
00429                 <span class="keywordflow">return</span> 1;
00430             }
00431             <span class="comment">//### end zb 02/23/99</span>
00432 
00433         <span class="keywordflow">default</span>:
00434             <span class="keywordflow">if</span> (cursor_flag) {
00435                 <span class="keywordflow">if</span> (mouse.is_key_event())
00436                     mouse.clear_event();
00437                 <span class="keywordflow">return</span> 1;
00438             }
00439         }
00440     }
00441 
00442     <span class="comment">//--------- detect Increment button ----------//</span>
00443 
00444     <span class="keywordflow">if</span> (button_up.detect() ) {
00445         button_up.body_ptr = (<span class="keywordtype">void</span>*) (button_up_bitmap+4);
00446         *var_ptr += step_val;
00447         <span class="keywordflow">if</span> (*var_ptr &gt;= max_val) {
00448             *var_ptr = max_val;
00449             button_up.disable();
00450             <span class="keywordflow">if</span> (transparent_flag) {
00451                 button_up.body_ptr = (<span class="keywordtype">void</span>*) (button_up_disable_bitmap+4);
00452                 <span class="comment">//button_up.body_ptr = (void*) (image_interface.get_ptr("SPIN_DIS"));</span>
00453             }
00454         }
00455         <span class="keywordflow">if</span> (*var_ptr &gt; min_val) {
00456             button_down.enable();
00457             <span class="keywordflow">if</span> (transparent_flag) {
00458                 button_down.body_ptr = (<span class="keywordtype">void</span>*) (button_down_bitmap+4);
00459                 <span class="comment">//button_down.body_ptr = (void*) (image_interface.get_ptr("SPIN_D_O"));</span>
00460             }
00461         }
00462         <span class="keywordflow">return</span> 1;
00463     }
00464 
00465     <span class="comment">//--------- detect Decrement button ----------//</span>
00466 
00467     <span class="keywordflow">if</span> (button_down.detect()) {
00468         button_down.body_ptr = (<span class="keywordtype">void</span>*) (button_down_bitmap+4);
00469         *var_ptr -= step_val;
00470         <span class="keywordflow">if</span> (*var_ptr &lt;= min_val) {
00471             *var_ptr = min_val;
00472             button_down.disable();
00473             <span class="keywordflow">if</span> (transparent_flag) {
00474                 button_down.body_ptr = (<span class="keywordtype">void</span>*) (button_down_disable_bitmap+4);
00475                 <span class="comment">//button_down.body_ptr = (void*) (image_interface.get_ptr("SPIN_DIS"));</span>
00476             }
00477         }
00478         <span class="keywordflow">if</span> (*var_ptr &lt; max_val) {
00479             button_up.enable();
00480             <span class="keywordflow">if</span> (transparent_flag) {
00481                 button_up.body_ptr = (<span class="keywordtype">void</span>*) (button_up_bitmap+4);
00482                 <span class="comment">//button_up.body_ptr = (void*) (image_interface.get_ptr("SPIN_U_O"));</span>
00483             }
00484         }
00485         <span class="keywordflow">return</span> 1;
00486     }
00487 
00488     <span class="keywordflow">if</span>(del)
00489         mouse.clear_event();
00490 
00491     <span class="keywordflow">return</span> 0;
00492 }
00493 
00494 <span class="comment">//### end zb 02/23/99</span>
00495 <span class="comment">//---------- End of function Spinner::detect -------------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:23 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
