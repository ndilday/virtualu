<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>opsch_po.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>opsch_po.cpp</h1><a href="opsch__po_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">// Filename    : OPSCH_PO.CPP</span>
00002 <span class="comment">// Description : PlayerSchool player protagonist</span>
00003 
00004 <span class="preprocessor">#include &lt;OPSCHOOL.H&gt;</span>
00005 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00007 <span class="preprocessor">#include &lt;OGAMESTR.H&gt;</span>
00008 <span class="preprocessor">#include &lt;OMATH.H&gt;</span>
00009 <span class="preprocessor">#include &lt;ODEPT.H&gt;</span>
00010 <span class="preprocessor">#include &lt;ONEWS.H&gt;</span>
00011 <span class="preprocessor">#include &lt;OCHANCE.H&gt;</span>
00012 <span class="preprocessor">#include &lt;OENROLL.H&gt;</span>
00013 <span class="preprocessor">#include &lt;ODEVELOP.H&gt;</span>
00014 <span class="preprocessor">#include &lt;OINVEST.H&gt;</span>
00015 <span class="preprocessor">#include &lt;OFACILIT.H&gt;</span>
00016 <span class="preprocessor">#include &lt;OATHLETI.H&gt;</span>
00017 <span class="preprocessor">#include &lt;OLOSEGAM.H&gt;</span>
00018 <span class="preprocessor">#include &lt;OFINANCE.H&gt;</span>
00019 <span class="preprocessor">#include &lt;<a class="code" href="OBOX_8H.html">OBOX.H</a>&gt;</span>
00020 
00021 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00022 <span class="preprocessor"></span>
00023 <span class="keyword">static</span> <span class="keywordtype">float</span> score_function( <span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y, <span class="keywordtype">float</span> mx, <span class="keywordtype">float</span> my, <span class="keywordtype">bool</span> <a class="code" href="OTEST_8H.html#a0">test</a> ) {
00024     <span class="keywordtype">double</span> theta = atan2(mx, my);
00025     <span class="keywordtype">double</span> score;
00026     <span class="keywordflow">if</span>( test )
00027         <span class="comment">// strength</span>
00028         <span class="keywordflow">return</span> float( x * cos(theta) + y * sin(theta));
00029     <span class="keywordflow">else</span>
00030         <span class="comment">// consistency</span>
00031         <span class="keywordflow">return</span> float( -x * sin(theta) + y * cos(theta));
00032     <span class="keywordflow">return</span> (float)score;                            <span class="comment">// returns strength if test is true; otherwise returns consistency</span>
00033 }
00034 
00035 <span class="comment">// moved to opschool.h</span>
00036 <span class="comment">// return value of PlayerSchool::think_protagonist_event</span>
00037 <span class="comment">// enum { COMMENT_NONE=0, COMMENT_R1, COMMENT_R2, COMMENT_R3, COMMENT_R4, COMMENT_R5, COMMENT_R6, COMMENT_TERMINATE };</span>
00038 
00039 <span class="keyword">static</span> <span class="keywordtype">float</span> protagonist_ck1 = 5.00f;             <span class="comment">// 4.00f;</span>
00040 <span class="keyword">static</span> <span class="keywordtype">float</span> protagonist_ck2 = 2.00f;
00041 <span class="keyword">static</span> <span class="keywordtype">float</span> protagonist_ck3 = 1.75f;
00042 <span class="comment">// if a student leaves he brings 10 more students to leave</span>
00043 <span class="preprocessor">#define STUDENT_LEAVE_COUNT 10</span>
00044 <span class="preprocessor"></span><span class="preprocessor">#define STUDENT_LEAVE_COUNT_STR "ten"</span>
00045 <span class="preprocessor"></span>
00046 <span class="keyword">static</span> <span class="keywordtype">void</span> post_protagonist_message( <span class="keywordtype">int</span> protagonistId, <span class="keywordtype">int</span> rating, <span class="keywordtype">int</span> departmentRecno, <span class="keywordtype">int</span> srcDepartmentRecno, <span class="keywordtype">int</span> srcPara1, <span class="keywordtype">short</span> srcPara2, <span class="keywordtype">short</span> srcPara3, <span class="keywordtype">short</span> srcPara4 ) {
00047     news_array.protagonist_message(protagonistId, rating,
00048                                    <span class="comment">// -ve means institutional level, and magnitude indicate the departmentRecno of protagonist</span>
00049                                    departmentRecno == -1 ? -srcDepartmentRecno : departmentRecno,
00050                                    srcPara1, srcPara2, srcPara3, srcPara4 );
00051 }
00052 
00053 <span class="keyword">static</span> <span class="keywordtype">int</span> choose_arbitary_department() {
00054     <span class="keywordflow">if</span>( department_array.size() &lt;= 0 )
00055         <span class="keywordflow">return</span> 0;
00056 
00057     <span class="keywordtype">int</span> departmentRecno = m.random( department_array.size() );
00058     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = department_array.size(); i &gt; 0 &amp;&amp; department_array.is_deleted(departmentRecno); --i ) {
00059         <span class="keywordflow">if</span>( ++departmentRecno &gt; department_array.size() )
00060             departmentRecno = 1;                        <span class="comment">// increase and loop back</span>
00061     }
00062 
00063     <span class="keywordflow">if</span>( department_array.is_deleted(departmentRecno) )
00064         <span class="keywordflow">return</span> 0;
00065     <span class="keywordflow">return</span> departmentRecno;
00066 }
00067 
00068 <span class="keyword">enum</span> ProtagonistFrequency {
00069     PROTAGONIST_YEAR,
00070     PROTAGONIST_TRIMESTER,
00071     PROTAGONIST_MONTH,
00072 };
00073 
00074 <span class="keyword">enum</span> ProtagonistMsgSource {
00075     PROTAGONIST_NULL,
00076     PROTAGONIST_COMMITTEE,                          <span class="comment">// chairman of trustee committee</span>
00077     PROTAGONIST_TRUSTEE,
00078     PROTAGONIST_DEPARTMENT,                         <span class="comment">// chair of xx department</span>
00079     PROTAGONIST_SENATE,                             <span class="comment">// faculty senate</span>
00080     PROTAGONIST_PROFESSOR,
00081     PROTAGONIST_FACULTY,                            <span class="comment">// faculty member</span>
00082     PROTAGONIST_FINANCE,
00083     PROTAGONIST_FACILITIES,
00084     PROTAGONIST_ADMISSIONS,
00085     PROTAGONIST_POLICE,
00086     PROTAGONIST_STAFF,
00087     PROTAGONIST_STUDENT,
00088     PROTAGONIST_ALUMNUS,
00089     PROTAGONIST_ALUMNA,
00090 };
00091 
00092 <span class="comment">// Month start        X03)xx.02 (04)xx.04 X06)xx.06</span>
00093 <span class="comment">// Month middle</span>
00094 <span class="comment">// Month end          (10)xx.24 (11)xx.26 (20)xx.28 (22)xx.29</span>
00095 
00096 <span class="comment">// trimester start</span>
00097 <span class="comment">// trimester end      (31)00.11 (12)00.14 X05)00.17 X02)00.21</span>
00098 
00099 <span class="comment">// Year start         (27)09.10 (07)09.15 (17)09.20 (08)10.05 (23)10.10 (24)10.15 (25)11.05 (26)11.10 (28)11.15</span>
00100 <span class="comment">// Year middle        (13)02.15 X14)02.20 X15)02.25 (16)03.05 (18)03.10 (19)03.15</span>
00101 <span class="comment">// Year end           (21)07.11 X01)07.20 X09)07.30 (32)08.20</span>
00102 <span class="comment">// Year sport season  (29)12.28 (30)05.10</span>
00103 
00104                                                   <span class="comment">//                           (institue)   (dept)</span>
00105 <span class="keyword">static</span> ProtagonistInfo protagonist_info_array[MAX_PROTAGONIST_ID] = { 
00106     <span class="comment">// current trustee evaluation</span>
00107     <span class="comment">//  id,dept,ex,fire, freq,                  month,day  source,                   Rm,     Zn,   +R1,  -R4,  +R1,  -R4, insert text</span>
00108     {  1,   0, 0,   0, PROTAGONIST_YEAR,       7,20,     PROTAGONIST_NULL,      1.00f, 1.000f,     0,    0,    0,    0, <a class="code" href="OHELP_8H.html#a0">NULL</a> },
00109     <span class="comment">// degree granted</span>
00110   
00111     {   2,   0, 0,   0, PROTAGONIST_TRIMESTER,  0,21,     PROTAGONIST_NULL,      1.00f, 1.000f,     0,    0,    0,    0, <a class="code" href="OHELP_8H.html#a0">NULL</a> },
00112     <span class="comment">// sponsored performance</span>
00113   
00114     {   3,   0, 0,   0, PROTAGONIST_MONTH,      0, 2,     PROTAGONIST_NULL,      1.00f, 1.000f,     0,    0,    0,    0, <a class="code" href="OHELP_8H.html#a0">NULL</a> },
00115     <span class="comment">// institutional prestige</span>
00116   
00117     {   4,   0, 0,   1, PROTAGONIST_MONTH,      0, 4,     PROTAGONIST_TRUSTEE,   1.00f, 1.000f,    40,  -40,    0,    0, <span class="stringliteral">"institutional prestige"</span> },
00118     <span class="comment">// educational quality</span>
00119   
00120     { 5,   0, 1,   0, PROTAGONIST_TRIMESTER,  0,17,     PROTAGONIST_NULL,      1.00f, 1.000f,     0,    0,    0,    0, <a class="code" href="OHELP_8H.html#a0">NULL</a> },
00121     <span class="comment">// scholarship, broadly defined</span>
00122   
00123     { 6,   0, 0,   0, PROTAGONIST_MONTH,      0, 6,     PROTAGONIST_NULL,      1.00f, 1.000f,     0,    0,    0,    0, <a class="code" href="OHELP_8H.html#a0">NULL</a> },
00124     <span class="comment">// student diversity</span>
00125   
00126     { 7,   0, 0,   0, PROTAGONIST_YEAR,       9,15,     PROTAGONIST_STUDENT,   1.00f, 1.000f,     0,    0,    0,    0, <span class="stringliteral">"student diversity"</span> },
00127     <span class="comment">// faculty diversity</span>
00128   
00129     { 8,   1, 0,   0, PROTAGONIST_YEAR,      10, 5,     PROTAGONIST_FACULTY,   1.00f, 1.000f,     0,    0,    0,    0, <span class="stringliteral">"faculty diversity"</span> },
00130     <span class="comment">// percentage of alumni .. five years</span>
00131   
00132     { 9,   0, 0,   0, PROTAGONIST_YEAR,       7,30,     PROTAGONIST_NULL,      1.00f, 1.000f,     0,    0,    0,    0, <a class="code" href="OHELP_8H.html#a0">NULL</a> },
00133     <span class="comment">// faculty morale</span>
00134   
00135     { 10,   1, 0,   1, PROTAGONIST_MONTH,      0,24,     PROTAGONIST_FACULTY,   0.25f, 5.000f,    30,  -30,   10,  -10, <span class="stringliteral">"faculty morale"</span> },
00136     <span class="comment">// student morale</span>
00137   
00138     { 11,   1, 0,   1, PROTAGONIST_MONTH,      0,26,     PROTAGONIST_STUDENT,   0.25f, 5.000f,    30,  -30,   10,  -10, <span class="stringliteral">"student morale"</span> },
00139     <span class="comment">// staff morale</span>
00140   
00141     { 12,   0, 0,   0, PROTAGONIST_TRIMESTER,  0,14,     PROTAGONIST_STAFF,     0.25f, 5.000f,    10,  -10,    0,    0, <span class="stringliteral">"staff morale"</span> },
00142     <span class="comment">// current surplus (deficit)...</span>
00143   
00144     { 13,   0, 0,   0, PROTAGONIST_YEAR,       2,15,     PROTAGONIST_FACILITIES,2.00f, 5.000f,     0,    0,    0,    0, <a class="code" href="OHELP_8H.html#a0">NULL</a> },
00145     <span class="comment">// smooth surplus (deficit)...</span>
00146   
00147     { 14,   0, 0,   0, PROTAGONIST_YEAR,       2,20,     PROTAGONIST_NULL,      1.00f, 5.000f,     0,    0,    0,    0, <a class="code" href="OHELP_8H.html#a0">NULL</a> },
00148     <span class="comment">// endowment payout rate</span>
00149   
00150     { 15,   0, 0,   0, PROTAGONIST_YEAR,       2,25,     PROTAGONIST_NULL,      1.00f, 1.000f,     0,    0,    0,    0, <a class="code" href="OHELP_8H.html#a0">NULL</a> },
00151     <span class="comment">// deferred maintenance backlog</span>
00152   
00153     { 16,   0, 0,   0, PROTAGONIST_YEAR,       3, 5,     PROTAGONIST_FACILITIES,1.00f,-2.500f,    10,  -10,    0,    0, <span class="stringliteral">"the deferred maintenance backlog"</span> },
00154     <span class="comment">// undergraduate selectivity</span>
00155   
00156     { 17,   0, 0,   1, PROTAGONIST_YEAR,       9,20,     PROTAGONIST_ADMISSIONS,1.00f, 1.000f,    40,  -40,    0,    0, <span class="stringliteral">"undergraduate selectivity"</span> },
00157     <span class="comment">// alumni morale</span>
00158   
00159     { 18,   0, 0,   1, PROTAGONIST_YEAR,       3,10,     PROTAGONIST_COMMITTEE, 1.00f, 1.000f,    30,  -30,    0,    0, <span class="stringliteral">"alumni morale"</span> },
00160     <span class="comment">// percent alumni who donated last year</span>
00161   
00162     { 19,   0, 0,   0, PROTAGONIST_YEAR,       3,15,     PROTAGONIST_COMMITTEE, 1.00f, 1.000f,    10,  -10,    0,    0, <span class="stringliteral">"the percentage of alumni who donated last year"</span> },
00163     <span class="comment">// index of endowment market value</span>
00164   
00165     { 20,   0, 0,   0, PROTAGONIST_MONTH,      0,28,     PROTAGONIST_FINANCE,   2.00f, 0.010f,    10,  -10,    0,    0, <span class="stringliteral">"the investment performance of the endowment"</span> },
00166     <span class="comment">// crime index</span>
00167   
00168     { 21,   0, 0,   0, PROTAGONIST_YEAR,       7,11,     PROTAGONIST_POLICE,    1.00f,-1.000f,    10,  -10,    0,    0, <span class="stringliteral">"the university's crime index"</span> },
00169     <span class="comment">// faculty research performance</span>
00170   
00171     { 22,   1, 0,   1, PROTAGONIST_MONTH,      0,29,     PROTAGONIST_FACULTY,   0.25f,15.000f,    40,  -40,   10,  -10, <span class="stringliteral">"faculty research performance"</span> },
00172     <span class="comment">// faculty salaries:annual increase %</span>
00173   
00174     { 23,   0, 0,   0, PROTAGONIST_YEAR,      10,10,     PROTAGONIST_FACULTY,   2.00f, 0.005f,    20,  -20,    0,    0, <span class="stringliteral">"last year's increase in faculty salaries"</span> },
00175     <span class="comment">// faculty salaries:gender-ethnic equity</span>
00176   
00177     { 24,   0, 0,   0, PROTAGONIST_YEAR,      10,15,     PROTAGONIST_SENATE,    1.00f,-1.000f,    10,  -10,    0,    0, <span class="stringliteral">"gender-ethnic equity in faculty salaries"</span> },
00178     <span class="comment">// faculty salaries:departmental equity</span>
00179   
00180     { 25,   0, 0,   0, PROTAGONIST_YEAR,      11, 5,     PROTAGONIST_DEPARTMENT,1.00f,-0.700f,    10,  -10,    0,    0, <span class="stringliteral">"faculty salary equity among departments"</span> },
00181     <span class="comment">// faculty rank equity</span>
00182   
00183     { 26,   0, 0,   0, PROTAGONIST_YEAR,      11,10,     PROTAGONIST_SENATE,    1.00f,-0.500f,    10,  -10,    0,    0, <span class="stringliteral">"salary equity among faculty ranks"</span> },
00184     <span class="comment">// tuition:annual incrase(%)</span>
00185   
00186     { 27,   0, 0,   0, PROTAGONIST_YEAR,       9,10,     PROTAGONIST_TRUSTEE,   2.00f, 1.000f,    20,  -20,    0,    0, <span class="stringliteral">"tuition increases"</span> },
00187     <span class="comment">// space shortfall</span>
00188   
00189     { 28,   0, 0,   1, PROTAGONIST_YEAR,      11,15,     PROTAGONIST_FACILITIES,1.00f,-2.000f,    30,  -30,    0,    0, <span class="stringliteral">"space shortfall"</span> },
00190     <span class="comment">// football performance</span>
00191  
00192     { 29,   0, 0,   0, PROTAGONIST_YEAR,      12,28,     PROTAGONIST_ALUMNUS,   1.00f, 1.000f,    10,  -10,    0,    0, <span class="stringliteral">"performance in football"</span> },
00193     <span class="comment">// basketball performance</span>
00194     { 30,   0, 0,   0, PROTAGONIST_YEAR,       5,10,     PROTAGONIST_ALUMNA,    1.00f, 1.000f,    10,  -10,    0,    0, <span class="stringliteral">"performance in basketball"</span> },
00195     <span class="comment">// inst/dept education quality</span>
00196   
00197     { 31,   1, 0,   1, PROTAGONIST_TRIMESTER,  0,11,     PROTAGONIST_STUDENT,   1.00f, 2.000f,    40,  -40,   10,  -10, <span class="stringliteral">"quality of education"</span> },
00198     <span class="comment">// inst/dept prestige</span>
00199   
00200     { 32,   1, 0,   1, PROTAGONIST_YEAR,       8,20,     PROTAGONIST_FACULTY,   1.00f, 1.000f,    30,  -30,   10,  -10, <span class="stringliteral">"academic standing"</span> },
00201     <span class="comment">// course denials (% of enrollments)</span>
00202   
00203     { 33,   1, 0,   0, PROTAGONIST_TRIMESTER,  2, 1,     PROTAGONIST_STUDENT,   1.00f,-0.250f,    20,  -20,   10,  -10, <span class="stringliteral">"course denials"</span> },
00204     <span class="comment">// class size deviation</span>
00205   
00206     { 34,   1, 0,   0, PROTAGONIST_TRIMESTER,  2, 7,     PROTAGONIST_STUDENT,   1.00f,-6.000f,    20,  -20,   10,  -10, <span class="stringliteral">"class size deviations"</span> },
00207 };
00208 
00209 <span class="comment">// changes from ver2 spec :</span>
00210 <span class="comment">// 11 (student morale) frequency change to per trimester</span>
00211 <span class="comment">// 18 (alumni morale) freq change to per year</span>
00212 
00213 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00214 <span class="preprocessor"></span><span class="preprocessor">#ifdef DEBUG</span>
00215 <span class="preprocessor"></span><span class="keywordtype">void</span> PlayerSchool::set_cks( <span class="keywordtype">int</span> index, <span class="keywordtype">float</span> change ) {
00216     <span class="keywordflow">switch</span> (index) {
00217     <span class="keywordflow">case</span> 1: protagonist_ck1 += change; <span class="keywordflow">break</span>;
00218     <span class="keywordflow">case</span> 2: protagonist_ck2 += change; <span class="keywordflow">break</span>;
00219     <span class="keywordflow">case</span> 3: protagonist_ck3 += change; <span class="keywordflow">break</span>;
00220     }
00221     sys.redraw_all_flag = 1;
00222 }
00223 
00224 <span class="keywordtype">void</span> PlayerSchool::get_cks( <span class="keywordtype">float</span> &amp;ck1, <span class="keywordtype">float</span> &amp;ck2, <span class="keywordtype">float</span> &amp;ck3 ) {
00225     ck1 = protagonist_ck1;
00226     ck2 = protagonist_ck2;
00227     ck3 = protagonist_ck3;
00228 }
00229 <span class="preprocessor">#endif</span>
00230 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00231 <span class="preprocessor"></span>
00232 <span class="comment">// generate opinion from people</span>
00233 <span class="keywordtype">void</span> PlayerSchool::think_protagonist() {
00234     <span class="keywordflow">if</span>( info.prerun_year || !threshold_event_flag )
00235         <span class="keywordflow">return</span>;
00236 
00237     ProtagonistInfo *protagonistInfo;
00238     <span class="keywordtype">int</span> rc = 0;
00239 
00240     <span class="comment">// Current trustee evaluation (Dept:no|Freq:Year|Protagonist:na|Inserted text:na|mx:1.00|Zn:1.000|+R1:na|-R4:na|Fired?:na)</span>
00241 
00242     protagonistInfo = protagonist_info_array;
00243     <a class="code" href="ALL_8H.html#a0">err_when</a>( protagonistInfo-&gt;protagonist_id != 1 );
00244 
00245     <span class="keywordflow">if</span>( protagonistInfo-&gt;is_event_date() )
00246         rc = think_protagonist_event( <a class="code" href="classPlayerSchool.html#m94">cur_game_score</a>, <a class="code" href="classPlayerSchool.html#m87">game_score_history</a>[HISTORY_MONTH_COUNT-1-12], <a class="code" href="classPlayerSchool.html#m93">init_game_score</a>,
00247                                       protagonistInfo, -1 );                      <span class="comment">// -1=institutional level</span>
00248 
00249     <span class="keywordflow">if</span>( rc == COMMENT_TERMINATE )
00250         <span class="keywordflow">return</span>;
00251 
00252     <span class="comment">// S_DEGREES_GRANTED to S_DEFERRED_MAINTENANCE_BACKLOG_PERCENT</span>
00253     <a class="code" href="ALL_8H.html#a0">err_when</a>( <a class="code" href="Opschool_8h.html#a65a52">SCORE_VAR_COUNT</a> != 15 );
00254     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> subScoreType = 0; subScoreType &lt; <a class="code" href="Opschool_8h.html#a65a52">SCORE_VAR_COUNT</a>; ++subScoreType ) {
00255         ++protagonistInfo;
00256 
00257         <span class="keywordflow">if</span>( protagonistInfo-&gt;exist_departmental_level )
00258             <span class="keywordflow">continue</span>;                                   <span class="comment">// duplicated, skip</span>
00259 
00260         <span class="keywordflow">if</span>( protagonistInfo-&gt;is_event_date() ) {
00261             rc = think_protagonist_event( <a class="code" href="classPlayerSchool.html#m84">sub_score</a>[subScoreType][HISTORY_MONTH_COUNT-1], <a class="code" href="classPlayerSchool.html#m84">sub_score</a>[subScoreType][HISTORY_MONTH_COUNT-13], <a class="code" href="classPlayerSchool.html#m86">sub_score_start</a>[subScoreType],
00262                                           protagonistInfo, -1 );                    <span class="comment">// -1=institutional level</span>
00263 
00264             <span class="keywordflow">if</span>( rc == COMMENT_TERMINATE )
00265                 <span class="keywordflow">return</span>;
00266 
00267             <span class="keywordflow">if</span>( protagonistInfo-&gt;departmental_level ) {
00268                 <span class="comment">// scan each department (skip general department?)</span>
00269                 <span class="keywordflow">for</span>( <span class="keywordtype">int</span> deptRecno = 1; deptRecno &lt;= department_array.size(); ++deptRecno ) {
00270                     <span class="keywordflow">if</span>( department_array.is_deleted(deptRecno) )
00271                         <span class="keywordflow">continue</span>;
00272 
00273                     <a class="code" href="classDepartment.html">Department</a> *deptPtr = department_array[deptRecno];
00274 
00275                     <span class="keywordflow">switch</span>( subScoreType ) {
00276                     <span class="keywordflow">case</span> <a class="code" href="Opschool_8h.html#a65a43">S_FACULTY_DIVERSITY</a>:
00277                         rc = think_protagonist_event( deptPtr-&gt;<a class="code" href="classDepartment.html#m57">p_faculty_diversity_history</a>[HISTORY_YEAR_COUNT-1], deptPtr-&gt;<a class="code" href="classDepartment.html#m57">p_faculty_diversity_history</a>[HISTORY_YEAR_COUNT-2], deptPtr-&gt;initial_p_faculty_diversity,
00278                                                       protagonistInfo, deptRecno );     <span class="comment">// departmental level</span>
00279                         <span class="keywordflow">break</span>;
00280                     <span class="keywordflow">case</span> <a class="code" href="Opschool_8h.html#a65a45">S_FACULTY_MORALE</a>:
00281                         rc = think_protagonist_event( deptPtr-&gt;<a class="code" href="classDepartment.html#m56">p_faculty_morale_history</a>[HISTORY_MONTH_COUNT-1], deptPtr-&gt;<a class="code" href="classDepartment.html#m56">p_faculty_morale_history</a>[HISTORY_MONTH_COUNT-13], deptPtr-&gt;initial_p_faculty_morale,
00282                                                       protagonistInfo, deptRecno );     <span class="comment">// departmental level</span>
00283                         <span class="keywordflow">break</span>;
00284                     <span class="keywordflow">case</span> <a class="code" href="Opschool_8h.html#a65a46">S_STUDENT_MORALE</a>:
00285                         rc = think_protagonist_event( deptPtr-&gt;<a class="code" href="classDepartment.html#m54">p_student_morale_history</a>[HISTORY_TRIMESTER_COUNT-1], deptPtr-&gt;<a class="code" href="classDepartment.html#m54">p_student_morale_history</a>[HISTORY_TRIMESTER_COUNT-1-<a class="code" href="Gamedef_8h.html#a78a35">TRIMESTER_PER_YEAR</a>], deptPtr-&gt;initial_p_student_morale,
00286                                                       protagonistInfo, deptRecno );     <span class="comment">// departmental level</span>
00287                         <span class="keywordflow">break</span>;
00288                     <span class="keywordflow">default</span>:
00289                         <a class="code" href="ALL_8H.html#a1">err_here</a>();
00290                     }
00291                 }
00292             }
00293         }
00294     }
00295 
00296     <span class="comment">// undergraduate selectivity (UG traditional)</span>
00297     ++protagonistInfo;
00298     <a class="code" href="ALL_8H.html#a0">err_when</a>( protagonistInfo-&gt;protagonist_id != 17 );
00299 
00300     <span class="keywordflow">if</span>( protagonistInfo-&gt;is_event_date() ) {
00301         <span class="comment">// use formula : (1 - admitRate/100 * yieldRate/100) * 100</span>
00302         rc = think_protagonist_event(
00303             <span class="keywordtype">float</span>(10000 - enroll_res.matric_history[<a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>][<a class="code" href="Oenroll_8h.html#a34a20">ER_OFFERS_RATE</a>][THIS_YEAR] * enroll_res.matric_history[<a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>][<a class="code" href="Oenroll_8h.html#a34a19">ER_YIELD_RATE</a>][THIS_YEAR]) / 100.0f,
00304             <span class="keywordtype">float</span>(10000 - enroll_res.matric_history[<a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>][<a class="code" href="Oenroll_8h.html#a34a20">ER_OFFERS_RATE</a>][THIS_YEAR-1] * enroll_res.matric_history[<a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>][<a class="code" href="Oenroll_8h.html#a34a19">ER_YIELD_RATE</a>][THIS_YEAR-1]) / 100.0f,
00305             (1.0f - enroll_res.initial_offers_rate[<a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>] * enroll_res.initial_cur_yield_rate[<a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>]) * 100.0f,
00306             protagonistInfo, -1 );                      <span class="comment">// -1=institutional level</span>
00307 
00308         <span class="keywordflow">if</span>( rc == COMMENT_TERMINATE )
00309             <span class="keywordflow">return</span>;
00310     }
00311 
00312     <span class="comment">// alumni morale</span>
00313     ++protagonistInfo;                              <span class="comment">// protagonistInfo-&gt;id is 18</span>
00314     <a class="code" href="ALL_8H.html#a0">err_when</a>( protagonistInfo-&gt;protagonist_id != 18 );
00315 
00316     <span class="keywordflow">if</span>( protagonistInfo-&gt;is_event_date() ) {
00317         rc = think_protagonist_event( development_office.alumni_morale_history[HISTORY_YEAR_COUNT-1], development_office.alumni_morale_history[HISTORY_YEAR_COUNT-2], development_office.initial_alumni_morale,
00318                                       protagonistInfo, -1 );                      <span class="comment">// -1=institutional level</span>
00319 
00320         <span class="keywordflow">if</span>( rc == COMMENT_TERMINATE )
00321             <span class="keywordflow">return</span>;
00322     }
00323 
00324     <span class="comment">// Percent alumni who donated ... last year</span>
00325     ++protagonistInfo;
00326     <a class="code" href="ALL_8H.html#a0">err_when</a>( protagonistInfo-&gt;protagonist_id != 19 );
00327 
00328     <span class="keywordflow">if</span>( protagonistInfo-&gt;is_event_date() ) {
00329         rc = think_protagonist_event( development_office.percent_alumni_gave_gift_history[HISTORY_YEAR_COUNT-1], development_office.percent_alumni_gave_gift_history[HISTORY_YEAR_COUNT-2], development_office.initial_percent_alumni_gave_gift,
00330                                       protagonistInfo, -1 );                      <span class="comment">// -1=institutional level</span>
00331 
00332         <span class="keywordflow">if</span>( rc == COMMENT_TERMINATE )
00333             <span class="keywordflow">return</span>;
00334     }
00335 
00336     <span class="comment">// Index of endowment market value</span>
00337     ++protagonistInfo;
00338     <a class="code" href="ALL_8H.html#a0">err_when</a>( protagonistInfo-&gt;protagonist_id != 20 );
00339 
00340     <span class="keywordflow">if</span>( protagonistInfo-&gt;is_event_date() ) {
00341         rc = think_protagonist_event( investment_office.endowment_performance_history[THIS_MONTH],
00342                                       investment_office.endowment_performance_history[THIS_MONTH-12],
00343                                       investment_office.initial_endowment_performance,
00344                                       protagonistInfo, -1 );                      <span class="comment">// -1=institutional level</span>
00345 
00346         <span class="keywordflow">if</span>( rc == COMMENT_TERMINATE )
00347             <span class="keywordflow">return</span>;
00348     }
00349 
00350     <span class="comment">// Crime Index</span>
00351     ++protagonistInfo;
00352     <a class="code" href="ALL_8H.html#a0">err_when</a>( protagonistInfo-&gt;protagonist_id != 21 );
00353 
00354     <span class="keywordflow">if</span>( protagonistInfo-&gt;is_event_date() ) {
00355         rc = think_protagonist_event( (<span class="keywordtype">float</span>)facility_office.crime_index[THIS_MONTH], (<span class="keywordtype">float</span>)facility_office.crime_index[THIS_MONTH-12], (<span class="keywordtype">float</span>)facility_office.initial_crime_index,
00356                                       protagonistInfo, -1 );                      <span class="comment">// -1=institutional level</span>
00357 
00358         <span class="keywordflow">if</span>( rc == COMMENT_TERMINATE )
00359             <span class="keywordflow">return</span>;
00360     }
00361 
00362     <span class="comment">// faculty research performance</span>
00363     ++protagonistInfo;
00364     <a class="code" href="ALL_8H.html#a0">err_when</a>( protagonistInfo-&gt;protagonist_id != 22 );
00365 
00366     <span class="keywordflow">if</span>( protagonistInfo-&gt;is_event_date() ) {
00367         rc = think_protagonist_event( department_array.p_faculty_research_history[THIS_MONTH], department_array.p_faculty_research_history[THIS_MONTH-12], department_array.initial_p_faculty_research,
00368                                       protagonistInfo, -1 );                      <span class="comment">// -1=institutional level</span>
00369 
00370         <span class="keywordflow">if</span>( rc == COMMENT_TERMINATE )
00371             <span class="keywordflow">return</span>;
00372 
00373         <span class="keywordflow">if</span>( protagonistInfo-&gt;departmental_level ) {
00374             <span class="comment">// scan each department (skip general department?)</span>
00375             <span class="keywordflow">for</span>( <span class="keywordtype">int</span> deptRecno = 1; deptRecno &lt;= department_array.size(); ++deptRecno ) {
00376                 <span class="keywordflow">if</span>( department_array.is_deleted(deptRecno) )
00377                     <span class="keywordflow">continue</span>;
00378 
00379                 <a class="code" href="classDepartment.html">Department</a> *deptPtr = department_array[deptRecno];
00380 
00381                 rc = think_protagonist_event( deptPtr-&gt;<a class="code" href="classDepartment.html#m55">p_faculty_research_history</a>[THIS_MONTH], deptPtr-&gt;<a class="code" href="classDepartment.html#m55">p_faculty_research_history</a>[THIS_MONTH-1], deptPtr-&gt;initial_p_faculty_diversity,
00382                                               protagonistInfo, deptRecno );           <span class="comment">// departmental level</span>
00383             }
00384         }
00385     }
00386 
00387     <span class="comment">// faculty salaries:annual increase</span>
00388     ++protagonistInfo;
00389     <a class="code" href="ALL_8H.html#a0">err_when</a>( protagonistInfo-&gt;protagonist_id != 23 );
00390 
00391     <span class="keywordflow">if</span>( protagonistInfo-&gt;is_event_date() ) {
00392         rc = think_protagonist_event( finance.faculty_salary_increase_history[THIS_YEAR],
00393                                       finance.faculty_salary_increase_history[THIS_YEAR-1],
00394                                       finance.initial_faculty_salary_increase,
00395                                       protagonistInfo, -1 );                      <span class="comment">// -1=institutional level</span>
00396 
00397         <span class="keywordflow">if</span>( rc == COMMENT_TERMINATE )
00398             <span class="keywordflow">return</span>;
00399     }
00400 
00401     <span class="comment">// faculty salaries:gender-ethnic equity</span>
00402     ++protagonistInfo;
00403     <a class="code" href="ALL_8H.html#a0">err_when</a>( protagonistInfo-&gt;protagonist_id != 24 );
00404 
00405     <span class="keywordflow">if</span>( protagonistInfo-&gt;is_event_date() ) {
00406         rc = think_protagonist_event( department_array.salary_gender_ethnic_equity_history[THIS_YEAR],
00407                                       department_array.salary_gender_ethnic_equity_history[THIS_YEAR-1],
00408                                       department_array.initial_salary_gender_ethnic_equity,
00409                                       protagonistInfo, -1 );                      <span class="comment">// -1=institutional level</span>
00410 
00411         <span class="keywordflow">if</span>( rc == COMMENT_TERMINATE )
00412             <span class="keywordflow">return</span>;
00413     }
00414 
00415     <span class="comment">// faculty salaries:departmental equity</span>
00416     ++protagonistInfo;
00417     <a class="code" href="ALL_8H.html#a0">err_when</a>( protagonistInfo-&gt;protagonist_id != 25 );
00418 
00419     <span class="keywordflow">if</span>( protagonistInfo-&gt;is_event_date() ) {
00420         rc = think_protagonist_event( department_array.salary_departmental_equity_history[THIS_YEAR],
00421                                       department_array.salary_departmental_equity_history[THIS_YEAR-1],
00422                                       department_array.initial_salary_departmental_equity,
00423                                       protagonistInfo, -1 );                      <span class="comment">// -1=institutional level</span>
00424 
00425         <span class="keywordflow">if</span>( rc == COMMENT_TERMINATE )
00426             <span class="keywordflow">return</span>;
00427     }
00428 
00429     <span class="comment">// faculty salaries rank equity</span>
00430     ++protagonistInfo;
00431     <a class="code" href="ALL_8H.html#a0">err_when</a>( protagonistInfo-&gt;protagonist_id != 26 );
00432 
00433     <span class="keywordflow">if</span>( protagonistInfo-&gt;is_event_date() ) {
00434         rc = think_protagonist_event( department_array.salary_rank_equity_history[THIS_YEAR],
00435                                       department_array.salary_rank_equity_history[THIS_YEAR-1],
00436                                       department_array.initial_salary_rank_equity,
00437                                       protagonistInfo, -1 );                      <span class="comment">// -1=institutional level</span>
00438 
00439         <span class="keywordflow">if</span>( rc == COMMENT_TERMINATE )
00440             <span class="keywordflow">return</span>;
00441     }
00442 
00443     <span class="comment">// tutition:annual increase</span>
00444     ++protagonistInfo;
00445     <a class="code" href="ALL_8H.html#a0">err_when</a>( protagonistInfo-&gt;protagonist_id != 27 );
00446 
00447     <span class="keywordflow">if</span>( protagonistInfo-&gt;is_event_date() ) {
00448         rc = think_protagonist_event( finance.tuition_increase_history[THIS_YEAR],
00449                                       finance.tuition_increase_history[THIS_YEAR-1],
00450                                       finance.initial_tuition_increase,
00451                                       protagonistInfo, -1 );                      <span class="comment">// -1=institutional level</span>
00452 
00453         <span class="keywordflow">if</span>( rc == COMMENT_TERMINATE )
00454             <span class="keywordflow">return</span>;
00455     }
00456 
00457     <span class="comment">// space shortfall</span>
00458     ++protagonistInfo;
00459     <a class="code" href="ALL_8H.html#a0">err_when</a>( protagonistInfo-&gt;protagonist_id != 28 );
00460 
00461     <span class="keywordflow">if</span>( protagonistInfo-&gt;is_event_date() ) {
00462         <span class="comment">// use (projected - norm) / norm * 100</span>
00463         rc = think_protagonist_event(
00464             <span class="keywordtype">float</span>(facility_office.projected_area[THIS_MONTH] - facility_office.normal_area[THIS_MONTH]) * 100.0f / (<span class="keywordtype">float</span>)facility_office.normal_area[THIS_MONTH],
00465             <span class="keywordtype">float</span>(facility_office.projected_area[THIS_MONTH-12] - facility_office.normal_area[THIS_MONTH-12]) * 100.0f / (<span class="keywordtype">float</span>)facility_office.normal_area[THIS_MONTH-12],
00466             <span class="keywordtype">float</span>(facility_office.initial_projected_area - facility_office.initial_normal_area) * 100.0f / (<span class="keywordtype">float</span>)facility_office.initial_normal_area,
00467             protagonistInfo, -1 );                      <span class="comment">// -1=institutional level</span>
00468 
00469         <span class="keywordflow">if</span>( rc == COMMENT_TERMINATE )
00470             <span class="keywordflow">return</span>;
00471     }
00472 
00473     <span class="comment">// football performance</span>
00474     ++protagonistInfo;
00475     <a class="code" href="ALL_8H.html#a0">err_when</a>( protagonistInfo-&gt;protagonist_id != 29 );
00476 
00477     <span class="keywordflow">if</span>( protagonistInfo-&gt;is_event_date() ) {
00478         <span class="comment">// win/(win+loss)*100</span>
00479         rc = think_protagonist_event(
00480             (<span class="keywordtype">float</span>)athletics_office.football_graph[THIS_YEAR] / <span class="keywordtype">float</span>(athletics_office.football_graph[THIS_YEAR] + athletics_office.football_graph[HISTORY_YEAR_COUNT+THIS_YEAR]) * 100.0f,
00481             (<span class="keywordtype">float</span>)athletics_office.football_graph[THIS_YEAR-1] / <span class="keywordtype">float</span>(athletics_office.football_graph[THIS_YEAR-1] + athletics_office.football_graph[HISTORY_YEAR_COUNT+THIS_YEAR-1]) * 100.0f,
00482             (<span class="keywordtype">float</span>)athletics_office.initial_football_graph[0] / <span class="keywordtype">float</span>(athletics_office.initial_football_graph[0] + athletics_office.initial_football_graph[1]) * 100.0f,
00483             protagonistInfo, -1 );                      <span class="comment">// -1=institutional level</span>
00484 
00485         <span class="keywordflow">if</span>( rc == COMMENT_TERMINATE )
00486             <span class="keywordflow">return</span>;
00487     }
00488 
00489     <span class="comment">// basketball performance</span>
00490     ++protagonistInfo;
00491     <a class="code" href="ALL_8H.html#a0">err_when</a>( protagonistInfo-&gt;protagonist_id != 30 );
00492 
00493     <span class="keywordflow">if</span>( protagonistInfo-&gt;is_event_date() ) {
00494         <span class="comment">// win/(win+loss)*100</span>
00495         rc = think_protagonist_event(
00496             (<span class="keywordtype">float</span>)athletics_office.basketball_graph[THIS_YEAR] / <span class="keywordtype">float</span>(athletics_office.basketball_graph[THIS_YEAR] + athletics_office.basketball_graph[HISTORY_YEAR_COUNT+THIS_YEAR]) * 100.0f,
00497             (<span class="keywordtype">float</span>)athletics_office.basketball_graph[THIS_YEAR-1] / <span class="keywordtype">float</span>(athletics_office.basketball_graph[THIS_YEAR-1] + athletics_office.basketball_graph[HISTORY_YEAR_COUNT+THIS_YEAR-1]) * 100.0f,
00498             (<span class="keywordtype">float</span>)athletics_office.initial_basketball_graph[0] / <span class="keywordtype">float</span>(athletics_office.initial_basketball_graph[0] + athletics_office.initial_basketball_graph[1]) * 100.0f,
00499             protagonistInfo, -1 );                      <span class="comment">// -1=institutional level</span>
00500 
00501         <span class="keywordflow">if</span>( rc == COMMENT_TERMINATE )
00502             <span class="keywordflow">return</span>;
00503     }
00504 
00505     <span class="comment">// educational quality</span>
00506     ++protagonistInfo;
00507     <a class="code" href="ALL_8H.html#a0">err_when</a>( protagonistInfo-&gt;protagonist_id != 31 );
00508 
00509     <span class="keywordflow">if</span>( protagonistInfo-&gt;is_event_date() ) {
00510         <span class="comment">// institutional</span>
00511         rc = think_protagonist_event(
00512             department_array.p_educational_quality_history[THIS_TRIMESTER],
00513             department_array.p_educational_quality_history[THIS_TRIMESTER-<a class="code" href="Gamedef_8h.html#a78a35">TRIMESTER_PER_YEAR</a>],
00514             department_array.initial_p_educational_quality,
00515             protagonistInfo, -1 );
00516 
00517         <span class="keywordflow">if</span>( rc == COMMENT_TERMINATE )
00518             <span class="keywordflow">return</span>;
00519 
00520         <span class="keywordflow">if</span>( protagonistInfo-&gt;departmental_level ) {
00521             <span class="comment">// scan each department (skip general department?)</span>
00522             <span class="keywordflow">for</span>( <span class="keywordtype">int</span> deptRecno = 1; deptRecno &lt;= department_array.size(); ++deptRecno ) {
00523                 <span class="keywordflow">if</span>( department_array.is_deleted(deptRecno) )
00524                     <span class="keywordflow">continue</span>;
00525 
00526                 <a class="code" href="classDepartment.html">Department</a> *deptPtr = department_array[deptRecno];
00527 
00528                 rc = think_protagonist_event(
00529                     deptPtr-&gt;<a class="code" href="classDepartment.html#m52">p_educational_quality_history</a>[THIS_TRIMESTER],
00530                     deptPtr-&gt;<a class="code" href="classDepartment.html#m52">p_educational_quality_history</a>[THIS_TRIMESTER-<a class="code" href="Gamedef_8h.html#a78a35">TRIMESTER_PER_YEAR</a>],
00531                     deptPtr-&gt;initial_p_educational_quality,
00532                     protagonistInfo, deptRecno );           <span class="comment">// departmental level</span>
00533             }
00534         }
00535     }
00536 
00537     <span class="comment">// prestige</span>
00538 
00539     ++protagonistInfo;
00540     <a class="code" href="ALL_8H.html#a0">err_when</a>( protagonistInfo-&gt;protagonist_id != 32 );
00541 
00542     <span class="keywordflow">if</span>( protagonistInfo-&gt;is_event_date() ) {
00543         <span class="comment">// institutional</span>
00544         rc = think_protagonist_event(
00545             department_array.p_academic_standing_history[THIS_YEAR],
00546             department_array.p_academic_standing_history[THIS_YEAR-1],
00547             department_array.initial_p_academic_standing,
00548             protagonistInfo, -1 );
00549 
00550         <span class="keywordflow">if</span>( rc == COMMENT_TERMINATE )
00551             <span class="keywordflow">return</span>;
00552 
00553         <span class="keywordflow">if</span>( protagonistInfo-&gt;departmental_level ) {
00554             <span class="comment">// scan each department (skip general department?)</span>
00555             <span class="keywordflow">for</span>( <span class="keywordtype">int</span> deptRecno = 1; deptRecno &lt;= department_array.size(); ++deptRecno ) {
00556                 <span class="keywordflow">if</span>( department_array.is_deleted(deptRecno) )
00557                     <span class="keywordflow">continue</span>;
00558 
00559                 <a class="code" href="classDepartment.html">Department</a> *deptPtr = department_array[deptRecno];
00560 
00561                 rc = think_protagonist_event(
00562                     deptPtr-&gt;<a class="code" href="classDepartment.html#m53">p_academic_standing_history</a>[THIS_YEAR],
00563                     deptPtr-&gt;<a class="code" href="classDepartment.html#m53">p_academic_standing_history</a>[THIS_YEAR-1],
00564                     deptPtr-&gt;initial_p_academic_standing,
00565                     protagonistInfo, deptRecno );           <span class="comment">// departmental level</span>
00566             }
00567         }
00568     }
00569 
00570     <span class="comment">// course denial (% of enrollments)</span>
00571 
00572     ++protagonistInfo;
00573     <a class="code" href="ALL_8H.html#a0">err_when</a>( protagonistInfo-&gt;protagonist_id != 33 );
00574 
00575     <span class="keywordflow">if</span>( protagonistInfo-&gt;is_event_date() ) {
00576         <span class="comment">// institutional</span>
00577 
00578         <span class="comment">// total admission_denied_count / total course enroll (convention_student_count?)</span>
00579 
00580         <span class="comment">// avoid divided by zero</span>
00581         <span class="keywordflow">if</span>( department_array.convention_student_count_history[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>][THIS_TRIMESTER] != 0
00582             &amp;&amp; department_array.convention_student_count_history[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>][THIS_TRIMESTER-<a class="code" href="Gamedef_8h.html#a78a35">TRIMESTER_PER_YEAR</a>] != 0
00583             &amp;&amp; department_array.initial_convention_student_count[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>] != 0 ) {
00584             rc = think_protagonist_event(
00585                 (<span class="keywordtype">float</span>)department_array.admission_denied_count_history[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>][THIS_TRIMESTER] * 100.0f / (<span class="keywordtype">float</span>)department_array.convention_student_count_history[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>][THIS_TRIMESTER],
00586                 (<span class="keywordtype">float</span>)department_array.admission_denied_count_history[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>][THIS_TRIMESTER-<a class="code" href="Gamedef_8h.html#a78a35">TRIMESTER_PER_YEAR</a>] * 100.0f / (<span class="keywordtype">float</span>)department_array.convention_student_count_history[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>][THIS_TRIMESTER-<a class="code" href="Gamedef_8h.html#a78a35">TRIMESTER_PER_YEAR</a>],
00587                 (<span class="keywordtype">float</span>)department_array.initial_admission_denied_count[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>] * 100.0f / (<span class="keywordtype">float</span>)department_array.initial_convention_student_count[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>],
00588                 protagonistInfo, -1 );
00589 
00590             <span class="keywordflow">if</span>( rc == COMMENT_TERMINATE )
00591                 <span class="keywordflow">return</span>;
00592         }
00593 
00594         <span class="keywordflow">if</span>( protagonistInfo-&gt;departmental_level ) {
00595             <span class="comment">// scan each department (skip general department?)</span>
00596             <span class="keywordflow">for</span>( <span class="keywordtype">int</span> deptRecno = 1; deptRecno &lt;= department_array.size(); ++deptRecno ) {
00597                 <span class="keywordflow">if</span>( department_array.is_deleted(deptRecno) )
00598                     <span class="keywordflow">continue</span>;
00599 
00600                 <a class="code" href="classCourseArray.html">CourseArray</a> *coursePtr = &amp;department_array[deptRecno]-&gt;course_array;
00601 
00602                 <span class="comment">// avoid divided by zero</span>
00603                 <span class="keywordflow">if</span>( coursePtr-&gt;convention_student_count_history[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>][THIS_TRIMESTER] != 0
00604                     &amp;&amp; coursePtr-&gt;convention_student_count_history[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>][THIS_TRIMESTER-<a class="code" href="Gamedef_8h.html#a78a35">TRIMESTER_PER_YEAR</a>] != 0
00605                     &amp;&amp; coursePtr-&gt;initial_convention_student_count[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>] != 0 ) {
00606                     rc = think_protagonist_event(
00607                         (<span class="keywordtype">float</span>)coursePtr-&gt;admission_denied_count_history[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>][THIS_TRIMESTER] * 100.0f / (<span class="keywordtype">float</span>)coursePtr-&gt;convention_student_count_history[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>][THIS_TRIMESTER],
00608                         (<span class="keywordtype">float</span>)coursePtr-&gt;admission_denied_count_history[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>][THIS_TRIMESTER-<a class="code" href="Gamedef_8h.html#a78a35">TRIMESTER_PER_YEAR</a>] * 100.0f / (<span class="keywordtype">float</span>)coursePtr-&gt;convention_student_count_history[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>][THIS_TRIMESTER-<a class="code" href="Gamedef_8h.html#a78a35">TRIMESTER_PER_YEAR</a>],
00609                         (<span class="keywordtype">float</span>)coursePtr-&gt;initial_admission_denied_count[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>] * 100.0f / (<span class="keywordtype">float</span>)coursePtr-&gt;initial_convention_student_count[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>],
00610                         protagonistInfo, deptRecno );         <span class="comment">// departmental level</span>
00611                 }
00612             }
00613         }
00614     }
00615 
00616     <span class="comment">// class size deviation</span>
00617 
00618     ++protagonistInfo;
00619     <a class="code" href="ALL_8H.html#a0">err_when</a>( protagonistInfo-&gt;protagonist_id != 34 );
00620 
00621     <span class="keywordflow">if</span>( protagonistInfo-&gt;is_event_date() ) {
00622         <span class="comment">// skip institutional, since department_array.size_deviation_history is not correct</span>
00623 
00624         <span class="comment">// scan each department (skip general department?)</span>
00625         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> deptRecno = 1; deptRecno &lt;= department_array.size(); ++deptRecno ) {
00626             <span class="keywordflow">if</span>( department_array.is_deleted(deptRecno) )
00627                 <span class="keywordflow">continue</span>;
00628 
00629             <a class="code" href="classCourseArray.html">CourseArray</a> *coursePtr = &amp;department_array[deptRecno]-&gt;course_array;
00630             <span class="keywordflow">for</span>( <span class="keywordtype">int</span> t = 0; t &lt; <a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>; ++t ) {
00631                 <span class="keywordflow">if</span>( t == <a class="code" href="Ocourse_8h.html#a40a32">DISTANCE_LEARN_COURSE</a> )
00632                     <span class="keywordflow">continue</span>;                               <span class="comment">// skip distance learning</span>
00633 
00634                 rc = think_protagonist_event(
00635                     (<span class="keywordtype">float</span>)coursePtr-&gt;size_deviation_history[t][THIS_TRIMESTER],
00636                     (<span class="keywordtype">float</span>)coursePtr-&gt;size_deviation_history[t][THIS_TRIMESTER-<a class="code" href="Gamedef_8h.html#a78a35">TRIMESTER_PER_YEAR</a>],
00637                     (<span class="keywordtype">float</span>)coursePtr-&gt;initial_size_deviation[t],
00638                     protagonistInfo, deptRecno );           <span class="comment">// departmental level</span>
00639             }
00640         }
00641     }
00642 
00643 }
00644 
00645 <span class="comment">// departmentRecno may be -1 if departmentLevel is true, meaning the whole university</span>
00646 <span class="comment">// [int]testResign - if testResign is true, no action processed, just return which case belongs to</span>
00647 <span class="comment">//                   if testResign is false, return which case if the action is processed (if filtered by random return 0)</span>
00648 <span class="comment">//</span>
00649 <span class="comment">// return 0 or which of the case (1-6 and 7 for termination)</span>
00650 <span class="comment">// COMMENT_NONE=0, COMMENT_R1, COMMENT_R2, COMMENT_R3, COMMENT_R4, COMMENT_R5, COMMENT_R6, COMMENT_TERMINATE</span>
00651 
00652 <span class="comment">//</span>
00653 <span class="keywordtype">int</span> PlayerSchool::think_protagonist_event(<span class="keywordtype">float</span> curValue, <span class="keywordtype">float</span> lastYearValue, <span class="keywordtype">float</span> initialValue, <span class="keyword">struct</span> ProtagonistInfo *protagonistInfo, <span class="keywordtype">int</span> departmentRecno, <span class="keywordtype">int</span> testResign) {
00654     <span class="keywordflow">if</span>( info.financial_year() &lt;= 1 )                <span class="comment">// needed for first year</span>
00655         lastYearValue = initialValue;
00656 
00657     <span class="keywordtype">int</span> departmentLevel = protagonistInfo-&gt;departmental_level;
00658     <span class="comment">// institutional level message having a similar departmental message</span>
00659     <span class="keywordtype">int</span> existDepartmentLevel = protagonistInfo-&gt;exist_departmental_level;
00660     <span class="keywordtype">char</span> *insertText = protagonistInfo-&gt;insert_text;
00661     <span class="comment">// may cause termination (fire!)</span>
00662     <span class="keywordtype">int</span> causeTerminateFlag = protagonistInfo-&gt;cause_termination_flag &amp; 1;
00663     <span class="keywordtype">float</span> zn = protagonistInfo-&gt;normalizing_factor;
00664     <span class="keywordtype">float</span> trend = (curValue - lastYearValue) / zn;  <span class="comment">// 1 year before</span>
00665     <span class="keywordtype">float</span> level = (curValue - initialValue) / zn;
00666     <span class="keywordtype">float</span> rm = protagonistInfo-&gt;relative_trend_threshold;
00667     <span class="keywordtype">float</span> r1Bonus = departmentRecno == -1 ? protagonistInfo-&gt;r1_bonus_inst : protagonistInfo-&gt;r1_bonus_dept;
00668     <span class="keywordtype">float</span> r4Penalty = departmentRecno == -1 ? protagonistInfo-&gt;r4_penalty_inst : protagonistInfo-&gt;r4_penalty_dept;
00669 
00670     <span class="keywordtype">float</span> mx = rm * protagonist_ck1;
00671     <span class="keywordtype">float</span> my = float( protagonist_ck1 * sqrt(5.0 / info.financial_year()) );
00672     <span class="keywordtype">float</span> strength;
00673     <span class="keywordtype">float</span> consistency;
00674     <span class="keywordtype">float</span> k1;
00675 
00676     calc_strength_consistency_k1(curValue, lastYearValue, initialValue, protagonistInfo,strength, consistency, k1);
00677 
00678     <span class="keywordtype">float</span> k2 = protagonist_ck2 * k1;
00679     <span class="keywordtype">float</span> k3 = protagonist_ck3 * k2;
00680 
00681     <span class="comment">//   Message from &lt;gender-ethnic group and student level&gt; [department]:</span>
00682     <span class="comment">// eg : Message from a non-minority female traditional undergraduate student majoring in Chemistry</span>
00683     <span class="comment">// | Message from Professor &lt;faculty name&gt; in the &lt;department&gt;:</span>
00684     <span class="comment">// | Message from Chair of Engineering Department:</span>
00685     <span class="comment">// | Message from Chair of the Faculty Senate:</span>
00686     <span class="comment">// | Message from a trustee:</span>
00687     <span class="comment">// | Message from an alumna|alumnus:</span>
00688 
00689     <span class="comment">// select srcPara</span>
00690     <span class="keywordtype">int</span> srcFacultyRecno = 0;
00691     <span class="keywordtype">int</span> srcDepartmentRecno = 0;
00692     <span class="keywordtype">int</span> srcStudentRecno = 0;
00693     <span class="keywordtype">int</span>  srcPara1 = 0;
00694     <span class="keywordtype">short</span> srcPara2 = 0;
00695     <span class="keywordtype">short</span> srcPara3 = 0;
00696     <span class="keywordtype">short</span> srcPara4 = 0;
00697 
00698     <span class="keywordflow">if</span>( !testResign ) {                             <span class="comment">// no need to know msg source if testing</span>
00699         <span class="keywordflow">switch</span>( protagonistInfo-&gt;msg_source ) {
00700         <span class="keywordflow">case</span> PROTAGONIST_FACULTY:
00701             <span class="keywordflow">if</span>( departmentRecno == -1 ) {
00702                 <span class="comment">// random select a department</span>
00703                 srcDepartmentRecno = choose_arbitary_department();
00704             }
00705             <span class="keywordflow">else</span> {
00706                 srcDepartmentRecno = departmentRecno; {
00707                 }
00708 
00709                 <span class="comment">// randomly select a faculty member in department</span>
00710 
00711                 <span class="keywordflow">if</span>( department_array.is_deleted(srcDepartmentRecno) )
00712                     <span class="keywordflow">return</span> 0;                             <span class="comment">// no suitable department</span>
00713 
00714                 <a class="code" href="classDepartment.html">Department</a> *deptPtr = department_array[srcDepartmentRecno];
00715 
00716                 <span class="keywordtype">int</span> facultyCount = deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classDynArray.html#a28">size</a>();
00717                 <span class="keywordtype">int</span> facultyRecno = m.random(facultyCount) + 1;
00718                 <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=facultyCount; i &gt; 0; --i ) {
00719                     <span class="keywordflow">if</span>( !deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#a10">is_deleted</a>(facultyRecno) )
00720                         <span class="keywordflow">break</span>;
00721                     <span class="keywordflow">if</span>( ++facultyRecno &gt; facultyCount )
00722                         facultyRecno = 1;
00723                 }
00724                 <span class="keywordflow">if</span>( !i )
00725                     <span class="keywordflow">return</span> COMMENT_NONE;                  <span class="comment">// can't find faculty</span>
00726 
00727                 srcFacultyRecno = facultyRecno;
00728                 <a class="code" href="classFaculty.html">Faculty</a> *facultyPtr = deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>[facultyRecno];
00729                 srcPara1 = facultyPtr-&gt;<a class="code" href="classFaculty.html#m3">first_name_id</a>;
00730                 srcPara2 = facultyPtr-&gt;<a class="code" href="classFaculty.html#m4">middle_name_id</a>;
00731                 srcPara3 = facultyPtr-&gt;<a class="code" href="classFaculty.html#m5">last_name_id</a>;
00732                 srcPara4 = facultyPtr-&gt;<a class="code" href="classFaculty.html#m6">rank_level</a>;
00733             }
00734             <span class="keywordflow">break</span>;
00735 
00736         <span class="keywordflow">case</span> PROTAGONIST_STUDENT:
00737             <span class="keywordflow">if</span>( departmentRecno == -1 ) {
00738                 <span class="comment">// random select a department</span>
00739                 srcDepartmentRecno = choose_arbitary_department();
00740             }
00741             <span class="keywordflow">else</span> {
00742                 srcDepartmentRecno = departmentRecno; {
00743                 }
00744 
00745                 <span class="comment">// randomly select a student in department</span>
00746 
00747                 <span class="keywordflow">if</span>( department_array.is_deleted(srcDepartmentRecno)
00748                     || department_array[srcDepartmentRecno]-&gt;student_array.size() &lt;= 0 )
00749                     <span class="keywordflow">return</span> COMMENT_NONE;                  <span class="comment">// no suitable department</span>
00750 
00751                 <a class="code" href="classStudentArray.html">StudentArray</a> &amp;studentArray = department_array[srcDepartmentRecno]-&gt;student_array;
00752                 <span class="keywordtype">int</span> studentCount = studentArray.<a class="code" href="classDynArray.html#a28">size</a>();
00753                 <span class="keywordtype">int</span> studentRecno = m.random(studentCount) + 1;
00754                 <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=studentCount; i &gt; 0; --i ) {
00755                     <span class="keywordflow">if</span>( !studentArray.<a class="code" href="classStudentArray.html#a9">is_deleted</a>(studentRecno) )
00756                         <span class="keywordflow">break</span>;
00757                     <span class="keywordflow">if</span>( ++studentRecno &gt; studentCount )
00758                         studentRecno = 1;
00759                 }
00760                 <span class="keywordflow">if</span>( !i )
00761                     <span class="keywordflow">return</span> COMMENT_NONE;                  <span class="comment">// can't find faculty</span>
00762 
00763                 srcStudentRecno = studentRecno;
00764                 <a class="code" href="classStudent.html">Student</a> *studentPtr = studentArray[studentRecno];
00765                 srcPara1 = studentPtr-&gt;<a class="code" href="classStudent.html#m2">student_level</a>;
00766                 srcPara2 = studentPtr-&gt;<a class="code" href="classStudent.html#m3">gender_ethnic_group</a>;
00767                 srcPara3 = studentPtr-&gt;<a class="code" href="classStudent.html#m6">year_in_program</a>;
00768                 srcPara4 = 0;                           <span class="comment">// reserved to store number of students quit the university</span>
00769             }
00770             <span class="keywordflow">break</span>;
00771 
00772         <span class="keywordflow">case</span> PROTAGONIST_DEPARTMENT:
00773             <span class="keywordflow">if</span>( departmentRecno == -1 ) {
00774                 <span class="comment">// random select a department</span>
00775                 srcDepartmentRecno = choose_arbitary_department();
00776             }
00777             <span class="keywordflow">else</span> {
00778                 srcDepartmentRecno = departmentRecno;
00779             }
00780             <span class="keywordflow">break</span>;
00781         }
00782     }
00783 
00784     <span class="keywordflow">if</span>( departmentRecno == -1 &amp;&amp; causeTerminateFlag &amp;&amp; strength &lt; -k3 ) {
00785         <span class="comment">// terminate (only for checking institutional level)</span>
00786 
00787         <span class="keywordflow">if</span>( testResign )
00788             <span class="keywordflow">return</span> COMMENT_TERMINATE;
00789 
00790         lose_game.set_reason(LOSE_REASON_PROTAGONIST, protagonistInfo-&gt;protagonist_id );
00791 
00792         <span class="comment">// go to lost screen and then final score screen</span>
00793         sys.set_staying_view_mode(<a class="code" href="Osys_8h.html#a45a24">MODE_LOSE_GAME</a>);
00794         <span class="keywordflow">return</span> COMMENT_TERMINATE;
00795     }
00796     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( strength &gt; k2 ) {
00797         <span class="keywordflow">if</span>( testResign )
00798             <span class="keywordflow">return</span> COMMENT_R1;
00799 
00800         <span class="comment">// R1, 1/4 chance for departmental level, 1.0 chance for instituation level</span>
00801         <span class="keywordflow">if</span>( is_protagonist_event_date(protagonistInfo-&gt;protagonist_id, departmentRecno)
00802             &amp;&amp; (departmentRecno == -1 || math.get_random_float() &lt; 0.25f) ) {
00803             <span class="comment">// bonus_point += r1Bonus; // add bonus</span>
00804             threshold_event_bonus += (float)r1Bonus / 100.0f;
00805 
00806             post_protagonist_message( protagonistInfo-&gt;protagonist_id, 1, departmentRecno, srcDepartmentRecno, srcPara1, srcPara2, srcPara3, srcPara4 );
00807             <a class="code" href="structNews.html">News</a> *newsPtr = news_array[news_array.recno()];
00808             box.<a class="code" href="structNews.html#a1">msg</a>( newsPtr-&gt;<a class="code" href="structNews.html#a1">msg</a>() );
00809             mark_protagonist_event_date(protagonistInfo-&gt;protagonist_id, departmentRecno);
00810             <span class="keywordflow">return</span> COMMENT_R1;
00811         }
00812     }
00813     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( strength &gt; k1 ) {
00814         <span class="keywordflow">if</span>( testResign )
00815             <span class="keywordflow">return</span> COMMENT_R2;
00816 
00817         <span class="comment">// R2, 1/8 chance for department and 1/2 chance for institutional level</span>
00818         <span class="keywordflow">if</span>( is_protagonist_event_date(protagonistInfo-&gt;protagonist_id, departmentRecno)
00819             &amp;&amp; (departmentRecno == -1 &amp;&amp; math.get_random_float() &lt; 0.50f
00820                 || departmentRecno &gt;= 0 &amp;&amp; math.get_random_float() &lt; 0.125f) ) {
00821             post_protagonist_message( protagonistInfo-&gt;protagonist_id, 2, departmentRecno, srcDepartmentRecno, srcPara1, srcPara2, srcPara3, srcPara4 );
00822             mark_protagonist_event_date(protagonistInfo-&gt;protagonist_id, departmentRecno);
00823             <span class="keywordflow">return</span> COMMENT_R2;
00824         }
00825     }
00826     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( strength &lt; -k2 ) {
00827         <span class="keywordflow">if</span>( testResign )
00828             <span class="keywordflow">return</span> COMMENT_R4;
00829 
00830         <span class="comment">// R4 (note the order, 1/4 chance for departmental level, 1.0 chance for instituation level</span>
00831         <span class="keywordflow">if</span>( is_protagonist_event_date(protagonistInfo-&gt;protagonist_id, departmentRecno)
00832             &amp;&amp; (departmentRecno == -1 || math.get_random_float() &lt; 0.25f) ) {
00833             <span class="comment">// bonus_point += r4Penalty; // r4Penalty in negative</span>
00834             threshold_event_bonus += (float)r4Penalty / 100.0f;
00835 
00836             <span class="comment">// process outcome</span>
00837             <span class="keywordflow">switch</span>( protagonistInfo-&gt;protagonist_id ) {
00838             <span class="keywordflow">case</span> 10:                                  <span class="comment">// faculty morale, NEWS_PROTAGONIST_FACULTY_MORALE:</span>
00839             <span class="keywordflow">case</span> 22:                                  <span class="comment">// faculty research performance, NEWS_PROTAGONIST_RESEARCH_PERFORMANCE</span>
00840             <span class="keywordflow">case</span> 23:                                  <span class="comment">// faculty salaries : annual increase, NEWS_PROTAGONIST_SALARIES_INCREASE</span>
00841             <span class="keywordflow">case</span> 32:                                  <span class="comment">// course denials, NEWS_PROTAGONIST_DEPT_PRESTIGE</span>
00842                 <span class="comment">// the faculty resign</span>
00843                 <span class="keywordflow">if</span>( srcDepartmentRecno &amp;&amp; srcFacultyRecno ) {
00844                     department_array[srcDepartmentRecno]-&gt;faculty_array.del( srcFacultyRecno );
00845                 }
00846                 <span class="keywordflow">break</span>;
00847 
00848             <span class="keywordflow">case</span> 11:                                  <span class="comment">// student morale NEWS_PROTAGONIST_STUDENT_MORALE</span>
00849             <span class="keywordflow">case</span> 31:                                  <span class="comment">// education quality NEWS_PROTAGONIST_DEPT_EDUCATIONAL_QUALITY</span>
00850                 <span class="keywordflow">if</span>( srcDepartmentRecno ) {
00851                     <a class="code" href="classStudentArray.html">StudentArray</a> &amp;studentArray = department_array[srcDepartmentRecno]-&gt;student_array;
00852 
00853                     <span class="comment">// this student leaves</span>
00854                     studentArray.<a class="code" href="classStudentArray.html#a5">del</a>(srcStudentRecno);
00855 
00856                     <span class="comment">// delete 10 student leave</span>
00857                     <span class="keywordtype">int</span> deletedCount = 0;
00858                     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> pass = 0; pass &lt;= 3 &amp;&amp; deletedCount &lt; STUDENT_LEAVE_COUNT; ++pass ) {
00859                         <span class="keywordtype">int</span> studentCount = studentArray.<a class="code" href="classDynArray.html#a28">size</a>();
00860                         <span class="keywordtype">int</span> studentRecno = srcStudentRecno; <span class="comment">// m.random(studentCount) + 1;</span>
00861                         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=studentCount; i &gt; 0 &amp;&amp; deletedCount &lt; STUDENT_LEAVE_COUNT; --i, (studentRecno=studentRecno&lt;studentCount?studentRecno+1:1) ) {
00862                             <span class="keywordflow">if</span>( !studentArray.<a class="code" href="classStudentArray.html#a9">is_deleted</a>(studentRecno) ) {
00863                                 <a class="code" href="classStudent.html">Student</a> *studentPtr = studentArray[studentRecno];
00864                                 <span class="comment">// check student level in pass 0, 1, 2</span>
00865                                 <span class="keywordflow">if</span>( (pass&gt;2 || studentPtr-&gt;<a class="code" href="classStudent.html#m2">student_level</a> == srcPara1 )
00866                                     <span class="comment">// check year in pass 0, 1</span>
00867                                     &amp;&amp; (pass&gt;1 || studentPtr-&gt;<a class="code" href="classStudent.html#m6">year_in_program</a> == srcPara3 )
00868                                     <span class="comment">// check gender-ethnic in pass 0</span>
00869                                     &amp;&amp; (pass&gt;0 || studentPtr-&gt;<a class="code" href="classStudent.html#m3">gender_ethnic_group</a> == srcPara2) ) {
00870                                     studentArray.del(studentRecno);
00871                                     ++deletedCount;
00872                                 }
00873                             }
00874                         }
00875                     }
00876 
00877                     srcPara4 = deletedCount;
00878                 }
00879                 <span class="keywordflow">break</span>;
00880 
00881             <span class="keywordflow">case</span> 18:                                  <span class="comment">// NEWS_PROTAGONIST_ALUMNI_MORALE</span>
00882             <span class="keywordflow">case</span> 19:                                  <span class="comment">// NEWS_PROTAGONIST_ALUMNI_DONATION</span>
00883                 <span class="comment">// double budget immediately</span>
00884                 chance_event.signal_alumni_budget_increase( 1.0f, info.financial_year());
00885                 <span class="keywordflow">break</span>;
00886 
00887             <span class="keywordflow">case</span> 29:                                  <span class="comment">// NEWS_PROTAGONIST_FOOTBALL_PERFORMANCE</span>
00888             <span class="keywordflow">case</span> 30:                                  <span class="comment">// NEWS_PROTAGONIST_BASKETBALL_PERFORMANCE</span>
00889                 <span class="comment">// add 200,000 to athletics budget immediately</span>
00890                 chance_event.signal_athletics_budget_amount( 200.0f, info.financial_year());
00891                 <span class="keywordflow">break</span>;
00892 
00893             }                                           <span class="comment">// end switch</span>
00894 
00895             post_protagonist_message( protagonistInfo-&gt;protagonist_id, 4, departmentRecno, srcDepartmentRecno, srcPara1, srcPara2, srcPara3, srcPara4 );
00896 
00897             <a class="code" href="structNews.html">News</a> *newsPtr = news_array[news_array.recno()];
00898             box.<a class="code" href="structNews.html#a1">msg</a>( newsPtr-&gt;<a class="code" href="structNews.html#a1">msg</a>() );
00899             mark_protagonist_event_date(protagonistInfo-&gt;protagonist_id, departmentRecno);
00900 
00901             <span class="keywordflow">return</span> COMMENT_R4;
00902         }
00903     }
00904     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( strength &lt; -k1 ) {
00905         <span class="keywordflow">if</span>( testResign )
00906             <span class="keywordflow">return</span> COMMENT_R3;
00907 
00908         <span class="comment">// R3, 1/8 chance for department and 1/2 chance for institutional level</span>
00909         <span class="keywordflow">if</span>( is_protagonist_event_date(protagonistInfo-&gt;protagonist_id, departmentRecno)
00910             &amp;&amp; (departmentRecno == -1 &amp;&amp; math.get_random_float() &lt; 0.50f
00911                 || departmentRecno &gt;= 0 &amp;&amp; math.get_random_float() &lt; 0.125f) ) {
00912             post_protagonist_message( protagonistInfo-&gt;protagonist_id, 3, departmentRecno, srcDepartmentRecno, srcPara1, srcPara2, srcPara3, srcPara4 );
00913             mark_protagonist_event_date(protagonistInfo-&gt;protagonist_id, departmentRecno);
00914             <span class="keywordflow">return</span> COMMENT_R3;
00915         }
00916     }
00917     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( consistency &gt; k1 ) {
00918         <span class="keywordflow">if</span>( testResign )
00919             <span class="keywordflow">return</span> COMMENT_R5;
00920 
00921         <span class="comment">// R5</span>
00922         <span class="keywordflow">if</span>( mark_protagonist_event_date(protagonistInfo-&gt;protagonist_id, departmentRecno)
00923             &amp;&amp; (departmentRecno == -1 &amp;&amp; math.get_random_float() &lt; (1.0f/3.0f)
00924                 || departmentRecno &gt;= 0 &amp;&amp; math.get_random_float() &lt; (1.0f/12.0f)) ) {
00925             post_protagonist_message( protagonistInfo-&gt;protagonist_id, 5, departmentRecno, srcDepartmentRecno, srcPara1, srcPara2, srcPara3, srcPara4 );
00926             mark_protagonist_event_date(protagonistInfo-&gt;protagonist_id, departmentRecno);
00927             <span class="keywordflow">return</span> COMMENT_R5;
00928         }
00929     }
00930     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( consistency &lt; -k1 ) {
00931         <span class="keywordflow">if</span>( testResign )
00932             <span class="keywordflow">return</span> COMMENT_R6;
00933 
00934         <span class="comment">// R6</span>
00935         <span class="keywordflow">if</span>( mark_protagonist_event_date(protagonistInfo-&gt;protagonist_id, departmentRecno)
00936             &amp;&amp; (departmentRecno == -1 &amp;&amp; math.get_random_float() &lt; (1.0f/3.0f)
00937                 || departmentRecno &gt;= 0 &amp;&amp; math.get_random_float() &lt; (1.0f/12.0f)) ) {
00938             post_protagonist_message( protagonistInfo-&gt;protagonist_id, 6, departmentRecno, srcDepartmentRecno, srcPara1, srcPara2, srcPara3, srcPara4 );
00939             mark_protagonist_event_date(protagonistInfo-&gt;protagonist_id, departmentRecno);
00940             <span class="keywordflow">return</span> COMMENT_R6;
00941         }
00942     }
00943 
00944     <span class="keywordflow">return</span> COMMENT_NONE;
00945 }
00946 
00947 <span class="comment">// Kenneth</span>
00948 <span class="comment">// --- Begin of PlayerSchool::get_protagonist_info --- //</span>
00949 <span class="comment">//</span>
00950 ProtagonistInfo* PlayerSchool::get_protagonist_info(<span class="keywordtype">int</span> recno) {
00951     <a class="code" href="ALL_8H.html#a0">err_when</a>( recno &lt;= 0 || recno &gt; MAX_PROTAGONIST_ID );
00952     <span class="keywordflow">return</span> &amp;protagonist_info_array[recno-1];
00953 }
00954 
00955 <span class="comment">//</span>
00956 <span class="comment">// --- End of PlayerSchool::get_protagonist_info --- //</span>
00957 
00958 <span class="comment">// --- Begin of PlayerSchool::calc_strength_consistency_k1 --- //</span>
00959 <span class="comment">//</span>
00960 <span class="keywordtype">void</span> PlayerSchool::calc_strength_consistency_k1(<span class="keywordtype">float</span> curValue, <span class="keywordtype">float</span> lastYearValue, <span class="keywordtype">float</span> initialValue, <span class="keyword">struct</span> ProtagonistInfo *protagonistInfo, <span class="keywordtype">float</span> &amp;strength, <span class="keywordtype">float</span> &amp;consistency, <span class="keywordtype">float</span> &amp;k1) {
00961     <span class="keywordtype">float</span> zn = protagonistInfo-&gt;normalizing_factor;
00962     <span class="keywordtype">float</span> trend = (curValue - lastYearValue) / zn;  <span class="comment">// 1 year before</span>
00963     <span class="keywordtype">float</span> level = (curValue - initialValue) / zn;
00964     <span class="keywordtype">float</span> rm = protagonistInfo-&gt;relative_trend_threshold;
00965 
00966     <span class="keywordtype">float</span> mx = rm * protagonist_ck1;
00967     <span class="keywordtype">float</span> my = float( protagonist_ck1 * sqrt(5.0 / info.financial_year()) );
00968 
00969     strength = score_function( trend, level, mx, my, <span class="keyword">true</span> );
00970     consistency = score_function( trend, level, mx, my, <span class="keyword">false</span> );
00971     k1 = score_function( mx, my, mx, my, <span class="keyword">true</span> );
00972 
00973     <span class="keywordflow">return</span>;
00974 }
00975 
00976 <span class="comment">//</span>
00977 <span class="comment">// --- End of PlayerSchool::calc_strength_consistency_k1 --- //</span>
00978 
00979 <span class="comment">// --- Begin of PlayerSchool::is_protagonist_event_date --- //</span>
00980 <span class="comment">//</span>
00981 <span class="keywordtype">int</span> PlayerSchool::is_protagonist_event_date( <span class="keywordtype">int</span> protagonistId, <span class="keywordtype">int</span> deptRecno ) {
00982     <a class="code" href="ALL_8H.html#a0">err_when</a>( protagonistId &lt;= 0 || protagonistId &gt; MAX_PROTAGONIST_ID );
00983 
00984     <span class="keywordflow">if</span>( get_protagonist_info(protagonistId)-&gt;is_event_date() ) {
00985         <span class="keywordtype">int</span> checkDate = info.game_date;
00986         <a class="code" href="ALL_8H.html#a0">err_when</a>( deptRecno != -1 &amp;&amp; (deptRecno &lt;= 0 || deptRecno &gt; <a class="code" href="Gamedef_8h.html#a10">MAX_DEPARTMENT</a>) );
00987 
00988         <span class="keywordflow">if</span>( deptRecno == -1 ) {
00989             <span class="comment">// institutional level message within 120 days</span>
00990             <span class="keywordflow">return</span> !last_protagonist_event_date[protagonistId-1][0] || (checkDate-last_protagonist_event_date[protagonistId-1][0]&gt;=120);
00991         }
00992         <span class="keywordflow">else</span> {
00993             <a class="code" href="ALL_8H.html#a0">err_when</a>( deptRecno &lt;= 0 || deptRecno &gt; <a class="code" href="Gamedef_8h.html#a10">MAX_DEPARTMENT</a> );
00994             <span class="comment">// departmental level message within 365 days</span>
00995             <span class="keywordflow">return</span> !last_protagonist_event_date[protagonistId-1][deptRecno] || (checkDate-last_protagonist_event_date[protagonistId-1][deptRecno]&gt;=365);
00996         }
00997     }
00998     <span class="keywordflow">return</span> 0;
00999 }
01000 
01001 <span class="comment">// --- End of PlayerSchool::is_protagonist_event_date --- //</span>
01002 
01003 <span class="comment">// --- Begin of PlayerSchool::mark_protagonist_event_date --- //</span>
01004 <span class="comment">//</span>
01005 <span class="keywordtype">int</span> PlayerSchool::mark_protagonist_event_date( <span class="keywordtype">int</span> protagonistId, <span class="keywordtype">int</span> deptRecno ) {
01006     <span class="keywordtype">int</span> checkDate = info.game_date;
01007 
01008     <a class="code" href="ALL_8H.html#a0">err_when</a>( protagonistId &lt;= 0 || protagonistId &gt; MAX_PROTAGONIST_ID );
01009 
01010     <span class="keywordflow">if</span>( deptRecno == -1 ) {
01011         <span class="comment">// institutional level</span>
01012         last_protagonist_event_date[protagonistId-1][0] = checkDate;
01013     }
01014     <span class="keywordflow">else</span> {
01015         <a class="code" href="ALL_8H.html#a0">err_when</a>( deptRecno &lt;= 0 || deptRecno &gt; <a class="code" href="Gamedef_8h.html#a10">MAX_DEPARTMENT</a> );
01016         <span class="comment">// departmental level</span>
01017         last_protagonist_event_date[protagonistId-1][deptRecno] = checkDate;
01018     }
01019     <span class="keywordflow">return</span> 0;
01020 }
01021 
01022 <span class="comment">// --- End of PlayerSchool::mark_protagonist_event_date --- //</span>
01023 
01024 <span class="comment">// parameter usage (short_para1...) for protagonist message:</span>
01025 <span class="comment">// short_para1 - opinion rating (1-6:R1-R6)</span>
01026 <span class="comment">// short_para2 - departmentRecno (-ve for institutional, magnitude is departmentRecno of faculty)</span>
01027 <span class="comment">// short_para3 - source of message(srcPara1), gender-ethnic group of student, faculty first_name_id for faculty</span>
01028 <span class="comment">// short_para4 - srcPara2, student level, faculty middle_name_id for faculty</span>
01029 <span class="comment">// short_para5 - srcPara3, student gender-ethnic group, faculty last_name_id for faculty</span>
01030 <span class="comment">// short_para6 - srcPara4, year_in_program of student, faculty rank_level</span>
01031 <span class="comment">//</span>
01032 <span class="keywordtype">void</span> News::protagonist_message() {
01033     <a class="code" href="ALL_8H.html#a0">err_when</a>( id &lt; NEWS_PROTAGONIST_TRUSTEE_EVALUATION || id &gt; NEWS_PROTAGONIST_CLASS_SIZE_DEVIATION );
01034 
01035     ProtagonistInfo *protogonistInfo = protagonist_info_array + id - NEWS_PROTAGONIST_TRUSTEE_EVALUATION;
01036 
01037     <span class="comment">// protagonist source department and faculty name res id</span>
01038     str  = protogonistInfo-&gt;source_str( abs(short_para2), short_para3, short_para4, short_para5, short_para6 );
01039     <span class="comment">// rating and target department</span>
01040     str += protogonistInfo-&gt;rating_str( short_para1, short_para2 );
01041 
01042     <span class="keywordflow">if</span>( short_para1 == COMMENT_R4 ) {               <span class="comment">// case R4, may have addition outcome for some event</span>
01043         <span class="keywordflow">switch</span>( id ) {
01044         <span class="keywordflow">case</span> NEWS_PROTAGONIST_FACULTY_MORALE:
01045         <span class="keywordflow">case</span> NEWS_PROTAGONIST_RESEARCH_PERFORMANCE:
01046         <span class="keywordflow">case</span> NEWS_PROTAGONIST_SALARIES_INCREASE:
01047         <span class="keywordflow">case</span> NEWS_PROTAGONIST_DEPT_PRESTIGE:
01048             str += <span class="stringliteral">" I resign!"</span>;
01049             <span class="keywordflow">break</span>;
01050 
01051         <span class="keywordflow">case</span> NEWS_PROTAGONIST_STUDENT_MORALE:
01052         <span class="keywordflow">case</span> NEWS_PROTAGONIST_DEPT_EDUCATIONAL_QUALITY:
01053             <span class="keywordflow">if</span>( short_para6 &gt; 0 ) {                   <span class="comment">// srcPara4 = number of student leave</span>
01054                 str += <span class="stringliteral">" I am leaving the university"</span>;
01055                 <span class="keywordflow">if</span>( short_para6 &gt; 1 ) {                 <span class="comment">// bring some friends to leave</span>
01056                     str += <span class="stringliteral">" along with "</span>;
01057                     <span class="keywordflow">if</span>( short_para6 == STUDENT_LEAVE_COUNT )
01058                         str += STUDENT_LEAVE_COUNT_STR;
01059                     <span class="keywordflow">else</span>
01060                         str += short_para6;
01061                     str += <span class="stringliteral">" of my friends"</span>;
01062                 }
01063                 str += <span class="stringliteral">"!"</span>;
01064             }
01065             <span class="keywordflow">break</span>;
01066 
01067         <span class="keywordflow">case</span> NEWS_PROTAGONIST_ALUMNI_MORALE:
01068         <span class="keywordflow">case</span> NEWS_PROTAGONIST_ALUMNI_DONATION:
01069             str += <span class="stringliteral">" I understand the Board has directed you to double spending on development and alumni affairs. I applaud that, but urge you to consider other actions as well."</span>;
01070             <span class="keywordflow">break</span>;
01071 
01072         <span class="keywordflow">case</span> NEWS_PROTAGONIST_FOOTBALL_PERFORMANCE:
01073         <span class="keywordflow">case</span> NEWS_PROTAGONIST_BASKETBALL_PERFORMANCE:
01074             str += <span class="stringliteral">" The alumni have prevailed on the Board to hire a big-time coach. This will add $200,000 a year to the athletics budget."</span>;
01075             <span class="keywordflow">break</span>;
01076         }
01077     }
01078 }
01079 
01080 <span class="comment">// for reasonId == LOSE_REASON_PROTAGONIST</span>
01081 <span class="comment">//      reason_para0 is protagonist_id</span>
01082 <span class="keywordtype">char</span> *LoseGameReport::get_reason_str_protagonist() {
01083     ProtagonistInfo *protagonistInfo = protagonist_info_array + reason_para0 - 1;
01084     <a class="code" href="ALL_8H.html#a0">err_when</a>( protagonistInfo-&gt;protagonist_id != reason_para0 );
01085 
01086     <span class="keyword">static</span> <a class="code" href="classString.html">String</a> str;
01087     <a class="code" href="ALL_8H.html#a0">err_when</a>( protagonistInfo-&gt;insert_text == <a class="code" href="OHELP_8H.html#a0">NULL</a> );
01088     str = protagonistInfo-&gt;insert_text;
01089     <span class="keywordtype">char</span> *strPtr = str;
01090     strPtr[0] = m.<a class="code" href="classString.html#a3">upper</a>(strPtr[0]);
01091     <span class="keywordflow">if</span>( protagonistInfo-&gt;normalizing_factor &gt; 0 )
01092         str += <span class="stringliteral">" is too low!"</span>;
01093     <span class="keywordflow">else</span>
01094         str += <span class="stringliteral">" is too high!"</span>;
01095 
01096     <span class="keywordflow">return</span> str;
01097 }
01098 
01099 <span class="keywordtype">int</span> ProtagonistInfo::is_event_date() {
01100     <span class="keyword">const</span> MONTH_PER_TRIMESTER = 12 / <a class="code" href="Gamedef_8h.html#a78a35">TRIMESTER_PER_YEAR</a>;
01101 
01102     <span class="keywordflow">if</span>( msg_source == PROTAGONIST_NULL )
01103         <span class="keywordflow">return</span> 0;
01104 
01105     <span class="keywordflow">switch</span>( event_freq ) {
01106     <span class="keywordflow">case</span> PROTAGONIST_YEAR:
01107         <span class="keywordflow">if</span>( info.game_month == event_month &amp;&amp; info.game_day == event_day )
01108             <span class="keywordflow">return</span> 1;
01109         <span class="keywordflow">break</span>;
01110     <span class="keywordflow">case</span> PROTAGONIST_TRIMESTER:
01111         <a class="code" href="ALL_8H.html#a0">err_when</a>( event_month &gt;= MONTH_PER_TRIMESTER );
01112         <span class="keywordflow">if</span>( info.game_month % MONTH_PER_TRIMESTER == event_month &amp;&amp; info.game_day == event_day )
01113             <span class="keywordflow">return</span> 1;
01114         <span class="keywordflow">break</span>;
01115     <span class="keywordflow">case</span> PROTAGONIST_MONTH:
01116         <span class="keywordflow">if</span>( info.game_day == event_day )
01117             <span class="keywordflow">return</span> 1;
01118         <span class="keywordflow">break</span>;
01119     <span class="keywordflow">default</span>: {
01120             <a class="code" href="ALL_8H.html#a1">err_here</a>();
01121         }
01122     }
01123     <span class="keywordflow">return</span> 0;
01124 }
01125 
01126 <span class="keywordtype">char</span> *ProtagonistInfo::source_str(<span class="keywordtype">int</span> srcDepartmentRecno, <span class="keywordtype">int</span> srcPara1, <span class="keywordtype">short</span> srcPara2, <span class="keywordtype">short</span> srcPara3, <span class="keywordtype">short</span> srcPara4 ) {
01127     <span class="keyword">static</span> <a class="code" href="classString.html">String</a> str;
01128     str = <span class="stringliteral">""</span>;
01129 
01130     <span class="keywordflow">switch</span>( msg_source ) {
01131     <span class="keywordflow">case</span> PROTAGONIST_NULL:
01132         <span class="comment">// str = "Message from an anonymous: ";</span>
01133         <span class="keywordflow">break</span>;
01134     <span class="keywordflow">case</span> PROTAGONIST_COMMITTEE:
01135         str = <span class="stringliteral">"Message from Chair of trustee Development Committee: "</span>;
01136         <span class="keywordflow">break</span>;
01137     <span class="keywordflow">case</span> PROTAGONIST_TRUSTEE:
01138         str = <span class="stringliteral">"Message from a trustee: "</span>;
01139         <span class="keywordflow">break</span>;
01140     <span class="keywordflow">case</span> PROTAGONIST_DEPARTMENT:
01141         str = <span class="stringliteral">"Message from Chair of "</span>;
01142         <span class="keywordflow">if</span>( srcDepartmentRecno == 0 )
01143             str += <span class="stringliteral">"General Department"</span>;
01144         <span class="keywordflow">else</span>
01145             str += department_array[srcDepartmentRecno]-&gt;name();
01146         str += <span class="stringliteral">": "</span>;
01147         <span class="keywordflow">break</span>;
01148     <span class="keywordflow">case</span> PROTAGONIST_SENATE:
01149         str = <span class="stringliteral">"Message from Chair of the Faculty Senate: "</span>;
01150         <span class="keywordflow">break</span>;
01151     <span class="keywordflow">case</span> PROTAGONIST_PROFESSOR:
01152         <a class="code" href="ALL_8H.html#a1">err_here</a>();                                 <span class="comment">// not used, use PROTAGONIST_FACULTY instead</span>
01153         <span class="keywordflow">break</span>;
01154     <span class="keywordflow">case</span> PROTAGONIST_FACULTY: {
01155         <span class="comment">// srcPara1 = facultyPtr-&gt;first_name_id;</span>
01156         <span class="comment">// srcPara2 = facultyPtr-&gt;middle_name_id;</span>
01157         <span class="comment">// srcPara3 = facultyPtr-&gt;last_name_id;</span>
01158         <span class="comment">// srcPara4 = facultyPtr-&gt;rank_level;</span>
01159 
01160         <a class="code" href="ALL_8H.html#a0">err_when</a>( department_array.is_deleted(srcDepartmentRecno) );
01161         <a class="code" href="classDepartment.html">Department</a> *deptPtr = department_array[srcDepartmentRecno];
01162 
01163         str  = <span class="stringliteral">"Message from "</span>;
01164         <span class="comment">//str += game_str_res.rank_str( srcPara4 );</span>
01165         <span class="comment">// str += " ";</span>
01166         <span class="keywordflow">if</span>( srcPara4 == <a class="code" href="Ofaculty_8h.html#a27a11">FULL_PROF</a> )
01167             str += <span class="stringliteral">"Professor "</span>;
01168         str += <a class="code" href="classFaculty.html#a0">Faculty::name</a>( srcPara1, srcPara2, srcPara3 );
01169         str += <span class="stringliteral">" in the "</span>;
01170         str += deptPtr-&gt;<a class="code" href="classDepartment.html#a3">name</a>();
01171         str += <span class="stringliteral">": "</span>;
01172     }
01173     <span class="comment">// randomly select a faculty member in department</span>
01174     <span class="keywordflow">break</span>;
01175     <span class="keywordflow">case</span> PROTAGONIST_FINANCE:
01176         str = <span class="stringliteral">"Message from VP for Finance: "</span>;
01177         <span class="keywordflow">break</span>;
01178     <span class="keywordflow">case</span> PROTAGONIST_FACILITIES:
01179         str = <span class="stringliteral">"Message from Director of Facilities: "</span>;
01180         <span class="keywordflow">break</span>;
01181     <span class="keywordflow">case</span> PROTAGONIST_ADMISSIONS:
01182         str = <span class="stringliteral">"Message from Dean of Admissions: "</span>;
01183         <span class="keywordflow">break</span>;
01184     <span class="keywordflow">case</span> PROTAGONIST_POLICE:
01185         str = <span class="stringliteral">"Message from Police Chief: "</span>;
01186         <span class="keywordflow">break</span>;
01187     <span class="keywordflow">case</span> PROTAGONIST_STAFF:
01188         str = <span class="stringliteral">"Message from staff member: "</span>;
01189         <span class="keywordflow">break</span>;
01190     <span class="keywordflow">case</span> PROTAGONIST_STUDENT:
01191         <span class="comment">// randomly select a studnet in department</span>
01192         <span class="comment">// eg : Message from a non-minority female traditional undergraduate student majoring in Chemistry</span>
01193         <span class="keywordflow">if</span>( !srcDepartmentRecno ) {
01194             str += <span class="stringliteral">"Message from a student: "</span>;
01195         }
01196         <span class="keywordflow">else</span> {
01197             <span class="comment">//srcPara1 = studentPtr-&gt;student_level;</span>
01198             <span class="comment">//srcPara2 = studentPtr-&gt;gender_ethnic_group;</span>
01199             <span class="comment">//srcPara3 = studentPtr-&gt;year_in_program;</span>
01200             <span class="comment">//srcPara4 = (reserved to store number of students quit the university)</span>
01201 
01202             <a class="code" href="ALL_8H.html#a0">err_when</a>( department_array.is_deleted(srcDepartmentRecno) );
01203             str += <span class="stringliteral">"Message from a"</span>;
01204             str += <span class="stringliteral">" "</span>;
01205             <a class="code" href="classString.html">String</a> genderStr=game_str_res.gender_ethnic_str(srcPara2);
01206             str += genderStr.<a class="code" href="classString.html#a4">lower</a>();
01207             str += <span class="stringliteral">" "</span>;
01208             str += game_str_res.student_level_str(srcPara1);
01209             str += <span class="stringliteral">" student majoring in "</span>;
01210             str += department_res[department_array[srcDepartmentRecno]-&gt;department_id]-&gt;name;
01211             <span class="comment">// don't use department_array[srcDepartmentRecno]-&gt;name(), we don't want department</span>
01212             str += <span class="stringliteral">": "</span>;
01213         }
01214         <span class="keywordflow">break</span>;
01215     <span class="keywordflow">case</span> PROTAGONIST_ALUMNUS:
01216         str = <span class="stringliteral">"Message from an alumnus: "</span>;
01217         <span class="keywordflow">break</span>;
01218     <span class="keywordflow">case</span> PROTAGONIST_ALUMNA:
01219         str = <span class="stringliteral">"Message from an alumna: "</span>;
01220         <span class="keywordflow">break</span>;
01221     <span class="keywordflow">default</span>:
01222         <a class="code" href="ALL_8H.html#a1">err_here</a>();
01223     }
01224 
01225     <span class="keywordflow">return</span> str;
01226 }
01227 
01228 <span class="comment">// rating (R1-R6) and department</span>
01229 
01230 <span class="keywordtype">char</span> *ProtagonistInfo::rating_str(<span class="keywordtype">int</span> rating, <span class="keywordtype">int</span> departmentRecno ) {
01231     <span class="keyword">static</span> <a class="code" href="classString.html">String</a> str;
01232 
01233     str = <span class="stringliteral">""</span>;
01234 
01235     <span class="keywordtype">int</span> departmentLevel =  departmental_level;
01236     <span class="keywordtype">int</span> existDepartmentLevel = exist_departmental_level;
01237     <span class="keywordtype">char</span> *insertText = insert_text;
01238     <span class="keywordtype">char</span> *targetStr = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
01239 
01240     <span class="keywordflow">switch</span>( rating ) {
01241     <span class="keywordflow">case</span> COMMENT_R1:                              <span class="comment">// R1, 1/4 chance for departmental level, 1.0 chance for instituation level</span>
01242         str += <span class="stringliteral">"Congratulations"</span>;
01243         <span class="keywordflow">if</span>( (targetStr=target_str(departmentRecno))
01244             &amp;&amp; targetStr[0] != <span class="charliteral">'\0'</span> ) {                 <span class="comment">// not empty string</span>
01245             str += <span class="stringliteral">" on"</span>;
01246             str += targetStr;
01247         }
01248         str += <span class="stringliteral">"."</span>;
01249         str += <span class="stringliteral">" This outstanding performance reflects positively on your administration."</span>;
01250         <span class="keywordflow">break</span>;
01251 
01252     <span class="keywordflow">case</span> COMMENT_R2:                              <span class="comment">// R2, 1/8 chance for department and 1/2 chance for institutional level</span>
01253         str += <span class="stringliteral">"I'm pleased"</span>;
01254         <span class="keywordflow">if</span>( (targetStr=target_str(departmentRecno))
01255             &amp;&amp; targetStr[0] != <span class="charliteral">'\0'</span> ) {                 <span class="comment">// not empty string</span>
01256             str += <span class="stringliteral">" with"</span>;
01257             str += targetStr;
01258         }
01259         str += <span class="stringliteral">"."</span>;
01260         str += <span class="stringliteral">" I hope you can do even better in the future."</span>;
01261         <span class="keywordflow">break</span>;
01262 
01263     <span class="keywordflow">case</span> COMMENT_R4:                              <span class="comment">// R4 (note the order, 1/4 chance for departmental level, 1.0 chance for instituation level</span>
01264         str += <span class="stringliteral">"I'm bitterly disappointed"</span>;
01265         <span class="keywordflow">if</span>( (targetStr=target_str(departmentRecno) )
01266             &amp;&amp; targetStr[0] != <span class="charliteral">'\0'</span> ) {                 <span class="comment">// not empty string</span>
01267             str += <span class="stringliteral">" about"</span>;
01268             str += targetStr;
01269         }
01270         str += <span class="stringliteral">"."</span>;
01271         str += <span class="stringliteral">" Such unacceptable performance threatens the viability of your administration."</span>;
01272         <span class="keywordflow">break</span>;
01273 
01274     <span class="keywordflow">case</span> COMMENT_R3:                              <span class="comment">// R3, 1/8 chance for department and 1/2 chance for institutional level</span>
01275         str += <span class="stringliteral">"I'm concerned"</span>;
01276         <span class="keywordflow">if</span>( (targetStr=target_str(departmentRecno) )
01277             &amp;&amp; targetStr[0] != <span class="charliteral">'\0'</span> ) {                 <span class="comment">// not empty string</span>
01278             str += <span class="stringliteral">" about"</span>;
01279             str += targetStr;
01280         }
01281         str += <span class="stringliteral">"."</span>;
01282         str += <span class="stringliteral">" You can expect complaints to intensify unless performance in this area improves."</span>;
01283         <span class="keywordflow">break</span>;
01284 
01285     <span class="keywordflow">case</span> COMMENT_R5:                              <span class="comment">// R5</span>
01286         str += <span class="stringliteral">"My compliments on the favorable trend"</span>;
01287         <span class="keywordflow">if</span>( (targetStr=target_str(departmentRecno) )
01288             &amp;&amp; targetStr[0] != <span class="charliteral">'\0'</span> ) {                 <span class="comment">// not empty string</span>
01289             str += <span class="stringliteral">" in"</span>;
01290             str += targetStr;
01291         }
01292         str += <span class="stringliteral">"."</span>;
01293         str += <span class="stringliteral">" However, the level of performance remains weak."</span>;
01294         <span class="keywordflow">break</span>;
01295 
01296     <span class="keywordflow">case</span> COMMENT_R6:                              <span class="comment">// R6</span>
01297         str += <span class="stringliteral">"I'm concerned about the unfavorable trend"</span>;
01298         <span class="keywordflow">if</span>( (targetStr=target_str(departmentRecno) )
01299             &amp;&amp; targetStr[0] != <span class="charliteral">'\0'</span> ) {                 <span class="comment">// not empty string</span>
01300             str += <span class="stringliteral">" in"</span>;
01301             str += targetStr;
01302         }
01303         str += <span class="stringliteral">"."</span>;
01304         str += <span class="stringliteral">" However, the level of performance remains strong."</span>;
01305         <span class="keywordflow">break</span>;
01306 
01307     <span class="keywordflow">default</span>:
01308         <a class="code" href="ALL_8H.html#a1">err_here</a>();
01309     }
01310 
01311     <span class="keywordflow">return</span> str;
01312 }
01313 
01314 <span class="keywordtype">char</span> *ProtagonistInfo::target_str(<span class="keywordtype">int</span> departmentRecno) {
01315     <span class="keyword">static</span> <a class="code" href="classString.html">String</a> str;
01316     str = <span class="stringliteral">""</span>;
01317 
01318     <span class="keywordtype">int</span> departmentLevel = departmental_level;
01319     <span class="keywordtype">int</span> existDepartmentLevel = exist_departmental_level;
01320     <span class="keywordtype">char</span> *insertText = insert_text;
01321 
01322     <span class="keywordflow">if</span>( (departmentLevel || existDepartmentLevel) &amp;&amp; departmentRecno &lt; 0 )
01323         str += <span class="stringliteral">" the university's"</span>;
01324     <span class="keywordflow">if</span>( insertText ) {
01325         str += <span class="stringliteral">" "</span>;
01326         str += insertText;
01327     }
01328     <span class="keywordflow">if</span>( departmentLevel &amp;&amp; departmentRecno &gt;= 0 ) {
01329         str += <span class="stringliteral">" in the "</span>;
01330         <span class="keywordflow">if</span>( departmentRecno == 0 )
01331             <span class="comment">// general department</span>
01332             str += department_res.general_dept_info.name;
01333         <span class="keywordflow">else</span>
01334             str += department_array[departmentRecno]-&gt;name();
01335     }
01336 
01337     <span class="keywordflow">return</span> str;
01338 }
01339 <span class="preprocessor">#endif</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:15 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
