<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OVGABUF2.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>OVGABUF2.CPP</h1><a href="OVGABUF2_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OVGABUF2.CPP</span>
00002 <span class="comment">//Description : OVGABUF direct draw surface class - part 2</span>
00003 
00004 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00005 <span class="preprocessor">#include &lt;<a class="code" href="IMGFUN_8H.html">IMGFUN.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00007 <span class="preprocessor">#include &lt;<a class="code" href="OPOWER_8H.html">OPOWER.H</a>&gt;</span>
00008 <span class="preprocessor">#include &lt;<a class="code" href="OCOLTBL_8H.html">OCOLTBL.H</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00010 <span class="preprocessor">#include &lt;OVGABUF.H&gt;</span>
00011 <span class="preprocessor">#include &lt;<a class="code" href="OIMGRES_8H.html">OIMGRES.H</a>&gt;</span>
00012 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00013 <span class="preprocessor">#include &lt;OFONT.H&gt;</span>
00014 <span class="preprocessor">#include &lt;<a class="code" href="OBITMAP_8H.html">OBITMAP.H</a>&gt;</span>
00015 <span class="preprocessor">#include &lt;<a class="code" href="OBITMAPW_8H.html">OBITMAPW.H</a>&gt;</span>
00016 
00017 <span class="comment">//------- Define static class member vars ---------//</span>
00018 
<a name="l00019"></a><a class="code" href="classVgaBuf.html#p0">00019</a> <span class="keywordtype">short</span> <a class="code" href="classVgaBuf.html#p0">VgaBuf::color_scheme</a>;
<a name="l00020"></a><a class="code" href="classVgaBuf.html#p1">00020</a> <span class="keywordtype">char</span>  <a class="code" href="classVgaBuf.html#p1">VgaBuf::color_light</a>;
<a name="l00021"></a><a class="code" href="classVgaBuf.html#p2">00021</a> <span class="keywordtype">char</span>  <a class="code" href="classVgaBuf.html#p2">VgaBuf::color_dark</a>;
<a name="l00022"></a><a class="code" href="classVgaBuf.html#p3">00022</a> <span class="keywordtype">char</span>  <a class="code" href="classVgaBuf.html#p3">VgaBuf::color_up</a>;
<a name="l00023"></a><a class="code" href="classVgaBuf.html#p4">00023</a> <span class="keywordtype">char</span>  <a class="code" href="classVgaBuf.html#p4">VgaBuf::color_down</a>;
<a name="l00024"></a><a class="code" href="classVgaBuf.html#p5">00024</a> <span class="keywordtype">char</span>  <a class="code" href="classVgaBuf.html#p5">VgaBuf::color_push</a>;
<a name="l00025"></a><a class="code" href="classVgaBuf.html#p6">00025</a> <span class="keywordtype">char</span>  <a class="code" href="classVgaBuf.html#p6">VgaBuf::color_border</a>;
00026 
00027 <span class="comment">//---------- Begin of function VgaBuf::set_color ---------//</span>
<a name="l00033"></a><a class="code" href="classVgaBuf.html#a12">00033</a> <span class="comment">void VgaBuf::set_color(int colorScheme) {</span>
00034     color_scheme = colorScheme;
00035 
00036     color_light  = colorScheme;
00037     color_dark   = colorScheme+8;
00038     color_up     = colorScheme+4;                   <span class="comment">// color_up   = colorScheme+2</span>
00039     color_down   = colorScheme+2;                   <span class="comment">// color_down = colorScheme</span>
00040     color_push   = colorScheme+6;
00041     color_border = colorScheme+10;
00042 }
00043 
00044 <span class="comment">//------------ End of function VgaBuf::set_color ---------//</span>
00045 
00046 <span class="comment">//------------- Begin of function VgaBuf::bar --------------//</span>
<a name="l00056"></a><a class="code" href="classVgaBuf.html#a27">00056</a> <span class="comment">void VgaBuf::bar(int x1,int y1,int x2,int y2,int colorCode) {</span>
00057     <a class="code" href="ALL_8H.html#a0">err_when</a>( !buf_locked );
00058 
00059     <span class="keywordflow">if</span>(sys.no_true_output_flag)
00060         <span class="keywordflow">if</span>( is_front )
00061             <span class="keywordflow">return</span>;
00062 
00063     <span class="keywordflow">if</span>( is_front )
00064         mouse.hide_area(x1,y1,x2,y2);
00065 
00066     <span class="comment">//  IMGbar(buf_ptr(), buf_true_pitch(), x1, y1, x2, y2, translate_color(colorCode) );</span>
00067 
00068     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=y1;j&lt;=y2;j++)
00069         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=x1;i&lt;=x2;i++) {
00070             <span class="keywordtype">short</span> readpixel=(*(buf_ptr()+buf_pitch()*j+i));
00071 
00072             <span class="keywordflow">if</span>(((colorCode!=5)&amp;&amp;(colorCode!=<a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;<a class="code" href="classVgaBuf.html#p2">color_dark</a>))
00073                ||(readpixel!=translate_color(193)))
00074                 draw_pixel(i,j,colorCode);
00075         }
00076 
00077     <span class="keywordflow">if</span>( is_front )
00078         mouse.show_area();
00079 }
00080 
00081 <span class="comment">//--------------- End of function VgaBuf::bar --------------//</span>
00082 
00083 <span class="comment">/*</span>
00084 <span class="comment">//------------- Begin of function VgaBuf::pixelize --------------//</span>
00092 <span class="comment">void VgaBuf::pixelize(int x1,int y1,int x2,int y2,int colorCode)</span>
00093 <span class="comment">{</span>
00094 <span class="comment">err_when( !buf_locked );</span>
00095 <span class="comment"></span>
00096 <span class="comment">if( is_front )</span>
00097 <span class="comment">mouse.hide_area(x1,y1,x2,y2);</span>
00098 <span class="comment"></span>
00099 <span class="comment">//---------------------------------------//</span>
00100 <span class="comment"></span>
00101 <span class="comment">// ###### begin Gilbert 7/7 #########//</span>
00102 <span class="comment">int     bufPitch = buf_pitch();</span>
00103 <span class="comment">int   x, y, lineRemainBytes = bufPitch - (x2-x1+1);</span>
00104 <span class="comment">char* writePtr = buf_ptr() + bufPitch * y1 + x1;</span>
00105 <span class="comment"></span>
00106 <span class="comment">for( y=y1 ; y&lt;=y2 ; y++ )</span>
00107 <span class="comment">{</span>
00108 <span class="comment">if( y&amp;1 )</span>
00109 <span class="comment">{</span>
00110 <span class="comment">writePtr+=bufPitch;</span>
00111 <span class="comment">}</span>
00112 <span class="comment">else</span>
00113 <span class="comment">{</span>
00114 <span class="comment">for( x=x1 ; x&lt;=x2 ; x++, writePtr++ )</span>
00115 <span class="comment">{</span>
00116 <span class="comment">if( x&amp;1 )</span>
00117 <span class="comment">*writePtr = colorCode;</span>
00118 <span class="comment">}</span>
00119 <span class="comment"></span>
00120 <span class="comment">writePtr+=lineRemainBytes;</span>
00121 <span class="comment">}</span>
00122 <span class="comment">}</span>
00123 <span class="comment">// ###### end Gilbert 7/7 #########//</span>
00124 <span class="comment"></span>
00125 <span class="comment">//---------------------------------------//</span>
00126 <span class="comment"></span>
00127 <span class="comment">if( is_front )</span>
00128 <span class="comment">mouse.show_area();</span>
00129 <span class="comment">}</span>
00130 <span class="comment">//--------------- End of function VgaBuf::pixelize --------------//</span>
00131 <span class="comment">*/</span>
00132 
00133 <span class="comment">//------------- Begin of function VgaBuf::rect --------------//</span>
<a name="l00144"></a><a class="code" href="classVgaBuf.html#a39">00144</a> <span class="comment">void VgaBuf::rect(int x1,int y1,int x2,int y2,int lt, int color) {</span>
00145     lt--;
00146 
00147     bar(x1,y1,x2,y1+lt,color);
00148     bar(x1,y1,x1+lt,y2,color);
00149     bar(x1,y2-lt,x2,y2,color);
00150     bar(x2-lt,y1,x2,y2,color);
00151 }
00152 
00153 <span class="comment">//--------------- End of function VgaBuf::rect --------------//</span>
00154 
00155 <span class="comment">//------------- Start of function VgaBuf::d3_rect --------------//</span>
00156 <span class="comment">//</span>
00157 <span class="comment">// Draw a d3 rect on VGA screen</span>
00158 <span class="comment">//</span>
00159 <span class="comment">// Syntax : d3_rect( x1, y1, x2, y2, lineWidth, color )</span>
00160 <span class="comment">//</span>
00161 <span class="comment">// int x1,y1       - the top left vertex of the d3_rect</span>
00162 <span class="comment">// int x2,y2       - the bottom right vertex of the d3_rect</span>
00163 
<a name="l00164"></a><a class="code" href="classVgaBuf.html#a40">00164</a> <span class="keywordtype">void</span> <a class="code" href="classVgaBuf.html#a40">VgaBuf::d3_rect</a>(<span class="keywordtype">int</span> x1,<span class="keywordtype">int</span> y1,<span class="keywordtype">int</span> x2,<span class="keywordtype">int</span> y2) {
00165     <a class="code" href="classVgaBuf.html#a39">rect</a>( x1+1, y1+1, x2, y2, 1, <a class="code" href="COLOR_8H.html#a17">V_WHITE</a> );
00166     <a class="code" href="classVgaBuf.html#a39">rect</a>( x1, y1, x2-1, y2-1, 1, <a class="code" href="COLOR_8H.html#a6">VGA_GRAY</a>+8 );
00167 }
00168 
00169 <span class="comment">//--------------- End of function VgaBuf::d3_rect --------------//</span>
00170 
00171 <span class="comment">//------------- Start of function VgaBuf::tile --------------//</span>
00172 <span class="comment">//</span>
00173 <span class="comment">// Fill an area with a specific tile</span>
00174 <span class="comment">//</span>
00175 <span class="comment">// &lt;int&gt;   x1,y1    - the top left vertex of the tile</span>
00176 <span class="comment">// &lt;int&gt;   x2,y2    - the bottom right vertex of the tile</span>
00177 <span class="comment">// &lt;char*&gt; tileName - the name of the tile</span>
00178 <span class="comment">//</span>
<a name="l00179"></a><a class="code" href="classVgaBuf.html#a45">00179</a> <span class="keywordtype">void</span> <a class="code" href="classVgaBuf.html#a45">VgaBuf::tile</a>(<span class="keywordtype">int</span> x1,<span class="keywordtype">int</span> y1,<span class="keywordtype">int</span> x2,<span class="keywordtype">int</span> y2,<span class="keywordtype">char</span>* tileName) {
00180     <a class="code" href="ALL_8H.html#a2">err_if</a>( x1&gt;x2 || y1&gt;y2 || x1&lt;0 || y1&lt;0 || x2&gt;=<a class="code" href="OVGA_8H.html#a0">VGA_WIDTH</a> || y2&gt;=<a class="code" href="OVGA_8H.html#a1">VGA_HEIGHT</a> )
00181         <a class="code" href="ALL_8H.html#a4">err_now</a>( <span class="stringliteral">"VgaBuf::tile"</span> );
00182     <span class="comment">/*</span>
00183 <span class="comment">      if( is_front )</span>
00184 <span class="comment">      mouse.hide_area( x1,y1,x2,y2 );</span>
00185 <span class="comment"></span>
00186 <span class="comment">      char* tilePtr = image_tile.get_ptr(tileName);</span>
00187 <span class="comment"></span>
00188 <span class="comment">      if( tilePtr )</span>
00189 <span class="comment">      VGAtile(x1,y1,x2,y2,tilePtr);</span>
00190 <span class="comment"></span>
00191 <span class="comment">      if( is_front )</span>
00192 <span class="comment">      mouse.show_area();</span>
00193 <span class="comment">    */</span>
00194 }
00195 
00196 <span class="comment">//--------------- End of function VgaBuf::tile --------------//</span>
00197 
00198 <span class="comment">//------------- Start of function VgaBuf::separator --------------//</span>
00199 <span class="comment">//</span>
00200 <span class="comment">// Draw a VGA separator line</span>
00201 <span class="comment">//</span>
00202 <span class="comment">// Syntax : separator( x1, y1, x2, y2 )</span>
00203 <span class="comment">//</span>
00204 <span class="comment">// int x1,y1       - the top left vertex of the separator</span>
00205 <span class="comment">// int x2,y2       - the bottom right vertex of the separator</span>
00206 <span class="comment">//</span>
<a name="l00207"></a><a class="code" href="classVgaBuf.html#a33">00207</a> <span class="keywordtype">void</span> <a class="code" href="classVgaBuf.html#a33">VgaBuf::separator</a>(<span class="keywordtype">int</span> x1, <span class="keywordtype">int</span> y1, <span class="keywordtype">int</span> x2, <span class="keywordtype">int</span> y2) {
00208     <span class="keywordflow">if</span>( y1+1==y2 ) {                                <span class="comment">// horizontal line</span>
00209         <a class="code" href="classVgaBuf.html#a27">bar</a>( x1, y1, x2, y1, <a class="code" href="COLOR_8H.html#a17">V_WHITE</a>        );
00210         <a class="code" href="classVgaBuf.html#a27">bar</a>( x1, y2, x2, y2, <a class="code" href="classVgaBuf.html#p2">color_dark</a> );
00211     }
00212     <span class="keywordflow">else</span> {
00213         <a class="code" href="classVgaBuf.html#a27">bar</a>( x1, y1, x1, y2, <a class="code" href="COLOR_8H.html#a17">V_WHITE</a>        );
00214         <a class="code" href="classVgaBuf.html#a27">bar</a>( x2, y1, x2, y2, <a class="code" href="classVgaBuf.html#p2">color_dark</a> );
00215     }
00216 }
00217 
00218 <span class="comment">//--------------- End of function VgaBuf::separator --------------//</span>
00219 
00220 <span class="comment">//------------- Start of function VgaBuf::indicator --------------//</span>
00221 <span class="comment">//</span>
00222 <span class="comment">// &lt;int&gt;   x1, y1, x2, y2 = coordination of the indicator</span>
00223 <span class="comment">// &lt;float&gt; curValue       = the value of the bar</span>
00224 <span class="comment">// &lt;float&gt; maxValue       = max value, the bar width = maxBarWidth * curValue / maxValue</span>
00225 <span class="comment">// &lt;int&gt;   indiColor      = color of the indicator</span>
00226 <span class="comment">// [int]   backColor      = background color</span>
00227 <span class="comment">//                          (default : vga.color_down)</span>
00228 <span class="comment">//                          (-2 if don't paint background color)</span>
00229 <span class="comment">//</span>
<a name="l00230"></a><a class="code" href="classVgaBuf.html#a36">00230</a> <span class="keywordtype">void</span> <a class="code" href="classVgaBuf.html#a36">VgaBuf::indicator</a>(<span class="keywordtype">int</span> x1, <span class="keywordtype">int</span> y1, <span class="keywordtype">int</span> x2, <span class="keywordtype">int</span> y2, <span class="keywordtype">float</span> curValue,
00231                        <span class="keywordtype">float</span> maxValue, <span class="keywordtype">int</span> indiColor, <span class="keywordtype">int</span> backColor) {
00232     <span class="keywordflow">if</span>(sys.no_true_output_flag)
00233         <span class="keywordflow">if</span>( is_front )
00234             <span class="keywordflow">return</span>;
00235 
00236     <span class="keywordflow">if</span>( backColor == -1 )
00237         backColor = <a class="code" href="classVgaBuf.html#p4">color_down</a>;
00238 
00239     <span class="keywordflow">if</span>( curValue &gt; maxValue )
00240         curValue = maxValue;
00241 
00242     <span class="keywordflow">if</span>( curValue &gt; 0 ) {
00243         <span class="keywordtype">int</span> barWidth = (int) ((float)(x2-x1) * curValue / maxValue);
00244 
00245         <span class="keywordtype">int</span> halfHeight = (y2-y1+1)/2-1;
00246         <span class="keywordtype">int</span> tx2        = x1+barWidth;
00247         <span class="keywordtype">int</span> y;
00248         <span class="keywordtype">double</span> ic=indiColor;
00249 
00250         ic+=halfHeight;
00251 
00252         <a class="code" href="classVgaBuf.html#a27">bar</a>( x1-1, y1-1, x1+barWidth+1, y2+1, <a class="code" href="COLOR_8H.html#a15">V_BLACK</a> );
00253 
00254         <span class="keywordflow">for</span>( y=y1 ; y&lt;y1+(halfHeight/2) ; y++, ic-=2.0 )
00255             <a class="code" href="classVgaBuf.html#a27">bar</a>( x1, y, tx2, y, (<span class="keywordtype">int</span>)ic);
00256 
00257         <span class="keywordflow">for</span>( ; y&lt;=y2 ; y++, ic+=0.75 )
00258             <a class="code" href="classVgaBuf.html#a27">bar</a>( x1, y, tx2, y, (<span class="keywordtype">int</span>)ic );
00259 
00260         <span class="keywordflow">if</span>( backColor != -2 ) {                       <span class="comment">// -2 if don't paint background color</span>
00261             <span class="keywordflow">if</span>( x1+barWidth &lt; x2 )
00262                 <a class="code" href="classVgaBuf.html#a27">bar</a>( x1+barWidth+1, y1, x2, y2, backColor );
00263         }
00264     }
00265     <span class="keywordflow">else</span> {
00266         <span class="keywordflow">if</span>( backColor != -2 )                         <span class="comment">// -2 if don't paint background color</span>
00267             <a class="code" href="classVgaBuf.html#a27">bar</a>( x1, y1, x2, y2, backColor );
00268     }
00269 
00270 }
00271 
00272 <span class="comment">//--------------- End of function VgaBuf::indicator --------------//</span>
00273 
00274 <span class="comment">//------------- Start of function VgaBuf::v_indicator --------------//</span>
00275 <span class="comment">//</span>
00276 <span class="comment">// &lt;int&gt;   x1, y1, x2, y2 = coordination of the indicator</span>
00277 <span class="comment">// &lt;float&gt; curValue       = the value of the bar</span>
00278 <span class="comment">// &lt;float&gt; maxValue       = max value, the bar width = maxBarWidth * curValue / maxValue</span>
00279 <span class="comment">// &lt;int&gt;   indiColor      = color of the indicator</span>
00280 <span class="comment">// [int]   backColor      = background color</span>
00281 <span class="comment">//                          (default : vga.color_down)</span>
00282 <span class="comment">//                          (-2 if don't paint background color)</span>
00283 <span class="comment">//</span>
<a name="l00284"></a><a class="code" href="classVgaBuf.html#a38">00284</a> <span class="keywordtype">void</span> <a class="code" href="classVgaBuf.html#a38">VgaBuf::v_indicator</a>(<span class="keywordtype">int</span> x1, <span class="keywordtype">int</span> y1, <span class="keywordtype">int</span> x2, <span class="keywordtype">int</span> y2, <span class="keywordtype">float</span> curValue,
00285                          <span class="keywordtype">float</span> maxValue, <span class="keywordtype">int</span> indiColor, <span class="keywordtype">int</span> backColor) {
00286     <span class="keywordflow">if</span>(sys.no_true_output_flag)
00287         <span class="keywordflow">if</span>( is_front )
00288             <span class="keywordflow">return</span>;
00289 
00290     <span class="keywordflow">if</span>( backColor == -1 )
00291         backColor = <a class="code" href="classVgaBuf.html#p4">color_down</a>;
00292 
00293     <span class="keywordflow">if</span>( curValue &gt; maxValue )
00294         curValue = maxValue;
00295 
00296     <span class="keywordflow">if</span>( curValue &gt; 0 ) {
00297         <span class="keywordtype">int</span> barHeight = (int) ((float)(y2-y1) * curValue / maxValue);
00298 
00299         <span class="keywordtype">int</span> halfWidth = (x2-x1+1)/2-1;
00300         <span class="keywordtype">int</span> ty2        = y1+barHeight;
00301         <span class="keywordtype">int</span> x;
00302 
00303         indiColor+=halfWidth;
00304 
00305         <span class="keywordflow">for</span>( x=x1 ; x&lt;x1+halfWidth; x++, indiColor-- )
00306             <a class="code" href="classVgaBuf.html#a27">bar</a>( x, y1, x, ty2, indiColor );
00307 
00308         <span class="keywordflow">for</span>( ; x&lt;=x2 ; x++, indiColor++ )
00309             <a class="code" href="classVgaBuf.html#a27">bar</a>( x, y1, x, ty2, indiColor );
00310 
00311         <span class="keywordflow">if</span>( backColor != -2 ) {                       <span class="comment">// -2 if don't paint background color</span>
00312             <span class="keywordflow">if</span>( y1+barHeight &lt; y2 )
00313                 <a class="code" href="classVgaBuf.html#a27">bar</a>( x1, y1+barHeight+1, x2, y2, backColor );
00314         }
00315     }
00316     <span class="keywordflow">else</span> {
00317         <span class="keywordflow">if</span>( backColor != -2 )                         <span class="comment">// -2 if don't paint background color</span>
00318             <a class="code" href="classVgaBuf.html#a27">bar</a>( x1, y1, x2, y2, backColor );
00319     }
00320 }
00321 
00322 <span class="comment">//--------------- End of function VgaBuf::v_indicator --------------//</span>
00323 
00324 <span class="comment">/*</span>
00325 <span class="comment">//------------- Start of function VgaBuf::indicator --------------//</span>
00326 <span class="comment">//</span>
00327 <span class="comment">// &lt;int&gt;   barType        = bar style, bit 0 = disp curValue, bit 1 =  disp '/' and maxValue, bit 2 = longer bar, bit 3 = use another back buffer</span>
00328 <span class="comment">// &lt;int&gt;   x1, y1         = coordination of the indicator</span>
00329 <span class="comment">// &lt;float&gt; curValue       = the value of the bar</span>
00330 <span class="comment">// &lt;float&gt; maxValue       = max value, the bar width = maxBarWidth * curValue / maxValue</span>
00331 <span class="comment">// &lt;int&gt;   colorScheme    = color of the indicator // not used</span>
00332 <span class="comment">//</span>
00333 <span class="comment">void VgaBuf::indicator(int barType, int x1, int y1, float curValue, float maxValue, int colorScheme)</span>
00334 <span class="comment">{</span>
00335 <span class="comment">// -------- get indicator bar background ------------//</span>
00336 <span class="comment"></span>
00337 <span class="comment">const TEMP_BUFFER_SIZE = 0x2000;</span>
00338 <span class="comment">static short tempBuffer[TEMP_BUFFER_SIZE];</span>
00339 <span class="comment"></span>
00340 <span class="comment">char *bgPtr = image_button.get_ptr(barType &amp; 4 ? "V_HP-BX" : "V_PW-BX");</span>
00341 <span class="comment">if( !bgPtr )</span>
00342 <span class="comment">{</span>
00343 <span class="comment">err_here();</span>
00344 <span class="comment">return;</span>
00345 <span class="comment">}</span>
00346 <span class="comment"></span>
00347 <span class="comment">// -------- calculate the boundary or the indicator ---------//</span>
00348 <span class="comment">int width = ((Bitmap *)bgPtr)-&gt;get_width();</span>
00349 <span class="comment">int height = ((Bitmap *)bgPtr)-&gt;get_height();</span>
00350 <span class="comment"></span>
00351 <span class="comment">int bufferX1 = x1;</span>
00352 <span class="comment">int bufferY1 = y1;</span>
00353 <span class="comment"></span>
00354 <span class="comment">short *destPtr = buf_ptr();</span>
00355 <span class="comment">int destPitch = buf_true_pitch();</span>
00356 <span class="comment"></span>
00357 <span class="comment">if(barType &amp; 8)</span>
00358 <span class="comment">{</span>
00359 <span class="comment">if( ((Bitmap *)bgPtr)-&gt;size() &lt; TEMP_BUFFER_SIZE )</span>
00360 <span class="comment">{</span>
00361 <span class="comment">bufferX1 = 0;</span>
00362 <span class="comment">bufferY1 = 0;</span>
00363 <span class="comment">((BitmapW *)tempBuffer)-&gt;init(width, height);</span>
00364 <span class="comment">destPtr = ((BitmapW *)tempBuffer)-&gt;bitmap;</span>
00365 <span class="comment">destPitch = ((BitmapW *)tempBuffer)-&gt;get_true_pitch();</span>
00366 <span class="comment">}</span>
00367 <span class="comment">else</span>
00368 <span class="comment">{</span>
00369 <span class="comment">barType &amp;= ~8;          // indicator too big, directly write to the buffer</span>
00370 <span class="comment">}</span>
00371 <span class="comment">}</span>
00372 <span class="comment"></span>
00373 <span class="comment">int x2 = x1 + width -1;</span>
00374 <span class="comment">int y2 = y1 + height -1;</span>
00375 <span class="comment">int bufferX2 = bufferX1 + width -1;</span>
00376 <span class="comment">int bufferY2 = bufferY1 + height -1;</span>
00377 <span class="comment"></span>
00378 <span class="comment">// -------- draw background ---------//</span>
00379 <span class="comment"></span>
00380 <span class="comment">if( is_front )</span>
00381 <span class="comment">mouse.hide_area(x1, y1, x2, y2 );</span>
00382 <span class="comment"></span>
00383 <span class="comment">IMGbltRemap( destPtr, destPitch, bufferX1, bufferY1, bgPtr, default_remap_table);</span>
00384 <span class="comment"></span>
00385 <span class="comment">const barLeftMargin = 5;</span>
00386 <span class="comment">const barRightMargin = 5;</span>
00387 <span class="comment">const barTopMargin = 5;</span>
00388 <span class="comment">const barBottomMargin = 5;</span>
00389 <span class="comment"></span>
00390 <span class="comment">// ---------- draw energy bar ----------//</span>
00391 <span class="comment"></span>
00392 <span class="comment">if( curValue &gt; maxValue )</span>
00393 <span class="comment">curValue = maxValue;</span>
00394 <span class="comment">int barWidth = int( (width - barLeftMargin - barRightMargin ) * curValue / maxValue);</span>
00395 <span class="comment">int barX1 = bufferX1 + barLeftMargin;</span>
00396 <span class="comment">int barX2 = barX1 + barWidth - 1;</span>
00397 <span class="comment">int barHeight = height - (barTopMargin + barBottomMargin);</span>
00398 <span class="comment">int barY1 = bufferY1 + barTopMargin;</span>
00399 <span class="comment"></span>
00400 <span class="comment">unsigned int lc = 0;</span>
00401 <span class="comment">static unsigned char lineColor[8] =</span>
00402 <span class="comment">{ VGA_LIGHT_BLUE, VGA_LIGHT_BLUE+1, VGA_DARK_BLUE, VGA_LIGHT_BLUE+2,</span>
00403 <span class="comment">VGA_DARK_BLUE+1, VGA_LIGHT_BLUE+3, VGA_DARK_BLUE+2, VGA_DARK_BLUE+3 };</span>
00404 <span class="comment"></span>
00405 <span class="comment">if( barWidth &gt; 0 )</span>
00406 <span class="comment">{</span>
00407 <span class="comment">if(barHeight &gt;= 8)</span>
00408 <span class="comment">{</span>
00409 <span class="comment">int bY1 = barY1;</span>
00410 <span class="comment">for( int c = 0; c &lt; 8; ++c)</span>
00411 <span class="comment">{</span>
00412 <span class="comment">int bY2 = bY1 + (lc+ barHeight -1)/8;</span>
00413 <span class="comment">IMGbar(destPtr, destPitch, barX1, bY1, barX2, bY2, translate_color(lineColor[c]) );</span>
00414 <span class="comment">lc += barHeight;</span>
00415 <span class="comment">bY1 += lc / 8;</span>
00416 <span class="comment">lc %= 8;</span>
00417 <span class="comment">}</span>
00418 <span class="comment">}</span>
00419 <span class="comment">else</span>
00420 <span class="comment">{</span>
00421 <span class="comment">for( int y = 0; y &lt; barHeight; ++y)</span>
00422 <span class="comment">{</span>
00423 <span class="comment">int c = lc/barHeight;</span>
00424 <span class="comment">IMGbar(destPtr, destPitch, barX1, barY1+y, barX2, barY1+y, translate_color(lineColor[c]));</span>
00425 <span class="comment">lc += 8;</span>
00426 <span class="comment">}</span>
00427 <span class="comment">}</span>
00428 <span class="comment">}</span>
00429 <span class="comment"></span>
00430 <span class="comment">// ---------- display value ----------//</span>
00431 <span class="comment"></span>
00432 <span class="comment">if( barType &amp; 3)</span>
00433 <span class="comment">{</span>
00434 <span class="comment">String str;</span>
00435 <span class="comment"></span>
00436 <span class="comment">if( barType &amp; 1)</span>
00437 <span class="comment">str  = (int) curValue;</span>
00438 <span class="comment">if( barType &amp; 2)</span>
00439 <span class="comment">{</span>
00440 <span class="comment">str += "/";</span>
00441 <span class="comment">str += (int) maxValue;</span>
00442 <span class="comment">}</span>
00443 <span class="comment"></span>
00444 <span class="comment">font_hitpoint.center_put_to_bufferW( destPtr, destPitch, bufferX1, bufferY1, bufferX2, bufferY2, str);</span>
00445 <span class="comment">}</span>
00446 <span class="comment"></span>
00447 <span class="comment">if(barType &amp; 8)</span>
00448 <span class="comment">{</span>
00449 <span class="comment">put_bitmapW(x1, y1, tempBuffer);</span>
00450 <span class="comment">}</span>
00451 <span class="comment">// ---------------------------------- //</span>
00452 <span class="comment"></span>
00453 <span class="comment">if( is_front )</span>
00454 <span class="comment">mouse.show_area();</span>
00455 <span class="comment"></span>
00456 <span class="comment">}</span>
00457 <span class="comment">//------------- End of function VgaBuf::indicator --------------//</span>
00458 <span class="comment"></span>
00459 <span class="comment">//------------- Start of function VgaBuf::v_indicator --------------//</span>
00460 <span class="comment">//</span>
00461 <span class="comment">// Vertical indicator, all parameters are same as indicator() except</span>
00462 <span class="comment">// it is vertical.</span>
00463 <span class="comment">//</span>
00464 <span class="comment">// &lt;int&gt;   x1, y1, x2, y2 = coordination of the indicator</span>
00465 <span class="comment">// &lt;float&gt; curValue       = the value of the bar</span>
00466 <span class="comment">// &lt;float&gt; maxValue       = max value, the bar width = maxBarWidth * curValue / maxValue</span>
00467 <span class="comment">// &lt;int&gt;   indiColor      = color of the indicator</span>
00468 <span class="comment">// [int]   backColor      = background color</span>
00469 <span class="comment">//                          (default : vga.color_down)</span>
00470 <span class="comment">//</span>
00471 <span class="comment">void VgaBuf::v_indicator(int x1, int y1, int x2, int y2, float curValue,</span>
00472 <span class="comment">float maxValue, int indiColor, int backColor)</span>
00473 <span class="comment">{</span>
00474 <span class="comment">if( backColor == -1 )</span>
00475 <span class="comment">backColor = color_down;</span>
00476 <span class="comment"></span>
00477 <span class="comment">if( curValue &gt; 0 )</span>
00478 <span class="comment">{</span>
00479 <span class="comment">int barHeight = (int) ((float)(y2-y1) * curValue / maxValue);</span>
00480 <span class="comment"></span>
00481 <span class="comment">int halfWidth = (x2-x1+1)/2-1;</span>
00482 <span class="comment">int ty1        = max(y2-barHeight,y1); // when curValue&gt;0, even the actual bar width &lt; 1, one pixel will also be painted</span>
00483 <span class="comment">int x;</span>
00484 <span class="comment"></span>
00485 <span class="comment">indiColor+=halfWidth;</span>
00486 <span class="comment"></span>
00487 <span class="comment">for( x=x1 ; x&lt;x1+halfWidth ; x++, indiColor-- )</span>
00488 <span class="comment">bar( x, ty1, x, y2, indiColor );</span>
00489 <span class="comment"></span>
00490 <span class="comment">for( ; x&lt;=x2 ; x++, indiColor++ )</span>
00491 <span class="comment">bar( x, ty1, x, y2, indiColor );</span>
00492 <span class="comment"></span>
00493 <span class="comment">if( y1 &lt; y2-barHeight )</span>
00494 <span class="comment">bar( x1, y1, x2, y2-barHeight-1, backColor );</span>
00495 <span class="comment">}</span>
00496 <span class="comment">else</span>
00497 <span class="comment">{</span>
00498 <span class="comment">bar( x1, y1, x2, y2, backColor );</span>
00499 <span class="comment">}</span>
00500 <span class="comment">}</span>
00501 <span class="comment">//--------------- End of function VgaBuf::v_indicator --------------//</span>
00502 <span class="comment">*/</span>
00503 
00504 <span class="comment">//---------- Begin of function VgaBuf::line -------------//</span>
<a name="l00511"></a><a class="code" href="classVgaBuf.html#a34">00511</a> <span class="comment">void VgaBuf::line(int x1,int y1,int x2,int y2,int lineColor) {</span>
00512     <span class="keywordflow">if</span>( is_front )
00513         mouse.hide_area( x1,y1,x2,y2 );               <span class="comment">// if the mouse cursor is in that area, hide it</span>
00514 
00515     <a class="code" href="IMGFUN_8H.html#a7">IMGline</a>(buf_ptr(), buf_true_pitch(), buf_width(), buf_height(), x1, y1, x2, y2, lineColor);
00516 
00517     <span class="keywordflow">if</span>( is_front )
00518         mouse.show_area();
00519 }
00520 
00521 <span class="comment">//------------ End of function VgaBuf::line -------------//</span>
00522 
00523 <span class="comment">//---------- Begin of function VgaBuf::thick_line -------------//</span>
<a name="l00530"></a><a class="code" href="classVgaBuf.html#a35">00530</a> <span class="comment">void VgaBuf::thick_line(int x1,int y1,int x2,int y2,int lineColor) {</span>
00531     <a class="code" href="ALL_8H.html#a0">err_when</a>( x1&lt;0 || y1&lt;0 || x2&gt;=<a class="code" href="OVGA_8H.html#a0">VGA_WIDTH</a> || y2&gt;=<a class="code" href="OVGA_8H.html#a1">VGA_HEIGHT</a> );
00532 
00533     <span class="keywordflow">if</span>( is_front )
00534         mouse.hide_area( x1,y1,x2,y2 );               <span class="comment">// if the mouse cursor is in that area, hide it</span>
00535 
00536     <span class="keywordflow">if</span>( y1-y2 &gt; abs(x2-x1) ) {                      <span class="comment">// keep thickness of the line to 3</span>
00537         <a class="code" href="IMGFUN_8H.html#a7">IMGline</a>(buf_ptr(), buf_true_pitch(), buf_width(), buf_height(), x1  , y1-1, x2  , y2-1, lineColor );
00538         <a class="code" href="IMGFUN_8H.html#a7">IMGline</a>(buf_ptr(), buf_true_pitch(), buf_width(), buf_height(), x1  , y1  , x2  , y2  , lineColor );
00539         <a class="code" href="IMGFUN_8H.html#a7">IMGline</a>(buf_ptr(), buf_true_pitch(), buf_width(), buf_height(), x1  , y1+1, x2  , y2+1, lineColor );
00540         <a class="code" href="IMGFUN_8H.html#a7">IMGline</a>(buf_ptr(), buf_true_pitch(), buf_width(), buf_height(), x1+1, y1+1, x2+1, y2+1, lineColor );
00541     }
00542 
00543     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( y2-y1 &gt; abs(x2-x1) ) {
00544         <a class="code" href="IMGFUN_8H.html#a7">IMGline</a>(buf_ptr(), buf_true_pitch(), buf_width(), buf_height(), x1+1, y1-1, x2+1, y2-1, lineColor );
00545         <a class="code" href="IMGFUN_8H.html#a7">IMGline</a>(buf_ptr(), buf_true_pitch(), buf_width(), buf_height(), x1  , y1-1, x2  , y2-1, lineColor );
00546         <a class="code" href="IMGFUN_8H.html#a7">IMGline</a>(buf_ptr(), buf_true_pitch(), buf_width(), buf_height(), x1  , y1  , x2  , y2  , lineColor );
00547         <a class="code" href="IMGFUN_8H.html#a7">IMGline</a>(buf_ptr(), buf_true_pitch(), buf_width(), buf_height(), x1  , y1+1, x2  , y2+1, lineColor );
00548     }
00549 
00550     <span class="keywordflow">else</span> {
00551         <a class="code" href="IMGFUN_8H.html#a7">IMGline</a>(buf_ptr(), buf_true_pitch(), buf_width(), buf_height(), x1, y1-1, x2, y2-1, lineColor );
00552         <a class="code" href="IMGFUN_8H.html#a7">IMGline</a>(buf_ptr(), buf_true_pitch(), buf_width(), buf_height(), x1, y1  , x2, y2  , lineColor );
00553         <a class="code" href="IMGFUN_8H.html#a7">IMGline</a>(buf_ptr(), buf_true_pitch(), buf_width(), buf_height(), x1, y1+1, x2, y2+1, lineColor );
00554     }
00555 
00556     <span class="keywordflow">if</span>( is_front )
00557         mouse.show_area();
00558 }
00559 
00560 <span class="comment">//------------ End of function VgaBuf::thick_line -------------//</span>
00561 
00562 <span class="comment">//----------- Begin of function VgaBuf::d3_panel_up ------------//</span>
<a name="l00577"></a><a class="code" href="classVgaBuf.html#a41">00577</a> <span class="comment">void VgaBuf::d3_panel_up(int x1,int y1,int x2,int y2,int t,int paintCentre, char* tileName) {</span>
00578     <a class="code" href="ALL_8H.html#a0">err_when</a>( x1&gt;x2 || y1&gt;y2 || x1&lt;0 || y1&lt;0 || x2&gt;=<a class="code" href="OVGA_8H.html#a0">VGA_WIDTH</a> || y2&gt;=<a class="code" href="OVGA_8H.html#a1">VGA_HEIGHT</a> );
00579 
00580     <span class="keywordflow">if</span>(sys.no_true_output_flag)
00581         <span class="keywordflow">if</span>( is_front )
00582             <span class="keywordflow">return</span>;
00583     <span class="keywordflow">if</span>( is_front )
00584         mouse.hide_area( x1,y1,x2,y2 );
00585 
00586     <span class="comment">//------------------------------------------------//</span>
00587 
00588     <span class="keywordflow">if</span>( paintCentre )
00589     {
00590         <span class="keywordflow">if</span>( tileName )
00591             tile( x1+t, y1+t, x2-t, y2-t, tileName);
00592         <span class="keywordflow">else</span>
00593             bar_fast(x1+t, y1+t, x2-t, y2-t, 193<span class="comment">/*color_up*/</span> );  <span class="comment">// center</span>
00594     }
00595 
00596     <span class="keywordtype">int</span> i, x, y;
00597 
00598     <span class="keywordflow">for</span>( i=t-1, y=y1+t-1 ; y&gt;=y1 ; y--,i-- )
00599         bar_fast( x1+i,y,x2-i,y, i==0?V_WHITE:193<span class="comment">//color_light </span>
00600             );     <span class="comment">// top side</span>
00601 
00602     <span class="keywordflow">for</span>( i=t-1, x=x1+t-1 ; x&gt;=x1 ; x--,i-- )
00603         bar_fast( x,y1+i,x,y2-i, i==0?V_WHITE:193 );     <span class="comment">// left side</span>
00604 
00605     <span class="keywordflow">for</span>( i=t-1, y=y2-t+1 ; y&lt;=y2 ; y++,i-- )
00606         bar_fast( x1+i,y,x2-i,y, i==0?color_dark+2:color_dark-2 );   <span class="comment">// bottom side</span>
00607 
00608     <span class="keywordflow">for</span>( i=t-1, x=x2-t+1 ; x&lt;=x2 ; x++,i-- )                          <span class="comment">// right side</span>
00609         bar_fast( x,y1+i,x,y2-i, i==0?color_dark+2:color_dark-2 );
00610 
00611     <span class="comment">//-------------------------------------------//</span>
00612 
00613     <span class="keywordflow">if</span>( is_front )
00614         mouse.show_area();
00615 }
00616 <span class="comment">//------------- End of function VgaBuf::d3_panel_up ------------//</span>
00617 
00618 
00619 <span class="comment">//----------- Begin of function VgaBuf::d3_panel_down ------------//</span>
<a name="l00632"></a><a class="code" href="classVgaBuf.html#a42">00632</a> <span class="comment">void VgaBuf::d3_panel_down(int x1,int y1,int x2,int y2,int t,int paintCentre, char* tileName)</span>
00633 {
00634     <a class="code" href="ALL_8H.html#a0">err_when</a>( x1&gt;x2 || y1&gt;y2 || x1&lt;0 || y1&lt;0 || x2&gt;=<a class="code" href="OVGA_8H.html#a0">VGA_WIDTH</a> || y2&gt;=<a class="code" href="OVGA_8H.html#a1">VGA_HEIGHT</a> );
00635 
00636     <span class="keywordflow">if</span>(sys.no_true_output_flag)
00637         <span class="keywordflow">if</span>( is_front )
00638             <span class="keywordflow">return</span>;
00639 
00640     <span class="keywordflow">if</span>( is_front )
00641         mouse.hide_area( x1,y1,x2,y2 );
00642 
00643     <span class="comment">//---------- main center area -----------//</span>
00644 
00645     <span class="comment">// ####### begin Gilbert 12/7 ##########//</span>
00646     <span class="keywordflow">if</span>( paintCentre )
00647     {
00648         <span class="keywordflow">if</span>( tileName )
00649             tile( x1+t, y1+t, x2-t, y2-t, tileName );
00650         <span class="keywordflow">else</span>
00651             bar_fast(x1+t, y1+t, x2-t, y2-t, color_down );  <span class="comment">// center</span>
00652     }
00653 
00654     <span class="keywordflow">if</span>( t == 2 ) <span class="comment">// when thickness==2, use four different color for the down panel</span>
00655     {
00656         <span class="comment">// outer lines</span>
00657 
00658         bar_fast( x1,y1,x2-1,y1,color_scheme+8  );     <span class="comment">// top</span>
00659         bar_fast( x1+1,y2,x2,y2,<a class="code" href="COLOR_8H.html#a17">V_WHITE</a>         );     <span class="comment">// bottom</span>
00660         bar_fast( x1,y1,x1,y2-1,color_scheme+8  );     <span class="comment">// left</span>
00661         bar_fast( x2,y1+1,x2,y2,<a class="code" href="COLOR_8H.html#a17">V_WHITE</a>         );     <span class="comment">// right</span>
00662 
00663         <span class="comment">// inner lines</span>
00664 
00665         bar_fast( x1+1,y1+1,x2-1,y1+1,color_scheme+15 );  <span class="comment">// bottom</span>
00666         bar_fast( x1+1,y2-1,x2-1,y2-1,color_scheme+1  );  <span class="comment">// top</span>
00667         bar_fast( x1+1,y1+1,x1+1,y2-1,color_scheme+15 );  <span class="comment">// left</span>
00668         bar_fast( x2-1,y1+1,x2-1,y2-1,color_scheme+1  );  <span class="comment">// right</span>
00669     }
00670     <span class="keywordflow">else</span>         <span class="comment">// one unit thickness</span>
00671     {
00672         <span class="keywordtype">int</span> i, x, y;
00673 
00674         <span class="keywordflow">for</span>( i=t-1, y=y2-t+1 ; y&lt;=y2 ; y++,i-- )
00675             bar_fast( x1+i,y,x2-i,y,i==0?V_WHITE:color_light );     <span class="comment">// bottom</span>
00676 
00677         <span class="keywordflow">for</span>( i=t-1, x=x2-t+1 ; x&lt;=x2 ; x++,i-- )          <span class="comment">// left</span>
00678             bar_fast( x,y1+i,x2,y2-i,i==0?V_WHITE:color_light );     <span class="comment">// right</span>
00679 
00680         <span class="keywordflow">for</span>( i=t-1, y=y1+t-1 ; y&gt;=y1 ; y--,i-- )          <span class="comment">// top</span>
00681             bar_fast( x1+i,y,x2-i,y,i==0?color_dark+2:color_dark-2 );
00682 
00683         <span class="keywordflow">for</span>( i=t-1, x=x1+t-1 ; x&gt;=x1 ; x--,i-- )          <span class="comment">// left</span>
00684             bar_fast( x,y1+i,x,y2-i,i==0?color_dark+2:color_dark-2 );
00685     }
00686 
00687     <span class="comment">//----------- show mouse ----------//</span>
00688 
00689     <span class="keywordflow">if</span>( is_front )
00690         mouse.show_area();
00691 }
00692 <span class="comment">//------------- End of function VgaBuf::d3_panel_down ------------//</span>
00693 
00694 
00695 <span class="comment">//----------- Begin of function VgaBuf::d3_panel_up_clear ------------//</span>
<a name="l00705"></a><a class="code" href="classVgaBuf.html#a43">00705</a> <span class="comment">void VgaBuf::d3_panel_up_clear(int x1,int y1,int x2,int y2,int t, char *tileName)</span>
00706 {
00707     <span class="keywordflow">if</span>(sys.no_true_output_flag)
00708         <span class="keywordflow">if</span>( is_front )
00709             <span class="keywordflow">return</span>;
00710 
00711     <span class="keywordflow">if</span>( tileName )
00712         tile( x1+t, y1+t, x2-t, y2-t, tileName );
00713     <span class="keywordflow">else</span>
00714         bar(x1+t, y1+t, x2-t, y2-t, color_up );
00715 }
00716 <span class="comment">//------------- End of function VgaBuf::d3_panel_up_clear ------------//</span>
00717 
00718 
00719 <span class="comment">//----------- Begin of function VgaBuf::d3_panel_down_clear ------------//</span>
<a name="l00729"></a><a class="code" href="classVgaBuf.html#a44">00729</a> <span class="comment">void VgaBuf::d3_panel_down_clear(int x1,int y1,int x2,int y2,int t, char *tileName)</span>
00730 {
00731     <span class="keywordflow">if</span>(sys.no_true_output_flag)
00732         <span class="keywordflow">if</span>( is_front )
00733             <span class="keywordflow">return</span>;
00734     <span class="keywordflow">if</span>( tileName )
00735         tile( x1+t, y1+t, x2-t, y2-t, tileName );
00736     <span class="keywordflow">else</span>
00737         bar(x1+t, y1+t, x2-t, y2-t, color_down );
00738 }
00739 <span class="comment">//------------- End of function VgaBuf::d3_panel_down_clear ------------//</span>
00740 
00741 
00742 <span class="comment">//----------- Begin of function VgaBuf::adjust_brightness ------------//</span>
<a name="l00750"></a><a class="code" href="classVgaBuf.html#a46">00750</a> <span class="comment">void VgaBuf::adjust_brightness(int x1,int y1,int x2,int y2,int adjustDegree)</span>
00751 {
00752     <span class="keywordflow">if</span>( is_front )
00753         mouse.hide_area( x1,y1,x2,y2 );
00754 
00755 <span class="preprocessor">#if( MAX_BRIGHTNESS_ADJUST_DEGREE &gt; 10 )</span>
00756 <span class="preprocessor"></span>    adjustDegree *= <a class="code" href="OVGA_8H.html#a3">MAX_BRIGHTNESS_ADJUST_DEGREE</a> / 10;
00757 <span class="preprocessor">#endif</span>
00758 <span class="preprocessor"></span>
00759     <a class="code" href="ALL_8H.html#a0">err_when</a>( adjustDegree &lt; -<a class="code" href="OVGA_8H.html#a3">MAX_BRIGHTNESS_ADJUST_DEGREE</a> ||
00760               adjustDegree &gt;  <a class="code" href="OVGA_8H.html#a3">MAX_BRIGHTNESS_ADJUST_DEGREE</a> );
00761 
00762 <span class="comment">//      unsigned char* colorRemapTable = vga.vga_color_table-&gt;get_table(adjustDegree);</span>
00763 <span class="comment">//      remap_bar(x1, y1, x2, y2, colorRemapTable);</span>
00764     <a class="code" href="IMGFUN_8H.html#a29">IMGbrightBar</a>( buf_ptr(), buf_true_pitch(), x1, y1, x2, y2, adjustDegree);
00765 
00766     <span class="keywordflow">if</span>( is_front )
00767         mouse.show_area();
00768 }
00769 <span class="comment">//------------- End of function VgaBuf::adjust_brightness ------------//</span>
00770 
00771 
00772 <span class="comment">//----------- Begin of function VgaBuf::blt_buf_bright ----------//</span>
<a name="l00776"></a><a class="code" href="classVgaBuf.html#a95">00776</a> <span class="comment">void VgaBuf::blt_buf_bright( VgaBuf *srcBuf, int srcX1, int srcY1, int srcX2, int srcY2, int adjustDegree)</span>
00777 {
00778 <span class="preprocessor">#if( MAX_BRIGHTNESS_ADJUST_DEGREE &gt; 10 )</span>
00779 <span class="preprocessor"></span>    adjustDegree *= <a class="code" href="OVGA_8H.html#a3">MAX_BRIGHTNESS_ADJUST_DEGREE</a> / 10;
00780 <span class="preprocessor">#endif</span>
00781 <span class="preprocessor"></span>
00782     <a class="code" href="ALL_8H.html#a0">err_when</a>( adjustDegree &lt; -<a class="code" href="OVGA_8H.html#a3">MAX_BRIGHTNESS_ADJUST_DEGREE</a> ||
00783               adjustDegree &gt;  <a class="code" href="OVGA_8H.html#a3">MAX_BRIGHTNESS_ADJUST_DEGREE</a> );
00784 
00785     <a class="code" href="IMGFUN_8H.html#a28">IMGcopyWbright</a>( buf_ptr(), buf_true_pitch(), srcBuf-&gt;buf_ptr(), srcBuf-&gt;buf_true_pitch(), srcX1, srcY1, srcX2, srcY2, adjustDegree); 
00786 }
00787 <span class="comment">//----------- End of function VgaBuf::blt_buf_bright ----------//</span>
00788 
00789 
00790 <span class="comment">//------------- Begin of function VgaBuf::blt_buf ------------//</span>
<a name="l00792"></a><a class="code" href="classVgaBuf.html#a93">00792</a> <span class="comment">void VgaBuf::blt_buf( VgaBuf *srcBuf, int x1, int y1 )</span>
00793 {
00794     <span class="keywordtype">short</span> *srcPtr = srcBuf-&gt;buf_ptr();
00795     <span class="keywordtype">int</span> srcWidth = srcBuf-&gt;buf_width();
00796     <span class="keywordtype">int</span> srcPitch = srcBuf-&gt;buf_true_pitch();
00797     <span class="keywordtype">int</span> srcHeight = srcBuf-&gt;buf_height();
00798     <span class="keywordtype">short</span> *destPtr = buf_ptr();
00799     <span class="keywordtype">int</span> destPitch = buf_true_pitch();
00800 
00801     _asm
00802         {
00803             mov eax, y1
00804                 imul    destPitch
00805                 add     eax, x1
00806                 add     eax, x1
00807                 mov     edi, eax
00808                 add     edi, destPtr
00809 
00810                 mov     esi, srcPtr
00811 
00812                 mov     ecx, srcHeight
00813                 blt_buf_1:
00814             push        ecx
00815                 push    esi
00816                 push    edi
00817                 mov     ecx, srcWidth
00818                 rep movsw
00819                 pop     edi
00820                 pop     esi
00821                 pop     ecx
00822                 add     edi, destPitch
00823                 add     esi, srcPitch
00824                 loop    blt_buf_1
00825                 }
00826 }
00827 <span class="comment">//------------- End of function VgaBuf::blt_buf ------------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:35 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
