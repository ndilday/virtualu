<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OGRPH_PM.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>OGRPH_PM.CPP</h1><a href="OGRPH__PM_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OGRPH_PM.CPP</span>
00002 <span class="comment">//Description : Object GraphPerformanceIndicatorMonth</span>
00003 <span class="comment">//Owner                 : Kevin(Ho)</span>
00004 
00005 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;<a class="code" href="COLOR_8H.html">COLOR.H</a>&gt;</span>
00007 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>
00008 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00010 <span class="preprocessor">#include &lt;OFONT.H&gt;</span>
00011 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00012 <span class="preprocessor">#include &lt;<a class="code" href="OGRPH__PM_8H.html">OGRPH_PM.H</a>&gt;</span>
00013 <span class="preprocessor">#include &lt;OIFACE.H&gt;</span>
00014 
00015 <span class="preprocessor">#include &lt;math.h&gt;</span>
00016 
00017 <span class="comment">//--------- Define macro constant -----------//</span>
00018 
<a name="l00019"></a><a class="code" href="OGRPH__PM_8CPP.html#a0">00019</a> <span class="preprocessor">#define MAX_LEN_LABEL "0%"</span>
00020 <span class="preprocessor"></span>
00021 <span class="keyword">static</span> <span class="keywordtype">int</span> default_series_color[] = {
00022     <a class="code" href="COLOR_8H.html#a21">V_BLUE</a>,
00023     <a class="code" href="COLOR_8H.html#a18">V_ORANGE</a>,
00024     <a class="code" href="COLOR_8H.html#a22">V_VIOLET</a>,
00025     <a class="code" href="COLOR_8H.html#a15">V_BLACK</a>,
00026     <a class="code" href="COLOR_8H.html#a20">V_GREEN</a>,
00027     <a class="code" href="COLOR_8H.html#a25">V_YELLOW</a>,
00028     <a class="code" href="COLOR_8H.html#a23">V_BROWN</a>,
00029     <a class="code" href="COLOR_8H.html#a18">V_ORANGE</a>,
00030     <a class="code" href="COLOR_8H.html#a24">V_PINK</a>,
00031     <a class="code" href="COLOR_8H.html#a15">V_BLACK</a>,
00032     <a class="code" href="COLOR_8H.html#a17">V_WHITE</a>,
00033 };                                                <span class="comment">// 10 default series colors</span>
00034 
00035 <span class="keyword">enum</span> {  <a class="code" href="OGRPH__PM_8CPP.html#a7a2">DEFAULT_SERIES_COLOR_NUM</a> = 10 };
00036 
00037 <span class="keyword">enum</span> {
00038     <a class="code" href="OGRPH__PM_8CPP.html#a8a3">LEGEND_SIZE</a> = 11,
00039     <a class="code" href="OGRPH__PM_8CPP.html#a8a4">LEGEND_X_SPACING</a> = 12,
00040     <a class="code" href="OGRPH__PM_8CPP.html#a8a5">LEGEND_Y_SPACING</a> = 2,
00041 };
00042 
00043 <span class="keyword">enum</span> {  <a class="code" href="OGRPH__PM_8CPP.html#a9a6">COMMON_OFFSET</a> = 2         };
00044 
00045 <span class="comment">//-------------- Define static vars ------------//</span>
00046 
00047 <span class="comment">//static char paint_flag = 0;</span>
00048 
00049 <span class="comment">//-------- Begin of function GraphPerformanceIndicatorMonth::GraphPerformanceIndicatorMonth ----//</span>
<a name="l00051"></a><a class="code" href="classGraphPerformanceIndicatorMonth.html#a0">00051</a> <span class="comment">GraphPerformanceIndicatorMonth::GraphPerformanceIndicatorMonth() {</span>
00052     init_flag = 0;
00053     grapha_bitmap = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00054 }
00055 
00056 <span class="comment">//---------- End of function GraphPerformanceIndicatorMonth::GraphPerformanceIndicatorMonth ----//</span>
00057 
00058 <span class="comment">//-------- Begin of function GraphPerformanceIndicatorMonth::~GraphPerformanceIndicatorMonth -----//</span>
<a name="l00060"></a><a class="code" href="classGraphPerformanceIndicatorMonth.html#a1">00060</a> <span class="comment">GraphPerformanceIndicatorMonth::~GraphPerformanceIndicatorMonth() {</span>
00061     deinit();
00062 }
00063 
00064 <span class="comment">//---------- End of function GraphPerformanceIndicatorMonth::~GraphPerformanceIndicatorMonth -----//</span>
00065 
00066 <span class="comment">//-------- Begin of function GraphPerformanceIndicatorMonth::init --------//</span>
00089 <span class="comment">void GraphPerformanceIndicatorMonth::init(int x1, int y1, int x2, int y2,</span>
00090                                           <span class="keywordtype">int</span> seriesNum, <span class="keywordtype">int</span> *dataNum,
00091                                           <span class="keywordtype">void</span> *dataArray,
00092                                           <span class="keywordtype">char</span> dataTypeFlag,
00093                                           <span class="keywordtype">char</span> transparentFlag,
00094                                           <span class="keywordtype">char</span> valueFlag,
00095                                           <span class="keywordtype">int</span> numFormat, <span class="keywordtype">int</span> *seriesColor, <span class="keywordtype">int</span> axisColor) {
00096     <a class="code" href="ALL_8H.html#a0">err_when</a>(seriesNum &gt; <a class="code" href="OGRPH__PM_8CPP.html#a7a2">DEFAULT_SERIES_COLOR_NUM</a> &amp;&amp; !seriesColor);
00097     <a class="code" href="ALL_8H.html#a0">err_when</a>(seriesNum &lt;= 0);
00098 
00099     graph_width = x2 - x1 - 6;
00100 
00101     <a class="code" href="ALL_8H.html#a0">err_when</a>(graph_width &lt; 0);
00102 
00103     grapha_x1 = x1;
00104     grapha_y1 = y1;
00105     grapha_x2 = x2;
00106     grapha_y2 = y2;
00107     series_num = seriesNum;
00108     data_num = dataNum;
00109     data_array = dataArray;
00110     data_type_flag = dataTypeFlag;
00111     transparent_flag = transparentFlag;
00112     value_flag = valueFlag;
00113     num_format = numFormat;
00114     series_color = seriesColor ? seriesColor : default_series_color;
00115     axis_color = axisColor;
00116 
00117     init_flag = 1;
00118 
00119     <span class="keywordflow">if</span>(value_flag)
00120         y_label_max_len = font_chartsm.text_width(<a class="code" href="OGRPH__PM_8CPP.html#a0">MAX_LEN_LABEL</a>);
00121     <span class="keywordflow">else</span>
00122         y_label_max_len = 0;
00123     set_font(&amp;font_chartsm);
00124 
00125 }
00126 
00127 <span class="comment">//------------- End of function GraphPerformanceIndicatorMonth::init -----------//</span>
00128 
00129 <span class="comment">//-------- Begin of function GraphPerformanceIndicatorMonth::deinit ------------//</span>
<a name="l00131"></a><a class="code" href="classGraphPerformanceIndicatorMonth.html#a7">00131</a> <span class="comment">void GraphPerformanceIndicatorMonth::deinit() {</span>
00132     <span class="keywordflow">if</span> (grapha_bitmap) {
00133         <a class="code" href="ALL_8H.html#a8">mem_del</a>(grapha_bitmap);
00134         grapha_bitmap = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00135     }
00136 
00137     init_flag = 0;
00138 }
00139 
00140 <span class="comment">//------------- End of function GraphPerformanceIndicatorMonth::deinit ---------//</span>
00141 
00142 <span class="comment">//-------- Begin of function GraphPerformanceIndicatorMonth::set_font ------------//</span>
<a name="l00144"></a><a class="code" href="classGraphPerformanceIndicatorMonth.html#a10">00144</a> <span class="comment">void GraphPerformanceIndicatorMonth::set_font(Font *fontPtr) {</span>
00145     <span class="keywordflow">if</span> (!init_flag)
00146         <span class="keywordflow">return</span>;
00147 
00148     font_ptr = fontPtr;
00149 
00150     calc_pos();
00151 }
00152 
00153 <span class="comment">//------------- End of function GraphPerformanceIndicatorMonth::set_font ---------//</span>
00154 
00155 <span class="comment">//-------- Begin of function GraphPerformanceIndicatorMonth::calc_pos ------------//</span>
<a name="l00160"></a><a class="code" href="classGraphPerformanceIndicatorMonth.html#a11">00160</a> <span class="comment">void GraphPerformanceIndicatorMonth::calc_pos() {</span>
00161     graph_height = grapha_y2 - grapha_y1 ;
00162     <span class="keywordtype">short</span> YLabelWidth =  -<a class="code" href="OGRPH__PM_8CPP.html#a9a6">COMMON_OFFSET</a>;
00163     <span class="keywordtype">short</span> XLabelHeight = -<a class="code" href="OGRPH__PM_8CPP.html#a9a6">COMMON_OFFSET</a>;
00164     series_x1 = grapha_x1 + 4 + <a class="code" href="OGRPH__PM_8CPP.html#a9a6">COMMON_OFFSET</a>*2;
00165     series_y1 = grapha_y1 + 4 + <a class="code" href="OGRPH__PM_8CPP.html#a9a6">COMMON_OFFSET</a>*4;
00166     series_x2 = grapha_x2 - 4 - <a class="code" href="OGRPH__PM_8CPP.html#a9a6">COMMON_OFFSET</a>*2;
00167     series_y2 = grapha_y1 + graph_height - <a class="code" href="OGRPH__PM_8CPP.html#a9a6">COMMON_OFFSET</a>*2;
00168 }
00169 
00170 <span class="comment">//------------ End of function GraphPerformanceIndicatorMonth::calc_pos ---------//</span>
00171 
00172 <span class="comment">//-------- Begin of function GraphPerformanceIndicatorMonth::paint --------------//</span>
<a name="l00174"></a><a class="code" href="classGraphPerformanceIndicatorMonth.html#a8">00174</a> <span class="comment">void GraphPerformanceIndicatorMonth::paint() {</span>
00175     <span class="keywordflow">if</span> (transparent_flag) {
00176         vga.use_back();
00177 
00178         user_interface.brighten(grapha_x1+4, grapha_y1+4, grapha_x2-2, grapha_y2-2);
00179         grapha_bitmap = vga_back.save_area(grapha_x1+4, grapha_y1+4, grapha_x2-2, grapha_y2-2, grapha_bitmap);
00180     }
00181     <span class="comment">//  paint_flag = 1;</span>
00182     refresh();
00183 }
00184 
00185 <span class="comment">//------------- End of function GraphPerformanceIndicatorMonth::paint -----------//</span>
00186 
00187 <span class="comment">//-------- Begin of function GraphPerformanceIndicatorMonth::refresh ------------//</span>
<a name="l00189"></a><a class="code" href="classGraphPerformanceIndicatorMonth.html#a9">00189</a> <span class="comment">void GraphPerformanceIndicatorMonth::refresh() {</span>
00190     <span class="comment">//  vga.use_back();</span>
00191 
00192     <span class="keywordflow">if</span> (transparent_flag) {
00193         user_interface.rect(grapha_x1, grapha_y1, grapha_x2, grapha_y2, 1);
00194         vga_back.rest_area(grapha_bitmap, 0, 0);
00195     }
00196     <span class="keywordflow">else</span> {
00197         user_interface.bar(grapha_x1, grapha_y1, grapha_x2, grapha_y2);
00198         user_interface.panel(grapha_x1+3, grapha_y1+3, grapha_x2-4, grapha_y2-4);
00199     }
00200     draw_scale();
00201     draw_series();
00202 
00203     <span class="comment">//  if (!paint_flag)</span>
00204     <span class="comment">//          vga.blt_buf(grapha_x1, grapha_y1, grapha_x2+2, grapha_y2+2);</span>
00205     <span class="comment">//  else</span>
00206     <span class="comment">//          paint_flag = 0;</span>
00207 }
00208 
00209 <span class="comment">//------------- End of function GraphPerformanceIndicatorMonth::refresh ---------//</span>
00210 
00211 <span class="comment">//---------- Begin of function GraphPerformanceIndicatorMonth::find_scale -------------//</span>
<a name="l00213"></a><a class="code" href="classGraphPerformanceIndicatorMonth.html#b0">00213</a> <span class="comment">void GraphPerformanceIndicatorMonth::find_scale() {</span>
00214     <span class="keywordtype">double</span> data, maxVal = 0.0;
00215     x_axis_pos = 0;
00216 
00217     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num * *data_num; i++) {
00218         <span class="keywordflow">switch</span> (data_type_flag) {
00219         <span class="keywordflow">case</span> DATA_DOUBLE:
00220             data = ((<span class="keywordtype">double</span>*)data_array)[i];
00221             <span class="keywordflow">break</span>;
00222         <span class="keywordflow">case</span> DATA_FLOAT:
00223             data = double(((<span class="keywordtype">float</span>*)data_array)[i]);
00224             <span class="keywordflow">break</span>;
00225         <span class="keywordflow">case</span> DATA_INT:
00226             data = double(((<span class="keywordtype">int</span>*)data_array)[i]);
00227             <span class="keywordflow">break</span>;
00228         <span class="keywordflow">case</span> DATA_LONG:
00229             data = double(((<span class="keywordtype">long</span>*)data_array)[i]);
00230             <span class="keywordflow">break</span>;
00231         }
00232         <span class="keywordflow">if</span> (<a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(data) &gt; maxVal)
00233             maxVal = <a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(data);
00234         <span class="keywordflow">if</span> (!x_axis_pos &amp;&amp; data &lt; 0.0)
00235             x_axis_pos = 1;
00236     }
00237     <span class="keywordflow">if</span> (maxVal&gt;10)
00238         max_scale = maxVal;
00239     <span class="keywordflow">else</span>
00240         max_scale = 10;
00241 }
00242 
00243 <span class="comment">//------------ End of function GraphPerformanceIndicatorMonth::find_scale -------------//</span>
00244 
00245 <span class="comment">//---------- Begin of function GraphPerformanceIndicatorMonth::draw_scale -------------//</span>
<a name="l00247"></a><a class="code" href="classGraphPerformanceIndicatorMonth.html#b1">00247</a> <span class="comment">void GraphPerformanceIndicatorMonth::draw_scale() {</span>
00248     find_scale();
00249     <span class="comment">//------ Draw y-axis -------//</span>
00250 
00251     <span class="keywordflow">if</span> (x_axis_pos)
00252         vga_back.bar(series_x1, series_y1-<a class="code" href="OGRPH__PM_8CPP.html#a9a6">COMMON_OFFSET</a>*2, series_x1+1, series_y2+<a class="code" href="OGRPH__PM_8CPP.html#a9a6">COMMON_OFFSET</a>*2, axis_color);
00253     <span class="keywordflow">else</span>
00254         vga_back.bar(series_x1, series_y1-<a class="code" href="OGRPH__PM_8CPP.html#a9a6">COMMON_OFFSET</a>*2, series_x1+1, series_y2, axis_color);
00255 
00256     <span class="comment">//------ Draw x-axis -------//</span>
00257     <span class="keywordtype">int</span> currY;
00258     <span class="keywordflow">if</span> (x_axis_pos)
00259         currY = series_y2 - short(((<span class="keywordtype">float</span>(max_scale)) * <span class="keywordtype">float</span>(series_y2-series_y1) / <span class="keywordtype">float</span>(max_scale*2)));
00260     <span class="keywordflow">else</span>
00261         currY = series_y2;
00262 
00263     <span class="comment">//  if (x_axis_pos)</span>
00264     <span class="comment">//          vga_back.bar(series_x1, series_y2+COMMON_OFFSET*2, series_x2-COMMON_OFFSET, series_y2+COMMON_OFFSET*2+1, axis_color);</span>
00265     <span class="comment">//  else</span>
00266     vga_back.bar(series_x1, currY, series_x2-<a class="code" href="OGRPH__PM_8CPP.html#a9a6">COMMON_OFFSET</a>, currY+1, axis_color);
00267 
00268     x_axis_step = (double)(series_x2-series_x1) / (*data_num-1);
00269 }
00270 
00271 <span class="comment">//------------ End of function GraphPerformanceIndicatorMonth::draw_scale -------------//</span>
00272 
00273 <span class="comment">//---------- Begin of function GraphPerformanceIndicatorMonth::draw_series ------------//</span>
<a name="l00275"></a><a class="code" href="classGraphPerformanceIndicatorMonth.html#b2">00275</a> <span class="comment">void GraphPerformanceIndicatorMonth::draw_series() {</span>
00276     <span class="keywordflow">switch</span> (data_type_flag) {
00277     <span class="keywordflow">case</span> DATA_FLOAT: draw_series_float(); <span class="keywordflow">break</span>;
00278     <span class="keywordflow">case</span> DATA_DOUBLE: draw_series_double(); <span class="keywordflow">break</span>;
00279     <span class="keywordflow">case</span> DATA_INT: draw_series_int(); <span class="keywordflow">break</span>;
00280     <span class="keywordflow">case</span> DATA_LONG: draw_series_long(); <span class="keywordflow">break</span>;
00281     }
00282 }
00283 
00284 <span class="comment">//------------ End of function GraphPerformanceIndicatorMonth::draw_series ------------//</span>
00285 
00286 <span class="comment">//---------- Begin of function GraphPerformanceIndicatorMonth::draw_series_float ------------//</span>
<a name="l00288"></a><a class="code" href="classGraphPerformanceIndicatorMonth.html#b3">00288</a> <span class="comment">void GraphPerformanceIndicatorMonth::draw_series_float() {</span>
00289     <span class="keywordtype">float</span> *dataArray = (<span class="keywordtype">float</span> *) data_array;
00290     <span class="keywordtype">short</span> prevX, prevY, currX, currY;
00291 
00292     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num; i++) {
00293         dataArray-=info.graph_month_passed;
00294         dataArray+=HISTORY_MONTH_COUNT;
00295         prevX = series_x1;
00296         <span class="keywordflow">if</span> (x_axis_pos)
00297             prevY = series_y2 - short(((*dataArray+<span class="keywordtype">float</span>(max_scale)) * <span class="keywordtype">float</span>(series_y2-series_y1) / <span class="keywordtype">float</span>(max_scale*2)));
00298         <span class="keywordflow">else</span>
00299             prevY = series_y2 - short(*dataArray * <span class="keywordtype">float</span>(series_y2-series_y1) / <span class="keywordtype">float</span>(max_scale));
00300 
00301         dataArray++;
00302 
00303         vga_back.thick_line(prevX-1, prevY, prevX+1, prevY, vga_back.translate_color(series_color[i]));
00304         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt; info.graph_month_passed; j++) {
00305             currX = series_x1 + (int)(x_axis_step*j);
00306             <span class="keywordflow">if</span> (x_axis_pos)
00307                 currY = series_y2 - short(((*dataArray+<span class="keywordtype">float</span>(max_scale)) * <span class="keywordtype">float</span>(series_y2-series_y1) / <span class="keywordtype">float</span>(max_scale*2)));
00308             <span class="keywordflow">else</span>
00309                 currY = series_y2 - short(*dataArray * <span class="keywordtype">float</span>(series_y2-series_y1) / <span class="keywordtype">float</span>(max_scale));
00310 
00311             vga_back.thick_line(prevX, prevY, currX, currY, vga_back.translate_color(series_color[i]));
00312 
00313             prevX = currX;
00314             prevY = currY;
00315             dataArray++;
00316         }
00317 
00318         <span class="keywordflow">if</span> (value_flag)
00319             draw_value(dataArray-1, vga_back.translate_color(<a class="code" href="COLOR_8H.html#a15">V_BLACK</a>), prevX+<a class="code" href="OGRPH__PM_8CPP.html#a9a6">COMMON_OFFSET</a>-(int)(0.3f*x_axis_step), prevY-font_ptr-&gt;max_font_height/2, DATA_FLOAT);
00320     }
00321 }
00322 
00323 <span class="comment">//------------ End of function GraphPerformanceIndicatorMonth::draw_series_float ------------//</span>
00324 
00325 <span class="comment">//---------- Begin of function GraphPerformanceIndicatorMonth::draw_series_double ------------//</span>
<a name="l00327"></a><a class="code" href="classGraphPerformanceIndicatorMonth.html#b4">00327</a> <span class="comment">void GraphPerformanceIndicatorMonth::draw_series_double() {</span>
00328     <span class="keywordtype">double</span> *dataArray = (<span class="keywordtype">double</span> *) data_array;
00329     <span class="keywordtype">short</span> prevX, prevY, currX, currY;
00330 
00331     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num; i++) {
00332         dataArray-=info.graph_month_passed;
00333         dataArray+=HISTORY_MONTH_COUNT;
00334         prevX = series_x1;
00335         <span class="keywordflow">if</span> (x_axis_pos)
00336             prevY = series_y2 - short(((*dataArray+max_scale) * <span class="keywordtype">double</span>(series_y2-series_y1) / (max_scale*2)));
00337         <span class="keywordflow">else</span>
00338             prevY = series_y2 - short(*dataArray * <span class="keywordtype">double</span>(series_y2-series_y1) / max_scale);
00339 
00340         dataArray++;
00341 
00342         vga_back.thick_line(prevX-1, prevY, prevX+1, prevY, vga_back.translate_color(series_color[i]));
00343         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt; info.graph_month_passed; j++) {
00344             currX = series_x1 + (int)(x_axis_step*j);
00345             <span class="keywordflow">if</span> (x_axis_pos)
00346                 currY = series_y2 - short(((*dataArray+max_scale) * <span class="keywordtype">double</span>(series_y2-series_y1) / (max_scale*2)));
00347             <span class="keywordflow">else</span>
00348                 currY = series_y2 - short(*dataArray * <span class="keywordtype">double</span>(series_y2-series_y1) / max_scale);
00349 
00350             vga_back.thick_line(prevX, prevY, currX, currY, vga_back.translate_color(series_color[i]));
00351 
00352             prevX = currX;
00353             prevY = currY;
00354             dataArray++;
00355         }
00356 
00357         <span class="keywordflow">if</span> (value_flag)
00358             draw_value(dataArray-1, vga_back.translate_color(<a class="code" href="COLOR_8H.html#a15">V_BLACK</a>), prevX+<a class="code" href="OGRPH__PM_8CPP.html#a9a6">COMMON_OFFSET</a>-(int)(0.3f*x_axis_step), prevY-font_ptr-&gt;max_font_height/2, DATA_DOUBLE);
00359     }
00360 }
00361 
00362 <span class="comment">//------------ End of function GraphPerformanceIndicatorMonth::draw_series_double ------------//</span>
00363 
00364 <span class="comment">//---------- Begin of function GraphPerformanceIndicatorMonth::draw_series_int ------------//</span>
<a name="l00366"></a><a class="code" href="classGraphPerformanceIndicatorMonth.html#b5">00366</a> <span class="comment">void GraphPerformanceIndicatorMonth::draw_series_int() {</span>
00367     <span class="keywordtype">int</span> *dataArray = (<span class="keywordtype">int</span> *) data_array;
00368     <span class="keywordtype">short</span> prevX, prevY, currX, currY;
00369 
00370     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num; i++) {
00371         dataArray-=info.graph_month_passed;
00372         dataArray+=HISTORY_MONTH_COUNT;
00373         prevX = series_x1;
00374         <span class="keywordflow">if</span> (x_axis_pos)
00375             prevY = series_y2 - ((*dataArray+int(max_scale)) * (series_y2-series_y1) / int(max_scale*2));
00376         <span class="keywordflow">else</span>
00377             prevY = series_y2 - *dataArray * (series_y2-series_y1) / int(max_scale);
00378 
00379         dataArray++;
00380 
00381         vga_back.thick_line(prevX-1, prevY, prevX+1, prevY, vga_back.translate_color(series_color[i]));
00382         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt; info.graph_month_passed; j++) {
00383             currX = series_x1 + (int)(x_axis_step*j);
00384             <span class="keywordflow">if</span> (x_axis_pos)
00385                 currY = series_y2 - ((*dataArray+int(max_scale)) * (series_y2-series_y1) / int(max_scale*2));
00386             <span class="keywordflow">else</span>
00387                 currY = series_y2 - *dataArray * (series_y2-series_y1) / int(max_scale);
00388 
00389             vga_back.thick_line(prevX, prevY, currX, currY, vga_back.translate_color(series_color[i]));
00390 
00391             prevX = currX;
00392             prevY = currY;
00393             dataArray++;
00394         }
00395 
00396         <span class="keywordflow">if</span> (value_flag)
00397             draw_value(dataArray-1, vga_back.translate_color(<a class="code" href="COLOR_8H.html#a15">V_BLACK</a>), prevX+<a class="code" href="OGRPH__PM_8CPP.html#a9a6">COMMON_OFFSET</a>-(int)(0.3f*x_axis_step), prevY-font_ptr-&gt;max_font_height/2, DATA_INT);
00398     }
00399 }
00400 
00401 <span class="comment">//------------ End of function GraphPerformanceIndicatorMonth::draw_series_int ------------//</span>
00402 
00403 <span class="comment">//---------- Begin of function GraphPerformanceIndicatorMonth::draw_series_long ------------//</span>
<a name="l00405"></a><a class="code" href="classGraphPerformanceIndicatorMonth.html#b6">00405</a> <span class="comment">void GraphPerformanceIndicatorMonth::draw_series_long() {</span>
00406     <span class="keywordtype">long</span> *dataArray = (<span class="keywordtype">long</span> *) data_array;
00407     <span class="keywordtype">short</span> prevX, prevY, currX, currY;
00408 
00409     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num; i++) {
00410         dataArray-=info.graph_month_passed;
00411         dataArray+=HISTORY_MONTH_COUNT;
00412         prevX = series_x1;
00413         <span class="keywordflow">if</span> (x_axis_pos)
00414             prevY = series_y2 - short(((*dataArray+<span class="keywordtype">long</span>(max_scale)) * <span class="keywordtype">long</span>(series_y2-series_y1) / <span class="keywordtype">long</span>(max_scale*2)));
00415         <span class="keywordflow">else</span>
00416             prevY = series_y2 - short(*dataArray * <span class="keywordtype">long</span>(series_y2-series_y1) / <span class="keywordtype">long</span>(max_scale));
00417 
00418         dataArray++;
00419 
00420         vga_back.thick_line(prevX-1, prevY, prevX+1, prevY, vga_back.translate_color(series_color[i]));
00421         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt; info.graph_month_passed; j++) {
00422             currX = series_x1 + (int)(x_axis_step*j);
00423             <span class="keywordflow">if</span> (x_axis_pos)
00424                 currY = series_y2 - short(((*dataArray+<span class="keywordtype">long</span>(max_scale)) * <span class="keywordtype">long</span>(series_y2-series_y1) / <span class="keywordtype">long</span>(max_scale*2)));
00425             <span class="keywordflow">else</span>
00426                 currY = series_y2 - short(*dataArray * <span class="keywordtype">long</span>(series_y2-series_y1) / <span class="keywordtype">long</span>(max_scale));
00427 
00428             vga_back.thick_line(prevX, prevY, currX, currY, vga_back.translate_color(series_color[i]));
00429 
00430             prevX = currX;
00431             prevY = currY;
00432             dataArray++;
00433         }
00434 
00435         <span class="keywordflow">if</span> (value_flag)
00436             draw_value(dataArray-1, vga_back.translate_color(<a class="code" href="COLOR_8H.html#a15">V_BLACK</a>), prevX+<a class="code" href="OGRPH__PM_8CPP.html#a9a6">COMMON_OFFSET</a>-(int)(0.3f*x_axis_step), prevY-font_ptr-&gt;max_font_height/2, DATA_LONG);
00437     }
00438 }
00439 
00440 <span class="comment">//------------ End of function GraphPerformanceIndicatorMonth::draw_series_float ------------//</span>
00441 
00442 <span class="comment">//---------- Begin of function GraphPerformanceIndicatorMonth::draw_value -------------------//</span>
<a name="l00444"></a><a class="code" href="classGraphPerformanceIndicatorMonth.html#b7">00444</a> <span class="comment">void GraphPerformanceIndicatorMonth::draw_value(void *value, int color, short x, short y, int dataType) {</span>
00445     <span class="keywordtype">char</span> *valueString;
00446     <span class="keywordflow">switch</span> (data_type_flag) {
00447     <span class="keywordflow">case</span> DATA_FLOAT:
00448         valueString = m.format(*((<span class="keywordtype">float</span> *) value), num_format); <span class="keywordflow">break</span>;
00449     <span class="keywordflow">case</span> DATA_DOUBLE:
00450         valueString = m.format(*((<span class="keywordtype">double</span> *) value), num_format); <span class="keywordflow">break</span>;
00451     <span class="keywordflow">case</span> DATA_INT:
00452         valueString = m.format(*((<span class="keywordtype">int</span> *) value), num_format); <span class="keywordflow">break</span>;
00453     <span class="keywordflow">case</span> DATA_LONG:
00454         valueString = m.format(*((<span class="keywordtype">long</span> *) value), num_format); <span class="keywordflow">break</span>;
00455     }
00456 
00457     <span class="keywordtype">short</span> textHeight = font_ptr-&gt;max_font_height;
00458     <span class="keywordtype">short</span> textWidth = font_ptr-&gt;text_width(valueString) + 1;
00459 
00460     <span class="comment">/*</span>
00461 <span class="comment">      short *bitmap = (short *) sys.common_data_buf;</span>
00462 <span class="comment">      err_when( (2 + textWidth * textHeight) * sizeof(short) &gt; COMMON_DATA_BUF_SIZE );</span>
00463 <span class="comment">      *bitmap++ = textWidth;</span>
00464 <span class="comment">      *bitmap++ = textHeight;</span>
00465 <span class="comment"></span>
00466 <span class="comment">      short *shortPtr = bitmap;</span>
00467 <span class="comment">      for (int i = 0; i &lt; textWidth * textHeight; i++)</span>
00468 <span class="comment">      *shortPtr++ = transparent_code_w;</span>
00469 <span class="comment"></span>
00470 <span class="comment">      font_ptr-&gt;put_to_bufferW(bitmap, textWidth * sizeof(short), 0, 0, valueString);</span>
00471 <span class="comment"></span>
00472 <span class="comment">      shortPtr = bitmap;</span>
00473 <span class="comment">      for (i = 0; i &lt; textWidth * textHeight; i++, shortPtr++)</span>
00474 <span class="comment">      if (*shortPtr != transparent_code_w)</span>
00475 <span class="comment">      *shortPtr = color;</span>
00476 <span class="comment"></span>
00477 <span class="comment">      vga_back.put_bitmapW_trans(x, y, (short *) sys.common_data_buf);</span>
00478 <span class="comment">    */</span>
00479     font_chartsm.put(x+3,y,valueString);
00480 }
00481 
00482 <span class="comment">//---------- End of function GraphPerformanceIndicatorMonth::draw_value -------------------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:51 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
