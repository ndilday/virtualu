<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ODEPTRES.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>ODEPTRES.CPP</h1><a href="ODEPTRES_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : ODEPTRES.CPP</span>
00002 <span class="comment">//Description : Department resource object</span>
00003 
00004 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00005 <span class="preprocessor">#include &lt;OMATH.H&gt;</span>
00006 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00007 <span class="preprocessor">#include &lt;<a class="code" href="OFIELD_8H.html">OFIELD.H</a>&gt;</span>
00008 <span class="preprocessor">#include &lt;<a class="code" href="OGAMESET_8H.html">OGAMESET.H</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;ODEPT.H&gt;</span>
00010 <span class="preprocessor">#include &lt;<a class="code" href="ODEPTRES_8H.html">ODEPTRES.H</a>&gt;</span>
00011 <span class="preprocessor">#include &lt;OSTUDENT.H&gt;</span>                             <span class="comment">// for enum   { SL_UG, SL_MASTER, SL_DOCTOR, SL_DISTANCE_LEARN };</span>
00012 <span class="preprocessor">#include &lt;<a class="code" href="OFIELD_8H.html">OFIELD.H</a>&gt;</span>                               <span class="comment">// for IPED_FILED_COUNT</span>
00013 <span class="preprocessor">#include &lt;<a class="code" href="OCOURRES_8H.html">OCOURRES.H</a>&gt;</span>                             <span class="comment">// template_course_type</span>
00014 <span class="preprocessor">#include &lt;opschool.h&gt;</span>
00015 
00016 <span class="comment">//---------- #define constant ------------//</span>
00017 
<a name="l00018"></a><a class="code" href="ODEPTRES_8CPP.html#a0">00018</a> <span class="preprocessor">#define DEPARTMENT_DB    "DEPT"</span>
<a name="l00019"></a><a class="code" href="ODEPTRES_8CPP.html#a1">00019</a> <span class="preprocessor"></span><span class="preprocessor">#define DEPARTMENT_DB2   "DEPT2"</span>
<a name="l00020"></a><a class="code" href="ODEPTRES_8CPP.html#a2">00020</a> <span class="preprocessor"></span><span class="preprocessor">#define DEPARTMENT_DB3   "FACILITY"</span>
00021 <span class="preprocessor"></span>
00022 <span class="comment">// db from HE.GDB.init</span>
<a name="l00023"></a><a class="code" href="ODEPTRES_8CPP.html#a3">00023</a> <span class="preprocessor">#define FACULTY_TRANSITION_PROBABILITY    "FAC_TRAN"</span>
<a name="l00024"></a><a class="code" href="ODEPTRES_8CPP.html#a4">00024</a> <span class="preprocessor"></span><span class="preprocessor">#define COURSE_UG_DB        "COUR_B"              // db from HE.GDB.init</span>
<a name="l00025"></a><a class="code" href="ODEPTRES_8CPP.html#a5">00025</a> <span class="preprocessor"></span><span class="preprocessor">#define COURSE_MASTER_DB    "COUR_M"</span>
<a name="l00026"></a><a class="code" href="ODEPTRES_8CPP.html#a6">00026</a> <span class="preprocessor"></span><span class="preprocessor">#define COURSE_DOCTOR_DB    "COUR_D"</span>
<a name="l00027"></a><a class="code" href="ODEPTRES_8CPP.html#a7">00027</a> <span class="preprocessor"></span><span class="preprocessor">#define ELECTIVE_PREF_DB    "ELECPREF"</span>
00028 <span class="preprocessor"></span>
00029 <span class="comment">//----------------------------------------------//</span>
00030 <span class="comment">//</span>
<a name="l00031"></a><a class="code" href="ODEPTRES_8CPP.html#a8">00031</a> <span class="keywordtype">void</span> <a class="code" href="ODEPTRES_8CPP.html#a8">change_templ_code</a>(<span class="keywordtype">char</span>* code) {
00032     <span class="keywordflow">switch</span> (code[0]) {
00033     <span class="keywordflow">case</span> <span class="charliteral">'S'</span>:
00034         code[0] = <span class="charliteral">'A'</span>;
00035         <span class="keywordflow">break</span>;
00036     <span class="keywordflow">case</span> <span class="charliteral">'N'</span>:
00037         code[0] = <span class="charliteral">'B'</span>;
00038         <span class="keywordflow">break</span>;
00039     <span class="keywordflow">case</span> <span class="charliteral">'M'</span>:
00040         code[0] = <span class="charliteral">'C'</span>;
00041         <span class="keywordflow">break</span>;
00042     <span class="keywordflow">case</span> <span class="charliteral">'H'</span>:
00043         code[0] = <span class="charliteral">'D'</span>;
00044         <span class="keywordflow">break</span>;
00045     <span class="keywordflow">case</span> <span class="charliteral">'O'</span>:
00046         code[0] = <span class="charliteral">'E'</span>;
00047         <span class="keywordflow">break</span>;
00048     <span class="keywordflow">default</span>:
00049         <a class="code" href="ALL_8H.html#a1">err_here</a>();
00050         <span class="keywordflow">break</span>;
00051     }
00052 }
00053 
00054 <span class="comment">//----------------------------------------------//</span>
00055 
00056 <span class="comment">//------- Begin of function DepartmentRes::DepartmentRes -----------//</span>
00057 
<a name="l00058"></a><a class="code" href="classDepartmentRes.html#a0">00058</a> <a class="code" href="classDepartmentRes.html#a0">DepartmentRes::DepartmentRes</a>() {
00059     <a class="code" href="classDepartmentRes.html#m0">init_flag</a>=0;
00060 }
00061 
00062 <span class="comment">//--------- End of function DepartmentRes::DepartmentRes -----------//</span>
00063 
00064 <span class="comment">//------- Begin of function DepartmentRes::DepartmentRes -----------//</span>
00065 
<a name="l00066"></a><a class="code" href="classDepartmentRes.html#a1">00066</a> <a class="code" href="classDepartmentRes.html#a1">DepartmentRes::~DepartmentRes</a>() {
00067     <a class="code" href="classDepartmentRes.html#a3">deinit</a>();
00068 }
00069 
00070 <span class="comment">//--------- End of function DepartmentRes::DepartmentRes -----------//</span>
00071 
00072 <span class="comment">//---------- Begin of function DepartmentRes::init -----------//</span>
<a name="l00076"></a><a class="code" href="classDepartmentRes.html#a2">00076</a> <span class="comment">void DepartmentRes::init() {</span>
00077     deinit();
00078 
00079     general_dept.init();
00080     memset(&amp;general_dept_info, 0, <span class="keyword">sizeof</span>(<a class="code" href="structDepartmentInfo.html">DepartmentInfo</a>));
00081 
00082     <span class="comment">//------- load database information --------//</span>
00083 
00084     load_info();
00085     load_faculty_info();
00086     load_course_info();
00087     load_elective_course_pref();
00088 
00089     init_flag=1;
00090 }
00091 
00092 <span class="comment">//---------- End of function DepartmentRes::init -----------//</span>
00093 
00094 <span class="comment">//---------- Begin of function DepartmentRes::deinit -----------//</span>
00095 
<a name="l00096"></a><a class="code" href="classDepartmentRes.html#a3">00096</a> <span class="keywordtype">void</span> <a class="code" href="classDepartmentRes.html#a3">DepartmentRes::deinit</a>() {
00097     <span class="keywordflow">if</span>( init_flag ) {
00098         <a class="code" href="ALL_8H.html#a8">mem_del</a>(<a class="code" href="classDepartmentRes.html#m2">info_array</a>);
00099 
00100         <a class="code" href="classDepartmentRes.html#m0">init_flag</a>=0;
00101     }
00102 
00103     <span class="comment">//----------------------------------// 990603</span>
00104 
00105     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=<a class="code" href="classDepartmentRes.html#m4">general_dept</a>.<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classDynArray.html#a28">size</a>() ; i&gt;0 ; i-- ) {
00106         <span class="keywordflow">if</span>( !<a class="code" href="classDepartmentRes.html#m4">general_dept</a>.<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#a9">is_deleted</a>(i) )
00107             <a class="code" href="classDepartmentRes.html#m4">general_dept</a>.<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#a5">del</a>(i);
00108     }
00109 
00110     <span class="comment">//----------------------------------//</span>
00111 
00112 }
00113 
00114 <span class="comment">//---------- End of function DepartmentRes::deinit -----------//</span>
00115 
00116 <span class="comment">//------- Begin of function DepartmentRes::load_info -------//</span>
00118 <span class="comment">void DepartmentRes::load_info() {</span>
00119     <a class="code" href="structDepartmentRec.html">DepartmentRec</a>  *deptRec;
00120     <a class="code" href="structDepartmentInfo.html">DepartmentInfo</a> *deptInfo;
00121     <a class="code" href="classDatabase.html">Database</a>    *dbDepartment = game_set.open_db(<a class="code" href="ODEPTRES_8CPP.html#a0">DEPARTMENT_DB</a>);
00122 
00123     department_count = (short) dbDepartment-&gt;<a class="code" href="classDatabase.html#a7">rec_count</a>();
00124     info_array      = (<a class="code" href="structDepartmentInfo.html">DepartmentInfo</a>*) <a class="code" href="ALL_8H.html#a5">mem_add</a>( <span class="keyword">sizeof</span>(<a class="code" href="structDepartmentInfo.html">DepartmentInfo</a>)*department_count );
00125 
00126     <a class="code" href="ALL_8H.html#a0">err_when</a>( department_count != DEPARTMENT_TYPE_COUNT );
00127 
00128     <span class="comment">//------ read in department information array -------//</span>
00129 
00130     memset( info_array, 0, <span class="keyword">sizeof</span>(<a class="code" href="structDepartmentInfo.html">DepartmentInfo</a>) * department_count );
00131 
00132     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;department_count ; i++ ) {
00133         deptRec   = (<a class="code" href="structDepartmentRec.html">DepartmentRec</a>*) dbDepartment-&gt;<a class="code" href="classDatabase.html#a4">read</a>(i+1);
00134         deptInfo  = info_array+i;
00135 
00136         <span class="keywordflow">if</span> (i+1==department_count)
00137             i=i;
00138 
00139         m.rtrim_fld( deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m0">name</a>, deptRec-&gt;<a class="code" href="structDepartmentRec.html#m0">name</a>, deptRec-&gt;<a class="code" href="structDepartmentRec.html#s1s0">NAME_LEN</a> );
00140 
00141         <span class="comment">//String str = deptInfo-&gt;name;</span>
00142         <span class="comment">//str += " Department";</span>
00143         <span class="comment">//strncpy(deptInfo-&gt;name, str, MAX_STR_LEN );</span>
00144 
00145         deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m1">field_id</a> = field_res.look_up_code( deptRec-&gt;<a class="code" href="structDepartmentRec.html#m1">field_code</a>[0] );
00146         <span class="comment">// deptInfo-&gt;total_courses_taught = m.atoi( deptRec-&gt;total_courses_taught, 9 );</span>
00147 
00148         <span class="comment">//0406 if ( deptInfo-&gt;total_courses_taught &lt;= 0 )</span>
00149         <span class="comment">//      deptInfo-&gt;total_courses_taught = 200;           // fix bug on fly               //1230: it's a place holder and is calculated during init course enrollment</span>
00150 
00151         deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m2">max_dl_class_size</a> = m.atoi( deptRec-&gt;<a class="code" href="structDepartmentRec.html#m3">max_dl_class_size</a>, 9 );
00152 
00153         deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m3">salary_multiplier</a>   = (float) m.atof( deptRec-&gt;<a class="code" href="structDepartmentRec.html#m4">salary_multiplier</a>, 9 );
00154         deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m4">teaching_load_multiplier</a> = (float) m.atof( deptRec-&gt;<a class="code" href="structDepartmentRec.html#m5">teaching_load_multiplier</a>, 9 );
00155         deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m5">research_per_faculty_multiplier</a> = (float) m.atof( deptRec-&gt;<a class="code" href="structDepartmentRec.html#m6">research_per_faculty_multiplier</a>, 9 );
00156         deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m6">female_multiplier</a>   = (float) m.atof( deptRec-&gt;<a class="code" href="structDepartmentRec.html#m7">female_multiplier</a>, 9 );
00157         deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m7">minority_multiplier</a> = (float) m.atof( deptRec-&gt;<a class="code" href="structDepartmentRec.html#m8">minority_multiplier</a>, 9 );
00158 
00159         deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m12">talent_teaching</a>    = m.atoi( deptRec-&gt;<a class="code" href="structDepartmentRec.html#m9">talent_teaching</a>, 9 );
00160         deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m13">talent_scholarship</a> = m.atoi( deptRec-&gt;<a class="code" href="structDepartmentRec.html#m10">talent_scholarship</a>, 9 );
00161         deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m14">talent_research</a>    = m.atoi( deptRec-&gt;<a class="code" href="structDepartmentRec.html#m11">talent_research</a>, 9 );
00162 
00163         deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m15">percent_pi_faculty</a> = char(100 * m.atof( deptRec-&gt;<a class="code" href="structDepartmentRec.html#m12">percent_faculty_pi</a>, 9 ));
00164         <span class="comment">//## chea 061299 1.8.2</span>
00165         <span class="comment">//              deptInfo-&gt;normal_research_project_size = m.atoi( deptRec-&gt;research_project_size, 9 );</span>
00166         deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m16">normal_research_project_size</a> =2 * m.atoi( deptRec-&gt;<a class="code" href="structDepartmentRec.html#m13">research_project_size</a>, 9 );
00167 
00168         deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m8">doctoral_grad_rate_multiplier</a>     = (float) m.atof( deptRec-&gt;<a class="code" href="structDepartmentRec.html#m14">doctoral_graduation_rate_multiplier</a>, 9 );
00169         deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m9">doctoral_time_to_dropout_multiplier</a> = (float) m.atof( deptRec-&gt;<a class="code" href="structDepartmentRec.html#m15">doctoral_time_to_dropout_multiplier</a>, 9 );
00170         deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m10">doctoral_time_to_degree_multiplier</a>    = (float) m.atof( deptRec-&gt;<a class="code" href="structDepartmentRec.html#m16">doctoral_time_to_degree_multiplier</a>, 9 );
00171         deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m11">graduate_tuition_rate_multiplier</a>    = (float) m.atof( deptRec-&gt;<a class="code" href="structDepartmentRec.html#m17">graduate_tuition_rate_multiplier</a>, 9 );
00172 
00173         memcpy( deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m17">template_rank_and_age</a>, deptRec-&gt;<a class="code" href="structDepartmentRec.html#m18">template_rank_and_age</a>, 1 );
00174         memcpy( deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m18">template_gender_ethnic</a>, deptRec-&gt;<a class="code" href="structDepartmentRec.html#m19">template_gender_ethnic</a>, 1 );
00175         memcpy( deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m19">template_salary</a>, deptRec-&gt;<a class="code" href="structDepartmentRec.html#m20">template_salary</a>, 1 );
00176         memcpy( deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m20">template_talent</a>, deptRec-&gt;<a class="code" href="structDepartmentRec.html#m21">template_talent</a>, 1 );
00177         memcpy( deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m21">template_course_load</a>, deptRec-&gt;<a class="code" href="structDepartmentRec.html#m22">template_course_load</a>, 1 );
00178 
00179         memcpy( deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m22">template_discretionary_time</a>, deptRec-&gt;<a class="code" href="structDepartmentRec.html#m23">faculty_discretionary_time</a>, 1 );
00180         memcpy( deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m23">template_course_type</a>, deptRec-&gt;<a class="code" href="structDepartmentRec.html#m24">course_type</a>, 2 );
00181 
00182         memcpy( deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m24">base_fac_discretionary_time</a>, deptRec-&gt;<a class="code" href="structDepartmentRec.html#m25">base_fac_discretionary_time</a>, 1);
00183 
00184         <a class="code" href="ODEPTRES_8CPP.html#a8">change_templ_code</a>(deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m17">template_rank_and_age</a>);
00185         <a class="code" href="ODEPTRES_8CPP.html#a8">change_templ_code</a>(deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m18">template_gender_ethnic</a>);
00186         <a class="code" href="ODEPTRES_8CPP.html#a8">change_templ_code</a>(deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m19">template_salary</a>);
00187         <a class="code" href="ODEPTRES_8CPP.html#a8">change_templ_code</a>(deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m20">template_talent</a>);
00188         <a class="code" href="ODEPTRES_8CPP.html#a8">change_templ_code</a>(deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m21">template_course_load</a>);
00189         <a class="code" href="ODEPTRES_8CPP.html#a8">change_templ_code</a>(deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m22">template_discretionary_time</a>);
00190         <a class="code" href="ODEPTRES_8CPP.html#a8">change_templ_code</a>(deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m24">base_fac_discretionary_time</a>);
00191 
00192         course_res.change_course_templ_code(deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m23">template_course_type</a>);
00193     }
00194 
00195     <span class="comment">//-----------------------------------------//</span>
00196 
00197     <a class="code" href="structDepartmentRec2.html">DepartmentRec2</a> *deptRec2;
00198     <a class="code" href="classDatabase.html">Database</a>    *dbDepartment2 = game_set.open_db(<a class="code" href="ODEPTRES_8CPP.html#a1">DEPARTMENT_DB2</a>);
00199 
00200     <a class="code" href="ALL_8H.html#a0">err_when</a>( department_count != (<span class="keywordtype">short</span>) dbDepartment2-&gt;<a class="code" href="classDatabase.html#a7">rec_count</a>());
00201 
00202     <span class="keywordflow">for</span>( i=0 ; i&lt;department_count ; i++ ) {
00203         deptRec2  = (<a class="code" href="structDepartmentRec2.html">DepartmentRec2</a>*) dbDepartment2-&gt;<a class="code" href="classDatabase.html#a4">read</a>(i+1);
00204         deptInfo  = info_array+i;
00205 
00206         <span class="comment">//----- read data from database dept2 -----//</span>
00207 
00208         deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m25">iped_field</a> = m.atoi( deptRec2-&gt;<a class="code" href="structDepartmentRec2.html#m1">iped_field</a>, 2) - 1;
00209         <a class="code" href="ALL_8H.html#a0">err_when</a>( deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m25">iped_field</a> &lt; 0 || deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m25">iped_field</a> &gt;= <a class="code" href="OFIELD_8H.html#a26a1">IPED_FIELD_COUNT</a> );
00210 
00211         deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m26">field_fraction_pct</a>[<a class="code" href="Ostudent_8h.html#a36a15">SL_UG</a>] = (float) m.atof( deptRec2-&gt;<a class="code" href="structDepartmentRec2.html#m2">field_fraction_pct_sl1n2</a>, 10);
00212         deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m26">field_fraction_pct</a>[<a class="code" href="Ostudent_8h.html#a36a16">SL_MASTER</a>] = (float) m.atof( deptRec2-&gt;<a class="code" href="structDepartmentRec2.html#m3">field_fraction_pct_sl3</a>, 9);
00213         deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m26">field_fraction_pct</a>[<a class="code" href="Ostudent_8h.html#a36a17">SL_DOCTOR</a>] = (float) m.atof( deptRec2-&gt;<a class="code" href="structDepartmentRec2.html#m4">field_fraction_pct_sl4</a>, 9);
00214         deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m26">field_fraction_pct</a>[<a class="code" href="Ostudent_8h.html#a32a7">DISTANCE_LEARN</a>] = (float) m.atof( deptRec2-&gt;<a class="code" href="structDepartmentRec2.html#m5">field_fraction_pct_sl5</a>, 9);
00215     }
00216 
00217     <span class="comment">//-----------------------------------------//</span>
00218 
00219     init_facility_info();
00220 
00221     <a class="code" href="structDepartmentInfo.html">DepartmentInfo</a>  *gdeptInfo;
00222     <a class="code" href="structDepartmentRec3.html">DepartmentRec3</a> *deptRec3;
00223     <a class="code" href="classDatabase.html">Database</a>    *dbDepartment3 = game_set.open_db(<a class="code" href="ODEPTRES_8CPP.html#a2">DEPARTMENT_DB3</a>);
00224 
00225     <a class="code" href="ALL_8H.html#a0">err_when</a>( department_count + 1 != (<span class="keywordtype">short</span>) dbDepartment3-&gt;<a class="code" href="classDatabase.html#a7">rec_count</a>());
00226 
00227     <span class="keywordflow">for</span>( i=0 ; i&lt;department_count+1 ; i++ ) {
00228         <span class="keywordflow">if</span> ( i &lt; department_count ) {
00229             deptRec3  = (<a class="code" href="structDepartmentRec3.html">DepartmentRec3</a>*) dbDepartment3-&gt;<a class="code" href="classDatabase.html#a4">read</a>(i+1);
00230             gdeptInfo  = info_array+i;
00231         }
00232         <span class="keywordflow">else</span>
00233             gdeptInfo = &amp;general_dept_info;
00234 
00235         <span class="comment">//----- read data from database dept3 -----//</span>
00236 
00237         gdeptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m6">replacement_cost</a> = m.atoi( deptRec3-&gt;<a class="code" href="structDepartmentRec3.html#m0">replacement_cost</a>, 9);
00238         gdeptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m9">normal_onm_cost</a> = (float) m.atof( deptRec3-&gt;<a class="code" href="structDepartmentRec3.html#m1">normal_onm_cost</a>, 9);
00239         gdeptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m10">months_to_construct</a> = (char) m.atoi( deptRec3-&gt;<a class="code" href="structDepartmentRec3.html#m2">months_to_construct</a>, 9);
00240 
00241         gdeptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m11">sf_per_course_enrollment_in_seminars</a> = (float) m.atof( deptRec3-&gt;<a class="code" href="structDepartmentRec3.html#m3">sf_per_course_enrollment</a>, 9);
00242         gdeptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m12">sf_per_course_enrollment_in_general_courses</a> = (float) m.atof( deptRec3-&gt;<a class="code" href="structDepartmentRec3.html#m3">sf_per_course_enrollment</a>, 9);
00243         gdeptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m13">sf_per_course_enrollment_in_lecture_courses</a> = (float) m.atof( deptRec3-&gt;<a class="code" href="structDepartmentRec3.html#m3">sf_per_course_enrollment</a>, 9);
00244 
00245         gdeptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m14">sf_per_faculty</a> = (float) m.atof( deptRec3-&gt;<a class="code" href="structDepartmentRec3.html#m4">sf_per_faculty</a>, 9);
00246         gdeptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m15">sf_per_research_dollar</a> = (float) m.atof( deptRec3-&gt;<a class="code" href="structDepartmentRec3.html#m5">sf_per_research_dollar</a>, 9);
00247         gdeptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m16">sf_per_dollar_of_central_exp</a> = (float) m.atof( deptRec3-&gt;<a class="code" href="structDepartmentRec3.html#m6">sf_per_dollar_of_central_exp</a>, 9);
00248         gdeptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m17">fixed_sf_per_dept</a> = (float) m.atof( deptRec3-&gt;<a class="code" href="structDepartmentRec3.html#m7">fixed_sf_per_dept</a>, 9);
00249     }
00250 
00251     <span class="comment">//----//</span>
00252 }
00253 
00254 <span class="comment">//--------- End of function DepartmentRes::load_info ---------//</span>
00255 
00256 <span class="comment">//##### begin fred 0730 #####//</span>
00257 <span class="comment">//---------- Begin of function DepartmentRes::load_faculty_info -----------//</span>
00259 <span class="comment">void DepartmentRes::load_faculty_info() {</span>
00260     <a class="code" href="structDepartmentFacultyRec.html">DepartmentFacultyRec</a>  *deptRec;
00261     <a class="code" href="structDepartmentInfo.html">DepartmentInfo</a> *deptInfo;
00262     <a class="code" href="classDatabase.html">Database</a>    *dbDeptFac = game_set.open_db(<a class="code" href="ODEPTRES_8CPP.html#a3">FACULTY_TRANSITION_PROBABILITY</a>);
00263 
00264     <span class="keywordtype">short</span> dbCount = (short) dbDeptFac-&gt;<a class="code" href="classDatabase.html#a7">rec_count</a>();
00265 
00266     <span class="comment">//------ read in faculty transition probability array -------//</span>
00267 
00268     <span class="comment">// update these three variable in deptInfo</span>
00269 
00270     <span class="comment">//float     associate_professor_departure_probability[PROB_SCHOOL_TYPE_COUNT];</span>
00271     <span class="comment">//float     assistant_professor_departure_probability[PROB_SCHOOL_TYPE_COUNT];</span>
00272     <span class="comment">//enum { ASST_PROF, ASSOC_PROF, FULL_PROF, LONG_TERM_ADJUNCT, SHORT_TERM_ADJUNCT }; // 3 professers &amp; 2 adjuncts</span>
00273 
00274     <a class="code" href="ALL_8H.html#a0">err_when</a>( dbCount !=  department_count * 7 );
00275 
00276     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;dbCount; i++ ) {
00277         deptRec   = (<a class="code" href="structDepartmentFacultyRec.html">DepartmentFacultyRec</a>*) dbDeptFac-&gt;<a class="code" href="classDatabase.html#a4">read</a>(i+1);
00278         deptInfo  = info_array+i%department_count;
00279 
00280         <span class="keywordflow">if</span> ( i &lt; department_count )
00281             load_faculty_info_sub((deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m33">assistant_professor_promotion_probability</a>), deptRec);
00282         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( i &lt; department_count*2 )
00283             load_faculty_info_sub((deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m31">faculty_departure_probability</a>[<a class="code" href="Ofaculty_8h.html#a27a9">ASST_PROF</a>]), deptRec);
00284         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( i &lt; department_count*3 )
00285             load_faculty_info_sub((deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m32">associate_professor_promotion_probability</a>), deptRec);
00286         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( i &lt; department_count*4 )
00287             load_faculty_info_sub((deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m31">faculty_departure_probability</a>[<a class="code" href="Ofaculty_8h.html#a27a10">ASSOC_PROF</a>]), deptRec);
00288         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( i &lt; department_count*5 )
00289             load_faculty_info_sub((deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m31">faculty_departure_probability</a>[<a class="code" href="Ofaculty_8h.html#a27a11">FULL_PROF</a>]), deptRec);
00290         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( i &lt; department_count*6 )
00291             load_faculty_info_sub((deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m31">faculty_departure_probability</a>[<a class="code" href="Ofaculty_8h.html#a27a12">LONG_TERM_ADJUNCT</a>]), deptRec);
00292         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( i &lt; department_count*7 )
00293             load_faculty_info_sub((deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m31">faculty_departure_probability</a>[<a class="code" href="Ofaculty_8h.html#a27a13">SHORT_TERM_ADJUNCT</a>]), deptRec);
00294     }
00295 }
00296 
00297 <span class="comment">//---------- End of function DepartmentRes::load_faculty_info -----------//</span>
00298 
00299 <span class="comment">//---------- Begin of function DepartmentRes::load_faculty_info_sub -----------//</span>
00301 <span class="comment">void DepartmentRes::load_faculty_info_sub(float trans_prob[PROB_SCHOOL_TYPE_COUNT], DepartmentFacultyRec *deptRec) { {</span>
00302     <span class="comment">// for (int s=0; s&lt;PROB_SCHOOL_TYPE_COUNT; s++)</span>
00303 
00304     trans_prob[<a class="code" href="Opschool_8h.html#a58a5">NATIONAL</a>] = (float) m.atof(deptRec-&gt;<a class="code" href="structDepartmentFacultyRec.html#m0">trans_prob</a>[0], 9);
00305 
00306     trans_prob[<a class="code" href="Opschool_8h.html#a58a4">REGIONAL</a>] = (float) m.atof(deptRec-&gt;<a class="code" href="structDepartmentFacultyRec.html#m0">trans_prob</a>[1], 9);
00307 
00308     trans_prob[<a class="code" href="Opschool_8h.html#a58a3">LOCAL</a>] = (float) m.atof(deptRec-&gt;<a class="code" href="structDepartmentFacultyRec.html#m0">trans_prob</a>[2], 9);
00309 }
00310 }
00311 
00312 <span class="comment">//---------- End of function DepartmentRes::load_faculty_info_sub -----------//</span>
00313 
00314 <span class="comment">//---------- Begin of function DepartmentRes::load_course_info -----------//</span>
00316 <span class="comment">void DepartmentRes::load_course_info() {</span>
00317     <span class="comment">//***</span>
00318     <span class="comment">//ASKBILLok order of departments in the curri_requriments is ***WRONG***</span>
00319     <span class="comment">//***</span>
00320 
00321     <a class="code" href="structDepartmentUGCourseRec.html">DepartmentUGCourseRec</a>     *deptUGRec;
00322     <a class="code" href="structDepartmentInfo.html">DepartmentInfo</a> *deptInfo;
00323     <a class="code" href="classDatabase.html">Database</a>    *dbDept = game_set.open_db(<a class="code" href="ODEPTRES_8CPP.html#a4">COURSE_UG_DB</a>);
00324 
00325     <span class="keywordtype">short</span> dbCount = (short) dbDept-&gt;<a class="code" href="classDatabase.html#a7">rec_count</a>();
00326     <span class="keywordtype">char</span> rowsPerDept = 4;
00327 
00328     <span class="comment">//------ read in course curriculam requirment array -------//</span>
00329 
00330     <span class="comment">// 1 for general education</span>
00331     <a class="code" href="ALL_8H.html#a0">err_when</a>( dbCount != (department_count + 1) * rowsPerDept );
00332 
00333     <span class="comment">// a. Special case handle the "department": general education</span>
00334     <span class="comment">//</span>
00335     deptUGRec   = (<a class="code" href="structDepartmentUGCourseRec.html">DepartmentUGCourseRec</a>*) dbDept-&gt;<a class="code" href="classDatabase.html#a4">read</a>(1);
00336 
00337     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> e=0; e&lt;<a class="code" href="Ostudent_8h.html#a38a21">BACHELOR_YEAR_COUNT</a>; e++ )
00338         general_dept_info.bachelor_elective_year_count[e] = (char) m.atoi(deptUGRec-&gt;<a class="code" href="structDepartmentUGCourseRec.html#m0">elective</a>[e], 9);
00339 
00340     deptUGRec   = (<a class="code" href="structDepartmentUGCourseRec.html">DepartmentUGCourseRec</a>*) dbDept-&gt;<a class="code" href="classDatabase.html#a4">read</a>(2);
00341     load_course_info_sub(general_dept_info.bachelor_depth1, (<a class="code" href="structDepartmentCourseRec.html">DepartmentCourseRec</a> *)deptUGRec);
00342 
00343     deptUGRec   = (<a class="code" href="structDepartmentUGCourseRec.html">DepartmentUGCourseRec</a>*) dbDept-&gt;<a class="code" href="classDatabase.html#a4">read</a>(3);
00344     load_course_info_sub(general_dept_info.bachelor_depth2, (<a class="code" href="structDepartmentCourseRec.html">DepartmentCourseRec</a> *)deptUGRec);
00345 
00346     deptUGRec   = (<a class="code" href="structDepartmentUGCourseRec.html">DepartmentUGCourseRec</a>*) dbDept-&gt;<a class="code" href="classDatabase.html#a4">read</a>(4);
00347     load_course_info_sub(general_dept_info.bachelor_depth3, (<a class="code" href="structDepartmentCourseRec.html">DepartmentCourseRec</a> *)deptUGRec);
00348 
00349     <span class="comment">// b. Genernal case</span>
00350     <span class="comment">//</span>
00351     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=4 ; i&lt;dbCount; i++ ) {
00352         deptUGRec   = (<a class="code" href="structDepartmentUGCourseRec.html">DepartmentUGCourseRec</a>*) dbDept-&gt;<a class="code" href="classDatabase.html#a4">read</a>(i+1);
00353         deptInfo  = info_array + (i-4)/rowsPerDept;
00354 
00355         <span class="keywordflow">switch</span> ( i%rowsPerDept ) {
00356         <span class="keywordflow">case</span> 0:
00357             <span class="keywordflow">for</span> ( e=0; e&lt;<a class="code" href="Ostudent_8h.html#a38a21">BACHELOR_YEAR_COUNT</a>; e++ )
00358                 deptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m3">bachelor_elective_year_count</a>[e] = (char) m.atoi(deptUGRec-&gt;<a class="code" href="structDepartmentUGCourseRec.html#m0">elective</a>[e], 9);
00359 
00360             <span class="comment">//this is a dummy "total" row in the db</span>
00361 
00362             <span class="comment">//bughere0 elective course has depth!!!  // 1229</span>
00363             <span class="keywordflow">break</span>;
00364         <span class="keywordflow">case</span> 1:
00365             load_course_info_sub(deptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m0">bachelor_depth1</a>, (<a class="code" href="structDepartmentCourseRec.html">DepartmentCourseRec</a> *)deptUGRec);
00366             <span class="keywordflow">break</span>;
00367         <span class="keywordflow">case</span> 2:
00368             load_course_info_sub(deptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m1">bachelor_depth2</a>, (<a class="code" href="structDepartmentCourseRec.html">DepartmentCourseRec</a> *)deptUGRec);
00369             <span class="keywordflow">break</span>;
00370         <span class="keywordflow">case</span> 3:
00371             load_course_info_sub(deptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m2">bachelor_depth3</a>, (<a class="code" href="structDepartmentCourseRec.html">DepartmentCourseRec</a> *)deptUGRec);
00372             <span class="keywordflow">break</span>;
00373         }
00374     }
00375 
00376     <span class="comment">//----- MASTER ------//</span>
00377 
00378     <a class="code" href="structDepartmentMasterCourseRec.html">DepartmentMasterCourseRec</a>  *deptMasterRec;
00379 
00380     dbDept = game_set.open_db(<a class="code" href="ODEPTRES_8CPP.html#a5">COURSE_MASTER_DB</a>);
00381     dbCount = (short) dbDept-&gt;<a class="code" href="classDatabase.html#a7">rec_count</a>();
00382     rowsPerDept = 3;
00383 
00384     <a class="code" href="ALL_8H.html#a0">err_when</a>( dbCount != department_count * rowsPerDept );
00385 
00386     <span class="keywordflow">for</span>( i=0 ; i&lt;dbCount; i++ ) {
00387         deptMasterRec   = (<a class="code" href="structDepartmentMasterCourseRec.html">DepartmentMasterCourseRec</a>*) dbDept-&gt;<a class="code" href="classDatabase.html#a4">read</a>(i+1);
00388         deptInfo  = info_array + i/rowsPerDept;
00389 
00390         <span class="keywordflow">switch</span> ( i%rowsPerDept ) {
00391         <span class="keywordflow">case</span> 0:
00392             deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m36">master_elective_year_count</a> = 0; <span class="comment">// (char) m.atoi(deptMasterRec-&gt;elective, 9);</span>
00393             <span class="comment">//this is a dummy "total" row in the db</span>
00394 
00395             <span class="comment">//TODO 1229 master has no elective, so remove class member: deptInfo-&gt;master_elective_year_count</span>
00396             <span class="keywordflow">break</span>;
00397         <span class="keywordflow">case</span> 1:
00398             load_course_info_sub(deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m34">master_depth3</a>, deptMasterRec);
00399             <span class="keywordflow">break</span>;
00400         <span class="keywordflow">case</span> 2:
00401             load_course_info_sub(deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m35">master_graduate</a>, deptMasterRec);
00402             <span class="keywordflow">break</span>;
00403         }
00404     }
00405 
00406     <span class="comment">//----- Doctor ------//</span>
00407 
00408     <a class="code" href="structDepartmentCourseRec.html">DepartmentCourseRec</a>  *deptRec;
00409 
00410     dbDept = game_set.open_db(<a class="code" href="ODEPTRES_8CPP.html#a6">COURSE_DOCTOR_DB</a>);
00411     dbCount = (short) dbDept-&gt;<a class="code" href="classDatabase.html#a7">rec_count</a>();
00412     rowsPerDept = 2;
00413 
00414     <a class="code" href="ALL_8H.html#a0">err_when</a>( dbCount != department_count * rowsPerDept );
00415 
00416     <span class="keywordflow">for</span>( i=0 ; i&lt;dbCount; i++ ) {
00417         deptRec   = (<a class="code" href="structDepartmentCourseRec.html">DepartmentCourseRec</a>*) dbDept-&gt;<a class="code" href="classDatabase.html#a4">read</a>(i+1);
00418         deptInfo  = info_array + i/rowsPerDept;
00419 
00420         <span class="keywordflow">switch</span> ( i%rowsPerDept ) {
00421         <span class="keywordflow">case</span> 0:
00422             <span class="comment">//this is a dummy "total" row in the db</span>
00423             <span class="keywordflow">break</span>;
00424         <span class="keywordflow">case</span> 1:
00425             load_course_info_sub(deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m39">doctor_graduate</a>, deptRec);
00426             <span class="keywordflow">break</span>;
00427         }
00428     }
00429 }
00430 
00431 <span class="comment">//---------- End of function DepartmentRes::load_course_info -----------//</span>
00432 
00433 <span class="comment">//---------- Begin of function DepartmentRes::load_course_info_sub -----------//</span>
00435 <span class="comment">void DepartmentRes::load_course_info_sub(char required[COURSE_GAME_FIELD_COUNT], DepartmentCourseRec *deptRec) {</span>
00436     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> s=0; s&lt;<a class="code" href="ODEPTRES_8H.html#a2">COURSE_GAME_FIELD_COUNT</a>; s++) {
00437         required[s] = (char) m.atoi(deptRec-&gt;required[s], 9);
00438     }
00439 }
00440 
00441 <span class="comment">//---------- End of function DepartmentRes::init_course_info_sub -----------//</span>
00442 
00443 <span class="comment">//---------- Begin of function DepartmentRes::load_facility_info() -----------//</span>
00447 <span class="comment">void DepartmentRes::init_facility_info() {</span>
00448     <a class="code" href="structDepartmentInfo.html">DepartmentInfo</a> *deptInfo;
00449 
00450     <span class="comment">//DepartmentFacilityRec  *deptRec;</span>
00451     <span class="comment">//Database          *dbDepartment = game_set.open_db(DEPARTMENT_DB);</span>
00452 
00453     <span class="comment">//department_count = (short) dbDepartment-&gt;rec_count();</span>
00454 
00455     <span class="comment">//------ read in department information array -------//</span>
00456 
00457     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;department_count; i++ ) {
00458         <span class="comment">//deptRec   = (DepartmentRec*) dbDepartment-&gt;read(i+1);</span>
00459         <span class="comment">//deptInfo  = (GeneralDepartmentInfo *) (department_res.info_array+i);</span>
00460         deptInfo  = info_array+i;
00461 
00462         <span class="comment">// Parameters for replacement and normal operations and maintenance cost</span>
00463         deptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m6">replacement_cost</a> = 200;
00464         <span class="comment">// 0.99-&gt;99%</span>
00465         deptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m7">cost_growth</a> = math.get_random_snd(0.030f, .01f);
00466         deptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m8">cost_growth_last2</a> = 0;
00467         deptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m9">normal_onm_cost</a> = 4.0f;
00468         deptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m10">months_to_construct</a> = 14;
00469 
00470         <span class="comment">// Parameters for calculating normal square footage</span>
00471         deptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m11">sf_per_course_enrollment_in_seminars</a> = 6;
00472         deptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m12">sf_per_course_enrollment_in_general_courses</a> = 5;
00473         deptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m13">sf_per_course_enrollment_in_lecture_courses</a> = 4;
00474 
00475         deptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m14">sf_per_faculty</a> = 2000;
00476         deptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m15">sf_per_research_dollar</a> = 100;
00477         deptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m16">sf_per_dollar_of_central_exp</a> = 0;
00478         deptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m17">fixed_sf_per_dept</a> = 5000;
00479 
00480         <span class="comment">// initialize variables</span>
00481         deptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m19">actual_sf</a> = -1;                     <span class="comment">// important! for facilities model to initialize this</span>
00482     }
00483 
00484     general_dept_info.replacement_cost = 180;
00485     general_dept_info.cost_growth = 0;
00486     general_dept_info.cost_growth_last2 = 0;
00487     general_dept_info.normal_onm_cost = 3.5f;
00488     general_dept_info.months_to_construct = 13;
00489 
00490     <span class="comment">// three dummy field for general deparment</span>
00491     general_dept_info.sf_per_course_enrollment_in_seminars = 0;
00492     general_dept_info.sf_per_course_enrollment_in_general_courses = 0;
00493     general_dept_info.sf_per_course_enrollment_in_lecture_courses = 0;
00494     general_dept_info.sf_per_faculty = 0;
00495     general_dept_info.sf_per_research_dollar = 0;
00496 
00497     general_dept_info.sf_per_dollar_of_central_exp = 5;
00498     general_dept_info.fixed_sf_per_dept = 50000;
00499 
00500     <span class="comment">// initialize variables</span>
00501     general_dept_info.actual_sf = -1;
00502 }
00503 
00504 <span class="comment">//---------- End of function DepartmentRes::init_facility_info() -----------//</span>
00505 
00506 <span class="comment">//---------- Begin of function DepartmentRes::load_elective_course_pref -----------//</span>
00508 <span class="comment">void DepartmentRes::load_elective_course_pref() {</span>
00509     <a class="code" href="structElecPrefRec.html">ElecPrefRec</a>  *deptRec;
00510 
00511     <a class="code" href="structDepartmentInfo.html">DepartmentInfo</a> *deptInfo;
00512     <a class="code" href="classDatabase.html">Database</a>  *dbDept = game_set.open_db(<a class="code" href="ODEPTRES_8CPP.html#a7">ELECTIVE_PREF_DB</a>);
00513     <span class="keywordtype">short</span> dbCount = (short) dbDept-&gt;<a class="code" href="classDatabase.html#a7">rec_count</a>();
00514 
00515     <a class="code" href="ALL_8H.html#a0">err_when</a>(dbCount != department_count);
00516 
00517     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=1; i&lt;=department_count ; i++ ) {
00518         <span class="keywordtype">float</span> totalPref=0;
00519         deptInfo = department_res[i];
00520 
00521         deptRec   = (<a class="code" href="structElecPrefRec.html">ElecPrefRec</a>*) dbDept-&gt;<a class="code" href="classDatabase.html#a4">read</a>(i);
00522 
00523         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> j=0 ; j&lt;department_count ; j++ ) {
00524             deptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m4">bachelor_elective_course_pref</a>[j] = 100 * (float) m.atof( deptRec-&gt;<a class="code" href="structElecPrefRec.html#m0">pref</a>[j], 9);
00525 
00526             <span class="comment">// varsto be removed</span>
00527             deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m37">master_elective_course_pref</a>[j]   = 100.0f / (department_count);
00528 
00529             <span class="comment">//----- verify if the total is 100 -----//</span>
00530 
00531             totalPref += deptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m4">bachelor_elective_course_pref</a>[j];
00532         }
00533 
00534         <span class="comment">// error difference is too big, having taking into account of the floating point error</span>
00535         <a class="code" href="ALL_8H.html#a0">err_when</a>( totalPref &lt;= 99 || totalPref &gt;= 101 );
00536     }
00537 
00538     <span class="comment">//------- initialize general_dept_info --------//</span>
00539 
00540     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> j=0 ; j&lt;department_count ; j++ ) {
00541         general_dept_info.bachelor_elective_course_pref[j] = 100.0f / department_count;
00542     }
00543 }
00544 
00545 <span class="comment">//---------- End of function DepartmentRes::load_elective_course_pref -----------//</span>
00546 
00547 <span class="comment">//----- Begin of function DepartmentRes::calc_total_elective_course_pref -----//</span>
<a name="l00551"></a><a class="code" href="classDepartmentRes.html#a6">00551</a> <span class="comment">void DepartmentRes::calc_total_elective_course_pref() {</span>
00552     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0; i&lt;=department_count; i++ ) {
00553         <a class="code" href="structDepartmentInfo.html">DepartmentInfo</a>* deptInfo = department_res[i]; <span class="comment">// 0 points to the general department</span>
00554 
00555         deptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m5">total_bachelor_elective_course_pref</a> = 0;
00556         deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m38">total_master_elective_course_pref</a> = 0;
00557 
00558         <span class="comment">//---- only add preference for existing departments ---//</span>
00559 
00560         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> r=department_array.size(); r&gt;0; r--) {
00561             <span class="keywordflow">if</span>( department_array.is_deleted(r) )
00562                 <span class="keywordflow">continue</span>;
00563 
00564             <span class="keywordtype">int</span> deptId = department_array[r]-&gt;department_id;
00565 
00566             deptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m5">total_bachelor_elective_course_pref</a> +=
00567                 deptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m4">bachelor_elective_course_pref</a>[deptId-1];
00568 
00569             deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m38">total_master_elective_course_pref</a> +=
00570                 deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m37">master_elective_course_pref</a>[deptId-1];
00571 
00572             <a class="code" href="ALL_8H.html#a0">err_when</a>(department_array[r]-&gt;department_recno != r);
00573         }
00574 
00575     }
00576 }
00577 
00578 <span class="comment">//------ End of function DepartmentRes::calc_total_elective_course_pref ------//</span>
00579 
00580 <span class="comment">//---------- Begin of function DepartmentRes::school_type_2_prob_school_type -----------//</span>
<a name="l00582"></a><a class="code" href="classDepartmentRes.html#a7">00582</a> <span class="comment">int DepartmentRes::get_prob_school_type() {</span>
00583     <span class="keywordflow">return</span> player_school.student_market;
00584 }
00585 
00586 <span class="comment">//------ End of function DepartmentRes::calc_total_elective_course_pref ------//</span>
00587 
00588 <span class="comment">//---------- Begin of function DepartmentRes::operator[] -----------//</span>
<a name="l00590"></a><a class="code" href="classDepartmentRes.html#a8">00590</a> <span class="comment">DepartmentInfo* DepartmentRes::operator[](int deptId) {</span>
00591     <span class="keywordflow">if</span> ( deptId==0 )
00592         <span class="keywordflow">return</span> &amp;general_dept_info;
00593 
00594     <a class="code" href="ALL_8H.html#a0">err_when</a>( deptId &lt; 1 || deptId &gt; department_count );
00595 
00596     <span class="keywordflow">return</span> info_array + deptId - 1;
00597 }
00598 
00599 <span class="comment">//---------- End of function DepartmentRes::operator[] -----------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:24 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
