<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Ogame.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Ogame.cpp</h1><a href="Ogame_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OGAME.CPP</span>
00002 <span class="comment">//Description : Main Game Object</span>
00003 
00004 <span class="preprocessor">#include &lt;<a class="code" href="OLOG_8H.html">OLOG.H</a>&gt;</span>
00005 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00006 <span class="preprocessor">#include &lt;<a class="code" href="OMUSIC_8H.html">OMUSIC.H</a>&gt;</span>
00007 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00008 <span class="preprocessor">#include &lt;<a class="code" href="OMOUSECR_8H.html">OMOUSECR.H</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;<a class="code" href="OFIRMRES_8H.html">OFIRMRES.H</a>&gt;</span>
00010 <span class="preprocessor">#include &lt;OCOURSE.H&gt;</span>
00011 <span class="preprocessor">#include &lt;<a class="code" href="OCOURRES_8H.html">OCOURRES.H</a>&gt;</span>
00012 <span class="preprocessor">#include &lt;<a class="code" href="OSCHOOL_8H.html">OSCHOOL.H</a>&gt;</span>
00013 <span class="preprocessor">#include &lt;<a class="code" href="ONAMERES_8H.html">ONAMERES.H</a>&gt;</span>
00014 <span class="preprocessor">#include &lt;<a class="code" href="OFIELD_8H.html">OFIELD.H</a>&gt;</span>
00015 <span class="preprocessor">#include &lt;<a class="code" href="OPOWER_8H.html">OPOWER.H</a>&gt;</span>
00016 <span class="preprocessor">#include &lt;<a class="code" href="OWORLD_8H.html">OWORLD.H</a>&gt;</span>
00017 <span class="preprocessor">#include &lt;<a class="code" href="OBATTLE_8H.html">OBATTLE.H</a>&gt;</span>
00018 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>
00019 <span class="preprocessor">#include &lt;OAUDIO.H&gt;</span>
00020 <span class="preprocessor">#include &lt;<a class="code" href="ODEPTRES_8H.html">ODEPTRES.H</a>&gt;</span>
00021 <span class="preprocessor">#include &lt;ODEPT.H&gt;</span>
00022 <span class="preprocessor">#include &lt;OPSCHOOL.H&gt;</span>
00023 <span class="preprocessor">#include &lt;<a class="code" href="OSCHLRES_8H.html">OSCHLRES.H</a>&gt;</span>
00024 <span class="preprocessor">#include &lt;OFACURES.H&gt;</span>
00025 <span class="preprocessor">#include &lt;OENROLL.H&gt;</span>
00026 <span class="preprocessor">#include &lt;<a class="code" href="OFPHOTO_8H.html">OFPHOTO.H</a>&gt;</span>
00027 <span class="preprocessor">#include &lt;OFINANCE.H&gt;</span>
00028 <span class="preprocessor">#include &lt;OLETTER.H&gt;</span>                              <span class="comment">// chwg1026</span>
00029 <span class="preprocessor">#include &lt;OFIRM.H&gt;</span>
00030 <span class="preprocessor">#include &lt;<a class="code" href="OTERRAIN_8H.html">OTERRAIN.H</a>&gt;</span>
00031 <span class="preprocessor">#include &lt;<a class="code" href="OPLANT_8H.html">OPLANT.H</a>&gt;</span>
00032 <span class="preprocessor">#include &lt;<a class="code" href="OROAD_8H.html">OROAD.H</a>&gt;</span>
00033 <span class="preprocessor">#include &lt;<a class="code" href="OGAMESET_8H.html">OGAMESET.H</a>&gt;</span>
00034 <span class="preprocessor">#include &lt;<a class="code" href="OGAME_8H.html">OGAME.H</a>&gt;</span>
00035 <span class="comment">//## fred 990511 #include &lt;OSPRTRES.H&gt;</span>
00036 <span class="comment">//## fred 990511 #include &lt;OSPRITEA.H&gt;</span>
00037 <span class="preprocessor">#include &lt;OFACILIT.H&gt;</span>                             <span class="comment">// fred 980808</span>
00038 <span class="preprocessor">#include &lt;ONEWS.H&gt;</span>                                <span class="comment">// fred 981013</span>
00039 <span class="preprocessor">#include &lt;<a class="code" href="OTASK_8H.html">OTASK.H</a>&gt;</span>                                <span class="comment">// fred 981014</span>
00040 <span class="preprocessor">#include &lt;OCHANCE.H&gt;</span>                              <span class="comment">// fred 981014</span>
00041 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00042 <span class="preprocessor"></span><span class="preprocessor">#include &lt;OLOSEGAM.H&gt;</span>
00043 <span class="preprocessor">#endif</span>
00044 <span class="preprocessor"></span>
00045 <span class="comment">//-------- Begin of function Game::Game --------//</span>
<a name="l00047"></a><a class="code" href="classGame.html#a0">00047</a> <span class="comment">Game::Game() {</span>
00048     init_flag = 0;
00049     game_mode = <a class="code" href="OGAME_8H.html#a5a1">GAME_PREGAME</a>;
00050 }
00051 
00052 <span class="comment">//--------- End of function Game::Game ---------//</span>
00053 
00054 <span class="comment">//-------- Begin of function Game::init --------//</span>
<a name="l00064"></a><a class="code" href="classGame.html#a1">00064</a> <span class="comment">int Game::init(int loadGameCall) {</span>
00065     <span class="keywordflow">if</span>( init_flag )
00066         deinit();
00067 
00068     <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(<span class="stringliteral">"Game::init called"</span>);
00069 
00070     <span class="keywordtype">int</span> originalRandomSeed = m.get_random_seed();
00071 
00072     <span class="comment">//  music.stop();</span>
00073 
00074     <span class="comment">// ----- set waiting cursor -------- //</span>
00075 
00076     <span class="keywordtype">int</span> oldCursor = mouse_cursor.get_icon();
00077     mouse_cursor.set_icon(<a class="code" href="OMOUSECR_8H.html#a6a5">CURSOR_WAITING</a>);
00078 
00079     <span class="comment">//--------- open game set ---------//</span>
00080     game_set.open_set(1);                           <span class="comment">// open the default game set</span>
00081 
00082     <span class="comment">//------- init game resource class ------//</span>
00083 
00084     terrain_res.init();
00085     plant_res.init();
00086     road_res.init();
00087 
00088     school_res.init();
00089     field_res.init();
00090     department_res.init();
00091     firm_res.init();                                <span class="comment">// inited in obattle.cpp</span>
00092     <span class="comment">//## fred 990511    sprite_res.init();                      // fred 980608</span>
00093     faculty_res.init();
00094     faculty_photo_res.init();
00095     name_res.init();
00096     letter.init();                                  <span class="comment">// chw1026</span>
00097     course_res.init();
00098     enroll_res.init();                              <span class="comment">// fred 980702; must run after school_res.init()</span>
00099 
00100 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00101 <span class="preprocessor"></span>    <span class="comment">// modify parameters</span>
00102     <span class="comment">// light-speed</span>
00103     <span class="keywordflow">if</span>( player_school.behavioral_response_speed == <a class="code" href="Gamedef_8h.html#a73a24">INPUT_HIGH</a> ) {
00104         <span class="comment">// modify HE.GDB.Init.D4 to boost faculty promotion speed and reduce career length</span>
00105 
00106         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> deptId = 1; deptId &lt;= department_res.department_count; ++deptId ) {
00107             <a class="code" href="structDepartmentInfo.html">DepartmentInfo</a> *deptInfo = department_res[deptId];
00108             <span class="keywordflow">for</span>( <span class="keywordtype">int</span> probSchoolType = 0; probSchoolType &lt; <a class="code" href="ODEPTRES_8H.html#a1">PROB_SCHOOL_TYPE_COUNT</a>; ++probSchoolType ) {
00109                 <span class="comment">// B85, Is associate_professor_promotion_probability right field?</span>
00110                 deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m32">associate_professor_promotion_probability</a>[probSchoolType] *= 1.5f;
00111                 <span class="comment">// B86, Is assistant_professor_promotion_probability right field?</span>
00112                 deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m33">assistant_professor_promotion_probability</a>[probSchoolType] *= 1.5f;
00113 
00114                 <span class="comment">// C85:C89</span>
00115                 <span class="keywordflow">for</span>( <span class="keywordtype">int</span> rankLevel = 0; rankLevel &lt; <a class="code" href="Ofaculty_8h.html#a26a8">FACULTY_RANK_LEVEL_COUNT</a>; ++rankLevel ) {
00116                     deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m31">faculty_departure_probability</a>[rankLevel][probSchoolType] *= 2.0f;
00117                 }
00118             }
00119         }
00120 
00121     }
00122 <span class="preprocessor">#endif</span>
00123 <span class="preprocessor"></span>
00124     <span class="comment">//------- init game data class ---------//</span>
00125 
00126     firm_array.init();
00127     <span class="comment">//## fred 990511    sprite_array.init();</span>
00128     department_array.init();
00129 
00130     <span class="comment">//------ init game surface class -------//</span>
00131 
00132     finance.init();
00133     facility_office.init();                         <span class="comment">// fred 980808</span>
00134     power.init();
00135     world.init();
00136     battle.init();
00137     news_array.init();                              <span class="comment">//## fred 981013</span>
00138     task_array.init();                              <span class="comment">//## fred 981013</span>
00139     chance_event.init();                            <span class="comment">//## fred 981013</span>
00140 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00141 <span class="preprocessor"></span>    lose_game.init();
00142 <span class="preprocessor">#endif</span>
00143 <span class="preprocessor"></span>
00144     <span class="keywordflow">if</span>( !loadGameCall )
00145         info.init();                                  <span class="comment">// it reads in the panel texture and copy it to vga_back's buffer</span>
00146 
00147     <span class="comment">//----- restore from waiting cursor --------//</span>
00148 
00149     mouse_cursor.restore_icon(oldCursor);
00150 
00151     game_has_ended = 0;
00152 
00153     init_flag=1;
00154 
00155     <span class="keywordflow">return</span> TRUE;
00156 }
00157 
00158 <span class="comment">//--------- End of function Game::init ---------//</span>
00159 
00160 <span class="comment">//-------- Begin of function Game::deinit --------//</span>
<a name="l00166"></a><a class="code" href="classGame.html#a2">00166</a> <span class="comment">void Game::deinit(int loadGameCall) {</span>
00167     <span class="keywordflow">if</span>( !init_flag )
00168         <span class="keywordflow">return</span>;
00169 
00170     <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(<span class="stringliteral">"Game::deinit called"</span>);
00171 
00172     power.disable();                                <span class="comment">// disable power, which handle mouse inputs</span>
00173 
00174     music.stop();
00175     audio.stop_wav();
00176 
00177     <span class="comment">//----- set waiting cursor -------- //</span>
00178 
00179     <span class="keywordtype">int</span> oldCursor = mouse_cursor.get_icon();
00180     mouse_cursor.set_icon(<a class="code" href="OMOUSECR_8H.html#a6a5">CURSOR_WAITING</a>);
00181 
00182     <span class="comment">//------- deinit game data class ---------//</span>
00183 
00184     <span class="comment">//## fred 990511    sprite_array.deinit();</span>
00185     firm_array.deinit();
00186     department_array.deinit();
00187 
00188     <span class="comment">//------ deinit game surface class -------//</span>
00189 
00190     finance.deinit();
00191     facility_office.deinit();                       <span class="comment">// fred 980808</span>
00192     power.deinit();
00193     world.deinit();
00194     battle.deinit();
00195     news_array.deinit();                            <span class="comment">//## fred 981013</span>
00196     task_array.deinit();                            <span class="comment">//## fred 981013</span>
00197     chance_event.deinit();                          <span class="comment">//## fred 981013</span>
00198 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00199 <span class="preprocessor"></span>    lose_game.deinit();
00200 <span class="preprocessor">#endif</span>
00201 <span class="preprocessor"></span>
00202     <span class="keywordflow">if</span>( !loadGameCall )
00203         info.deinit();
00204 
00205     <span class="comment">//------- deinit game resource class ------//</span>
00206 
00207     terrain_res.deinit();
00208     plant_res.deinit();
00209     road_res.deinit();
00210 
00211     <span class="comment">//## fred 990511    sprite_res.deinit();                    // fred 980608</span>
00212     school_res.deinit();
00213     field_res.deinit();
00214     department_res.deinit();
00215     firm_res.deinit();
00216     faculty_res.deinit();
00217     faculty_photo_res.deinit();
00218     name_res.deinit();
00219     course_res.deinit();
00220     enroll_res.deinit();                            <span class="comment">// fred 980702</span>
00221 
00222     player_school.deinit();
00223 
00224     game_set.close_set();                           <span class="comment">// close the game set</span>
00225 
00226     <span class="comment">//----- restore from waiting cursor -------- //</span>
00227 
00228     mouse_cursor.restore_icon(oldCursor);
00229 
00230     init_flag=0;
00231 }
00232 
00233 <span class="comment">//--------- End of function Game::deinit ---------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:42 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
