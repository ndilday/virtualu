<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OFILETXT.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>OFILETXT.CPP</h1><a href="OFILETXT_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OFILETXT.CPP</span>
00002 <span class="comment">//Description : Object Text file</span>
00003 
00004 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00005 
00006 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00007 <span class="preprocessor">#include &lt;<a class="code" href="KEY_8H.html">KEY.H</a>&gt;</span>
00008 <span class="preprocessor">#include &lt;<a class="code" href="OFILETXT_8H.html">OFILETXT.H</a>&gt;</span>
00009 
00010 <span class="comment">//---- marco function for advancing to next token, bypassing space, ',' and ':' ---//</span>
00011 
<a name="l00012"></a><a class="code" href="OFILETXT_8CPP.html#a0">00012</a> <span class="preprocessor">#define next_token()  for( ; *data_ptr==' ' || *data_ptr==',' || *data_ptr==':' ; data_ptr++ )</span>
00013 <span class="preprocessor"></span>
00014 <span class="comment">//-------- Begin of function FileTxt::FileTxt ----------//</span>
<a name="l00018"></a><a class="code" href="classFileTxt.html#a0">00018</a> <span class="comment">FileTxt::FileTxt(char* fileName) {</span>
00019     file_open(fileName);
00020 
00021     <span class="comment">//-----------------------------------//</span>
00022 
00023     file_length = <a class="code" href="classFile.html#a6">File::file_size</a>();
00024 
00025     data_buf = <a class="code" href="ALL_8H.html#a5">mem_add</a>( file_length+1 );
00026 
00027     data_buf[file_length] = <a class="code" href="OFILETXT_8H.html#a0">CHAR_EOF</a>;
00028     data_ptr = data_buf;
00029 
00030     <span class="comment">//-----------------------------------//</span>
00031 
00032     file_read( data_buf, file_length );
00033 
00034     file_close();
00035 }
00036 
00037 <span class="comment">//---------- End of function FileTxt::FileTxt ----------//</span>
00038 
00039 <span class="comment">//-------- Begin of function FileTxt::FileTxt ----------//</span>
<a name="l00046"></a><a class="code" href="classFileTxt.html#a1">00046</a> <span class="comment">FileTxt::FileTxt(File* filePtr, int dataSize) {</span>
00047     <span class="comment">//-----------------------------------//</span>
00048 
00049     file_length = dataSize;
00050 
00051     data_buf = <a class="code" href="ALL_8H.html#a5">mem_add</a>( file_length+1 );
00052 
00053     data_buf[file_length] = <a class="code" href="OFILETXT_8H.html#a0">CHAR_EOF</a>;
00054     data_ptr = data_buf;
00055 
00056     <span class="comment">//-----------------------------------//</span>
00057 
00058     filePtr-&gt;file_read( data_buf, file_length );
00059 }
00060 
00061 <span class="comment">//---------- End of function FileTxt::FileTxt ----------//</span>
00062 
00063 <span class="comment">//-------- Begin of function FileTxt::~FileTxt ----------//</span>
<a name="l00065"></a><a class="code" href="classFileTxt.html#a2">00065</a> <span class="comment">FileTxt::~FileTxt() {</span>
00066     <a class="code" href="ALL_8H.html#a8">mem_del</a>( data_buf );
00067 }
00068 
00069 <span class="comment">//---------- End of function FileTxt::~FileTxt ----------//</span>
00070 
00071 <span class="comment">//--------- Begin of function FileTxt::get_char ------//</span>
<a name="l00082"></a><a class="code" href="classFileTxt.html#a5">00082</a> <span class="comment">char FileTxt::get_char(int advancePointer) {</span>
00083     <span class="keywordflow">while</span>( *data_ptr == <a class="code" href="OFILETXT_8H.html#a2">CHAR_RETURN</a> )
00084         next_line();
00085 
00086     <span class="keywordflow">if</span>( *data_ptr == <a class="code" href="OFILETXT_8H.html#a0">CHAR_EOF</a> )
00087         <span class="keywordflow">return</span> 0;
00088 
00089     <span class="keywordtype">char</span> dataChar = *data_ptr;
00090 
00091     <span class="keywordflow">if</span>( advancePointer )
00092         data_ptr++;
00093 
00094     <span class="keywordflow">return</span> dataChar;
00095 }
00096 
00097 <span class="comment">//----------- End of function FileTxt::get_char ------//</span>
00098 
00099 <span class="comment">//--------- Begin of function FileTxt::next_line ------//</span>
<a name="l00107"></a><a class="code" href="classFileTxt.html#a3">00107</a> <span class="comment">char* FileTxt::next_line() {</span>
00108     <span class="keywordflow">for</span>( ; *data_ptr != <a class="code" href="OFILETXT_8H.html#a2">CHAR_RETURN</a> &amp;&amp; *data_ptr != <a class="code" href="OFILETXT_8H.html#a0">CHAR_EOF</a> ; data_ptr++ );
00109 
00110     <span class="keywordflow">if</span>( *data_ptr == <a class="code" href="OFILETXT_8H.html#a2">CHAR_RETURN</a> )
00111         data_ptr++;
00112 
00113     <span class="keywordflow">if</span>( *data_ptr == <a class="code" href="OFILETXT_8H.html#a3">CHAR_LINE_FEED</a> )
00114         data_ptr++;
00115 
00116     <a class="code" href="OFILETXT_8CPP.html#a0">next_token</a>();
00117 
00118     <span class="keywordflow">if</span>( *data_ptr == <a class="code" href="OFILETXT_8H.html#a0">CHAR_EOF</a> )
00119         <span class="keywordflow">return</span> <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00120     <span class="keywordflow">else</span>
00121         <span class="keywordflow">return</span> data_ptr;
00122 }
00123 
00124 <span class="comment">//----------- End of function FileTxt::next_line ------//</span>
00125 
00126 <span class="comment">//----------- End of function FileTxt::locate_word ------//</span>
00127 <span class="comment">//</span>
00128 <span class="comment">// locate the specified word</span>
00129 <span class="comment">//</span>
00130 <span class="comment">// &lt;char*&gt; wordPtr = pointer to the word</span>
00131 <span class="comment">//</span>
00132 <span class="comment">// Return : the pointer to next word</span>
00133 <span class="comment">//          NULL if not found, now pointed to EOF</span>
00134 <span class="comment">//</span>
<a name="l00135"></a><a class="code" href="classFileTxt.html#a4">00135</a> <span class="keywordtype">char</span>* <a class="code" href="classFileTxt.html#a4">FileTxt::locate_word</a>(<span class="keywordtype">char</span>* wordPtr) {
00136     <span class="keywordflow">for</span>( ; *<a class="code" href="classFileTxt.html#m0">data_ptr</a> != <a class="code" href="OFILETXT_8H.html#a0">CHAR_EOF</a> ; <a class="code" href="classFileTxt.html#m0">data_ptr</a>++ ) {
00137         <span class="keywordflow">if</span>( *<a class="code" href="classFileTxt.html#m0">data_ptr</a> == *wordPtr ) {                 <span class="comment">// match first character first</span>
00138             <span class="keywordflow">for</span>( ; *<a class="code" href="classFileTxt.html#m0">data_ptr</a> == *wordPtr &amp;&amp; *wordPtr ; <a class="code" href="classFileTxt.html#m0">data_ptr</a>++, wordPtr++ );
00139 
00140             <span class="keywordflow">if</span>( *wordPtr == <a class="code" href="OHELP_8H.html#a0">NULL</a> ) {
00141                 <a class="code" href="OFILETXT_8CPP.html#a0">next_token</a>();
00142                 <span class="keywordflow">return</span> <a class="code" href="classFileTxt.html#m0">data_ptr</a>;
00143             }
00144         }
00145     }
00146 
00147     <span class="keywordflow">return</span> <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00148 }
00149 
00150 <span class="comment">//----------- End of function FileTxt::locate_word ------//</span>
00151 
00152 <span class="comment">//--------- Begin of function FileTxt::get_token ------//</span>
<a name="l00162"></a><a class="code" href="classFileTxt.html#a6">00162</a> <span class="comment">char* FileTxt::get_token(int advancePointer) {</span>
00163     <span class="keywordtype">int</span>   i;
00164     <span class="keywordtype">char</span>  pc;
00165     <span class="keywordtype">char</span>* savePtr, *tokenPtr = token_buf;
00166 
00167     <span class="keywordflow">if</span>( !advancePointer )
00168         savePtr = data_ptr;
00169 
00170     <a class="code" href="OFILETXT_8CPP.html#a0">next_token</a>();
00171 
00172     <span class="keywordflow">while</span>( *data_ptr == <a class="code" href="OFILETXT_8H.html#a2">CHAR_RETURN</a> ) {             <span class="comment">// bypass all space lines</span>
00173         <span class="keywordflow">if</span>( !next_line() )                            <span class="comment">// End of File</span>
00174             <span class="keywordflow">return</span> <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00175     }
00176 
00177     <span class="comment">//.........................................//</span>
00178 
00179     <span class="keywordflow">for</span>( i=0 ; ; i++,data_ptr++ ) {
00180         pc = *data_ptr;
00181 
00182         <span class="keywordflow">if</span> ( pc == <span class="charliteral">' '</span> || pc == <span class="charliteral">'='</span> || pc == <span class="charliteral">','</span> || pc == <span class="charliteral">':'</span> || pc==<a class="code" href="OFILETXT_8H.html#a2">CHAR_RETURN</a> )
00183             <span class="keywordflow">break</span>;
00184 
00185         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( pc == <a class="code" href="OFILETXT_8H.html#a0">CHAR_EOF</a> ) {
00186             <span class="keywordflow">if</span>( !advancePointer )                       <span class="comment">// don't advance the pointer after getting the token</span>
00187                 data_ptr = savePtr;
00188 
00189             <span class="keywordflow">return</span> <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00190         }
00191 
00192         <span class="keywordflow">if</span> ( i&lt;MAX_TOKEN_LEN )
00193             *tokenPtr++ = *data_ptr;
00194     }
00195 
00196     <span class="comment">//................................//</span>
00197 
00198     *tokenPtr = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00199 
00200     <a class="code" href="OFILETXT_8CPP.html#a0">next_token</a>();
00201 
00202     <span class="keywordflow">if</span>( !advancePointer )
00203         data_ptr = savePtr;
00204 
00205     <span class="keywordflow">return</span> token_buf;
00206 }
00207 
00208 <span class="comment">//----------- End of function FileTxt::get_token ------//</span>
00209 
00210 <span class="comment">//----------- End of function FileTxt::get_num ------//</span>
00211 <span class="comment">//</span>
00212 <span class="comment">// Convert current token to number and return the number</span>
00213 <span class="comment">//</span>
<a name="l00214"></a><a class="code" href="classFileTxt.html#a7">00214</a> <span class="keywordtype">double</span> <a class="code" href="classFileTxt.html#a7">FileTxt::get_num</a>() {
00215     <span class="keywordtype">char</span>* tokenStr = <a class="code" href="classFileTxt.html#a6">get_token</a>();
00216 
00217     <span class="keywordflow">if</span>( !tokenStr )
00218         <span class="keywordflow">return</span> 0;
00219     <span class="keywordflow">else</span>
00220         <span class="keywordflow">return</span> atof( tokenStr );
00221 }
00222 
00223 <span class="comment">//----------- End of function FileTxt::get_num ------//</span>
00224 
00225 <span class="comment">//--------- Begin of function FileTxt::read_line ------//</span>
<a name="l00232"></a><a class="code" href="classFileTxt.html#a8">00232</a> <span class="comment">void FileTxt::read_line(char* textBuf, int bufLen) {</span>
00233     <a class="code" href="OFILETXT_8CPP.html#a0">next_token</a>();                                   <span class="comment">// skip all leading space</span>
00234 
00235     <span class="keywordflow">if</span>( *data_ptr == <a class="code" href="OFILETXT_8H.html#a2">CHAR_RETURN</a> )
00236         next_line();
00237 
00238     <span class="comment">//-----------------------------------------//</span>
00239 
00240     <span class="keywordtype">int</span> i;
00241 
00242     <span class="keywordflow">for</span>( i=0 ; *data_ptr!=<a class="code" href="OFILETXT_8H.html#a2">CHAR_RETURN</a> &amp;&amp; *data_ptr!=<a class="code" href="OFILETXT_8H.html#a0">CHAR_EOF</a> &amp;&amp; i&lt;bufLen ; i++ )
00243         *textBuf++ = *data_ptr++;
00244 
00245     *textBuf=<a class="code" href="OHELP_8H.html#a0">NULL</a>;
00246 
00247     next_line();
00248 }
00249 
00250 <span class="comment">//----------- End of function FileTxt::read_line ------//</span>
00251 
00252 <span class="comment">//--------- Begin of function FileTxt::read_paragraph ------//</span>
<a name="l00262"></a><a class="code" href="classFileTxt.html#a9">00262</a> <span class="comment">int FileTxt::read_paragraph(char* textPtr, int bufLen) {</span>
00263     <a class="code" href="OFILETXT_8CPP.html#a0">next_token</a>();                                   <span class="comment">// skip all leading space</span>
00264 
00265     <span class="keywordflow">if</span>( *data_ptr == <a class="code" href="OFILETXT_8H.html#a2">CHAR_RETURN</a> )
00266         next_line();
00267 
00268     <span class="comment">//-----------------------------------------//</span>
00269 
00270     <span class="keywordtype">char</span> ch;
00271     <span class="keywordtype">int</span>  textReadLen=0;
00272 
00273     <span class="keywordflow">while</span>( *data_ptr != <a class="code" href="OFILETXT_8H.html#a0">CHAR_EOF</a> ) {
00274         ch = *data_ptr++;
00275 
00276         <span class="keywordflow">if</span>( ch==<a class="code" href="OFILETXT_8H.html#a1">CHAR_PAGE_BREAK</a> || ch==<span class="charliteral">'~'</span> )
00277             <span class="keywordflow">break</span>;
00278 
00279         <span class="comment">// RETURN + LINE_FEED = word wrap</span>
00280         <span class="comment">// LINE_FEED only     = new line</span>
00281 
00282         <span class="keywordflow">if</span>( ch==<a class="code" href="OFILETXT_8H.html#a2">CHAR_RETURN</a> ) {
00283             <span class="keywordflow">if</span>( *data_ptr==<a class="code" href="OFILETXT_8H.html#a3">CHAR_LINE_FEED</a> ) {
00284                 data_ptr++;
00285                 ch = <span class="charliteral">' '</span>;                                 <span class="comment">// Convert RETURN + LINE_FEED to a space</span>
00286             }
00287         }
00288 
00289         <span class="comment">// ##### begin Gilbert 24/7 #######//</span>
00290         <span class="keywordflow">if</span>( ch== 0xb ) {                              <span class="comment">//KEY_CTRL_K )</span>
00291             <span class="comment">// ##### end Gilbert 24/7 #######//</span>
00292             ch = <span class="charliteral">'\n'</span>;                                  <span class="comment">// CTRL-K means new line (CTRL-J)</span>
00293 
00294             <span class="keywordflow">if</span>( *data_ptr == <a class="code" href="OFILETXT_8H.html#a2">CHAR_RETURN</a> )              <span class="comment">// by pass RETURN + LINE_FEED which may be turned into space if not cancelled</span>
00295                 data_ptr++;
00296 
00297             <span class="keywordflow">if</span>( *data_ptr == <a class="code" href="OFILETXT_8H.html#a3">CHAR_LINE_FEED</a> )
00298                 data_ptr++;
00299         }
00300 
00301         *textPtr++ = ch;
00302         textReadLen++;
00303 
00304         <span class="keywordflow">if</span>( textReadLen&gt;=bufLen-1 )                   <span class="comment">// when in non-debug mode</span>
00305             <span class="keywordflow">break</span>;
00306     }
00307 
00308     *textPtr++ = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00309     textReadLen++;
00310 
00311     <a class="code" href="ALL_8H.html#a0">err_when</a>( data_ptr-data_buf &gt; file_length );
00312 
00313     <span class="keywordflow">return</span> textReadLen;
00314 }
00315 
00316 <span class="comment">//----------- End of function FileTxt::read_paragraph ------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:33 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
