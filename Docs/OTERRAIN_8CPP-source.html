<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OTERRAIN.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>OTERRAIN.CPP</h1><a href="OTERRAIN_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OTERRAIN.CPP</span>
00002 <span class="comment">//Description : TerrainRes Class Definition</span>
00003 
00004 <span class="preprocessor">#include &lt;All.h&gt;</span>
00005 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00007 <span class="preprocessor">#include &lt;OSTR.h&gt;</span>
00008 <span class="preprocessor">#include &lt;OMISC.h&gt;</span>
00009 <span class="preprocessor">#include &lt;<a class="code" href="OGAMESET_8H.html">OGAMESET.H</a>&gt;</span>
00010 <span class="preprocessor">#include &lt;OTERRAIN.h&gt;</span>
00011 
00012 <span class="comment">//----------- Define constants -------------//</span>
00013 
<a name="l00014"></a><a class="code" href="OTERRAIN_8CPP.html#a0">00014</a> <span class="preprocessor">#define TERRAIN_DB      "TERRAIN"</span>
00015 <span class="preprocessor"></span>
00016 <span class="comment">//----------- Begin of function TerrainRes Constructor -----//</span>
<a name="l00018"></a><a class="code" href="classTerrainRes.html#a0">00018</a> <span class="comment">TerrainRes::TerrainRes() {</span>
00019     init_flag=0;
00020 }
00021 
00022 <span class="comment">//------------- End of function TerrainRes Constructor -----//</span>
00023 
00024 <span class="comment">//----------- Begin of function TerrainRes Destructor ------//</span>
00026 <span class="comment"></span>
<a name="l00027"></a><a class="code" href="classTerrainRes.html#a1">00027</a> <a class="code" href="classTerrainRes.html#a1">TerrainRes::~TerrainRes</a>() {
00028     <a class="code" href="classTerrainRes.html#a3">deinit</a>();
00029 }
00030 
00031 <span class="comment">//------------- End of function TerrainRes Destructor ------//</span>
00032 
00033 <span class="comment">//----------- Begin of function TerrainRes::init --------//</span>
<a name="l00035"></a><a class="code" href="classTerrainRes.html#a2">00035</a> <span class="comment">void TerrainRes::init() {</span>
00036     <span class="keywordflow">if</span> ( init_flag )
00037         <span class="keywordflow">return</span>;
00038 
00039     <span class="comment">//----- read info from TERRAIN.DBF ------//</span>
00040 
00041     load_info();
00042 
00043     <span class="comment">//---- open bitmap resource of different resolutions ----//</span>
00044 
00045     load_res( <a class="code" href="Gamedef_8h.html#a72a19">ZOOM_SMALL</a> , <span class="stringliteral">"TERRA"</span>, <span class="stringliteral">"S"</span> );
00046     load_res( <a class="code" href="Gamedef_8h.html#a72a20">ZOOM_MEDIUM</a>, <span class="stringliteral">"TERRA"</span>, <span class="stringliteral">"M"</span> );
00047     load_res( <a class="code" href="Gamedef_8h.html#a72a21">ZOOM_LARGE</a> , <span class="stringliteral">"TERRA"</span>, <span class="stringliteral">"L"</span> );
00048 
00049     <span class="comment">//----------------------------------------//</span>
00050 
00051     init_flag=1;
00052 }
00053 
00054 <span class="comment">//------------- End of function TerrainRes::init --------//</span>
00055 
00056 <span class="comment">//----------- Begin of function TerrainRes::deinit --------//</span>
<a name="l00058"></a><a class="code" href="classTerrainRes.html#a3">00058</a> <span class="comment">void TerrainRes::deinit() {</span>
00059     <span class="keywordflow">if</span>( init_flag ) {
00060         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;<a class="code" href="Gamedef_8h.html#a9">MAX_ZOOM_LEVEL</a> ; i++ )
00061             res_bitmap[i].deinit();
00062 
00063         <a class="code" href="ALL_8H.html#a8">mem_del</a>(info_array);
00064 
00065         init_flag=0;
00066     }
00067 }
00068 
00069 <span class="comment">//------------- End of function TerrainRes::deinit --------//</span>
00070 
00071 <span class="comment">//----------- Begin of function TerrainRes::load_info -------//</span>
00075 <span class="comment">void TerrainRes::load_info() {</span>
00076     <a class="code" href="structTerrainRec.html">TerrainRec</a>  *terrainRec;
00077     <a class="code" href="structTerrainInfo.html">TerrainInfo</a> *terrainInfo;
00078     <span class="keywordtype">int</span>       i;
00079     <a class="code" href="classDatabase.html">Database</a>  *dbTerrain = game_set.open_db(<a class="code" href="OTERRAIN_8CPP.html#a0">TERRAIN_DB</a>);
00080 
00081     terrain_count = (short) dbTerrain-&gt;<a class="code" href="classDatabase.html#a7">rec_count</a>();
00082     info_array = (<a class="code" href="structTerrainInfo.html">TerrainInfo</a>*) <a class="code" href="ALL_8H.html#a5">mem_add</a>( <span class="keyword">sizeof</span>(<a class="code" href="structTerrainInfo.html">TerrainInfo</a>)*terrain_count );
00083 
00084     <span class="comment">//------ read in terrain bitmap info array -------//</span>
00085 
00086     memset( info_array, 0, <span class="keyword">sizeof</span>(<a class="code" href="structTerrainInfo.html">TerrainInfo</a>) * terrain_count );
00087 
00088     <span class="keywordflow">for</span>( i=0 ; i&lt;terrain_count ; i++ ) {
00089         terrainRec  = (<a class="code" href="structTerrainRec.html">TerrainRec</a>*) dbTerrain-&gt;<a class="code" href="classDatabase.html#a4">read</a>(i+1);
00090         terrainInfo = info_array+i;
00091 
00092         <span class="keywordflow">switch</span>( terrainRec-&gt;<a class="code" href="structTerrainRec.html#m0">type</a>[0] ) {
00093         <span class="keywordflow">case</span> <span class="charliteral">'G'</span>:
00094             terrainInfo-&gt;<a class="code" href="structTerrainInfo.html#m0">type</a> = <a class="code" href="OTERRAIN_8H.html#a2a1">TERRAIN_GRASS</a>;
00095             <span class="keywordflow">break</span>;
00096         }
00097 
00098         m.rtrim_fld( terrainInfo-&gt;<a class="code" href="structTerrainInfo.html#m1">file_name</a>, terrainRec-&gt;<a class="code" href="structTerrainRec.html#m1">file_name</a>, terrainRec-&gt;<a class="code" href="structTerrainRec.html#s3s1">FILE_NAME_LEN</a> );
00099     }
00100 }
00101 
00102 <span class="comment">//----------- End of function TerrainRes::load_info -------//</span>
00103 
00104 <span class="comment">//----------- Begin of function TerrainRes::load_res --------//</span>
00106 <span class="comment">void TerrainRes::load_res(int zoomLevel, char* namePrefix, char* nameSuffix) {</span>
00107     <span class="comment">//------ read bitmaps into memory -----//</span>
00108 
00109     <a class="code" href="classString.html">String</a> str2;
00110 
00111     str2  = <a class="code" href="Gamedef_8h.html#a4">DIR_RES</a>;
00112     str2 += namePrefix;
00113     str2 += <span class="stringliteral">"_"</span>;
00114     str2 += nameSuffix;
00115 
00116     str2 += <span class="stringliteral">".RES"</span>;
00117 
00118     res_bitmap[zoomLevel].init( str2, 1 );          <span class="comment">// 1-read all bitmaps into memory</span>
00119 
00120     <span class="comment">//-------- set TerrainInfo::bitmap_ptr[] --------//</span>
00121 
00122     <span class="keywordtype">char</span>* bmpPtr;
00123 
00124     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;terrain_count ; i++ ) {
00125         bmpPtr = res_bitmap[zoomLevel].read( info_array[i].file_name );
00126 
00127         info_array[i].bitmap_ptr[zoomLevel] = bmpPtr;
00128     }
00129 }
00130 
00131 <span class="comment">//------------- End of function TerrainRes::load_res --------//</span>
00132 
00133 <span class="comment">//---------- Begin of function TerrainRes::operator[] -----------//</span>
00134 
<a name="l00135"></a><a class="code" href="classTerrainRes.html#a4">00135</a> <a class="code" href="structTerrainInfo.html">TerrainInfo</a>* <a class="code" href="classTerrainRes.html#a4">TerrainRes::operator[]</a>(<span class="keywordtype">int</span> terrainId) {
00136     <a class="code" href="ALL_8H.html#a2">err_if</a>( terrainId&lt;1 || terrainId&gt;<a class="code" href="classTerrainRes.html#m1">terrain_count</a> )
00137         <a class="code" href="ALL_8H.html#a4">err_now</a>( <span class="stringliteral">"TerrainRes::operator[]"</span> );
00138 
00139     <span class="keywordflow">return</span> <a class="code" href="classTerrainRes.html#m2">info_array</a>+terrainId-1;
00140 }
00141 
00142 <span class="comment">//------------ End of function TerrainRes::operator[] -----------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:30 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
