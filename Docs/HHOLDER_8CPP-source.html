<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>HHOLDER.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>HHOLDER.CPP</h1><a href="HHOLDER_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Owner: Fred</span>
00002 <span class="comment">//$$ hholder.cpp                                   QR decomposition</span>
00003 
00004 <span class="comment">// Copyright (C) 1991,2,3,4: R B Davies</span>
00005 
<a name="l00006"></a><a class="code" href="HHOLDER_8CPP.html#a0">00006</a> <span class="preprocessor">#define WANT_MATH</span>
00007 <span class="preprocessor"></span>
00008 <span class="preprocessor">#include "include.h"</span>
00009 
00010 <span class="preprocessor">#include "newmatap.h"</span>
00011 
00012 <span class="preprocessor">#ifdef use_namespace</span>
00013 <span class="preprocessor"></span><span class="keyword">namespace </span>NEWMAT {
00014 <span class="preprocessor">#endif</span>
00015 <span class="preprocessor"></span>
00016     <span class="comment">/*************************** QR decompositions ***************************/</span>
00017 
00018     <span class="keyword">inline</span> <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> <a class="code" href="namespaceNEWMAT.html#a1">square</a>(<a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> x) { <span class="keywordflow">return</span> x*x; }
00019 
<a name="l00020"></a><a class="code" href="namespaceNEWMAT.html#a11">00020</a>     <span class="keywordtype">void</span> <a class="code" href="namespaceNEWMAT.html#a11">QRZT</a>(<a class="code" href="classNEWMAT_1_1Matrix.html">Matrix</a>&amp; X, <a class="code" href="classNEWMAT_1_1LowerTriangularMatrix.html">LowerTriangularMatrix</a>&amp; L) {
00021         <a class="code" href="classTracer.html">Tracer</a> et(<span class="stringliteral">"QZT(1)"</span>);
00022         <span class="keywordtype">int</span> n = X.<a class="code" href="classNEWMAT_1_1GeneralMatrix.html#a3">Ncols</a>(); <span class="keywordtype">int</span> s = X.<a class="code" href="classNEWMAT_1_1GeneralMatrix.html#a2">Nrows</a>(); L.<a class="code" href="classNEWMAT_1_1LowerTriangularMatrix.html#a21">ReSize</a>(s);
00023         <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* xi = X.<a class="code" href="classNEWMAT_1_1GeneralMatrix.html#a5">Store</a>(); <span class="keywordtype">int</span> k;
00024         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;s; i++) {
00025             <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> sum = 0.0;
00026             <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* xi0=xi; k=n; <span class="keywordflow">while</span>(k--) { sum += <a class="code" href="namespaceNEWMAT.html#a1">square</a>(*xi++); }
00027             sum = sqrt(sum);
00028             L.<a class="code" href="classNEWMAT_1_1LowerTriangularMatrix.html#a9">element</a>(i,i) = sum;
00029             <span class="keywordflow">if</span> (sum==0.0) Throw(<a class="code" href="classNEWMAT_1_1SingularException.html">SingularException</a>(L));
00030             <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* xj0=xi0; k=n; <span class="keywordflow">while</span>(k--) { *xj0++ /= sum; }
00031             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=i+1; j&lt;s; j++) {
00032                 sum=0.0;
00033                 xi=xi0; <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* xj=xj0; k=n; <span class="keywordflow">while</span>(k--) { sum += *xi++ * *xj++; }
00034                 xi=xi0; k=n; <span class="keywordflow">while</span>(k--) { *xj0++ -= sum * *xi++; }
00035                 L.<a class="code" href="classNEWMAT_1_1LowerTriangularMatrix.html#a9">element</a>(j,i) = sum;
00036             }
00037         }
00038     }
00039 
<a name="l00040"></a><a class="code" href="HHOLDER_8CPP.html#a12">00040</a>     <span class="keywordtype">void</span> <a class="code" href="namespaceNEWMAT.html#a11">QRZT</a>(<span class="keyword">const</span> <a class="code" href="classMatrix.html">Matrix</a>&amp; X, <a class="code" href="classMatrix.html">Matrix</a>&amp; Y, <a class="code" href="classMatrix.html">Matrix</a>&amp; M) {
00041         <a class="code" href="classTracer.html">Tracer</a> et(<span class="stringliteral">"QRZT(2)"</span>);
00042         <span class="keywordtype">int</span> n = X.Ncols(); <span class="keywordtype">int</span> s = X.Nrows(); <span class="keywordtype">int</span> t = Y.Nrows();
00043         <span class="keywordflow">if</span> (Y.Ncols() != n)
00044         { Throw(ProgramException(<span class="stringliteral">"Unequal row lengths"</span>,X,Y)); }
00045         M.ReSize(t,s);
00046         <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* xi = X.Store(); <span class="keywordtype">int</span> k;
00047         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;s; i++) {
00048             <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* xj0 = Y.Store(); <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* xi0 = xi;
00049             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;t; j++) {
00050                 <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> sum=0.0;
00051                 xi=xi0; <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* xj=xj0; k=n; <span class="keywordflow">while</span>(k--) { sum += *xi++ * *xj++; }
00052                 xi=xi0; k=n; <span class="keywordflow">while</span>(k--) { *xj0++ -= sum * *xi++; }
00053                 M.element(j,i) = sum;
00054             }
00055         }
00056     }
00057 
00058     <span class="comment">/*</span>
00059 <span class="comment">      void QRZ(Matrix&amp; X, UpperTriangularMatrix&amp; U)</span>
00060 <span class="comment">      {</span>
00061 <span class="comment">      Tracer et("QRZ(1)");</span>
00062 <span class="comment">      int n = X.Nrows(); int s = X.Ncols(); U.ReSize(s);</span>
00063 <span class="comment">      Real* xi0 = X.Store(); int k;</span>
00064 <span class="comment">      for (int i=0; i&lt;s; i++)</span>
00065 <span class="comment">      {</span>
00066 <span class="comment">      Real sum = 0.0;</span>
00067 <span class="comment">      Real* xi = xi0; k=n; while(k--) { sum += square(*xi); xi+=s; }</span>
00068 <span class="comment">      sum = sqrt(sum);</span>
00069 <span class="comment">      U.element(i,i) = sum;</span>
00070 <span class="comment">      if (sum==0.0) Throw(SingularException(U));</span>
00071 <span class="comment">      Real* xj0=xi0; k=n; while(k--) { *xj0 /= sum; xj0+=s; }</span>
00072 <span class="comment">      xj0 = xi0;</span>
00073 <span class="comment">      for (int j=i+1; j&lt;s; j++)</span>
00074 <span class="comment">      {</span>
00075 <span class="comment">      sum=0.0;</span>
00076 <span class="comment">      xi=xi0; k=n; xj0++; Real* xj=xj0;</span>
00077 <span class="comment">      while(k--) { sum += *xi * *xj; xi+=s; xj+=s; }</span>
00078 <span class="comment">      xi=xi0; k=n; xj=xj0;</span>
00079 <span class="comment">      while(k--) { *xj -= sum * *xi; xj+=s; xi+=s; }</span>
00080 <span class="comment">      U.element(i,j) = sum;</span>
00081 <span class="comment">      }</span>
00082 <span class="comment">      xi0++;</span>
00083 <span class="comment">      }</span>
00084 <span class="comment">      }</span>
00085 <span class="comment">    */</span>
00086 
<a name="l00087"></a><a class="code" href="namespaceNEWMAT.html#a13">00087</a>     <span class="keywordtype">void</span> <a class="code" href="namespaceNEWMAT.html#a13">QRZ</a>(<a class="code" href="classNEWMAT_1_1Matrix.html">Matrix</a>&amp; X, <a class="code" href="classNEWMAT_1_1UpperTriangularMatrix.html">UpperTriangularMatrix</a>&amp; U) {
00088         <a class="code" href="classTracer.html">Tracer</a> et(<span class="stringliteral">"QRZ(1)"</span>);
00089         <span class="keywordtype">int</span> n = X.<a class="code" href="classNEWMAT_1_1GeneralMatrix.html#a2">Nrows</a>(); <span class="keywordtype">int</span> s = X.<a class="code" href="classNEWMAT_1_1GeneralMatrix.html#a3">Ncols</a>(); U.<a class="code" href="classNEWMAT_1_1UpperTriangularMatrix.html#a21">ReSize</a>(s); U = 0.0;
00090         <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* xi0 = X.<a class="code" href="classNEWMAT_1_1GeneralMatrix.html#a5">Store</a>(); <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* u0 = U.<a class="code" href="classNEWMAT_1_1GeneralMatrix.html#a5">Store</a>(); <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* u;
00091         <span class="keywordtype">int</span> j, k; <span class="keywordtype">int</span> J = s; <span class="keywordtype">int</span> i = s;
00092         <span class="keywordflow">while</span> (i--) {
00093             <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* xj0 = xi0; <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* xi = xi0; k = n;
00094             <span class="keywordflow">while</span>(k--) {
00095                 u = u0; <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> Xi = *xi; xi += s; <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* xj = xj0; xj0 += s;
00096                 j = J; <span class="keywordflow">while</span>(j--) *u++ += Xi * *xj++;
00097             }
00098 
00099             <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> sum = sqrt(*u0); *u0 = sum; u = u0+1;
00100             <span class="keywordflow">if</span> (sum == 0.0) Throw(<a class="code" href="classNEWMAT_1_1SingularException.html">SingularException</a>(U));
00101             <span class="keywordtype">int</span> J1 = J-1; j = J1; <span class="keywordflow">while</span>(j--) *u++ /= sum;
00102 
00103             xj0 = xi0; xi = xi0++; k = n; <span class="keywordflow">while</span>(k--) {
00104                 u = u0+1; <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> Xi = *xi; xi += s; <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* xj = xj0; xj0 += s;
00105                 Xi /= sum; *xj++ = Xi;
00106                 j = J1; <span class="keywordflow">while</span>(j--) *xj++ -= *u++ * Xi;
00107 
00108             }
00109             u0 += J--;
00110         }
00111     }
00112 
<a name="l00113"></a><a class="code" href="HHOLDER_8CPP.html#a14">00113</a>     <span class="keywordtype">void</span> <a class="code" href="namespaceNEWMAT.html#a13">QRZ</a>(<span class="keyword">const</span> <a class="code" href="classMatrix.html">Matrix</a>&amp; X, <a class="code" href="classMatrix.html">Matrix</a>&amp; Y, <a class="code" href="classMatrix.html">Matrix</a>&amp; M) {
00114         <a class="code" href="classTracer.html">Tracer</a> et(<span class="stringliteral">"QRZ(2)"</span>);
00115         <span class="keywordtype">int</span> n = X.Nrows(); <span class="keywordtype">int</span> s = X.Ncols(); <span class="keywordtype">int</span> t = Y.Ncols();
00116         <span class="keywordflow">if</span> (Y.Nrows() != n)
00117         { Throw(ProgramException(<span class="stringliteral">"Unequal column lengths"</span>,X,Y)); }
00118         M.ReSize(s,t); M = 0;<a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* m0 = M.Store(); <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* m;
00119         <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* xi0 = X.Store();
00120         <span class="keywordtype">int</span> j, k; <span class="keywordtype">int</span> i = s;
00121         <span class="keywordflow">while</span> (i--) {
00122             <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* xj0 = Y.Store(); <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* xi = xi0; k = n; <span class="keywordflow">while</span>(k--) {
00123                 m = m0; <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> Xi = *xi; xi += s; <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* xj = xj0; xj0 += t;
00124                 j = t; <span class="keywordflow">while</span>(j--) *m++ += Xi * *xj++;
00125             }
00126 
00127             xj0 = Y.Store(); xi = xi0++; k = n; <span class="keywordflow">while</span>(k--) {
00128                 m = m0; <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> Xi = *xi; xi += s; <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* xj = xj0; xj0 += t;
00129                 j = t; <span class="keywordflow">while</span>(j--) *xj++ -= *m++ * Xi;
00130             }
00131             m0 += t;
00132         }
00133     }
00134 
00135     <span class="comment">/*</span>
00136 <span class="comment"></span>
00137 <span class="comment">      void QRZ(const Matrix&amp; X, Matrix&amp; Y, Matrix&amp; M)</span>
00138 <span class="comment">      {</span>
00139 <span class="comment">      Tracer et("QRZ(2)");</span>
00140 <span class="comment">      int n = X.Nrows(); int s = X.Ncols(); int t = Y.Ncols();</span>
00141 <span class="comment">      if (Y.Nrows() != n)</span>
00142 <span class="comment">      { Throw(ProgramException("Unequal column lengths",X,Y)); }</span>
00143 <span class="comment">      M.ReSize(s,t);</span>
00144 <span class="comment">      Real* xi0 = X.Store(); int k;</span>
00145 <span class="comment">      for (int i=0; i&lt;s; i++)</span>
00146 <span class="comment">      {</span>
00147 <span class="comment">      Real* xj0 = Y.Store();</span>
00148 <span class="comment">      for (int j=0; j&lt;t; j++)</span>
00149 <span class="comment">      {</span>
00150 <span class="comment">      Real sum=0.0;</span>
00151 <span class="comment">      Real* xi=xi0; Real* xj=xj0; k=n;</span>
00152 <span class="comment">      while(k--) { sum += *xi * *xj; xi+=s; xj+=t; }</span>
00153 <span class="comment">      xi=xi0; k=n; xj=xj0++;</span>
00154 <span class="comment">      while(k--) { *xj -= sum * *xi; xj+=t; xi+=s; }</span>
00155 <span class="comment">      M.element(i,j) = sum;</span>
00156 <span class="comment">      }</span>
00157 <span class="comment">      xi0++;</span>
00158 <span class="comment">      }</span>
00159 <span class="comment">      }</span>
00160 <span class="comment">    */</span>
00161 
00162 <span class="preprocessor">#ifdef use_namespace</span>
00163 <span class="preprocessor"></span>}
00164 <span class="preprocessor">#endif</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:02 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
