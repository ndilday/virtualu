<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Ogrparea.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Ogrparea.cpp</h1><a href="Ogrparea_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OGraphArea.CPP</span>
00002 <span class="comment">//Description : Object GraphArea</span>
00003 <span class="comment">//Owner                 : Kevin(Ho)</span>
00004 
00005 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;<a class="code" href="COLOR_8H.html">COLOR.H</a>&gt;</span>
00007 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>
00008 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00010 <span class="preprocessor">#include &lt;OFONT.H&gt;</span>
00011 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00012 <span class="preprocessor">#include &lt;<a class="code" href="OGRPAREA_8H.html">OGRPAREA.H</a>&gt;</span>
00013 <span class="preprocessor">#include &lt;OFINANCE.H&gt;</span>
00014 <span class="preprocessor">#include &lt;OIFACE.H&gt;</span>
00015 
00016 <span class="preprocessor">#include &lt;math.h&gt;</span>
00017 
00018 <span class="comment">//--------- Define macro constant -----------//</span>
00019 
<a name="l00020"></a><a class="code" href="Ogrparea_8cpp.html#a0">00020</a> <span class="preprocessor">#define MAX_LEN_LABEL "$1,000,000"</span>
00021 <span class="preprocessor"></span>
00022 <span class="keyword">static</span> <span class="keywordtype">int</span> default_series_color[] = {
00023     <a class="code" href="COLOR_8H.html#a21">V_BLUE</a>,
00024     <a class="code" href="COLOR_8H.html#a22">V_VIOLET</a>,
00025     <a class="code" href="COLOR_8H.html#a20">V_GREEN</a>,
00026     <a class="code" href="COLOR_8H.html#a19">V_RED</a>,
00027     <a class="code" href="COLOR_8H.html#a25">V_YELLOW</a>,
00028     <a class="code" href="COLOR_8H.html#a23">V_BROWN</a>,
00029     <a class="code" href="COLOR_8H.html#a18">V_ORANGE</a>,
00030     <a class="code" href="COLOR_8H.html#a24">V_PINK</a>,
00031     <a class="code" href="COLOR_8H.html#a15">V_BLACK</a>,
00032     <a class="code" href="COLOR_8H.html#a17">V_WHITE</a>,
00033 };                                                <span class="comment">// 10 default series colors</span>
00034 
00035 <span class="keyword">enum</span> {  <a class="code" href="Ogrparea_8cpp.html#a7a2">DEFAULT_SERIES_COLOR_NUM</a> = 10 };
00036 
00037 <span class="keyword">enum</span> {
00038     <a class="code" href="Ogrparea_8cpp.html#a8a3">LEGEND_SIZE</a> = 11,
00039     <a class="code" href="Ogrparea_8cpp.html#a8a4">LEGEND_X_SPACING</a> = 12,
00040     <a class="code" href="Ogrparea_8cpp.html#a8a5">LEGEND_Y_SPACING</a> = 2,
00041 };
00042 
00043 <span class="keyword">enum</span> {  <a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a> = 2         };
00044 
00045 <span class="comment">//-------------- Define static vars ------------//</span>
00046 
00047 <span class="comment">//static char paint_flag = 0;</span>
00048 
00049 <span class="comment">//-------- Begin of function GraphArea::GraphArea ----//</span>
<a name="l00051"></a><a class="code" href="classGraphArea.html#a0">00051</a> <span class="comment">GraphArea::GraphArea() {</span>
00052     init_flag = 0;
00053     GraphArea_bitmap = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00054 }
00055 
00056 <span class="comment">//---------- End of function GraphArea::GraphArea ----//</span>
00057 
00058 <span class="comment">//-------- Begin of function GraphArea::~GraphArea -----//</span>
<a name="l00060"></a><a class="code" href="classGraphArea.html#a1">00060</a> <span class="comment">GraphArea::~GraphArea() {</span>
00061     deinit();
00062 }
00063 
00064 <span class="comment">//---------- End of function GraphArea::~GraphArea -----//</span>
00065 
00066 <span class="comment">//-------- Begin of function GraphArea::init --------//</span>
00100 <span class="comment">void GraphArea::init(int x1, int y1, int x2, int y2, int seriesNum, int *dataNum,</span>
00101                      <span class="keywordtype">void</span> *dataArray, <span class="keywordtype">char</span> dataTypeFlag,<span class="keywordtype">int</span> thisYearIndicator,
00102                      <span class="keywordtype">char</span> *xLabel, <span class="keywordtype">char</span> *yLabel,
00103                      <span class="keywordtype">char</span> **legendArray, <span class="keywordtype">char</span> transparentFlag,
00104                      <span class="keywordtype">char</span> orientationFlag, <span class="keywordtype">char</span> valueFlag,
00105                      <span class="keywordtype">int</span> numFormat, <span class="keywordtype">int</span> *seriesColor, <span class="keywordtype">int</span> axisColor) {
00106     <a class="code" href="ALL_8H.html#a0">err_when</a>(seriesNum &gt; <a class="code" href="Ogrparea_8cpp.html#a7a2">DEFAULT_SERIES_COLOR_NUM</a> &amp;&amp; !seriesColor);
00107     <a class="code" href="ALL_8H.html#a0">err_when</a>(seriesNum &lt;= 0);
00108     <span class="comment">//  err_when(*xEnd &lt; *xStart);</span>
00109 
00110     graph_width = x2 - x1 - 6;
00111 
00112     <a class="code" href="ALL_8H.html#a0">err_when</a>(graph_width &lt; 0);
00113 
00114     GraphArea_x1 = x1;
00115     GraphArea_y1 = y1;
00116     GraphArea_x2 = x2;
00117     GraphArea_y2 = y2;
00118 
00119     series_num = seriesNum;
00120     data_num = dataNum;
00121     data_array = dataArray;
00122     data_type_flag = dataTypeFlag;
00123     <span class="comment">//  x_start = xStart;</span>
00124     <span class="comment">//  x_end = xEnd;</span>
00125 
00126     x_label = xLabel;
00127     y_label = yLabel;
00128     legend_array = legendArray;
00129 
00130     transparent_flag = transparentFlag;
00131     orientation_flag = orientationFlag;
00132     value_flag = valueFlag;
00133     num_format = numFormat;
00134 
00135     series_color = seriesColor ? seriesColor : default_series_color;
00136     axis_color = axisColor;
00137 
00138     init_flag = 1;
00139 
00140     y_label_max_len = font_chartsm.text_width(<a class="code" href="Ogrparea_8cpp.html#a0">MAX_LEN_LABEL</a>);
00141     set_font(&amp;font_chartsm);
00142 
00143     <span class="comment">//  paint();</span>
00144 }
00145 
00146 <span class="comment">//------------- End of function GraphArea::init -----------//</span>
00147 
00148 <span class="comment">//-------- Begin of function GraphArea::deinit ------------//</span>
<a name="l00150"></a><a class="code" href="classGraphArea.html#a7">00150</a> <span class="comment">void GraphArea::deinit() {</span>
00151     <span class="keywordflow">if</span> (GraphArea_bitmap) {
00152         <a class="code" href="ALL_8H.html#a8">mem_del</a>(GraphArea_bitmap);
00153         GraphArea_bitmap = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00154     }
00155 
00156     init_flag = 0;
00157 }
00158 
00159 <span class="comment">//------------- End of function GraphArea::deinit ---------//</span>
00160 
00161 <span class="comment">//-------- Begin of function GraphArea::set_font ------------//</span>
<a name="l00163"></a><a class="code" href="classGraphArea.html#a10">00163</a> <span class="comment">void GraphArea::set_font(Font *fontPtr) {</span>
00164     <span class="keywordflow">if</span> (!init_flag)
00165         <span class="keywordflow">return</span>;
00166 
00167     font_ptr = fontPtr;
00168 
00169     calc_pos();
00170 }
00171 
00172 <span class="comment">//------------- End of function GraphArea::set_font ---------//</span>
00173 
00174 <span class="comment">//-------- Begin of function GraphArea::calc_pos ------------//</span>
<a name="l00179"></a><a class="code" href="classGraphArea.html#a11">00179</a> <span class="comment">void GraphArea::calc_pos() {</span>
00180     <span class="keywordflow">if</span> (legend_array) {
00181         <span class="keywordtype">short</span> textWidth = 0, textHeight = font_ptr-&gt;max_font_height;
00182 
00183         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 2+series_num; i++) {
00184             <span class="keywordflow">if</span> (font_ptr-&gt;text_width(legend_array[i]) &gt; textWidth)
00185                 textWidth = font_ptr-&gt;text_width(legend_array[i]);
00186         }
00187 
00188         <a class="code" href="ALL_8H.html#a0">err_when</a>(textWidth + <a class="code" href="Ogrparea_8cpp.html#a8a4">LEGEND_X_SPACING</a> * 2 &gt; graph_width);
00189 
00190         legend_x_num = (graph_width - <a class="code" href="Ogrparea_8cpp.html#a8a4">LEGEND_X_SPACING</a>*2) / (textWidth + <a class="code" href="Ogrparea_8cpp.html#a8a4">LEGEND_X_SPACING</a>*2);
00191         legend_y_num = ((2+series_num) / legend_x_num) + (((2+series_num) % legend_x_num) ? 1 : 0);
00192 
00193         graph_height = GraphArea_y2 - GraphArea_y1 - legend_y_num * (textHeight + <a class="code" href="Ogrparea_8cpp.html#a8a5">LEGEND_Y_SPACING</a>) - 6;
00194 
00195         <a class="code" href="ALL_8H.html#a0">err_when</a>(graph_height &lt;= 0);
00196 
00197         legend_width = (graph_width - <a class="code" href="Ogrparea_8cpp.html#a8a4">LEGEND_X_SPACING</a>*2) / legend_x_num;
00198         legend_height = textHeight + <a class="code" href="Ogrparea_8cpp.html#a8a5">LEGEND_Y_SPACING</a>;
00199     }
00200     <span class="keywordflow">else</span> {
00201         legend_width = legend_height = legend_x_num = legend_y_num = 0;
00202         graph_height = GraphArea_y2 - GraphArea_y1 - 6;
00203     }
00204 
00205     <span class="keywordtype">short</span> YLabelWidth = y_label ? (orientation_flag ? font_ptr-&gt;max_font_height : font_ptr-&gt;text_width(y_label)) : -<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>;
00206     <span class="keywordtype">short</span> XLabelHeight = x_label ? (font_ptr-&gt;max_font_height) : -<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>;
00207     series_x1 = GraphArea_x1 + 4 + <a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>*4 + YLabelWidth + y_label_max_len;
00208     series_y1 = GraphArea_y1 + 4 + <a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>*6;
00209     series_x2 = GraphArea_x2 - 4 - <a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>*16;
00210     series_y2 = GraphArea_y1 + graph_height - <a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>*3 - (font_ptr-&gt;max_font_height) - XLabelHeight;
00211 }
00212 
00213 <span class="comment">//------------ End of function GraphArea::calc_pos ---------//</span>
00214 
00215 <span class="comment">//-------- Begin of function GraphArea::paint --------------//</span>
<a name="l00217"></a><a class="code" href="classGraphArea.html#a8">00217</a> <span class="comment">void GraphArea::paint() {</span>
00218     <span class="keywordflow">if</span> (transparent_flag) {
00219         user_interface.brighten(GraphArea_x1+4, GraphArea_y1+4, GraphArea_x2-2, GraphArea_y2-2);
00220 
00221         <span class="comment">//              vga.use_back();</span>
00222         <span class="keywordflow">if</span> (legend_array)
00223             draw_legend();
00224         draw_axis_label();
00225         <span class="comment">//              vga.use_front();</span>
00226         GraphArea_bitmap = vga_back.save_area(GraphArea_x1+4, GraphArea_y1+4, GraphArea_x2-2, GraphArea_y2-2, GraphArea_bitmap);
00227     }
00228 
00229     <span class="comment">//  paint_flag = 1;</span>
00230     refresh();
00231 }
00232 
00233 <span class="comment">//------------- End of function GraphArea::paint -----------//</span>
00234 
00235 <span class="comment">//-------- Begin of function GraphArea::refresh ------------//</span>
<a name="l00237"></a><a class="code" href="classGraphArea.html#a9">00237</a> <span class="comment">void GraphArea::refresh() {</span>
00238     <span class="comment">//  vga.use_back();</span>
00239 
00240     <span class="keywordflow">if</span> (transparent_flag) {
00241         user_interface.rect(GraphArea_x1, GraphArea_y1, GraphArea_x2, GraphArea_y2, 1);
00242         vga_back.rest_area(GraphArea_bitmap, 0, 0);
00243     }
00244     <span class="keywordflow">else</span> {
00245         user_interface.bar(GraphArea_x1, GraphArea_y1, GraphArea_x2, GraphArea_y2);
00246         user_interface.panel(GraphArea_x1+3, GraphArea_y1+3, GraphArea_x2-4, GraphArea_y2-4);
00247     }
00248     <span class="keywordflow">if</span> (legend_array)
00249         draw_legend();
00250     draw_scale();
00251     draw_series();
00252     draw_scale();
00253 
00254     <span class="comment">//  vga.use_front();</span>
00255     <span class="comment">//  if (!paint_flag)</span>
00256     <span class="comment">//          vga.blt_buf(GraphArea_x1, GraphArea_y1, GraphArea_x2+2, GraphArea_y2+2);</span>
00257     <span class="comment">//  else</span>
00258     <span class="comment">//          paint_flag = 0;</span>
00259 }
00260 
00261 <span class="comment">//------------- End of function GraphArea::refresh ---------//</span>
00262 
00263 <span class="comment">//---------- Begin of function GraphArea::draw_legend ------------//</span>
<a name="l00265"></a><a class="code" href="classGraphArea.html#b0">00265</a> <span class="comment">void GraphArea::draw_legend() {</span>
00266     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0,c = 0; i &lt; series_num+2; i++) {
00267         <span class="keywordtype">short</span> legendX = GraphArea_x1 + 4 + (c % legend_x_num) * legend_width + <a class="code" href="Ogrparea_8cpp.html#a8a4">LEGEND_X_SPACING</a>;
00268         <span class="keywordtype">short</span> legendY = GraphArea_y1 + 4 + graph_height + (c / legend_x_num) * legend_height;
00269 
00270         <span class="keywordflow">if</span>(*(legend_array[i])==<span class="charliteral">'\0'</span>)
00271             <span class="keywordflow">continue</span>;
00272 
00273         c++;
00274         <span class="keywordflow">if</span>(i&gt;=2)
00275             user_interface.bar( legendX+<a class="code" href="Ogrparea_8cpp.html#a8a4">LEGEND_X_SPACING</a>, legendY+<a class="code" href="Ogrparea_8cpp.html#a8a5">LEGEND_Y_SPACING</a>,
00276                                 legendX+<a class="code" href="Ogrparea_8cpp.html#a8a4">LEGEND_X_SPACING</a>+<a class="code" href="Ogrparea_8cpp.html#a8a3">LEGEND_SIZE</a>, legendY+<a class="code" href="Ogrparea_8cpp.html#a8a5">LEGEND_Y_SPACING</a>+<a class="code" href="Ogrparea_8cpp.html#a8a3">LEGEND_SIZE</a>,
00277                                 series_color[i] );
00278         <span class="keywordflow">else</span>
00279             user_interface.bar( legendX+<a class="code" href="Ogrparea_8cpp.html#a8a4">LEGEND_X_SPACING</a>, legendY+<a class="code" href="Ogrparea_8cpp.html#a8a5">LEGEND_Y_SPACING</a>+<a class="code" href="Ogrparea_8cpp.html#a8a3">LEGEND_SIZE</a>/2-1,
00280                                 legendX+<a class="code" href="Ogrparea_8cpp.html#a8a4">LEGEND_X_SPACING</a>+<a class="code" href="Ogrparea_8cpp.html#a8a3">LEGEND_SIZE</a>, legendY+<a class="code" href="Ogrparea_8cpp.html#a8a5">LEGEND_Y_SPACING</a>+<a class="code" href="Ogrparea_8cpp.html#a8a3">LEGEND_SIZE</a>/2+1,
00281                                 series_color[i] );
00282         font_ptr-&gt;put( legendX+<a class="code" href="Ogrparea_8cpp.html#a8a4">LEGEND_X_SPACING</a>*2+<a class="code" href="Ogrparea_8cpp.html#a8a3">LEGEND_SIZE</a>, legendY+<a class="code" href="Ogrparea_8cpp.html#a8a5">LEGEND_Y_SPACING</a>, legend_array[i] );
00283     }
00284 }
00285 
00286 <span class="comment">//------------ End of function GraphArea::draw_legend ------------//</span>
00287 
00288 <span class="comment">//---------- Begin of function GraphArea::draw_axis_label --------//</span>
<a name="l00290"></a><a class="code" href="classGraphArea.html#b1">00290</a> <span class="comment">void GraphArea::draw_axis_label() {</span>
00291     <span class="keywordtype">short</span> textHeight = font_ptr-&gt;max_font_height;
00292 
00293     <span class="keywordflow">if</span> (x_label) {
00294         font_ptr-&gt;center_put( series_x1, series_y2+<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>*2+textHeight,
00295                               series_x2, GraphArea_y1+graph_height-<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>, x_label );
00296     }
00297 
00298     <span class="keywordflow">if</span> (y_label) {
00299         <span class="keywordtype">short</span> textWidth = font_ptr-&gt;text_width(y_label) + 1;
00300 
00301         <span class="keywordflow">if</span> (orientation_flag) {
00302             <span class="keywordtype">short</span> *fontBuf = (<span class="keywordtype">short</span> *) sys.common_data_buf;
00303             <a class="code" href="ALL_8H.html#a0">err_when</a>(textWidth * textHeight * <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>) &gt; <a class="code" href="Osys_8h.html#a40a2">COMMON_DATA_BUF_SIZE</a>);
00304 
00305             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; textWidth * textHeight; i++)
00306                 *fontBuf++ = transparent_code_w;
00307 
00308             font_ptr-&gt;put_to_bufferW(fontBuf = (<span class="keywordtype">short</span> *) sys.common_data_buf, textWidth * <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>), 0, 0, y_label);
00309 
00310             <span class="keywordtype">short</span> xStart = GraphArea_x1 + 4 + <a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a> * 2;
00311             <span class="keywordtype">short</span> yStart = (series_y1 + series_y2 - textWidth) / 2;
00312 
00313             <span class="keywordflow">for</span> (<span class="keywordtype">short</span> x = 0; x &lt; textHeight; x++) {
00314                 <span class="keywordflow">for</span> (<span class="keywordtype">short</span> y = textWidth - 1; y &gt;= 0; y--, fontBuf++) {
00315                     <span class="keywordflow">if</span> (*fontBuf != transparent_code_w)
00316                         *vga_back.buf_ptr(xStart+x, yStart+y) = *fontBuf;
00317                 }
00318             }
00319         }
00320         <span class="keywordflow">else</span> {
00321             font_ptr-&gt;center_put( GraphArea_x1+4+<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>*2, series_y1,
00322                                   GraphArea_x1+4+<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>*2+textWidth, series_y2, y_label);
00323         }
00324     }
00325 }
00326 
00327 <span class="comment">//------------ End of function GraphArea::draw_axis_label --------//</span>
00328 
00329 <span class="comment">//---------- Begin of function GraphArea::find_scale -------------//</span>
<a name="l00331"></a><a class="code" href="classGraphArea.html#b2">00331</a> <span class="comment">void GraphArea::find_scale() {</span>
00332     <span class="keywordtype">double</span> data, maxVal = 0.0;
00333     x_axis_pos = 0;
00334 
00335     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num * *data_num; i++) {
00336         <span class="keywordflow">switch</span> (data_type_flag) {
00337         <span class="keywordflow">case</span> DATA_DOUBLE:
00338             data = ((<span class="keywordtype">double</span>*)data_array)[i];
00339             <span class="keywordflow">break</span>;
00340         <span class="keywordflow">case</span> DATA_FLOAT:
00341             data = double(((<span class="keywordtype">float</span>*)data_array)[i]);
00342             <span class="keywordflow">break</span>;
00343         <span class="keywordflow">case</span> DATA_INT:
00344             data = double(((<span class="keywordtype">int</span>*)data_array)[i]);
00345             <span class="keywordflow">break</span>;
00346         <span class="keywordflow">case</span> DATA_LONG:
00347             data = double(((<span class="keywordtype">long</span>*)data_array)[i]);
00348             <span class="keywordflow">break</span>;
00349         }
00350         <span class="keywordflow">if</span> (<a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(data) &gt; maxVal)
00351             maxVal = <a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(data);
00352         <span class="keywordflow">if</span> (!x_axis_pos &amp;&amp; data &lt; 0.0)
00353             x_axis_pos = 1;
00354     }
00355     <span class="keywordflow">if</span> (maxVal&gt;0)
00356         max_scale = maxVal;
00357     <span class="comment">//          max_scale = pow(10,ceil(log10(maxVal)));</span>
00358     <span class="keywordflow">else</span>
00359         max_scale = 5;
00360 }
00361 
00362 <span class="comment">//------------ End of function GraphArea::find_scale -------------//</span>
00363 
00364 <span class="comment">//---------- Begin of function GraphArea::draw_scale -------------//</span>
<a name="l00366"></a><a class="code" href="classGraphArea.html#b3">00366</a> <span class="comment">void GraphArea::draw_scale() {</span>
00367     find_scale();
00368 
00369     <span class="keywordtype">short</span> xAxisPos;
00370 
00371     <span class="comment">//------ Draw y-axis -------//</span>
00372 
00373     <span class="keywordflow">if</span> (x_axis_pos)
00374         vga_back.bar(series_x1, series_y1-<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>*2, series_x1+1, series_y2+<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>*2, axis_color);
00375     <span class="keywordflow">else</span>
00376         vga_back.bar(series_x1, series_y1-<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>*2, series_x1+1, series_y2, axis_color);
00377 
00378     <span class="keywordtype">short</span> scaleNum = (series_y2-series_y1-font_ptr-&gt;max_font_height) / (font_ptr-&gt;max_font_height*3/2);
00379     <span class="keywordflow">if</span> ( scaleNum &gt; 0 )
00380         scaleNum = short(pow(2,floor(log10(<span class="keywordtype">double</span>(scaleNum))/log10(2.0))));
00381     <span class="keywordflow">else</span>
00382         scaleNum = 0;
00383     <span class="keywordtype">short</span> scaleStep = (series_y2-series_y1) / scaleNum;
00384     <span class="keywordtype">double</span> scaleValue;
00385     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt;= scaleNum; i++) {
00386         <span class="keywordflow">if</span> ( (x_axis_pos &amp;&amp; i == scaleNum / 2) || !(x_axis_pos || i) )
00387             vga_back.bar(series_x1, xAxisPos=series_y2-i*scaleStep-1, series_x2+<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>*8, series_y2-i*scaleStep, axis_color);
00388         <span class="keywordflow">else</span>
00389             vga_back.bar(series_x1, series_y2-i*scaleStep, series_x1+<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>*2, series_y2-i*scaleStep, axis_color);
00390 
00391         <span class="keywordflow">if</span> (x_axis_pos)
00392             scaleValue = max_scale*2/scaleNum*i - max_scale;
00393         <span class="keywordflow">else</span>
00394             scaleValue = max_scale/scaleNum*i;
00395 
00396         <span class="keywordflow">switch</span> (data_type_flag) {
00397         <span class="keywordflow">case</span> DATA_FLOAT:
00398         <span class="keywordflow">case</span> DATA_DOUBLE:
00399             font_ptr-&gt;right_put(series_x1-<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>, series_y2-i*scaleStep-font_ptr-&gt;max_font_height/2, m.format(scaleValue,num_format));
00400             <span class="keywordflow">break</span>;
00401         <span class="keywordflow">case</span> DATA_INT:
00402         <span class="keywordflow">case</span> DATA_LONG:
00403             font_ptr-&gt;right_put(series_x1-<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>, series_y2-i*scaleStep-font_ptr-&gt;max_font_height/2, m.format(<span class="keywordtype">long</span>(scaleValue),num_format));
00404         }
00405     }
00406 
00407     <span class="comment">// show x-axis scale</span>
00408 
00409     <span class="comment">// At max, how much data points shown for each series</span>
00410     <span class="keywordtype">int</span> data_year_shown=8;
00411 
00412     <span class="comment">// The scales within how much years should be shown</span>
00413     <span class="keywordtype">int</span> scale_year_shown=8;
00414 
00415     <span class="comment">// pesudo year = which year the indicator pointing to</span>
00416     <span class="keywordtype">double</span> pesudo_end;
00417     <span class="comment">// ##### patch begin Gilbert 07/09/2001 ######//</span>
00418     pesudo_end = info.financial_year();
00419     <span class="comment">//  if(info.game_month&lt;finance.fiscal_year_start_month)</span>
00420     <span class="comment">//          pesudo_end=info.game_year-1;</span>
00421     <span class="comment">//  else</span>
00422     <span class="comment">//          pesudo_end=info.game_year;</span>
00423     <span class="comment">// ##### patch end Gilbert 07/09/2001 ######//</span>
00424 
00425     <span class="keywordflow">if</span>(info.graph_year&lt;data_year_shown)
00426         data_year_shown=info.graph_year;
00427 
00428     <span class="keywordtype">short</span> maxLabelWidth = font_ptr-&gt;text_width(m.format(pesudo_end, 16));
00429     <span class="keywordtype">double</span> scaleYearRatio =1.0;
00430     x_axis_step = (series_x2-series_x1) / (scale_year_shown);
00431 
00432     <span class="keywordtype">short</span> displayInc = 1;
00433     <span class="keywordflow">while</span> (displayInc * x_axis_step &lt; maxLabelWidth ) displayInc++;
00434 
00435 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00436 <span class="preprocessor"></span>    <span class="keywordtype">double</span> printing_offset=0.0f;
00437 <span class="preprocessor">#else</span>
00438 <span class="preprocessor"></span>    <span class="keywordtype">double</span> printing_offset=1-finance.fiscal_year_start_month/12.0;
00439 <span class="preprocessor">#endif</span>
00440 <span class="preprocessor"></span>
00441     <span class="keywordtype">int</span> start_printing_year=(int)(pesudo_end+
00442                                   ((this_year_indicator&gt;=0)?this_year_indicator:0)
00443                                   +2-data_year_shown);
00444 
00445     <span class="comment">//  double actual_end_year=(double)info.game_month/12.0+info.game_year+1;</span>
00446     <span class="comment">//  int show_end_year=(int)(actual_end_year-finance.fiscal_year_start_month/12.0);</span>
00447     <span class="comment">//  int show_start_year=show_end_year-year_shown+1;</span>
00448 
00449     <span class="comment">//------ Draw x-axis -------//</span>
00450     <span class="keywordflow">for</span> (i = 0; i &lt; scale_year_shown ; i += displayInc) {
00451         vga_back.bar(
00452             (<span class="keywordtype">int</span>)(series_x1+(printing_offset+i)*x_axis_step),
00453             xAxisPos-<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>*2,
00454             (<span class="keywordtype">int</span>)(series_x1+(printing_offset+i)*x_axis_step),
00455             xAxisPos+<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>*2, axis_color);
00456         font_ptr-&gt;center_put(
00457             (<span class="keywordtype">int</span>)(series_x1+(printing_offset+i)*x_axis_step)-maxLabelWidth/2-<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>,
00458             xAxisPos+<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>,
00459             (<span class="keywordtype">int</span>)(series_x1+(printing_offset+i)*x_axis_step)+maxLabelWidth/2+<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>,
00460             xAxisPos+<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>+font_ptr-&gt;max_font_height,
00461             m.format((<span class="keywordtype">int</span>)(start_printing_year+i/scaleYearRatio), 16));
00462     }
00463 
00464     <span class="comment">//---- Draw this year indicators ----//</span>
00465     <span class="keywordflow">if</span>((this_year_indicator&gt;=0)&amp;&amp;(this_year_indicator&lt;HISTORY_YEAR_COUNT))
00466         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=series_y1;j&lt;series_y2+<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>;j+=8)
00467             vga_back.bar(
00468                 (<span class="keywordtype">int</span>)(series_x1+(data_year_shown-this_year_indicator-2)*x_axis_step),
00469                 j,
00470                 (<span class="keywordtype">int</span>)(series_x1+(data_year_shown-this_year_indicator-2)*x_axis_step),
00471                 j+4,
00472                 axis_color);
00473 }
00474 
00475 <span class="comment">//------------ End of function GraphArea::draw_scale -------------//</span>
00476 
00477 <span class="comment">//---------- Begin of function GraphArea::draw_series ------------//</span>
<a name="l00479"></a><a class="code" href="classGraphArea.html#b4">00479</a> <span class="comment">void GraphArea::draw_series() {</span>
00480     <span class="keywordflow">switch</span> (data_type_flag) {
00481     <span class="keywordflow">case</span> DATA_FLOAT: draw_series_float(); <span class="keywordflow">break</span>;
00482     <span class="keywordflow">case</span> DATA_DOUBLE: draw_series_double(); <span class="keywordflow">break</span>;
00483     <span class="keywordflow">case</span> DATA_INT: draw_series_int(); <span class="keywordflow">break</span>;
00484     <span class="keywordflow">case</span> DATA_LONG: draw_series_long(); <span class="keywordflow">break</span>;
00485     }
00486 }
00487 
00488 <span class="comment">//------------ End of function GraphArea::draw_series ------------//</span>
00489 
00490 <span class="comment">//---------- Begin of function GraphArea::draw_series_float ------------//</span>
<a name="l00492"></a><a class="code" href="classGraphArea.html#b5">00492</a> <span class="comment">void GraphArea::draw_series_float() {</span>
00493     <span class="keywordtype">float</span> *dataArray = (<span class="keywordtype">float</span> *) data_array;
00494     <span class="keywordtype">short</span> prevX, prevY, currX, currY;
00495     <span class="keywordtype">short</span> prevY2, currY2;
00496     <span class="keywordtype">short</span> fillY, fillY2;
00497     <span class="keywordtype">double</span> m,m2;
00498 
00499     <span class="comment">//Filling region</span>
00500     prevX = series_x1;
00501 
00502     dataArray-=info.graph_year;
00503     dataArray+=*data_num;
00504 
00505     <span class="comment">// Find Y by dataArray</span>
00506     <span class="keywordflow">if</span> (x_axis_pos)
00507         prevY = (short)(series_y2 - ((*dataArray+float(max_scale)) * (series_y2-series_y1) / float(max_scale*2)));
00508     <span class="keywordflow">else</span>
00509         prevY = (short)(series_y2 - *dataArray * (series_y2-series_y1) / float(max_scale));
00510     <span class="keywordflow">if</span> (x_axis_pos)
00511         prevY2 = (short)(series_y2 - ((*(dataArray+(*data_num))+float(max_scale)) * (series_y2-series_y1) / float(max_scale*2)));
00512     <span class="keywordflow">else</span>
00513         prevY2 = (short)(series_y2 - *(dataArray+(*data_num)) * (series_y2-series_y1) / float(max_scale));
00514 
00515     dataArray++;
00516 
00517     vga_back.thick_line(prevX, prevY, prevX+1, prevY, vga_back.translate_color(series_color[0]));
00518     vga_back.thick_line(prevX, prevY2, prevX+1, prevY2, vga_back.translate_color(series_color[1]));
00519 
00520     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt; info.graph_year; j++) {
00521         currX = series_x1 + j * x_axis_step;
00522         <span class="keywordflow">if</span> (x_axis_pos)
00523             currY = (short)(series_y2 - ((*dataArray+float(max_scale)) * (series_y2-series_y1) / float(max_scale*2)));
00524         <span class="keywordflow">else</span>
00525             currY = (short)(series_y2 - *dataArray * (series_y2-series_y1) / float(max_scale));
00526 
00527         <span class="keywordflow">if</span> (x_axis_pos)
00528             currY2 = (short)(series_y2 - ((*(dataArray+(*data_num))+float(max_scale)) * (series_y2-series_y1) / float(max_scale*2)));
00529         <span class="keywordflow">else</span>
00530             currY2 = (short)(series_y2 - *(dataArray+(*data_num)) * (series_y2-series_y1) / float(max_scale));
00531 
00532         <span class="comment">// filling region</span>
00533         m=((double)currY-prevY)/x_axis_step;
00534         m2=((double)currY2-prevY2)/x_axis_step;
00535 
00536         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;x_axis_step;i++) {
00537             fillY=(int)(m*i+prevY);
00538             fillY2=(int)(m2*i+prevY2);
00539             <span class="keywordflow">if</span>(fillY&gt;fillY2) {
00540                 <span class="keywordflow">if</span>(*(legend_array[3])!=<span class="charliteral">'\0'</span>)
00541                     vga_back.line(prevX+i, fillY, prevX+i, fillY2, vga_back.translate_color(series_color[3]));
00542             }
00543             <span class="keywordflow">else</span>
00544                 vga_back.line(prevX+i, fillY, prevX+i, fillY2, vga_back.translate_color(series_color[2]));
00545         }
00546 
00547         <span class="comment">// draw lines</span>
00548         vga_back.thick_line(prevX, prevY, currX, currY, vga_back.translate_color(series_color[0]));
00549         vga_back.thick_line(prevX, prevY2, currX, currY2, vga_back.translate_color(series_color[1]));
00550 
00551         prevX = currX;
00552         prevY = currY;
00553         prevY2 = currY2;
00554         dataArray++;
00555     }
00556 
00557     <span class="keywordflow">if</span> (value_flag) {
00558         draw_value(dataArray-1, vga_back.translate_color(series_color[0]), prevX+<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>-(int)(x_axis_step*0.5), prevY-font_news.max_font_height, DATA_FLOAT);
00559         draw_value(dataArray+(*data_num-1), vga_back.translate_color(series_color[1]), prevX+<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>-(int)(x_axis_step*0.5), prevY2, DATA_FLOAT);
00560     }
00561 
00562     <span class="comment">//---------------Draw the remain lines if they exist-----------//</span>
00563     <span class="keywordflow">if</span>(series_num&gt;2) {
00564         dataArray+=(*data_num);
00565 
00566         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 2; i &lt; series_num; i++) {
00567             dataArray-=(info.graph_year);
00568             dataArray+=(*data_num);
00569             prevX = series_x1;
00570             <span class="keywordflow">if</span> (x_axis_pos)
00571                 prevY = series_y2 - short(((*dataArray+<span class="keywordtype">float</span>(max_scale)) * <span class="keywordtype">float</span>(series_y2-series_y1) / <span class="keywordtype">float</span>(max_scale*2)));
00572             <span class="keywordflow">else</span>
00573                 prevY = series_y2 - short(*dataArray * <span class="keywordtype">float</span>(series_y2-series_y1) / <span class="keywordtype">float</span>(max_scale));
00574 
00575             dataArray++;
00576 
00577             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt; (info.graph_year); j++) {
00578                 currX = series_x1 + j * x_axis_step;
00579                 <span class="keywordflow">if</span> (x_axis_pos)
00580                     currY = series_y2 - short(((*dataArray+<span class="keywordtype">float</span>(max_scale)) * <span class="keywordtype">float</span>(series_y2-series_y1) / <span class="keywordtype">float</span>(max_scale*2)));
00581                 <span class="keywordflow">else</span>
00582                     currY = series_y2 - short(*dataArray * <span class="keywordtype">float</span>(series_y2-series_y1) / <span class="keywordtype">float</span>(max_scale));
00583 
00584                 vga_back.thick_line(prevX, prevY, currX, currY, vga_back.translate_color(series_color[i+2]));
00585 
00586                 prevX = currX;
00587                 prevY = currY;
00588                 dataArray++;
00589             }
00590             <span class="keywordflow">if</span> (value_flag)
00591                 draw_value(dataArray-1, vga_back.translate_color(series_color[i+2]), prevX+<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>-(int)(x_axis_step*0.5), prevY, DATA_FLOAT);
00592         }
00593     }
00594 }
00595 
00596 <span class="comment">//------------ End of function GraphArea::draw_series_float ------------//</span>
00597 
00598 <span class="comment">//---------- Begin of function GraphArea::draw_series_double ------------//</span>
<a name="l00600"></a><a class="code" href="classGraphArea.html#b6">00600</a> <span class="comment">void GraphArea::draw_series_double() {</span>
00601     <span class="keywordtype">double</span> *dataArray = (<span class="keywordtype">double</span> *) data_array;
00602     <span class="keywordtype">short</span> prevX, prevY, currX, currY;
00603     <span class="keywordtype">short</span> prevY2, currY2;
00604     <span class="keywordtype">short</span> fillY, fillY2;
00605     <span class="keywordtype">double</span> m,m2;
00606 
00607     <span class="comment">//Filling region</span>
00608     prevX = series_x1;
00609     dataArray-=(info.graph_year);
00610     dataArray+=*data_num;
00611 
00612     <span class="comment">// Find Y by dataArray</span>
00613     <span class="keywordflow">if</span> (x_axis_pos)
00614         prevY = (short)(series_y2 - ((*dataArray+double(max_scale)) * (series_y2-series_y1) / double(max_scale*2)));
00615     <span class="keywordflow">else</span>
00616         prevY = (short)(series_y2 - *dataArray * (series_y2-series_y1) / double(max_scale));
00617     <span class="keywordflow">if</span> (x_axis_pos)
00618         prevY2 = (short)(series_y2 - ((*(dataArray+(*data_num))+double(max_scale)) * (series_y2-series_y1) / double(max_scale*2)));
00619     <span class="keywordflow">else</span>
00620         prevY2 = (short)(series_y2 - *(dataArray+(*data_num)) * (series_y2-series_y1) / double(max_scale));
00621 
00622     dataArray++;
00623 
00624     vga_back.thick_line(prevX, prevY, prevX+1, prevY, vga_back.translate_color(series_color[0]));
00625     vga_back.thick_line(prevX, prevY2, prevX+1, prevY2, vga_back.translate_color(series_color[1]));
00626 
00627     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt; (info.graph_year); j++) {
00628         currX = series_x1 + j * x_axis_step;
00629         <span class="keywordflow">if</span> (x_axis_pos)
00630             currY = (short)(series_y2 - ((*dataArray+double(max_scale)) * (series_y2-series_y1) / double(max_scale*2)));
00631         <span class="keywordflow">else</span>
00632             currY = (short)(series_y2 - *dataArray * (series_y2-series_y1) / double(max_scale));
00633 
00634         <span class="keywordflow">if</span> (x_axis_pos)
00635             currY2 = (short)(series_y2 - ((*(dataArray+(*data_num))+double(max_scale)) * (series_y2-series_y1) / double(max_scale*2)));
00636         <span class="keywordflow">else</span>
00637             currY2 = (short)(series_y2 - *(dataArray+(*data_num)) * (series_y2-series_y1) / double(max_scale));
00638 
00639         <span class="comment">// filling region</span>
00640         m=((double)currY-prevY)/x_axis_step;
00641         m2=((double)currY2-prevY2)/x_axis_step;
00642 
00643         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;x_axis_step;i++) {
00644             fillY=(int)(m*i+prevY);
00645             fillY2=(int)(m2*i+prevY2);
00646             <span class="keywordflow">if</span>(fillY&gt;fillY2) {
00647                 <span class="keywordflow">if</span>(*(legend_array[3])!=<span class="charliteral">'\0'</span>)
00648                     vga_back.line(prevX+i, fillY, prevX+i, fillY2, vga_back.translate_color(series_color[3]));
00649             }
00650             <span class="keywordflow">else</span>
00651                 vga_back.line(prevX+i, fillY, prevX+i, fillY2, vga_back.translate_color(series_color[2]));
00652         }
00653 
00654         <span class="comment">// draw lines</span>
00655         vga_back.thick_line(prevX, prevY, currX, currY, vga_back.translate_color(series_color[0]));
00656         vga_back.thick_line(prevX, prevY2, currX, currY2, vga_back.translate_color(series_color[1]));
00657 
00658         prevX = currX;
00659         prevY = currY;
00660         prevY2 = currY2;
00661         dataArray++;
00662     }
00663 
00664     <span class="keywordflow">if</span> (value_flag) {
00665         draw_value(dataArray-1, vga_back.translate_color(series_color[0]), prevX+<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>-(int)(x_axis_step*0.5), prevY-font_news.max_font_height, DATA_DOUBLE);
00666         draw_value(dataArray+(*data_num)-1, vga_back.translate_color(series_color[1]), prevX+<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>-(int)(x_axis_step*0.5), prevY2, DATA_DOUBLE);
00667     }
00668 
00669     <span class="comment">//---------------Draw the remain lines if they exist-----------//</span>
00670 
00671     <span class="keywordflow">if</span>(series_num&gt;2) {
00672         dataArray+=(*data_num);
00673 
00674         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 2; i &lt; series_num; i++) {
00675             dataArray-=(info.graph_year);
00676             dataArray+=*data_num;
00677             prevX = series_x1;
00678             <span class="keywordflow">if</span> (x_axis_pos)
00679                 prevY = series_y2 - short(((*dataArray+<span class="keywordtype">double</span>(max_scale)) * <span class="keywordtype">double</span>(series_y2-series_y1) / <span class="keywordtype">double</span>(max_scale*2)));
00680             <span class="keywordflow">else</span>
00681                 prevY = series_y2 - short(*dataArray * <span class="keywordtype">double</span>(series_y2-series_y1) / <span class="keywordtype">double</span>(max_scale));
00682 
00683             dataArray++;
00684 
00685             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt; (info.graph_year); j++) {
00686                 currX = series_x1 + j * x_axis_step;
00687                 <span class="keywordflow">if</span> (x_axis_pos)
00688                     currY = series_y2 - short(((*dataArray+<span class="keywordtype">double</span>(max_scale)) * <span class="keywordtype">double</span>(series_y2-series_y1) / <span class="keywordtype">double</span>(max_scale*2)));
00689                 <span class="keywordflow">else</span>
00690                     currY = series_y2 - short(*dataArray * <span class="keywordtype">double</span>(series_y2-series_y1) / <span class="keywordtype">double</span>(max_scale));
00691 
00692                 vga_back.thick_line(prevX, prevY, currX, currY, vga_back.translate_color(series_color[i+2]));
00693 
00694                 prevX = currX;
00695                 prevY = currY;
00696                 dataArray++;
00697             }
00698             <span class="keywordflow">if</span> (value_flag)
00699                 draw_value(dataArray-1, vga_back.translate_color(series_color[i+2]), prevX+<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>, prevY, DATA_DOUBLE);
00700         }
00701     }
00702 
00703 }
00704 
00705 <span class="comment">//------------ End of function GraphArea::draw_series_double ------------//</span>
00706 
00707 <span class="comment">//---------- Begin of function GraphArea::draw_series_int ------------//</span>
<a name="l00709"></a><a class="code" href="classGraphArea.html#b7">00709</a> <span class="comment">void GraphArea::draw_series_int() {</span>
00710     <span class="keywordtype">int</span> *dataArray = (<span class="keywordtype">int</span> *) data_array;
00711     <span class="keywordtype">short</span> prevX, prevY, currX, currY;
00712     <span class="keywordtype">short</span> prevY2, currY2;
00713     <span class="keywordtype">short</span> fillY, fillY2;
00714     <span class="keywordtype">double</span> m,m2;
00715 
00716     <span class="comment">//Filling region</span>
00717     prevX = series_x1;
00718     dataArray-=(info.graph_year);
00719     dataArray+=*data_num;
00720 
00721     <span class="comment">// Find Y by dataArray</span>
00722     <span class="keywordflow">if</span> (x_axis_pos)
00723         prevY = series_y2 - ((*dataArray+int(max_scale)) * (series_y2-series_y1) / int(max_scale*2));
00724     <span class="keywordflow">else</span>
00725         prevY = series_y2 - *dataArray * (series_y2-series_y1) / int(max_scale);
00726 
00727     <span class="keywordflow">if</span> (x_axis_pos)
00728         prevY2 = series_y2 - ((*(dataArray+(*data_num))+int(max_scale)) * (series_y2-series_y1) / int(max_scale*2));
00729     <span class="keywordflow">else</span>
00730         prevY2 = series_y2 - *(dataArray+(*data_num)) * (series_y2-series_y1) / int(max_scale);
00731 
00732     dataArray++;
00733 
00734     vga_back.thick_line(prevX, prevY, prevX+1, prevY, vga_back.translate_color(series_color[0]));
00735     vga_back.thick_line(prevX, prevY2, prevX+1, prevY2, vga_back.translate_color(series_color[1]));
00736 
00737     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt; (info.graph_year); j++) {
00738         currX = series_x1 + j * x_axis_step;
00739         <span class="keywordflow">if</span> (x_axis_pos)
00740             currY = series_y2 - ((*dataArray+int(max_scale)) * (series_y2-series_y1) / int(max_scale*2));
00741         <span class="keywordflow">else</span>
00742             currY = series_y2 - *dataArray * (series_y2-series_y1) / int(max_scale);
00743 
00744         <span class="keywordflow">if</span> (x_axis_pos)
00745             currY2 = series_y2 - ((*(dataArray+(*data_num))+int(max_scale)) * (series_y2-series_y1) / int(max_scale*2));
00746         <span class="keywordflow">else</span>
00747             currY2 = series_y2 - *(dataArray+(*data_num)) * (series_y2-series_y1) / int(max_scale);
00748 
00749         <span class="comment">// filling region</span>
00750         m=((double)currY-prevY)/x_axis_step;
00751         m2=((double)currY2-prevY2)/x_axis_step;
00752 
00753         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;x_axis_step;i++) {
00754             fillY=(int)(m*i+prevY);
00755             fillY2=(int)(m2*i+prevY2);
00756             <span class="keywordflow">if</span>(fillY&gt;fillY2) {
00757                 <span class="keywordflow">if</span>(*(legend_array[3])!=<span class="charliteral">'\0'</span>)
00758                     vga_back.line(prevX+i, fillY, prevX+i, fillY2, vga_back.translate_color(series_color[3]));
00759             }
00760             <span class="keywordflow">else</span>
00761                 vga_back.line(prevX+i, fillY, prevX+i, fillY2, vga_back.translate_color(series_color[2]));
00762         }
00763 
00764         <span class="comment">// draw lines</span>
00765         vga_back.thick_line(prevX, prevY, currX, currY, vga_back.translate_color(series_color[0]));
00766         vga_back.thick_line(prevX, prevY2, currX, currY2, vga_back.translate_color(series_color[1]));
00767 
00768         prevX = currX;
00769         prevY = currY;
00770         prevY2 = currY2;
00771         dataArray++;
00772     }
00773 
00774     <span class="keywordflow">if</span> (value_flag) {
00775         draw_value(dataArray-1, vga_back.translate_color(series_color[0]), prevX+<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>-(int)(x_axis_step*0.5), prevY-font_news.max_font_height, DATA_INT);
00776         draw_value(dataArray+(*data_num)-1, vga_back.translate_color(series_color[1]), prevX+<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>-(int)(x_axis_step*0.5), prevY2, DATA_INT);
00777     }
00778 
00779     <span class="keywordflow">if</span>(series_num&gt;2) {
00780         dataArray+=(*data_num);
00781         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 2; i &lt; series_num; i++) {
00782             prevX = series_x1;
00783             dataArray-=(info.graph_year);
00784             dataArray+=*data_num;
00785             <span class="comment">// Find Y by dataArray</span>
00786             <span class="keywordflow">if</span> (x_axis_pos)
00787                 prevY = series_y2 - ((*dataArray+int(max_scale)) * (series_y2-series_y1) / int(max_scale*2));
00788             <span class="keywordflow">else</span>
00789                 prevY = series_y2 - *dataArray * (series_y2-series_y1) / int(max_scale);
00790 
00791             dataArray++;
00792 
00793             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt; (info.graph_year); j++) {
00794                 currX = series_x1 + j * x_axis_step;
00795                 <span class="keywordflow">if</span> (x_axis_pos)
00796                     currY = series_y2 - ((*dataArray+int(max_scale)) * (series_y2-series_y1) / int(max_scale*2));
00797                 <span class="keywordflow">else</span>
00798                     currY = series_y2 - *dataArray * (series_y2-series_y1) / int(max_scale);
00799 
00800                 vga_back.thick_line(prevX, prevY, currX, currY, vga_back.translate_color(series_color[i+2]));
00801 
00802                 prevX = currX;
00803                 prevY = currY;
00804                 dataArray++;
00805             }
00806             <span class="keywordflow">if</span> (value_flag)
00807                 draw_value(dataArray-1, vga_back.translate_color(series_color[i+2]), prevX+<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>, prevY, DATA_INT);
00808         }
00809 
00810     }
00811 }
00812 
00813 <span class="comment">//------------ End of function GraphArea::draw_series_int ------------//</span>
00814 
00815 <span class="comment">//---------- Begin of function GraphArea::draw_series_long ------------//</span>
<a name="l00817"></a><a class="code" href="classGraphArea.html#b8">00817</a> <span class="comment">void GraphArea::draw_series_long() {</span>
00818     <span class="keywordtype">long</span> *dataArray = (<span class="keywordtype">long</span> *) data_array;
00819     <span class="keywordtype">short</span> prevX, prevY, currX, currY;
00820     <span class="keywordtype">short</span> prevY2, currY2;
00821     <span class="keywordtype">short</span> fillY, fillY2;
00822     <span class="keywordtype">double</span> m,m2;
00823 
00824     <span class="comment">//Filling region</span>
00825     prevX = series_x1;
00826     dataArray-=(info.graph_year);
00827     dataArray+=*data_num;
00828 
00829     <span class="comment">// Find Y by dataArray</span>
00830     <span class="keywordflow">if</span> (x_axis_pos)
00831         prevY = series_y2 - ((*dataArray+int(max_scale)) * (series_y2-series_y1) / int(max_scale*2));
00832     <span class="keywordflow">else</span>
00833         prevY = series_y2 - *dataArray * (series_y2-series_y1) / int(max_scale);
00834 
00835     <span class="keywordflow">if</span> (x_axis_pos)
00836         prevY2 = series_y2 - ((*(dataArray+(*data_num))+int(max_scale)) * (series_y2-series_y1) / int(max_scale*2));
00837     <span class="keywordflow">else</span>
00838         prevY2 = series_y2 - *(dataArray+(*data_num)) * (series_y2-series_y1) / int(max_scale);
00839 
00840     dataArray++;
00841 
00842     vga_back.thick_line(prevX, prevY, prevX+1, prevY, vga_back.translate_color(series_color[0]));
00843     vga_back.thick_line(prevX, prevY2, prevX+1, prevY2, vga_back.translate_color(series_color[1]));
00844 
00845     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt; (info.graph_year); j++) {
00846         currX = series_x1 + j * x_axis_step;
00847         <span class="keywordflow">if</span> (x_axis_pos)
00848             currY = series_y2 - ((*dataArray+int(max_scale)) * (series_y2-series_y1) / int(max_scale*2));
00849         <span class="keywordflow">else</span>
00850             currY = series_y2 - *dataArray * (series_y2-series_y1) / int(max_scale);
00851 
00852         <span class="keywordflow">if</span> (x_axis_pos)
00853             currY2 = series_y2 - ((*(dataArray+(*data_num))+int(max_scale)) * (series_y2-series_y1) / int(max_scale*2));
00854         <span class="keywordflow">else</span>
00855             currY2 = series_y2 - *(dataArray+(*data_num)) * (series_y2-series_y1) / int(max_scale);
00856 
00857         <span class="comment">// filling region</span>
00858         m=((double)currY-prevY)/x_axis_step;
00859         m2=((double)currY2-prevY2)/x_axis_step;
00860 
00861         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;x_axis_step;i++) {
00862             fillY=(int)(m*i+prevY);
00863             fillY2=(int)(m2*i+prevY2);
00864             <span class="keywordflow">if</span>(fillY&gt;fillY2) {
00865                 <span class="keywordflow">if</span>(*(legend_array[3])!=<span class="charliteral">'\0'</span>)
00866                     vga_back.line(prevX+i, fillY, prevX+i, fillY2, vga_back.translate_color(series_color[3]));
00867             }
00868             <span class="keywordflow">else</span>
00869                 vga_back.line(prevX+i, fillY, prevX+i, fillY2, vga_back.translate_color(series_color[2]));
00870         }
00871 
00872         <span class="comment">// draw lines</span>
00873         vga_back.thick_line(prevX, prevY, currX, currY, vga_back.translate_color(series_color[0]));
00874         vga_back.thick_line(prevX, prevY2, currX, currY2, vga_back.translate_color(series_color[1]));
00875 
00876         prevX = currX;
00877         prevY = currY;
00878         prevY2 = currY2;
00879         dataArray++;
00880     }
00881 
00882     <span class="keywordflow">if</span> (value_flag) {
00883         draw_value(dataArray-1, vga_back.translate_color(series_color[0]), prevX+<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>-(int)(x_axis_step*0.5), prevY-font_news.max_font_height, DATA_LONG);
00884         draw_value(dataArray+(*data_num)-1, vga_back.translate_color(series_color[1]), prevX+<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>-(int)(x_axis_step*0.5), prevY2, DATA_LONG);
00885     }
00886 
00887     <span class="keywordflow">if</span>(series_num&gt;2) {
00888         dataArray+=(*data_num);
00889         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 2; i &lt; series_num; i++) {
00890             prevX = series_x1;
00891             dataArray-=(info.graph_year);
00892             dataArray+=*data_num;
00893             <span class="comment">// Find Y by dataArray</span>
00894             <span class="keywordflow">if</span> (x_axis_pos)
00895                 prevY = series_y2 - ((*dataArray+int(max_scale)) * (series_y2-series_y1) / int(max_scale*2));
00896             <span class="keywordflow">else</span>
00897                 prevY = series_y2 - *dataArray * (series_y2-series_y1) / int(max_scale);
00898 
00899             dataArray++;
00900 
00901             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt; (info.graph_year); j++) {
00902                 currX = series_x1 + j * x_axis_step;
00903                 <span class="keywordflow">if</span> (x_axis_pos)
00904                     currY = series_y2 - ((*dataArray+int(max_scale)) * (series_y2-series_y1) / int(max_scale*2));
00905                 <span class="keywordflow">else</span>
00906                     currY = series_y2 - *dataArray * (series_y2-series_y1) / int(max_scale);
00907 
00908                 vga_back.thick_line(prevX, prevY, currX, currY, vga_back.translate_color(series_color[i+2]));
00909 
00910                 prevX = currX;
00911                 prevY = currY;
00912                 dataArray++;
00913             }
00914             <span class="keywordflow">if</span> (value_flag)
00915                 draw_value(dataArray-1, vga_back.translate_color(series_color[i+2]), prevX+<a class="code" href="Ogrparea_8cpp.html#a9a6">COMMON_OFFSET</a>, prevY, DATA_LONG);
00916         }
00917 
00918     }
00919 }
00920 
00921 <span class="comment">//------------ End of function GraphArea::draw_series_float ------------//</span>
00922 
00923 <span class="comment">//---------- Begin of function GraphArea::draw_value -------------------//</span>
<a name="l00925"></a><a class="code" href="classGraphArea.html#b9">00925</a> <span class="comment">void GraphArea::draw_value(void *value, int color, short x, short y, int dataType) {</span>
00926     <span class="keywordtype">char</span> *valueString;
00927     <span class="keywordflow">switch</span> (data_type_flag) {
00928     <span class="keywordflow">case</span> DATA_FLOAT:
00929         valueString = m.format(*((<span class="keywordtype">float</span> *) value), num_format); <span class="keywordflow">break</span>;
00930     <span class="keywordflow">case</span> DATA_DOUBLE:
00931         valueString = m.format(*((<span class="keywordtype">double</span> *) value), num_format); <span class="keywordflow">break</span>;
00932     <span class="keywordflow">case</span> DATA_INT:
00933         valueString = m.format(*((<span class="keywordtype">int</span> *) value), num_format); <span class="keywordflow">break</span>;
00934     <span class="keywordflow">case</span> DATA_LONG:
00935         valueString = m.format(*((<span class="keywordtype">long</span> *) value), num_format); <span class="keywordflow">break</span>;
00936     }
00937 
00938     <span class="keywordtype">short</span> textHeight = font_news.max_font_height;
00939     <span class="keywordtype">short</span> textWidth = font_news.text_width(valueString) + 1;
00940     <span class="comment">/*  </span>
00941 <span class="comment">        short *bitmap = (short *) sys.common_data_buf;</span>
00942 <span class="comment">        err_when( (2 + textWidth * textHeight) * sizeof(short) &gt; COMMON_DATA_BUF_SIZE );</span>
00943 <span class="comment">        *bitmap++ = textWidth;</span>
00944 <span class="comment">        *bitmap++ = textHeight;</span>
00945 <span class="comment"></span>
00946 <span class="comment">        short *shortPtr = bitmap;</span>
00947 <span class="comment">        for (int i = 0; i &lt; textWidth * textHeight; i++)</span>
00948 <span class="comment">        *shortPtr++ = transparent_code_w;</span>
00949 <span class="comment"></span>
00950 <span class="comment">        // chwong0114</span>
00951 <span class="comment">        //      font_ptr-&gt;put_to_bufferW(bitmap, textWidth * sizeof(short), 0, 0, valueString);</span>
00952 <span class="comment">        font_news.put_to_bufferW(bitmap, textWidth * sizeof(short), 0, 0, valueString);</span>
00953 <span class="comment"></span>
00954 <span class="comment">        shortPtr = bitmap;</span>
00955 <span class="comment">        for (i = 0; i &lt; textWidth * textHeight; i++, shortPtr++)</span>
00956 <span class="comment">        if (*shortPtr != transparent_code_w)</span>
00957 <span class="comment">        *shortPtr = color;</span>
00958 <span class="comment"></span>
00959 <span class="comment">        vga_back.put_bitmapW_trans(x, y, (short *) sys.common_data_buf);</span>
00960 <span class="comment">    */</span>
00961 
00962     font_chartsm.put(x+3,y,valueString);
00963 }
00964 
00965 <span class="comment">//---------- Begin of function GraphArea::draw_value -------------------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:49 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
