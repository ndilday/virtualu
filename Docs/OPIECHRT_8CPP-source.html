<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OPIECHRT.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>OPIECHRT.CPP</h1><a href="OPIECHRT_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OPIECHRT.CPP</span>
00002 <span class="comment">//Description : Object PieChart</span>
00003 <span class="comment">//Owner                 : Kevin(Ho)</span>
00004 
00005 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;<a class="code" href="COLOR_8H.html">COLOR.H</a>&gt;</span>
00007 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>
00008 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00010 <span class="preprocessor">#include &lt;OFONT.H&gt;</span>
00011 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00012 <span class="preprocessor">#include &lt;<a class="code" href="OPIECHRT_8H.html">OPIECHRT.H</a>&gt;</span>
00013 <span class="preprocessor">#include &lt;OIFACE.H&gt;</span>
00014 
00015 <span class="preprocessor">#include &lt;math.h&gt;</span>
00016 
00017 <span class="comment">//--------- Define macro constant -----------//</span>
00018 
<a name="l00019"></a><a class="code" href="OPIECHRT_8CPP.html#a0">00019</a> <span class="preprocessor">#define MAX_LEN_LABEL "000"</span>
00020 <span class="preprocessor"></span>
00021 <span class="keyword">static</span> <span class="keywordtype">int</span> default_series_color[] = {
00022     <a class="code" href="COLOR_8H.html#a21">V_BLUE</a>,
00023     <a class="code" href="COLOR_8H.html#a20">V_GREEN</a>,
00024     <a class="code" href="COLOR_8H.html#a19">V_RED</a>,
00025     <a class="code" href="COLOR_8H.html#a25">V_YELLOW</a>,
00026     <a class="code" href="COLOR_8H.html#a22">V_VIOLET</a>,
00027     <a class="code" href="COLOR_8H.html#a23">V_BROWN</a>,
00028     <a class="code" href="COLOR_8H.html#a18">V_ORANGE</a>,
00029     <a class="code" href="COLOR_8H.html#a24">V_PINK</a>,
00030     <a class="code" href="COLOR_8H.html#a15">V_BLACK</a>,
00031     <a class="code" href="COLOR_8H.html#a17">V_WHITE</a>,
00032 };                                                <span class="comment">// 10 default series colors</span>
00033 
00034 <span class="keyword">enum</span> {  <a class="code" href="OPIECHRT_8CPP.html#a7a2">DEFAULT_SERIES_COLOR_NUM</a> = 10 };
00035 
00036 <span class="keyword">enum</span> {
00037     <a class="code" href="OPIECHRT_8CPP.html#a8a3">LEGEND_SIZE</a> = 11,
00038     <a class="code" href="OPIECHRT_8CPP.html#a8a4">LEGEND_X_SPACING</a> = 12,
00039     <a class="code" href="OPIECHRT_8CPP.html#a8a5">LEGEND_Y_SPACING</a> = 2,
00040 };
00041 
00042 <span class="keyword">enum</span> {  <a class="code" href="OPIECHRT_8CPP.html#a9a6">COMMON_OFFSET</a> = 2         };
00043 
00044 <span class="comment">//-------------- Define static vars ------------//</span>
00045 
00046 <span class="comment">//static char paint_flag = 0;</span>
00047 
00048 <span class="comment">//-------- Begin of function PieChart::PieChart ----//</span>
<a name="l00050"></a><a class="code" href="classPieChart.html#a4">00050</a> <span class="comment">PieChart::PieChart() {</span>
00051     init_flag = 0;
00052     piechart_bitmap = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00053 }
00054 
00055 <span class="comment">//---------- End of function PieChart::PieChart ----//</span>
00056 
00057 <span class="comment">//-------- Begin of function PieChart::~PieChart -----//</span>
<a name="l00059"></a><a class="code" href="classPieChart.html#a5">00059</a> <span class="comment">PieChart::~PieChart() {</span>
00060     deinit();
00061 }
00062 
00063 <span class="comment">//---------- End of function PieChart::~PieChart -----//</span>
00064 
00065 <span class="comment">//-------- Begin of function PieChart::init --------//</span>
00098 <span class="comment">void PieChart::init(int x1, int y1, int x2, int y2, int dataNum,</span>
00099                     <span class="keywordtype">void</span> *dataArray, <span class="keywordtype">char</span> dataTypeFlag,
00100                     <span class="keywordtype">int</span> *xStart, <span class="keywordtype">int</span> *xEnd, <span class="keywordtype">char</span> *xLabel, <span class="keywordtype">char</span> *yLabel,
00101                     <span class="keywordtype">char</span> **legendArray, <span class="keywordtype">char</span> transparentFlag,
00102                     <span class="keywordtype">char</span> orientationFlag, <span class="keywordtype">char</span> valueFlag,
00103                     <span class="keywordtype">int</span> numFormat, <span class="keywordtype">int</span> *seriesColor, <span class="keywordtype">int</span> axisColor) {
00104     <a class="code" href="ALL_8H.html#a0">err_when</a>(dataNum &gt; <a class="code" href="OPIECHRT_8CPP.html#a7a2">DEFAULT_SERIES_COLOR_NUM</a> &amp;&amp; !seriesColor);
00105     <a class="code" href="ALL_8H.html#a0">err_when</a>(dataNum &lt;= 0);
00106     <a class="code" href="ALL_8H.html#a0">err_when</a>(*xEnd &lt; *xStart);
00107 
00108     graph_width = x2 - x1 - 6;
00109 
00110     <a class="code" href="ALL_8H.html#a0">err_when</a>(graph_width &lt; 0);
00111 
00112     piechart_x1 = x1;
00113     piechart_y1 = y1;
00114     piechart_x2 = x2;
00115     piechart_y2 = y2;
00116 
00117     centerx = (piechart_x1+piechart_x2)/2;
00118     centery = (piechart_y1+piechart_y2)/2;
00119     <span class="keywordtype">int</span> radius1 = (piechart_x2-piechart_x1)/2-3*<a class="code" href="OPIECHRT_8CPP.html#a9a6">COMMON_OFFSET</a>;
00120     <span class="keywordtype">int</span> radius2 = (piechart_y2-piechart_y1)/2-3*<a class="code" href="OPIECHRT_8CPP.html#a9a6">COMMON_OFFSET</a>;
00121     radius = (radius1&gt;radius2)?radius2:radius1;
00122     series_num = dataNum;
00123     data_num = dataNum;
00124     data_array = dataArray;
00125     data_type_flag = dataTypeFlag;
00126     x_start = xStart;
00127     x_end = xEnd;
00128 
00129     x_label = xLabel;
00130     y_label = yLabel;
00131     legend_array = legendArray;
00132 
00133     transparent_flag = transparentFlag;
00134     orientation_flag = orientationFlag;
00135     value_flag = valueFlag;
00136     num_format = num_format;
00137 
00138     series_color = seriesColor ? seriesColor : default_series_color;
00139     axis_color = axisColor;
00140 
00141     init_flag = 1;
00142 
00143     y_label_max_len = font_chartsm.text_width(<a class="code" href="OPIECHRT_8CPP.html#a0">MAX_LEN_LABEL</a>);
00144     set_font(&amp;font_chartsm);
00145 
00146 }
00147 
00148 <span class="comment">//------------- End of function PieChart::init -----------//</span>
00149 
00150 <span class="comment">//-------- Begin of function PieChart::deinit ------------//</span>
<a name="l00152"></a><a class="code" href="classPieChart.html#a11">00152</a> <span class="comment">void PieChart::deinit() {</span>
00153     <span class="keywordflow">if</span> (piechart_bitmap) {
00154         <a class="code" href="ALL_8H.html#a8">mem_del</a>(piechart_bitmap);
00155         piechart_bitmap = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00156     }
00157 
00158     init_flag = 0;
00159 }
00160 
00161 <span class="comment">//------------- End of function PieChart::deinit ---------//</span>
00162 
00163 <span class="comment">//-------- Begin of function PieChart::set_font ------------//</span>
<a name="l00165"></a><a class="code" href="classPieChart.html#a14">00165</a> <span class="comment">void PieChart::set_font(Font *fontPtr) {</span>
00166     <span class="keywordflow">if</span> (!init_flag)
00167         <span class="keywordflow">return</span>;
00168 
00169     font_ptr = fontPtr;
00170 
00171     calc_pos();
00172 }
00173 
00174 <span class="comment">//------------- End of function PieChart::set_font ---------//</span>
00175 
00176 <span class="comment">//-------- Begin of function PieChart::calc_pos ------------//</span>
<a name="l00181"></a><a class="code" href="classPieChart.html#a15">00181</a> <span class="comment">void PieChart::calc_pos() {</span>
00182     <span class="keywordflow">if</span> (legend_array) {
00183         <span class="keywordtype">short</span> textWidth = 0, textHeight = font_ptr-&gt;max_font_height;
00184 
00185         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num; i++) {
00186             <span class="keywordflow">if</span> (font_ptr-&gt;text_width(legend_array[i]) &gt; textWidth)
00187                 textWidth = font_ptr-&gt;text_width(legend_array[i]);
00188         }
00189 
00190         <a class="code" href="ALL_8H.html#a0">err_when</a>(textWidth + <a class="code" href="OPIECHRT_8CPP.html#a8a4">LEGEND_X_SPACING</a> * 2 &gt; graph_width);
00191 
00192         legend_x_num = (graph_width - <a class="code" href="OPIECHRT_8CPP.html#a8a4">LEGEND_X_SPACING</a>*2) / (textWidth + <a class="code" href="OPIECHRT_8CPP.html#a8a4">LEGEND_X_SPACING</a>*2);
00193         legend_y_num = (series_num / legend_x_num) + ((series_num % legend_x_num) ? 1 : 0);
00194 
00195         graph_height = piechart_y2 - piechart_y1 - legend_y_num * (textHeight + <a class="code" href="OPIECHRT_8CPP.html#a8a5">LEGEND_Y_SPACING</a>) - 6;
00196 
00197         <a class="code" href="ALL_8H.html#a0">err_when</a>(graph_height &lt;= 0);
00198 
00199         legend_width = (graph_width - <a class="code" href="OPIECHRT_8CPP.html#a8a4">LEGEND_X_SPACING</a>*2) / legend_x_num;
00200         legend_height = textHeight + <a class="code" href="OPIECHRT_8CPP.html#a8a5">LEGEND_Y_SPACING</a>;
00201     }
00202     <span class="keywordflow">else</span> {
00203         legend_width = legend_height = legend_x_num = legend_y_num = 0;
00204         graph_height = piechart_y2 - piechart_y1 - 6;
00205     }
00206 
00207     <span class="keywordtype">short</span> YLabelWidth = y_label ? (orientation_flag ? font_ptr-&gt;max_font_height : font_ptr-&gt;text_width(y_label)) : -<a class="code" href="OPIECHRT_8CPP.html#a9a6">COMMON_OFFSET</a>;
00208     <span class="keywordtype">short</span> XLabelHeight = x_label ? (font_ptr-&gt;max_font_height) : -<a class="code" href="OPIECHRT_8CPP.html#a9a6">COMMON_OFFSET</a>;
00209     series_x1 = piechart_x1 + 4 + <a class="code" href="OPIECHRT_8CPP.html#a9a6">COMMON_OFFSET</a>*4 + YLabelWidth + y_label_max_len;
00210     series_y1 = piechart_y1 + 4 + <a class="code" href="OPIECHRT_8CPP.html#a9a6">COMMON_OFFSET</a>*6;
00211     series_x2 = piechart_x2 - 4 - <a class="code" href="OPIECHRT_8CPP.html#a9a6">COMMON_OFFSET</a>*12;
00212     series_y2 = piechart_y1 + graph_height - <a class="code" href="OPIECHRT_8CPP.html#a9a6">COMMON_OFFSET</a>*3 - (font_ptr-&gt;max_font_height) - XLabelHeight;
00213 }
00214 
00215 <span class="comment">//------------ End of function PieChart::calc_pos ---------//</span>
00216 
00217 <span class="comment">//-------- Begin of function PieChart::paint --------------//</span>
<a name="l00219"></a><a class="code" href="classPieChart.html#a12">00219</a> <span class="comment">void PieChart::paint() {</span>
00220     <span class="keywordflow">if</span> (transparent_flag) {
00221         user_interface.brighten(piechart_x1+4, piechart_y1+4, piechart_x2-2, piechart_y2-2);
00222         piechart_bitmap = vga_back.save_area(piechart_x1+4, piechart_y1+4, piechart_x2-2, piechart_y2-2, piechart_bitmap);
00223     }
00224 
00225     <span class="comment">//  paint_flag = 1;</span>
00226     refresh();
00227 }
00228 
00229 <span class="comment">//------------- End of function PieChart::paint -----------//</span>
00230 
00231 <span class="comment">//-------- Begin of function PieChart::refresh ------------//</span>
<a name="l00233"></a><a class="code" href="classPieChart.html#a13">00233</a> <span class="comment">void PieChart::refresh() {</span>
00234     <span class="comment">//  vga.use_back();</span>
00235 
00236     <span class="keywordflow">if</span> (transparent_flag) {
00237         user_interface.rect(piechart_x1, piechart_y1, piechart_x2, piechart_y2, 1);
00238         vga_back.rest_area(piechart_bitmap, 0, 0);
00239     }
00240     <span class="keywordflow">else</span> {
00241         user_interface.bar(piechart_x1, piechart_y1, piechart_x2, piechart_y2);
00242         user_interface.panel(piechart_x1+3, piechart_y1+3, piechart_x2-4, piechart_y2-4);
00243     }
00244     draw_series();
00245 
00246     <span class="comment">//  if (paint_flag)</span>
00247     <span class="comment">//          paint_flag = 0;</span>
00248     <span class="comment">//          vga.blt_buf(piechart_x1, piechart_y1, piechart_x2+2, piechart_y2+2);</span>
00249     <span class="comment">//  else</span>
00250 
00251 }
00252 
00253 <span class="comment">//------------- End of function PieChart::refresh ---------//</span>
00254 
00255 <span class="comment">//---------- Begin of function PieChart::draw_legend ------------//</span>
<a name="l00257"></a><a class="code" href="classPieChart.html#b0">00257</a> <span class="comment">void PieChart::draw_legend() {</span>
00258     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num; i++) {
00259         <span class="keywordtype">short</span> legendX = piechart_x1 + 4 + (i % legend_x_num) * legend_width + <a class="code" href="OPIECHRT_8CPP.html#a8a4">LEGEND_X_SPACING</a>;
00260         <span class="keywordtype">short</span> legendY = piechart_y1 + 4 + graph_height + (i / legend_x_num) * legend_height;
00261         user_interface.bar( legendX+<a class="code" href="OPIECHRT_8CPP.html#a8a4">LEGEND_X_SPACING</a>, legendY+<a class="code" href="OPIECHRT_8CPP.html#a8a5">LEGEND_Y_SPACING</a>,
00262                             legendX+<a class="code" href="OPIECHRT_8CPP.html#a8a4">LEGEND_X_SPACING</a>+<a class="code" href="OPIECHRT_8CPP.html#a8a3">LEGEND_SIZE</a>, legendY+<a class="code" href="OPIECHRT_8CPP.html#a8a5">LEGEND_Y_SPACING</a>+<a class="code" href="OPIECHRT_8CPP.html#a8a3">LEGEND_SIZE</a>,
00263                             series_color[i] );
00264         font_ptr-&gt;put( legendX+<a class="code" href="OPIECHRT_8CPP.html#a8a4">LEGEND_X_SPACING</a>*2+<a class="code" href="OPIECHRT_8CPP.html#a8a3">LEGEND_SIZE</a>, legendY+<a class="code" href="OPIECHRT_8CPP.html#a8a5">LEGEND_Y_SPACING</a>, legend_array[i] );
00265     }
00266 }
00267 
00268 <span class="comment">//------------ End of function PieChart::draw_legend ------------//</span>
00269 
00270 <span class="comment">//---------- Begin of function PieChart::draw_axis_label --------//</span>
<a name="l00272"></a><a class="code" href="classPieChart.html#b1">00272</a> <span class="comment">void PieChart::draw_axis_label() {</span>
00273     <span class="keywordtype">short</span> textHeight = font_ptr-&gt;max_font_height;
00274 
00275     <span class="keywordflow">if</span> (x_label) {
00276         font_ptr-&gt;center_put( series_x1, series_y2+<a class="code" href="OPIECHRT_8CPP.html#a9a6">COMMON_OFFSET</a>*2+textHeight,
00277                               series_x2, piechart_y1+graph_height-<a class="code" href="OPIECHRT_8CPP.html#a9a6">COMMON_OFFSET</a>, x_label );
00278     }
00279 
00280     <span class="keywordflow">if</span> (y_label) {
00281         <span class="keywordtype">short</span> textWidth = font_ptr-&gt;text_width(y_label) + 1;
00282 
00283         <span class="keywordflow">if</span> (orientation_flag) {
00284             <span class="keywordtype">short</span> *fontBuf = (<span class="keywordtype">short</span> *) sys.common_data_buf;
00285             <a class="code" href="ALL_8H.html#a0">err_when</a>(textWidth * textHeight * <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>) &gt; <a class="code" href="Osys_8h.html#a40a2">COMMON_DATA_BUF_SIZE</a>);
00286 
00287             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; textWidth * textHeight; i++)
00288                 *fontBuf++ = transparent_code_w;
00289 
00290             font_ptr-&gt;put_to_bufferW(fontBuf = (<span class="keywordtype">short</span> *) sys.common_data_buf, textWidth * <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>), 0, 0, y_label);
00291 
00292             <span class="keywordtype">short</span> xStart = piechart_x1 + 4 + <a class="code" href="OPIECHRT_8CPP.html#a9a6">COMMON_OFFSET</a> * 2;
00293             <span class="keywordtype">short</span> yStart = (series_y1 + series_y2 - textWidth) / 2;
00294 
00295             <span class="keywordflow">for</span> (<span class="keywordtype">short</span> x = 0; x &lt; textHeight; x++) {
00296                 <span class="keywordflow">for</span> (<span class="keywordtype">short</span> y = textWidth - 1; y &gt;= 0; y--, fontBuf++) {
00297                     <span class="keywordflow">if</span> (*fontBuf != transparent_code_w)
00298                         *vga_back.buf_ptr(xStart+x, yStart+y) = *fontBuf;
00299                 }
00300             }
00301         }
00302         <span class="keywordflow">else</span> {
00303             font_ptr-&gt;center_put( piechart_x1+4+<a class="code" href="OPIECHRT_8CPP.html#a9a6">COMMON_OFFSET</a>*2, series_y1,
00304                                   piechart_x1+4+<a class="code" href="OPIECHRT_8CPP.html#a9a6">COMMON_OFFSET</a>*2+textWidth, series_y2, y_label);
00305         }
00306     }
00307 }
00308 
00309 <span class="comment">//------------ End of function PieChart::draw_axis_label --------//</span>
00310 
00311 <span class="comment">//---------- Begin of function PieChart::find_scale -------------//</span>
<a name="l00313"></a><a class="code" href="classPieChart.html#b2">00313</a> <span class="comment">void PieChart::find_scale() {</span>
00314     <span class="keywordtype">double</span> data, maxVal = 0.0;
00315     x_axis_pos = 0;
00316 
00317     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num * data_num; i++) {
00318         <span class="keywordflow">switch</span> (data_type_flag) {
00319         <span class="keywordflow">case</span> DATA_DOUBLE:
00320             data = ((<span class="keywordtype">double</span>*)data_array)[i];
00321             <span class="keywordflow">break</span>;
00322         <span class="keywordflow">case</span> DATA_FLOAT:
00323             data = double(((<span class="keywordtype">float</span>*)data_array)[i]);
00324             <span class="keywordflow">break</span>;
00325         <span class="keywordflow">case</span> DATA_INT:
00326             data = double(((<span class="keywordtype">int</span>*)data_array)[i]);
00327             <span class="keywordflow">break</span>;
00328         <span class="keywordflow">case</span> DATA_LONG:
00329             data = double(((<span class="keywordtype">long</span>*)data_array)[i]);
00330             <span class="keywordflow">break</span>;
00331         }
00332         <span class="keywordflow">if</span> (<a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(data) &gt; maxVal)
00333             maxVal = <a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(data);
00334         <span class="keywordflow">if</span> (!x_axis_pos &amp;&amp; data &lt; 0.0)
00335             x_axis_pos = 1;
00336     }
00337     <span class="keywordflow">if</span> (maxVal&gt;0)
00338         max_scale = pow(10,ceil(log10(maxVal)));
00339     <span class="keywordflow">else</span>
00340         max_scale = 5;
00341 }
00342 
00343 <span class="comment">//------------ End of function PieChart::find_scale -------------//</span>
00344 
00345 <span class="comment">//---------- Begin of function PieChart::draw_scale -------------//</span>
<a name="l00347"></a><a class="code" href="classPieChart.html#b3">00347</a> <span class="comment">void PieChart::draw_scale() {</span>
00348     find_scale();
00349 
00350     <span class="keywordtype">short</span> xAxisPos;
00351 
00352     <span class="comment">//------ Draw y-axis -------//</span>
00353 
00354     <span class="keywordflow">if</span> (x_axis_pos)
00355         vga_back.bar(series_x1, series_y1-<a class="code" href="OPIECHRT_8CPP.html#a9a6">COMMON_OFFSET</a>*2, series_x1+1, series_y2+<a class="code" href="OPIECHRT_8CPP.html#a9a6">COMMON_OFFSET</a>*2, axis_color);
00356     <span class="keywordflow">else</span>
00357         vga_back.bar(series_x1, series_y1-<a class="code" href="OPIECHRT_8CPP.html#a9a6">COMMON_OFFSET</a>*2, series_x1+1, series_y2, axis_color);
00358 
00359     <span class="keywordtype">short</span> scaleNum = (series_y2-series_y1-font_ptr-&gt;max_font_height) / (font_ptr-&gt;max_font_height*3/2);
00360     <span class="keywordflow">if</span> ( scaleNum &gt; 0 )
00361         scaleNum = short(pow(2,floor(log10(<span class="keywordtype">double</span>(scaleNum))/log10(2.0))));
00362     <span class="keywordflow">else</span>
00363         scaleNum = 0;
00364     <span class="keywordtype">short</span> scaleStep = (series_y2-series_y1) / scaleNum;
00365     <span class="keywordtype">double</span> scaleValue;
00366     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt;= scaleNum; i++) {
00367         <span class="keywordflow">if</span> ( (x_axis_pos &amp;&amp; i == scaleNum / 2) || !(x_axis_pos || i) )
00368             vga_back.bar(series_x1, xAxisPos=series_y2-i*scaleStep-1, series_x2+<a class="code" href="OPIECHRT_8CPP.html#a9a6">COMMON_OFFSET</a>*8, series_y2-i*scaleStep, axis_color);
00369         <span class="keywordflow">else</span>
00370             vga_back.bar(series_x1, series_y2-i*scaleStep, series_x1+<a class="code" href="OPIECHRT_8CPP.html#a9a6">COMMON_OFFSET</a>*2, series_y2-i*scaleStep, axis_color);
00371 
00372         <span class="keywordflow">if</span> (x_axis_pos)
00373             scaleValue = max_scale*2/scaleNum*i - max_scale;
00374         <span class="keywordflow">else</span>
00375             scaleValue = max_scale/scaleNum*i;
00376 
00377         <span class="keywordflow">switch</span> (data_type_flag) {
00378         <span class="keywordflow">case</span> DATA_FLOAT:
00379         <span class="keywordflow">case</span> DATA_DOUBLE:
00380             font_ptr-&gt;right_put(series_x1-<a class="code" href="OPIECHRT_8CPP.html#a9a6">COMMON_OFFSET</a>, series_y2-i*scaleStep-font_ptr-&gt;max_font_height/2, m.format(scaleValue,num_format));
00381             <span class="keywordflow">break</span>;
00382         <span class="keywordflow">case</span> DATA_INT:
00383         <span class="keywordflow">case</span> DATA_LONG:
00384             font_ptr-&gt;right_put(series_x1-<a class="code" href="OPIECHRT_8CPP.html#a9a6">COMMON_OFFSET</a>, series_y2-i*scaleStep-font_ptr-&gt;max_font_height/2, m.format(<span class="keywordtype">long</span>(scaleValue),num_format));
00385         }
00386     }
00387 
00388     <span class="comment">//------ Draw x-axis -------//</span>
00389 
00390     <span class="keywordtype">short</span> maxLabelWidth = font_ptr-&gt;text_width(m.format(*x_end, 4))+<a class="code" href="OPIECHRT_8CPP.html#a9a6">COMMON_OFFSET</a>*2;
00391     x_axis_step = (series_x2-series_x1) / (data_num-1);
00392     <span class="keywordtype">short</span> displayInc = 1;
00393     <span class="keywordflow">while</span> (displayInc * x_axis_step / maxLabelWidth &lt; 1) displayInc++;
00394     <span class="keywordtype">int</span> xAxisStep = (*x_end - *x_start) / (data_num - 1);
00395     <span class="keywordflow">for</span> (i = 0; i &lt; data_num-1; i += displayInc) {
00396         vga_back.bar(series_x2-i*x_axis_step, xAxisPos-<a class="code" href="OPIECHRT_8CPP.html#a9a6">COMMON_OFFSET</a>*2, series_x2-i*x_axis_step, xAxisPos, axis_color);
00397         font_ptr-&gt;center_put((series_x2-i*x_axis_step)-maxLabelWidth/2-<a class="code" href="OPIECHRT_8CPP.html#a9a6">COMMON_OFFSET</a>, xAxisPos+<a class="code" href="OPIECHRT_8CPP.html#a9a6">COMMON_OFFSET</a>,
00398                              (series_x2-i*x_axis_step)+maxLabelWidth/2+<a class="code" href="OPIECHRT_8CPP.html#a9a6">COMMON_OFFSET</a>, xAxisPos+<a class="code" href="OPIECHRT_8CPP.html#a9a6">COMMON_OFFSET</a>+font_ptr-&gt;max_font_height, m.format(*x_end-xAxisStep*i, 4));
00399     }
00400 }
00401 
00402 <span class="comment">//------------ End of function PieChart::draw_scale -------------//</span>
00403 
00404 <span class="comment">//---------- Begin of function PieChart::draw_series ------------//</span>
<a name="l00406"></a><a class="code" href="classPieChart.html#b5">00406</a> <span class="comment">void PieChart::draw_series() {</span>
00407     <span class="keywordflow">switch</span> (data_type_flag) {
00408     <span class="keywordflow">case</span> DATA_FLOAT: draw_series_float(); <span class="keywordflow">break</span>;
00409     <span class="keywordflow">case</span> DATA_DOUBLE: draw_series_double(); <span class="keywordflow">break</span>;
00410     <span class="keywordflow">case</span> DATA_INT: draw_series_int(); <span class="keywordflow">break</span>;
00411     <span class="keywordflow">case</span> DATA_LONG: draw_series_long(); <span class="keywordflow">break</span>;
00412     }
00413 }
00414 
00415 <span class="comment">//------------ End of function PieChart::draw_series ------------//</span>
00416 
00417 <span class="comment">//---------- Begin of function PieChart::draw_pie ------------//</span>
<a name="l00419"></a><a class="code" href="classPieChart.html#b4">00419</a> <span class="comment">void PieChart::draw_pie(double theta1, double theta2, int piecolor) {</span>
00420     <span class="comment">//assume theta2 &gt; theta 1</span>
00421     <span class="keywordtype">double</span> t1=theta1, t2=theta2;
00422     <span class="keywordtype">double</span> sint3,cost3,t3,t4,t5,x,y;
00423     <span class="keywordtype">double</span> skip=1.0;
00424 
00425     <span class="keywordflow">if</span>(theta1==theta2)<span class="keywordflow">return</span>;
00426 
00427     t3=0.5*(t1+t2);
00428     sint3=sin(t3);
00429     cost3=cos(t3);
00430     t4=2*(skip/(t2-t1));
00431     t5=skip/radius;
00432     x=centerx;
00433     y=centery;
00434     <span class="keywordflow">while</span>(t1&lt;=t2) {
00435         vga_back.thick_line(
00436             (<span class="keywordtype">int</span>)x, (<span class="keywordtype">int</span>)y, centerx+(<span class="keywordtype">int</span>)(radius*cos(t1)), centery+(<span class="keywordtype">int</span>)(radius*sin(t1)),
00437             vga_back.translate_color(series_color[piecolor]));
00438         vga_back.thick_line(
00439             (<span class="keywordtype">int</span>)x, (<span class="keywordtype">int</span>)y, centerx+(<span class="keywordtype">int</span>)(radius*cos(t2)), centery+(<span class="keywordtype">int</span>)(radius*sin(t2)),
00440             vga_back.translate_color(series_color[piecolor]));
00441 
00442         x+=t4*cost3;
00443         y+=t4*sint3;
00444         t1+=t5;
00445         t2-=t5;
00446     }
00447     t1=theta1;
00448     t2=theta2;
00449     <span class="keywordflow">while</span>(t1&lt;=t2) {
00450         vga_back.thick_line(
00451             centerx+(<span class="keywordtype">int</span>)(radius*cos(t2)), centery+(<span class="keywordtype">int</span>)(radius*sin(t2)),
00452             centerx+(<span class="keywordtype">int</span>)(radius*cos(t2-=t5)), centery+(<span class="keywordtype">int</span>)(radius*sin(t2)),
00453             vga_back.translate_color(<a class="code" href="COLOR_8H.html#a16">V_GRAY</a>-5));
00454         vga_back.thick_line(
00455             centerx+(<span class="keywordtype">int</span>)(radius*cos(t1)), centery+(<span class="keywordtype">int</span>)(radius*sin(t1)),
00456             centerx+(<span class="keywordtype">int</span>)(radius*cos(t1+=t5)), centery+(<span class="keywordtype">int</span>)(radius*sin(t1)),
00457             vga_back.translate_color(<a class="code" href="COLOR_8H.html#a16">V_GRAY</a>-5));
00458         x+=t4*cost3;
00459         y+=t4*sint3;
00460     }
00461 
00462 }
00463 
00464 <span class="comment">//---------- End of function PieChart::draw_pie ------------//</span>
00465 
00466 <span class="comment">//---------- Begin of function PieChart::draw_series_int ------------//</span>
<a name="l00468"></a><a class="code" href="classPieChart.html#b8">00468</a> <span class="comment">void PieChart::draw_series_int() {</span>
00469     <span class="keywordtype">int</span> *dataArray = (<span class="keywordtype">int</span> *) data_array;
00470     <span class="keywordtype">long</span> total=0;
00471     <span class="keywordtype">double</span> theta1,theta2;
00472 
00473     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; data_num; i++)
00474         total+=(long)(dataArray[i]);
00475 
00476     <span class="keywordflow">if</span>(total&lt;1E-9)total=1;
00477     theta2=0.0;
00478     <span class="keywordflow">for</span> (i = 0; i &lt; data_num; i++) {
00479         theta1=theta2;
00480         theta2+=6.2832*(double)dataArray[i]/total;
00481         draw_pie(theta1,theta2,i);
00482 
00483         <span class="keywordflow">if</span>((theta1!=theta2)
00484            &amp;&amp;(<a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(theta2-theta1-6.2832)&gt;1e-9)) {
00485             vga_back.thick_line(
00486                 centerx,
00487                 centery,
00488                 centerx+(<span class="keywordtype">int</span>)(radius*cos(theta1)),
00489                 centery+(<span class="keywordtype">int</span>)(radius*sin(theta1)),
00490                 vga_back.translate_color(<a class="code" href="COLOR_8H.html#a16">V_GRAY</a>-5));
00491             vga_back.thick_line(
00492                 centerx,
00493                 centery,
00494                 centerx+(<span class="keywordtype">int</span>)(radius*cos(theta2)),
00495                 centery+(<span class="keywordtype">int</span>)(radius*sin(theta2)),
00496                 vga_back.translate_color(<a class="code" href="COLOR_8H.html#a16">V_GRAY</a>-5));
00497         }
00498     }
00499 
00500 }
00501 
00502 <span class="comment">//------------ End of function PieChart::draw_series_long ------------//</span>
00503 
<a name="l00504"></a><a class="code" href="classPieChart.html#b9">00504</a> <span class="keywordtype">void</span> <a class="code" href="classPieChart.html#b9">PieChart::draw_series_long</a>() {
00505     <span class="keywordtype">long</span> *dataArray = (<span class="keywordtype">long</span> *) <a class="code" href="classPieChart.html#m27">data_array</a>;
00506     <span class="keywordtype">long</span> total=0;
00507     <span class="keywordtype">double</span> theta1,theta2;
00508 
00509     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classPieChart.html#m26">data_num</a>; i++)
00510         total+=(long)(dataArray[i]);
00511     <span class="keywordflow">if</span>(total&lt;1E-9)total=1;
00512 
00513     theta2=0.0;
00514     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="classPieChart.html#m26">data_num</a>; i++) {
00515         theta1=theta2;
00516         theta2+=6.2832*(double)dataArray[i]/total;
00517         <a class="code" href="classPieChart.html#b4">draw_pie</a>(theta1,theta2,i);
00518     }
00519     theta1=0.0;
00520     <span class="keywordflow">for</span> (i = 0; i &lt;= <a class="code" href="classPieChart.html#m26">data_num</a>; i++) {
00521         vga_back.thick_line(
00522             <a class="code" href="classPieChart.html#m30">centerx</a>, <a class="code" href="classPieChart.html#m31">centery</a>,
00523             <a class="code" href="classPieChart.html#m30">centerx</a>+(<span class="keywordtype">int</span>)(<a class="code" href="classPieChart.html#m32">radius</a>*cos(theta1)), <a class="code" href="classPieChart.html#m31">centery</a>+(<span class="keywordtype">int</span>)(<a class="code" href="classPieChart.html#m32">radius</a>*sin(theta1)),
00524             vga_back.translate_color(<a class="code" href="COLOR_8H.html#a16">V_GRAY</a>-5));
00525         theta1+=6.2832*(double)dataArray[i]/total;
00526     }
00527 }
00528 
00529 <span class="comment">//------------ End of function PieChart::draw_series_long ------------//</span>
00530 
00531 <span class="comment">//------------ End of function PieChart::draw_series_float ------------//</span>
00532 
<a name="l00533"></a><a class="code" href="classPieChart.html#b6">00533</a> <span class="keywordtype">void</span> <a class="code" href="classPieChart.html#b6">PieChart::draw_series_float</a>() {
00534     <span class="keywordtype">float</span> *dataArray = (<span class="keywordtype">float</span> *) <a class="code" href="classPieChart.html#m27">data_array</a>;
00535     <span class="keywordtype">float</span> total=0;
00536     <span class="keywordtype">double</span> theta1,theta2;
00537 
00538     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classPieChart.html#m26">data_num</a>; i++)
00539         total+=(float)(dataArray[i]);
00540 
00541     <span class="keywordflow">if</span>(total&lt;1E-9)total=1;
00542 
00543     theta2=0.0;
00544     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="classPieChart.html#m26">data_num</a>; i++) {
00545         theta1=theta2;
00546         theta2+=6.2832*(double)dataArray[i]/total;
00547         <a class="code" href="classPieChart.html#b4">draw_pie</a>(theta1,theta2,i);
00548     }
00549     theta1=0.0;
00550     <span class="keywordflow">for</span> (i = 0; i &lt;= <a class="code" href="classPieChart.html#m26">data_num</a>; i++) {
00551         vga_back.thick_line(
00552             <a class="code" href="classPieChart.html#m30">centerx</a>, <a class="code" href="classPieChart.html#m31">centery</a>,
00553             <a class="code" href="classPieChart.html#m30">centerx</a>+(<span class="keywordtype">int</span>)(<a class="code" href="classPieChart.html#m32">radius</a>*cos(theta1)), <a class="code" href="classPieChart.html#m31">centery</a>+(<span class="keywordtype">int</span>)(<a class="code" href="classPieChart.html#m32">radius</a>*sin(theta1)),
00554             vga_back.translate_color(<a class="code" href="COLOR_8H.html#a16">V_GRAY</a>-5));
00555         theta1+=6.2832*(double)dataArray[i]/total;
00556     }
00557 
00558 }
00559 
00560 <span class="comment">//------------ End of function PieChart::draw_series_float ------------//</span>
00561 
00562 <span class="comment">//------------ End of function PieChart::draw_series_long ------------//</span>
00563 
<a name="l00564"></a><a class="code" href="classPieChart.html#b7">00564</a> <span class="keywordtype">void</span> <a class="code" href="classPieChart.html#b7">PieChart::draw_series_double</a>() {
00565     <span class="keywordtype">double</span> *dataArray = (<span class="keywordtype">double</span> *) <a class="code" href="classPieChart.html#m27">data_array</a>;
00566     <span class="keywordtype">double</span> total=0;
00567     <span class="keywordtype">double</span> theta1,theta2;
00568 
00569     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classPieChart.html#m26">data_num</a>; i++)
00570         total+=(double)(dataArray[i]);
00571 
00572     <span class="keywordflow">if</span>(total&lt;1E-9)total=1;
00573 
00574     theta2=0.0;
00575     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="classPieChart.html#m26">data_num</a>; i++) {
00576         theta1=theta2;
00577         theta2+=6.2832*(double)dataArray[i]/total;
00578         <a class="code" href="classPieChart.html#b4">draw_pie</a>(theta1,theta2,i);
00579     }
00580 
00581     theta1=0.0;
00582     <span class="keywordflow">for</span> (i = 0; i &lt;= <a class="code" href="classPieChart.html#m26">data_num</a>; i++) {
00583         vga_back.thick_line(
00584             <a class="code" href="classPieChart.html#m30">centerx</a>, <a class="code" href="classPieChart.html#m31">centery</a>,
00585             <a class="code" href="classPieChart.html#m30">centerx</a>+(<span class="keywordtype">int</span>)(<a class="code" href="classPieChart.html#m32">radius</a>*cos(theta1)), <a class="code" href="classPieChart.html#m31">centery</a>+(<span class="keywordtype">int</span>)(<a class="code" href="classPieChart.html#m32">radius</a>*sin(theta1)),
00586             vga_back.translate_color(<a class="code" href="COLOR_8H.html#a16">V_GRAY</a>-5));
00587         theta1+=6.2832*(double)dataArray[i]/total;
00588     }
00589 
00590 }
00591 
00592 <span class="comment">//------------ End of function PieChart::draw_series_float ------------//</span>
00593 
00594 <span class="comment">//---------- Begin of function PieChart::draw_value -------------------//</span>
<a name="l00596"></a><a class="code" href="classPieChart.html#b10">00596</a> <span class="comment">void PieChart::draw_value(void *value, int color, short x, short y, int dataType) {</span>
00597     <span class="keywordtype">char</span> *valueString;
00598     <span class="keywordflow">switch</span> (data_type_flag) {
00599     <span class="keywordflow">case</span> DATA_FLOAT:
00600         valueString = m.format(*((<span class="keywordtype">float</span> *) value), num_format); <span class="keywordflow">break</span>;
00601     <span class="keywordflow">case</span> DATA_DOUBLE:
00602         valueString = m.format(*((<span class="keywordtype">double</span> *) value), num_format); <span class="keywordflow">break</span>;
00603     <span class="keywordflow">case</span> DATA_INT:
00604         valueString = m.format(*((<span class="keywordtype">int</span> *) value), num_format); <span class="keywordflow">break</span>;
00605     <span class="keywordflow">case</span> DATA_LONG:
00606         valueString = m.format(*((<span class="keywordtype">long</span> *) value), num_format); <span class="keywordflow">break</span>;
00607     }
00608 
00609     <span class="keywordtype">short</span> textHeight = font_ptr-&gt;max_font_height;
00610     <span class="keywordtype">short</span> textWidth = font_ptr-&gt;text_width(valueString) + 1;
00611     <span class="comment">/*  </span>
00612 <span class="comment">        short *bitmap = (short *) sys.common_data_buf;</span>
00613 <span class="comment">        err_when( (2 + textWidth * textHeight) * sizeof(short) &gt; COMMON_DATA_BUF_SIZE );</span>
00614 <span class="comment">        *bitmap++ = textWidth;</span>
00615 <span class="comment">        *bitmap++ = textHeight;</span>
00616 <span class="comment"></span>
00617 <span class="comment">        short *shortPtr = bitmap;</span>
00618 <span class="comment">        for (int i = 0; i &lt; textWidth * textHeight; i++)</span>
00619 <span class="comment">        *shortPtr++ = transparent_code_w;</span>
00620 <span class="comment"></span>
00621 <span class="comment">        font_ptr-&gt;put_to_bufferW(bitmap, textWidth * sizeof(short), 0, 0, valueString);</span>
00622 <span class="comment"></span>
00623 <span class="comment">        shortPtr = bitmap;</span>
00624 <span class="comment">        for (i = 0; i &lt; textWidth * textHeight; i++, shortPtr++)</span>
00625 <span class="comment">        if (*shortPtr != transparent_code_w)</span>
00626 <span class="comment">        *shortPtr = color;</span>
00627 <span class="comment"></span>
00628 <span class="comment">        vga_back.put_bitmapW_trans(x, y, (short *) sys.common_data_buf);</span>
00629 <span class="comment">    */</span>
00630     font_chartsm.put(x+3,y,valueString);
00631 }
00632 
00633 <span class="comment">//---------- Begin of function PieChart::draw_value -------------------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:10 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
