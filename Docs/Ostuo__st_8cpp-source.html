<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Ostuo_st.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Ostuo_st.cpp</h1><a href="Ostuo__st_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OStuO_st.cpp</span>
00002 <span class="comment">//Description : StudentOffice Class Definition; includes Residence Hall; refer to HE.facilities.xls -&gt; residence hall</span>
00003 <span class="comment">//Owner       : Fred</span>
00004 
00005 <span class="comment">// ES library header file</span>
00006 <span class="preprocessor">#include &lt;OMATH.H&gt;</span>
00007 
00008 <span class="comment">// CU header file</span>
00009 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>
00010 <span class="preprocessor">#include &lt;OPSCHOOL.H&gt;</span>
00011 <span class="preprocessor">#include &lt;OFinance.H&gt;</span>
00012 <span class="preprocessor">#include &lt;<a class="code" href="OPEERSCH_8H.html">OPEERSCH.H</a>&gt;</span>
00013 <span class="preprocessor">#include &lt;<a class="code" href="OSCHLRES_8H.html">OSCHLRES.H</a>&gt;</span>
00014 
00015 <span class="preprocessor">#include "OStuOff.h"</span>
00016 
00017 <span class="comment">//----------- Define constants -------------//</span>
00018 <span class="comment">//----------- Define static variables -------------//</span>
00019 <span class="comment">//----------- Define static functions -------------//</span>
00020 <span class="comment">//----------- Define static class member variables -------------//</span>
00021 
00022 <span class="comment">//----------- Begin of function StudentOffice Constructor -----//</span>
<a name="l00027"></a><a class="code" href="classStudentOffice.html#a0">00027</a> <span class="comment">StudentOffice::StudentOffice() {</span>
00028 
00029 }
00030 
00031 <span class="comment">//------------- End of function StudentOffice Constructor -----//</span>
00032 
00033 <span class="comment">//----------- Begin of function StudentOffice Destructor ------//</span>
<a name="l00035"></a><a class="code" href="classStudentOffice.html#a1">00035</a> <span class="comment">StudentOffice::~StudentOffice() {</span>
00036 
00037 }
00038 
00039 <span class="comment">//------------- End of function StudentOffice Destructor ------//</span>
00040 
00041 <span class="comment">//----------- Begin of function StudentOffice::init_data --------//</span>
<a name="l00045"></a><a class="code" href="classStudentOffice.html#a4">00045</a> <span class="comment">void StudentOffice::init_data() {</span>
00046     memset(<span class="keyword">this</span>, 0, <span class="keyword">sizeof</span>(<a class="code" href="classStudentOffice.html">StudentOffice</a>));
00047 
00048     <span class="comment">// player input</span>
00049     <span class="comment">//targe_sl1_in_hall_percent = 50;</span>
00050 
00051     <span class="comment">//------------------------//</span>
00052     <span class="comment">// -&gt; COLUMN E: initialize</span>
00053     <span class="comment">//------------------------//</span>
00054 
00055     <span class="comment">//------ Parameters -------//</span>
00056     accomodate_excess_demand = <span class="keyword">true</span>;
00057     <span class="comment">//33%</span>
00058     percent_excess_demand_before_capacity_increased = 33;
00059     replacement_cost_per_student_space = 15000;     <span class="comment">// not ($000)</span>
00060     replacement_cost_last2 = replacement_cost_per_student_space;
00061     raw_initial_onm_cost_per_student_space = replacement_cost_per_student_space / 40.0f;
00062     raw_initial_variable_cost_per_occupied_space =  0.175f * replacement_cost_per_student_space;
00063 
00064     <span class="comment">//------ Capacity, demand, and revenue -------//</span>
00065 
00066     <a class="code" href="classPeerSchool.html">PeerSchool</a> *playerSchool = school_res.player_peer_school;
00067 
00068     <span class="comment">// E95</span>
00069     room_n_board_rate = playerSchool-&gt;<a class="code" href="classSchoolEx.html#m45">room_and_board_rate</a>;
00070     <span class="comment">//percent_demanding_places_sl1 = min(max(0,10+playerSchool-&gt;percent_traditional_ug_in_residence_halls), 100);</span>
00071     percent_demanding_places_sl1 = (float) m.fmin(m.fmax(0,math.get_random_snd(player_school.fulltime_ug_in_housing_percent, <a class="code" href="Opschool_8h.html#a1">PSCH_SD</a>(0.03f * player_school.fulltime_ug_in_housing_percent))), 100);
00072 
00073     <span class="keywordflow">if</span>(percent_demanding_places_sl1&gt;=100)
00074         percent_demanding_places_sl1=100;
00075 
00076     <span class="comment">// E98</span>
00077     demand_places = int(percent_demanding_places_sl1 * enroll_res.student_count[<a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>] / 100);
00078     current_places = demand_places;
00079     current_places = int(m.fmax(0, current_places + math.get_random_snd(0, <a class="code" href="Opschool_8h.html#a1">PSCH_SD</a>(current_places * 0.04f))));
00080     filled_places = min(current_places, demand_places);
00081     <span class="comment">// ($000)</span>
00082     <span class="keywordtype">float</span> total_revenue = float(filled_places * room_n_board_rate) / 1000;
00083 
00084     <span class="comment">// Replacement cost of beginning spaces ($000)</span>
00085     <span class="comment">// replacement_cost = current_places * replacement_cost_per_student_space / 1000;</span>
00086 
00087     <span class="comment">//------- Cost/Expense -----------------//</span>
00088 
00089     <span class="comment">// ($000)</span>
00090     <span class="keywordtype">float</span> debtBalance = (float) finance.last_year.liability_array[<a class="code" href="Ofinance_8h.html#a99a28">AC_RESIDENCE_HALL_DEBT</a>];
00091 
00092     <span class="comment">// ($000)</span>
00093     <span class="keywordtype">float</span> serviceOnDebt = debtBalance * float(finance.debt_fraction_repaid_annually + finance.long_term_debt_interest) / 100;
00094     <span class="comment">// ($000)</span>
00095     <span class="keywordtype">float</span> fixed_onm = raw_initial_onm_cost_per_student_space * current_places / 1000;
00096     <span class="comment">// ($000)</span>
00097     <span class="keywordtype">float</span> variable_cost = raw_initial_variable_cost_per_occupied_space * filled_places / 1000;
00098     <span class="comment">// ($000)</span>
00099     <span class="keywordtype">float</span> total_expense = serviceOnDebt + fixed_onm + variable_cost;
00100 
00101     <span class="comment">// E106-108</span>
00102     <span class="keywordtype">float</span> multipler = (total_revenue - serviceOnDebt) / (total_expense - serviceOnDebt);
00103     fixed_onm *= multipler;
00104     variable_cost *= multipler;
00105     <span class="comment">// ($000)</span>
00106     total_expense = serviceOnDebt + fixed_onm + variable_cost;
00107 
00108     <span class="comment">//askbill?  multipler is useless and is &lt; 0?</span>
00109 
00110     <span class="comment">//------------------------//</span>
00111     <span class="comment">// -&gt; COLUMN G: year1</span>
00112     <span class="comment">//------------------------//</span>
00113 
00114     <span class="comment">// G97: percent_demanding_places_sl1</span>
00115     <span class="comment">// The "+.005" represents a random normal deviate with mean zero and standard deviation</span>
00116     <span class="comment">// tentatively equal to .025*Sqrt(p*(1-p)), where p is the value in E97. The result</span>
00117     <span class="comment">// should be truncated at zero (no negative percents are allowed).</span>
00118     <span class="comment">// The mean value may depend on the scenario.</span>
00119     <span class="comment">//</span>
00120     <span class="comment">// The deviation is applied to year 1 to get a potential demand imbalance at</span>
00121     <span class="comment">// the start of the game.</span>
00122 
00123     percent_demanding_places_sl1 += 100*math.get_random_snd(0, <a class="code" href="Opschool_8h.html#a1">PSCH_SD</a>(0.025f*<span class="keywordtype">float</span>(sqrt(percent_demanding_places_sl1/100*(1-percent_demanding_places_sl1/100)))) );
00124     <span class="comment">// min &amp; max bug chea</span>
00125     percent_demanding_places_sl1 = max(0.0f,percent_demanding_places_sl1);
00126 
00127     <span class="keywordflow">if</span>(percent_demanding_places_sl1&gt;=100)           <span class="comment">//## chea 270999</span>
00128         percent_demanding_places_sl1=100;
00129 
00130     demand_places = int(percent_demanding_places_sl1 * enroll_res.student_count[<a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>] / 100);
00131     filled_places = min(current_places, demand_places);
00132 
00133     <span class="comment">//------------------------//</span>
00134     <span class="comment">// ($000)</span>
00135     fixed_onm = raw_initial_onm_cost_per_student_space * current_places / 1000;
00136     <span class="comment">// ($000)</span>
00137     variable_cost = raw_initial_variable_cost_per_occupied_space * filled_places / 1000;
00138     <span class="comment">// ($000)</span>
00139     total_expense = serviceOnDebt + fixed_onm + variable_cost;
00140 
00141     room_n_board_rate = (1000.0f * total_expense / filled_places);
00142 
00143     <span class="comment">//------------------------//</span>
00144     <span class="comment">// update total_revenue after calc of room and board rate</span>
00145     <span class="comment">// ($000)</span>
00146     total_revenue = float(filled_places * room_n_board_rate) / 1000;
00147 
00148     <span class="comment">//------------------------//</span>
00149     <span class="comment">//new_places;</span>
00150     <span class="keywordtype">int</span> unmetDemand = demand_places - filled_places;
00151     <span class="keywordflow">if</span> ( accomodate_excess_demand
00152          &amp;&amp; float(unmetDemand) * 100 / demand_places &gt; percent_excess_demand_before_capacity_increased
00153         )
00154         new_places = unmetDemand;
00155     <span class="keywordflow">else</span>
00156         new_places = 0;
00157 
00158     <span class="comment">//($000)</span>
00159     new_places_expense_last_year = replacement_cost_per_student_space * new_places / 1000.0f;
00160     finance.last_year.asset_array[<a class="code" href="Ofinance_8h.html#a97a24">AC_RESIDENCE</a>] = replacement_cost_per_student_space * current_places / 1000.0f;
00161     finance.this_year.asset_array[<a class="code" href="Ofinance_8h.html#a97a24">AC_RESIDENCE</a>] = finance.last_year.asset_array[<a class="code" href="Ofinance_8h.html#a97a24">AC_RESIDENCE</a>];
00162 
00163     finance.this_year.liability_array[<a class="code" href="Ofinance_8h.html#a99a28">AC_RESIDENCE_HALL_DEBT</a>] = finance.last_year.liability_array[<a class="code" href="Ofinance_8h.html#a99a28">AC_RESIDENCE_HALL_DEBT</a>];
00164 
00165     finance.this_year.liability_array[<a class="code" href="Ofinance_8h.html#a99a29">AC_LIABILITY_TOTAL</a>] = 0;
00166     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;<a class="code" href="Ofinance_8h.html#a98a26">LIABILITY_ITEM_COUNT</a>-1 ; i++ ) {
00167         finance.this_year.liability_array[<a class="code" href="Ofinance_8h.html#a99a29">AC_LIABILITY_TOTAL</a>] += finance.this_year.liability_array[i];
00168     }
00169 
00170     <span class="comment">//------------------------//</span>
00171     <a class="code" href="ALL_8H.html#a0">err_when</a>(finance.this_year.asset_array[<a class="code" href="Ofinance_8h.html#a97a24">AC_RESIDENCE</a>] &lt; 0);
00172     <a class="code" href="ALL_8H.html#a0">err_when</a>(new_places_expense_last_year&lt;0);
00173     <a class="code" href="ALL_8H.html#a0">err_when</a>(current_places &lt; 0 || demand_places&lt;0 || filled_places&lt;0);
00174 
00175     <a class="code" href="ALL_8H.html#a0">err_when</a>(<span class="keywordtype">int</span>(total_expense) != <span class="keywordtype">int</span>(total_revenue));
00176     <a class="code" href="ALL_8H.html#a0">err_when</a>(percent_demanding_places_sl1 &gt; 100 || percent_demanding_places_sl1 &lt;0);
00177 
00178     <span class="comment">//------------------------//</span>
00179     update_history(UPDATE_ALL);
00180 }
00181 
00182 <span class="comment">//------------- End of function StudentOffice::init_data --------//</span>
00183 
00184 <span class="comment">//----------- Begin of function StudentOffice::next_day ------//</span>
<a name="l00187"></a><a class="code" href="classStudentOffice.html#a5">00187</a> <span class="comment">void StudentOffice::next_day() {</span>
00188     <span class="comment">// start of a month</span>
00189     <span class="keywordflow">if</span> ( info.game_day == 1 ) {
00190         <span class="comment">// start of a year</span>
00191         <span class="keywordflow">if</span> ( info.game_month == finance.fiscal_year_start_month ) {
00192             run_residence_hall_yearly();                <span class="comment">// shouldn't be called through init_data()</span>
00193             update_history(UPDATE_YEAR);
00194         }
00195 
00196         update_history(UPDATE_MONTH);
00197     }
00198 
00199     <span class="comment">// start of a trimester</span>
00200     <span class="keywordflow">if</span> ( info.game_day == player_school.trimester_array[player_school.cur_trimester].start_day
00201          &amp;&amp; info.game_month == player_school.trimester_array[player_school.cur_trimester].start_month ) {
00202         update_history(UPDATE_TRIMESTER);
00203     }
00204 
00205 }
00206 
00207 <span class="comment">//------------- End of function StudentOffice::next_day ------//</span>
00208 
00209 <span class="comment">//----------- Begin of function StudentOffice::update_history_sub ------//</span>
00212 <span class="comment">void StudentOffice::update_history_sub() {</span>
00213     tuition_income_history[<a class="code" href="Gamedef_8h.html#a82a48">H_PREV_YEAR</a>] = (int) finance.revenue_array[<a class="code" href="Ofinance_8h.html#a101a32">AC_GROSS_TUITION_INCOME</a>].total;
00214     student_life_history[<a class="code" href="Gamedef_8h.html#a82a48">H_PREV_YEAR</a>] = (int) finance.expense_array[<a class="code" href="Ofinance_8h.html#a104a49">AC_STUDENT_LIFE</a>].total;
00215 
00216     tuition_income_history[<a class="code" href="Gamedef_8h.html#a82a49">H_THIS_YEAR</a>] = (int) finance.projected_revenue_array[<a class="code" href="Ofinance_8h.html#a101a32">AC_GROSS_TUITION_INCOME</a>].this_year.total;
00217     student_life_history[<a class="code" href="Gamedef_8h.html#a82a49">H_THIS_YEAR</a>] = (int) finance.projected_expense_array[<a class="code" href="Ofinance_8h.html#a104a49">AC_STUDENT_LIFE</a>].this_year.total;
00218 
00219     tuition_income_history[<a class="code" href="Gamedef_8h.html#a82a50">H_NEXT_YEAR</a>] = (int) finance.projected_revenue_array[<a class="code" href="Ofinance_8h.html#a101a32">AC_GROSS_TUITION_INCOME</a>].next_year.total;
00220     student_life_history[<a class="code" href="Gamedef_8h.html#a82a50">H_NEXT_YEAR</a>] = (int) finance.projected_expense_array[<a class="code" href="Ofinance_8h.html#a104a49">AC_STUDENT_LIFE</a>].next_year.total;
00221 }
00222 
00223 <span class="comment">//------------- End of function StudentOffice::update_history_sub ------//</span>
00224 
00225 <span class="comment">//----------- Begin of function Athletics::update_history ------//</span>
00230 <span class="comment">void StudentOffice::update_history(char updateFlag) {</span>
00231     <span class="comment">//float input;</span>
00232     <span class="comment">//int h;</span>
00233 
00234     <span class="keywordtype">int</span> h;
00235 
00236     <span class="keywordflow">switch</span> (updateFlag) {
00237     <span class="keywordflow">case</span> UPDATE_MONTH:
00238         update_history_sub();
00239         <span class="keywordflow">break</span>;
00240 
00241     <span class="keywordflow">case</span> UPDATE_TRIMESTER:
00242 
00243         <span class="comment">//## chea 270999 for update stu_sum only</span>
00244         <span class="keywordflow">for</span> (h=0;h&lt;<a class="code" href="Ostudent_8h.html#a34a12">MAX_STUDENT_LEVEL_N_TOTAL</a>; h++)
00245             <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(player_school.ins_student_level_history[h], HISTORY_TRIMESTER_COUNT);
00246         player_school.update_stu_sum();
00247 
00248         <span class="keywordflow">for</span> (h=0;h&lt;<a class="code" href="Gamedef_8h.html#a77a33">GENDER_ETHNIC_TYPE_COUNT_N_TOTAL</a>; h++)
00249             <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(player_school.ins_gender_student_level_history[h], HISTORY_TRIMESTER_COUNT);
00250         player_school.update_gender();              <span class="comment">//## chea 290999</span>
00251 
00252         <span class="keywordflow">break</span>;
00253 
00254     <span class="keywordflow">case</span> UPDATE_YEAR:
00255         <span class="comment">//-----------------//</span>
00256         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(available_bed_count, HISTORY_YEAR_COUNT);
00257         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(occupied_bed_count, HISTORY_YEAR_COUNT);
00258 
00259         available_bed_count[THIS_YEAR] = current_places;
00260         occupied_bed_count[THIS_YEAR] = filled_places;
00261 
00262         <span class="comment">//-----------------//</span>
00263         <span class="comment">// not ($000)</span>
00264         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(tuition_rate_history, HISTORY_YEAR_COUNT);
00265         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(room_n_board_rate_history, HISTORY_YEAR_COUNT);
00266         tuition_rate_history[THIS_YEAR] = finance.tuition_rate;
00267         room_n_board_rate_history[THIS_YEAR] = (int) room_n_board_rate;
00268 
00269         <span class="comment">//-----------------//</span>
00270         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(tuition_income_history, HISTORY_YEAR_COUNT);
00271         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(student_life_history, HISTORY_YEAR_COUNT);
00272         update_history_sub();                       <span class="comment">//data from finance</span>
00273         <span class="keywordflow">break</span>;
00274 
00275     <span class="keywordflow">case</span> UPDATE_ALL:
00276         <span class="comment">// calling order is important for update_history_sub()</span>
00277         update_history(UPDATE_YEAR);
00278         update_history(UPDATE_TRIMESTER);
00279         update_history(UPDATE_MONTH);
00280         <span class="keywordflow">break</span>;
00281 
00282     <span class="keywordflow">default</span>:
00283         <a class="code" href="ALL_8H.html#a1">err_here</a>();
00284         <span class="keywordflow">break</span>;
00285     }
00286 }
00287 
00288 <span class="comment">//------------- End of function Athletics::update_history ------//</span>
00289 
00290 <span class="comment">//----------- Begin of function StudentOffice::deinit --------//</span>
00294 <span class="comment">void StudentOffice::run_residence_hall_yearly() {</span>
00295     <span class="keywordtype">float</span> inflationRate = (float) finance.inflation_rate / 100.0f;
00296     <span class="keywordtype">float</span> staffGrowthRate = (float) finance.expense_policy_array[<a class="code" href="Ofinance_8h.html#a110a71">PL_STAFF_SALARY_INCREASES</a>].result_value / 100.0f;
00297 
00298     <span class="comment">// oldcode: H90=(1+'[HE.ResAlloc.ex]'!$C$72+'[HE.ResAlloc.ex]'!$C$78)*G90</span>
00299     <span class="comment">// replacement_cost_per_student_space *= float(1 + inflationRate + finance.construction_cost_growth/100.0f);        // not ($000)</span>
00300     <span class="comment">// 0.99-&gt;99%</span>
00301     <span class="keyword">static</span> <span class="keywordtype">float</span> replacement_cost_growth = math.get_random_snd(0.030f,<a class="code" href="Opschool_8h.html#a1">PSCH_SD</a>(.01f));
00302     <span class="keyword">static</span> <span class="keywordtype">float</span> replacement_cost_growth_last2 = 0;
00303 
00304     <span class="keywordtype">float</span> lastValue = replacement_cost_growth;
00305     replacement_cost_growth = math.time_variation(lastValue, replacement_cost_growth_last2, 1.4482f, -0.8011f, 0.003528950f);
00306     replacement_cost_growth_last2 = lastValue;
00307 
00308     replacement_cost_per_student_space = int( replacement_cost_per_student_space * (1+inflationRate+replacement_cost_growth) );
00309 
00310     <a class="code" href="ALL_8H.html#a0">err_when</a>(replacement_cost_per_student_space &lt;= 0);
00311 
00312     raw_initial_onm_cost_per_student_space *= float(1 + 0.25f * inflationRate + 0.75f * staffGrowthRate );
00313     raw_initial_variable_cost_per_occupied_space *= float(1 + 0.5f * inflationRate + 0.5f * staffGrowthRate );
00314 
00315     <span class="comment">//------ Capacity, demand, and revenue -------//</span>
00316 
00317     <span class="comment">//0106 percent_demanding_places_sl1 += 100 * math.get_random_snd(0, 0.025f*float(sqrt(percent_demanding_places_sl1/100*(1-percent_demanding_places_sl1/100))));</span>
00318     <span class="comment">//0106 percent_demanding_places_sl1 = max(0,percent_demanding_places_sl1);</span>
00319 
00320     <span class="comment">// Student spaces take 12 months to build. All spaces come on line at the beginning of the year.</span>
00321     current_places += new_places;
00322     demand_places = int(percent_demanding_places_sl1 * enroll_res.student_count[<a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>] / 100);
00323     filled_places = min(current_places, demand_places);
00324 
00325     <span class="comment">//------------------------//</span>
00326     <span class="comment">// =('[HE.ResAlloc.ex]Sheet1'!$C$74+'[HE.ResAlloc.ex]Sheet1'!$C$75)*H117</span>
00327     <span class="comment">// ($000)</span>
00328     <span class="keywordtype">float</span> debtBalance = (float) finance.last_year.liability_array[<a class="code" href="Ofinance_8h.html#a99a28">AC_RESIDENCE_HALL_DEBT</a>];
00329     <span class="comment">// ($000)</span>
00330     <span class="keywordtype">float</span> serviceOnDebt = debtBalance * float(finance.debt_fraction_repaid_annually + finance.long_term_debt_interest) / 100;
00331 
00332     <span class="comment">// ($000)</span>
00333     <span class="keywordtype">float</span> fixed_onm = raw_initial_onm_cost_per_student_space * current_places / 1000;
00334     <span class="comment">// ($000)</span>
00335     <span class="keywordtype">float</span> variable_cost = raw_initial_variable_cost_per_occupied_space * filled_places / 1000;
00336     <span class="comment">// ($000)</span>
00337     <span class="keywordtype">float</span> total_expense = serviceOnDebt + fixed_onm + variable_cost;
00338 
00339     <span class="keywordflow">if</span> ( filled_places &gt; 0 )
00340         room_n_board_rate = (1000.0f * total_expense / filled_places);
00341     <span class="keywordflow">else</span>
00342         room_n_board_rate = 0;                        <span class="comment">//askbill this special case</span>
00343 
00344     <span class="comment">//------------------------//</span>
00345     <span class="comment">// update total_revenue after calc of room and board rate</span>
00346 
00347     <span class="comment">// ($000)</span>
00348     <span class="keywordtype">float</span> total_revenue = float(filled_places * room_n_board_rate) / 1000;
00349 
00350     <span class="comment">//------------------------//</span>
00351 
00352     <span class="keywordtype">int</span> unmetDemand = demand_places - filled_places;
00353     <span class="keywordflow">if</span> ( accomodate_excess_demand
00354 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00355 <span class="preprocessor"></span>         &amp;&amp; math.safe_divide(unmetDemand * 100, demand_places) &gt; percent_excess_demand_before_capacity_increased
00356 <span class="preprocessor">#else</span>
00357 <span class="preprocessor"></span>         &amp;&amp; float(unmetDemand) * 100 / demand_places &gt; percent_excess_demand_before_capacity_increased
00358 <span class="preprocessor">#endif</span>
00359 <span class="preprocessor"></span>        )
00360         new_places = unmetDemand;
00361     <span class="keywordflow">else</span>
00362         new_places = 0;
00363 
00364     finance.this_year.asset_array[<a class="code" href="Ofinance_8h.html#a97a24">AC_RESIDENCE</a>]
00365         = new_places_expense_last_year + finance.last_year.asset_array[<a class="code" href="Ofinance_8h.html#a97a24">AC_RESIDENCE</a>];
00366     finance.this_year.liability_array[<a class="code" href="Ofinance_8h.html#a99a28">AC_RESIDENCE_HALL_DEBT</a>]
00367         = new_places_expense_last_year
00368         + finance.last_year.liability_array[<a class="code" href="Ofinance_8h.html#a99a28">AC_RESIDENCE_HALL_DEBT</a>] * ( 1-finance.debt_fraction_repaid_annually / 100.0f);
00369 
00370     <span class="comment">//($000)</span>
00371     new_places_expense_last_year = replacement_cost_per_student_space * new_places / 1000.0f;
00372 
00373     finance.this_year.liability_array[<a class="code" href="Ofinance_8h.html#a99a29">AC_LIABILITY_TOTAL</a>] = 0;
00374     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;<a class="code" href="Ofinance_8h.html#a98a26">LIABILITY_ITEM_COUNT</a>-1 ; i++ ) {
00375         finance.this_year.liability_array[<a class="code" href="Ofinance_8h.html#a99a29">AC_LIABILITY_TOTAL</a>] += finance.this_year.liability_array[i];
00376     }
00377 
00378     <span class="comment">//------------------------//</span>
00379 
00380     <a class="code" href="ALL_8H.html#a0">err_when</a>(finance.this_year.asset_array[<a class="code" href="Ofinance_8h.html#a97a24">AC_RESIDENCE</a>] &lt; 0);
00381     <a class="code" href="ALL_8H.html#a0">err_when</a>(new_places_expense_last_year&lt;0);
00382     <a class="code" href="ALL_8H.html#a0">err_when</a>(current_places &lt; 0 || demand_places&lt;0 || filled_places&lt;0);
00383     <a class="code" href="ALL_8H.html#a0">err_when</a>(<span class="keywordtype">int</span>(total_expense) != <span class="keywordtype">int</span>(total_revenue) &amp;&amp; total_revenue != 0);
00384     <a class="code" href="ALL_8H.html#a0">err_when</a>(percent_demanding_places_sl1 &gt; 100 || percent_demanding_places_sl1 &lt;0);
00385 }
00386 
00387 <span class="comment">//------------- End of function StudentOffice::deinit --------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:28 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
