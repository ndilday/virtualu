<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Odept_pi.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Odept_pi.cpp</h1><a href="Odept__pi_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : ODEPT_PI.CPP</span>
00002 <span class="comment">//Description : Functions for calculating departmental performance indicators</span>
00003 <span class="comment">//Owner       : Fred</span>
00004 
00005 <span class="comment">// #include &lt;OSYS.H&gt;</span>
00006 <span class="preprocessor">#include &lt;ODEPT.H&gt;</span>
00007 <span class="preprocessor">#include &lt;OMATH.H&gt;</span>
00008 <span class="comment">//#include &lt;OFINANCE.H&gt;</span>
00009 <span class="preprocessor">#include &lt;OPSCHOOL.H&gt;</span>
00010 <span class="preprocessor">#include &lt;OFACULTY.H&gt;</span>
00011 <span class="preprocessor">#include &lt;OFACURES.H&gt;</span>
00012 <span class="preprocessor">#include &lt;<a class="code" href="OSCHLRES_8H.html">OSCHLRES.H</a>&gt;</span>
00013 <span class="preprocessor">#include &lt;OLIBTECH.H&gt;</span>
00014 <span class="preprocessor">#include &lt;<a class="code" href="ODEPTRES_8H.html">ODEPTRES.H</a>&gt;</span>
00015 <span class="preprocessor">#include &lt;<a class="code" href="OCOURRES_8H.html">OCOURRES.H</a>&gt;</span>
00016 
00017 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00018 <span class="preprocessor"></span><span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="classDepartment.html#p0">Department::var_educational_quality_weight</a>[<a class="code" href="Odept_8h.html#a17a2">EDUCATIONAL_QUALITY_VAR_COUNT</a>] =
00019 { 0.35f, 0.15f, 0.10f, 0.05f, 0.15f, 0.10f, 0.10f, };
00020 <span class="preprocessor">#else</span>
<a name="l00021"></a><a class="code" href="classDepartment.html#p0">00021</a> <span class="preprocessor"></span><span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="classDepartment.html#p0">Department::var_educational_quality_weight</a>[<a class="code" href="Odept_8h.html#a17a2">EDUCATIONAL_QUALITY_VAR_COUNT</a>] =
00022 { 0.20f, 0.15f, 0.10f, 0.05f, 0.10f, 0.20f, 0.20f, };
00023 <span class="preprocessor">#endif</span>
00024 <span class="preprocessor"></span>
<a name="l00025"></a><a class="code" href="classDepartment.html#p1">00025</a> <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="classDepartment.html#p1">Department::var_academic_standing_weight</a>[<a class="code" href="Odept_8h.html#a17a3">ACADEMIC_STANDING_VAR_COUNT</a>] =
00026 { 0.5f, 0.3f, 0.1f, 0.1f, };
00027 
00028 <span class="comment">//------ Begin of function Department::calc_all_performance_indicator -------//</span>
<a name="l00032"></a><a class="code" href="classDepartment.html#a19">00032</a> <span class="comment">void Department::calc_all_performance_indicator() {</span>
00033     <a class="code" href="ALL_8H.html#a1">err_here</a>();
00034     <span class="keywordflow">return</span>;
00035 }
00036 
00037 <span class="comment">//------- End of function Department::calc_all_performance_indicator --------//</span>
00038 
00039 <span class="comment">//------ Begin of function Department::calc_faculty_research -------//</span>
00040 <span class="keywordtype">int</span> Department::get_regular_faculty_count() {
00041     <span class="keywordflow">return</span> <a class="code" href="classDepartment.html#m64">faculty_level_history</a>[<a class="code" href="Ofaculty_8h.html#a27a9">ASST_PROF</a>][THIS_YEAR] + <a class="code" href="classDepartment.html#m64">faculty_level_history</a>[<a class="code" href="Ofaculty_8h.html#a27a10">ASSOC_PROF</a>][THIS_YEAR]
00042         + <a class="code" href="classDepartment.html#m64">faculty_level_history</a>[<a class="code" href="Ofaculty_8h.html#a27a11">FULL_PROF</a>][THIS_YEAR];
00043 }
00044 
00045 <span class="comment">//------- End of function Department::calc_all_performance_indicator --------//</span>
00046 
00047 <span class="comment">//------ Begin of function Department::calc_faculty_research -------//</span>
00051 <span class="comment">void Department::calc_faculty_research() {</span>
00052     <a class="code" href="classFaculty.html">Faculty</a>* facultyPtr;
00053     <span class="keywordtype">int</span> facultyCount = 0;
00054 
00055     p_faculty_research = 0;                         <span class="comment">// reset it first</span>
00056 
00057     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=faculty_array.size() ; i&gt;0 ; i-- ) {
00058         <span class="keywordflow">if</span>( faculty_array.is_deleted(i) )
00059             <span class="keywordflow">continue</span>;
00060 
00061         facultyPtr = faculty_array[i];
00062         facultyCount++;
00063 
00064         p_faculty_research += facultyPtr-&gt;<a class="code" href="classFaculty.html#m32">performance_research</a>;
00065     }
00066 
00067     <span class="keywordflow">if</span> ( facultyCount )
00068         p_faculty_research /=  facultyCount;
00069     <span class="keywordflow">else</span>
00070         p_faculty_research = 0;
00071 
00072     <span class="comment">// just for error checking, they should be the same</span>
00073     <a class="code" href="ALL_8H.html#a0">err_when</a>( faculty_array.packed_size() != facultyCount );
00074     <span class="comment">// just for error checking, they should be the same</span>
00075     <a class="code" href="ALL_8H.html#a0">err_when</a>( faculty_array.packed_size() != faculty_array.faculty_count );
00076 }
00077 
00078 <span class="comment">//------- End of function Department::calc_faculty_research --------//</span>
00079 
00080 <span class="comment">//------ Begin of function Department::calc_academic_standing -------//</span>
00084 <span class="comment">void Department::calc_academic_standing() {</span>
00085     <span class="comment">//--------------------------------------------------//</span>
00086     <span class="comment">//</span>
00087     <span class="comment">// Calculate average of "total monthly expenditures</span>
00088     <span class="comment">// on sponsored research projects" in the faculty database.</span>
00089     <span class="comment">//</span>
00090     <span class="comment">//--------------------------------------------------//</span>
00091 
00092     <a class="code" href="classFaculty.html">Faculty</a>* facultyPtr;
00093 
00094     <span class="keywordtype">int</span> totalResearchExpense=0;
00095     <span class="keywordtype">int</span> facultyCount=0;
00096 
00097     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=faculty_array.size() ; i&gt;0 ; i-- ) {
00098         <span class="keywordflow">if</span>( faculty_array.is_deleted(i) )
00099             <span class="keywordflow">continue</span>;
00100 
00101         facultyPtr = faculty_array[i];
00102 
00103         totalResearchExpense += facultyPtr-&gt;<a class="code" href="classFaculty.html#m21">research_month_expense</a>;
00104 
00105         facultyCount++;
00106     }
00107 
00108     <span class="comment">// just for error checking, they should be the same</span>
00109     <a class="code" href="ALL_8H.html#a0">err_when</a>( faculty_array.packed_size() != facultyCount );
00110     <span class="comment">// just for error checking, they should be the same</span>
00111     <a class="code" href="ALL_8H.html#a0">err_when</a>( faculty_array.packed_size() != faculty_array.faculty_count );
00112 
00113     <span class="keywordtype">float</span> avgResearchExpense;
00114 
00115     <span class="keywordflow">if</span> ( research_dollar_norm )
00116         avgResearchExpense = float(totalResearchExpense) / research_dollar_norm;
00117     <span class="keywordflow">else</span>
00118         avgResearchExpense = 0.0f;
00119 
00120     <span class="comment">//-----------------------------------------------------//</span>
00121     <span class="comment">//</span>
00122     <span class="comment">// Calculate the average of "academic talent index" of</span>
00123     <span class="comment">// students who are doctoral students.</span>
00124     <span class="comment">//</span>
00125     <span class="comment">//-----------------------------------------------------//</span>
00126 
00127     <a class="code" href="classStudent.html">Student</a>* studentPtr;
00128     <span class="keywordtype">float</span>   totalTalentAcademic=0;
00129     <span class="keywordtype">int</span>   studentCount=0;
00130 
00131     <span class="keywordflow">for</span>( i=student_array.size() ; i&gt;0 ; i-- ) {
00132         <span class="keywordflow">if</span>( student_array.is_deleted(i) )
00133             <span class="keywordflow">continue</span>;
00134 
00135         studentPtr = student_array[i];
00136 
00137         <span class="keywordflow">if</span>( studentPtr-&gt;<a class="code" href="classStudent.html#m2">student_level</a> != <a class="code" href="Ostudent_8h.html#a32a6">DOCTOR</a> )
00138             <span class="keywordflow">continue</span>;
00139 
00140         totalTalentAcademic += (float) studentPtr-&gt;<a class="code" href="classStudent.html#m20">talent_academic</a>;
00141         studentCount++;
00142     }
00143 
00144     <span class="keywordtype">float</span> avgTalentAcademic;
00145 
00146     <span class="keywordflow">if</span>( studentCount &gt; 0 )
00147         avgTalentAcademic = float(totalTalentAcademic) / studentCount;
00148     <span class="keywordflow">else</span>
00149         avgTalentAcademic = 0;
00150 
00151     <span class="comment">//---------------//</span>
00152     <span class="keywordtype">float</span> doctorCountPerFac;                        <span class="comment">// Doctoral STUs (SL4): number of sims per regular faculty</span>
00153 
00154     <span class="keywordtype">int</span> facCount = get_regular_faculty_count();
00155 
00156     doctorCountPerFac = facCount &gt; 0 ? float(studentCount) / facCount : 0 ;
00157 
00158     <span class="comment">//----- pass the parameters through response functions ----//</span>
00159 
00160     <span class="keywordtype">float</span> facultyPublication = math.single_response_func(1, 100, 55.94f, 51.19f, p_faculty_research);
00161     avgResearchExpense = math.dual_response_func(0,3,100,2.069f,0.505f,0.015f, 1.872f, avgResearchExpense);
00162     avgTalentAcademic = math.dual_response_func(1, 35, 100, 17.11f, 51.61f, 12.38f, 62.41f, avgTalentAcademic);
00163     doctorCountPerFac = math.dual_response_func(1,60,100,0.394f,2.058f,0.915f,1.212f,doctorCountPerFac);
00164 
00165     <span class="comment">//--------------//</span>
00166 
00167     <span class="comment">//float weight[ACADEMIC_STANDING_VAR_COUNT] = { 0.5f, 0.3f, 0.1f, 0.1f };</span>
00168     <span class="keywordtype">float</span> input[<a class="code" href="Odept_8h.html#a17a3">ACADEMIC_STANDING_VAR_COUNT</a>];
00169     input[0] = facultyPublication;
00170     input[1] = avgResearchExpense;
00171     input[2] = avgTalentAcademic;
00172     input[3] = doctorCountPerFac;
00173 
00174     <span class="keywordtype">float</span> newValue = 0;
00175 
00176     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Odept_8h.html#a17a3">ACADEMIC_STANDING_VAR_COUNT</a>; i++)
00177         newValue += var_academic_standing_weight[i] * input[i];
00178 
00179     p_academic_standing_no_latency = newValue;
00180 
00181     <span class="keywordflow">if</span>( info.prerun_year == 1 )
00182         p_academic_standing = newValue;               <span class="comment">// initialize it without latency effect</span>
00183     <span class="keywordflow">else</span>
00184         <span class="comment">// 0.33 is the latency parameter</span>
00185         p_academic_standing = player_school.latency_func( 0.33f, p_academic_standing, newValue);
00186 
00187     <span class="comment">//--------------//</span>
00188 
00189     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Odept_8h.html#a17a3">ACADEMIC_STANDING_VAR_COUNT</a>; i++) {
00190         var_academic_standing_history[i][THIS_YEAR] = input[i];
00191 
00192         <span class="keywordtype">float</span> lastYear = var_academic_standing_history[i][THIS_YEAR-1];
00193         <span class="comment">//if (lastYear)</span>
00194         <span class="comment">//1130 // * var_academic_standing_weight[i] * 100 / lastYear;</span>
00195         var_change_academic_standing[i] = ( input[i] - lastYear );
00196         <span class="comment">//else</span>
00197         <span class="comment">//      var_change_academic_standing[i] = 0;</span>
00198     }
00199 }
00200 
00201 <span class="comment">//------- End of function Department::calc_academic_standing --------//</span>
00202 
00203 <span class="comment">//------ Begin of function Department::calc_tech_utilization -------//</span>
00205 <span class="comment">void Department::calc_tech_utilization() {</span>
00206     <span class="comment">//--------------------------------------------------//</span>
00207     <span class="comment">//</span>
00208     <span class="comment">// Calculate average of "allocation of discretionary time this</span>
00209     <span class="comment">// trimester in educational development".</span>
00210     <span class="comment">//</span>
00211     <span class="comment">//--------------------------------------------------//</span>
00212 
00213     <span class="comment">//##### begin: fred 0526 ########//</span>
00214     <a class="code" href="classFaculty.html">Faculty</a> *facultyPtr;
00215     <span class="keywordtype">int</span> facultyCount = 0;
00216     <span class="keywordtype">float</span> avgITHour = 0;
00217 
00218     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=faculty_array.size() ; i&gt;0 ; i-- ) {
00219         <span class="keywordflow">if</span>( faculty_array.is_deleted(i) )
00220             <span class="keywordflow">continue</span>;
00221 
00222         facultyPtr = faculty_array[i];
00223 
00224         avgITHour += facultyPtr-&gt;<a class="code" href="classFaculty.html#m34">p_discretionary_hour_it</a>;
00225 
00226         facultyCount++;
00227     }
00228 
00229     <span class="keywordflow">if</span> ( facultyCount )
00230         avgITHour /= facultyCount;
00231 
00232 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00233 <span class="preprocessor"></span>    <span class="comment">// Version 2.0 Item 8d iii)</span>
00234     <span class="keywordtype">float</span> edDevHrs = avgITHour;
00235     <span class="keywordtype">float</span> timeShiftedFromScholarship=0;
00236     facultyCount=0;
00237     <span class="keywordtype">float</span> totalEdDevHrs=0;
00238 
00239     <span class="comment">// calculate timeShiftedFromScholarship</span>
00240     <span class="keywordflow">for</span> ( i=faculty_array.size(); i&gt;0; i-- ) {
00241         <span class="keywordflow">if</span> ( faculty_array.is_deleted(i) )
00242             <span class="keywordflow">continue</span>;
00243 
00244         timeShiftedFromScholarship = (0.3*library_tech_office.faculty_incentive_using_it/100+
00245                                       0.3*department_incentives/100)*(faculty_array.operator [](i)-&gt;discretionary_hour_array[<a class="code" href="Ofaculty_8h.html#a29a19">DT_SCHOLARSHIP</a>]);
00246 
00247         <span class="comment">// restore back time shifted last trimester</span>
00248         faculty_array.operator [](i)-&gt;discretionary_hour_array[<a class="code" href="Ofaculty_8h.html#a29a19">DT_SCHOLARSHIP</a>] += faculty_array[i]-&gt;time_shifted_scholarship;
00249 
00250         edDevHrs = edDevHrs + timeShiftedFromScholarship;
00251 
00252         faculty_array.operator [](i)-&gt;discretionary_hour_array[<a class="code" href="Ofaculty_8h.html#a29a19">DT_SCHOLARSHIP</a>] -= timeShiftedFromScholarship;
00253 
00254         faculty_array[i]-&gt;time_shifted_scholarship = timeShiftedFromScholarship;
00255 
00256         totalEdDevHrs += edDevHrs;
00257         facultyCount++;
00258     }
00259 
00260     <span class="keywordtype">float</span> input1;
00261 
00262     <span class="comment">// calculate p_tech_utilization</span>
00263     <span class="keywordflow">if</span> ( facultyCount != 0 )
00264         input1 = totalEdDevHrs/facultyCount;
00265     <span class="keywordflow">else</span>
00266         input1 = 0;
00267 
00268     p_tech_utilization = player_school.latency_func( 0.9f, p_tech_utilization, input1 );
00269 
00270 <span class="preprocessor">#else</span>
00271 <span class="preprocessor"></span>    <span class="keywordtype">float</span> internetQuality = library_tech_office.internet_quality_percent;
00272     <span class="keywordtype">float</span> input1 = float(avgITHour * internetQuality) / 100;
00273     input1 = math.dual_response_func(0, 25.98f, 100, 3.01f, 9.48f, 2.35f,13.30f, input1);
00274     <span class="comment">//## chea 280999 BUGHERE G79</span>
00275     <span class="comment">//## chea 300899 change latency_func(HE.RespF_Defs.Rev 230899 E-mail)</span>
00276     p_tech_utilization =  player_school.latency_func( 0.9f, p_tech_utilization, input1);
00277 <span class="preprocessor">#endif</span>
00278 <span class="preprocessor"></span>
00279     cummulative_tech_utilization += p_tech_utilization;
00280 }
00281 
00282 <span class="comment">//------- End of function Department::calc_tech_utilization --------//</span>
00283 
00284 <span class="comment">//------ Begin of function Department::calc_educational_quality -------//</span>
<a name="l00286"></a><a class="code" href="classDepartment.html#a23">00286</a> <span class="comment">void Department::calc_educational_quality() {</span>
00287     <span class="comment">//##### begin fred 0811 #####//</span>
00288 
00289     <span class="keywordtype">float</span> input[<a class="code" href="Odept_8h.html#a17a2">EDUCATIONAL_QUALITY_VAR_COUNT</a>];
00290 
00291     memset(input, 0, <span class="keyword">sizeof</span>(input));
00292 
00293     <span class="comment">//----- calculate the department's average teaching and scholarship performance ------//</span>
00294 
00295     <span class="keywordtype">int</span> female = 0, minority = 0;
00296 
00297     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=faculty_array.size() ; i&gt;0 ; i-- ) {
00298         <span class="keywordflow">if</span>( faculty_array.is_deleted(i) )
00299             <span class="keywordflow">continue</span>;
00300 
00301         input[0] += faculty_array[i]-&gt;performance_teaching;
00302         input[2] += faculty_array[i]-&gt;performance_scholarship;
00303     }
00304 
00305     <span class="keywordflow">if</span> ( faculty_array.faculty_count ) {
00306         input[0] /= faculty_array.faculty_count;
00307         input[2] /= faculty_array.faculty_count;
00308     }
00309     <span class="keywordflow">else</span> {
00310         input[0] = 0;
00311         input[2] = 0;
00312     }
00313 
00314     <span class="comment">//--------------//</span>
00315     input[1] = (float) faculty_array.avg_discretionary_hour(<a class="code" href="Ofaculty_8h.html#a29a17">DT_EDUCATIONAL_DEVELOPMENT</a>);
00316 
00317     <span class="comment">//--------------//</span>
00318     input[3] = p_faculty_research;
00319 
00320     <span class="comment">//--------------//</span>
00321     input[4] = p_tech_utilization;
00322 
00323     <span class="comment">//--------------//</span>
00324     <span class="comment">/*</span>
00325 <span class="comment">      for each teaching method for the dept</span>
00326 <span class="comment">      sum += (total enrollment for courses of this teaching method/number of</span>
00327 <span class="comment">      sections for courses of this teaching method) - (normal class size for this</span>
00328 <span class="comment">      teaching method);</span>
00329 <span class="comment"></span>
00330 <span class="comment">      1st_factor = sum / number of teaching methods;</span>
00331 <span class="comment"></span>
00332 <span class="comment">      In other words, this is the average, over teaching methods, of average per</span>
00333 <span class="comment">      section (ie actual emrollment/no. of sections) minus normal class size. I'm</span>
00334 <span class="comment">      afraid I left off the minus sign in the variable definition.</span>
00335 <span class="comment">    */</span>
00336     <span class="comment">/*</span>
00337 <span class="comment">      int       classSize[MAX_TEACHING_METHOD];</span>
00338 <span class="comment">      int       classSectionCount[MAX_TEACHING_METHOD];</span>
00339 <span class="comment">      int       normalClassSizePerSection[MAX_TEACHING_METHOD];</span>
00340 <span class="comment"></span>
00341 <span class="comment">      memset(classSize, 0, sizeof(classSize));</span>
00342 <span class="comment">      memset(classSectionCount, 0, sizeof(classSize));</span>
00343 <span class="comment">      memset(normalClassSizePerSection, 0, sizeof(classSize));</span>
00344 <span class="comment"></span>
00345 <span class="comment">      for( i=course_array.packed_size() ; i&gt;0 ; i-- )  //## chea 080999 this should use size() since there is no del so this is alright</span>
00346 <span class="comment">      //   for( i=course_array.size() ; i&gt;0 ; i-- )</span>
00347 <span class="comment">      {</span>
00348 <span class="comment">      //                if(course_array.is_deleted(i))</span>
00349 <span class="comment">      //                        continue;</span>
00350 <span class="comment"></span>
00351 <span class="comment">      Course* coursePtr = course_array[i];</span>
00352 <span class="comment"></span>
00353 <span class="comment">      classSize[coursePtr-&gt;teaching_method]</span>
00354 <span class="comment">      += coursePtr-&gt;convention_student_count;</span>
00355 <span class="comment"></span>
00356 <span class="comment">      classSectionCount[coursePtr-&gt;teaching_method]</span>
00357 <span class="comment">      += coursePtr-&gt;class_section_count;</span>
00358 <span class="comment"></span>
00359 <span class="comment">      normalClassSizePerSection[coursePtr-&gt;teaching_method]</span>
00360 <span class="comment">      += coursePtr-&gt;normal_class_size();</span>
00361 <span class="comment"></span>
00362 <span class="comment">      err_when(coursePtr-&gt;teaching_method &gt;= MAX_TEACHING_METHOD);</span>
00363 <span class="comment">      }</span>
00364 <span class="comment">    */</span>
00365     input[5] = 0;
00366 
00367     <span class="keywordflow">for</span> ( i=0; i&lt;<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>; i++) {
00368         input[5] += (float) course_array.average_class_size[i] / course_array.normal_class_size[i];
00369 
00370         <span class="comment">//              if ( classSectionCount[i] )</span>
00371         <span class="comment">//                      input[5] += (float(classSize[i]) / classSectionCount[i]) / normalClassSizePerSection[i];</span>
00372     }
00373 
00374     input[5] /= <a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>;
00375 
00376     <span class="comment">//--------------//</span>
00377     <span class="comment">// "Percent course sections" for a teaching method = 100*(number sections for</span>
00378     <span class="comment">// that teaching method/total number of sections for the department).</span>
00379 
00380     <span class="keywordtype">int</span> totalSectionCount = 0;
00381 
00382     <span class="keywordflow">for</span> ( i=0; i&lt;<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>; i++) {
00383         totalSectionCount += course_array.class_section_count[i];
00384         <span class="comment">//              totalSectionCount += classSectionCount[i];</span>
00385     }
00386 
00387     <span class="keywordtype">float</span> inputSub;
00388 
00389     <span class="keywordflow">if</span> ( totalSectionCount ) {
00390         <span class="keywordflow">for</span> ( i=0; i&lt;<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>; i++) {
00391             inputSub = float( 100 * course_array.class_section_count[i] / totalSectionCount )
00392                 - course_res.get_template(department_res[department_id]-&gt;template_course_type)-&gt;target_preference[<a class="code" href="OCOURRES_8H.html#a8a3">P_SEMINAR</a>];
00393 
00394             <span class="comment">//                  inputSub = float( 100 * classSectionCount[i] / totalSectionCount )</span>
00395             <span class="comment">//                                                  - course_res.get_template(department_res[department_id]-&gt;template_course_type)-&gt;target_preference[P_SEMINAR];</span>
00396 
00397             input[6] += inputSub&gt;0 ? inputSub : -inputSub;
00398         }
00399     }
00400 
00401     input[6] /= <a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>;
00402 
00403     <span class="comment">//-------- these two have to go thru the response function before they are updated to the historical array ---//</span>
00404 
00405     input[5] = math.dual_response_func(1,50,100,-0.1783f,-0.1822f,1.2340f,0.7667f, input[5]);
00406 
00407     input[6] = 0.5f + input[6] / 20.0f;
00408     input[6] = math.dual_response_func(1,50,100,-0.1783f,-0.1822f,1.2340f,0.7667f, input[6]);
00409     <span class="comment">//  input[6] = math.dual_response_func(0,48.32f,100,13.97f,20.21f,-18.14f,14.70f, input[6]);</span>
00410 
00411     <span class="comment">//----- save the input into historical array for later display ---------//</span>
00412 
00413     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Odept_8h.html#a17a2">EDUCATIONAL_QUALITY_VAR_COUNT</a>; i++) {
00414         var_educational_quality_history[i][THIS_TRIMESTER] = input[i];
00415 
00416         <span class="keywordtype">float</span> lastYear = var_educational_quality_history[i][THIS_TRIMESTER-3];
00417         <span class="comment">//if (lastYear)</span>
00418         <span class="comment">//1130 // * var_educational_quality_weight[i] * 100 / lastYear;</span>
00419         var_change_educational_quality[i] = ( input[i] - lastYear );
00420         <span class="comment">//else</span>
00421         <span class="comment">//      var_change_educational_quality[i] = 0;</span>
00422     }
00423 
00424     <span class="comment">//------ pass the input through response functions and use the results to calculate the educational quality value -----//</span>
00425 
00426     input[0] = math.single_response_func(1,100,55.94f,51.19f, input[0]);
00427     input[1] = math.single_response_func(1,100,6.32f,7.58f, input[1]);
00428     input[2] = math.dual_response_func(1,50,100,28.35f,29.00f,22.31f,77.45f, input[2]);
00429     input[3] = math.dual_response_func(1,100,90,28.91f,20.78f,21.85f,80.03f, input[3]);
00430     input[4] = math.single_response_func(1,100,48.82f,40.98f, input[4]);
00431 
00432     <span class="comment">//------- calculate the new educational quality -------//</span>
00433 
00434     <span class="keywordtype">float</span> newValue = 0;
00435 
00436     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Odept_8h.html#a17a2">EDUCATIONAL_QUALITY_VAR_COUNT</a>; i++)
00437         newValue += var_educational_quality_weight[i] * input[i];
00438 
00439     p_educational_quality = newValue;
00440 }
00441 
00442 <span class="comment">//------- End of function Department::calc_educational_quality --------//</span>
00443 
00444 <span class="comment">//------ Begin of function Department::calc_student_morale -------//</span>
00446 <span class="comment">void Department::calc_student_morale() {</span>
00447     <span class="comment">// calc Student satisfaction with the department's academic program</span>
00448     <span class="comment">// 980923: = average of student satisfaction: academic for students majoring in the department</span>
00449 
00450     <span class="keywordtype">float</span> totalSat = 0, input;
00451 
00452     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=student_array.size() ; i&gt;0 ; i-- ) {
00453         <span class="keywordflow">if</span>( student_array.is_deleted(i) )
00454             <span class="keywordflow">continue</span>;
00455 
00456         totalSat += student_array[i]-&gt;satisfaction_overall;
00457         <span class="comment">//              totalSat += student_array[i]-&gt;satisfaction_academic;</span>
00458     }
00459 
00460     <span class="keywordflow">if</span> ( student_array.student_count )
00461         input = totalSat / student_array.student_count;
00462     <span class="keywordflow">else</span>
00463         input = 0;
00464 
00465     <span class="keywordflow">if</span>( info.prerun_year )                          <span class="comment">// set it without latency during initialization</span>
00466         p_student_morale = input;
00467     <span class="keywordflow">else</span>
00468         p_student_morale = player_school.latency_func( 0.9f, p_student_morale, input);
00469 }
00470 
00471 <span class="comment">//------- End of function Department::calc_student_morale --------//</span>
00472 
00473 <span class="comment">//------ Begin of function Department::calc_faculty_morale -------//</span>
00475 <span class="comment">void Department::calc_faculty_morale() {</span>
00476     <span class="keywordtype">float</span> totalSat = 0;
00477 
00478 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00479 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( info.game_month == 1 )                     <span class="comment">// if it is Jananry, no need to re-calculate the faculty morale</span>
00480         <span class="keywordflow">return</span>;
00481 <span class="preprocessor">#endif</span>
00482 <span class="preprocessor"></span>
00483     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=faculty_array.size() ; i&gt;0 ; i-- ) {
00484         <span class="keywordflow">if</span>( faculty_array.is_deleted(i) )
00485             <span class="keywordflow">continue</span>;
00486 
00487 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00488 <span class="preprocessor"></span>        <span class="comment">// have not taught in this semester</span>
00489         <span class="keywordflow">if</span> ( player_school.cur_trimester == faculty_array[i]-&gt;off_duty_trimester )
00490             totalSat += faculty_array[i]-&gt;satisfaction_index_last_tri;
00491         <span class="keywordflow">else</span>
00492             totalSat += faculty_array[i]-&gt;satisfaction_index;
00493 <span class="preprocessor">#else</span>
00494 <span class="preprocessor"></span>        totalSat += faculty_array[i]-&gt;satisfaction_index;
00495 <span class="preprocessor">#endif</span>
00496 <span class="preprocessor"></span>    }
00497 
00498     <span class="keywordflow">if</span> (faculty_array.faculty_count )
00499         p_faculty_morale = totalSat / faculty_array.faculty_count;
00500     <span class="keywordflow">else</span>
00501         p_faculty_morale = 0;
00502 
00503 }
00504 
00505 <span class="comment">//------- End of function Department::calc_faculty_morale --------//</span>
00506 
00507 <span class="comment">//------ Begin of function Department::calc_faculty_morale -------//</span>
00509 <span class="comment">void Department::calc_faculty_diversity() {</span>
00510 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00511 <span class="preprocessor"></span>
00512     <span class="comment">// Formula used by the U.S. Census Bureau</span>
00513     <span class="comment">// diversity = 1 - {(%NonMinMale/100)^2 + (%NonMinFemale/100)^2 + (%MinMale/100)^2 + (%MinFemale/100)^2}</span>
00514 
00515     <span class="keywordtype">int</span> nonMinMale = 0;
00516     <span class="keywordtype">int</span> nonMinFemale = 0;
00517     <span class="keywordtype">int</span> minMale = 0;
00518     <span class="keywordtype">int</span> minFemale = 0;
00519 
00520     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=faculty_array.size() ; i&gt;0 ; i-- ) {
00521         <span class="keywordflow">if</span>( faculty_array.is_deleted(i) )
00522             <span class="keywordflow">continue</span>;
00523 
00524         <span class="keywordflow">switch</span>(faculty_array[i]-&gt;gender_ethnic_group) {
00525         <span class="keywordflow">case</span> <a class="code" href="Gamedef_8h.html#a75a27">NONMINORITY_MALE</a>: ++nonMinMale; <span class="keywordflow">break</span>;
00526         <span class="keywordflow">case</span> <a class="code" href="Gamedef_8h.html#a75a28">NONMINORITY_FEMALE</a>: ++nonMinFemale; <span class="keywordflow">break</span>;
00527         <span class="keywordflow">case</span> <a class="code" href="Gamedef_8h.html#a75a29">MINORITY_MALE</a>: ++minMale; <span class="keywordflow">break</span>;
00528         <span class="keywordflow">case</span> <a class="code" href="Gamedef_8h.html#a75a30">MINORITY_FEMALE</a>: ++minFemale; <span class="keywordflow">break</span>;
00529         <span class="keywordflow">default</span>:
00530             <a class="code" href="ALL_8H.html#a1">err_here</a>();
00531             <span class="keywordflow">break</span>;
00532         }
00533     }
00534 
00535     <span class="keywordtype">int</span> facultyCount= nonMinMale + nonMinFemale + minMale + minFemale;
00536     <span class="keywordflow">if</span>( facultyCount &lt;= 0 ) {
00537         p_faculty_diversity = 0;
00538         <span class="keywordflow">return</span>;
00539     }
00540 
00541     p_faculty_diversity = 100.0f * (1.0f -
00542                                     float(nonMinMale*nonMinMale + nonMinFemale*nonMinFemale + minMale*minMale + minFemale*minFemale)
00543                                     / float(facultyCount*facultyCount));
00544 
00545 <span class="preprocessor">#else</span>
00546 <span class="preprocessor"></span>
00547     <span class="comment">// The following formula was proposed in WFM Design Responses, 3 August 1998:</span>
00548     <span class="comment">// 100*Min[1,{3*(%minority)+1*(%female)+2*(%minority)*(%female)}/2.5]</span>
00549     <span class="comment">// The %s refer to faculty.</span>
00550 
00551     <span class="comment">//enum { GENDER_ETHNIC_TYPE_COUNT = 4 };</span>
00552     <span class="comment">//enum { NONMINORITY_MALE, NONMINORITY_FEMALE, MINORITY_MALE, MINORITY_FEMALE };</span>
00553 
00554     <span class="keywordtype">char</span> group;
00555     <span class="keywordtype">int</span> female = 0, minority = 0;
00556 
00557     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=faculty_array.size() ; i&gt;0 ; i-- ) {
00558         <span class="keywordflow">if</span>( faculty_array.is_deleted(i) )
00559             <span class="keywordflow">continue</span>;
00560 
00561         group = faculty_array[i]-&gt;gender_ethnic_group;
00562         <span class="keywordflow">switch</span>(group) {
00563         <span class="keywordflow">case</span> <a class="code" href="Gamedef_8h.html#a75a27">NONMINORITY_MALE</a>:
00564             <span class="keywordflow">break</span>;
00565         <span class="keywordflow">case</span> <a class="code" href="Gamedef_8h.html#a75a28">NONMINORITY_FEMALE</a>:
00566             female++;
00567             <span class="keywordflow">break</span>;
00568         <span class="keywordflow">case</span> <a class="code" href="Gamedef_8h.html#a75a29">MINORITY_MALE</a>:
00569             minority++;
00570             <span class="keywordflow">break</span>;
00571         <span class="keywordflow">case</span> <a class="code" href="Gamedef_8h.html#a75a30">MINORITY_FEMALE</a>:
00572             minority++;
00573             female++;
00574             <span class="keywordflow">break</span>;
00575         <span class="keywordflow">default</span>:
00576             <a class="code" href="ALL_8H.html#a1">err_here</a>();
00577             <span class="keywordflow">break</span>;
00578         }
00579     }
00580 
00581     <span class="keywordflow">if</span> ( !faculty_array.faculty_count ) {
00582         p_faculty_diversity = 0;
00583         <span class="keywordflow">return</span>;
00584     }
00585 
00586     <span class="keywordtype">float</span> pctFemale = float(female) / faculty_array.faculty_count;
00587     <span class="keywordtype">float</span> pctMinority = float(minority) / faculty_array.faculty_count;
00588 
00589     <span class="comment">//## chea 071099 Error find by Bill (Email 071099 Sub:Answers 061099)</span>
00590     p_faculty_diversity = 100*min(1.0f,
00591                                   <span class="comment">//min &amp; max bug chea</span>
00592                                   (3*(pctMinority)+1*(pctFemale)+2*(pctMinority)*(pctFemale))/2.5f);
00593 
00594     <span class="comment">//  p_faculty_diversity = min(100.0f,</span>
00595     <span class="comment">//          (3*(pctMinority)+1*(pctFemale)+2*(pctMinority)*(pctFemale))/2.5f); //min &amp; max bug chea</span>
00596 <span class="preprocessor">#endif</span>
00597 <span class="preprocessor"></span>
00598 }
00599 
00600 <span class="comment">//------- End of function Department::calc_faculty_morale --------//</span>
00601 
00602 <span class="comment">//------ Begin of function Department::calc_faculty_history -------//</span>
00604 <span class="comment">void Department::calc_faculty_history() {</span>
00605     <span class="keywordtype">int</span> totalFacultyCount = 0, countInvest=0;
00606 
00607     <span class="keywordtype">int</span> j;
00608     <a class="code" href="classFaculty.html">Faculty</a> *facPtr;
00609     <span class="keywordtype">char</span> gender, sl;
00610 
00611     <span class="comment">// loop faculty</span>
00612     <span class="keywordflow">for</span> (j=faculty_array.size(); j&gt;0; j--) {
00613         <span class="keywordflow">if</span> ( faculty_array.is_deleted(j) )
00614             <span class="keywordflow">continue</span>;
00615 
00616         facPtr = faculty_array[j];
00617         sl = facPtr-&gt;<a class="code" href="classFaculty.html#m6">rank_level</a>;
00618         gender = facPtr-&gt;<a class="code" href="classFaculty.html#m7">gender_ethnic_group</a>;
00619 
00620         faculty_level_history[sl][THIS_YEAR]++;
00621         faculty_gender_history[gender][THIS_YEAR]++;
00622 
00623         <span class="keywordflow">if</span> (facPtr-&gt;<a class="code" href="classFaculty.html#m19">is_investigator</a>)
00624             countInvest++;
00625 
00626         totalFacultyCount++;
00627     }                                               <span class="comment">// end for j</span>
00628 
00629     faculty_level_history[<a class="code" href="Ofaculty_8h.html#a30a23">FACULTY_RANK_LEVEL_TOTAL</a>][THIS_YEAR] = totalFacultyCount;
00630     faculty_gender_history[<a class="code" href="Gamedef_8h.html#a77a34">GENDER_ETHNIC_TYPE_TOTAL</a>][THIS_YEAR] = totalFacultyCount;
00631     percent_investigator = (char) math.safe_divide(countInvest * 100,totalFacultyCount);
00632 
00633     <a class="code" href="ALL_8H.html#a0">err_when</a>(totalFacultyCount != faculty_array.faculty_count);
00634 }
00635 
00636 <span class="comment">//------- End of function Department::calc_faculty_history --------//</span>
00637 
00638 <span class="comment">//------ Begin of function GeneralDepartment::calc_student_history -------//</span>
<a name="l00640"></a><a class="code" href="classGeneralDepartment.html#a6">00640</a> <span class="comment">void GeneralDepartment::calc_student_history() {</span>
00641     <span class="keywordtype">int</span> totalStudentCount = 0;
00642 
00643     <span class="keywordtype">int</span> i, j;
00644     <a class="code" href="classStudent.html">Student</a> *stuPtr;
00645     <span class="keywordtype">char</span> gender, sl;
00646 
00647     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Ostudent_8h.html#a0">MAX_STUDENT_LEVEL</a>; i++)             <span class="comment">// 0406</span>
00648         student_level_history[i][THIS_YEAR] = 0;
00649     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>; i++)
00650         student_gender_history[i][THIS_YEAR] = 0;
00651 
00652     <span class="comment">// loop student</span>
00653     <span class="keywordflow">for</span> (j=student_array.size(); j&gt;0; j--) {
00654         <span class="keywordflow">if</span> ( student_array.is_deleted(j) )
00655             <span class="keywordflow">continue</span>;
00656 
00657         stuPtr = student_array[j];
00658         sl = stuPtr-&gt;<a class="code" href="classStudent.html#m2">student_level</a>;
00659         gender = stuPtr-&gt;<a class="code" href="classStudent.html#m3">gender_ethnic_group</a>;
00660 
00661         student_level_history[sl][THIS_YEAR]++;
00662         student_gender_history[gender][THIS_YEAR]++;
00663 
00664         totalStudentCount++;
00665     }                                               <span class="comment">// end for j</span>
00666 
00667     student_level_history[<a class="code" href="Ostudent_8h.html#a34a13">MAX_STUDENT_LEVEL_TOTAL</a>][THIS_YEAR] = totalStudentCount;
00668     student_gender_history[<a class="code" href="Gamedef_8h.html#a77a34">GENDER_ETHNIC_TYPE_TOTAL</a>][THIS_YEAR] = totalStudentCount;
00669     <a class="code" href="ALL_8H.html#a0">err_when</a>(totalStudentCount != student_array.student_count);
00670 }
00671 
00672 <span class="comment">//------- End of function GeneralDepartment::calc_student_history --------//</span>
00673 
00674 <span class="comment">//------- Begin of function Department::calc_research_history -----//</span>
00676 <span class="comment">void Department::calc_research_history() {        // 1217</span>
00677     <span class="comment">/*</span>
00678 <span class="comment">      int       research_m_history[RESEARCH_STATUS_COUNT][HISTORY_MONTH_COUNT];         // ($000)</span>
00679 <span class="comment">      int       research_y_history[RESEARCH_STATUS_COUNT][HISTORY_YEAR_COUNT];                  // ($000)</span>
00680 <span class="comment"></span>
00681 <span class="comment">      int       research_total_history[HISTORY_MONTH_COUNT];                    // ($000)</span>
00682 <span class="comment">      int       research_direct_history[HISTORY_MONTH_COUNT];           // ($000)</span>
00683 <span class="comment"></span>
00684 <span class="comment">      int       regular_faculty_with_research[HISTORY_MONTH_COUNT];             // 99-&gt;99%</span>
00685 <span class="comment">    */</span>
00686     <span class="keywordtype">int</span> i;
00687 
00688     <span class="comment">// research_m_history[j][THIS_MONTH] is updated in faculty_array.next_day();</span>
00689 
00690     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Odept_8h.html#a19a16">RESEARCH_STATUS_COUNT</a>; i++) {
00691         <span class="comment">//research_m_history[i][THIS_MONTH] /= 1000;            //BUGHERE if not "/ 1000"</span>
00692         research_y_history[i][THIS_YEAR] += research_m_history[i][THIS_MONTH];
00693     }
00694 
00695     <span class="comment">//## chea 221199 This is controling the SR report value</span>
00696     <span class="comment">//  research_total_history[THIS_MONTH] = total_research_dollar;</span>
00697     <span class="comment">//  research_direct_history[THIS_MONTH] = total_research_dollar_direct;</span>
00698     research_total_history[THIS_MONTH] = total_research_dollar/1000;
00699     research_direct_history[THIS_MONTH] = total_research_dollar_direct/1000;
00700 
00701     regular_faculty_with_research[THIS_MONTH] = 0;
00702     regular_faculty_count = 0;
00703 
00704     <span class="keywordflow">for</span>( i=faculty_array.size() ; i&gt;0 ; i-- ) {
00705         <span class="keywordflow">if</span>( faculty_array.is_deleted(i) )
00706             <span class="keywordflow">continue</span>;
00707 
00708         <a class="code" href="classFaculty.html">Faculty</a>* facPtr = faculty_array[i];
00709 
00710         <span class="keywordflow">if</span> ( facPtr-&gt;<a class="code" href="classFaculty.html#m21">research_month_expense</a> )
00711             regular_faculty_with_research[THIS_MONTH]++;
00712 
00713         <span class="keywordflow">if</span> ( facPtr-&gt;<a class="code" href="classFaculty.html#a3">is_regular</a>() )
00714             regular_faculty_count++;
00715     }
00716 
00717     <span class="keywordflow">if</span> ( regular_faculty_count )
00718         regular_faculty_with_research[THIS_MONTH] = regular_faculty_with_research[THIS_MONTH] * 100 / regular_faculty_count;
00719 
00720     <span class="comment">//---------//</span>
00721 }
00722 
00723 <span class="comment">//------- End of function Department::calc_research_history -----//</span>
00724 
00725 <span class="comment">// ##### Begin MArco ##### //</span>
00726 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00727 <span class="preprocessor"></span><span class="comment">//------ Begin of function GeneralDepartment::save_initial_data -------//</span>
00729 <span class="comment">void GeneralDepartment::save_initial_data() {</span>
00730     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="Ostudent_8h.html#a34a12">MAX_STUDENT_LEVEL_N_TOTAL</a>; i++)
00731         initial_dept_student_level_no[i] = dept_student_level_no[i];
00732 }
00733 
00734 <span class="comment">//</span>
00735 <span class="comment">// ------- End of function GeneralDepartment::save_initial_data -----//</span>
00736 <span class="preprocessor">#endif</span>
00737 <span class="preprocessor"></span><span class="comment">// ##### End Marco ##### //</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:23 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
