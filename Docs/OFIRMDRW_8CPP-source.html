<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OFIRMDRW.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>OFIRMDRW.CPP</h1><a href="OFIRMDRW_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OFIRMDRW.CPP</span>
00002 <span class="comment">//Description : Firm drawing routines</span>
00003 <span class="comment">//owner         : ho</span>
00004 
00005 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;<a class="code" href="OWORLD_8H.html">OWORLD.H</a>&gt;</span>
00007 <span class="preprocessor">#include &lt;<a class="code" href="OSTR_8H.html">OSTR.H</a>&gt;</span>
00008 <span class="preprocessor">#include &lt;OFONT.H&gt;</span>
00009 <span class="preprocessor">#include &lt;<a class="code" href="OFIRMRES_8H.html">OFIRMRES.H</a>&gt;</span>
00010 <span class="preprocessor">#include &lt;OFIRM.H&gt;</span>
00011 <span class="preprocessor">#include &lt;OIFACE.H&gt;</span>
00012 
00013 <span class="comment">//--------- Begin of function Firm::draw ----------//</span>
<a name="l00017"></a><a class="code" href="classFirm.html#a4">00017</a> <span class="comment">void Firm::draw(Matrix* matrixPtr) {</span>
00018     <a class="code" href="structFirmInfo.html">FirmInfo</a>* firmInfo = firm_res[firm_id];
00019 
00020     <span class="comment">//-------- check if the firm is within the view area --------//</span>
00021 
00022     <span class="keywordtype">int</span> zoomLevel = matrixPtr-&gt;zoom_level;
00023     <span class="keywordtype">int</span> bmpWidth  = firmInfo-&gt;<a class="code" href="structFirmInfo.html#m6">bitmap_width</a>[zoomLevel];
00024     <span class="keywordtype">int</span> bmpHeight = firmInfo-&gt;<a class="code" href="structFirmInfo.html#m7">bitmap_height</a>[zoomLevel];
00025     <span class="keywordtype">char</span>* bmpPtr  = firmInfo-&gt;<a class="code" href="structFirmInfo.html#m5">bitmap_ptr</a>[zoomLevel];
00026 
00027     <span class="keywordtype">int</span> x1 = abs_rect[zoomLevel].x1 - matrixPtr-&gt;abs_top_x;
00028 
00029     <span class="comment">// out of the view area, not even a slight part of it appears in the view area</span>
00030     <span class="keywordflow">if</span>( x1 &lt;= -bmpWidth || x1 &gt;= matrixPtr-&gt;win_width )
00031         <span class="keywordflow">return</span>;
00032 
00033     <span class="keywordtype">int</span> y1 = abs_rect[zoomLevel].y1 - matrixPtr-&gt;abs_top_y;
00034 
00035     <span class="keywordflow">if</span>( y1 &lt;= -bmpHeight || y1 &gt;= matrixPtr-&gt;win_height )
00036         <span class="keywordflow">return</span>;
00037 
00038     <span class="keywordtype">int</span> x2 = abs_rect[zoomLevel].x2 - matrixPtr-&gt;abs_top_x;
00039     <span class="keywordtype">int</span> y2 = abs_rect[zoomLevel].y2 - matrixPtr-&gt;abs_top_y;
00040 
00041     <span class="keywordflow">if</span>( x2 &lt; 0 || y2 &lt; 0 )
00042         <span class="keywordflow">return</span>;
00043 
00044     <span class="comment">//------ get the color remap table -------//</span>
00045 
00046     <span class="comment">// don't highlight building</span>
00047     <span class="keywordtype">short</span>* colorRemapTable = firm_res.get_color_remap_table( is_selected() );
00048 
00049     <span class="comment">//---- only portion of the sprite is inside the view area ------//</span>
00050 
00051     <span class="keywordflow">if</span>( x1 &lt; 0 || x2 &gt;= matrixPtr-&gt;win_width || y1 &lt; 0 || y2 &gt;= matrixPtr-&gt;win_height ) {
00052         vga_back.put_bitmap_area_trans_remap_decompress( x1+matrixPtr-&gt;win_x1, y1+matrixPtr-&gt;win_y1, bmpPtr,
00053                                                          max(0,x1)-x1, max(0,y1)-y1, min(matrixPtr-&gt;win_width-1,x2)-x1, min(matrixPtr-&gt;win_height-1,y2)-y1, colorRemapTable );
00054         <span class="comment">//              if(is_selected())</span>
00055         <span class="comment">//              {</span>
00056         <span class="comment">//                      user_interface.brighten(max(0,x1+matrixPtr-&gt;win_x1), max(0,y1)+matrixPtr-&gt;win_y1,</span>
00057         <span class="comment">//                              min(matrixPtr-&gt;win_width-1,x2)+matrixPtr-&gt;win_x1, min(matrixPtr-&gt;win_height-1,y2)+matrixPtr-&gt;win_y1);</span>
00058         <span class="comment">//              }</span>
00059     }
00060 
00061     <span class="comment">//---- the whole sprite is inside the view area ------//</span>
00062 
00063     <span class="keywordflow">else</span> {
00064         vga_back.put_bitmap_trans_remap_decompress( x1+matrixPtr-&gt;win_x1, y1+matrixPtr-&gt;win_y1, bmpPtr, colorRemapTable );
00065         <span class="comment">//              if(is_selected())</span>
00066         <span class="comment">//              {</span>
00067         <span class="comment">//                      user_interface.brighten(x1+matrixPtr-&gt;win_x1,y1+matrixPtr-&gt;win_y1,x2+matrixPtr-&gt;win_x1,y2+matrixPtr-&gt;win_y1);</span>
00068         <span class="comment">//              }</span>
00069     }
00070 
00071 }
00072 
00073 <span class="comment">//--------- End of function Firm::draw -----------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:40 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
