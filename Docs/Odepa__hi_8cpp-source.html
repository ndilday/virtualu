<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Odepa_hi.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Odepa_hi.cpp</h1><a href="Odepa__hi_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : ODEPA_HI.CPP</span>
00002 <span class="comment">//Description : Department resource object: for faculty hiring and salary setting</span>
00003 <span class="comment">//Owner                 : Fred</span>
00004 
00005 <span class="comment">// To enable DEBUG_LOG,</span>
00006 <span class="comment">// #define DEBUG_LOG_LOCAL 1</span>
00007 
00008 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;OMATH.H&gt;</span>
00010 <span class="preprocessor">#include &lt;<a class="code" href="OLINALG_8H.html">OLINALG.H</a>&gt;</span>
00011 <span class="preprocessor">#include &lt;<a class="code" href="OLOG_8H.html">OLOG.H</a>&gt;</span>
00012 
00013 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00014 
00015 <span class="preprocessor">#include &lt;<a class="code" href="OSCHLRES_8H.html">OSCHLRES.H</a>&gt;</span>
00016 <span class="preprocessor">#include &lt;<a class="code" href="OPEERSCH_8H.html">OPEERSCH.H</a>&gt;</span>
00017 <span class="preprocessor">#include &lt;OFINANCE.H&gt;</span>
00018 <span class="preprocessor">#include &lt;ODEPT.H&gt;</span>
00019 <span class="preprocessor">#include &lt;<a class="code" href="ODEPTRES_8H.html">ODEPTRES.H</a>&gt;</span>
00020 <span class="preprocessor">#include &lt;<a class="code" href="ODATE_8H.html">ODATE.H</a>&gt;</span>
00021 
00022 <span class="comment">// #define DEBUG_MATHCA         // use test data from excel</span>
00023 <span class="comment">// #define DEBUG_VC</span>
00024 
00025 <span class="preprocessor">#ifdef DEBUG_VC</span>
00026 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stdio.h&gt;</span>
00027 <span class="preprocessor">#endif</span>
00028 <span class="preprocessor"></span>
00029 <span class="keyword">static</span> <span class="keywordtype">void</span> print_var_name( <span class="keywordtype">char</span> *varName ) {
00030 <span class="preprocessor">#ifdef DEBUG_VC</span>
00031 <span class="preprocessor"></span>    <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>( varName );
00032 <span class="preprocessor">#endif</span>
00033 <span class="preprocessor"></span>}
00034 
00035 <span class="keyword">static</span> <span class="keywordtype">void</span> print_vector2(<span class="keyword">const</span> ColumnVector &amp;xNames) {
00036 <span class="preprocessor">#ifdef DEBUG_VC</span>
00037 <span class="preprocessor"></span>    <span class="keywordtype">int</span> count = xNames.Storage();
00038     <span class="keywordtype">char</span> t[30];
00039 
00040     <a class="code" href="classString.html">String</a> s = <span class="stringliteral">"-&gt; "</span>;
00041     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1; i&lt;=count; i++ ) {
00042         sprintf(t, <span class="stringliteral">"%.2f, "</span>, xNames(i));
00043         s+= t;
00044         <span class="comment">//s += m.format(xNames(i));</span>
00045         <span class="comment">//s += ", ";</span>
00046     }
00047     <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(s);
00048 <span class="preprocessor">#endif</span>
00049 <span class="preprocessor"></span>}
00050 
00051 <span class="keyword">static</span> <span class="keywordtype">void</span> print_matrix(<span class="keyword">const</span> <a class="code" href="classMatrix.html">Matrix</a> &amp;xNames) {
00052 <span class="preprocessor">#ifdef DEBUG_VC</span>
00053 <span class="preprocessor"></span>    <span class="keywordtype">int</span> row = xNames.Nrows();
00054     <span class="keywordtype">int</span> col = xNames.Ncols();
00055     <span class="keywordtype">char</span> t[30];
00056 
00057     <a class="code" href="classString.html">String</a> s;
00058 
00059     <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(<span class="stringliteral">"["</span>);
00060 
00061     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=1; j&lt;=row; j++ ) {
00062         s = <span class="stringliteral">"  "</span>;
00063         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1; i&lt;=col; i++ ) {
00064             sprintf(t, <span class="stringliteral">"%.2f, "</span>, xNames(j, i));
00065             s+= t;
00066 
00067             <span class="comment">//s += m.format(xNames(j, i));</span>
00068             <span class="comment">//s += ", ";</span>
00069         }
00070         <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(s);
00071     }
00072 
00073     <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(<span class="stringliteral">"]"</span>);
00074 <span class="preprocessor">#endif</span>
00075 <span class="preprocessor"></span>}
00076 
00077 <span class="comment">//--------- Begin of function DepartmentArray::init ----------//</span>
<a name="l00081"></a><a class="code" href="classDepartment.html#a21">00081</a> <span class="comment">void Department::init_hiring() {</span>
00082     <span class="keywordtype">int</span> i,j;
00083 
00084     <span class="comment">//</span>
00085 
00086     <span class="keywordtype">int</span> countArray[<a class="code" href="Ofacures_8h.html#a1">MAX_RANK_AGE_GROUP_N_TOTAL</a>][<a class="code" href="Gamedef_8h.html#a77a33">GENDER_ETHNIC_TYPE_COUNT_N_TOTAL</a>];
00087 
00088     <a class="code" href="classFaculty.html">Faculty</a> * facPtr;
00089 
00090     memset(countArray, 0, <span class="keyword">sizeof</span>(countArray));
00091 
00092     <span class="keywordflow">for</span> (i=faculty_array.size(); i&gt;0; i--) {
00093         <span class="keywordflow">if</span> ( faculty_array.is_deleted(i) )
00094             <span class="keywordflow">continue</span>;
00095 
00096         facPtr = faculty_array[i];
00097 
00098         countArray[facPtr-&gt;<a class="code" href="classFaculty.html#d0">rank_age_group</a>()][facPtr-&gt;<a class="code" href="classFaculty.html#m7">gender_ethnic_group</a>] ++;
00099     }
00100 
00101     <span class="keywordflow">for</span> ( i=0; i&lt;<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>; i++)
00102         <span class="keywordflow">for</span> ( j=0; j&lt;<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>; j++) {
00103             countArray[i][<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>] += countArray[i][j];
00104             countArray[<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>][j] += countArray[i][j];
00105         }
00106 
00107     <span class="comment">//-------- calculate faculty salary --------//</span>
00108 
00109     <a class="code" href="structDepartmentInfo.html">DepartmentInfo</a>* deptInfo = department_res[department_id];
00110     <a class="code" href="structFacultyTemplate.html">FacultyTemplate</a>* facultyTemplate;
00111 
00112     <span class="keywordtype">float</span> salaryArray[<a class="code" href="Ofacures_8h.html#a1">MAX_RANK_AGE_GROUP_N_TOTAL</a>][<a class="code" href="Gamedef_8h.html#a77a33">GENDER_ETHNIC_TYPE_COUNT_N_TOTAL</a>];
00113 
00114     memset(salaryArray, 0, <span class="keyword">sizeof</span>(salaryArray));
00115 
00116     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> rankAgeGroup=0; rankAgeGroup&lt;<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>; rankAgeGroup++ ) {
00117         facultyTemplate = faculty_res.get_faculty_template( deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m19">template_salary</a>, rankAgeGroup );
00118 
00119         <span class="keywordtype">int</span> facultySalary = int( deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m3">salary_multiplier</a> * facultyTemplate-&gt;<a class="code" href="structFacultyTemplate.html#m5">overall_salary_multiplier</a> *
00120                                  <a class="code" href="classPeerSchool.html#p2">PeerSchool::average_faculty_salary</a>[rankAgeGroup] );
00121 
00122         <span class="keywordflow">for</span> ( j=0; j&lt;<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>; j++) {
00123             <span class="keywordtype">int</span> thisFacultySalary = facultySalary;      <span class="comment">// not ($000)</span>
00124 
00125             <span class="keywordflow">if</span>( j==<a class="code" href="Gamedef_8h.html#a75a30">MINORITY_FEMALE</a> || j==<a class="code" href="Gamedef_8h.html#a75a28">NONMINORITY_FEMALE</a> )
00126                 thisFacultySalary = int( (<span class="keywordtype">float</span>)thisFacultySalary * facultyTemplate-&gt;<a class="code" href="structFacultyTemplate.html#m6">female_salary_multiplier</a> );
00127 
00128             <span class="keywordflow">if</span>( j==<a class="code" href="Gamedef_8h.html#a75a29">MINORITY_MALE</a> || j==<a class="code" href="Gamedef_8h.html#a75a30">MINORITY_FEMALE</a> )
00129                 thisFacultySalary = int( (<span class="keywordtype">float</span>)thisFacultySalary * facultyTemplate-&gt;<a class="code" href="structFacultyTemplate.html#m7">minority_salary_multiplier</a> );
00130 
00131             salaryArray[rankAgeGroup][j] = (float) thisFacultySalary;
00132         }
00133     }
00134 
00135     peer_numeraire_salary = salaryArray[<a class="code" href="Ofaculty_8h.html#a27a11">FULL_PROF</a>+1][<a class="code" href="Gamedef_8h.html#a75a27">NONMINORITY_MALE</a>];
00136 
00137     <a class="code" href="ALL_8H.html#a0">err_when</a>(peer_numeraire_salary &lt;= 0);           <span class="comment">// assume at least one white-male FULL_PROF-2</span>
00138 
00139     <span class="comment">//-------------------------------------------//</span>
00140 
00141     memset(peer_salary_multiplier_rank, 0, <span class="keyword">sizeof</span>(peer_salary_multiplier_rank));
00142     memset(peer_salary_multiplier_gender, 0, <span class="keyword">sizeof</span>(peer_salary_multiplier_gender));
00143 
00144     <span class="keywordflow">for</span> ( i=0; i&lt;<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>; i++) {
00145         <span class="keywordflow">for</span> ( j=0; j&lt;<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>; j++) {
00146             peer_salary_multiplier_rank[i] += math.safe_log(math.safe_divide(salaryArray[i][j], salaryArray[<a class="code" href="Ofaculty_8h.html#a27a11">FULL_PROF</a>+1][j])) * countArray[i][j];
00147         }
00148 
00149         peer_salary_multiplier_rank[i] = (float) exp( math.safe_divide(peer_salary_multiplier_rank[i], (<span class="keywordtype">float</span>) countArray[i][<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>]));
00150 
00151         <a class="code" href="ALL_8H.html#a0">err_when</a>(peer_salary_multiplier_rank[i]&gt;25 || peer_salary_multiplier_rank[i]&lt;0 );
00152     }
00153 
00154     <span class="keywordflow">for</span> ( j=0; j&lt;<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>; j++) {
00155 
00156         <span class="keywordflow">for</span> ( i=0; i&lt;<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>; i++) {
00157             peer_salary_multiplier_gender[j] += math.safe_log(math.safe_divide(salaryArray[i][j], salaryArray[i][<a class="code" href="Gamedef_8h.html#a75a27">NONMINORITY_MALE</a>])) * countArray[i][j];
00158         }
00159 
00160         peer_salary_multiplier_gender[j] = (float) exp( math.safe_divide(peer_salary_multiplier_gender[j], (<span class="keywordtype">float</span>) countArray[<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>][j]));
00161 
00162         <a class="code" href="ALL_8H.html#a0">err_when</a>(peer_salary_multiplier_gender[j]&gt;50 || peer_salary_multiplier_gender[j]&lt;0 );
00163     }
00164 
00165     <span class="comment">//-------------------------------------------//</span>
00166     <span class="comment">// init talent</span>
00167     <span class="comment">//-------------------------------------------//</span>
00168 
00169     <span class="comment">//float             peer_talent_rank[MAX_RANK_AGE_GROUP][TALENT_COUNT];</span>
00170     <span class="comment">//float             peer_talent_gender[GENDER_ETHNIC_TYPE_COUNT][TALENT_COUNT];</span>
00171 
00172     memset(peer_talent_rank, 0, <span class="keyword">sizeof</span>(peer_talent_rank));
00173     memset(peer_talent_gender, 0, <span class="keyword">sizeof</span>(peer_talent_gender));
00174 
00175     <span class="comment">// 990407</span>
00176     <span class="keywordtype">float</span> peerConstRankTalent[<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>][<a class="code" href="Odept_8h.html#a18a12">TALENT_COUNT</a>] = {
00177         { 67.9f, 79.4f, 90, },
00178         { 67.9f, 76.4f, 90, },
00179         { 67.9f, 73.1f, 90, },
00180         { 63.3f, 69.5f, 81.8f, },
00181         { 60.5f, 65.7f, 34.4f, },
00182         { 80.0f, 0, 0, },
00183         { 80.0f, 0, 0, },
00184     };
00185 
00186     <span class="keywordtype">float</span> peerConstGenderTalent[<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>][<a class="code" href="Odept_8h.html#a18a12">TALENT_COUNT</a>] = {
00187         { 67.9f, 79.4f, 90, },
00188         { 67.9f, 76.4f, 87, },
00189         { 67.9f, 73.1f, 50, },
00190         { 70.0f, 75.0f, 60, },
00191     };
00192 
00193     memcpy(peer_talent_rank, peerConstRankTalent, <span class="keyword">sizeof</span>(peer_talent_rank));
00194     memcpy(peer_talent_gender, peerConstGenderTalent, <span class="keyword">sizeof</span>(peer_talent_gender));
00195 
00196     <span class="comment">/* 990407</span>
00197 <span class="comment">       for ( rankAgeGroup=0; rankAgeGroup&lt;MAX_RANK_AGE_GROUP; rankAgeGroup++ )</span>
00198 <span class="comment">       {</span>
00199 <span class="comment"></span>
00200 <span class="comment">       facultyTemplate = faculty_res.get_faculty_template( deptInfo-&gt;template_talent, rankAgeGroup );</span>
00201 <span class="comment"></span>
00202 <span class="comment">       peer_talent_rank[rankAgeGroup][TALENT_TEACH] = deptInfo-&gt;talent_teaching * facultyTemplate-&gt;talent_teaching_multiplier;</span>
00203 <span class="comment">       peer_talent_rank[rankAgeGroup][TALENT_SCHOLARSHIP] = deptInfo-&gt;talent_scholarship * facultyTemplate-&gt;talent_scholarship_multiplier;</span>
00204 <span class="comment">       peer_talent_rank[rankAgeGroup][TALENT_RESEARCH] = deptInfo-&gt;talent_research * facultyTemplate-&gt;talent_research_multiplier;</span>
00205 <span class="comment"></span>
00206 <span class="comment">       int rank = Faculty::rank_age_group_2_rank(rankAgeGroup);</span>
00207 <span class="comment"></span>
00208 <span class="comment">       if ( rank == LONG_TERM_ADJUNCT || rank == SHORT_TERM_ADJUNCT )</span>
00209 <span class="comment">       {</span>
00210 <span class="comment">       peer_talent_rank[rankAgeGroup][TALENT_SCHOLARSHIP]</span>
00211 <span class="comment">       = peer_talent_rank[rankAgeGroup][TALENT_RESEARCH] = 0;</span>
00212 <span class="comment">       }</span>
00213 <span class="comment">       }</span>
00214 <span class="comment"></span>
00215 <span class="comment">       // ask bill how to do this initialization?</span>
00216 <span class="comment"></span>
00217 <span class="comment">       for ( j=0; j&lt;GENDER_ETHNIC_TYPE_COUNT; j++)</span>
00218 <span class="comment">       {</span>
00219 <span class="comment">       rankAgeGroup = FULL_PROF+1;                                      // full_prof-2</span>
00220 <span class="comment"></span>
00221 <span class="comment">       peer_talent_gender[j][TALENT_TEACH] = peer_talent_rank[rankAgeGroup][TALENT_TEACH];</span>
00222 <span class="comment">       peer_talent_gender[j][TALENT_SCHOLARSHIP] = peer_talent_rank[rankAgeGroup][TALENT_SCHOLARSHIP];</span>
00223 <span class="comment">       peer_talent_gender[j][TALENT_RESEARCH] = peer_talent_rank[rankAgeGroup][TALENT_RESEARCH];</span>
00224 <span class="comment">       }</span>
00225 <span class="comment">    */</span>
00226 }
00227 
00228 <span class="comment">//--------- Begin of function DepartmentArray::salary_setting ----------//</span>
<a name="l00232"></a><a class="code" href="classDepartmentArray.html#a14">00232</a> <span class="comment">void DepartmentArray::salary_setting() {</span>
00233     <span class="keywordtype">int</span> d, i, deptCount=0;
00234     <a class="code" href="classDepartment.html">Department</a> *deptPtr;
00235 
00236     <span class="comment">//------------- section 3.2 -----------------//</span>
00237 
00238     <span class="comment">// Overall salary increase budget (from RA model)</span>
00239 <span class="preprocessor">#if(GAME_VERSION&gt;=200)                          // remove stage1_revenue, stage1_expense, stage2_expense</span>
00240 <span class="preprocessor"></span>    <span class="keywordtype">float</span> overalSalaryGrowth = float(finance.expense_policy_array[<a class="code" href="Ofinance_8h.html#a110a70">PL_FACULTY_SALARY_INCREASES</a>].result_value + finance.inflation_rate) / 100.0f;
00241 <span class="preprocessor">#else</span>
00242 <span class="preprocessor"></span>    <span class="comment">//note: stage1_expense[S1_FACULTY_SALARY_INCREASES].computed_growthrate = expense_policy_array[PL_FACULTY_SALARY_INCREASES].result_value + inflation_rate;</span>
00243     <span class="keywordtype">float</span> overalSalaryGrowth = float(finance.stage1_expense[<a class="code" href="Ofinanc2_8h.html#a42a21">S1_FACULTY_SALARY_INCREASES</a>].computed_growthrate) / 100.0f;
00244 <span class="preprocessor">#endif</span>
00245 <span class="preprocessor"></span>
00246     <span class="comment">// Overall average multiplier</span>
00247 
00248     <span class="keywordtype">float</span> avgGenderMultiplier[<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>];
00249     <span class="keywordtype">int</span> count[<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>];
00250 
00251     memset(avgGenderMultiplier, 0, <span class="keyword">sizeof</span>(avgGenderMultiplier));
00252     memset(count, 0, <span class="keyword">sizeof</span>(count));
00253 
00254     <span class="keywordflow">for</span> (d = size(); d&gt;0; d--) {
00255         <span class="keywordflow">if</span> ( is_deleted(d) )
00256             <span class="keywordflow">continue</span>;
00257 
00258         deptPtr = department_array[d];
00259 
00260         <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>; i++) {
00261             avgGenderMultiplier[i] += math.safe_log(deptPtr-&gt;<a class="code" href="classDepartment.html#m27">salary_multiplier</a>[i]) * deptPtr-&gt;<a class="code" href="classDepartment.html#m65">faculty_gender_history</a>[i][THIS_YEAR];
00262             count[i] = department_array.faculty_gender_history[i][THIS_YEAR];
00263         }
00264 
00265         deptCount++;
00266     }
00267 
00268     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>; i++) {
00269         avgGenderMultiplier[i] = (count[i])?(float) exp( avgGenderMultiplier[i] / count[i]) : 1.0f;
00270 
00271         <a class="code" href="ALL_8H.html#a0">err_when</a>(avgGenderMultiplier[i] &lt; -15.0f || avgGenderMultiplier[i] &gt; 90.0f);
00272     }
00273 
00274     <span class="comment">//------------- section 3.3 -----------------//</span>
00275     <span class="comment">// STEP 1 ignored; implement outstanding promises, if any, for individual adjustment</span>
00276 
00277     <span class="comment">// STEP 2</span>
00278 
00279     <span class="comment">// Calculate the salary program multipler for gender-ethnic groups</span>
00280     <span class="keywordtype">float</span> factor = salary_weight_input_2_multiplier((<span class="keywordtype">int</span>)gender_ethnic_equity_weight_input) / 6.0f;
00281 
00282     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>; i++)
00283         avgGenderMultiplier[i] = 1 + factor * ( 1.0f / avgGenderMultiplier[i] - 1);
00284 
00285     <span class="comment">// STEP 3 for each fac sim</span>
00286     <span class="comment">// Base     Dept    Rank-exp        Gender-ethnic   Merit adjustments</span>
00287     <a class="code" href="classFaculty.html">Faculty</a> *facPtr;
00288     <span class="keywordtype">float</span> base, dept, rankExp, genderEthnic, meritOverall;
00289     <span class="keywordtype">int</span> facCount = 0, overallIncrease=0, totalSalary=0;
00290     <span class="keywordtype">int</span> sumPriority = salary_weight_input_2_multiplier((<span class="keywordtype">int</span>)teaching_weight_input)
00291         + salary_weight_input_2_multiplier((<span class="keywordtype">int</span>)scholarship_weight_input)
00292         + salary_weight_input_2_multiplier((<span class="keywordtype">int</span>)research_weight_input);
00293 
00294     <span class="keywordtype">float</span> weight[3];
00295     weight[0] = math.safe_pow((<span class="keywordtype">float</span>)salary_weight_input_2_multiplier((<span class="keywordtype">int</span>)teaching_weight_input), 2) / sumPriority;
00296     weight[1] = math.safe_pow((<span class="keywordtype">float</span>)salary_weight_input_2_multiplier((<span class="keywordtype">int</span>)scholarship_weight_input), 2) / sumPriority;
00297     weight[2] = math.safe_pow((<span class="keywordtype">float</span>)salary_weight_input_2_multiplier((<span class="keywordtype">int</span>)research_weight_input), 2) / sumPriority;
00298 
00299     <span class="keywordflow">for</span> ( d=size(); d&gt;0; d-- ) {
00300         <span class="keywordflow">if</span> ( is_deleted(d) )
00301             <span class="keywordflow">continue</span>;
00302 
00303         deptPtr = department_array[d];
00304 
00305         <span class="keywordflow">for</span> ( i=deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#m1">faculty_count</a>; i&gt;0; i-- ) {
00306             <span class="keywordflow">if</span> ( deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#a10">is_deleted</a>(i) )
00307                 <span class="keywordflow">continue</span>;
00308 
00309             facPtr = deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>[i];
00310 
00311             facCount++;
00312 
00313             <span class="comment">//----------------//</span>
00314             <span class="comment">// update int       base, dept, rankExp, genderEthnic, meritOverall;</span>
00315             <span class="keywordtype">int</span> sal = facPtr-&gt;<a class="code" href="classFaculty.html#m11">salary</a>;
00316 
00317             base = sal * overalSalaryGrowth;
00318             dept = sal * (deptPtr-&gt;<a class="code" href="classDepartment.html#m16">dept_salary_multiplier</a> - 1);
00319             rankExp = sal * ( rank_age_group_salary_increase_multiplier[facPtr-&gt;<a class="code" href="classFaculty.html#d0">rank_age_group</a>(facPtr-&gt;<a class="code" href="classFaculty.html#m6">rank_level</a>, facPtr-&gt;<a class="code" href="classFaculty.html#a1">age</a>())] - 1);
00320             <span class="comment">//## chea 201099</span>
00321             <span class="comment">//                  genderEthnic = sal * ( avgGenderMultiplier[facPtr-&gt;gender_ethnic_group] - 1 );</span>
00322             genderEthnic = 3 * sal * ( avgGenderMultiplier[facPtr-&gt;<a class="code" href="classFaculty.html#m7">gender_ethnic_group</a>] - 1 );
00323 
00324             meritOverall = 0;
00325 
00326             <a class="code" href="ALL_8H.html#a0">err_when</a>(sal&gt;0 &amp;&amp; rankExp&lt;=-sal);
00327 
00328             <span class="keywordflow">if</span> ( ! facPtr-&gt;<a class="code" href="classFaculty.html#d2">is_adjunct_faculty</a>(facPtr-&gt;<a class="code" href="classFaculty.html#m6">rank_level</a>) ) {
00329                 meritOverall += (facPtr-&gt; performance_teaching / 100.0f) * base * weight[0];
00330                 meritOverall += (facPtr-&gt; performance_scholarship / 100.0f) * base * weight[1];
00331                 meritOverall += (facPtr-&gt; performance_research / 100.0f) * base * weight[2];
00332             }
00333             <span class="keywordflow">else</span> {
00334                 meritOverall += (facPtr-&gt; performance_teaching / 100.0f) * base * salary_weight_input_2_multiplier((<span class="keywordtype">int</span>)teaching_weight_input);
00335             }
00336 
00337             <span class="comment">//----------------//</span>
00338             <span class="comment">//min &amp; max bug chea</span>
00339             facPtr-&gt;<a class="code" href="classFaculty.html#m12">last_salary_increase</a> = (int) max(0, (<span class="keywordtype">int</span>)(base+dept+rankExp+genderEthnic+meritOverall));
00340             overallIncrease += facPtr-&gt;<a class="code" href="classFaculty.html#m12">last_salary_increase</a>;
00341 
00342             totalSalary += facPtr-&gt;<a class="code" href="classFaculty.html#m11">salary</a>;
00343         }
00344     }
00345 
00346     <span class="keywordflow">if</span> ( facCount == 0 )                            <span class="comment">// when initialization</span>
00347         <span class="keywordflow">return</span>;
00348 
00349     <span class="comment">//----------------------//</span>
00350     <a class="code" href="ALL_8H.html#a0">err_when</a>(totalSalary&lt;=0);
00351     <span class="keywordflow">if</span>(totalSalary&lt;=overallIncrease)
00352         d=0;                                          <span class="comment">// setting breakpoint here to trace why (totalSalary&lt;=overallIncrease)</span>
00353     <span class="comment">// req28_hiring: don't need to check: err_when( overallIncrease&lt;0 || overalSalaryGrowth&lt;0 );</span>
00354     <span class="keywordtype">float</span> rate = float(overallIncrease) / totalSalary;
00355 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00356 <span class="preprocessor"></span>    <span class="comment">// overallIncrease may be zero</span>
00357     <span class="keywordtype">float</span> adjustRate = (overallIncrease != 0) ? (overalSalaryGrowth / rate) : 1.0f;
00358 <span class="preprocessor">#else</span>
00359 <span class="preprocessor"></span>    <span class="keywordtype">float</span> adjustRate = overalSalaryGrowth / rate;
00360 <span class="preprocessor">#endif</span>
00361 <span class="preprocessor"></span>
00362     <span class="keywordflow">for</span> ( d=size(); d&gt;0; d-- ) {
00363         <span class="keywordflow">if</span> ( is_deleted(d) )
00364             <span class="keywordflow">continue</span>;
00365 
00366         deptPtr = department_array[d];
00367 
00368         <span class="keywordflow">for</span> ( i=deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#m1">faculty_count</a>; i&gt;0; i-- ) {
00369             <span class="keywordflow">if</span> ( deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#a10">is_deleted</a>(i) )
00370                 <span class="keywordflow">continue</span>;
00371 
00372             facPtr = deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>[i];
00373 
00374             facPtr-&gt;<a class="code" href="classFaculty.html#m12">last_salary_increase</a> = int(facPtr-&gt;<a class="code" href="classFaculty.html#m12">last_salary_increase</a> * adjustRate);
00375             facPtr-&gt;<a class="code" href="classFaculty.html#m11">salary</a> += facPtr-&gt;<a class="code" href="classFaculty.html#m12">last_salary_increase</a>;
00376 
00377             <span class="comment">//## chea 201099</span>
00378             <span class="comment">//                  facPtr-&gt;salary = int(facPtr-&gt;salary * math.get_random_snd(1, 0.0015f));         // 0118</span>
00379         }
00380     }
00381 
00382     <span class="comment">//</span>
00383     <span class="keywordflow">return</span>;
00384 }
00385 
00386 <span class="comment">//---------- End of function DepartmentArray::salary_setting ----------//</span>
00387 
00388 <span class="comment">//--------- Begin of function DepartmentArray::faculty_hiring ----------//</span>
<a name="l00390"></a><a class="code" href="classDepartmentArray.html#a15">00390</a> <span class="comment">void DepartmentArray::faculty_hiring() {</span>
00391     <span class="comment">// return;          //BUG</span>
00392 
00393     <span class="comment">//--------------------------------------------------//</span>
00394 
00395     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="Ofaculty_8h.html#a26a8">FACULTY_RANK_LEVEL_COUNT</a>; i++ )
00396         school_res.player_peer_school-&gt;school_faculty_array_ex[i].salary = int(school_res.player_peer_school-&gt;school_faculty_array_ex[i].salary * 1.05f);
00397 
00398     <span class="comment">//--------------------------------------------------//</span>
00399 
00400     <span class="comment">//finance.hiring_policy_array[size()-1].result_value = 20;          // 12 BUG</span>
00401 
00402     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> d=size(); d&gt;0; d-- ) {
00403         <span class="keywordflow">if</span> ( is_deleted(d) )
00404             <span class="keywordflow">continue</span>;
00405 
00406         sys.yield();
00407 
00408         department_array[d]-&gt;faculty_hiring();
00409     }
00410 }
00411 
00412 <span class="comment">//---------- End of function DepartmentArray::faculty_hiring ----------//</span>
00413 
00414 <span class="comment">//--------- Begin of function Department::faculty_hiring ----------//</span>
<a name="l00418"></a><a class="code" href="classDepartment.html#a22">00418</a> <span class="comment">void Department::faculty_hiring(bool hireNow) {</span>
00419     <span class="keywordtype">int</span> i, j, t;
00420 
00421     <span class="comment">//------- update peer info -------//</span>
00422 
00423     <span class="comment">// assume faculty_hiring() called at the begining of the 2nd year.</span>
00424     <span class="comment">// then update peer_salary_multipliers</span>
00425 
00426     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>; i++)
00427         peer_salary_multiplier_rank[i] *= (1+math.get_random_snd(0, 0.01f));
00428 
00429     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>; i++)
00430         peer_salary_multiplier_gender[i] *= (1+math.get_random_snd(0, 0.01f));
00431 
00432     <span class="keywordtype">float</span> inflationRate = (float) finance.inflation_rate / 100.0f;
00433 
00434     peer_numeraire_salary *= (1 + inflationRate + math.get_random_snd(0.015f, 0.01f));
00435 
00436     <span class="comment">//-------//</span>
00437 
00438     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>; i++)
00439         <span class="keywordflow">for</span> ( t=0; t&lt;<a class="code" href="Odept_8h.html#a18a12">TALENT_COUNT</a>; t++ )
00440             ;                                           <span class="comment">//0407 peer_talent_rank[i][t] *= (1+math.get_random_snd(0, 0.025f));</span>
00441 
00442     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>; i++)
00443         <span class="keywordflow">for</span> ( t=0; t&lt;<a class="code" href="Odept_8h.html#a18a12">TALENT_COUNT</a>; t++ )
00444             ;                                           <span class="comment">//0407 peer_talent_gender[i][t] *= (1+math.get_random_snd(0, 0.025f));</span>
00445 
00446     <span class="comment">//--------------//</span>
00447 
00448     <span class="keywordtype">int</span> totalHires = (int) finance.hiring_policy_array[department_recno-1].result_value;
00449 
00450     <span class="keywordflow">if</span> ( hireNow )
00451         totalHires = 1;
00452 
00453     <span class="keywordflow">if</span> ( totalHires &lt;= 0 )
00454         <span class="keywordflow">return</span>;
00455 
00456     <span class="comment">//------- 1. Player input -------//</span>
00457 
00458     <span class="comment">// see dept.h</span>
00459 
00460     <span class="comment">//------- 2. Data from Elsewhere in the Game -------//</span>
00461 
00462     <span class="keywordtype">int</span> countArray[<a class="code" href="Ofacures_8h.html#a1">MAX_RANK_AGE_GROUP_N_TOTAL</a>][<a class="code" href="Gamedef_8h.html#a77a33">GENDER_ETHNIC_TYPE_COUNT_N_TOTAL</a>];
00463     <span class="keywordtype">float</span> salaryArray[<a class="code" href="Ofacures_8h.html#a1">MAX_RANK_AGE_GROUP_N_TOTAL</a>][<a class="code" href="Gamedef_8h.html#a77a33">GENDER_ETHNIC_TYPE_COUNT_N_TOTAL</a>];
00464     <span class="keywordtype">float</span> salaryMultiplierRank[<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>];
00465     <span class="keywordtype">float</span> salaryMultiplierGender[<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>];
00466 
00467     <a class="code" href="classFaculty.html">Faculty</a> * facPtr;
00468 
00469     memset(countArray, 0, <span class="keyword">sizeof</span>(countArray));
00470     memset(salaryArray, 0, <span class="keyword">sizeof</span>(salaryArray));
00471     memset(salaryMultiplierRank, 0, <span class="keyword">sizeof</span>(salaryMultiplierRank));
00472     memset(salaryMultiplierGender, 0, <span class="keyword">sizeof</span>(salaryMultiplierGender));
00473 
00474     <span class="keywordflow">for</span> (i=faculty_array.size(); i&gt;0; i--) {
00475         <span class="keywordflow">if</span> ( faculty_array.is_deleted(i) )
00476             <span class="keywordflow">continue</span>;
00477 
00478         facPtr = faculty_array[i];
00479 
00480         countArray[facPtr-&gt;<a class="code" href="classFaculty.html#d0">rank_age_group</a>()][facPtr-&gt;<a class="code" href="classFaculty.html#m7">gender_ethnic_group</a>] ++;
00481 
00482         salaryArray[facPtr-&gt;<a class="code" href="classFaculty.html#d0">rank_age_group</a>()][facPtr-&gt;<a class="code" href="classFaculty.html#m7">gender_ethnic_group</a>] += facPtr-&gt;<a class="code" href="classFaculty.html#m11">salary</a>;
00483     }
00484 
00485     <span class="keywordflow">for</span> ( i=0; i&lt;<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>; i++)
00486         <span class="keywordflow">for</span> ( j=0; j&lt;<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>; j++) {
00487             countArray[i][<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>] += countArray[i][j];
00488             countArray[<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>][j] += countArray[i][j];
00489         }
00490 
00491     <span class="comment">//-----//</span>
00492 
00493     <span class="keywordflow">for</span> ( i=0; i&lt;<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>; i++)
00494         <span class="keywordflow">for</span> ( j=0; j&lt;<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>; j++) {
00495             <span class="keywordtype">int</span> count = countArray[i][j];
00496 
00497             <span class="keywordflow">if</span> ( count &gt; 0 )
00498                 salaryArray[i][j] /= count;
00499             <span class="keywordflow">else</span> {
00500                 salaryArray[i][j] = (float) school_res.player_peer_school-&gt;school_faculty_array_ex[<a class="code" href="classFaculty.html#d1">Faculty::rank_age_group_2_rank</a>(i)].salary;
00501                 countArray[i][j] = 1;
00502             }
00503         }
00504 
00505     <span class="keywordtype">float</span> numeraireSalary = salaryArray[<a class="code" href="Ofaculty_8h.html#a27a11">FULL_PROF</a>+1][<a class="code" href="Gamedef_8h.html#a75a27">NONMINORITY_MALE</a>];
00506 
00507     <a class="code" href="ALL_8H.html#a0">err_when</a>(numeraireSalary &lt;= 0);                 <span class="comment">// assume at least one white-male FULL_PROF-2</span>
00508 
00509     <span class="comment">//if ( numeraireSalary &lt;= 0 )</span>
00510     <span class="comment">//  salaryArray[FULL_PROF+1][NONMINORITY_MALE] = 15000;     //0301 fix bug on fly</span>
00511 
00512     <span class="comment">//-----//</span>
00513 
00514     <span class="keywordflow">for</span> ( i=0; i&lt;<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>; i++) {
00515         <span class="keywordflow">for</span> ( j=0; j&lt;<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>; j++) {
00516             salaryMultiplierRank[i] += math.safe_log(math.safe_divide(salaryArray[i][j], salaryArray[<a class="code" href="Ofaculty_8h.html#a27a11">FULL_PROF</a>+1][j])) * countArray[i][j];
00517         }
00518 
00519         salaryMultiplierRank[i] = (float) exp( math.safe_divide(salaryMultiplierRank[i], (<span class="keywordtype">float</span>) countArray[i][<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>]));
00520 
00521         <a class="code" href="ALL_8H.html#a0">err_when</a>(salaryMultiplierRank[i]&gt;1000 || salaryMultiplierRank[i]&lt;0 );
00522     }
00523 
00524     <span class="keywordflow">for</span> ( j=0; j&lt;<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>; j++) {
00525 
00526         <span class="keywordflow">for</span> ( i=0; i&lt;<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>; i++) {
00527             salaryMultiplierGender[j] += math.safe_log(math.safe_divide(salaryArray[i][j], salaryArray[i][<a class="code" href="Gamedef_8h.html#a75a27">NONMINORITY_MALE</a>])) * countArray[i][j];
00528         }
00529 
00530         salaryMultiplierGender[j] = (float) exp( math.safe_divide(salaryMultiplierGender[j], (<span class="keywordtype">float</span>) countArray[<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>][j]));
00531 
00532         <a class="code" href="ALL_8H.html#a0">err_when</a>(salaryMultiplierGender[j]&gt;1000 || salaryMultiplierGender[j]&lt;0 );
00533 
00534         <span class="comment">// data for next year's salary setting</span>
00535         this-&gt;salary_multiplier[j] = salaryMultiplierGender[j];
00536     }
00537 
00538     buget_average_salary = int(numeraireSalary * salaryMultiplierRank[<a class="code" href="Ofaculty_8h.html#a27a9">ASST_PROF</a>]);
00539 
00540     <span class="comment">//-----//</span>
00541 
00542     <span class="comment">//990518 int salaryPerNewHire = int(math.safe_divide(finance.cost_limit * 1000, (float) finance.total_hires));              // not ($000)</span>
00543     <span class="comment">// not ($000)</span>
00544     <span class="keywordtype">int</span> salaryPerNewHire = int(math.safe_divide(max(0.0f, finance.cost_limit) * 1000, (<span class="keywordtype">float</span>) finance.total_hires));
00545 
00546 <span class="preprocessor">#ifdef DEBUG_MATHCA</span>
00547 <span class="preprocessor"></span>    salaryPerNewHire = 100000;
00548 <span class="preprocessor">#endif</span>
00549 <span class="preprocessor"></span>
00550     <span class="keywordflow">if</span> (!salaryPerNewHire)
00551         salaryPerNewHire = 100000;
00552 
00553     <span class="comment">//------- 3. Parameters -------//</span>
00554 
00555     <span class="keyword">const</span> <span class="keywordtype">float</span> salary_talent_elasticities[<a class="code" href="Odept_8h.html#a18a12">TALENT_COUNT</a>] = {0.7f, 1.0f, 1.2f};
00556 
00557     <span class="comment">//------- 4. Calculations -------//</span>
00558 
00559     <span class="comment">// calc "Available talent by rank-experience group and gender"</span>
00560 
00561     <span class="keywordtype">float</span>   talentRank[<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>][<a class="code" href="Odept_8h.html#a18a12">TALENT_COUNT</a>];
00562     <span class="keywordtype">float</span>   talentGender[<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>][<a class="code" href="Odept_8h.html#a18a12">TALENT_COUNT</a>];
00563 
00564     <span class="keywordflow">for</span> ( i=0; i&lt;<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>; i++) {
00565         <span class="keywordflow">for</span> (t=0; t&lt;<a class="code" href="Odept_8h.html#a18a12">TALENT_COUNT</a>; t++)
00566             <span class="comment">//min &amp; max bug chea</span>
00567             talentRank[i][t] = max(1.0f,min(100.0f, peer_talent_rank[i][t]*math.safe_pow(math.safe_divide(numeraireSalary * salaryMultiplierRank[i], peer_numeraire_salary*peer_salary_multiplier_rank[i]), salary_talent_elasticities[t] )));
00568 
00569         <span class="keywordtype">int</span> rank = <a class="code" href="classFaculty.html#d1">Faculty::rank_age_group_2_rank</a>(i);
00570 
00571         <span class="keywordflow">if</span> ( rank == <a class="code" href="Ofaculty_8h.html#a27a12">LONG_TERM_ADJUNCT</a> || rank == <a class="code" href="Ofaculty_8h.html#a27a13">SHORT_TERM_ADJUNCT</a> ) {
00572             talentRank[i][<a class="code" href="Odept_8h.html#a18a10">TALENT_SCHOLARSHIP</a>]=0;
00573             talentRank[i][<a class="code" href="Odept_8h.html#a18a11">TALENT_RESEARCH</a>]=0;
00574         }
00575     }
00576 
00577     <span class="keywordflow">for</span> ( j=0; j&lt;<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>; j++) {
00578         <span class="keywordflow">for</span> (t=0; t&lt;<a class="code" href="Odept_8h.html#a18a12">TALENT_COUNT</a>; t++)
00579             <span class="comment">//min &amp; max bug chea</span>
00580             talentGender[j][t] = max(1.0f,min(100.0f, peer_talent_gender[j][t]*math.safe_pow(math.safe_divide(numeraireSalary * salaryMultiplierGender[j], peer_numeraire_salary*peer_salary_multiplier_gender[j]), salary_talent_elasticities[t] )));
00581     }
00582 
00583     <span class="comment">//-----//</span>
00584 
00585     <span class="keyword">const</span> <span class="keywordtype">char</span> varLength = 13;
00586 
00587     ColumnVector c(varLength);    c=0;
00588 
00589     <span class="keywordtype">int</span> tester =hiring_priority_input_2_multiplier(research_talent_priority);
00590 
00591     <span class="keywordtype">int</span> talentPrior[<a class="code" href="Odept_8h.html#a18a12">TALENT_COUNT</a>] = {
00592         hiring_priority_input_2_multiplier(teaching_talent_priority),
00593         hiring_priority_input_2_multiplier(scholarship_talent_priority),
00594         hiring_priority_input_2_multiplier(research_talent_priority)
00595     };
00596 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00597 <span class="preprocessor"></span>    <span class="comment">// modify talentPrior if sum are zero</span>
00598     <a class="code" href="ALL_8H.html#a0">err_when</a>( <a class="code" href="Odept_8h.html#a18a12">TALENT_COUNT</a> != 3 );
00599     <span class="keywordflow">if</span>( talentPrior[0] + talentPrior[1] + talentPrior[2] &lt;= 0 ) {
00600         talentPrior[0] = talentPrior[1] = talentPrior[2] = 1;
00601     }
00602 <span class="preprocessor">#endif</span>
00603 <span class="preprocessor"></span>
00604     <span class="comment">// C85:95</span>
00605 
00606     <span class="keyword">enum</span> {ASST=1,ASSOC,FULL1,FULL2,FULL3,LTADJ,STADJ,WHMA,WHFE,MINAM,MINFE,BSAVE,BOVER};
00607 
00608     ColumnVector weightedTalent(<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>+<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>);
00609 
00610 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00611 <span class="preprocessor"></span>    <span class="keywordflow">for</span> ( i=0; i&lt;<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>; i++)
00612         weightedTalent(i+1) = talentPrior[<a class="code" href="Odept_8h.html#a18a9">TALENT_TEACH</a>]*talentRank[i][<a class="code" href="Odept_8h.html#a18a9">TALENT_TEACH</a>]+(2*talentPrior[<a class="code" href="Odept_8h.html#a18a10">TALENT_SCHOLARSHIP</a>]*talentRank[i][<a class="code" href="Odept_8h.html#a18a10">TALENT_SCHOLARSHIP</a>]+4*talentPrior[<a class="code" href="Odept_8h.html#a18a11">TALENT_RESEARCH</a>]*talentRank[i][<a class="code" href="Odept_8h.html#a18a11">TALENT_RESEARCH</a>])/7.0f;
00613 
00614     <span class="keywordflow">for</span> ( j=0; j&lt;<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>; j++)
00615         weightedTalent(<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>+j+1) = talentPrior[<a class="code" href="Odept_8h.html#a18a9">TALENT_TEACH</a>]*talentGender[j][<a class="code" href="Odept_8h.html#a18a9">TALENT_TEACH</a>]+(2*talentPrior[<a class="code" href="Odept_8h.html#a18a10">TALENT_SCHOLARSHIP</a>]*talentGender[j][<a class="code" href="Odept_8h.html#a18a10">TALENT_SCHOLARSHIP</a>]+4*talentPrior[<a class="code" href="Odept_8h.html#a18a11">TALENT_RESEARCH</a>]*talentGender[j][<a class="code" href="Odept_8h.html#a18a11">TALENT_RESEARCH</a>])/7.0f;
00616 <span class="preprocessor">#else</span>
00617 <span class="preprocessor"></span>    <span class="keywordflow">for</span> ( i=0; i&lt;<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>; i++)
00618         weightedTalent(i+1) = talentPrior[<a class="code" href="Odept_8h.html#a18a9">TALENT_TEACH</a>]*talentRank[i][<a class="code" href="Odept_8h.html#a18a9">TALENT_TEACH</a>]+(2*talentPrior[<a class="code" href="Odept_8h.html#a18a10">TALENT_SCHOLARSHIP</a>]*talentRank[i][<a class="code" href="Odept_8h.html#a18a10">TALENT_SCHOLARSHIP</a>]+4*talentPrior[<a class="code" href="Odept_8h.html#a18a11">TALENT_RESEARCH</a>]*talentRank[i][<a class="code" href="Odept_8h.html#a18a11">TALENT_RESEARCH</a>])/6.0f;
00619 
00620     <span class="keywordflow">for</span> ( j=0; j&lt;<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>; j++)
00621         weightedTalent(<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>+j+1) = talentPrior[<a class="code" href="Odept_8h.html#a18a9">TALENT_TEACH</a>]*talentGender[j][<a class="code" href="Odept_8h.html#a18a9">TALENT_TEACH</a>]+(2*talentPrior[<a class="code" href="Odept_8h.html#a18a10">TALENT_SCHOLARSHIP</a>]*talentGender[j][<a class="code" href="Odept_8h.html#a18a10">TALENT_SCHOLARSHIP</a>]+4*talentPrior[<a class="code" href="Odept_8h.html#a18a11">TALENT_RESEARCH</a>]*talentGender[j][<a class="code" href="Odept_8h.html#a18a11">TALENT_RESEARCH</a>])/6.0f;
00622 <span class="preprocessor">#endif</span>
00623 <span class="preprocessor"></span>
00624     <span class="comment">// D85:95</span>
00625 
00626     <span class="keywordtype">float</span> F7 = ( talentPrior[0] + talentPrior[1] + talentPrior[2] ) / 3.0f;
00627 
00628     <span class="keywordtype">float</span> playerPrior[<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>+<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>] = {
00629         1.0f * hiring_priority_level_input_2_multiplier(assistant_professor_priority),
00630 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00631 <span class="preprocessor"></span>        0.5f * hiring_priority_level_input_2_multiplier(tenured_faculty_priority)/4,
00632         1.0f * hiring_priority_level_input_2_multiplier(tenured_faculty_priority)/4,
00633         0.75f * hiring_priority_level_input_2_multiplier(tenured_faculty_priority)/4,
00634         0.4f * hiring_priority_level_input_2_multiplier(tenured_faculty_priority)/4,
00635 <span class="preprocessor">#else</span>
00636 <span class="preprocessor"></span>        0.5f * hiring_priority_level_input_2_multiplier(tenured_faculty_priority),
00637         1.0f * hiring_priority_level_input_2_multiplier(tenured_faculty_priority),
00638         0.75f * hiring_priority_level_input_2_multiplier(tenured_faculty_priority),
00639         0.4f * hiring_priority_level_input_2_multiplier(tenured_faculty_priority),
00640 <span class="preprocessor">#endif</span>
00641 <span class="preprocessor"></span>        1.0f * hiring_priority_level_input_2_multiplier(longterm_adjunct_faculty_priority),
00642         1.0f * hiring_priority_level_input_2_multiplier(shortterm_adjunct_faculty_priority),
00643 
00644         0,
00645         1.0f * hiring_priority_level_input_2_multiplier(female_faculty_priority),
00646         1.0f * hiring_priority_level_input_2_multiplier(minority_faculty_priority),
00647         0.5f * (hiring_priority_level_input_2_multiplier(female_faculty_priority) + hiring_priority_level_input_2_multiplier(minority_faculty_priority))
00648     };
00649 
00650     <span class="keywordtype">float</span> C99 = 0;
00651 
00652     <span class="keywordflow">for</span> ( i=1; i&lt;=<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>+<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>; i++) {
00653         c(i) = weightedTalent(i) *  playerPrior[i-1] / F7;
00654         C99 += (float) weightedTalent(i);
00655     }
00656 
00657     C99 /= <a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>+<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>;
00658 
00659     <span class="comment">// E85:95   //------//</span>
00660 
00661     ColumnVector salaryIncr(<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>+<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>);
00662     <span class="keywordtype">float</span> E99 = 0;
00663 
00664     <span class="keywordflow">for</span> ( i=0; i&lt;<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>; i++) {
00665         <span class="comment">// 0 = Salary payments in relation to current scale</span>
00666         salaryIncr(i+1) = salaryMultiplierRank[i]*numeraireSalary*(1+0) / 100000.0f;
00667         E99 += (float) salaryIncr(i+1);
00668     }
00669 
00670     <span class="keywordflow">for</span> ( j=0; j&lt;<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>; j++) {
00671         salaryIncr(<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>+j+1) = salaryMultiplierGender[j]*numeraireSalary*(1+0) / 100000.0f;
00672         E99 += (float) salaryIncr(<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>+j+1);
00673     }
00674 
00675     E99 = ((E99/(<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>+<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>)) + numeraireSalary ) / 1000;
00676 
00677     <span class="comment">//-----//</span>
00678 
00679     ColumnVector b(4);
00680 
00681     <span class="comment">// construct vectors b and c</span>
00682 
00683     <span class="comment">// E85:97   //------//</span>
00684 
00685     <span class="keyword">const</span> <span class="keywordtype">float</span> C100 = 1;
00686     <span class="keyword">const</span> <span class="keywordtype">float</span> E100 = 1;
00687 
00688 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00689 <span class="preprocessor"></span>    <span class="keywordflow">for</span> ( i=1; i&lt;=<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>+<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>; i++)
00690         c(i) = math.safe_divide( -C100 * ( weightedTalent(i)/3.0f + c(i) ), (<span class="keywordtype">double</span>)C99);
00691 <span class="preprocessor">#else</span>
00692 <span class="preprocessor"></span>    <span class="keywordflow">for</span> ( i=1; i&lt;=<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>+<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>; i++)
00693         c(i) = math.safe_divide( -C100 * ( weightedTalent(i) + c(i) ), (<span class="keywordtype">double</span>)C99);
00694 <span class="preprocessor">#endif</span>
00695 <span class="preprocessor"></span>
00696     c(BOVER) = math.safe_divide(E100*(math.safe_divide((<span class="keywordtype">float</span>)hiring_priority_input_2_multiplier(cost_containment_priority),F7)), E99);
00697     c(BSAVE) = -0.2 * c(BOVER);
00698 
00699     <span class="keywordtype">float</span> E102 = salaryPerNewHire / 100000.0f;
00700 
00701     b(1) = -1;
00702     b(2) = -1;
00703     b(3) = -E102;
00704     b(4) = E102;
00705 
00706     <span class="comment">// print_vector2(c);</span>
00707 
00708     <a class="code" href="ALL_8H.html#a0">err_when</a>(b(3) == 0);
00709 
00710     <span class="comment">//-----//</span>
00711 
00712     DiagonalMatrix Q(varLength);  Q = 0;
00713     <a class="code" href="classMatrix.html">Matrix</a> A(4, varLength);                         <span class="comment">// row x column</span>
00714 
00715     <span class="keywordtype">double</span> inputA[] = {
00716         -1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,
00717         0,0,0,0,0,0,0,-1,-1,-1,-1,0,0,
00718         0,0,0,0,0,0,0,0,0,0,0,1,-1,
00719         0,0,0,0,0,0,0,0,0,0,0,-1,1
00720     };
00721 
00722     A &lt;&lt; inputA;
00723 
00724     <span class="keywordflow">for</span> ( i=1; i&lt;=<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>+<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>; i++) {
00725         A(3,i) = -salaryIncr(i);
00726         A(4,i) = salaryIncr(i);
00727     }
00728 
00729     <span class="comment">//-----//</span>
00730 
00731 <span class="preprocessor">#ifdef DEBUG_MATHCA</span>
00732 <span class="preprocessor"></span>
00733     totalHires = 2;
00734 
00735     <span class="keywordtype">double</span> inputC[] = {-2.13263,0.09157,1.54078,0.69731,-0.12454,-0.22504,-0.12303,-1.17628,-1.28269,1.54429,0.08191,-0.00056229,0.00281145};
00736 
00737     c &lt;&lt; inputC;
00738 
00739     <span class="comment">//double inputB[] = {-1.00000,-1.00000,9.68585,-9.68585};</span>
00740     <span class="keywordtype">double</span> inputB[] = {-1.00000,-1.00000,0,0};
00741 
00742     b &lt;&lt; inputB;
00743 <span class="preprocessor">#endif</span>
00744 <span class="preprocessor"></span>
00745     <span class="comment">//------- 5. Main -------//</span>
00746 
00747     <span class="comment">//-------------------------------------//</span>
00748     <span class="comment">//-------------------------------------//</span>
00749     <span class="comment">//                                  main loop</span>
00750     <span class="comment">//-------------------------------------//</span>
00751     <span class="comment">//-------------------------------------//</span>
00752 
00753     <span class="comment">// not ($000)</span>
00754     <span class="keywordtype">int</span> totalBugetDept = salaryPerNewHire * totalHires;
00755 
00756     <span class="keywordtype">int</span> facCountBeforeNewHires = faculty_array.faculty_count;
00757 
00758     <span class="keywordflow">for</span> ( i=0; i&lt;totalHires; i++ ) {
00759 <span class="preprocessor">#ifdef DEBUG_VC</span>
00760 <span class="preprocessor"></span>        <span class="keywordtype">char</span> s[300];
00761         sprintf(s, <span class="stringliteral">"\nZZZZZZZ  Department %d: hire the %d th faculty this year ZZZZZZZ"</span>, department_recno, i+1);
00762         <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(s);
00763 <span class="preprocessor">#endif</span>
00764 <span class="preprocessor"></span>
00765         <span class="keywordtype">int</span> j;
00766 
00767         <span class="comment">//----------------------------//-</span>
00768         <span class="comment">//----------------------------//        Go run it!</span>
00769 
00770         print_var_name(<span class="stringliteral">"Before quadratric_prog"</span>);
00771         print_var_name( <span class="stringliteral">"c"</span> );
00772         print_vector2(c);
00773         print_var_name( <span class="stringliteral">"Q"</span> );
00774         print_matrix(Q);
00775         print_var_name( <span class="stringliteral">"A"</span> );
00776         print_matrix(A);
00777         print_var_name( <span class="stringliteral">"b"</span> );
00778         print_vector2(b);
00779 
00780         ColumnVector xNames(varLength);
00781         <span class="keywordflow">if</span> (!<a class="code" href="classLinearAlgebra.html#d0">LinearAlgebra::quadratic_prog</a>(c,Q,A,b,xNames))
00782             <span class="keywordflow">break</span>;                                      <span class="comment">// temp do nothing</span>
00783 
00784         print_var_name(<span class="stringliteral">"After quadratic_prog"</span> );
00785         print_var_name(<span class="stringliteral">"xNames"</span> );
00786         print_vector2(xNames);
00787 
00788         <span class="comment">// mathca xNames = {1.,0,0,0,0,0,0,0,1.,0,0}</span>
00789 
00790         <span class="comment">/*// 0105section of code still have bug</span>
00791 <span class="comment"></span>
00792 <span class="comment">          // see email Re: Q40. hiring</span>
00793 <span class="comment"></span>
00794 <span class="comment">          for (j=1; j&lt;=varLength-2; j++)</span>
00795 <span class="comment">          xNames(j) = max(0,min(1,(xNames(j) + 0.5)));</span>
00796 <span class="comment"></span>
00797 <span class="comment">          int count=0, group=0;</span>
00798 <span class="comment"></span>
00799 <span class="comment">          for (j=1; j&lt;=varLength-2; j++)</span>
00800 <span class="comment">          if ( xNames(j) == 1 )</span>
00801 <span class="comment">          {</span>
00802 <span class="comment">          if ( j &gt; MAX_RANK_AGE_GROUP )</span>
00803 <span class="comment">          group = 1;</span>
00804 <span class="comment"></span>
00805 <span class="comment">          count++;</span>
00806 <span class="comment">          }</span>
00807 <span class="comment">    */</span>
00808 
00809         <span class="keywordtype">int</span> count=0, group=0;
00810 
00811         <span class="keywordflow">for</span> (group=0; group&lt;=1; group++) {
00812             <span class="keywordtype">int</span> maxIdx = 0;
00813             <a class="code" href="OLINALG_8H.html#a0">REAL</a> maxValue = 0;
00814             <span class="keywordtype">int</span> start,end;
00815 
00816             <span class="keywordflow">if</span> ( group == 1 ) {
00817                 start = <a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>+1;
00818                 end = varLength-2;
00819             }
00820             <span class="keywordflow">else</span> {
00821                 start = 1;
00822                 end = <a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>;
00823             }
00824 
00825             <span class="comment">// find the max within the group</span>
00826             <span class="keywordflow">for</span> (j=start; j&lt;=end; j++) {
00827                 <span class="keywordflow">if</span> ( xNames(j) &gt; maxValue ) {
00828                     <span class="comment">//err_when( xNames(j) == 1 );</span>
00829 
00830                     maxValue = xNames(j);
00831                     maxIdx = j;
00832                 }
00833             }
00834 
00835             <a class="code" href="ALL_8H.html#a0">err_when</a>(maxIdx &lt;= 0);
00836 
00837             xNames(maxIdx) = 1;
00838             count++;
00839         }
00840 
00841         <span class="keywordflow">for</span> (j=1; j&lt;=varLength-2; j++)
00842             <span class="keywordflow">if</span> ( xNames(j) != 1 )
00843                 xNames(j) =0;
00844 
00845         xNames(varLength-1) = 0;
00846         xNames(varLength) = 0;
00847 
00848         print_var_name(<span class="stringliteral">"After changing xNames"</span>);
00849         print_vector2(xNames);
00850 
00851         <a class="code" href="ALL_8H.html#a0">err_when</a>( count != 2 );
00852 
00853         <span class="comment">//----------------------------//</span>
00854         <span class="comment">//----------------------------//        generate faculty</span>
00855 
00856         <span class="keywordtype">char</span>  rank, age, gender;
00857         <span class="keywordtype">int</span> talentTeaching, talentScholarship, talentResearch;
00858         <span class="keywordtype">int</span> salary, rankAgeGroup;
00859 
00860         <span class="keywordflow">for</span> (j=1; j&lt;=<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>; j++) {
00861             <span class="keywordflow">if</span> ( xNames(j) == 1 ) {
00862                 rankAgeGroup = j-1;
00863                 rank = <a class="code" href="classFaculty.html#d1">Faculty::rank_age_group_2_rank</a>(j-1);
00864 
00865                 talentTeaching = (int) talentRank[j-1][<a class="code" href="Odept_8h.html#a18a9">TALENT_TEACH</a>];
00866                 talentScholarship = (int) talentRank[j-1][<a class="code" href="Odept_8h.html#a18a10">TALENT_SCHOLARSHIP</a>];
00867                 talentResearch = (int) talentRank[j-1][<a class="code" href="Odept_8h.html#a18a11">TALENT_RESEARCH</a>];
00868                 salary = (int) salaryIncr(j);
00869 
00870                 <span class="keywordflow">break</span>;
00871             }
00872         }
00873 
00874         <a class="code" href="ALL_8H.html#a0">err_when</a>(j==<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>+1);
00875 
00876         <span class="keywordflow">for</span> (j=<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>+1; j&lt;=<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>+<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>; j++) {
00877             <span class="keywordflow">if</span> ( xNames(j) == 1 ) {
00878                 gender = j-<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>-1;
00879 
00880                 talentTeaching = (int) (talentTeaching + talentGender[gender][<a class="code" href="Odept_8h.html#a18a9">TALENT_TEACH</a>]) / 2;
00881                 talentScholarship = (int) (talentScholarship + talentGender[gender][<a class="code" href="Odept_8h.html#a18a10">TALENT_SCHOLARSHIP</a>]) / 2;
00882                 talentResearch = (int) (talentResearch + talentGender[gender][<a class="code" href="Odept_8h.html#a18a11">TALENT_RESEARCH</a>]) / 2;
00883                 <span class="comment">//min &amp; max bug chea</span>
00884                 salary = (int) max(0, (<span class="keywordtype">int</span>)(salary + salaryIncr(j) + numeraireSalary));
00885 
00886                 <span class="keywordflow">break</span>;
00887             }
00888 
00889         }
00890 
00891         <a class="code" href="ALL_8H.html#a0">err_when</a>(j==<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>+<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>+1);
00892 
00893         age = <a class="code" href="classFaculty.html#d3">Faculty::get_min_age</a>(rankAgeGroup) + m.random(5);
00894 
00895         <span class="keywordtype">int</span> startTeachingDate = 0;
00896 
00897         startTeachingDate = date.julian(info.game_year,info.game_month,info.game_day);
00898 
00899         <span class="comment">/*</span>
00900 <span class="comment">          // for testing only</span>
00901 <span class="comment">          int errorwhen = m.random( age - Faculty::get_min_age(rankAgeGroup) ) * 365 + m.random( 365 );</span>
00902 <span class="comment">          int start_game = info.game_start_date;</span>
00903 <span class="comment">          int syear = date.get_date(start_game,'Y');</span>
00904 <span class="comment">          int smonth = date.get_date(start_game,'M');</span>
00905 <span class="comment">          int sday = date.get_date(start_game,'D');</span>
00906 <span class="comment">          int test_day = date.julian(2,9,1);</span>
00907 <span class="comment">          int test_daysdg = date.julian(-2,9,1);</span>
00908 <span class="comment">          int year = date.get_date(startTeachingDate,'Y');</span>
00909 <span class="comment">          int month = date.get_date(startTeachingDate,'M');</span>
00910 <span class="comment">          int day = date.get_date(startTeachingDate,'D');</span>
00911 <span class="comment">        */</span>
00912 
00913         <span class="comment">//------- for setting faculty salary ------------//</span>
00914         <span class="comment">//</span>
00915         <span class="comment">// Since there are some problems with above code calculating the salary,</span>
00916         <span class="comment">// we are using this new code from faculty initializating to override the calculation.</span>
00917         <span class="comment">//</span>
00918         <span class="comment">//-----------------------------------------------//</span>
00919 
00920         <a class="code" href="structDepartmentInfo.html">DepartmentInfo</a>* deptInfo = department_res[department_id];
00921 
00922         <a class="code" href="structFacultyTemplate.html">FacultyTemplate</a>* facultyTemplate = faculty_res.get_faculty_template( deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m19">template_salary</a>, rankAgeGroup );
00923         <a class="code" href="classPeerSchool.html">PeerSchool</a> *plSch = school_res.player_peer_school;
00924 
00925         salary = int( deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m3">salary_multiplier</a> * facultyTemplate-&gt;<a class="code" href="structFacultyTemplate.html#m5">overall_salary_multiplier</a> *
00926                       plSch-&gt;<a class="code" href="classSchoolEx.html#m50">school_faculty_array_ex</a>[rank].<a class="code" href="structSchoolFaculty.html#m1">salary</a> );
00927 
00928         <span class="comment">//------------ add the new faculty ------------//</span>
00929 
00930         <span class="keywordtype">int</span> facultyRecno = faculty_array.add(department_recno, rank, gender, age, startTeachingDate,
00931                                              salary, talentTeaching, talentScholarship, talentResearch);
00932 
00933         <span class="comment">//0415 this-&gt;generate_faculty_research_project(facultyRecno, rankAgeGroup);     // 0412</span>
00934 
00935         <span class="comment">//calc_faculty_history();                       // 0407</span>
00936 
00937         <span class="comment">//----------------------------//</span>
00938         <span class="comment">//----------------------------// prepare data for next loop</span>
00939 
00940         <span class="keywordflow">if</span> ( i == 0 ) {
00941             <span class="comment">// append a new row to A</span>
00942             RowVector dummy(varLength);     dummy = 0;
00943 
00944             A &amp;= dummy;
00945 
00946             ColumnVector dum(1);
00947 
00948             b &amp;= dum;
00949 
00950             b(5) = 0;
00951         }
00952 
00953         <span class="comment">// update the fifth row of A</span>
00954         <span class="comment">// see subject: Re: Q38a. misc</span>
00955 
00956         ColumnVector <a class="code" href="OTEST_8H.html#a0">test</a>(<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>+<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>);
00957         <span class="keywordtype">int</span> rCount=0, gCount=0;
00958 
00959         <span class="keywordflow">for</span> (j=1; j&lt;=<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>+<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>; j++) {
00960             A(5,j) -= ( xNames(j) == 1 &amp;&amp; math.get_random_float() &gt; 0.25 ) ? 1 : 0;
00961             <a class="code" href="OTEST_8H.html#a0">test</a>(j) = A(5,j);
00962 
00963             <span class="keywordflow">if</span> ( A(5,j) == -1 ) {
00964                 <span class="keywordflow">if</span> ( j &lt;= <a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a> )
00965                     rCount++;
00966                 <span class="keywordflow">else</span>
00967                     gCount++;
00968             }
00969         }
00970 
00971         <span class="keywordflow">if</span> ( rCount &gt;= <a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a> ) {
00972             <span class="keywordflow">for</span> (j=1; j&lt;=<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>; j++)
00973                 A(5,j) = 0;
00974         }
00975 
00976         <span class="keywordflow">if</span> ( gCount &gt;= <a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a> ) {
00977             <span class="keywordflow">for</span> (j=1; j&lt;=<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>; j++)
00978                 A(5,j+<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>) = 0;
00979         }
00980 
00981         print_var_name(<span class="stringliteral">"test"</span>);
00982         print_vector2(<a class="code" href="OTEST_8H.html#a0">test</a>);
00983 
00984         <span class="comment">//------//</span>
00985 
00986         totalBugetDept += -salary;                    <span class="comment">// not ($000)</span>
00987 
00988         <span class="keywordflow">if</span> ( totalHires-1 != i )
00989             salaryPerNewHire = totalBugetDept / (totalHires-i-1);
00990 
00991         E102 = salaryPerNewHire / 100000.0f;
00992 
00993         b(3) = -E102;
00994         b(4) = E102;
00995 
00996         sys.yield();
00997     }
00998 
00999     <a class="code" href="ALL_8H.html#a0">err_when</a>( faculty_array.faculty_count != facCountBeforeNewHires + totalHires );
01000 
01001 }
01002 
01003 <span class="comment">//---------- End of function Department::faculty_hiring ----------//</span>
01004 
01005 <span class="comment">/*</span>
01006 <span class="comment">67.9            79.4    90</span>
01007 <span class="comment">67.9    76.4    90</span>
01008 <span class="comment">67.9    73.1    90</span>
01009 <span class="comment">63.3    69.5    81.8</span>
01010 <span class="comment">60.5    65.7    34.4</span>
01011 <span class="comment">80.0    0       0</span>
01012 <span class="comment">80.0    0       0</span>
01013 <span class="comment"></span>
01014 <span class="comment">  float peerConstGenderTalent[GENDER_ETHNIC_TYPE_COUNT][TALENT_COUNT] =</span>
01015 <span class="comment">{</span>
01016 <span class="comment">67.9    79.4    90</span>
01017 <span class="comment">67.9    76.4    87</span>
01018 <span class="comment">67.9    73.1    50</span>
01019 <span class="comment">70.0    75.0    60</span>
01020 <span class="comment">*/</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:21 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
