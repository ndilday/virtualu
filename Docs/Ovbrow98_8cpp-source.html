<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Ovbrow98.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Ovbrow98.cpp</h1><a href="Ovbrow98_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OVBROW98.CPP</span>
00002 <span class="comment">//Description : Object Visual Browse</span>
00003 <span class="comment">//owner :chw1021</span>
00004 
00005 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>
00007 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00008 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00010 <span class="preprocessor">#include &lt;OFONT.H&gt;</span>
00011 <span class="preprocessor">#include &lt;<a class="code" href="OPOWER_8H.html">OPOWER.H</a>&gt;</span>
00012 <span class="preprocessor">#include &lt;<a class="code" href="OVBROW98_8H.html">OVBROW98.H</a>&gt;</span>
00013 <span class="preprocessor">#include &lt;OIFACE.H&gt;</span>
00014 
00015 <span class="comment">//---------- Define static class variables -------//</span>
00016 
<a name="l00017"></a><a class="code" href="classVBrowse98.html#p0">00017</a> <span class="keywordtype">char</span>    <a class="code" href="classVBrowse98.html#p0">VBrowse98::press_record</a>=0;                <span class="comment">// for detecting pulling records upwards and downloads</span>
<a name="l00018"></a><a class="code" href="classVBrowse98.html#p1">00018</a> <a class="code" href="classVBrowse98.html">VBrowse98</a>* <a class="code" href="classVBrowse98.html#p1">VBrowse98::press_vbrowse_ptr</a>;
00019 
<a name="l00020"></a><a class="code" href="classVBrowse98.html#a0">00020</a> <a class="code" href="classVBrowse98.html#a0">VBrowse98::VBrowse98</a>() {
00021     <a class="code" href="classVBrowse98.html#m8">init_flag</a>=0;
00022     <a class="code" href="classVBrowse98.html#m7">refresh_bitmap</a>=<a class="code" href="OHELP_8H.html#a0">NULL</a>;
00023 }
00024 
<a name="l00025"></a><a class="code" href="classVBrowse98.html#a1">00025</a> <a class="code" href="classVBrowse98.html#a1">VBrowse98::~VBrowse98</a>() {
00026     <a class="code" href="classVBrowse98.html#a3">deinit</a>();
00027 }
00028 
<a name="l00029"></a><a class="code" href="classVBrowse98.html#a3">00029</a> <span class="keywordtype">void</span> <a class="code" href="classVBrowse98.html#a3">VBrowse98::deinit</a>() {
00030     <span class="keywordflow">if</span>(refresh_bitmap) {
00031         <a class="code" href="ALL_8H.html#a8">mem_del</a>(<a class="code" href="classVBrowse98.html#m7">refresh_bitmap</a>);
00032         <a class="code" href="classVBrowse98.html#m7">refresh_bitmap</a>=<a class="code" href="OHELP_8H.html#a0">NULL</a>;
00033     }
00034 }
00035 
00036 <span class="comment">//--------- Begin of function VBrowse98::init --------//</span>
<a name="l00055"></a><a class="code" href="classVBrowse98.html#a2">00055</a> <span class="comment">void VBrowse98::init(int inX1, int inY1, int inX2, int inY2,</span>
00056                      <span class="keywordtype">int</span> recWidth, <span class="keywordtype">int</span> recHeight,
00057                      <span class="keywordtype">int</span> totalRec, BrowDispFP dispFunc,
00058                      BrowDetectFP detectFunc,
00059                      <span class="keywordtype">int</span> dispFrame, <span class="keywordtype">int</span> minInterSpace) {
00060     x1 = inX1;
00061     y1 = inY1;
00062     x2 = inX2;
00063     y2 = inY2;
00064 
00065     ix1 = x1+6;                                     <span class="comment">// content area coordination</span>
00066     iy1 = y1+6;
00067     ix2 = x2-6-SCROLL_BAR_WIDTH;
00068     iy2 = y2-6;
00069 
00070     <span class="comment">//---------------------------------------------//</span>
00071 
00072     <span class="keywordflow">if</span>( recWidth &lt;= 0 )
00073         rec_width = ix2-ix1+1;
00074     <span class="keywordflow">else</span>
00075         rec_width = recWidth;
00076 
00077     rec_height = recHeight;
00078 
00079     disp_rec_func   = dispFunc;
00080     disp_frame      = dispFrame;
00081 
00082     x_max_rec = (ix2-ix1+minInterSpace+1) / (rec_width +minInterSpace);
00083     y_max_rec = (iy2-iy1+minInterSpace+1) / (rec_height+minInterSpace);
00084 
00085     detect_pull_flag = 1;                           <span class="comment">// whether detect pulling records or not</span>
00086 
00087     <a class="code" href="ALL_8H.html#a2">err_if</a>( x_max_rec &lt;= 0 || y_max_rec &lt;= 0 )
00088         <a class="code" href="ALL_8H.html#a4">err_now</a>( <span class="stringliteral">"VBrowse98::init() error : disp_max_rec &lt;= 0"</span> );
00089 
00090     <span class="comment">//--- calculate the suitable inter-record space -------//</span>
00091 
00092     <span class="keywordflow">if</span>( x_max_rec &gt; 1 )
00093         rec_x_space = minInterSpace + (ix2-ix1+minInterSpace+1) % (rec_width +minInterSpace)/(x_max_rec-1);
00094     <span class="keywordflow">else</span>
00095         rec_x_space = minInterSpace;
00096 
00097     <span class="keywordflow">if</span>( y_max_rec &gt; 1 )
00098         rec_y_space = minInterSpace + (iy2-iy1+minInterSpace+1) % (rec_height+minInterSpace)/(y_max_rec-1);
00099     <span class="keywordflow">else</span>
00100         rec_y_space = minInterSpace;
00101 
00102     init_var(totalRec,-1);
00103 
00104     init_flag = 1;
00105 
00106     <span class="comment">//------- paint the list box --------//</span>
00107 
00108     paint();
00109 }
00110 
00111 <span class="comment">//---------- End of function VBrowse98::init ---------//</span>
00112 
00113 <span class="comment">//---------- Begin of function VBrowse98::init_var -------//</span>
<a name="l00117"></a><a class="code" href="classVBrowse98.html#b0">00117</a> <span class="comment">void VBrowse98::init_var(int totalRec, int recNo) {</span>
00118     <span class="keywordflow">if</span>( totalRec &gt;= 0 ) {                           <span class="comment">// if totalRec == -1, then no change</span>
00119         none_record = totalRec==0;
00120 
00121         <span class="keywordflow">if</span>( totalRec == 0 )
00122             total_rec_num = 1;                          <span class="comment">// prevent divided by zero if it is a closed box</span>
00123         <span class="keywordflow">else</span>
00124             total_rec_num = totalRec;
00125     }
00126 
00127     <span class="comment">//--- maximum records can be display on a browse box ---//</span>
00128 
00129     disp_max_rec = x_max_rec * y_max_rec;
00130 
00131     <span class="keywordflow">if</span>( disp_max_rec &gt; total_rec_num )
00132         disp_max_rec = total_rec_num;
00133 
00134     <span class="comment">//------- changable variables --------//</span>
00135 
00136     rec_no = recNo;
00137 
00138     <span class="keywordflow">if</span>(((recNo&lt;top_rec_no)&amp;&amp;(recNo&gt;top_rec_no+disp_max_rec-1))
00139        ||(init_flag==0)) {
00140         <span class="comment">// Change top_rec_no</span>
00141         top_rec_no = recNo - disp_max_rec/2;
00142         top_rec_no = max(1,top_rec_no);
00143         <span class="comment">// if there is an empty area at the lower part of the browser</span>
00144         <span class="keywordflow">if</span>( top_rec_no+disp_max_rec-1 &gt; total_rec_num ) {
00145             top_rec_no = total_rec_num-disp_max_rec+1;
00146             top_rec_no = max(top_rec_no,1);
00147         }
00148     }
00149 
00150     <span class="comment">//------------- initialize scroll bar ---------------//</span>
00151     <span class="comment">//</span>
00152     <span class="comment">// If display frame      , then scroll unit is 1 record</span>
00153     <span class="comment">// If don't display frame, then the scroll unit is disp_max_rec record</span>
00154     <span class="comment">//</span>
00155     <span class="comment">//---------------------------------------------------//</span>
00156 
00157     scroll_bar.init( 1, x2-SCROLL_BAR_WIDTH-7, y1+4, x2-7, y2-4, disp_max_rec,
00158                      (disp_frame &amp;&amp; x_max_rec==1 ? 1 : disp_max_rec),<span class="comment">// only use record as scroller unit when it's a vertical browser with frame</span>
00159                      total_rec_num, 1 );
00160 }
00161 
00162 <span class="comment">//----------- End of function VBrowse98::init_var ----------//</span>
00163 
00164 <span class="comment">//--------- Begin of function VBrowse98::open ---------//</span>
<a name="l00176"></a><a class="code" href="classVBrowse98.html#a4">00176</a> <span class="comment">void VBrowse98::open(int recNo, int newTotalRec) {</span>
00177     state = 1;                                      <span class="comment">// state = OPENED</span>
00178 
00179     <span class="keywordflow">if</span>( newTotalRec &gt;= 0 )
00180         total_rec_num = newTotalRec;
00181 
00182     <span class="keywordflow">if</span>( recNo &gt; 0 )                                 <span class="comment">// keep current record no.</span>
00183         rec_no = recNo;
00184 
00185     <span class="keywordflow">if</span>( rec_no&lt;1 )
00186         rec_no=1;
00187 
00188     <span class="keywordflow">if</span>( rec_no &gt; total_rec_num )
00189         rec_no = total_rec_num;
00190 
00191     <span class="comment">//------- set the top recno ----------//</span>
00192 
00193     <span class="keywordflow">if</span>( !newTotalRec ) {
00194         top_rec_no = rec_no - disp_max_rec/2;
00195         top_rec_no = max(1,top_rec_no);
00196     }
00197     <span class="keywordflow">else</span> {                                          <span class="comment">// keep the original top_rec_no</span>
00198         <span class="keywordflow">if</span>( rec_no &gt; top_rec_no+disp_max_rec-1 )
00199             top_rec_no = rec_no-disp_max_rec+1;
00200 
00201         <span class="keywordflow">if</span>( rec_no &lt; top_rec_no )
00202             top_rec_no = rec_no;
00203     }
00204 
00205     <span class="comment">// if there is an empty area at the lower part of the browser</span>
00206     <span class="keywordflow">if</span>( top_rec_no+disp_max_rec-1 &gt; total_rec_num ) {
00207         top_rec_no = total_rec_num-disp_max_rec+1;
00208         top_rec_no = max(top_rec_no,1);
00209     }
00210 
00211     <span class="comment">//------- display all records -------//</span>
00212 
00213     disp_all();
00214 }
00215 
00216 <span class="comment">//--------- End of function VBrowse98::open ---------//</span>
00217 
00218 <span class="comment">//--------- Begin of function VBrowse98::close ---------//</span>
<a name="l00222"></a><a class="code" href="classVBrowse98.html#a5">00222</a> <span class="comment">void VBrowse98::close() {</span>
00223     state = 0;                                      <span class="comment">// state = CLOSED</span>
00224 
00225     <span class="comment">//-------- paint the closed outlook of the list box -------//</span>
00226 
00227     <span class="comment">// the place a large block on the list content box</span>
00228     <a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;<a class="code" href="classVgaBuf.html#a41">d3_panel_up</a>( x1+1, y1+1, x2-SCROLL_BAR_WIDTH-3, y2-1  );
00229 }
00230 
00231 <span class="comment">//--------- End of function VBrowse98::close ---------//</span>
00232 
00233 <span class="comment">//--------- Begin of function VBrowse98::paint ---------//</span>
<a name="l00237"></a><a class="code" href="classVBrowse98.html#a12">00237</a> <span class="comment">void VBrowse98::paint() {</span>
00238     vga.use_back();
00239     refresh_bitmap=vga_back.save_area( x1, y1, x2-SCROLL_BAR_WIDTH-3, y2,refresh_bitmap);
00240     scroll_bar.paint();
00241     sys.yield();                                    <span class="comment">// chwg032799</span>
00242 }
00243 
00244 <span class="comment">//--------- End of function VBrowse98::paint ---------//</span>
00245 
00246 <span class="comment">//------- Begin of function VBrowse98::refresh ---------//</span>
<a name="l00255"></a><a class="code" href="classVBrowse98.html#a10">00255</a> <span class="comment">void VBrowse98::refresh(int newRecNo, int newTotalRec) {</span>
00256     disp_one(rec_no,CLEAR_HIGH);
00257 
00258     <span class="keywordflow">if</span>( newRecNo&gt;=0 || newTotalRec&gt;=0 ) {           <span class="comment">// if current recno and total recno has no change, don't do the recalculation</span>
00259         <span class="keywordflow">if</span>( newRecNo &gt;= 1 )
00260             rec_no = newRecNo;
00261 
00262         <span class="keywordflow">if</span>( newTotalRec != -1 &amp;&amp; rec_no &gt; newTotalRec )
00263             rec_no = newTotalRec;
00264 
00265         <span class="keywordflow">if</span>( rec_no==0 &amp;&amp; newTotalRec&gt;0 )              <span class="comment">// if originally rec_no==0, and total_rec is also 0, when the new total_rec is &gt; 0, the rec_no should also be adjusted</span>
00266             rec_no=1;
00267 
00268         init_var(newTotalRec,rec_no);
00269     }
00270 
00271     disp_all();
00272 }
00273 
00274 <span class="comment">//---------- End of function VBrowse98::refresh ----------//</span>
00275 
00276 <span class="comment">//------- Begin of function VBrowse98::update ---------//</span>
<a name="l00280"></a><a class="code" href="classVBrowse98.html#a11">00280</a> <span class="comment">void VBrowse98::update() {</span>
00281     <span class="keywordtype">int</span> recNo, x, y;
00282 
00283     <span class="keywordflow">if</span>( none_record )
00284         <span class="keywordflow">return</span>;
00285 
00286     <span class="keywordflow">for</span>( recNo=top_rec_no ; recNo&lt;=total_rec_num &amp;&amp; recNo&lt;top_rec_no+disp_max_rec ; recNo++ ) {
00287         y = iy1 + (recNo-top_rec_no)/x_max_rec * (rec_height+rec_y_space);
00288         x = ix1 + (recNo-top_rec_no)%x_max_rec * (rec_width+rec_x_space);
00289 
00290         disp_rec( recNo, x, y, <a class="code" href="Gamedef_8h.html#a71a17">INFO_UPDATE</a> );         <span class="comment">// call user defined function</span>
00291     }
00292 }
00293 
00294 <span class="comment">//---------- End of function VBrowse98::update ----------//</span>
00295 
00296 <span class="comment">//--------- Begin of function VBrowse98::detect ------//</span>
<a name="l00303"></a><a class="code" href="classVBrowse98.html#a8">00303</a> <span class="comment">int VBrowse98::detect() {</span>
00304     <span class="keywordtype">int</span> newRecNo=0, rc;
00305 
00306     double_click = 0;
00307 
00308     <span class="keywordflow">if</span>( state == 0 || none_record )                 <span class="comment">// closed</span>
00309         <span class="keywordflow">return</span> 0;
00310 
00311     <span class="comment">//-- Detect pulling on record if the browser is with frame --//</span>
00312 
00313     <span class="comment">// only pull when the vbrowser is vertical, horizontal is technically possible, but not used practically</span>
00314     <span class="keywordflow">if</span>( detect_pull_flag &amp;&amp; disp_frame &amp;&amp; x_max_rec==1 ) {
00315         <span class="keywordflow">if</span>( detect_pull() )
00316             <span class="keywordflow">return</span> rec_no;
00317     }
00318 
00319     <span class="comment">//--------- Detect pressing on record if disp_frame is 1 ---------//</span>
00320 
00321     <span class="keywordflow">if</span>( disp_frame ) {
00322         <span class="comment">// #### begin Gilbert 23/04/2001 ######//</span>
00323         <span class="comment">// if( mouse.press_area(ix1, iy1, ix2, iy2) )</span>
00324         <span class="keywordflow">if</span>( mouse.any_click(ix1, iy1, ix2, iy2) ) {
00325             <span class="comment">// #### end Gilbert 23/04/2001 ######//</span>
00326             newRecNo = top_rec_no +
00327                 (mouse.cur_y-iy1) / (rec_height+rec_y_space) * x_max_rec +
00328                 (mouse.cur_x-ix1) / (rec_width +rec_x_space);
00329 
00330             <span class="keywordflow">if</span>( detect_pull_flag )
00331                 press_record = 1;
00332 
00333             press_vbrowse_ptr = <span class="keyword">this</span>;
00334         }
00335 
00336         <span class="comment">// if it is not in the empty browser area</span>
00337         <span class="keywordflow">if</span>( newRecNo&gt;=top_rec_no &amp;&amp; newRecNo&lt;=top_rec_no-1+disp_max_rec ) {
00338             <span class="keywordflow">if</span>( mouse.click_count()==2 )                <span class="comment">// double clicked</span>
00339                 double_click = 1;
00340 
00341             <span class="keywordflow">if</span>( newRecNo != rec_no ) {                  <span class="comment">// if user point to a new record</span>
00342                 disp_one(rec_no, CLEAR_HIGH);
00343                 disp_one(newRecNo , DISP_HIGH );          <span class="comment">// 2 means display record content only</span>
00344 
00345                 rec_no = newRecNo;
00346                 <span class="keywordflow">return</span> rec_no;
00347             }
00348 
00349             <span class="keywordflow">if</span>( double_click )                          <span class="comment">// even if current record no. doesn't change, return recno if double clicked</span>
00350                 <span class="keywordflow">return</span> rec_no;
00351         }
00352     }
00353     <span class="keywordflow">else</span> {                                          <span class="comment">//---- when disp_frame is 0, fast scrolling is enabled ----//</span>
00354         <span class="keywordflow">if</span>( mouse.any_click( ix1, iy1, ix2, iy2 ) ) {
00355             <span class="keywordtype">int</span> newTopRec;
00356 
00357             <span class="keywordflow">if</span>( mouse.click_y() &lt; iy1+ ( (iy2-iy1) &gt;&gt; 1 ) )
00358                 newTopRec = scroll_bar.page_up();         <span class="comment">// page up</span>
00359             <span class="keywordflow">else</span>
00360                 newTopRec = scroll_bar.page_down();       <span class="comment">// page down</span>
00361 
00362             <span class="keywordflow">if</span>( top_rec_no != newTopRec ) {
00363                 double_click = mouse.click_count()==2;    <span class="comment">// double clicked</span>
00364 
00365                 rec_no = top_rec_no = newTopRec;
00366                 disp_all();
00367 
00368                 <span class="keywordflow">return</span> rec_no;
00369             }
00370         }
00371     }
00372 
00373     <span class="comment">//------- detect for pressing on scroll bar -----//</span>
00374 
00375     <span class="keywordflow">if</span>( ( rc=scroll_bar.detect() ) &gt; 0 ) {
00376         disp_one(rec_no,CLEAR_HIGH);
00377         rec_no = rc;
00378 
00379         <span class="keywordflow">if</span>( disp_frame &amp;&amp; x_max_rec==1 ) {            <span class="comment">// only use record as scroller unit when it's a vertical browser with frame, refer to scroll_bar.init() in VBrowse98::init_var()</span>
00380             <span class="keywordflow">if</span>( rec_no &lt; top_rec_no ) {
00381                 top_rec_no = rec_no;
00382                 disp_all();
00383             }
00384 
00385             <span class="keywordflow">else</span> <span class="keywordflow">if</span>( rec_no &gt;= top_rec_no + disp_max_rec ) {
00386                 top_rec_no = rec_no - disp_max_rec + 1;
00387                 <span class="keywordflow">if</span>( top_rec_no &lt; 1 )
00388                     top_rec_no = 1;
00389                 disp_all();
00390             }
00391 
00392             <span class="keywordflow">else</span>
00393                 disp_one(rec_no,DISP_HIGH);
00394         }
00395         <span class="keywordflow">else</span> {
00396             top_rec_no = rc;
00397             disp_all();
00398         }
00399 
00400         <span class="keywordflow">return</span> rec_no;
00401     }
00402 
00403     <span class="keywordflow">return</span> 0;
00404 }
00405 
00406 <span class="comment">//----------- End of function VBrowse98::detect -------//</span>
00407 
00408 <span class="comment">//---------- Begin of function VBrowse98::detect_pull ---------//</span>
<a name="l00412"></a><a class="code" href="classVBrowse98.html#b4">00412</a> <span class="comment">int VBrowse98::detect_pull() {</span>
00413     <span class="keywordflow">if</span>( press_record ) {                            <span class="comment">// test whether user continue pressing it</span>
00414         press_record = mouse.left_press;
00415 
00416         <span class="keywordflow">if</span>( press_record )
00417             press_vbrowse_ptr = <span class="keyword">this</span>;
00418     }
00419 
00420     <span class="keywordflow">if</span>( !( mouse.left_press || mouse.click_count() ) )
00421         <span class="keywordflow">return</span> 0;
00422 
00423     <span class="keywordflow">if</span>( !press_record )
00424         <span class="keywordflow">return</span> 0;
00425 
00426     <span class="comment">//--------- detect for pulling record upwards ---------//</span>
00427 
00428     <span class="keywordflow">if</span>( ( x_max_rec==1 &amp;&amp; mouse.press_area( x1, 0 , x2, y1 ) ) ||
00429         ( y_max_rec==1 &amp;&amp; mouse.press_area(  0, y1, x1, y2 ) ) ) {
00430         <span class="keywordflow">if</span>( rec_no &gt; 1 ) {
00431             disp_one(rec_no, CLEAR_HIGH);
00432 
00433             rec_no--;
00434             <span class="keywordflow">if</span>( rec_no &lt; top_rec_no )
00435                 top_rec_no--;
00436 
00437             disp_all();
00438             <span class="keywordflow">return</span> 1;
00439         }
00440     }
00441 
00442     <span class="comment">//---- detect for pressing down button or pulling record downwards ---//</span>
00443 
00444     <span class="keywordflow">if</span>( ( x_max_rec==1 &amp;&amp; mouse.press_area( x1, y2, x2, <a class="code" href="OVGA_8H.html#a1">VGA_HEIGHT</a>-1 ) ) ||
00445         ( y_max_rec==1 &amp;&amp; mouse.press_area( x2, y1, <a class="code" href="OVGA_8H.html#a0">VGA_WIDTH</a>-1, y2  ) ) ) {
00446         <span class="keywordflow">if</span>( rec_no &lt; total_rec_num ) {
00447             disp_one(rec_no, CLEAR_HIGH);
00448 
00449             rec_no++;
00450             <span class="keywordflow">if</span>( rec_no &gt;= top_rec_no+disp_max_rec )
00451                 top_rec_no++;
00452 
00453             disp_all();
00454             <span class="keywordflow">return</span> 1;
00455         }
00456     }
00457 
00458     <span class="keywordflow">return</span> 0;
00459 }
00460 
00461 <span class="comment">//---------- End of function VBrowse98::detect_pull ---------//</span>
00462 
00463 <span class="comment">//--------- Begin of function VBrowse98::detect_right ------//</span>
<a name="l00470"></a><a class="code" href="classVBrowse98.html#a9">00470</a> <span class="comment">int VBrowse98::detect_right() {</span>
00471     <span class="keywordflow">if</span>( state == 0 || none_record )                 <span class="comment">// closed</span>
00472         <span class="keywordflow">return</span> 0;
00473 
00474     <span class="comment">// 1-right mouse button</span>
00475     <span class="keywordflow">if</span>( mouse.single_click( ix1, iy1, ix2, iy2, 1 ) ) {
00476         <span class="keywordtype">int</span> recNo;
00477 
00478         recNo = top_rec_no +
00479             (mouse.click_y(1)-iy1) / (rec_height+rec_y_space) * x_max_rec +
00480             (mouse.click_x(1)-ix1) / (rec_width +rec_x_space);
00481 
00482         <span class="keywordflow">if</span>( recNo &lt;= top_rec_no-1+disp_max_rec ) {
00483             disp_one(rec_no,CLEAR_HIGH);
00484             disp_one(recNo, DISP_HIGH);                 <span class="comment">// 2 means display record content only</span>
00485 
00486             rec_no = recNo;
00487             <span class="keywordflow">return</span> recNo;
00488         }
00489     }
00490 
00491     <span class="keywordflow">return</span> 0;
00492 }
00493 
00494 <span class="comment">//----------- End of function VBrowse98::detect_right -------//</span>
00495 
00496 <span class="comment">//-------- Begin of function VBrowse98::disp_all ----------//</span>
<a name="l00500"></a><a class="code" href="classVBrowse98.html#b1">00500</a> <span class="comment">void VBrowse98::disp_all() {</span>
00501     <span class="keywordtype">int</span> recNo;
00502 
00503     <span class="keywordtype">int</span> scrollRecno = (disp_frame &amp;&amp; x_max_rec==1) ? rec_no : top_rec_no;
00504 
00505     scroll_bar.refresh( scrollRecno, 1, disp_max_rec,
00506                         (disp_frame &amp;&amp; x_max_rec==1 ? 1 : disp_max_rec),
00507                         total_rec_num );
00508 
00509     <span class="keywordflow">for</span>( recNo=top_rec_no ; recNo&lt;=total_rec_num &amp;&amp; recNo&lt;top_rec_no+disp_max_rec ; recNo++ ) {
00510         disp_one( recNo, DISP_REC );
00511 
00512         <span class="keywordflow">if</span>( recNo == rec_no )
00513             disp_one( recNo, DISP_HIGH );
00514     }
00515 }
00516 
00517 <span class="comment">//--------- End of function VBrowse98::disp_all ----------//</span>
00518 
00519 <span class="comment">//-------- Begin of function VBrowse98::disp_one ----------//</span>
<a name="l00526"></a><a class="code" href="classVBrowse98.html#b2">00526</a> <span class="comment">void VBrowse98::disp_one(int recNo, int dispType) {</span>
00527     <span class="keywordflow">if</span>( none_record )
00528         <span class="keywordflow">return</span>;
00529 
00530     <span class="keywordtype">int</span> x,y;
00531 
00532     y = iy1 + (recNo-top_rec_no)/x_max_rec * (rec_height+rec_y_space);
00533     x = ix1 + (recNo-top_rec_no)%x_max_rec * (rec_width+rec_x_space);
00534 
00535     <span class="comment">//---- put a outline rect around the record if it is highlight ---//</span>
00536 
00537     <span class="keywordflow">if</span>( disp_frame &amp;&amp; dispType == CLEAR_HIGH ) {
00538         vga_back.rest_area_with_clipping(refresh_bitmap,
00539                                          x-2-x1,y-2-y1,x+rec_width-3-x1, y+rec_height+1-y1,
00540                                          0,1);
00541         disp_rec( recNo, x, y, <a class="code" href="Gamedef_8h.html#a71a16">INFO_REPAINT</a> );
00542         vga.blt_buf(x-2,y-2,x+rec_width-3,y+rec_height-1);
00543     }
00544 
00545     <span class="keywordflow">if</span>( dispType == DISP_REC ) {
00546         disp_rec( recNo, x, y, <a class="code" href="Gamedef_8h.html#a71a16">INFO_REPAINT</a> );        <span class="comment">// call user defined function</span>
00547         <span class="comment">// ##chwg0628</span>
00548         vga.blt_buf(x-2,y-2,x+rec_width-3,y+rec_height-1);
00549     }
00550     <span class="keywordflow">if</span>( disp_frame &amp;&amp; dispType == DISP_HIGH ) {
00551         vga_back.rest_area_with_clipping(refresh_bitmap,
00552                                          x-2-x1,y-2-y1,x+rec_width-3-x1, y+rec_height+1-y1,
00553                                          0,1);
00554         disp_rec( recNo, x, y, <a class="code" href="Gamedef_8h.html#a71a16">INFO_REPAINT</a> );
00555         user_interface.darken(x-2,y+rec_height-2,x+rec_width-7,y+rec_height-1);
00556         user_interface.darken(x+rec_width-9,y-2,x+rec_width-7,y+rec_height-3);
00557         user_interface.darken(x-2,y-2,x+rec_width-7,y+rec_height-1);
00558         vga.blt_buf(x-2,y-2,x+rec_width-7,y+rec_height-1);
00559 
00560         <span class="keywordtype">int</span> scrollRecno = (disp_frame &amp;&amp; x_max_rec==1) ? recNo : top_rec_no;
00561 
00562         scroll_bar.refresh( scrollRecno, 0, disp_max_rec,
00563                             (disp_frame &amp;&amp; x_max_rec==1 ? 1 : disp_max_rec),
00564                             total_rec_num );
00565     }
00566 }
00567 
00568 <span class="comment">//--------- End of function VBrowse98::disp_one ----------//</span>
00569 
00570 <span class="comment">//-------- Begin of function VBrowse98::disp_rec --------//</span>
<a name="l00572"></a><a class="code" href="classVBrowse98.html#b3">00572</a> <span class="comment">void VBrowse98::disp_rec(int recNo, int x, int y, int refreshFlag) {</span>
00573     vga.use_back();
00574     vga_back.rest_area_with_clipping(refresh_bitmap,
00575                                      0,y-y1,(rec_width-SCROLL_BAR_WIDTH+12),rec_height+y-y1,
00576                                      0,1);
00577     (*disp_rec_func)( recNo, x, y, refreshFlag );   <span class="comment">// call user defined function</span>
00578 }
00579 
00580 <span class="comment">//----------- End of function VBrowse98::disp_rec -----------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:32 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
