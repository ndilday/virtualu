<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OWORLD_M.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>OWORLD_M.CPP</h1><a href="OWORLD__M_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename   : OWORLD_M.CPP</span>
00002 <span class="comment">//Description: MapMatrix class</span>
00003 
00004 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00005 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00006 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00007 <span class="preprocessor">#include &lt;<a class="code" href="OWORLD_8H.html">OWORLD.H</a>&gt;</span>
00008 
00009 <span class="comment">//------------ Begin of function MapMatrix::draw_all ---------------//</span>
00010 
<a name="l00011"></a><a class="code" href="classMapMatrix.html#a0">00011</a> <span class="keywordtype">void</span> <a class="code" href="classMapMatrix.html#a0">MapMatrix::draw_all</a>() {
00012     <a class="code" href="classMatrix.html#a3">Matrix::draw_all</a>();
00013 
00014     draw_zoom_box(1);                               <span class="comment">// 1-use vga_back</span>
00015 }
00016 
00017 <span class="comment">//------------ End of function MapMatrix::draw_all ---------------//</span>
00018 
00019 <span class="comment">//------------ Begin of function MapMatrix::draw_update ---------------//</span>
00020 
<a name="l00021"></a><a class="code" href="classMapMatrix.html#a1">00021</a> <span class="keywordtype">void</span> <a class="code" href="classMapMatrix.html#a1">MapMatrix::draw_update</a>() {
00022 }
00023 
00024 <span class="comment">//-------------- End of function MapMatrix::draw_update --------------//</span>
00025 
00026 <span class="comment">//------------ Begin of function MapMatrix::draw_zoom_box ---------------//</span>
00027 
00028 <span class="keywordtype">void</span> MapMatrix::draw_zoom_box(<span class="keywordtype">int</span> useVgaBack) {
00029     <span class="keyword">static</span> <span class="keywordtype">short</span> colorIndex = 0;
00030     <span class="keyword">static</span> <span class="keywordtype">short</span> colorAdd = 1;
00031 
00032     <span class="keywordtype">int</span> boxX1, boxY1, boxX2, boxY2;
00033 
00034     <a class="code" href="classMatrix.html#a10">loc_to_abs_center_left</a>( boxX1, boxY1, world.active_zoom_matrix-&gt;top_x_loc,
00035                             world.active_zoom_matrix-&gt;top_y_loc );
00036 
00037     boxX1 = boxX1 - <a class="code" href="classMatrix.html#m7">abs_top_x</a> + <a class="code" href="Oworldmt_8h.html#a2">MAP_X1</a>;
00038     boxY1 = boxY1 - <a class="code" href="classMatrix.html#m8">abs_top_y</a> + <a class="code" href="Oworldmt_8h.html#a3">MAP_Y1</a>;
00039 
00040     boxX2 = boxX1 + (<a class="code" href="Oworldmt_8h.html#a16">ZOOM_WIDTH</a>  * <a class="code" href="classMatrix.html#m3">loc_width</a>  / world.active_zoom_matrix-&gt;loc_width) - 1;
00041     boxY2 = boxY1 + (<a class="code" href="Oworldmt_8h.html#a17">ZOOM_HEIGHT</a> * <a class="code" href="classMatrix.html#m4">loc_height</a> / world.active_zoom_matrix-&gt;loc_height) - 1;
00042 
00043     <span class="comment">//-----------------------------------------//</span>
00044 
00045     colorIndex += colorAdd;
00046 
00047     <span class="keywordflow">if</span>( colorIndex &gt;= 6 )
00048         colorAdd = -1;
00049 
00050     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( colorIndex &lt;= 0 )
00051         colorAdd = 1;
00052 
00053     colorIndex=0;                                   <span class="comment">//BUGHERE</span>
00054 
00055     <span class="keywordflow">if</span>( useVgaBack )
00056         vga_back.rect( boxX1, boxY1, boxX2, boxY2, 2, <a class="code" href="COLOR_8H.html#a18">V_ORANGE</a>+colorIndex);
00057     <span class="keywordflow">else</span>
00058         vga_front.rect( boxX1, boxY1, boxX2, boxY2, 2, <a class="code" href="COLOR_8H.html#a18">V_ORANGE</a>+colorIndex);
00059 }
00060 
00061 <span class="comment">//-------------- End of function MapMatrix::draw_zoom_box --------------//</span>
00062 
00063 <span class="comment">//------------ Begin of function MapMatrix::detect ---------------//</span>
00064 
<a name="l00065"></a><a class="code" href="classMapMatrix.html#a2">00065</a> <span class="keywordtype">int</span> <a class="code" href="classMapMatrix.html#a2">MapMatrix::detect</a>() {
00066     <span class="comment">//--- if press left button, select zoom area ----//</span>
00067 
00068     <span class="keyword">enum</span> {                                          <span class="comment">// effective when click on an outter area of the box</span>
00069         EFFECTIVE_BORDER = 15
00070     };
00071 
00072     <span class="keywordflow">if</span>(mouse.single_click(<a class="code" href="classMatrix.html#m11">win_x1</a>-EFFECTIVE_BORDER,<a class="code" href="classMatrix.html#m12">win_y1</a>-EFFECTIVE_BORDER,<a class="code" href="classMatrix.html#m13">win_x2</a>+EFFECTIVE_BORDER,<a class="code" href="classMatrix.html#m14">win_y2</a>+EFFECTIVE_BORDER, <a class="code" href="Omouse_8h.html#a28a22">LEFT_BUTTON</a>)) {
00073         <span class="comment">/*</span>
00074 <span class="comment">          int clickX = max(mouse.cur_x, win_x1);</span>
00075 <span class="comment">          clickX = min(mouse.cur_x, win_x2);</span>
00076 <span class="comment">          int clickY = max(mouse.cur_y, win_y1);</span>
00077 <span class="comment">          clickY = min(mouse.cur_y, win_y2);</span>
00078 <span class="comment">          //---- if the click position results in a zoom window that goes beyond the map, reposition it ----//</span>
00079 <span class="comment">          int zoomFrameWidth  = (ZOOM_WIDTH * loc_width / world.active_zoom_matrix-&gt;loc_width);</span>
00080 <span class="comment">          int zoomFrameHeight = (ZOOM_HEIGHT * loc_height / world.active_zoom_matrix-&gt;loc_height);</span>
00081 <span class="comment">          if( clickX + zoomFrameWidth - 1 &gt; win_x2 )</span>
00082 <span class="comment">          clickX = win_x2 - zoomFrameWidth + 1;</span>
00083 <span class="comment">          if( clickY + zoomFrameHeight - 1 &gt; win_y2 )</span>
00084 <span class="comment">          clickY = win_y2 - zoomFrameHeight + 1;</span>
00085 <span class="comment">          //----------------------------------------------//</span>
00086 <span class="comment">          int absX = abs_top_x + (clickX-win_x1);</span>
00087 <span class="comment">          int absY = abs_top_y + (clickY-win_y1);</span>
00088 <span class="comment">          //-------- convert to absolute positions -------//</span>
00089 <span class="comment">        */</span>
00090         <span class="keywordtype">int</span> zoomFrameWidth  = (<a class="code" href="Oworldmt_8h.html#a16">ZOOM_WIDTH</a> * <a class="code" href="classMatrix.html#m3">loc_width</a> / world.active_zoom_matrix-&gt;loc_width);
00091         <span class="keywordtype">int</span> zoomFrameHeight = (<a class="code" href="Oworldmt_8h.html#a17">ZOOM_HEIGHT</a> * <a class="code" href="classMatrix.html#m4">loc_height</a> / world.active_zoom_matrix-&gt;loc_height);
00092 
00093         <span class="keywordtype">int</span> absX = (mouse.cur_x-<a class="code" href="classMatrix.html#m11">win_x1</a>)-zoomFrameWidth/2;
00094         <span class="keywordtype">int</span> absY = (mouse.cur_y-<a class="code" href="classMatrix.html#m12">win_y1</a>)-zoomFrameHeight/2;
00095         absX=max(absX,1);
00096         absY=max(absY,1);
00097         absX=min(absX,<a class="code" href="classMatrix.html#m13">win_x2</a>-<a class="code" href="classMatrix.html#m11">win_x1</a>-zoomFrameWidth+1);
00098         absY=min(absY,<a class="code" href="classMatrix.html#m14">win_y2</a>-<a class="code" href="classMatrix.html#m12">win_y1</a>-zoomFrameHeight+1);
00099         absX+=<a class="code" href="classMatrix.html#m7">abs_top_x</a>;
00100         absY+=<a class="code" href="classMatrix.html#m8">abs_top_y</a>;
00101 
00102         <span class="keywordtype">int</span> locX, locY;
00103         <span class="keyword">static</span> <span class="keywordtype">int</span> old_locX=-1,old_locY=-1;
00104 
00105         <a class="code" href="classMatrix.html#a12">abs_to_loc</a>( locX, locY, absX, absY );
00106 
00107         <span class="keywordflow">if</span>(locX!=old_locX)
00108             <span class="keywordflow">if</span>(locY!=old_locY) {
00109                 <span class="comment">// chwg0401</span>
00110                 world.active_zoom_matrix-&gt;set_top_loc( locX, locY );
00111                 <span class="comment">// begin chwg0401</span>
00112                 <span class="comment">//                              if(world.zoom_level==1)</span>
00113                 <span class="comment">//                                      world.zoom2_matrix.set_top_loc( locX*ZOOM2_LOC_WIDTH/ZOOM1_LOC_WIDTH,</span>
00114                 <span class="comment">//                                                                                                      locY*ZOOM2_LOC_HEIGHT/ZOOM1_LOC_HEIGHT );</span>
00115                 <span class="comment">//                              else</span>
00116                 <span class="comment">//                                      world.zoom1_matrix.set_top_loc(  locX*ZOOM1_LOC_WIDTH/ZOOM2_LOC_WIDTH,</span>
00117                 <span class="comment">//                                                                                                      locY*ZOOM1_LOC_HEIGHT/ZOOM2_LOC_HEIGHT );</span>
00118                 <span class="comment">// end chwg0401</span>
00119             }
00120         old_locX=locX;
00121         old_locY=locY;
00122         <span class="comment">//              world.active_zoom_matrix-&gt;set_top_loc( locX, locY );</span>
00123         sys.redraw_zoom_flag = 1;
00124 
00125         <span class="keywordflow">return</span> 1;
00126     }
00127 
00128     <span class="keywordflow">if</span>( mouse.press_area(<a class="code" href="classMatrix.html#m11">win_x1</a>-EFFECTIVE_BORDER,<a class="code" href="classMatrix.html#m12">win_y1</a>-EFFECTIVE_BORDER,<a class="code" href="classMatrix.html#m13">win_x2</a>+EFFECTIVE_BORDER,<a class="code" href="classMatrix.html#m14">win_y2</a>+EFFECTIVE_BORDER, <a class="code" href="Omouse_8h.html#a28a22">LEFT_BUTTON</a> )) {
00129         <span class="keywordtype">int</span> zoomFrameWidth  = (<a class="code" href="Oworldmt_8h.html#a16">ZOOM_WIDTH</a> * <a class="code" href="classMatrix.html#m3">loc_width</a> / world.active_zoom_matrix-&gt;loc_width);
00130         <span class="keywordtype">int</span> zoomFrameHeight = (<a class="code" href="Oworldmt_8h.html#a17">ZOOM_HEIGHT</a> * <a class="code" href="classMatrix.html#m4">loc_height</a> / world.active_zoom_matrix-&gt;loc_height);
00131 
00132         <span class="keywordtype">int</span> absX = (mouse.cur_x-<a class="code" href="classMatrix.html#m11">win_x1</a>)-zoomFrameWidth/2;
00133         <span class="keywordtype">int</span> absY = (mouse.cur_y-<a class="code" href="classMatrix.html#m12">win_y1</a>)-zoomFrameHeight/2;
00134 
00135         absX=max(absX,1);
00136         absY=max(absY,1);
00137         absX=min(absX,<a class="code" href="classMatrix.html#m13">win_x2</a>-<a class="code" href="classMatrix.html#m11">win_x1</a>-zoomFrameWidth+1);
00138         absY=min(absY,<a class="code" href="classMatrix.html#m14">win_y2</a>-<a class="code" href="classMatrix.html#m12">win_y1</a>-zoomFrameHeight+1);
00139         absX+=<a class="code" href="classMatrix.html#m7">abs_top_x</a>;
00140         absY+=<a class="code" href="classMatrix.html#m8">abs_top_y</a>;
00141 
00142         <span class="comment">//-------- convert to absolute positions -------//</span>
00143 
00144         <span class="keywordtype">int</span> locX, locY;
00145         <span class="keyword">static</span> <span class="keywordtype">int</span> old_locX=-1,old_locY=-1;
00146 
00147         <a class="code" href="classMatrix.html#a12">abs_to_loc</a>( locX, locY, absX, absY );
00148 
00149         <span class="keywordflow">if</span>(locX!=old_locX)
00150             <span class="keywordflow">if</span>(locY!=old_locY) {
00151                 <span class="comment">// chwg0401</span>
00152                 world.active_zoom_matrix-&gt;set_top_loc( locX, locY );
00153                 <span class="comment">// begin chwg0401</span>
00154                 <span class="comment">//                              if(world.zoom_level==1)</span>
00155                 <span class="comment">//                                      world.zoom2_matrix.set_top_loc( locX*ZOOM2_LOC_WIDTH/ZOOM1_LOC_WIDTH,</span>
00156                 <span class="comment">//                                                                                                      locY*ZOOM2_LOC_HEIGHT/ZOOM1_LOC_HEIGHT );</span>
00157                 <span class="comment">//                              else</span>
00158                 <span class="comment">//                                      world.zoom1_matrix.set_top_loc(  locX*ZOOM1_LOC_WIDTH/ZOOM2_LOC_WIDTH,</span>
00159                 <span class="comment">//                                                                                                      locY*ZOOM1_LOC_HEIGHT/ZOOM2_LOC_HEIGHT );</span>
00160                 <span class="comment">// end chwg0401</span>
00161             }
00162         old_locX=locX;
00163         old_locY=locY;
00164 
00165         sys.redraw_zoom_flag = 1;
00166 
00167         <span class="keywordflow">return</span> 1;
00168     }
00169 
00170     <span class="keywordflow">return</span> 0;
00171 }
00172 
00173 <span class="comment">//-------------- End of function MapMatrix::detect ---------------//</span>
00174 
00175 <span class="comment">//------------ Begin of function MapMatrix::scroll ---------------//</span>
00176 
<a name="l00177"></a><a class="code" href="classMapMatrix.html#a3">00177</a> <span class="keywordtype">void</span> <a class="code" href="classMapMatrix.html#a3">MapMatrix::scroll</a>(<span class="keywordtype">int</span> scrollX, <span class="keywordtype">int</span> scrollY) {
00178     <span class="comment">//---- scroll the zoom view area as if scrolling the zoom box ----//</span>
00179 
00180     <span class="keywordtype">int</span> boxX1, boxY1;
00181 
00182     <a class="code" href="classMatrix.html#a10">loc_to_abs_center_left</a>( boxX1, boxY1, world.active_zoom_matrix-&gt;top_x_loc,
00183                             world.active_zoom_matrix-&gt;top_y_loc );
00184 
00185     boxX1 = boxX1 - <a class="code" href="classMatrix.html#m7">abs_top_x</a> + <a class="code" href="Oworldmt_8h.html#a2">MAP_X1</a>;
00186     boxY1 = boxY1 - <a class="code" href="classMatrix.html#m8">abs_top_y</a> + <a class="code" href="Oworldmt_8h.html#a3">MAP_Y1</a>;
00187 
00188     <span class="keywordtype">int</span> boxWidth  = (<a class="code" href="Oworldmt_8h.html#a16">ZOOM_WIDTH</a>  * <a class="code" href="classMatrix.html#m3">loc_width</a>  / world.active_zoom_matrix-&gt;loc_width);
00189     <span class="keywordtype">int</span> boxHeight = (<a class="code" href="Oworldmt_8h.html#a17">ZOOM_HEIGHT</a> * <a class="code" href="classMatrix.html#m4">loc_height</a> / world.active_zoom_matrix-&gt;loc_height);
00190 
00191     <span class="comment">//-------- scroll the box now --------//</span>
00192 
00193     boxX1 += scrollX * <a class="code" href="classMatrix.html#m3">loc_width</a>;
00194     boxY1 += scrollY * <a class="code" href="classMatrix.html#m4">loc_height</a>;
00195 
00196     <span class="keywordflow">if</span>( boxX1 &lt; <a class="code" href="Oworldmt_8h.html#a2">MAP_X1</a> )
00197         boxX1 = <a class="code" href="Oworldmt_8h.html#a2">MAP_X1</a>;
00198 
00199     <span class="keywordflow">if</span>( boxY1 &lt; <a class="code" href="Oworldmt_8h.html#a3">MAP_Y1</a> )
00200         boxY1 = <a class="code" href="Oworldmt_8h.html#a3">MAP_Y1</a>;
00201 
00202     <span class="keywordflow">if</span>( boxX1 + boxWidth - 1 &gt; <a class="code" href="Oworldmt_8h.html#a4">MAP_X2</a> )
00203         boxX1 = <a class="code" href="Oworldmt_8h.html#a4">MAP_X2</a> - boxWidth + 1;
00204 
00205     <span class="keywordflow">if</span>( boxY1 + boxHeight - 1 &gt; <a class="code" href="Oworldmt_8h.html#a5">MAP_Y2</a> )
00206         boxY1 = <a class="code" href="Oworldmt_8h.html#a5">MAP_Y2</a> - boxHeight + 1;
00207 
00208     <span class="comment">//------ set new top locations and redraw -----//</span>
00209 
00210     <span class="keywordtype">int</span> absX = boxX1 - <a class="code" href="Oworldmt_8h.html#a2">MAP_X1</a> + <a class="code" href="classMatrix.html#m7">abs_top_x</a>;
00211     <span class="keywordtype">int</span> absY = boxY1 - <a class="code" href="Oworldmt_8h.html#a3">MAP_Y1</a> + <a class="code" href="classMatrix.html#m8">abs_top_y</a>;
00212 
00213     <span class="keywordtype">int</span> locX, locY;
00214 
00215     <a class="code" href="classMatrix.html#a12">abs_to_loc</a>( locX, locY, absX, absY );
00216 
00217     world.active_zoom_matrix-&gt;set_top_loc( locX, locY );
00218 
00219     <span class="comment">// begin chwg0401</span>
00220     <span class="comment">//  if(world.zoom_level==1)</span>
00221     <span class="comment">//          world.zoom2_matrix.set_top_loc( locX*ZOOM2_LOC_WIDTH/ZOOM1_LOC_WIDTH,</span>
00222     <span class="comment">//                                                                                                  locY*ZOOM2_LOC_HEIGHT/ZOOM1_LOC_HEIGHT );</span>
00223     <span class="comment">//  else</span>
00224     <span class="comment">//          world.zoom1_matrix.set_top_loc(  locX*ZOOM1_LOC_WIDTH/ZOOM2_LOC_WIDTH,</span>
00225     <span class="comment">//                                                                                                  locY*ZOOM1_LOC_HEIGHT/ZOOM2_LOC_HEIGHT );</span>
00226     <span class="comment">// end chwg0401</span>
00227 
00228     sys.redraw_zoom_flag = 1;
00229 }
00230 
00231 <span class="comment">//-------------- End of function MapMatrix::scroll --------------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:36 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
