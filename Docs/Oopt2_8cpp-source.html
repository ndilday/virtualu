<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Oopt2.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Oopt2.cpp</h1><a href="Oopt2_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OOPT2.CPP</span>
00002 <span class="comment">//Description : Optimization class - stage 2</span>
00003 
00004 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00005 <span class="preprocessor">#include &lt;<a class="code" href="OGAMESET_8H.html">OGAMESET.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;OWORLDMT.H&gt;</span>
00007 <span class="preprocessor">#include &lt;<a class="code" href="OBNDSLDR_8H.html">OBNDSLDR.H</a>&gt;</span>
00008 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;<a class="code" href="COLOR_8H.html">COLOR.H</a>&gt;</span>
00010 <span class="preprocessor">#include &lt;OFINANCE.H&gt;</span>
00011 <span class="preprocessor">#include &lt;OFONT.H&gt;</span>
00012 <span class="preprocessor">#include &lt;OGAMESTR.H&gt;</span>
00013 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00014 <span class="preprocessor">#include &lt;OOPT.H&gt;</span>
00015 <span class="preprocessor">#include &lt;OBUTTON.H&gt;</span>
00016 <span class="preprocessor">#include &lt;OIFACE.H&gt;</span>
00017 <span class="preprocessor">#include &lt;<a class="code" href="OIMGRES_8H.html">OIMGRES.H</a>&gt;</span>
00018 <span class="preprocessor">#include &lt;<a class="code" href="OTEXT_8H.html">OTEXT.H</a>&gt;</span>
00019 <span class="preprocessor">#include &lt;<a class="code" href="OHELPIF_8H.html">OHELPIF.H</a>&gt;</span>
00020 <span class="preprocessor">#include &lt;<a class="code" href="OHELP_8H.html">OHELP.H</a>&gt;</span>
00021 <span class="preprocessor">#include &lt;OAUDIO.H&gt;</span>
00022 <span class="preprocessor">#include &lt;OCONFIG.H&gt;</span>
00023 <span class="preprocessor">#include &lt;OCHANCE.H&gt;</span>
00024 
00025 <span class="comment">//------- Define constants -------//</span>
00026 
00027 <span class="keyword">enum</span> {
00028     <a class="code" href="Oopt2_8cpp.html#a31a5">REPORT_X1</a> = <a class="code" href="Oworldmt_8h.html#a12">ZOOM_X1</a> + 15,
00029     <a class="code" href="Oopt2_8cpp.html#a31a6">REPORT_Y1</a> = <a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a> + 25,
00030     <a class="code" href="Oopt2_8cpp.html#a31a7">REPORT_X2</a> = <a class="code" href="Oworldmt_8h.html#a14">ZOOM_X2</a> - 15,
00031     <a class="code" href="Oopt2_8cpp.html#a31a8">REPORT_Y2</a> = <a class="code" href="Oworldmt_8h.html#a15">ZOOM_Y2</a> - 60
00032 };
00033 
00034 <span class="keyword">enum</span> {
00035     <a class="code" href="Oopt2_8cpp.html#a32a9">SEPARATOR_1</a> = <a class="code" href="Oopt2_8cpp.html#a31a5">REPORT_X1</a> + 300,
00036     <a class="code" href="Oopt2_8cpp.html#a32a10">SEPARATOR_2</a> = <a class="code" href="Oopt2_8cpp.html#a31a5">REPORT_X1</a> + 500,
00037     <a class="code" href="Oopt2_8cpp.html#a32a11">SEPARATOR_3</a> = <a class="code" href="Oopt2_8cpp.html#a31a5">REPORT_X1</a> + 620
00038 };
00039 
00040 <span class="keyword">enum</span> {
00041     <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> = 25,
00042     <a class="code" href="Oopt2_8cpp.html#a33a13">HEADING_HEIGHT</a> = 30,
00043     <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> = <a class="code" href="Oopt2_8cpp.html#a31a6">REPORT_Y1</a> + <a class="code" href="Oopt2_8cpp.html#a33a13">HEADING_HEIGHT</a> + 20,
00044     <a class="code" href="Oopt2_8cpp.html#a33a15">DESCRIPTION_OFFSET</a> = <a class="code" href="Oopt2_8cpp.html#a31a5">REPORT_X1</a> + 30,
00045     <a class="code" href="Oopt2_8cpp.html#a33a16">SLIDER_OFFSET</a> = 1,
00046     <a class="code" href="Oopt2_8cpp.html#a33a17">DESCRIPTION_INDENT</a> = 20,
00047     <a class="code" href="Oopt2_8cpp.html#a33a18">TARGET_OFFSET</a> = <a class="code" href="Oopt2_8cpp.html#a32a9">SEPARATOR_1</a> + 15,
00048     <a class="code" href="Oopt2_8cpp.html#a33a19">TARGET_WIDTH</a> = <a class="code" href="Oopt2_8cpp.html#a32a10">SEPARATOR_2</a> - <a class="code" href="Oopt2_8cpp.html#a32a9">SEPARATOR_1</a> - 30,
00049     <a class="code" href="Oopt2_8cpp.html#a33a20">TARGET_HEIGHT</a> = 10,
00050     <a class="code" href="Oopt2_8cpp.html#a33a21">PREF_BUTTON_WIDTH</a> = 16,
00051     <a class="code" href="Oopt2_8cpp.html#a33a22">PREF_BUTTON_HEIGHT</a> = 16,
00052     <a class="code" href="Oopt2_8cpp.html#a33a23">PREF_BUTTON_DISTANCE</a> = 10,
00053     <a class="code" href="Oopt2_8cpp.html#a33a24">PREF_BUTTON_OFFSET</a> = 0,
00054     <a class="code" href="Oopt2_8cpp.html#a33a25">PREF_BUTTON_OFFSET1</a> = <a class="code" href="Oopt2_8cpp.html#a32a10">SEPARATOR_2</a> + 15,
00055     <a class="code" href="Oopt2_8cpp.html#a33a26">PREF_BUTTON_OFFSET2</a> = <a class="code" href="Oopt2_8cpp.html#a33a25">PREF_BUTTON_OFFSET1</a> + <a class="code" href="Oopt2_8cpp.html#a33a21">PREF_BUTTON_WIDTH</a> + <a class="code" href="Oopt2_8cpp.html#a33a23">PREF_BUTTON_DISTANCE</a>,
00056     <a class="code" href="Oopt2_8cpp.html#a33a27">PREF_BUTTON_OFFSET3</a> = <a class="code" href="Oopt2_8cpp.html#a33a26">PREF_BUTTON_OFFSET2</a> + <a class="code" href="Oopt2_8cpp.html#a33a21">PREF_BUTTON_WIDTH</a> + <a class="code" href="Oopt2_8cpp.html#a33a23">PREF_BUTTON_DISTANCE</a>,
00057     <a class="code" href="Oopt2_8cpp.html#a33a28">PREF_BUTTON_OFFSET4</a> = <a class="code" href="Oopt2_8cpp.html#a33a27">PREF_BUTTON_OFFSET3</a> + <a class="code" href="Oopt2_8cpp.html#a33a21">PREF_BUTTON_WIDTH</a> + <a class="code" href="Oopt2_8cpp.html#a33a23">PREF_BUTTON_DISTANCE</a>,
00058     <a class="code" href="Oopt2_8cpp.html#a33a29">RESULT_OFFSET</a> = <a class="code" href="Oopt2_8cpp.html#a32a11">SEPARATOR_3</a> + 20,
00059     <a class="code" href="Oopt2_8cpp.html#a33a30">RESULT_LENGTH</a> = 50
00060 };
00061 
00062 <span class="comment">//-------- define static vars -----------//</span>
00063 
00064 <span class="keyword">static</span> <a class="code" href="classText.html">Text</a> result_text[<a class="code" href="Ofinance_8h.html#a111a75">COST_RISE_POLICY_COUNT</a>];
00065 <span class="keyword">static</span> <a class="code" href="classButton.html">Button</a> help_button_array[<a class="code" href="Ofinance_8h.html#a111a75">COST_RISE_POLICY_COUNT</a>];
00066 
00067 <span class="keyword">static</span> <span class="keywordtype">char</span> *title[] = {
00068     <span class="stringliteral">"Description"</span>,
00069     <span class="stringliteral">"Target"</span>,
00070     <span class="stringliteral">"      Preference"</span>,
00071     <span class="stringliteral">"Result"</span>
00072 };
00073 
00074 <span class="keyword">static</span> <span class="keywordtype">char</span> *heading = <span class="stringliteral">"Allocation of net budget change"</span>;
00075 
00076 <span class="keyword">static</span> <span class="keywordtype">char</span> *pref_label[] = {
00077     <span class="stringliteral">"1"</span>, <span class="stringliteral">"2"</span>, <span class="stringliteral">"3"</span>, <span class="stringliteral">"R"</span>
00078 };
00079 
00080 <span class="comment">//------- Begin of function Optimization::init_stage_2 -----------//</span>
00082 <span class="comment">void Optimization::init_stage_2() {</span>
00083     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="Ofinance_8h.html#a111a75">COST_RISE_POLICY_COUNT</a>; i++) {
00084         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="Oopt_8h.html#a3a1">PREF_COUNT</a>; j++) {
00085             opt2_button_group_up_bitmap[i * <a class="code" href="Oopt_8h.html#a3a1">PREF_COUNT</a> + j] = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00086             opt2_button_group_down_bitmap[i * <a class="code" href="Oopt_8h.html#a3a1">PREF_COUNT</a> + j] = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00087         }
00088     }
00089 }
00090 
00091 <span class="comment">//--------- End of function Optimization::init_stage_2 -----------//</span>
00092 
00093 <span class="comment">//------- Begin of function Optimization::deinit_stage_2 ---------//</span>
00095 <span class="comment">void Optimization::deinit_stage_2() {</span>
00096     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="Ofinance_8h.html#a111a75">COST_RISE_POLICY_COUNT</a>; i++) {
00097         <span class="keyword">delete</span> opt2_button_group_array[i];
00098 
00099         <span class="keywordflow">if</span>(opt2_button_group_array[i]) {
00100             opt2_button_group_array[i]=<a class="code" href="OHELP_8H.html#a0">NULL</a>;
00101         }
00102 
00103         opt2_slider_group[i].deinit();
00104 
00105         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="Oopt_8h.html#a3a1">PREF_COUNT</a>; j++) {
00106             <span class="keywordflow">if</span>(opt2_button_group_up_bitmap[i * <a class="code" href="Oopt_8h.html#a3a1">PREF_COUNT</a> + j]) {
00107                 <a class="code" href="ALL_8H.html#a8">mem_del</a>(opt2_button_group_up_bitmap[i * <a class="code" href="Oopt_8h.html#a3a1">PREF_COUNT</a> + j]);
00108                 opt2_button_group_up_bitmap[i * <a class="code" href="Oopt_8h.html#a3a1">PREF_COUNT</a> + j] = (<span class="keywordtype">short</span>*)<a class="code" href="OHELP_8H.html#a0">NULL</a>;
00109             }
00110             <span class="keywordflow">if</span>(opt2_button_group_down_bitmap[i * <a class="code" href="Oopt_8h.html#a3a1">PREF_COUNT</a> + j]) {
00111                 <a class="code" href="ALL_8H.html#a8">mem_del</a>(opt2_button_group_down_bitmap[i * <a class="code" href="Oopt_8h.html#a3a1">PREF_COUNT</a> + j]);
00112                 opt2_button_group_down_bitmap[i * <a class="code" href="Oopt_8h.html#a3a1">PREF_COUNT</a> + j] = (<span class="keywordtype">short</span>*)<a class="code" href="OHELP_8H.html#a0">NULL</a>;
00113             }
00114         }
00115 
00116         <span class="comment">//              opt2_button_group_array[i]-&gt;button_pressed=2;</span>
00117         result_text[i].<a class="code" href="classText.html#a26">deinit</a>();
00118         <span class="comment">// ##### begin Gilbert 28/04/2001 ######//</span>
00119         help_button_array[i].<a class="code" href="classButton.html#a2">deinit</a>();
00120         <span class="comment">// ##### end Gilbert 28/04/2001 ######//</span>
00121     }
00122     stage_init_flag = 0;
00123 }
00124 
00125 <span class="comment">//--------- End of function Optimization::deinit_stage_2 -------//</span>
00126 
00127 <span class="comment">//------- Begin of function Optimization::report_stage_2 -------//</span>
<a name="l00129"></a><a class="code" href="classOptimization.html#a8">00129</a> <span class="comment">void Optimization::report_stage_2(int refreshFlag) {</span>
00130     <span class="keywordflow">if</span> (refreshFlag == <a class="code" href="Gamedef_8h.html#a71a16">INFO_REPAINT</a> || refresh_optimization_screen ) {
00131         user_interface.brighten(<a class="code" href="Oopt2_8cpp.html#a31a5">REPORT_X1</a>+100, <a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a>, <a class="code" href="Oopt2_8cpp.html#a31a7">REPORT_X2</a>-100, <a class="code" href="Oopt2_8cpp.html#a31a6">REPORT_Y1</a>);
00132         user_interface.brighten(<a class="code" href="Oopt2_8cpp.html#a31a5">REPORT_X1</a>+4, <a class="code" href="Oopt2_8cpp.html#a31a6">REPORT_Y1</a>+4, <a class="code" href="Oopt2_8cpp.html#a31a7">REPORT_X2</a>-2, <a class="code" href="Oopt2_8cpp.html#a31a8">REPORT_Y2</a>-2);
00133         user_interface.rect(<a class="code" href="Oopt2_8cpp.html#a31a5">REPORT_X1</a>+100, <a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a>, <a class="code" href="Oopt2_8cpp.html#a31a7">REPORT_X2</a>-100, <a class="code" href="Oopt2_8cpp.html#a31a6">REPORT_Y1</a>);
00134         <span class="comment">//              font_charts.center_put( REPORT_X1, ZOOM_Y1, REPORT_X2, REPORT_Y1, "Stage 2 : Expenditure by Function" );</span>
00135         font_charts.center_put( <a class="code" href="Oopt2_8cpp.html#a31a5">REPORT_X1</a>, <a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a>, <a class="code" href="Oopt2_8cpp.html#a31a7">REPORT_X2</a>, <a class="code" href="Oopt2_8cpp.html#a31a6">REPORT_Y1</a>, <span class="stringliteral">"Budget Allocations"</span> );
00136 
00137         <span class="comment">// current stage not init'ed</span>
00138         <span class="keywordflow">if</span> (stage_init_flag != 2 || refresh_optimization_screen ) {
00139             deinit();
00140             <a class="code" href="classButtonGroup.html">ButtonGroup</a> *buttonGroupPtr;
00141             <span class="keywordtype">double</span> *targetValue, *lowerBound, *upperBound, *importWeight, lowerLimit, upperLimit;
00142             <span class="keywordtype">int</span> pressedButton;
00143 
00144             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="Ofinance_8h.html#a111a75">COST_RISE_POLICY_COUNT</a>; i++) {
00145                 opt2_button_group_array[i] = <span class="keyword">new</span> <a class="code" href="classButtonGroup.html">ButtonGroup</a>(<a class="code" href="Oopt_8h.html#a3a1">PREF_COUNT</a>);
00146 
00147                 <span class="comment">//##### begin fred 980904#####//</span>
00148                 targetValue = &amp;(finance.cost_rise_policy_array[i].target_value);
00149                 lowerBound = &amp;(finance.cost_rise_policy_array[i].lower_bound);
00150                 upperBound = &amp;(finance.cost_rise_policy_array[i].upper_bound);
00151                 importWeight = &amp;(finance.cost_rise_policy_array[i].import_weight);
00152                 lowerLimit = (finance.cost_rise_policy_array[i].lower_limit);
00153                 upperLimit = (finance.cost_rise_policy_array[i].upper_limit);
00154 
00155                 <span class="comment">//################begin chwg0930 BUGHERE ####################/</span>
00156                 <span class="keywordflow">if</span>(i==9)
00157                     importWeight = &amp;(finance.cost_rise_policy_array[8].import_weight);
00158 
00159                 <span class="comment">//                              opt2_slider_group[i].init(</span>
00160                 <span class="comment">//                                      TARGET_OFFSET, SLIDER_OFFSET + FIRST_LINE_OFFSET + LINE_SPACING * (i + 1),</span>
00161                 <span class="comment">//                                      TARGET_WIDTH, TARGET_HEIGHT, targetValue, lowerBound, upperBound, *targetValue-(*targetValue-*lowerBound)*2, *targetValue+(*upperBound-*targetValue)*2);</span>
00162                 opt2_slider_group[i].init(
00163                     <a class="code" href="Oopt2_8cpp.html#a33a18">TARGET_OFFSET</a>, <a class="code" href="Oopt2_8cpp.html#a33a16">SLIDER_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i + 1),
00164                     <a class="code" href="Oopt2_8cpp.html#a33a19">TARGET_WIDTH</a>, <a class="code" href="Oopt2_8cpp.html#a33a20">TARGET_HEIGHT</a>, targetValue, lowerBound, upperBound, lowerLimit, upperLimit,
00165                     1,<a class="code" href="COLOR_8H.html#a25">V_YELLOW</a>,<a class="code" href="COLOR_8H.html#a20">V_GREEN</a>,24);                 <span class="comment">//## chea 110899 change by b.massy add 24(1dec)</span>
00166                 <span class="comment">//##### end fred 980904#####//</span>
00167 
00168                 user_interface.create_button_bitmap(<a class="code" href="Oopt2_8cpp.html#a33a25">PREF_BUTTON_OFFSET1</a>-2,
00169                                                     <a class="code" href="Oopt2_8cpp.html#a33a24">PREF_BUTTON_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i + 1)-2,
00170                                                     <a class="code" href="Oopt2_8cpp.html#a33a25">PREF_BUTTON_OFFSET1</a> + <a class="code" href="Oopt2_8cpp.html#a33a21">PREF_BUTTON_WIDTH</a>,
00171                                                     <a class="code" href="Oopt2_8cpp.html#a33a24">PREF_BUTTON_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i + 1) + <a class="code" href="Oopt2_8cpp.html#a33a22">PREF_BUTTON_HEIGHT</a>,
00172                                                     pref_label[0], &amp;opt2_button_group_up_bitmap[<a class="code" href="Oopt_8h.html#a3a1">PREF_COUNT</a> * i], &amp;opt2_button_group_down_bitmap[<a class="code" href="Oopt_8h.html#a3a1">PREF_COUNT</a> * i], &amp;vga_back);
00173                 user_interface.create_button_bitmap(<a class="code" href="Oopt2_8cpp.html#a33a26">PREF_BUTTON_OFFSET2</a>-2,
00174                                                     <a class="code" href="Oopt2_8cpp.html#a33a24">PREF_BUTTON_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i + 1)-2,
00175                                                     <a class="code" href="Oopt2_8cpp.html#a33a26">PREF_BUTTON_OFFSET2</a> + <a class="code" href="Oopt2_8cpp.html#a33a21">PREF_BUTTON_WIDTH</a>,
00176                                                     <a class="code" href="Oopt2_8cpp.html#a33a24">PREF_BUTTON_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i + 1) + <a class="code" href="Oopt2_8cpp.html#a33a22">PREF_BUTTON_HEIGHT</a>,
00177                                                     pref_label[1], &amp;opt2_button_group_up_bitmap[<a class="code" href="Oopt_8h.html#a3a1">PREF_COUNT</a> * i + 1], &amp;opt2_button_group_down_bitmap[<a class="code" href="Oopt_8h.html#a3a1">PREF_COUNT</a> * i + 1], &amp;vga_back);
00178                 user_interface.create_button_bitmap(<a class="code" href="Oopt2_8cpp.html#a33a27">PREF_BUTTON_OFFSET3</a>-2,
00179                                                     <a class="code" href="Oopt2_8cpp.html#a33a24">PREF_BUTTON_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i + 1)-2,
00180                                                     <a class="code" href="Oopt2_8cpp.html#a33a27">PREF_BUTTON_OFFSET3</a> + <a class="code" href="Oopt2_8cpp.html#a33a21">PREF_BUTTON_WIDTH</a>,
00181                                                     <a class="code" href="Oopt2_8cpp.html#a33a24">PREF_BUTTON_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i + 1) + <a class="code" href="Oopt2_8cpp.html#a33a22">PREF_BUTTON_HEIGHT</a>,
00182                                                     pref_label[2], &amp;opt2_button_group_up_bitmap[<a class="code" href="Oopt_8h.html#a3a1">PREF_COUNT</a> * i + 2], &amp;opt2_button_group_down_bitmap[<a class="code" href="Oopt_8h.html#a3a1">PREF_COUNT</a> * i + 2], &amp;vga_back);
00183                 user_interface.create_button_bitmap(<a class="code" href="Oopt2_8cpp.html#a33a28">PREF_BUTTON_OFFSET4</a>-2,
00184                                                     <a class="code" href="Oopt2_8cpp.html#a33a24">PREF_BUTTON_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i + 1)-2,
00185                                                     <a class="code" href="Oopt2_8cpp.html#a33a28">PREF_BUTTON_OFFSET4</a> + <a class="code" href="Oopt2_8cpp.html#a33a21">PREF_BUTTON_WIDTH</a>,
00186                                                     <a class="code" href="Oopt2_8cpp.html#a33a24">PREF_BUTTON_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i + 1) + <a class="code" href="Oopt2_8cpp.html#a33a22">PREF_BUTTON_HEIGHT</a>,
00187                                                     pref_label[3], &amp;opt2_button_group_up_bitmap[<a class="code" href="Oopt_8h.html#a3a1">PREF_COUNT</a> * i + 3], &amp;opt2_button_group_down_bitmap[<a class="code" href="Oopt_8h.html#a3a1">PREF_COUNT</a> * i + 3], &amp;vga_back);
00188                 buttonGroupPtr = opt2_button_group_array[i];
00189 
00190                 <span class="comment">//                              pressedButton = int(*importWeight * 2.0) - 1;</span>
00191                 <span class="keywordflow">if</span>(*importWeight==<a class="code" href="Ofinanc2_8h.html#a0">OPT_LOW_WEIGHT</a>)
00192                     pressedButton =0;
00193                 <span class="keywordflow">if</span>(*importWeight==<a class="code" href="Ofinanc2_8h.html#a1">OPT_MID_WEIGHT</a>)
00194                     pressedButton =1;
00195                 <span class="keywordflow">if</span>(*importWeight==<a class="code" href="Ofinanc2_8h.html#a2">OPT_HIGH_WEIGHT</a>)
00196                     pressedButton =2;
00197 
00198                 <span class="keywordflow">if</span>(finance.cost_rise_policy_array[i].required_flag) {
00199                     opt2_slider_group[i].enable_flag=0;
00200                     pressedButton = 3;
00201                 }
00202                 <span class="comment">//                              else</span>
00203                 <span class="comment">//                              {</span>
00204                 <span class="comment">//                                      if(opt2_button_group_array[i]-&gt;button_pressed==3)</span>
00205                 <span class="comment">//                                              pressedButton = 1;</span>
00206                 <span class="comment">//                                      opt2_slider_group[i].enable_flag=1;</span>
00207                 <span class="comment">//                              }</span>
00208 
00209                 <span class="comment">//## chea captial campaign 230699</span>
00210                 <span class="keywordflow">if</span>(chance_event.capital_campaign_end_year&gt;info.game_year) {
00211                     <span class="comment">// disable</span>
00212                     opt2_slider_group[<a class="code" href="Ofinance_8h.html#a112a82">PL_INST_ADVANCEMENT</a>].enable_flag=0;
00213                     pressedButton = 3;
00214                 }
00215                 <span class="comment">//## chea captial campaign 230699</span>
00216 
00217                 (*buttonGroupPtr)[0].create_bitmapW(
00218                     <a class="code" href="Oopt2_8cpp.html#a33a25">PREF_BUTTON_OFFSET1</a>-2,
00219                     <a class="code" href="Oopt2_8cpp.html#a33a24">PREF_BUTTON_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i + 1)-2,
00220                     <a class="code" href="Oopt2_8cpp.html#a33a25">PREF_BUTTON_OFFSET1</a> + <a class="code" href="Oopt2_8cpp.html#a33a21">PREF_BUTTON_WIDTH</a>,
00221                     <a class="code" href="Oopt2_8cpp.html#a33a24">PREF_BUTTON_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i + 1) + <a class="code" href="Oopt2_8cpp.html#a33a22">PREF_BUTTON_HEIGHT</a>,
00222                     ((pressedButton == 0) ? opt2_button_group_down_bitmap[<a class="code" href="Oopt_8h.html#a3a1">PREF_COUNT</a> * i] : opt2_button_group_up_bitmap[<a class="code" href="Oopt_8h.html#a3a1">PREF_COUNT</a> * i]) + 4);
00223                 (*buttonGroupPtr)[1].create_bitmapW(
00224                     <a class="code" href="Oopt2_8cpp.html#a33a26">PREF_BUTTON_OFFSET2</a>-2,
00225                     <a class="code" href="Oopt2_8cpp.html#a33a24">PREF_BUTTON_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i + 1)-2,
00226                     <a class="code" href="Oopt2_8cpp.html#a33a26">PREF_BUTTON_OFFSET2</a> + <a class="code" href="Oopt2_8cpp.html#a33a21">PREF_BUTTON_WIDTH</a>,
00227                     <a class="code" href="Oopt2_8cpp.html#a33a24">PREF_BUTTON_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i + 1) + <a class="code" href="Oopt2_8cpp.html#a33a22">PREF_BUTTON_HEIGHT</a>,
00228                     ((pressedButton == 1) ? opt2_button_group_down_bitmap[<a class="code" href="Oopt_8h.html#a3a1">PREF_COUNT</a> * i + 1] : opt2_button_group_up_bitmap[<a class="code" href="Oopt_8h.html#a3a1">PREF_COUNT</a> * i + 1]) + 4);
00229                 (*buttonGroupPtr)[2].create_bitmapW(
00230                     <a class="code" href="Oopt2_8cpp.html#a33a27">PREF_BUTTON_OFFSET3</a>-2,
00231                     <a class="code" href="Oopt2_8cpp.html#a33a24">PREF_BUTTON_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i + 1)-2,
00232                     <a class="code" href="Oopt2_8cpp.html#a33a27">PREF_BUTTON_OFFSET3</a> + <a class="code" href="Oopt2_8cpp.html#a33a21">PREF_BUTTON_WIDTH</a>,
00233                     <a class="code" href="Oopt2_8cpp.html#a33a24">PREF_BUTTON_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i + 1) + <a class="code" href="Oopt2_8cpp.html#a33a22">PREF_BUTTON_HEIGHT</a>,
00234                     ((pressedButton == 2) ? opt2_button_group_down_bitmap[<a class="code" href="Oopt_8h.html#a3a1">PREF_COUNT</a> * i + 2] : opt2_button_group_up_bitmap[<a class="code" href="Oopt_8h.html#a3a1">PREF_COUNT</a> * i + 2]) + 4);
00235                 (*buttonGroupPtr)[3].create_bitmapW(
00236                     <a class="code" href="Oopt2_8cpp.html#a33a28">PREF_BUTTON_OFFSET4</a>-2,
00237                     <a class="code" href="Oopt2_8cpp.html#a33a24">PREF_BUTTON_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i + 1)-2,
00238                     <a class="code" href="Oopt2_8cpp.html#a33a28">PREF_BUTTON_OFFSET4</a> + <a class="code" href="Oopt2_8cpp.html#a33a21">PREF_BUTTON_WIDTH</a>,
00239                     <a class="code" href="Oopt2_8cpp.html#a33a24">PREF_BUTTON_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i + 1) + <a class="code" href="Oopt2_8cpp.html#a33a22">PREF_BUTTON_HEIGHT</a>,
00240                     ((pressedButton == 3) ? opt2_button_group_down_bitmap[<a class="code" href="Oopt_8h.html#a3a1">PREF_COUNT</a> * i + 3] : opt2_button_group_up_bitmap[<a class="code" href="Oopt_8h.html#a3a1">PREF_COUNT</a> * i + 3]) + 4);
00241 
00242                 buttonGroupPtr-&gt;<a class="code" href="classButtonGroup.html#m1">button_pressed</a> = pressedButton;
00243 
00244                 <span class="keywordflow">if</span>(user_interface.backgd_flag==1)
00245                     help_button_array[i].<a class="code" href="classButton.html#a10">create_text</a>(<a class="code" href="Oopt2_8cpp.html#a31a5">REPORT_X1</a>+10,
00246                                                      <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i+1),
00247                                                      <a class="code" href="Oopt2_8cpp.html#a31a5">REPORT_X1</a>+28,
00248                                                      <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i+1)+18,
00249                                                      <span class="stringliteral">"?"</span>);
00250             }
00251 
00252             stage_init_flag = 2;
00253         }
00254 
00255         user_interface.h_line(<a class="code" href="Oopt2_8cpp.html#a31a5">REPORT_X1</a>, <a class="code" href="Oopt2_8cpp.html#a31a6">REPORT_Y1</a>+<a class="code" href="Oopt2_8cpp.html#a33a13">HEADING_HEIGHT</a>, <a class="code" href="Oopt2_8cpp.html#a31a7">REPORT_X2</a>-<a class="code" href="Oopt2_8cpp.html#a31a5">REPORT_X1</a>);
00256         user_interface.v_line(<a class="code" href="Oopt2_8cpp.html#a32a9">SEPARATOR_1</a>-1, <a class="code" href="Oopt2_8cpp.html#a31a6">REPORT_Y1</a>+1, <a class="code" href="Oopt2_8cpp.html#a31a8">REPORT_Y2</a>-<a class="code" href="Oopt2_8cpp.html#a31a6">REPORT_Y1</a>-2);
00257         user_interface.v_line(<a class="code" href="Oopt2_8cpp.html#a32a10">SEPARATOR_2</a>-1, <a class="code" href="Oopt2_8cpp.html#a31a6">REPORT_Y1</a>+1, <a class="code" href="Oopt2_8cpp.html#a31a8">REPORT_Y2</a>-<a class="code" href="Oopt2_8cpp.html#a31a6">REPORT_Y1</a>-2);
00258         user_interface.v_line(<a class="code" href="Oopt2_8cpp.html#a32a11">SEPARATOR_3</a>-1, <a class="code" href="Oopt2_8cpp.html#a31a6">REPORT_Y1</a>+1, <a class="code" href="Oopt2_8cpp.html#a31a8">REPORT_Y2</a>-<a class="code" href="Oopt2_8cpp.html#a31a6">REPORT_Y1</a>-2);
00259         user_interface.rect(<a class="code" href="Oopt2_8cpp.html#a31a5">REPORT_X1</a>, <a class="code" href="Oopt2_8cpp.html#a31a6">REPORT_Y1</a>, <a class="code" href="Oopt2_8cpp.html#a31a7">REPORT_X2</a>, <a class="code" href="Oopt2_8cpp.html#a31a8">REPORT_Y2</a>, 2);
00260 
00261         font_chartsm.center_put( <a class="code" href="Oopt2_8cpp.html#a31a5">REPORT_X1</a>+1, <a class="code" href="Oopt2_8cpp.html#a31a6">REPORT_Y1</a>+1,
00262                                  <a class="code" href="Oopt2_8cpp.html#a32a9">SEPARATOR_1</a>-1, <a class="code" href="Oopt2_8cpp.html#a31a6">REPORT_Y1</a>+1+<a class="code" href="Oopt2_8cpp.html#a33a13">HEADING_HEIGHT</a>, title[0] );
00263         font_chartsm.center_put( <a class="code" href="Oopt2_8cpp.html#a32a9">SEPARATOR_1</a>+1, <a class="code" href="Oopt2_8cpp.html#a31a6">REPORT_Y1</a>+1,
00264                                  <a class="code" href="Oopt2_8cpp.html#a32a10">SEPARATOR_2</a>-1, <a class="code" href="Oopt2_8cpp.html#a31a6">REPORT_Y1</a>+1+<a class="code" href="Oopt2_8cpp.html#a33a13">HEADING_HEIGHT</a>, title[1] );
00265         font_chartsm.center_put( <a class="code" href="Oopt2_8cpp.html#a32a10">SEPARATOR_2</a>+1, <a class="code" href="Oopt2_8cpp.html#a31a6">REPORT_Y1</a>+1,
00266                                  <a class="code" href="Oopt2_8cpp.html#a32a11">SEPARATOR_3</a>-1, <a class="code" href="Oopt2_8cpp.html#a31a6">REPORT_Y1</a>+1+<a class="code" href="Oopt2_8cpp.html#a33a13">HEADING_HEIGHT</a>, title[2] );
00267         font_chartsm.center_put( <a class="code" href="Oopt2_8cpp.html#a32a11">SEPARATOR_3</a>+1, <a class="code" href="Oopt2_8cpp.html#a31a6">REPORT_Y1</a>+1,
00268                                  <a class="code" href="Oopt2_8cpp.html#a31a7">REPORT_X2</a>-1, <a class="code" href="Oopt2_8cpp.html#a31a6">REPORT_Y1</a>+1+<a class="code" href="Oopt2_8cpp.html#a33a13">HEADING_HEIGHT</a>, title[3] );
00269 
00270         <span class="keywordflow">if</span>(user_interface.backgd_flag==1)
00271             image_interface.put_back(<a class="code" href="Oopt2_8cpp.html#a32a10">SEPARATOR_2</a>+9,<a class="code" href="Oopt2_8cpp.html#a31a6">REPORT_Y1</a>+7,<span class="stringliteral">"QUEST_UP"</span>);
00272 
00273         font_chartsm.put( <a class="code" href="Oopt2_8cpp.html#a33a15">DESCRIPTION_OFFSET</a>, <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a>, heading);
00274 
00275         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="Ofinance_8h.html#a111a75">COST_RISE_POLICY_COUNT</a>; i++) {
00276             font_chartsm.put(
00277                 <a class="code" href="Oopt2_8cpp.html#a33a15">DESCRIPTION_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a17">DESCRIPTION_INDENT</a>,
00278                 <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i + 1),
00279                 game_str_res.opt_stage2_str(i) );
00280 
00281             <span class="keywordflow">if</span>(user_interface.backgd_flag==1)
00282                 image_interface.put_back(<a class="code" href="Oopt2_8cpp.html#a31a5">REPORT_X1</a>+10,
00283                                          <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i+1),<span class="stringliteral">"QUEST_UP"</span>);
00284             opt2_slider_group[i].paint();
00285 
00286             opt2_button_group_array[i]-&gt;paint(opt2_button_group_array[i]-&gt;button_pressed);
00287 
00288             opt2_slider_group[i].result_flag=optimization.is_optimized[1];
00289             opt2_slider_group[i].result_value = finance.cost_rise_policy_array[i].result_value;
00290             <span class="comment">//                  opt2_slider_group[i].result_value=(double)((int)(opt2_slider_group[i].result_value*100.0)/100);</span>
00291             result_text[i].<a class="code" href="classText.html#a2">init</a>(
00292                 <a class="code" href="Oopt2_8cpp.html#a33a29">RESULT_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a30">RESULT_LENGTH</a>-50,
00293                 <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i + 1),
00294                 &amp;(opt2_slider_group[i].result_value),24); <span class="comment">//## chea 110899 change by b.massy add 24(1dec)</span>
00295         }
00296 
00297         refresh_optimization_screen = 0;
00298     }
00299     <span class="keywordflow">else</span> {                                          <span class="comment">// refreshFlag == INFO_REFRESH</span>
00300         vga.use_back();
00301         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="Ofinance_8h.html#a111a75">COST_RISE_POLICY_COUNT</a>; i++) {
00302             opt2_slider_group[i].result_flag=optimization.is_optimized[1]; {
00303 
00304                 <span class="comment">//                      if(optimization.is_optimized[1]==1)</span>
00305                 opt2_slider_group[i].result_value = finance.cost_rise_policy_array[i].result_value;
00306 
00307                 <span class="comment">// chwg0513</span>
00308                 <span class="keywordflow">if</span>(finance.cost_rise_policy_array[i].required_flag) {
00309                     opt2_slider_group[i].enable_flag=0;
00310                     opt2_button_group_array[i]-&gt;push(3);
00311                     <span class="keywordtype">double</span> *importWeight = &amp;(finance.cost_rise_policy_array[i].import_weight);
00312                     *importWeight = <a class="code" href="Ofinanc2_8h.html#a1">OPT_MID_WEIGHT</a>;
00313                 }
00314                 <span class="comment">//## chea 031299 11.2.3 to make the opt bar enable again this is when a bar is locked use in report and will release here</span>
00315                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(finance.cost_rise_policy_array[i].required_flag == 0 &amp;&amp; opt2_slider_group[i].enable_flag ==0) {
00316                     opt2_slider_group[i].enable_flag=1;
00317                     opt2_button_group_array[i]-&gt;push(1);
00318                     <span class="keywordtype">double</span> *importWeight = &amp;(finance.cost_rise_policy_array[i].import_weight);
00319                     *importWeight = <a class="code" href="Ofinanc2_8h.html#a1">OPT_MID_WEIGHT</a>;
00320                 }
00321 
00322                 <span class="comment">//                              else</span>
00323                 <span class="comment">//                              {</span>
00324                 <span class="comment">//                                      if(opt2_button_group_array[i]-&gt;button_pressed==3)</span>
00325                 <span class="comment">//                                                      opt2_button_group_array[i]-&gt;push(1);</span>
00326                 <span class="comment">//                                              opt2_slider_group[i].enable_flag=1;</span>
00327                 <span class="comment">//                              }</span>
00328 
00329                 <span class="comment">//                              short bltX, bltY, bltHeight;</span>
00330                 <span class="comment">//                              user_interface.v_line(</span>
00331                 <span class="comment">//                                      bltX = opt2_slider_group-&gt;bounded_slider_x1 + 4 + short(double(opt2_slider_group-&gt;bar_width) * (resultValue - opt2_slider_group[i].min_val) / (opt2_slider_group[i].max_val - opt2_slider_group[i].min_val)),</span>
00332                 <span class="comment">//                                      bltY = opt2_slider_group[i].bounded_slider_y1 - 2, bltHeight = opt2_slider_group[i].bounded_slider_y2 - opt2_slider_group[i].bounded_slider_y1 + 6, 1, V_RED);</span>
00333                 <span class="comment">//                              vga.blt_buf(bltX, bltY, bltX+1, bltY+bltHeight);</span>
00334 
00335                 <span class="comment">//                              vga.use_front();</span>
00336                 <span class="comment">//                              font_chartsm.right_put(</span>
00337                 <span class="comment">//                                      RESULT_OFFSET + RESULT_LENGTH,</span>
00338                 <span class="comment">//                                      FIRST_LINE_OFFSET + LINE_SPACING * (i + 1),</span>
00339                 <span class="comment">//                                      m.format(resultValue) );</span>
00340                 result_text[i].<a class="code" href="classText.html#a24">paint</a>();
00341                 vga.blt_buf(
00342                     <a class="code" href="Oopt2_8cpp.html#a33a29">RESULT_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a30">RESULT_LENGTH</a>-50,
00343                     <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i + 1),
00344                     <a class="code" href="Oopt2_8cpp.html#a33a29">RESULT_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a30">RESULT_LENGTH</a>,
00345                     <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i + 1) + 16
00346                     );
00347                 <span class="comment">//</span>
00348             }
00349             opt2_slider_group[i].refresh();
00350         }
00351     }
00352 }
00353 
00354 <span class="comment">//---------- End of function Optimization::report_stage_2 -----//</span>
00355 
00356 <span class="comment">//-------- Begin of function Optimization::detect_stage_2 -----//</span>
<a name="l00358"></a><a class="code" href="classOptimization.html#a11">00358</a> <span class="comment">int Optimization::detect_stage_2() {</span>
00359     <span class="keywordflow">if</span> (stage_init_flag != 2)
00360         <span class="keywordflow">return</span> 0;
00361 
00362     help.set_help(<a class="code" href="Oopt2_8cpp.html#a33a18">TARGET_OFFSET</a>, <a class="code" href="Oopt2_8cpp.html#a33a16">SLIDER_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a>,
00363                   <a class="code" href="Oopt2_8cpp.html#a33a18">TARGET_OFFSET</a>+<a class="code" href="Oopt2_8cpp.html#a33a19">TARGET_WIDTH</a>,<a class="code" href="Oopt2_8cpp.html#a31a8">REPORT_Y2</a>-20,<span class="stringliteral">"H8.1.1."</span>);
00364     help.set_help(<a class="code" href="Oopt2_8cpp.html#a33a18">TARGET_OFFSET</a>, <a class="code" href="Oopt2_8cpp.html#a33a16">SLIDER_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a>,
00365                   <a class="code" href="Oopt2_8cpp.html#a33a18">TARGET_OFFSET</a>+30,<a class="code" href="Oopt2_8cpp.html#a31a8">REPORT_Y2</a>-20,<span class="stringliteral">"H8.1.2."</span>);
00366     help.set_help(<a class="code" href="Oopt2_8cpp.html#a33a18">TARGET_OFFSET</a>+<a class="code" href="Oopt2_8cpp.html#a33a19">TARGET_WIDTH</a>-30, <a class="code" href="Oopt2_8cpp.html#a33a16">SLIDER_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a>,
00367                   <a class="code" href="Oopt2_8cpp.html#a33a18">TARGET_OFFSET</a>+<a class="code" href="Oopt2_8cpp.html#a33a19">TARGET_WIDTH</a>,<a class="code" href="Oopt2_8cpp.html#a31a8">REPORT_Y2</a>-20,<span class="stringliteral">"H8.1.3."</span>);
00368     help.set_help(  <a class="code" href="Oopt2_8cpp.html#a32a10">SEPARATOR_2</a>, <a class="code" href="Oopt2_8cpp.html#a33a16">SLIDER_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a>,
00369                     <a class="code" href="Oopt2_8cpp.html#a32a11">SEPARATOR_3</a>,<a class="code" href="Oopt2_8cpp.html#a31a8">REPORT_Y2</a>-20,<span class="stringliteral">"H8.1.4."</span>);
00370 
00371     <span class="keywordtype">int</span> i, j;
00372 
00373     vga.use_back();
00374 
00375     <span class="comment">//  if((sys.view_mode!=MODE_YEAR_END_REPORT)</span>
00376     <span class="comment">//          || optimization.is_optimized[1]==1)</span>
00377     <span class="keywordflow">if</span> (mouse.in_area( <a class="code" href="Oopt2_8cpp.html#a32a9">SEPARATOR_1</a>, <a class="code" href="Oopt2_8cpp.html#a31a6">REPORT_Y1</a>+1+<a class="code" href="Oopt2_8cpp.html#a33a13">HEADING_HEIGHT</a>,
00378                        <a class="code" href="Oopt2_8cpp.html#a32a10">SEPARATOR_2</a>, <a class="code" href="Oopt2_8cpp.html#a31a8">REPORT_Y2</a> )) {
00379         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="Ofinance_8h.html#a111a75">COST_RISE_POLICY_COUNT</a>; i++)
00380             <span class="keywordflow">if</span>(!finance.cost_rise_policy_array[i].required_flag)
00381                 <span class="keywordflow">if</span> (opt2_slider_group[i].detect()) {
00382                     optimization.is_optimize_slider_modified[1]=0;
00383                     <span class="keywordflow">return</span> 1;
00384                 }
00385     }
00386 
00387     <span class="keywordflow">if</span> (mouse.single_click(<a class="code" href="Oopt2_8cpp.html#a32a10">SEPARATOR_2</a>+9,<a class="code" href="Oopt2_8cpp.html#a31a6">REPORT_Y1</a>+7,<a class="code" href="Oopt2_8cpp.html#a32a10">SEPARATOR_2</a>+27,<a class="code" href="Oopt2_8cpp.html#a31a6">REPORT_Y1</a>+25)) {
00388         <a class="code" href="classString.html">String</a> str;
00389         str  = <a class="code" href="Gamedef_8h.html#a4">DIR_RES</a>;
00390         str += <span class="stringliteral">"SCORE"</span>;
00391 
00392         <a class="code" href="classResTxt.html">ResTxt</a> rs;
00393         rs.<a class="code" href="classResTxt.html#a2">init</a>(str);
00394         image_interface.put_back(<a class="code" href="Oopt2_8cpp.html#a32a10">SEPARATOR_2</a>+9,<a class="code" href="Oopt2_8cpp.html#a31a6">REPORT_Y1</a>+7,<span class="stringliteral">"QUEST_DN"</span>);
00395         vga.blt_buf(<a class="code" href="Oopt2_8cpp.html#a32a10">SEPARATOR_2</a>+9,<a class="code" href="Oopt2_8cpp.html#a31a6">REPORT_Y1</a>+7,<a class="code" href="Oopt2_8cpp.html#a32a10">SEPARATOR_2</a>+27,<a class="code" href="Oopt2_8cpp.html#a31a6">REPORT_Y1</a>+25);
00396         sys.back_view_mode=sys.view_mode;
00397         help_if.help_textlist.topic_id=rs.<a class="code" href="classResTxt.html#a7">locate_topic</a>(<span class="stringliteral">"Preference"</span>);
00398         <span class="keywordflow">if</span>(help_if.help_textlist.topic_id&gt;0) {
00399             help_if.help_textlist.add_history(help_if.help_textlist.topic_id);
00400             sys.set_view_mode(<a class="code" href="Osys_8h.html#a45a31">MODE_HELP_DESC</a>);
00401             sys.redraw_all_flag = 1;
00402             audio.play_wav(<span class="stringliteral">"BEEPS-1"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00403         }
00404         <span class="keywordflow">return</span> 1;
00405     }
00406 
00407     vga.use_front();
00408 
00409     <span class="comment">// Unlock line if the state is IMPLEMENT</span>
00410     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="Ofinance_8h.html#a111a75">COST_RISE_POLICY_COUNT</a>; i++)
00411         <span class="keywordflow">if</span> (mouse.single_click(
00412             <a class="code" href="Oopt2_8cpp.html#a33a28">PREF_BUTTON_OFFSET4</a>-2,
00413             <a class="code" href="Oopt2_8cpp.html#a33a24">PREF_BUTTON_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i + 1)-2,
00414             <a class="code" href="Oopt2_8cpp.html#a33a28">PREF_BUTTON_OFFSET4</a> + <a class="code" href="Oopt2_8cpp.html#a33a21">PREF_BUTTON_WIDTH</a>,
00415             <a class="code" href="Oopt2_8cpp.html#a33a24">PREF_BUTTON_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i + 1) + <a class="code" href="Oopt2_8cpp.html#a33a22">PREF_BUTTON_HEIGHT</a>)) {
00416             <span class="keywordflow">if</span>(finance.cost_rise_policy_array[i].applied_flag!=<a class="code" href="Ofinanc2_8h.html#a38a8">P_IMPLEMENT</a>)
00417                 <span class="keywordflow">if</span>(finance.cost_rise_policy_array[i].required_flag) {
00418                     finance.cost_rise_policy_array[i].required_flag=0;
00419                     opt2_slider_group[i].enable_flag=1;
00420                     opt2_slider_group[i].refresh();
00421 
00422                     <span class="comment">//## chea 090699</span>
00423                     finance.cost_rise_policy_array[i].reset_constraint_policy();
00424                     <span class="comment">//## chea 090699</span>
00425 
00426                     opt2_button_group_array[i]-&gt;push(1);
00427 
00428                     <span class="comment">//## chea 041099 try to release the opt button</span>
00429                     optimization.is_optimize_slider_modified[1]=0;
00430 
00431                     <span class="keywordtype">double</span> *importWeight = &amp;(finance.cost_rise_policy_array[i].import_weight);
00432                     *importWeight = <a class="code" href="Ofinanc2_8h.html#a1">OPT_MID_WEIGHT</a>;
00433                     sys.redraw_all_flag=1;
00434                     <span class="keywordflow">return</span> 1;
00435                 }
00436 
00437         }
00438 
00439     <span class="keywordflow">if</span> (mouse.single_click( <a class="code" href="Oopt2_8cpp.html#a32a10">SEPARATOR_2</a>, <a class="code" href="Oopt2_8cpp.html#a31a6">REPORT_Y1</a>+1+<a class="code" href="Oopt2_8cpp.html#a33a13">HEADING_HEIGHT</a>,
00440                             <a class="code" href="Oopt2_8cpp.html#a32a11">SEPARATOR_3</a>, <a class="code" href="Oopt2_8cpp.html#a31a8">REPORT_Y2</a> )) {
00441         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="Ofinance_8h.html#a111a75">COST_RISE_POLICY_COUNT</a>; i++) {
00442 
00443             <span class="keywordflow">if</span>(!finance.cost_rise_policy_array[i].required_flag)
00444                 <span class="keywordflow">if</span>  ( (j = opt2_button_group_array[i]-&gt;detect()) &gt;= 0) {
00445 
00446                     <span class="comment">//## chea 041099 try to release the opt button</span>
00447                     optimization.is_optimize_slider_modified[1]=0;
00448 
00449                     <span class="comment">// Lock the line when 'r' is pressed</span>
00450                     <span class="keywordflow">if</span>(j==3) {                                <span class="comment">// addif to reset the bounds</span>
00451                         finance.cost_rise_policy_array[i].required_flag=1;
00452                         opt2_slider_group[i].enable_flag=0;
00453                         opt2_slider_group[i].refresh();
00454 
00455                         finance.cost_rise_policy_array[i].set_constraint_policy();
00456 
00457                         sys.redraw_all_flag=1;
00458                     }
00459 
00460                     <a class="code" href="classButtonGroup.html">ButtonGroup</a> *buttonGroupPtr = opt2_button_group_array[i];
00461                     vga.use_back();
00462                     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; <a class="code" href="Oopt_8h.html#a3a1">PREF_COUNT</a>; k++) {
00463                         (*buttonGroupPtr)[k].body_ptr =
00464                             (<span class="keywordtype">void</span> *) ((k==j)?(opt2_button_group_down_bitmap[i*<a class="code" href="Oopt_8h.html#a3a1">PREF_COUNT</a>+k] + 4):(opt2_button_group_up_bitmap[i*<a class="code" href="Oopt_8h.html#a3a1">PREF_COUNT</a>+k] + 4));
00465                     }
00466                     buttonGroupPtr-&gt;<a class="code" href="classButtonGroup.html#a3">paint</a>(buttonGroupPtr-&gt;<a class="code" href="classButtonGroup.html#m1">button_pressed</a>);
00467 
00468                     vga.blt_buf(<a class="code" href="Oopt2_8cpp.html#a33a25">PREF_BUTTON_OFFSET1</a>, <a class="code" href="Oopt2_8cpp.html#a33a24">PREF_BUTTON_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i + 1), <a class="code" href="Oopt2_8cpp.html#a33a25">PREF_BUTTON_OFFSET1</a> + <a class="code" href="Oopt2_8cpp.html#a33a21">PREF_BUTTON_WIDTH</a>, <a class="code" href="Oopt2_8cpp.html#a33a24">PREF_BUTTON_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i + 1) + <a class="code" href="Oopt2_8cpp.html#a33a22">PREF_BUTTON_HEIGHT</a>);
00469                     vga.blt_buf(<a class="code" href="Oopt2_8cpp.html#a33a26">PREF_BUTTON_OFFSET2</a>, <a class="code" href="Oopt2_8cpp.html#a33a24">PREF_BUTTON_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i + 1), <a class="code" href="Oopt2_8cpp.html#a33a26">PREF_BUTTON_OFFSET2</a> + <a class="code" href="Oopt2_8cpp.html#a33a21">PREF_BUTTON_WIDTH</a>, <a class="code" href="Oopt2_8cpp.html#a33a24">PREF_BUTTON_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i + 1) + <a class="code" href="Oopt2_8cpp.html#a33a22">PREF_BUTTON_HEIGHT</a>);
00470                     vga.blt_buf(<a class="code" href="Oopt2_8cpp.html#a33a27">PREF_BUTTON_OFFSET3</a>, <a class="code" href="Oopt2_8cpp.html#a33a24">PREF_BUTTON_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i + 1), <a class="code" href="Oopt2_8cpp.html#a33a27">PREF_BUTTON_OFFSET3</a> + <a class="code" href="Oopt2_8cpp.html#a33a21">PREF_BUTTON_WIDTH</a>, <a class="code" href="Oopt2_8cpp.html#a33a24">PREF_BUTTON_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i + 1) + <a class="code" href="Oopt2_8cpp.html#a33a22">PREF_BUTTON_HEIGHT</a>);
00471                     vga.blt_buf(<a class="code" href="Oopt2_8cpp.html#a33a28">PREF_BUTTON_OFFSET4</a>, <a class="code" href="Oopt2_8cpp.html#a33a24">PREF_BUTTON_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i + 1), <a class="code" href="Oopt2_8cpp.html#a33a28">PREF_BUTTON_OFFSET4</a> + <a class="code" href="Oopt2_8cpp.html#a33a21">PREF_BUTTON_WIDTH</a>, <a class="code" href="Oopt2_8cpp.html#a33a24">PREF_BUTTON_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i + 1) + <a class="code" href="Oopt2_8cpp.html#a33a22">PREF_BUTTON_HEIGHT</a>);
00472 
00473                     <span class="keywordtype">double</span> *importWeight = &amp;(finance.cost_rise_policy_array[i].import_weight);
00474 
00475                     <span class="keywordflow">if</span>(j==0)
00476                         *importWeight = <a class="code" href="Ofinanc2_8h.html#a0">OPT_LOW_WEIGHT</a>;
00477                     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(j==1)
00478                         *importWeight = <a class="code" href="Ofinanc2_8h.html#a1">OPT_MID_WEIGHT</a>;
00479                     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(j==2)
00480                         *importWeight = <a class="code" href="Ofinanc2_8h.html#a2">OPT_HIGH_WEIGHT</a>;
00481 
00482                     <span class="comment">//                                  *importWeight = double(j + 1) / 2.0;</span>
00483                     <span class="keywordflow">return</span> 1;
00484                 }
00485         }
00486     }
00487 
00488     vga.use_back();
00489 
00490     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="Ofinance_8h.html#a111a75">COST_RISE_POLICY_COUNT</a>; i++)
00491         <span class="keywordflow">if</span>(help_button_array[i].<a class="code" href="classButton.html#a21">detect</a>()) {
00492             <a class="code" href="classString.html">String</a> str;
00493             str  = <a class="code" href="Gamedef_8h.html#a4">DIR_RES</a>;
00494             str += <span class="stringliteral">"SCORE"</span>;
00495 
00496             <a class="code" href="classResTxt.html">ResTxt</a> rs;
00497             rs.<a class="code" href="classResTxt.html#a2">init</a>(str);
00498 
00499             <span class="comment">// ## chwg1203</span>
00500             image_interface.put_back(<a class="code" href="Oopt2_8cpp.html#a31a5">REPORT_X1</a>+10,
00501                                      <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i+1),<span class="stringliteral">"QUEST_DN"</span>);
00502             vga.blt_buf(
00503                 <a class="code" href="Oopt2_8cpp.html#a31a5">REPORT_X1</a>+10,
00504                 <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i+1),
00505                 <a class="code" href="Oopt2_8cpp.html#a31a5">REPORT_X1</a>+30,
00506                 <a class="code" href="Oopt2_8cpp.html#a33a14">FIRST_LINE_OFFSET</a> + <a class="code" href="Oopt2_8cpp.html#a33a12">LINE_SPACING</a> * (i+1) + 20);
00507 
00508             sys.back_view_mode=sys.view_mode;
00509             help_if.help_textlist.topic_id=rs.<a class="code" href="classResTxt.html#a7">locate_topic</a>(game_str_res.opt_stage2_str(i));
00510             <span class="keywordflow">if</span>(help_if.help_textlist.topic_id&gt;0) {
00511                 help_if.help_textlist.add_history(help_if.help_textlist.topic_id);
00512                 sys.set_view_mode(<a class="code" href="Osys_8h.html#a45a31">MODE_HELP_DESC</a>);
00513                 sys.redraw_all_flag = 1;
00514                 audio.play_wav(<span class="stringliteral">"BEEPS-1"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00515             }
00516             <span class="keywordflow">return</span> 1;
00517         }
00518 
00519     <span class="keywordflow">return</span> 0;
00520 }
00521 
00522 <span class="comment">//---------- End of function Optimization::detect_stage_2 -----//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:09 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
