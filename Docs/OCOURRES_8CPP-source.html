<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OCOURRES.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>OCOURRES.CPP</h1><a href="OCOURRES_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OCOURRES.CPP</span>
00002 <span class="comment">//Description : course Resource object</span>
00003 <span class="comment">//Owner                 : Fred</span>
00004 
00005 <span class="comment">// see req29b and HE.gdb.init.xls:course_template</span>
00006 
00007 <span class="preprocessor">#include &lt;<a class="code" href="OGAMESET_8H.html">OGAMESET.H</a>&gt;</span>
00008 <span class="preprocessor">#include &lt;<a class="code" href="OCOURRES_8H.html">OCOURRES.H</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;OCourse.H&gt;</span>
00010 <span class="comment">//#include &lt;ODept.H&gt;</span>
00011 <span class="preprocessor">#include &lt;ODeptres.H&gt;</span>
00012 
00013 <span class="comment">//---------- #define constant ------------//</span>
00014 
<a name="l00015"></a><a class="code" href="OCOURRES_8CPP.html#a0">00015</a> <span class="preprocessor">#define COURSE_TEMPLATE_DB    "COU_TMPL"</span>
<a name="l00016"></a><a class="code" href="OCOURRES_8CPP.html#a1">00016</a> <span class="preprocessor"></span><span class="preprocessor">#define SUMMER_COURSE_DB    "SUMMER"</span>
00017 <span class="preprocessor"></span>
00018 <span class="comment">//---------- Begin of function CourseRes::init -----------//</span>
<a name="l00022"></a><a class="code" href="classCourseRes.html#a0">00022</a> <span class="comment">void CourseRes::init() {</span>
00023     deinit();
00024 
00025     <span class="comment">//------- load database information --------//</span>
00026 
00027     memset( <span class="keyword">this</span>, 0, <span class="keyword">sizeof</span>(<a class="code" href="classCourseRes.html">CourseRes</a>) );
00028 
00029     load_template();
00030     load_summer_db();
00031 
00032     init_flag=1;
00033 }
00034 
00035 <span class="comment">//---------- End of function CourseRes::init -----------//</span>
00036 
00037 <span class="comment">//---------- Begin of function CourseRes::deinit -----------//</span>
00038 
<a name="l00039"></a><a class="code" href="classCourseRes.html#a1">00039</a> <span class="keywordtype">void</span> <a class="code" href="classCourseRes.html#a1">CourseRes::deinit</a>() {
00040     <span class="keywordflow">if</span>( init_flag ) {
00041         <span class="keywordflow">if</span>( <a class="code" href="classCourseRes.html#m2">course_template_count</a> &gt; 0 )
00042             free_template();
00043 
00044         <a class="code" href="classCourseRes.html#m0">init_flag</a>=0;
00045     }
00046 }
00047 
00048 <span class="comment">//---------- End of function CourseRes::deinit -----------//</span>
00049 
00050 <span class="comment">//------- Begin of function CourseRes::load_template -------//</span>
00052 <span class="comment"></span>
<a name="l00053"></a><a class="code" href="classCourseRes.html#a6">00053</a> <span class="keywordtype">void</span> <a class="code" href="classCourseRes.html#a6">CourseRes::change_course_templ_code</a>(<span class="keywordtype">char</span>* code) {
00054     <span class="keywordflow">switch</span> (code[0]) {
00055     <span class="keywordflow">case</span> <span class="charliteral">'A'</span>:
00056         code[0] = <span class="charliteral">'A'</span>;
00057         <span class="keywordflow">break</span>;
00058     <span class="keywordflow">case</span> <span class="charliteral">'B'</span>:
00059         code[0] = <span class="charliteral">'B'</span>;
00060         <span class="keywordflow">break</span>;
00061     <span class="keywordflow">case</span> <span class="charliteral">'E'</span>:
00062         code[0] = <span class="charliteral">'C'</span>;
00063         <span class="keywordflow">break</span>;
00064     <span class="keywordflow">case</span> <span class="charliteral">'F'</span>:
00065         code[0] = <span class="charliteral">'D'</span>;
00066         <span class="keywordflow">break</span>;
00067     <span class="keywordflow">case</span> <span class="charliteral">'H'</span>:
00068         code[0] = <span class="charliteral">'E'</span>;
00069         <span class="keywordflow">break</span>;
00070     <span class="keywordflow">case</span> <span class="charliteral">'S'</span>:
00071         <span class="keywordflow">if</span> ( code[1] == <span class="charliteral">'C'</span> )
00072             code[0] = <span class="charliteral">'F'</span>;
00073         <span class="keywordflow">else</span>
00074             code[0] = <span class="charliteral">'H'</span>;
00075         <span class="keywordflow">break</span>;
00076     <span class="keywordflow">case</span> <span class="charliteral">'M'</span>:
00077         code[0] = <span class="charliteral">'G'</span>;
00078         <span class="keywordflow">break</span>;
00079     <span class="keywordflow">default</span>:
00080         <a class="code" href="ALL_8H.html#a1">err_here</a>();
00081         <span class="keywordflow">break</span>;
00082     }
00083 
00084     code[1] = <span class="charliteral">'\0'</span>;
00085 }
00086 
00087 <span class="keywordtype">void</span> CourseRes::load_template() {
00088     <span class="comment">//course_template_count = 1;</span>
00089 
00090     <a class="code" href="structCourseTemplateRec.html">CourseTemplateRec</a>   *templRec;
00091     <a class="code" href="structCourseTemplate.html">CourseTemplate</a>      *templPtr;
00092     <a class="code" href="classDatabase.html">Database</a>        *dbTemplate = game_set.open_db(<a class="code" href="OCOURRES_8CPP.html#a0">COURSE_TEMPLATE_DB</a>);
00093 
00094     <a class="code" href="classCourseRes.html#m2">course_template_count</a> = (short) dbTemplate-&gt;<a class="code" href="classDatabase.html#a7">rec_count</a>();
00095 
00096     <a class="code" href="ALL_8H.html#a0">err_when</a>( <a class="code" href="classCourseRes.html#m3">course_template_array</a> );              <span class="comment">// to prevent double allocations</span>
00097     <a class="code" href="ALL_8H.html#a0">err_when</a>( <a class="code" href="classCourseRes.html#m2">course_template_count</a>%3 != 0 || <a class="code" href="classCourseRes.html#m2">course_template_count</a> == 0);
00098 
00099     <a class="code" href="classCourseRes.html#m2">course_template_count</a> /= 3;                     <span class="comment">// 3 = COURSE_PREFERENCE_COUNT</span>
00100 
00101     <a class="code" href="classCourseRes.html#m3">course_template_array</a> = (<a class="code" href="structCourseTemplate.html">CourseTemplate</a>*) <a class="code" href="ALL_8H.html#a5">mem_add</a>( <span class="keyword">sizeof</span>(<a class="code" href="structCourseTemplate.html">CourseTemplate</a>)*<a class="code" href="classCourseRes.html#m2">course_template_count</a> );
00102 
00103     <span class="comment">//------ read in course information array -------//</span>
00104 
00105     memset( <a class="code" href="classCourseRes.html#m3">course_template_array</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="structCourseTemplate.html">CourseTemplate</a>) * <a class="code" href="classCourseRes.html#m2">course_template_count</a> );
00106 
00107     templPtr = <a class="code" href="classCourseRes.html#m3">course_template_array</a>;
00108 
00109     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0, type=0 ; i&lt;<a class="code" href="classCourseRes.html#m2">course_template_count</a>*3 ;) {
00110         templRec  = (<a class="code" href="structCourseTemplateRec.html">CourseTemplateRec</a>*) dbTemplate-&gt;<a class="code" href="classDatabase.html#a4">read</a>(i+1);
00111 
00112         <a class="code" href="classCourseRes.html#a6">change_course_templ_code</a>(templRec-&gt;<a class="code" href="structCourseTemplateRec.html#m0">template_code</a>);
00113         templPtr-&gt;<a class="code" href="structCourseTemplate.html#m0">template_code</a> = templRec-&gt;<a class="code" href="structCourseTemplateRec.html#m0">template_code</a>[0];
00114 
00115         templPtr-&gt;<a class="code" href="structCourseTemplate.html#m1">target_preference</a>[type] = char(100 * m.atof( templRec-&gt;<a class="code" href="structCourseTemplateRec.html#m1">target_preference</a>, 9 ));
00116         templPtr-&gt;<a class="code" href="structCourseTemplate.html#m2">normal_class_size</a>[type] = m.atoi( templRec-&gt;<a class="code" href="structCourseTemplateRec.html#m2">normal_class_size</a>, 9 );
00117 
00118         type = (type+1)%3;
00119 
00120         <span class="keywordflow">if</span> ( ++i%3 == 0 )
00121             templPtr++;
00122 
00123         <span class="comment">//----------//</span>
00124         <span class="comment">/*</span>
00125 <span class="comment">          templatePtr-&gt;target_preference[P_SEMINAR] = 11;       // 99-&gt;99%</span>
00126 <span class="comment">          templatePtr-&gt;target_preference[P_CLASS_WITH_BREAKOUTS] = 27;</span>
00127 <span class="comment">          templatePtr-&gt;target_preference[P_OTHER] = 62;</span>
00128 <span class="comment"></span>
00129 <span class="comment">          //short       normal_class_size= (float) m.atof(templateRec-&gt;rank_age_multiplier, 9);</span>
00130 <span class="comment">          templatePtr-&gt;normal_class_size[P_SEMINAR] = 12;</span>
00131 <span class="comment">          templatePtr-&gt;normal_class_size[P_CLASS_WITH_BREAKOUTS] = 19;</span>
00132 <span class="comment">          templatePtr-&gt;normal_class_size[P_OTHER] = 20;</span>
00133 <span class="comment">        */</span>
00134     }
00135 
00136     <span class="keywordflow">for</span>( i=0; i&lt;<a class="code" href="classCourseRes.html#m2">course_template_count</a>; i++) {
00137         templPtr = <a class="code" href="classCourseRes.html#m3">course_template_array</a> + i;
00138 
00139         <span class="keywordtype">int</span> tmp = templPtr-&gt;<a class="code" href="structCourseTemplate.html#m1">target_preference</a>[0] + templPtr-&gt;<a class="code" href="structCourseTemplate.html#m1">target_preference</a>[1];
00140 
00141         templPtr-&gt;<a class="code" href="structCourseTemplate.html#m1">target_preference</a>[2] = 100 - tmp;
00142     }
00143 }
00144 
00145 <span class="comment">//--------- End of function CourseRes::load_template ---------//</span>
00146 
00147 <span class="comment">//------- Begin of function CourseRes::free_template -------//</span>
00149 <span class="comment">void CourseRes::free_template() {</span>
00150     <a class="code" href="ALL_8H.html#a0">err_when</a>( course_template_count == 0 );
00151 
00152     <a class="code" href="ALL_8H.html#a8">mem_del</a>(course_template_array);
00153     course_template_count = 0;
00154 }
00155 
00156 <span class="comment">//--------- End of function CourseRes::free_template ---------//</span>
00157 
00158 <span class="comment">//------- Begin of function CourseRes::get_course_template -------//</span>
<a name="l00160"></a><a class="code" href="classCourseRes.html#a2">00160</a> <span class="comment">CourseTemplate* CourseRes::get_template(char* templateCode) {</span>
00161     <span class="keywordtype">int</span> offset = templateCode[0] - <a class="code" href="OCOURRES_8H.html#a0">FIRST_COURSE_TEMPLATE_CODE</a>;
00162 
00163     <a class="code" href="ALL_8H.html#a0">err_when</a>(offset &gt;= course_template_count);
00164     <span class="keywordflow">return</span> course_template_array + offset;
00165 }
00166 
00167 <span class="comment">//--------- End of function CourseRes::get_course_template ---------//</span>
00168 
00169 <span class="comment">//------- Begin of function CourseRes::get_course_template -------//</span>
<a name="l00171"></a><a class="code" href="classCourseRes.html#a3">00171</a> <span class="comment">CourseTemplate* CourseRes::get_template(int deptId) {</span>
00172     <span class="keywordflow">return</span> get_template(department_res[deptId]-&gt;template_course_type);
00173 }
00174 
00175 <span class="comment">//--------- End of function CourseRes::get_course_template ---------//</span>
00176 
00177 <span class="comment">//------- Begin of function CourseRes::get_normal_class_size -------//</span>
<a name="l00179"></a><a class="code" href="classCourseRes.html#a4">00179</a> <span class="comment">int CourseRes::get_normal_class_size(char* templateCode, char teachingMethod) {</span>
00180     <a class="code" href="ALL_8H.html#a0">err_when</a>(teachingMethod &gt;= <a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>);
00181 
00182     <span class="comment">//-------------------------------------------//</span>
00183 
00184     <span class="comment">// map TM in course.h to TM in courres.h</span>
00185     <span class="comment">// c.h      SEMINAR, DISTANCE_LEARN_COURSE, CLASS_WITH_BREAKOUT, BREAKOUT_LAB, GENERAL,</span>
00186     <span class="comment">// cr.h     P_SEMINAR=0, P_CLASS_WITH_BREAKOUTS, P_OTHER,</span>
00187 
00188     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> remap[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>]
00189         = { <a class="code" href="OCOURRES_8H.html#a8a3">P_SEMINAR</a>, -1, <a class="code" href="OCOURRES_8H.html#a8a4">P_CLASS_WITH_BREAKOUTS</a>, <a class="code" href="OCOURRES_8H.html#a8a3">P_SEMINAR</a>, <a class="code" href="OCOURRES_8H.html#a8a5">P_OTHER</a> };
00190 
00191     teachingMethod = remap[teachingMethod];
00192     <a class="code" href="ALL_8H.html#a0">err_when</a>(teachingMethod == -1);                 <span class="comment">// this case handled at the beginning</span>
00193 
00194     <a class="code" href="structCourseTemplate.html">CourseTemplate</a>* templ = get_template(templateCode);
00195 
00196     <span class="keywordflow">return</span> templ-&gt;<a class="code" href="structCourseTemplate.html#m2">normal_class_size</a>[teachingMethod];
00197 }
00198 
00199 <span class="comment">//--------- End of function CourseRes::get_normal_class_size ---------//</span>
00200 
00201 <span class="comment">//------- Begin of function CourseRes::get_course_pref -------//</span>
<a name="l00203"></a><a class="code" href="classCourseRes.html#a5">00203</a> <span class="comment">void CourseRes::get_course_pref(char* templateCode, char* pref) {</span>
00204     <a class="code" href="ALL_8H.html#a1">err_here</a>();
00205 
00206     <a class="code" href="structCourseTemplate.html">CourseTemplate</a>* templ = get_template(templateCode);
00207 
00208     <span class="keyword">const</span> <span class="keywordtype">char</span> remap[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>]
00209         = { templ-&gt;<a class="code" href="structCourseTemplate.html#m1">target_preference</a>[<a class="code" href="OCOURRES_8H.html#a8a3">P_SEMINAR</a>], 0, templ-&gt;<a class="code" href="structCourseTemplate.html#m1">target_preference</a>[<a class="code" href="OCOURRES_8H.html#a8a4">P_CLASS_WITH_BREAKOUTS</a>], 0, templ-&gt;<a class="code" href="structCourseTemplate.html#m1">target_preference</a>[<a class="code" href="OCOURRES_8H.html#a8a5">P_OTHER</a>] };
00210 
00211     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>; i++ ) {
00212         pref[i] = remap[i];
00213     }
00214 }
00215 
00216 <span class="comment">//--------- End of function CourseRes::get_course_pref ---------//</span>
00217 
00218 <span class="comment">//------- Begin of function CourseRes::load_summer_db -------//</span>
00220 <span class="comment">void CourseRes::load_summer_db() {</span>
00221     <a class="code" href="structSummerRec.html">SummerRec</a> *sumRec;
00222     <a class="code" href="classDatabase.html">Database</a>    *dbsummer = game_set.open_db(<a class="code" href="OCOURRES_8CPP.html#a1">SUMMER_COURSE_DB</a>);
00223 
00224     <span class="comment">//------ read in course information array -------//</span>
00225 
00226     memset( summer_course_pref, 0, <span class="keyword">sizeof</span>(summer_course_pref) );
00227 
00228     <span class="comment">// summer_course_pref[MAX_STUDENT_LEVEL][SUMMER_PERF_COUNT][SUMMER_COURSE_COUNT];                           // 99-&gt;99%</span>
00229 
00230     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> sl=0, x=1; sl&lt;<a class="code" href="Ostudent_8h.html#a0">MAX_STUDENT_LEVEL</a>; sl++ ) {
00231         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> e=0; e&lt;<a class="code" href="OCOURRES_8H.html#a8a6">SUMMER_PERF_COUNT</a>; e++ ) {
00232             sumRec  = (<a class="code" href="structSummerRec.html">SummerRec</a>*) dbsummer-&gt;<a class="code" href="classDatabase.html#a4">read</a>(x);
00233 
00234             <span class="keywordtype">int</span> prob=0;
00235             <span class="keywordflow">for</span>( <span class="keywordtype">int</span> c=0; c&lt;<a class="code" href="OCOURRES_8H.html#a8a7">SUMMER_COURSE_COUNT</a>; c++ ) {
00236                 summer_course_pref[sl][e][c] = int( 100 * m.atof(sumRec-&gt;<a class="code" href="structSummerRec.html#m0">course_pref</a>[c], 9) );
00237 
00238                 prob += summer_course_pref[sl][e][c];
00239 
00240                 <a class="code" href="ALL_8H.html#a0">err_when</a>(summer_course_pref[sl][e][c] &gt; 100 || summer_course_pref[sl][e][c] &lt; 0);
00241             }
00242             x++;
00243 
00244             <a class="code" href="ALL_8H.html#a0">err_when</a>(prob&lt;90 || prob&gt;110);
00245         }
00246         x++;
00247     }
00248 }
00249 
00250 <span class="comment">//--------- End of function CourseRes::load_summer_db ---------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:19 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
