<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Ofont.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Ofont.cpp</h1><a href="Ofont_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OFONT.CPP</span>
00002 <span class="comment">//Description : Font Object</span>
00003 
00004 <span class="preprocessor">#include &lt;OFONT.H&gt;</span>
00005 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;<a class="code" href="IMGFUN_8H.html">IMGFUN.H</a>&gt;</span>
00007 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00008 <span class="preprocessor">#include &lt;<a class="code" href="OSTR_8H.html">OSTR.H</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00010 <span class="preprocessor">#include &lt;<a class="code" href="ORES_8H.html">ORES.H</a>&gt;</span>
00011 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>
00012 <span class="preprocessor">#include &lt;<a class="code" href="OGAME_8H.html">OGAME.H</a>&gt;</span>
00013 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00014 <span class="preprocessor">#include &lt;<a class="code" href="OTRANSL_8H.html">OTRANSL.H</a>&gt;</span>
00015 <span class="preprocessor">#include &lt;string.h&gt;</span>
00016 <span class="preprocessor">#include &lt;Ostr.h&gt;</span>
00017 
00018 <span class="comment">//--------------------------------------------------------//</span>
00019 <span class="comment">// A font resource file is composed of three parts :</span>
00020 <span class="comment">//</span>
00021 <span class="comment">// one FontHeader;</span>
00022 <span class="comment">// one FontInfo for each character;</span>
00023 <span class="comment">// Bitmap data.</span>
00024 <span class="comment">//--------------------------------------------------------//</span>
00025 
00026 <span class="comment">//-------- Define struct FontHeader -------//</span>
00027 
<a name="l00029"></a><a class="code" href="structFontHeader.html">00029</a> <span class="keyword">struct </span><a class="code" href="structFontHeader.html">FontHeader</a> {
<a name="l00030"></a><a class="code" href="structFontHeader.html#m0">00030</a>     <span class="keywordtype">unsigned</span>  <span class="keywordtype">short</span> <a class="code" href="structFontHeader.html#m0">max_width</a>;
<a name="l00031"></a><a class="code" href="structFontHeader.html#m1">00031</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="structFontHeader.html#m1">max_height</a>;
<a name="l00032"></a><a class="code" href="structFontHeader.html#m2">00032</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="structFontHeader.html#m2">std_height</a>;
<a name="l00033"></a><a class="code" href="structFontHeader.html#m3">00033</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="structFontHeader.html#m3">first_char</a>;                      <span class="comment">// ascii code of the first character</span>
<a name="l00034"></a><a class="code" href="structFontHeader.html#m4">00034</a>     <span class="keywordtype">unsigned</span>  <span class="keywordtype">short</span> <a class="code" href="structFontHeader.html#m4">last_char</a>;                      <span class="comment">// ascii code of the last character</span>
00035 };
00036 
00037 <span class="comment">//-------- Define struct FontInfo -------//</span>
00038 
<a name="l00040"></a><a class="code" href="structFontInfo.html">00040</a> <span class="keyword">struct </span><a class="code" href="structFontInfo.html">FontInfo</a> {                                 <span class="comment">// info for each character</span>
<a name="l00041"></a><a class="code" href="structFontInfo.html#m0">00041</a>     <span class="keywordtype">char</span>        <a class="code" href="structFontInfo.html#m0">offset_y</a>;
<a name="l00042"></a><a class="code" href="structFontInfo.html#m1">00042</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structFontInfo.html#m1">width</a>;
<a name="l00043"></a><a class="code" href="structFontInfo.html#m2">00043</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structFontInfo.html#m2">height</a>;
<a name="l00044"></a><a class="code" href="structFontInfo.html#m3">00044</a>     <span class="keywordtype">long</span>        <a class="code" href="structFontInfo.html#m3">bitmap_offset</a>;                      <span class="comment">// file offset relative to bitmap data</span>
00045 };
00046 
00047 <span class="comment">//--------- Define macro constant ------------//</span>
00048 
<a name="l00049"></a><a class="code" href="Ofont_8cpp.html#a0">00049</a> <span class="preprocessor">#define HYPER_FIELD_COLOR   V_BLUE</span>
00050 <span class="preprocessor"></span>
00051 <span class="comment">//--------- German character table -------//</span>
00052 
00053 <span class="comment">//#ifdef GERMAN</span>
00054 <span class="comment">//#define GERMAN_CHAR_COUNT     7</span>
00055 
00056 <span class="comment">//      their DOS ascii characters:                      ü    ä    ß    ö    Ä    Ü    Ö</span>
00057 <span class="comment">//static short german_ascii_array[]  = { 252, 228, 223, 246, 196, 220, 214 };</span>
00058 <span class="comment">//static short german_bmp_id_array[] = { 121, 100,  95, 116, 128, 151, 145 };</span>
00059 <span class="comment">//#endif</span>
00060 
00061 <span class="comment">//------- Define static member variable --------//</span>
00062 
<a name="l00063"></a><a class="code" href="classFont.html#p0">00063</a> <span class="keywordtype">short</span>      <a class="code" href="classFont.html#p0">Font::hyper_field_count</a>;
<a name="l00064"></a><a class="code" href="classFont.html#p1">00064</a> <a class="code" href="structHyperField.html">HyperField</a> <a class="code" href="classFont.html#p1">Font::hyper_field_array</a>[<a class="code" href="Ofont_8h.html#a3">MAX_HYPER_FIELD</a>];
00065 
00066 <span class="keyword">static</span> <span class="keywordtype">int</span> text_line_count;                       <span class="comment">// used by text_width() &amp; text_height() only</span>
00067 
00068 <span class="comment">//----------- Begin of function Font Constructor -------//</span>
00069 
<a name="l00070"></a><a class="code" href="classFont.html#a0">00070</a> <a class="code" href="classFont.html#a0">Font::Font</a>(<span class="keywordtype">char</span>* fontName) {
00071     memset( <span class="keyword">this</span>, 0, <span class="keyword">sizeof</span>(<a class="code" href="classFont.html">Font</a>) );
00072 
00073     <span class="keywordflow">if</span>( fontName )
00074         <a class="code" href="classFont.html#a2">init</a>(fontName);
00075 }
00076 
00077 <span class="comment">//------------- End of function Font Constructor -------//</span>
00078 
00079 <span class="comment">//----------- Begin of function Font Destructor -------//</span>
00080 
<a name="l00081"></a><a class="code" href="classFont.html#a1">00081</a> <a class="code" href="classFont.html#a1">Font::~Font</a>() {
00082     <a class="code" href="classFont.html#a3">deinit</a>();
00083 }
00084 
00085 <span class="comment">//------------- End of function Font Destructor -------//</span>
00086 
00087 <span class="comment">//-------- Begin of function Font::init -----------//</span>
<a name="l00101"></a><a class="code" href="classFont.html#a2">00101</a> <span class="comment">void Font::init(char* fontName, int interCharSpace, int italicShift) {</span>
00102     <span class="keywordflow">if</span>( init_flag )
00103         deinit();
00104 
00105     inter_char_space = interCharSpace;
00106 
00107     <span class="comment">//---------- open the font file -----------//</span>
00108 
00109     <a class="code" href="classFile.html">File</a> fontFile;
00110 
00111     <a class="code" href="classString.html">String</a> str;
00112 
00113     str  = <a class="code" href="Gamedef_8h.html#a4">DIR_RES</a>;
00114     str += <span class="stringliteral">"FNT_"</span>;
00115     str += fontName;
00116     str += <span class="stringliteral">".RES"</span>;
00117 
00118     fontFile.<a class="code" href="classFile.html#a2">file_open</a>(str);
00119 
00120     <span class="comment">//-------- read in the font header ---------//</span>
00121 
00122     <a class="code" href="structFontHeader.html">FontHeader</a> fontHeader;
00123 
00124     fontFile.<a class="code" href="classFile.html#a9">file_read</a>( &amp;fontHeader, <span class="keyword">sizeof</span>(<a class="code" href="structFontHeader.html">FontHeader</a>) );
00125 
00126     max_font_width  = fontHeader.<a class="code" href="structFontHeader.html#m0">max_width</a>;
00127     max_font_height = fontHeader.<a class="code" href="structFontHeader.html#m1">max_height</a>;
00128     std_font_height = fontHeader.<a class="code" href="structFontHeader.html#m2">std_height</a>;
00129 
00130     font_height    = std_font_height;               <span class="comment">// its default is std_font_height, but can be set to max_font_height</span>
00131 
00132     first_char     = fontHeader.<a class="code" href="structFontHeader.html#m3">first_char</a>;
00133     last_char    = fontHeader.<a class="code" href="structFontHeader.html#m4">last_char</a>;
00134 
00135     <span class="comment">//----------- read in font info ------------//</span>
00136 
00137     <span class="keywordtype">int</span> infoArraySize = <span class="keyword">sizeof</span>(FontInfo) * (last_char-first_char+1);
00138 
00139     font_info_array = (<a class="code" href="structFontInfo.html">FontInfo</a>*) <a class="code" href="ALL_8H.html#a5">mem_add</a>( infoArraySize );
00140 
00141     fontFile.<a class="code" href="classFile.html#a9">file_read</a>( font_info_array, infoArraySize );
00142 
00143     <span class="comment">//------- process italic shift --------//</span>
00144 
00145     <span class="keywordflow">if</span>( italicShift ) {
00146         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;last_char-first_char+1 ; i++ )
00147             font_info_array[i].width -= italicShift;
00148     }
00149 
00150     <span class="comment">//---------- read in bitmap data ----------//</span>
00151 
00152     <span class="keywordtype">int</span> bitmapBufSize = fontFile.<a class="code" href="classFile.html#a6">file_size</a>() - <span class="keyword">sizeof</span>(FontHeader) - infoArraySize;
00153 
00154     font_bitmap_buf = <a class="code" href="ALL_8H.html#a5">mem_add</a>( bitmapBufSize);
00155 
00156     fontFile.<a class="code" href="classFile.html#a9">file_read</a>( font_bitmap_buf, bitmapBufSize );
00157 
00158     <span class="comment">//---- get the width of the space character ----//</span>
00159     <span class="comment">//</span>
00160     <span class="comment">// since in some font, the space char is too narrow,</span>
00161     <span class="comment">// we use the width of 't' as space instead</span>
00162     <span class="comment">//</span>
00163     <span class="comment">//----------------------------------------------//</span>
00164 
00165     space_width = font_info_array[<span class="charliteral">'t'</span>-first_char].width;
00166 
00167     <span class="comment">//----------------------------------------------//</span>
00168 
00169     fontFile.<a class="code" href="classFile.html#a5">file_close</a>();
00170 
00171     init_flag = 1;
00172 }
00173 
00174 <span class="comment">//---------- End of function Font::init ----------//</span>
00175 
00176 <span class="comment">//----------- Start of function Font::deinit ---------//</span>
00177 <span class="comment">//</span>
<a name="l00178"></a><a class="code" href="classFont.html#a3">00178</a> <span class="keywordtype">void</span> <a class="code" href="classFont.html#a3">Font::deinit</a>() {
00179     <span class="keywordflow">if</span>( font_info_array ) {
00180         <a class="code" href="ALL_8H.html#a8">mem_del</a>( <a class="code" href="classFont.html#m12">font_info_array</a> );
00181         <a class="code" href="classFont.html#m12">font_info_array</a> = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00182     }
00183 
00184     <span class="keywordflow">if</span>( font_bitmap_buf ) {
00185         <a class="code" href="ALL_8H.html#a8">mem_del</a>( <a class="code" href="classFont.html#m13">font_bitmap_buf</a> );
00186         <a class="code" href="classFont.html#m13">font_bitmap_buf</a> = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00187     }
00188 
00189     <a class="code" href="classFont.html#m0">init_flag</a> = 0;
00190 }
00191 
00192 <span class="comment">//------------- End of function Font::deinit ---------//</span>
00193 
00194 <span class="comment">//--------- Start of function Font::put ---------//</span>
00195 <span class="comment">//</span>
00196 <span class="comment">// write text with pre-inited fonts</span>
00197 <span class="comment">//</span>
00198 <span class="comment">// int x,y         = location of the font</span>
00199 <span class="comment">// char* text      = the text to be put on screen</span>
00200 <span class="comment">// [int] clearBack = clear background with back_color or not</span>
00201 <span class="comment">//                   (default : 0)</span>
00202 <span class="comment">// [int]  x2       = display font up to the right border x2 and also</span>
00203 <span class="comment">//                   clear the area between the last character and right border</span>
00204 <span class="comment">//</span>
00205 <span class="comment">// Return : &lt;int&gt; lastX, the x coordination of the last pixel of last font</span>
00206 <span class="comment">//</span>
<a name="l00207"></a><a class="code" href="classFont.html#a10">00207</a> <span class="keywordtype">int</span> <a class="code" href="classFont.html#a10">Font::put</a>(<span class="keywordtype">int</span> x,<span class="keywordtype">int</span> y,<span class="keywordtype">char</span>* textPtr, <span class="keywordtype">char</span> clearBack, <span class="keywordtype">int</span> x2 ) {
00208     <a class="code" href="ALL_8H.html#a0">err_when</a>( x&lt;0 || y&lt;0 );
00209 
00210     <span class="keywordflow">if</span>( !<a class="code" href="classFont.html#m0">init_flag</a> )
00211         <span class="keywordflow">return</span> x;
00212 
00213     <span class="comment">//-------- process translation ---------//</span>
00214 
00215     <span class="keywordtype">short</span> textChar;
00216 
00217     textPtr = translate.process(textPtr);
00218 
00219     <span class="comment">//-------------------------------------//</span>
00220 
00221     <span class="keywordtype">int</span> textPtrLen = strlen(textPtr);
00222 
00223     <span class="keywordflow">if</span>( x2 &lt; 0 )                                    <span class="comment">// default</span>
00224         x2 = x+<a class="code" href="classFont.html#m7">max_font_width</a>*textPtrLen;
00225 
00226     x2 = min( x2, <a class="code" href="OVGA_8H.html#a0">VGA_WIDTH</a>-1 );
00227 
00228     <span class="keywordflow">if</span>( !<a class="code" href="classVga.html#p1">Vga::use_back_buf</a> )
00229         mouse.hide_area( x, y, x2, y+<a class="code" href="classFont.html#m4">font_height</a> );
00230 
00231     <span class="keywordtype">int</span> y2 = y+<a class="code" href="classFont.html#m4">font_height</a>-1;
00232 
00233     <span class="comment">//-------------------------------------//</span>
00234 
00235     <a class="code" href="structFontInfo.html">FontInfo</a>* fontInfo;
00236 
00237     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> lenCount=1 ; *textPtr &amp;&amp; lenCount&lt;=textPtrLen ; textPtr++, lenCount++ ) {
00238         textChar = *((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)textPtr);        <span class="comment">// textChar is &lt;unsiged char&gt;</span>
00239 
00240         <span class="comment">//#ifdef GERMAN</span>
00241         <span class="comment">//              textChar = translate_german_char(textChar);</span>
00242         <span class="comment">//#endif</span>
00243 
00244         <span class="comment">//--------------- space character ------------------//</span>
00245 
00246         <span class="keywordflow">if</span>( textChar == <span class="charliteral">' '</span> ) {
00247             <span class="keywordflow">if</span>( x+<a class="code" href="classFont.html#m8">space_width</a> &gt; x2 )
00248                 <span class="keywordflow">break</span>;
00249 
00250             <span class="keywordflow">if</span>( clearBack &amp;&amp; !<a class="code" href="classVga.html#p1">Vga::use_back_buf</a> )       <span class="comment">// copy texture from the back buffer as the background color</span>
00251                 vga.blt_buf( x, y, x+<a class="code" href="classFont.html#m8">space_width</a>-1, y+<a class="code" href="classFont.html#m4">font_height</a>-1 );
00252 
00253             x += <a class="code" href="classFont.html#m8">space_width</a>;
00254         }
00255 
00256         <span class="comment">//------------- normal character ----------------//</span>
00257 
00258         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( textChar &gt;= <a class="code" href="classFont.html#m10">first_char</a> &amp;&amp; textChar &lt;= <a class="code" href="classFont.html#m11">last_char</a> ) {
00259             fontInfo = <a class="code" href="classFont.html#m12">font_info_array</a>+textChar-<a class="code" href="classFont.html#m10">first_char</a>;
00260 
00261             <span class="keywordflow">if</span>( x+fontInfo-&gt;<a class="code" href="structFontInfo.html#m1">width</a> &gt; x2 )
00262                 <span class="keywordflow">break</span>;
00263 
00264             <span class="keywordflow">if</span>( fontInfo-&gt;<a class="code" href="structFontInfo.html#m1">width</a> &gt; 0 ) {
00265                 <span class="keywordflow">if</span>( clearBack &amp;&amp; !<a class="code" href="classVga.html#p1">Vga::use_back_buf</a> ) {
00266                     <span class="keywordflow">if</span>( fontInfo-&gt;<a class="code" href="structFontInfo.html#m0">offset_y</a> &gt; 0 )            <span class="comment">// clear the upper space areas of the character</span>
00267                         vga_front.blt_buf_fast( &amp;vga_back, x, y, x+fontInfo-&gt;<a class="code" href="structFontInfo.html#m1">width</a>-1, y+fontInfo-&gt;<a class="code" href="structFontInfo.html#m0">offset_y</a>-1 );
00268 
00269                     vga_front.join_trans( &amp;vga_back, x, y+fontInfo-&gt;<a class="code" href="structFontInfo.html#m0">offset_y</a>, <a class="code" href="classFont.html#m13">font_bitmap_buf</a> + fontInfo-&gt;<a class="code" href="structFontInfo.html#m3">bitmap_offset</a> );
00270 
00271                     <span class="keywordtype">int</span> charHeight = *(((<span class="keywordtype">short</span>*)(<a class="code" href="classFont.html#m13">font_bitmap_buf</a>+fontInfo-&gt;<a class="code" href="structFontInfo.html#m3">bitmap_offset</a>))+1);
00272 
00273                     <span class="keywordflow">if</span>( fontInfo-&gt;<a class="code" href="structFontInfo.html#m0">offset_y</a>+charHeight &lt; <a class="code" href="classFont.html#m6">max_font_height</a> ) {
00274                         <span class="keywordtype">int</span> ty1 = y+fontInfo-&gt;<a class="code" href="structFontInfo.html#m0">offset_y</a>+charHeight-1;
00275                         <span class="keywordtype">int</span> ty2 = ty1 + <a class="code" href="classFont.html#m6">max_font_height</a> - (fontInfo-&gt;<a class="code" href="structFontInfo.html#m0">offset_y</a> + charHeight);
00276                         vga_front.blt_buf_fast( &amp;vga_back, x, ty1, x+fontInfo-&gt;<a class="code" href="structFontInfo.html#m1">width</a>-1, ty2 );
00277                     }
00278                 }
00279                 <span class="keywordflow">else</span> {
00280                     <a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;<a class="code" href="classVgaBuf.html#a67">put_bitmap_trans_fast</a>(x, y+fontInfo-&gt;<a class="code" href="structFontInfo.html#m0">offset_y</a>, <a class="code" href="classFont.html#m13">font_bitmap_buf</a> + fontInfo-&gt;<a class="code" href="structFontInfo.html#m3">bitmap_offset</a>);
00281                 }
00282 
00283                 x += fontInfo-&gt;<a class="code" href="structFontInfo.html#m1">width</a>;                     <span class="comment">// inter-character space</span>
00284             }
00285         }
00286         <span class="keywordflow">else</span> {
00287             <span class="comment">//------ tab or unknown character -------//</span>
00288 
00289             <span class="keywordflow">if</span>( textChar == <span class="charliteral">'\t'</span> )                      <span class="comment">// Tab</span>
00290                 x += <a class="code" href="classFont.html#m8">space_width</a>*8;                       <span class="comment">// one tab = 8 space chars</span>
00291             <span class="keywordflow">else</span>
00292                 x += <a class="code" href="classFont.html#m8">space_width</a>;
00293         }
00294 
00295         <span class="comment">//--------- inter-character space ---------//</span>
00296 
00297         <span class="keywordflow">if</span>( clearBack &amp;&amp; !<a class="code" href="classVga.html#p1">Vga::use_back_buf</a> )         <span class="comment">// copy texture from the back buffer as the background color</span>
00298             vga.blt_buf( x, y, x+<a class="code" href="classFont.html#m9">inter_char_space</a>-1, y+<a class="code" href="classFont.html#m6">max_font_height</a>-1, 0 );
00299 
00300         x+=<a class="code" href="classFont.html#m9">inter_char_space</a>;
00301     }
00302 
00303     <span class="comment">//------ clear remaining area -------//</span>
00304 
00305     <span class="keywordflow">if</span>( clearBack &amp;&amp; !<a class="code" href="classVga.html#p1">Vga::use_back_buf</a> )           <span class="comment">// copy texture from the back buffer as the background color</span>
00306         vga.blt_buf( x, y, x2, y+<a class="code" href="classFont.html#m6">max_font_height</a>-1, 0 );
00307 
00308     <span class="keywordflow">if</span>( !<a class="code" href="classVga.html#p1">Vga::use_back_buf</a> )
00309         mouse.show_area();
00310 
00311     sys.yield();                                    <span class="comment">// chwg032799</span>
00312     <span class="keywordflow">return</span> x-1;
00313 }
00314 
00315 <span class="comment">//----------- End of function Font::put ---------//</span>
00316 
00317 <span class="comment">//#ifdef GERMAN</span>
00318 <span class="comment">//--------- Start of function Font::translate_german_char ---------//</span>
00319 <span class="comment">//</span>
00320 <span class="comment">// &lt;char&gt; textChar  = the character to be translated</span>
00321 <span class="comment">//</span>
00322 <span class="comment">//short Font::translate_german_char(short textChar)</span>
00323 <span class="comment">//{</span>
00324 <span class="comment">//      for( int i=0 ; i&lt;GERMAN_CHAR_COUNT ; i++ )</span>
00325 <span class="comment">//      {</span>
00326 <span class="comment">//              if( german_ascii_array[i] == textChar )</span>
00327 <span class="comment">//                      return first_char + german_bmp_id_array[i];</span>
00328 <span class="comment">//      }</span>
00329 <span class="comment">//      return textChar;</span>
00330 <span class="comment">//}</span>
00331 <span class="comment">//----------- End of function Font::translate_german_char ---------//</span>
00332 <span class="comment">//#endif</span>
00333 
00334 <span class="comment">//--------- Start of function Font::put_char ---------//</span>
00335 <span class="comment">//</span>
00336 <span class="comment">// &lt;int&gt;  x, y      = the position of the character</span>
00337 <span class="comment">// &lt;char&gt; textChar  = the character</span>
00338 <span class="comment">//</span>
<a name="l00339"></a><a class="code" href="classFont.html#a12">00339</a> <span class="keywordtype">void</span> <a class="code" href="classFont.html#a12">Font::put_char</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> textChar) {
00340     <span class="keywordflow">if</span>( textChar &gt;= <a class="code" href="classFont.html#m10">first_char</a> &amp;&amp; textChar &lt;= <a class="code" href="classFont.html#m11">last_char</a> ) {
00341         <a class="code" href="structFontInfo.html">FontInfo</a>* fontInfo = <a class="code" href="classFont.html#m12">font_info_array</a>+textChar-<a class="code" href="classFont.html#m10">first_char</a>;
00342 
00343         <a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;<a class="code" href="classVgaBuf.html#a66">put_bitmap_trans</a>( x, y + fontInfo-&gt;<a class="code" href="structFontInfo.html#m0">offset_y</a>, <a class="code" href="classFont.html#m13">font_bitmap_buf</a> + fontInfo-&gt;<a class="code" href="structFontInfo.html#m3">bitmap_offset</a> );
00344     }
00345 }
00346 
00347 <span class="comment">//----------- End of function Font::put_char ---------//</span>
00348 
00349 <span class="comment">//--------- Start of function Font::right_put ---------//</span>
00350 <span class="comment">//</span>
00351 <span class="comment">// Display a string in right-justified format.</span>
00352 <span class="comment">//</span>
00353 <span class="comment">// &lt;int&gt;   x, y    = the right end position of displaying the string</span>
00354 <span class="comment">// &lt;char*&gt; textPtr = the character</span>
00355 <span class="comment">//</span>
<a name="l00356"></a><a class="code" href="classFont.html#a13">00356</a> <span class="keywordtype">void</span> <a class="code" href="classFont.html#a13">Font::right_put</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">char</span>* textPtr) {
00357     <span class="keywordtype">int</span> textWidth = <a class="code" href="classFont.html#a8">text_width</a>(textPtr);
00358 
00359     <a class="code" href="classFont.html#a10">put</a>( x-textWidth, y, textPtr );
00360 }
00361 
00362 <span class="comment">//----------- End of function Font::right_put ---------//</span>
00363 
00364 <span class="comment">//--------- Begin of function Font::text_width ----//</span>
<a name="l00378"></a><a class="code" href="classFont.html#a8">00378</a> <span class="comment">int Font::text_width(char* textPtr, int textPtrLen, int maxDispWidth) {</span>
00379     <span class="keywordtype">int</span>   charWidth, x=0, lenCount, maxLen=0, wordWidth=0;
00380     <span class="keywordtype">short</span> textChar;
00381 
00382     <span class="keywordflow">if</span>( !init_flag )
00383         <span class="keywordflow">return</span> x;
00384 
00385     textPtr = translate.process(textPtr);
00386 
00387     <span class="keywordflow">if</span>( textPtrLen &lt; 0 )
00388         textPtrLen = strlen(textPtr);
00389 
00390     text_line_count=1;
00391 
00392     <span class="comment">//-------------------------------------//</span>
00393 
00394     <span class="keywordflow">for</span>( lenCount=1 ; *textPtr &amp;&amp; lenCount&lt;=textPtrLen ; textPtr++, lenCount++, x+=inter_char_space ) {
00395         textChar = *((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)textPtr);
00396 
00397         <span class="comment">//#ifdef GERMAN</span>
00398         <span class="comment">//              textChar = translate_german_char(textChar);</span>
00399         <span class="comment">//#endif</span>
00400 
00401         <span class="comment">//-- if the line exceed the given max width, advance to next line --//</span>
00402 
00403         <span class="keywordflow">if</span>( maxDispWidth &amp;&amp; x &gt; maxDispWidth ) {
00404             maxLen = maxDispWidth;
00405             x      = wordWidth;                         <span class="comment">// the last word of the prev line wraps to next line</span>
00406             text_line_count++;
00407         }
00408 
00409         <span class="comment">//--- if the textPtr has more than 1 line, get the longest line ---//</span>
00410 
00411         <span class="keywordflow">if</span>( textChar == <span class="charliteral">'\n'</span> ) {
00412             <span class="keywordflow">if</span>( x&gt;maxLen )
00413                 maxLen=x;
00414 
00415             x=0;
00416             wordWidth=0;
00417             text_line_count++;
00418             <span class="keywordflow">continue</span>;                                   <span class="comment">// next character</span>
00419         }
00420 
00421         <span class="comment">//--- add the width of the character to the total line width ---//</span>
00422 
00423         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( textChar == <span class="charliteral">' '</span> ) {
00424             x += space_width;
00425             wordWidth = 0;
00426         }
00427 
00428         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( textChar &gt;= first_char &amp;&amp; textChar &lt;= last_char ) {
00429             charWidth = font_info_array[textChar-first_char].width;
00430 
00431             x         += charWidth;
00432             wordWidth += charWidth;
00433         }
00434         <span class="keywordflow">else</span> {
00435             x         += space_width;
00436             wordWidth += space_width;
00437         }
00438 
00439         <span class="keywordflow">if</span>( maxDispWidth &amp;&amp; wordWidth &gt; maxDispWidth ) {
00440             x         -= wordWidth - maxDispWidth;
00441             wordWidth  = maxDispWidth;
00442         }
00443     }
00444 
00445     <span class="comment">//-------------------------------------------//</span>
00446 
00447     <span class="keywordflow">if</span>( maxDispWidth &amp;&amp; x &gt; maxDispWidth )
00448         text_line_count++;
00449 
00450     <span class="keywordflow">if</span>( textPtr[-1] == <span class="charliteral">'\n'</span> )                       <span class="comment">// if last character is line feed, don't count double</span>
00451         text_line_count--;
00452 
00453     <span class="keywordflow">return</span> max(maxLen,x);
00454 }
00455 
00456 <span class="comment">//----------- End of function Font::text_width ----//</span>
00457 
00458 <span class="comment">//--------- Begin of function Font::text_height ----//</span>
<a name="l00468"></a><a class="code" href="classFont.html#a9">00468</a> <span class="comment">int Font::text_height(int lineSpace) {</span>
00469     <span class="keywordflow">return</span> font_height * text_line_count +
00470         lineSpace   * (text_line_count-1);
00471 }
00472 
00473 <span class="comment">//----------- End of function Font::text_height ----//</span>
00474 
00475 <span class="comment">//--------- Begin of function Font::put_paragraph ------//</span>
00517 <span class="comment"></span>
<a name="l00518"></a><a class="code" href="classFont.html#a17">00518</a> <span class="keywordtype">void</span> <a class="code" href="classFont.html#a17">Font::put_paragraph</a>(<span class="keywordtype">int</span> x1, <span class="keywordtype">int</span> y1, <span class="keywordtype">int</span> x2, <span class="keywordtype">int</span> y2, <span class="keywordtype">char</span> *textPtr,
00519                          <span class="keywordtype">int</span> lineSpace, <span class="keywordtype">int</span> startLine, <span class="keywordtype">char</span> dispFlag) {
00520     <span class="keywordflow">if</span>( !<a class="code" href="classFont.html#m0">init_flag</a> || y1+<a class="code" href="classFont.html#m4">font_height</a>-1 &gt; y2 )
00521         <span class="keywordflow">return</span>;
00522 
00523     textPtr = translate.process(textPtr);
00524 
00525     <span class="comment">//--------- define vars ---------------//</span>
00526 
00527     <span class="keywordtype">int</span>   x,y,wordX;
00528     <span class="keywordtype">int</span>   newWord;
00529     <span class="keywordtype">short</span> textChar;
00530     <span class="keywordtype">char</span> *wordPtr;
00531 
00532     <span class="keywordtype">char</span>  flag_under_line=0;                        <span class="comment">// attribute control flags</span>
00533     <span class="keywordtype">char</span>  flag_large_casa=0;                        <span class="comment">// attribute control flags</span>
00534     <span class="keywordtype">char</span>  flag_hyper_field=0;
00535 
00536     <span class="keywordtype">int</span>   under_line_x1;                            <span class="comment">// parameters for drawing under line</span>
00537 
00538     <a class="code" href="structHyperField.html">HyperField</a>* hyper_field_ptr = <a class="code" href="classFont.html#p1">hyper_field_array</a>;
00539     <a class="code" href="structFontInfo.html">FontInfo</a>*   fontInfo;
00540 
00541   <span class="comment">//--------- initialize vars ---------------//</span>
00542 
00543     x       = x1;
00544     y       = y1;
00545     wordX   = x1;                                   <span class="comment">// the x of the start of the word</span>
00546     wordPtr = textPtr;
00547     newWord = 0;
00548 
00549     <a class="code" href="classFont.html#m3">line_count</a>=0;
00550 
00551     <a class="code" href="classFont.html#p0">hyper_field_count</a> = 0;
00552 
00553     <span class="comment">//---------- prepare for display font ----------//</span>
00554 
00555     <span class="keywordflow">if</span>( dispFlag ) {
00556         <a class="code" href="ALL_8H.html#a0">err_when</a>( x1&gt;x2 || y1&gt;y2 || x1&lt;0 || y1&lt;0 || x2&gt;=<a class="code" href="OVGA_8H.html#a0">VGA_WIDTH</a> || y2&gt;=<a class="code" href="OVGA_8H.html#a1">VGA_HEIGHT</a> );
00557 
00558         <span class="keywordflow">if</span>( !<a class="code" href="classVga.html#p1">Vga::use_back_buf</a> )                      <span class="comment">// if not say word by word, turn off mouse one time, otherwise turn off mouse one word at a time</span>
00559             mouse.hide_area( x1,y1,x2,y2 );             <span class="comment">// if the mouse cursor is in that area, hide it</span>
00560     }
00561 
00562     <span class="comment">//--------- loop for displaying textPtr ----------//</span>
00563 
00564     <span class="keywordflow">while</span>(1) {
00565         <span class="comment">//------ space appear, process the previous word ------//</span>
00566         <span class="keywordflow">if</span> ( newWord ) {
00567             <span class="keywordflow">if</span>( x-1 &gt; x2 ) {                            <span class="comment">// it is still okay if x-1==x2 because x is the next pixel, not the last displayed pixel</span>
00568                 <span class="keywordflow">if</span>( <a class="code" href="classFont.html#m3">line_count</a> &gt;= startLine-1 ) {         <span class="comment">// startLine start from 1</span>
00569                     y += <a class="code" href="classFont.html#m4">font_height</a> + lineSpace;
00570                     <span class="keywordflow">if</span> ( y + <a class="code" href="classFont.html#m4">font_height</a> - 1 &gt; y2 )         <span class="comment">// no further space for printing textPtr, end</span>
00571                         <span class="keywordflow">break</span>;
00572                 }
00573 
00574                 x = x1;
00575                 <a class="code" href="classFont.html#m3">line_count</a>++;
00576             }
00577             <span class="keywordflow">else</span> {
00578                 x = wordX;
00579             }
00580 
00581             <span class="comment">//--------- Process current word ----------//</span>
00582 
00583             <span class="comment">// wordPtr point to the current word which will be printed</span>
00584             <span class="keywordflow">for</span>( ; wordPtr &lt; textPtr &amp;&amp; *wordPtr ; wordPtr++, x+=<a class="code" href="classFont.html#m9">inter_char_space</a> ) {
00585                 textChar = *((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)wordPtr);    <span class="comment">// textChar is &lt;unsiged char&gt;</span>
00586 
00587                 <span class="comment">//#ifdef GERMAN</span>
00588                 <span class="comment">//                              textChar = translate_german_char(textChar);</span>
00589                 <span class="comment">//#endif</span>
00590 
00591                 <span class="comment">//---------- control char: '_' -------------//</span>
00592 
00593                 <span class="keywordflow">if</span>( textChar == <span class="charliteral">'_'</span> ) {                   <span class="comment">// e.g. _Title_, a line will be drawn under the word "Title"</span>
00594                     <span class="keywordflow">if</span>( flag_under_line ) {                 <span class="comment">// current '_' is the closing one, the open '_' has appeared previously</span>
00595                         <span class="comment">// startLine start from 1</span>
00596                         <span class="keywordflow">if</span>( dispFlag &amp;&amp; <a class="code" href="classFont.html#m3">line_count</a> &gt;= startLine-1 )
00597                             <span class="keywordflow">if</span>( flag_large_casa ) {
00598                                 <span class="comment">// ## begin chwg 1016</span>
00599                                 <a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;<a class="code" href="classVgaBuf.html#a28">bar_fast</a>(under_line_x1, y+font_casa.
00600                                                           <a class="code" href="classFont.html#m4">font_height</a>, x, y+font_casa.font_height, <a class="code" href="Ofont_8cpp.html#a0">HYPER_FIELD_COLOR</a> );
00601                             }
00602                             <span class="keywordflow">else</span>
00603                                 <a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;<a class="code" href="classVgaBuf.html#a28">bar_fast</a>(under_line_x1, y+<a class="code" href="classFont.html#m4">font_height</a>, x, y+<a class="code" href="classFont.html#m4">font_height</a>, <a class="code" href="Ofont_8cpp.html#a0">HYPER_FIELD_COLOR</a> );
00604                     }
00605                     <span class="keywordflow">else</span>
00606                         under_line_x1 = x;
00607 
00608                     flag_under_line = !flag_under_line;
00609                     <span class="keywordflow">continue</span>;
00610                 }
00611 
00612                 <span class="keywordflow">if</span>( textChar == <span class="charliteral">'^'</span> ) {                   <span class="comment">// e.g. _Title_, a line will be drawn under the word "Title"</span>
00613                     flag_large_casa = !flag_large_casa;
00614                     <span class="keywordflow">continue</span>;
00615                 }
00616 
00617                 <span class="comment">//-------- control char: '~' -----------//</span>
00618 
00619                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>( textChar == <span class="charliteral">'~'</span> ) {              <span class="comment">// e.g. ~Captial~, the word "Capital" is a hyper-textPtred field, pressing on it will link to the topic "Capital"</span>
00620                     <span class="keywordflow">if</span>( !flag_hyper_field ) {               <span class="comment">// current '~' is the opening one</span>
00621                         hyper_field_ptr-&gt;<a class="code" href="structHyperField.html#m0">x1</a>       = x;
00622                         hyper_field_ptr-&gt;<a class="code" href="structHyperField.html#m1">y1</a>       = y;
00623                         <span class="comment">// skip current '~'</span>
00624                         hyper_field_ptr-&gt;<a class="code" href="structHyperField.html#m4">text_ptr</a> = (wordPtr+1);
00625                     }
00626                     <span class="keywordflow">else</span> {                                  <span class="comment">// current '~' is the closing one</span>
00627                         hyper_field_ptr-&gt;<a class="code" href="structHyperField.html#m2">x2</a>       = x;
00628                         hyper_field_ptr-&gt;<a class="code" href="structHyperField.html#m3">y2</a>       = y+<a class="code" href="classFont.html#m4">font_height</a>;
00629                         hyper_field_ptr-&gt;<a class="code" href="structHyperField.html#m5">text_len</a> = wordPtr - hyper_field_ptr-&gt;<a class="code" href="structHyperField.html#m4">text_ptr</a>;
00630 
00631                         <a class="code" href="classFont.html#p0">hyper_field_count</a>++;
00632                         hyper_field_ptr++;
00633                         <a class="code" href="ALL_8H.html#a0">err_when</a>( <a class="code" href="classFont.html#p0">hyper_field_count</a> &gt;= <a class="code" href="Ofont_8h.html#a3">MAX_HYPER_FIELD</a> );
00634                     }
00635 
00636                     flag_hyper_field = !flag_hyper_field;
00637                     <span class="keywordflow">continue</span>;
00638                 }
00639 
00640                 <span class="comment">//--------------- space character ------------------//</span>
00641 
00642                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>( textChar == <span class="charliteral">' '</span> ) {
00643                     <span class="keywordflow">if</span>(*(wordPtr-1)!=<span class="charliteral">' '</span>)
00644                         <span class="keywordflow">if</span>(*(wordPtr+1)==<span class="charliteral">' '</span>)
00645                             <span class="keywordflow">break</span>;
00646                     <span class="keywordflow">if</span>( x+<a class="code" href="classFont.html#m8">space_width</a> &gt; x2 )
00647                         <span class="keywordflow">break</span>;
00648 
00649                     x += <a class="code" href="classFont.html#m8">space_width</a>;
00650                 }
00651 
00652                 <span class="comment">//----------- display char ------------//</span>
00653 
00654                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>( textChar &gt;= <a class="code" href="classFont.html#m10">first_char</a> &amp;&amp; textChar &lt;= <a class="code" href="classFont.html#m11">last_char</a> ) {
00655                     <a class="code" href="structFontInfo.html">FontInfo</a>* oldfontInfo = <a class="code" href="classFont.html#m12">font_info_array</a>+textChar-<a class="code" href="classFont.html#m10">first_char</a>;
00656 
00657                     <span class="comment">// character width = offset of next character - current offset</span>
00658 
00659                     <span class="comment">// fix in version 2</span>
00660                     <span class="comment">// if( x2 &gt;= 0 &amp;&amp; x+fontInfo-&gt;width-1 &gt; x2 )      // exceed right border x2</span>
00661                     <span class="comment">// exceed right border x2</span>
00662                     <span class="keywordflow">if</span>( x2 &gt;= 0 &amp;&amp; x+oldfontInfo-&gt;<a class="code" href="structFontInfo.html#m1">width</a>-1 &gt; x2 )
00663                         <span class="keywordflow">break</span>;
00664 
00665                     <span class="comment">// fix in version 2</span>
00666                     <span class="comment">// if( fontInfo-&gt;width &gt; 0 )</span>
00667                     <span class="keywordflow">if</span>( oldfontInfo-&gt;<a class="code" href="structFontInfo.html#m1">width</a> &gt; 0 ) {
00668                         <span class="comment">// fix in version 2</span>
00669                         <span class="comment">//if( dispFlag &amp;&amp; line_count &gt;= startLine-1 )    // startLine start from 1</span>
00670                         <span class="comment">//{</span>
00671                         <span class="keywordflow">if</span>( flag_hyper_field ) {
00672                             <span class="comment">// ## begin chwg 1016</span>
00673                             fontInfo = font_blue_san.font_info_array+textChar-<a class="code" href="classFont.html#m10">first_char</a>;
00674                             <span class="keywordflow">if</span>( dispFlag &amp;&amp; <a class="code" href="classFont.html#m3">line_count</a> &gt;= startLine-1 )
00675                                 font_blue_san.put_char(x,y,textChar);
00676                         }
00677                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( flag_large_casa ) {
00678                             <span class="comment">// ## begin chwg 1016</span>
00679                             fontInfo = font_casa.font_info_array+textChar-<a class="code" href="classFont.html#m10">first_char</a>;
00680                             <span class="keywordflow">if</span>( dispFlag &amp;&amp; <a class="code" href="classFont.html#m3">line_count</a> &gt;= startLine-1 )
00681                                 font_casa.put_char(x,y,textChar);
00682                         }
00683                         <span class="keywordflow">else</span> {
00684                             fontInfo = oldfontInfo;
00685                             <span class="keywordflow">if</span>( dispFlag &amp;&amp; <a class="code" href="classFont.html#m3">line_count</a> &gt;= startLine-1 )
00686                                 <a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;<a class="code" href="classVgaBuf.html#a67">put_bitmap_trans_fast</a>(x, y+fontInfo-&gt;<a class="code" href="structFontInfo.html#m0">offset_y</a>,
00687                                                                        <a class="code" href="classFont.html#m13">font_bitmap_buf</a> + fontInfo-&gt;<a class="code" href="structFontInfo.html#m3">bitmap_offset</a>);
00688                         }
00689 
00690                         <span class="comment">//}</span>
00691                         x += fontInfo-&gt;<a class="code" href="structFontInfo.html#m1">width</a>;
00692                         <span class="comment">// ## end chwg 1016</span>
00693 
00694                     }
00695                 }
00696             }
00697 
00698             <span class="comment">//--------- next line ----------------------//</span>
00699 
00700             <span class="keywordflow">if</span>( *textPtr == <span class="charliteral">'\n'</span> ) {                    <span class="comment">// next line</span>
00701                 <span class="keywordflow">if</span>( <a class="code" href="classFont.html#m3">line_count</a> &gt;= startLine-1 ) {         <span class="comment">// startLine start from 1</span>
00702                     y += <a class="code" href="classFont.html#m4">font_height</a> + lineSpace;
00703                     <span class="keywordflow">if</span> ( y + <a class="code" href="classFont.html#m4">font_height</a> - 1 &gt; y2 )         <span class="comment">// no further space for printing textPtr, end</span>
00704                         <span class="keywordflow">break</span>;
00705                 }
00706 
00707                 x = x1;
00708                 textPtr++;
00709                 <a class="code" href="classFont.html#m3">line_count</a>++;
00710             }
00711 
00712             <span class="keywordflow">if</span>( *textPtr == <a class="code" href="OHELP_8H.html#a0">NULL</a> )                      <span class="comment">// all paragraph has been printed</span>
00713                 <span class="keywordflow">break</span>;
00714 
00715             wordPtr = textPtr;
00716             wordX   = x;
00717             newWord = 0;
00718         }
00719 
00720         <span class="comment">//------------ process spacing -------------//</span>
00721 
00722         <span class="comment">// not space</span>
00723         <span class="keywordflow">if</span>( *textPtr == <span class="charliteral">' '</span> || *textPtr == <span class="charliteral">'\n'</span> || *textPtr == <a class="code" href="OHELP_8H.html#a0">NULL</a> )
00724             newWord = 1;
00725         <span class="keywordflow">else</span> {
00726             textChar = *((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)textPtr);      <span class="comment">// textChar is &lt;unsiged char&gt;</span>
00727 
00728             <span class="comment">//#ifdef GERMAN</span>
00729             <span class="comment">//                  textChar = translate_german_char(textChar);</span>
00730             <span class="comment">//#endif</span>
00731 
00732             <span class="keywordflow">if</span>( textChar &gt;= <a class="code" href="classFont.html#m10">first_char</a> &amp;&amp; textChar &lt;= <a class="code" href="classFont.html#m11">last_char</a> ) {
00733                 fontInfo = <a class="code" href="classFont.html#m12">font_info_array</a>+textChar-<a class="code" href="classFont.html#m10">first_char</a>;
00734 
00735                 <span class="keywordflow">if</span>( textChar == <span class="charliteral">' '</span> )
00736                     x+=<a class="code" href="classFont.html#m8">space_width</a>;
00737 
00738                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>( fontInfo-&gt;<a class="code" href="structFontInfo.html#m1">width</a> &gt; 0 )            <span class="comment">// current font width</span>
00739                     x+=fontInfo-&gt;<a class="code" href="structFontInfo.html#m1">width</a>;
00740 
00741                 <span class="keywordflow">else</span>
00742                     x+=<a class="code" href="classFont.html#m8">space_width</a>;
00743             }
00744             <span class="keywordflow">else</span> {
00745                 x+=<a class="code" href="classFont.html#m8">space_width</a>;
00746             }
00747 
00748             x+=<a class="code" href="classFont.html#m9">inter_char_space</a>;
00749         }
00750 
00751         <span class="keywordflow">if</span>( *textPtr &amp;&amp; *textPtr != <span class="charliteral">'\n'</span> )            <span class="comment">// when finished, remain as NULL for next cycle to detect</span>
00752             textPtr++;
00753     }
00754 
00755     <span class="comment">//------------ finish displaying ----------------//</span>
00756 
00757     <span class="keywordflow">if</span>( dispFlag ) {
00758         <span class="keywordflow">if</span>( !<a class="code" href="classVga.html#p1">Vga::use_back_buf</a> )
00759             mouse.show_area();
00760     }
00761 
00762     <span class="comment">//   while( *textPtr == '\n' || *textPtr == '\r' )</span>
00763     <span class="comment">//      textPtr++;</span>
00764 
00765     <a class="code" href="classFont.html#m1">next_text_ptr</a> = textPtr;                        <span class="comment">// the current pointer in the textPtr</span>
00766     <a class="code" href="classFont.html#m2">next_text_y</a>   = y + <a class="code" href="classFont.html#m4">font_height</a> + lineSpace;
00767     <a class="code" href="classFont.html#m3">line_count</a>++;
00768 }
00769 
00770 <span class="comment">//---------- End of function Font::put_paragraph ------//</span>
00771 
00772 <span class="comment">//--------- Begin of function Font::find_splitter ------//</span>
<a name="l00777"></a><a class="code" href="classFont.html#a19">00777</a> <span class="comment">int Font::find_splitter(int area_width, int start_char, char *textPtr) {</span>
00778     <a class="code" href="classString.html">String</a> str=textPtr;
00779     <span class="keywordtype">int</span> width_measure=0;
00780     <span class="keywordtype">int</span> last_splitter=start_char;
00781     <span class="keywordtype">int</span> i=start_char;
00782     <span class="keywordflow">while</span>(width_measure&lt;area_width&amp;&amp;str[i]!=<a class="code" href="OHELP_8H.html#a0">NULL</a>) {
00783         <span class="keywordflow">if</span>(str[i]==<span class="charliteral">'\n'</span>||str[i]==<span class="charliteral">' '</span>||str[i]==<a class="code" href="OHELP_8H.html#a0">NULL</a>)
00784             last_splitter=i;
00785 
00786         <span class="keywordflow">if</span>( str[i] &gt;= first_char &amp;&amp; str[i] &lt;= last_char ) {
00787             <span class="keywordtype">int</span> charWidth = font_info_array[str[i]-first_char].width;
00788             <span class="keywordflow">if</span>(str[i]==<span class="charliteral">' '</span>)charWidth=space_width;
00789             width_measure += charWidth;
00790         }
00791         i++;
00792     }
00793 
00794     <span class="keywordflow">if</span>(str[i]==<a class="code" href="OHELP_8H.html#a0">NULL</a>)
00795         last_splitter=i;
00796 
00797     <span class="keywordflow">return</span> last_splitter;
00798 }
00799 
00800 <span class="comment">//---------- End of function Font::find_splitter ------//</span>
00801 
00802 <span class="comment">//--------- Begin of function Font::get_line ------//</span>
00807 <span class="comment">char* Font::get_line(int area_width, int line, char *textPtr) {</span>
00808     <span class="keywordtype">int</span> ptr1,ptr2;
00809     <a class="code" href="classString.html">String</a> str=textPtr;
00810 
00811     ptr1=0;
00812 
00813     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;line;i++) {
00814         ptr2=find_splitter(area_width, ptr1, str.<a class="code" href="classString.html#m0">str_buf</a>);
00815         <span class="keywordflow">if</span>(i==line-1)
00816             <span class="keywordflow">return</span> str.<a class="code" href="classString.html#a9">substr</a>(ptr1,ptr2-ptr1);
00817         ptr1=ptr2+1;
00818     }
00819     <span class="keywordflow">return</span> <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00820 }
00821 
00822 <span class="comment">//---------- End of function Font::find_splitter ------//</span>
00823 
00824 <span class="comment">//--------- Begin of function Font::count_line ------//</span>
<a name="l00828"></a><a class="code" href="classFont.html#a21">00828</a> <span class="comment">int Font::count_line(int area_width, char *textPtr) {</span>
00829     <span class="keywordtype">int</span> ptr1,ptr2,line;
00830     <a class="code" href="classString.html">String</a> str=textPtr;
00831 
00832     ptr1=0;
00833     ptr2=-1;
00834     line=0;
00835     <span class="keywordflow">while</span>(1) {
00836         ptr2=find_splitter(area_width, ptr1, str.<a class="code" href="classString.html#m0">str_buf</a>);
00837         <span class="keywordflow">if</span>(ptr1==ptr2)<span class="keywordflow">break</span>;
00838         ptr1=ptr2+1;
00839         line++;
00840     }
00841     <span class="keywordflow">return</span> line;
00842 }
00843 
00844 <span class="comment">//---------- End of function Font::find_splitter ------//</span>
00845 
00846 <span class="comment">//--------- Begin of function Font::count_line ------//</span>
<a name="l00859"></a><a class="code" href="classFont.html#a20">00859</a> <span class="comment">void Font::count_line(int x1, int y1, int x2, int y2, char *textPtr,</span>
00860                       <span class="keywordtype">int</span> lineSpace , <span class="keywordtype">int</span>&amp; dispLines, <span class="keywordtype">int</span>&amp; totalLines) {
00861     dispLines =0;
00862     totalLines=0;
00863 
00864     <span class="keywordflow">while</span>( *textPtr ) {                             <span class="comment">// if *textPtr==NULL means EOF</span>
00865         <span class="comment">// last 0-means don't display the textPtr, only returning the parameters for our calculating of line counts</span>
00866         put_paragraph(x1, y1, x2, y2, textPtr, lineSpace, 1, 0);
00867 
00868         <span class="keywordflow">if</span>( !dispLines )                              <span class="comment">// only set once at the first time</span>
00869             dispLines = line_count;
00870 
00871         totalLines += line_count;
00872         textPtr     = next_text_ptr;
00873     }
00874 }
00875 
00876 <span class="comment">//---------- End of function Font::count_line ------//</span>
00877 
00878 <span class="comment">//-------- Begin of function Font::d3_put --------//</span>
<a name="l00887"></a><a class="code" href="classFont.html#a14">00887</a> <span class="comment">int Font::d3_put(int x1, int y1, char* desStr ) {</span>
00888     <span class="keywordtype">int</span> marginSpace = font_height/5;
00889 
00890     <span class="keywordtype">int</span> x2 = x1+text_width(desStr)+marginSpace*2-1;
00891 
00892     vga.active_buf-&gt;d3_panel_up( x1, y1, x2, y1+font_height+marginSpace*2-1 );
00893 
00894     put( x1+marginSpace, y1+marginSpace, desStr);
00895 
00896     <span class="keywordflow">return</span> x2;
00897 }
00898 
00899 <span class="comment">//--------- End of function Font::d3_put ---------//</span>
00900 
00901 <span class="comment">//-------- Begin of function Font::d3_put --------//</span>
<a name="l00910"></a><a class="code" href="classFont.html#a15">00910</a> <span class="comment">void Font::d3_put(int x1, int y1, int x2, int y2, char* desStr) {</span>
00911     <span class="keywordtype">int</span> tx = x1 + ((x2-x1+1) - text_width(desStr))/2;
00912     <span class="keywordtype">int</span> ty = y1 + ((y2-y1+1) - font_height)/2+1;
00913 
00914     vga.active_buf-&gt;d3_panel_up( x1, y1, x2, y2);
00915 
00916     <span class="keywordflow">if</span>( tx&lt;x1+2 )
00917         tx=x1+2;
00918 
00919     put( tx, ty, desStr, 0, x2-2 );
00920 }
00921 
00922 <span class="comment">//--------- End of function Font::d3_put ---------//</span>
00923 
00924 <span class="comment">//-------- Begin of function Font::center_put --------//</span>
<a name="l00936"></a><a class="code" href="classFont.html#a16">00936</a> <span class="comment">int Font::center_put(int x1, int y1, int x2, int y2, char* desStr, char clearBack) {</span>
00937     <span class="keywordtype">int</span> tx = x1 + ((x2-x1+1) - text_width(desStr))/2;
00938     <span class="keywordtype">int</span> ty = y1 + ((y2-y1+1) - font_height)/2;
00939 
00940     <span class="keywordflow">if</span>( tx&lt;0 )
00941         tx=0;
00942 
00943     <span class="keywordflow">if</span>( clearBack &amp;&amp; !<a class="code" href="classVga.html#p1">Vga::use_back_buf</a> &amp;&amp; tx&gt;x1 )  <span class="comment">// copy texture from the back buffer as the background color</span>
00944         vga.blt_buf( x1, y1, tx-1, y2 );
00945 
00946     <span class="keywordflow">return</span> put( tx, ty, desStr, clearBack, x2 );
00947 }
00948 
00949 <span class="comment">//--------- End of function Font::center_put ---------//</span>
00950 
00951 <span class="comment">//-------- Begin of function Font::put_field --------//</span>
<a name="l00967"></a><a class="code" href="classFont.html#a29">00967</a> <span class="comment">void Font::put_field(int x1, int y1, char* desStr, int x2, int value, int format ) {</span>
00968     vga.active_buf-&gt;d3_panel_up( x1, y1, x2, y1+font_height+3 );
00969 
00970     put( x1+4, y1+2, desStr);
00971     put( x2+4, y1+2, m.format(value,format) );
00972 }
00973 
00974 <span class="comment">//--------- End of function Font::put_field ---------//</span>
00975 
00976 <span class="comment">//-------- Begin of function Font::update_field --------//</span>
<a name="l00991"></a><a class="code" href="classFont.html#a30">00991</a> <span class="comment">void Font::update_field(int x1, int y1, int value, int format, int x2) {</span>
00992     <span class="keywordflow">if</span>( x2&lt;0 )
00993         x2 = x1+80;
00994 
00995     put( x1+4, y1+2, m.format(value,format), 1, x2 );
00996 }
00997 
00998 <span class="comment">//--------- End of function Font::update_field ---------//</span>
00999 
01000 <span class="comment">//-------- Begin of function Font::field --------//</span>
<a name="l01020"></a><a class="code" href="classFont.html#a31">01020</a> <span class="comment">void Font::field(int xDes, int y1, char* desStr, int xValue, int value,</span>
01021                  <span class="keywordtype">int</span> format, <span class="keywordtype">int</span> xEnd, <span class="keywordtype">int</span> refreshFlag, <span class="keywordtype">char</span>* helpCode) {
01022     <span class="keywordtype">int</span> x2;
01023 
01024     <span class="keywordflow">if</span>( refreshFlag == <a class="code" href="Gamedef_8h.html#a71a16">INFO_REPAINT</a> ) {
01025         vga.active_buf-&gt;d3_panel_up( xDes, y1, xValue, y1+font_height+3 );
01026 
01027         put( xDes+4  , y1+2, desStr);
01028         x2 = put( xValue+4, y1+2, m.format(value,format) );
01029     }
01030     <span class="keywordflow">else</span> {
01031         vga.active_buf-&gt;d3_panel_up( xDes, y1, xValue, y1+font_height+3 );
01032         put( xDes+4  , y1+2, desStr);
01033         x2 = put( xValue+4, y1+2, m.format(value,format), 1, xEnd );
01034     }
01035 
01036     <span class="comment">//  if( helpCode )</span>
01037     <span class="comment">//          help.set_help(xDes, y1, x2, y1+font_height+3, helpCode );</span>
01038 }
01039 
01040 <span class="comment">//--------- End of function Font::field ---------//</span>
01041 
01042 <span class="comment">//-------- Begin of function Font::put_field --------//</span>
<a name="l01058"></a><a class="code" href="classFont.html#a41">01058</a> <span class="comment">void Font::put_field(int x1, int y1, char* desStr, int x2, double value, int format) {</span>
01059     vga.active_buf-&gt;d3_panel_up( x1, y1, x2, y1+font_height+3 );
01060 
01061     put( x1+4, y1+2, desStr);
01062     put( x2+4, y1+2, m.format(value,format) );
01063 }
01064 
01065 <span class="comment">//--------- End of function Font::put_field ---------//</span>
01066 
01067 <span class="comment">//-------- Begin of function Font::update_field --------//</span>
<a name="l01082"></a><a class="code" href="classFont.html#a42">01082</a> <span class="comment">void Font::update_field(int x1, int y1, double value, int format, int x2) {</span>
01083     <span class="keywordflow">if</span>( x2&lt;0 )
01084         x2 = x1+80;
01085 
01086     put( x1+4, y1+2, m.format(value,format), 1, x2 );
01087 }
01088 
01089 <span class="comment">//--------- End of function Font::update_field ---------//</span>
01090 
01091 <span class="comment">//-------- Begin of function Font::field --------//</span>
<a name="l01111"></a><a class="code" href="classFont.html#a43">01111</a> <span class="comment">void Font::field(int xDes, int y1, char* desStr, int xValue, double value,</span>
01112                  <span class="keywordtype">int</span> format, <span class="keywordtype">int</span> xEnd, <span class="keywordtype">int</span> refreshFlag, <span class="keywordtype">char</span>* helpCode ) {
01113     <span class="keywordtype">int</span> x2;
01114 
01115     <span class="keywordflow">if</span>( refreshFlag == <a class="code" href="Gamedef_8h.html#a71a16">INFO_REPAINT</a> ) {
01116         vga.active_buf-&gt;d3_panel_up( xDes, y1, xValue, y1+font_height+3 );
01117 
01118         put( xDes+4  , y1+2, desStr);
01119         x2 = put( xValue+4, y1+2, m.format(value,format) );
01120     }
01121     <span class="keywordflow">else</span> {
01122         vga.active_buf-&gt;d3_panel_up( xDes, y1, xValue, y1+font_height+3 );
01123 
01124         put( xDes+4  , y1+2, desStr);
01125         x2 = put( xValue+4, y1+2, m.format(value,format), 1, xEnd );
01126     }
01127 
01128     <span class="comment">//  if( helpCode )</span>
01129     <span class="comment">//          help.set_help(xDes, y1, x2, y1+font_height+3, helpCode );</span>
01130 }
01131 
01132 <span class="comment">//--------- End of function Font::field ---------//</span>
01133 
01134 <span class="comment">//-------- Begin of function Font::put_field --------//</span>
<a name="l01145"></a><a class="code" href="classFont.html#a45">01145</a> <span class="comment">void Font::put_field(int x1, int y1, char* desStr, int x2, char* value) {</span>
01146     vga.active_buf-&gt;d3_panel_up( x1, y1, x2, y1+font_height+3 );
01147 
01148     put( x1+4, y1+2, desStr);
01149     put( x2+4, y1+2, value);
01150 }
01151 
01152 <span class="comment">//--------- End of function Font::put_field ---------//</span>
01153 
01154 <span class="comment">//-------- Begin of function Font::update_field --------//</span>
<a name="l01163"></a><a class="code" href="classFont.html#a46">01163</a> <span class="comment">void Font::update_field(int x1, int y1, char* value, int x2) {</span>
01164     <span class="keywordflow">if</span>( x2&lt;0 )
01165         x2 = x1+80;
01166 
01167     put( x1+4, y1+2, value, 1, x2 );
01168 }
01169 
01170 <span class="comment">//--------- End of function Font::update_field ---------//</span>
01171 
01172 <span class="comment">//-------- Begin of function Font::field --------//</span>
<a name="l01188"></a><a class="code" href="classFont.html#a47">01188</a> <span class="comment">void Font::field(int xDes, int y1, char* desStr, int xValue, char* value,</span>
01189                  <span class="keywordtype">int</span> xEnd, <span class="keywordtype">int</span> refreshFlag, <span class="keywordtype">char</span>* helpCode ) {
01190     <span class="keywordtype">int</span> x2;
01191 
01192     <span class="keywordflow">if</span>( refreshFlag == <a class="code" href="Gamedef_8h.html#a71a16">INFO_REPAINT</a> ) {
01193         vga.active_buf-&gt;d3_panel_up( xDes, y1, xValue, y1+font_height+3 );
01194 
01195         put( xDes+4  , y1+2, desStr);
01196         x2 = put( xValue+4, y1+2, value );
01197     }
01198     <span class="keywordflow">else</span> {
01199         vga.active_buf-&gt;d3_panel_up( xDes, y1, xValue, y1+font_height+3 );
01200 
01201         put( xDes+4  , y1+2, desStr);
01202         x2 = put( xValue+4, y1+2, value, 1, xEnd );
01203     }
01204 
01205     <span class="comment">//  if( helpCode )</span>
01206     <span class="comment">//          help.set_help(xDes, y1, x2, y1+font_height+3, helpCode );</span>
01207 }
01208 
01209 <span class="comment">//--------- End of function Font::field ---------//</span>
01210 
01211 <span class="comment">//-------- Begin of function Font::disp --------//</span>
<a name="l01227"></a><a class="code" href="classFont.html#a32">01227</a> <span class="comment">int Font::disp(int x1, int y1, int value, int format, int x2) {</span>
01228     <span class="keywordflow">if</span>( x2&lt;0 )
01229         x2 = x1+80;
01230 
01231     <span class="keywordtype">int</span> lastX = put( x1, y1, m.format(value,format), 1, x2 );
01232 
01233     <span class="keywordflow">return</span> lastX;
01234 }
01235 
01236 <span class="comment">//--------- End of function Font::disp ---------//</span>
01237 
01238 <span class="comment">//-------- Begin of function Font::disp --------//</span>
<a name="l01254"></a><a class="code" href="classFont.html#a44">01254</a> <span class="comment">int Font::disp(int x1, int y1, double value, int format, int x2) {</span>
01255     <span class="keywordflow">if</span>( x2&lt;0 )
01256         x2 = x1+80;
01257 
01258     <span class="keywordtype">int</span> lastX = put( x1, y1, m.format(value,format), 1, x2 );
01259 
01260     <span class="keywordflow">return</span> lastX;
01261 }
01262 
01263 <span class="comment">//--------- End of function Font::disp ---------//</span>
01264 
01265 <span class="comment">//-------- Begin of function Font::disp --------//</span>
<a name="l01275"></a><a class="code" href="classFont.html#a48">01275</a> <span class="comment">int Font::disp(int x1, int y1, char* textPtr, int x2) {</span>
01276     <span class="keywordflow">if</span>( x2&lt;0 )
01277         x2 = x1+80;
01278 
01279     <span class="keywordtype">int</span> lastX = put( x1, y1, textPtr, 1, x2 );
01280 
01281     <span class="keywordflow">return</span> lastX;
01282 }
01283 
01284 <span class="comment">//--------- End of function Font::disp ---------//</span>
01285 
01286 <span class="comment">//--------- Begin of function Font::put_char_to_buffer ---------//</span>
<a name="l01287"></a><a class="code" href="classFont.html#a22">01287</a> <span class="keywordtype">void</span> <a class="code" href="classFont.html#a22">Font::put_char_to_buffer</a>(<span class="keywordtype">char</span>* dest, <span class="keywordtype">int</span> destPitch, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> textChar) {
01288     <span class="keywordflow">if</span>( textChar &gt;= <a class="code" href="classFont.html#m10">first_char</a> &amp;&amp; textChar &lt;= <a class="code" href="classFont.html#m11">last_char</a> ) {
01289         <a class="code" href="structFontInfo.html">FontInfo</a>* fontInfo = <a class="code" href="classFont.html#m12">font_info_array</a>+textChar-<a class="code" href="classFont.html#m10">first_char</a>;
01290         <span class="keywordtype">char</span> *fontBitmap = <a class="code" href="classFont.html#m13">font_bitmap_buf</a> + fontInfo-&gt;<a class="code" href="structFontInfo.html#m3">bitmap_offset</a>;
01291 
01292         <a class="code" href="ALL_8H.html#a1">err_here</a>();                                   <span class="comment">// 8-8 bit not supported</span>
01293         <span class="comment">// IMGbltTrans( dest, destPitch, x, y + fontInfo-&gt;offset_y, fontBitmap );</span>
01294     }
01295 }
01296 
01297 <span class="comment">//--------- End of function Font::put_char_to_buffer ---------//</span>
01298 
01299 <span class="comment">//--------- Begin of function Font::put_to_buffer ---------//</span>
<a name="l01300"></a><a class="code" href="classFont.html#a23">01300</a> <span class="keywordtype">void</span> <a class="code" href="classFont.html#a23">Font::put_to_buffer</a>(<span class="keywordtype">char</span>* dest, <span class="keywordtype">int</span> destPitch, <span class="keywordtype">int</span> x1, <span class="keywordtype">int</span> y1, <span class="keywordtype">char</span> *text) {
01301     <span class="keywordtype">int</span> x2 = destPitch;                             <span class="comment">// width of buffer</span>
01302     <span class="keywordflow">while</span>( *text != <span class="charliteral">'\0'</span> &amp;&amp; x1 &lt; x2) {
01303         <span class="keywordtype">int</span> charSize = <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>);         <span class="comment">// 1 for byte character, 2 for word character</span>
01304         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> textChar = *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)text;
01305 
01306         <span class="comment">//#ifdef GERMAN</span>
01307         <span class="comment">//              textChar = translate_german_char(textChar);</span>
01308         <span class="comment">//#endif</span>
01309 
01310         <span class="comment">//if( // unicode or a word character )</span>
01311         <span class="comment">//{</span>
01312         <span class="comment">//      textChar = *(unsigned short *)buffer;                   // unicode</span>
01313         <span class="comment">// textChar = *(unsigned char *)text &lt;&lt; 8 + *(1+(unsigned char *)text); // big-5...</span>
01314         <span class="comment">//      charSize = sizeof(unsigned short);</span>
01315         <span class="comment">//}</span>
01316 
01317         <span class="comment">// --------- advance to next character------------//</span>
01318 
01319         <span class="keywordtype">int</span> charWidth = textChar == <span class="charliteral">' '</span> ? <a class="code" href="classFont.html#m8">space_width</a> :
01320             (<a class="code" href="classFont.html#m12">font_info_array</a>+textChar-<a class="code" href="classFont.html#m10">first_char</a>)-&gt;width;
01321 
01322         <span class="keywordflow">if</span>( x1 + charWidth &lt;= x2 )
01323             <a class="code" href="classFont.html#a22">put_char_to_buffer</a>( dest, destPitch, x1, y1, textChar);
01324 
01325         x1 += charWidth;
01326         text += charSize;
01327     }
01328 }
01329 
01330 <span class="comment">//--------- End of function Font::put_to_buffer ---------//</span>
01331 
01332 <span class="comment">//--------- Begin of function Font::center_put_to_buffer ---------//</span>
<a name="l01333"></a><a class="code" href="classFont.html#a24">01333</a> <span class="keywordtype">void</span> <a class="code" href="classFont.html#a24">Font::center_put_to_buffer</a>(<span class="keywordtype">char</span>* dest, <span class="keywordtype">int</span> destPitch, <span class="keywordtype">int</span> x1, <span class="keywordtype">int</span> y1, <span class="keywordtype">int</span> x2, <span class="keywordtype">int</span> y2, <span class="keywordtype">char</span> *desStr) {
01334     <span class="keywordtype">int</span> tx = x1 + ((x2-x1) - <a class="code" href="classFont.html#a8">text_width</a>(desStr))/2;
01335     <span class="keywordtype">int</span> ty = y1 + ((y2-y1) - <a class="code" href="classFont.html#m4">font_height</a>)/2;
01336 
01337     <span class="keywordflow">if</span>( tx&lt;0 )
01338         tx=0;
01339 
01340     <a class="code" href="classFont.html#a23">put_to_buffer</a>( dest, destPitch, tx, ty, desStr);
01341 }
01342 
01343 <span class="comment">//--------- End of function Font::center_put_to_buffer ---------//</span>
01344 
01345 <span class="comment">//--------- Begin of function Font::put_char_to_bufferW ---------//</span>
<a name="l01346"></a><a class="code" href="classFont.html#a25">01346</a> <span class="keywordtype">void</span> <a class="code" href="classFont.html#a25">Font::put_char_to_bufferW</a>(<span class="keywordtype">short</span>* dest, <span class="keywordtype">int</span> destPitch, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> textChar) {
01347     <span class="keywordflow">if</span>( textChar &gt;= <a class="code" href="classFont.html#m10">first_char</a> &amp;&amp; textChar &lt;= <a class="code" href="classFont.html#m11">last_char</a> ) {
01348         <a class="code" href="structFontInfo.html">FontInfo</a>* fontInfo = <a class="code" href="classFont.html#m12">font_info_array</a>+textChar-<a class="code" href="classFont.html#m10">first_char</a>;
01349         <span class="keywordtype">char</span> *fontBitmap = <a class="code" href="classFont.html#m13">font_bitmap_buf</a> + fontInfo-&gt;<a class="code" href="structFontInfo.html#m3">bitmap_offset</a>;
01350 
01351         <a class="code" href="IMGFUN_8H.html#a14">IMGbltTransRemap</a>( dest, destPitch, x, y + fontInfo-&gt;<a class="code" href="structFontInfo.html#m0">offset_y</a>, fontBitmap, vga.default_remap_table );
01352     }
01353 }
01354 
01355 <span class="comment">//--------- End of function Font::put_char_to_bufferW ---------//</span>
01356 
01357 <span class="comment">//--------- Begin of function Font::put_to_bufferW ---------//</span>
<a name="l01358"></a><a class="code" href="classFont.html#a26">01358</a> <span class="keywordtype">void</span> <a class="code" href="classFont.html#a26">Font::put_to_bufferW</a>(<span class="keywordtype">short</span>* dest, <span class="keywordtype">int</span> destPitch, <span class="keywordtype">int</span> x1, <span class="keywordtype">int</span> y1, <span class="keywordtype">char</span> *text) {
01359     <span class="keywordtype">int</span> x2 = destPitch;                             <span class="comment">// width of buffer</span>
01360     <span class="keywordflow">while</span>( *text != <span class="charliteral">'\0'</span> &amp;&amp; x1 &lt; x2) {
01361         <span class="keywordtype">int</span> charSize = <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>);         <span class="comment">// 1 for byte character, 2 for word character</span>
01362         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> textChar = *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)text;
01363 
01364         <span class="comment">// --------- advance to next character------------//</span>
01365 
01366         <span class="keywordtype">int</span> charWidth = textChar == <span class="charliteral">' '</span> ? <a class="code" href="classFont.html#m8">space_width</a> :
01367             (<a class="code" href="classFont.html#m12">font_info_array</a>+textChar-<a class="code" href="classFont.html#m10">first_char</a>)-&gt;width;
01368 
01369         <span class="keywordflow">if</span>( x1 + charWidth &lt;= x2 )
01370             <a class="code" href="classFont.html#a25">put_char_to_bufferW</a>( dest, destPitch, x1, y1, textChar);
01371 
01372         x1 += charWidth;
01373         text += charSize;
01374     }
01375 }
01376 
01377 <span class="comment">//--------- End of function Font::put_to_bufferW ---------//</span>
01378 
01379 <span class="comment">//--------- Begin of function Font::center_put_to_bufferW ---------//</span>
<a name="l01380"></a><a class="code" href="classFont.html#a27">01380</a> <span class="keywordtype">void</span> <a class="code" href="classFont.html#a27">Font::center_put_to_bufferW</a>(<span class="keywordtype">short</span>* dest, <span class="keywordtype">int</span> destPitch, <span class="keywordtype">int</span> x1, <span class="keywordtype">int</span> y1, <span class="keywordtype">int</span> x2, <span class="keywordtype">int</span> y2, <span class="keywordtype">char</span> *desStr) {
01381     <span class="keywordtype">int</span> tx = x1 + ((x2-x1) - <a class="code" href="classFont.html#a8">text_width</a>(desStr))/2;
01382     <span class="keywordtype">int</span> ty = y1 + ((y2-y1) - <a class="code" href="classFont.html#m4">font_height</a>)/2;
01383 
01384     <span class="keywordflow">if</span>( tx&lt;0 )
01385         tx=0;
01386 
01387     <a class="code" href="classFont.html#a26">put_to_bufferW</a>( dest, destPitch, tx, ty, desStr);
01388 }
01389 
01390 <span class="comment">//--------- End of function Font::center_put_to_bufferW ---------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:41 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
