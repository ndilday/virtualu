<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>JACOBI.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>JACOBI.CPP</h1><a href="JACOBI_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Owner: Fred</span>
00002 <span class="comment">//$$jacobi.cpp                           jacobi eigenvalue analysis</span>
00003 
00004 <span class="comment">// Copyright (C) 1991,2,3,4: R B Davies</span>
00005 
00006 <span class="comment">//#define WANT_STREAM</span>
00007 
<a name="l00008"></a><a class="code" href="JACOBI_8CPP.html#a0">00008</a> <span class="preprocessor">#define WANT_MATH</span>
00009 <span class="preprocessor"></span>
00010 <span class="preprocessor">#include "include.h"</span>
00011 <span class="preprocessor">#include "newmat.h"</span>
00012 <span class="preprocessor">#include "precisio.h"</span>
00013 <span class="preprocessor">#include "newmatrm.h"</span>
00014 
00015 <span class="preprocessor">#ifdef use_namespace</span>
00016 <span class="preprocessor"></span><span class="keyword">namespace </span>NEWMAT {
00017 <span class="preprocessor">#endif</span>
00018 <span class="preprocessor"></span>
<a name="l00019"></a><a class="code" href="namespaceNEWMAT.html#a15">00019</a>     <span class="keywordtype">void</span> <a class="code" href="namespaceNEWMAT.html#a15">Jacobi</a>(<span class="keyword">const</span> <a class="code" href="classNEWMAT_1_1SymmetricMatrix.html">SymmetricMatrix</a>&amp; X, <a class="code" href="classNEWMAT_1_1DiagonalMatrix.html">DiagonalMatrix</a>&amp; D, <a class="code" href="classNEWMAT_1_1SymmetricMatrix.html">SymmetricMatrix</a>&amp; A,
00020                 <a class="code" href="classNEWMAT_1_1Matrix.html">Matrix</a>&amp; V, <span class="keywordtype">bool</span> eivec) {
00021         <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> epsilon = FloatingPointPrecision::Epsilon();
00022         <a class="code" href="classTracer.html">Tracer</a> et(<span class="stringliteral">"Jacobi"</span>);
00023         <span class="keywordtype">int</span> n = X.<a class="code" href="classNEWMAT_1_1GeneralMatrix.html#a2">Nrows</a>(); <a class="code" href="classNEWMAT_1_1DiagonalMatrix.html">DiagonalMatrix</a> B(n), Z(n); D.<a class="code" href="classNEWMAT_1_1DiagonalMatrix.html#a25">ReSize</a>(n); A = X;
00024         <span class="keywordflow">if</span> (eivec) { V.<a class="code" href="classNEWMAT_1_1Matrix.html#a21">ReSize</a>(n,n); D = 1.0; V = D; }
00025         B &lt;&lt; A; D = B; Z = 0.0; A.<a class="code" href="classNEWMAT_1_1GeneralMatrix.html#a17">Inject</a>(Z);
00026         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1; i&lt;=50; i++) {
00027             <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> sm=0.0; <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* a = A.<a class="code" href="classNEWMAT_1_1GeneralMatrix.html#a5">Store</a>(); <span class="keywordtype">int</span> p = A.<a class="code" href="classNEWMAT_1_1GeneralMatrix.html#a4">Storage</a>();
00028             <span class="keywordflow">while</span> (p--) sm += <a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(*a++);               <span class="comment">// have previously zeroed diags</span>
00029             <span class="keywordflow">if</span> (sm==0.0) <span class="keywordflow">return</span>;
00030             <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> tresh = (i&lt;4) ? 0.2 * sm / <a class="code" href="namespaceNEWMAT.html#a1">square</a>(n) : 0.0; a = A.<a class="code" href="classNEWMAT_1_1GeneralMatrix.html#a5">Store</a>();
00031             <span class="keywordflow">for</span> (p = 0; p &lt; n; p++) {
00032                 <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* ap1 = a + (p*(p+1))/2;
00033                 <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>&amp; zp = Z.<a class="code" href="classNEWMAT_1_1DiagonalMatrix.html#a11">element</a>(p); <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>&amp; dp = D.<a class="code" href="classNEWMAT_1_1DiagonalMatrix.html#a11">element</a>(p);
00034                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> q = p+1; q &lt; n; q++) {
00035                     <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* ap = ap1; <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* aq = a + (q*(q+1))/2;
00036                     <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>&amp; zq = Z.<a class="code" href="classNEWMAT_1_1DiagonalMatrix.html#a11">element</a>(q); <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>&amp; dq = D.<a class="code" href="classNEWMAT_1_1DiagonalMatrix.html#a11">element</a>(q);
00037                     <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>&amp; apq = A.<a class="code" href="classNEWMAT_1_1SymmetricMatrix.html#a7">element</a>(q,p);
00038                     <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> g = 100 * <a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(apq); <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> adp = <a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(dp); <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> adq = <a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(dq);
00039 
00040                     <span class="keywordflow">if</span> (i&gt;4 &amp;&amp; g &lt; epsilon*adp &amp;&amp; g &lt; epsilon*adq) apq = 0.0;
00041                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(apq) &gt; tresh) {
00042                         <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> t; <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> h = dq - dp; <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> ah = <a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(h);
00043                         <span class="keywordflow">if</span> (g &lt; epsilon*ah) t = apq / h;
00044                         <span class="keywordflow">else</span> {
00045                             <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> theta = 0.5 * h / apq;
00046                             t = 1.0 / ( <a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(theta) + sqrt(1.0 + <a class="code" href="namespaceNEWMAT.html#a1">square</a>(theta)) );
00047                             <span class="keywordflow">if</span> (theta&lt;0.0) t = -t;
00048                         }
00049                         <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> c = 1.0 / sqrt(1.0 + <a class="code" href="namespaceNEWMAT.html#a1">square</a>(t)); <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> s = t * c;
00050                         <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> tau = s / (1.0 + c); h = t * apq;
00051                         zp -= h; zq += h; dp -= h; dq += h; apq = 0.0;
00052                         <span class="keywordtype">int</span> j = p;
00053                         <span class="keywordflow">while</span> (j--) {
00054                             g = *ap; h = *aq;
00055                             *ap++ = g-s*(h+g*tau); *aq++ = h+s*(g-h*tau);
00056                         }
00057                         <span class="keywordtype">int</span> ip = p+1; j = q-ip; ap += ip++; aq++;
00058                         <span class="keywordflow">while</span> (j--) {
00059                             g = *ap; h = *aq;
00060                             *ap = g-s*(h+g*tau); *aq++ = h+s*(g-h*tau);
00061                             ap += ip++;
00062                         }
00063                         <span class="keywordtype">int</span> iq = q+1; j = n-iq; ap += ip++; aq += iq++;
00064                         <span class="keywordflow">while</span> (j--) {
00065                             g = *ap; h = *aq;
00066                             *ap = g-s*(h+g*tau); *aq = h+s*(g-h*tau);
00067                             ap += ip++; aq += iq++;
00068                         }
00069                         <span class="keywordflow">if</span> (eivec) {
00070                             <a class="code" href="classRectMatrixCol.html">RectMatrixCol</a> VP(V,p); <a class="code" href="classRectMatrixCol.html">RectMatrixCol</a> VQ(V,q);
00071                             <a class="code" href="NEWMATRM_8CPP.html#a1">Rotate</a>(VP, VQ, tau, s);
00072                         }
00073                     }
00074                 }
00075             }
00076             B = B + Z; D = B; Z = 0.0;
00077         }
00078         Throw(<a class="code" href="classNEWMAT_1_1ConvergenceException.html">ConvergenceException</a>(X));
00079     }
00080 
<a name="l00081"></a><a class="code" href="namespaceNEWMAT.html#a16">00081</a>     <span class="keywordtype">void</span> <a class="code" href="namespaceNEWMAT.html#a15">Jacobi</a>(<span class="keyword">const</span> <a class="code" href="classNEWMAT_1_1SymmetricMatrix.html">SymmetricMatrix</a>&amp; X, <a class="code" href="classNEWMAT_1_1DiagonalMatrix.html">DiagonalMatrix</a>&amp; D)
00082     { <a class="code" href="classNEWMAT_1_1SymmetricMatrix.html">SymmetricMatrix</a> A; <a class="code" href="classNEWMAT_1_1Matrix.html">Matrix</a> V; <a class="code" href="namespaceNEWMAT.html#a15">Jacobi</a>(X,D,A,V,<span class="keyword">false</span>); }
00083 
<a name="l00084"></a><a class="code" href="namespaceNEWMAT.html#a17">00084</a>     <span class="keywordtype">void</span> <a class="code" href="namespaceNEWMAT.html#a15">Jacobi</a>(<span class="keyword">const</span> <a class="code" href="classNEWMAT_1_1SymmetricMatrix.html">SymmetricMatrix</a>&amp; X, <a class="code" href="classNEWMAT_1_1DiagonalMatrix.html">DiagonalMatrix</a>&amp; D, <a class="code" href="classNEWMAT_1_1SymmetricMatrix.html">SymmetricMatrix</a>&amp; A)
00085     { <a class="code" href="classNEWMAT_1_1Matrix.html">Matrix</a> V; <a class="code" href="namespaceNEWMAT.html#a15">Jacobi</a>(X,D,A,V,<span class="keyword">false</span>); }
00086 
<a name="l00087"></a><a class="code" href="namespaceNEWMAT.html#a18">00087</a>     <span class="keywordtype">void</span> <a class="code" href="namespaceNEWMAT.html#a15">Jacobi</a>(<span class="keyword">const</span> <a class="code" href="classNEWMAT_1_1SymmetricMatrix.html">SymmetricMatrix</a>&amp; X, <a class="code" href="classNEWMAT_1_1DiagonalMatrix.html">DiagonalMatrix</a>&amp; D, <a class="code" href="classNEWMAT_1_1Matrix.html">Matrix</a>&amp; V)
00088     { <a class="code" href="classNEWMAT_1_1SymmetricMatrix.html">SymmetricMatrix</a> A; <a class="code" href="namespaceNEWMAT.html#a15">Jacobi</a>(X,D,A,V,<span class="keyword">true</span>); }
00089 
00090 <span class="preprocessor">#ifdef use_namespace</span>
00091 <span class="preprocessor"></span>}
00092 <span class="preprocessor">#endif</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:02 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
