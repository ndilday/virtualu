<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Otaskend.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Otaskend.cpp</h1><a href="Otaskend_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OTASKEND.CPP</span>
00002 <span class="comment">//Description : Object TaskArray; related functions.</span>
00003 <span class="comment">//Owner                 :Fred</span>
00004 
00005 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00006 
00007 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>
00008 <span class="preprocessor">#include &lt;ODEPT.H&gt;</span>
00009 <span class="preprocessor">#include &lt;OPSCHOOL.H&gt;</span>
00010 <span class="preprocessor">#include &lt;<a class="code" href="OTASK_8H.html">OTASK.H</a>&gt;</span>
00011 <span class="preprocessor">#include &lt;<a class="code" href="ODATE_8H.html">ODATE.H</a>&gt;</span>
00012 <span class="preprocessor">#include &lt;<a class="code" href="OSTR_8H.html">OSTR.H</a>&gt;</span>
00013 <span class="preprocessor">#include &lt;OCHANCE.H&gt;</span>
00014 
00015 <span class="comment">//--------- Define variable type ----------//</span>
00016 
<a name="l00017"></a><a class="code" href="Otaskend_8cpp.html#a0">00017</a> <span class="keyword">typedef</span> bool (Task::*<a class="code" href="Otaskend_8cpp.html#a0">TaskFP</a>)();                   <span class="comment">// message functions are placed in class News for easy access</span>
00018 
00019 <span class="comment">//-------- Define struct TaskInfo -------//</span>
00020 
<a name="l00023"></a><a class="code" href="structTaskInfo.html">00023</a> <span class="keyword">struct </span><a class="code" href="structTaskInfo.html">TaskInfo</a> {
<a name="l00024"></a><a class="code" href="structTaskInfo.html#m0">00024</a>     <a class="code" href="Otaskend_8cpp.html#a0">TaskFP</a> <a class="code" href="structTaskInfo.html#m0">is_completed_func</a>;                       <span class="comment">//[TASK_MSG_SUBTYPE_COUNT];</span>
<a name="l00025"></a><a class="code" href="structTaskInfo.html#m1">00025</a>     <a class="code" href="Otaskend_8cpp.html#a0">TaskFP</a> <a class="code" href="structTaskInfo.html#m1">is_expired_func</a>;
00026 };
00027 
00028 <span class="comment">//------- Define static variables --------//</span>
00029 
00030 <span class="keyword">static</span> <a class="code" href="classString.html">String</a> str;
00031 
00032 <span class="keyword">static</span> <a class="code" href="structTaskInfo.html">TaskInfo</a> task_info_array[<a class="code" href="OTASK_8H.html#a0">TASK_COUNT</a>] = {
00033     { <a class="code" href="structTask.html#a0">Task::is_completed_rise_performance</a>, <a class="code" href="structTask.html#a8">Task::is_expired</a> }, {
00034         <span class="comment">//## chea 220999 is_expired is for all task type</span>
00035         <a class="code" href="structTask.html#a1">Task::is_completed_rise_educational_quality</a>, <a class="code" href="structTask.html#a8">Task::is_expired</a>
00036     },
00037     { <a class="code" href="structTask.html#a2">Task::is_completed_rise_student_morale</a>, <a class="code" href="structTask.html#a8">Task::is_expired</a> },
00038     { <a class="code" href="structTask.html#a3">Task::is_completed_rise_department_morale</a>, <a class="code" href="structTask.html#a8">Task::is_expired</a> },
00039     { <a class="code" href="structTask.html#a4">Task::is_completed_rise_faculty_research_Per</a>, <a class="code" href="structTask.html#a8">Task::is_expired</a> },
00040     { <a class="code" href="structTask.html#a5">Task::is_completed_rise_faculty_diversity_index</a>, <a class="code" href="structTask.html#a8">Task::is_expired</a> },
00041     { <a class="code" href="structTask.html#a6">Task::is_completed_rise_use_of_IT</a>, <a class="code" href="structTask.html#a8">Task::is_expired</a> },
00042     { <a class="code" href="structTask.html#a7">Task::is_completed_rise_staff_morale</a>, <a class="code" href="structTask.html#a8">Task::is_expired</a> },
00043 
00044 };
00045 
00046 <span class="comment">//------- Begin of function TaskArray::next_day -----//</span>
<a name="l00047"></a><a class="code" href="classTaskArray.html#a10">00047</a> <span class="keywordtype">void</span> <a class="code" href="classTaskArray.html#a10">TaskArray::next_day</a>() {
00048 
00049     <span class="comment">// - will be removed from the objective/task section after the task offer expires or the task is completed</span>
00050     <span class="comment">// - checked monthly the success of the task; add bonus if task is completed</span>
00051 
00052     <a class="code" href="structTask.html">Task</a>* taskPtr;
00053 
00054     <span class="comment">// return if not start of a month</span>
00055     <span class="keywordflow">if</span> ( info.game_day != 1) {                      <span class="comment">//## chea 210899 BUGHERE the news date will not match</span>
00056         <span class="keywordflow">return</span>;
00057     }
00058 
00059     <span class="comment">//--------------------//</span>
00060 
00061     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=<a class="code" href="classDynArray.html#a28">size</a>() ; i&gt;0 ; i-- ) {
00062         taskPtr = <a class="code" href="classTaskArray.html#a22">operator[]</a>(i);
00063 
00064         <span class="comment">// already completed</span>
00065         <span class="keywordflow">if</span> ( taskPtr-&gt;<a class="code" href="structNews.html#m3">task_msg_subtype</a> == <a class="code" href="Onews_8h.html#a50a12">TASK_COMPLETED</a> )
00066             <span class="keywordflow">continue</span>;
00067 
00068         <span class="keywordflow">if</span> ( (taskPtr-&gt;*(task_info_array[taskPtr-&gt;<a class="code" href="structNews.html#m0">id</a>-1].is_completed_func))() == <span class="keyword">true</span> ) {
00069             <span class="comment">// add msg to news array</span>
00070             news_array.new_task(taskPtr, <a class="code" href="Onews_8h.html#a50a12">TASK_COMPLETED</a>);
00071 
00072             <span class="comment">// 1126 don't remove if complete // remove(i);</span>
00073             taskPtr-&gt;<a class="code" href="structTask.html#a9">set_completed</a>();
00074         }
00075         <span class="comment">//else if ( (*taskPtr-&gt;expiry_func)() == true )</span>
00076         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (taskPtr-&gt;*(task_info_array[taskPtr-&gt;<a class="code" href="structNews.html#m0">id</a>-1].is_expired_func))() == <span class="keyword">true</span> ) {
00077             news_array.new_task(taskPtr, <a class="code" href="Onews_8h.html#a50a11">TASK_EXPIRED</a>); <span class="comment">// add msg to news array</span>
00078 
00079             <span class="comment">//------- set for newspaper display --------//</span>
00080 
00081             <a class="code" href="structNews.html">News</a>* newsPtr = news_array[news_array.size()];
00082             chance_event.news_str=newsPtr-&gt;<a class="code" href="structNews.html#a1">msg</a>();
00083             chance_event.news_news_str=chance_event.news_str;
00084             <span class="comment">//                  memcpy(chance_event.news_date_str,date.date_str(newsPtr-&gt;news_date),55);</span>
00085             strncpy(chance_event.news_date_str, info.date_str_julian(newsPtr-&gt;<a class="code" href="structNews.html#m4">news_date</a>), 55 );
00086             chance_event.news_date_str[55-1] = <span class="charliteral">'\0'</span>;
00087             <span class="comment">//             chance_event.date_str=date.date_str( newsPtr-&gt;news_date, 1, 0 );</span>
00088             chance_event.date_str=info.date_str_julian(newsPtr-&gt;<a class="code" href="structNews.html#m4">news_date</a>, <a class="code" href="Oinfo_8h.html#a114a96">INFO_DATE_DEFAULT</a>|<a class="code" href="Oinfo_8h.html#a114a92">INFO_DATE_SHORT_MONTH</a>|<a class="code" href="Oinfo_8h.html#a114a90">INFO_DATE_NO_DAY</a>);
00089 
00090             <a class="code" href="classTaskArray.html#a12">remove</a>(i);
00091         }
00092 
00093         sys.yield();
00094     }
00095 }
00096 
00097 <span class="comment">//------- End of function TaskArray::next_day -----//</span>
00098 
00099 <span class="comment">//------ Begin of function Task::is_expired -----//</span>
<a name="l00105"></a><a class="code" href="structTask.html#a8">00105</a> <span class="comment">bool Task::is_expired() {</span>
00106     <span class="comment">/*</span>
00107 <span class="comment">      static  String expire_str; // for msg</span>
00108 <span class="comment"></span>
00109 <span class="comment">      //## chea 220999 added to tell player time has expire.</span>
00110 <span class="comment">      if(this-&gt;id == TASK_RISE_PERFORMANCE_RATING)</span>
00111 <span class="comment">      expire_str = "departmental prestige expired";</span>
00112 <span class="comment">      else if(this-&gt;id == RISE_EDUCATIONAL_QUALITY)</span>
00113 <span class="comment">      expire_str = "educational quality expired";</span>
00114 <span class="comment">      else if(this-&gt;id == RISE_STUDENT_MORALE)</span>
00115 <span class="comment">      expire_str = "RISE STUDENT MORALE expired";</span>
00116 <span class="comment">      else if(this-&gt;id == RISE_DEPARTMENT_MORALE)</span>
00117 <span class="comment">      expire_str = "RISE DEPARTMENT MORALE expired";</span>
00118 <span class="comment">      else if(this-&gt;id == RISE_FACULTY_RESEARCH)</span>
00119 <span class="comment">      expire_str = "RISE FACULTY RESEARCH expired";</span>
00120 <span class="comment">      else if(this-&gt;id == RISE_FACULTY_DIVERSITY_INDEX)</span>
00121 <span class="comment">      expire_str = "RISE_FACULTY_DIVERSITY_INDEX expired";</span>
00122 <span class="comment">      else if(this-&gt;id == RISE_USE_OF_IT)</span>
00123 <span class="comment">      expire_str = "RISE USE OF IT expired";</span>
00124 <span class="comment">      else if(this-&gt;id == RISE_STAFF_MORALE)</span>
00125 <span class="comment">      expire_str = "RISE STAFF MORALE expired";</span>
00126 <span class="comment">    */</span>
00127     <span class="comment">// #### begin Gilbert 07/09/2001 ######//</span>
00128     <span class="comment">// if ( info.game_month &gt;= short_para5 &amp;&amp; info.game_year &gt;= short_para6 )</span>
00129     <span class="keywordflow">if</span> ( info.game_year &gt; short_para6
00130          || info.game_year == short_para6 &amp;&amp; info.game_month &gt;= short_para5 ) {
00131         <span class="comment">// #### end Gilbert 07/09/2001 ######//</span>
00132         sys.set_news_pop_up();
00133         <span class="comment">//              chance_event.news_news_str=expire_str;</span>
00134 
00135         <span class="comment">// display date in 200? format</span>
00136         <span class="keywordtype">long</span> endDay = date.julian(info.game_year, info.game_month, info.game_day);
00137         <span class="comment">//              memcpy(chance_event.news_date_str,date.date_str(endDay),55);</span>
00138         strncpy(chance_event.news_date_str, info.date_str_julian(endDay), 55 );
00139         chance_event.news_date_str[55-1] = <span class="charliteral">'\0'</span>;
00140         <span class="comment">//              chance_event.date_str=date.date_str(endDay,1,0);</span>
00141         chance_event.date_str=info.date_str_julian(endDay, <a class="code" href="Oinfo_8h.html#a114a96">INFO_DATE_DEFAULT</a>|<a class="code" href="Oinfo_8h.html#a114a92">INFO_DATE_SHORT_MONTH</a>|<a class="code" href="Oinfo_8h.html#a114a90">INFO_DATE_NO_DAY</a>);
00142 
00143         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00144     }
00145     <span class="keywordflow">else</span>
00146         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00147 }
00148 
00149 <span class="comment">//------ End of function Task::is_expired -----//</span>
00150 
00151 <span class="comment">//------ Begin of function Task::set_completed -----//</span>
<a name="l00157"></a><a class="code" href="structTask.html#a9">00157</a> <span class="comment">void Task::set_completed() {                      // 990503</span>
00158     task_msg_subtype = <a class="code" href="Onews_8h.html#a50a12">TASK_COMPLETED</a>;
00159     news_date = info.game_date;
00160 
00161     task_array.total_bonus_pt += short_para7;
00162 }
00163 
00164 <span class="comment">//------ End of function Task::set_completed -----//</span>
00165 
00166 <span class="comment">//------ Begin of function Task::is_completed_rise_performance -----//</span>
<a name="l00176"></a><a class="code" href="structTask.html#a0">00176</a> <span class="comment">bool Task::is_completed_rise_performance() {</span>
00177 
00178     <span class="comment">//BUGHERE0 should depends on short_para2</span>
00179     <span class="keywordtype">float</span> curRating = department_array[short_para1]-&gt;p_academic_standing;
00180 
00181     <span class="keywordflow">return</span> curRating &gt;= short_para3;
00182 }
00183 
00184 <span class="comment">//------ End of function Task::is_completed_rise_performance -----//</span>
00185 
00186 <span class="comment">//------ Begin of function Task::is_completed_rise_educational_quality -----//</span>
<a name="l00196"></a><a class="code" href="structTask.html#a1">00196</a> <span class="comment">bool Task::is_completed_rise_educational_quality() {</span>
00197     <span class="keywordtype">float</span> curRating = department_array[short_para1]-&gt;p_educational_quality;
00198 
00199     <span class="keywordflow">return</span> curRating &gt;= short_para3;
00200 }
00201 
00202 <span class="comment">//------ End of function Task::is_completed_rise_educational_quality -----//</span>
00203 
00204 <span class="comment">//------ Begin of function Task::is_completed_rise_student_morale -----//</span>
<a name="l00205"></a><a class="code" href="structTask.html#a2">00205</a> <span class="keywordtype">bool</span> <a class="code" href="structTask.html#a2">Task::is_completed_rise_student_morale</a>() {
00206     <span class="keywordtype">float</span> curRating = player_school.sub_score[<a class="code" href="Opschool_8h.html#a65a46">S_STUDENT_MORALE</a>][HISTORY_MONTH_COUNT-1];
00207 
00208     <span class="keywordflow">return</span> curRating &gt;= <a class="code" href="structNews.html#m7">short_para3</a>;
00209 }
00210 
00211 <span class="comment">//------ End of function Task::is_completed_rise_student_morale -----//</span>
00212 
00213 <span class="comment">//------ Begin of function Task::is_completed_rise_department_morale -----//</span>
<a name="l00215"></a><a class="code" href="structTask.html#a3">00215</a> <span class="comment">bool Task::is_completed_rise_department_morale() {</span>
00216     <span class="keywordtype">float</span> curRating = department_array.p_faculty_morale_history[47];
00217 
00218     <span class="keywordflow">return</span> curRating &gt;= short_para3;
00219 }
00220 
00221 <span class="comment">//------ End of function Task::is_completed_rise_department_morale -----//</span>
00222 
00223 <span class="comment">//------ Begin of function Task::is_completed_rise_faculty_research_Per -----//</span>
<a name="l00224"></a><a class="code" href="structTask.html#a4">00224</a> <span class="keywordtype">bool</span> <a class="code" href="structTask.html#a4">Task::is_completed_rise_faculty_research_Per</a>() {
00225     <span class="keywordtype">float</span> curRating = department_array.p_faculty_research_history[47];
00226 
00227     <span class="keywordflow">return</span> curRating &gt;= <a class="code" href="structNews.html#m7">short_para3</a>;
00228 }
00229 
00230 <span class="comment">//------ End of function Task::is_completed_rise_faculty_research_Per -----//</span>
00231 
00232 <span class="comment">//------ Begin of function Task::is_completed_rise_faculty_diversity_index -----//</span>
<a name="l00242"></a><a class="code" href="structTask.html#a5">00242</a> <span class="comment">bool Task::is_completed_rise_faculty_diversity_index() {</span>
00243     <span class="comment">//value now</span>
00244     <span class="keywordtype">float</span> curRating = department_array[short_para1]-&gt;p_faculty_diversity_history[7];
00245 
00246     <span class="keywordflow">return</span> curRating &gt;= short_para3;
00247 }
00248 
00249 <span class="comment">//------ End of function Task::is_completed_rise_faculty_diversity_index -----//</span>
00250 
00251 <span class="comment">//------ Begin of function Task::is_completed_rise_use_of_IT -----//</span>
<a name="l00261"></a><a class="code" href="structTask.html#a6">00261</a> <span class="comment">bool Task::is_completed_rise_use_of_IT() {</span>
00262 
00263     <a class="code" href="classDepartment.html">Department</a>* cur_dept_ptr = department_array[short_para1];
00264     <span class="keywordtype">float</span> curRating = cur_dept_ptr-&gt;<a class="code" href="classDepartment.html#m58">var_educational_quality_history</a>[4][23];
00265 
00266     <span class="keywordflow">return</span> curRating &gt;= short_para3;
00267 }
00268 
00269 <span class="comment">//------ End of function Task::is_completed_rise_use_of_IT -----//</span>
00270 
00271 <span class="comment">//------ Begin of function Task::is_completed_rise_staff_morale -----//</span>
<a name="l00281"></a><a class="code" href="structTask.html#a7">00281</a> <span class="comment">bool Task::is_completed_rise_staff_morale() {</span>
00282     <span class="keywordtype">float</span> curRating = player_school.sub_score[<a class="code" href="Opschool_8h.html#a65a47">S_STAFF_MORALE</a>][THIS_MONTH];
00283 
00284     <span class="keywordflow">return</span> curRating &gt;= short_para3;
00285 }
00286 
00287 <span class="comment">//------ End of function Task::is_completed_rise_staff_morale -----//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:30 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
