<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Ostud_sc.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Ostud_sc.cpp</h1><a href="Ostud__sc_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename   : OSTUD_SC.CPP</span>
00002 <span class="comment">//Description: Student selecting courses functions</span>
00003 <span class="comment">// 1102 // see  td2.2 sections 5.2-5.4 and td3.3 section 3.2</span>
00004 
00005 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00006 <span class="preprocessor">#include &lt;OMATH.H&gt;</span>
00007 <span class="preprocessor">#include &lt;OSTUDENT.H&gt;</span>
00008 <span class="preprocessor">#include &lt;OFACULTY.H&gt;</span>
00009 <span class="preprocessor">#include &lt;OCOURSE.H&gt;</span>
00010 <span class="preprocessor">#include &lt;OPSCHOOL.H&gt;</span>
00011 <span class="preprocessor">#include &lt;ODEPT.H&gt;</span>
00012 <span class="preprocessor">#include &lt;<a class="code" href="ODEPTRES_8H.html">ODEPTRES.H</a>&gt;</span>
00013 <span class="preprocessor">#include &lt;<a class="code" href="OFIELD_8H.html">OFIELD.H</a>&gt;</span>
00014 <span class="preprocessor">#include &lt;<a class="code" href="OCOURRES_8H.html">OCOURRES.H</a>&gt;</span>
00015 <span class="preprocessor">#include &lt;OFINANCE.H&gt;</span>
00016 
00017 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00018 <span class="preprocessor"></span><span class="keyword">const</span> <a class="code" href="ogfile5_8cpp.html#a5">RECORD_SEPARATOR_LEN</a> = 2;
00019 <span class="keyword">static</span> <span class="keywordtype">char</span> *RECORD_SEPARATOR = <span class="stringliteral">"\r\n"</span>;
00020 <span class="keyword">const</span> <a class="code" href="ogfile5_8cpp.html#a7">FIELD_SEPARATOR_LEN</a> = 1;
00021 <span class="keyword">static</span> <span class="keywordtype">char</span> *FIELD_SEPARATOR = <span class="stringliteral">"\t"</span>;
00022 
00023 <span class="keyword">static</span> <span class="keywordtype">char</span> *export_num(<span class="keywordtype">int</span> value) {
00024     <span class="keyword">static</span> <span class="keywordtype">char</span> num_str[20];
00025     <span class="keywordflow">return</span> itoa( value, num_str, 10 );              <span class="comment">// 10 is radix</span>
00026 }
00027 
00028 <span class="keyword">static</span> <span class="keywordtype">char</span> *export_num(<span class="keywordtype">double</span> value) {
00029     <span class="keyword">static</span> <span class="keywordtype">char</span> num_str[20];
00030     <span class="keywordflow">return</span> gcvt( value, 7, num_str );               <span class="comment">// a few more more than 7, for negative sign, decimal point and exponent</span>
00031 }
00032 
00033 <span class="keyword">static</span> <span class="keywordtype">char</span> *export_percent(<span class="keywordtype">double</span> value) {       <span class="comment">// value already multiplied by 100</span>
00034     <span class="keyword">static</span> <span class="keywordtype">char</span> num_str[20];
00035     <span class="keywordflow">return</span> gcvt( value*0.01, 7, num_str );          <span class="comment">// a few more more than 7, for negative sign, decimal point and exponent</span>
00036 }
00037 
00038 <span class="preprocessor">#define WRITE_FIELD_SEPARATOR(f)      f-&gt;file_write(FIELD_SEPARATOR, FIELD_SEPARATOR_LEN)</span>
00039 <span class="preprocessor"></span><span class="preprocessor">#define WRITE_STR_FIELD(f,s)          { f-&gt;file_write(s, strlen(s)); }</span>
00040 <span class="preprocessor"></span><span class="preprocessor">#define WRITE_NUM_FIELD(f,n)          { char *s=export_num(n); f-&gt;file_write(s, strlen(s)); }</span>
00041 <span class="preprocessor"></span><span class="preprocessor">#define WRITE_PERCENT_FIELD(f,n)      { char *s=export_percent(n); f-&gt;file_write(s, strlen(s)); }</span>
00042 <span class="preprocessor"></span><span class="preprocessor">#define WRITE_RECORD_SEPARATOR(f)     f-&gt;file_write(RECORD_SEPARATOR, RECORD_SEPARATOR_LEN)</span>
00043 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00044 <span class="preprocessor"></span>
00045 <span class="comment">//------- define static variables --------------//</span>
00046 
00047 <span class="keyword">static</span> <span class="keywordtype">char</span> total_course_this_trimester;          <span class="comment">// total course to take this trimester</span>
00048 <span class="keyword">static</span> <span class="keywordtype">char</span> total_required_course_this_trimester;
00049 
00050 <span class="comment">//---------- Begin of function Student::select_course -----------//</span>
00058 <span class="comment">#if(GAME_VERSION&gt;=200)</span>
00059 <span class="keywordtype">void</span> <a class="code" href="classStudent.html#a7">Student::select_course</a>(<span class="keywordtype">int</span> ignoreFaculty, <span class="keywordtype">int</span> initPrevFlag)
00060 #<span class="keywordflow">else</span>
<a name="l00061"></a><a class="code" href="classStudent.html#a7">00061</a>     <span class="keywordtype">void</span> <a class="code" href="classStudent.html#a7">Student::select_course</a>(<span class="keywordtype">int</span> ignoreFaculty)
00062 #endif
00063 {
00064 
00065 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00066 <span class="preprocessor"></span><span class="preprocessor">#else</span>
00067 <span class="preprocessor"></span>    initPrevFlag = 0;
00068 <span class="preprocessor">#endif</span>
00069 <span class="preprocessor"></span>
00070     <span class="comment">// called by StudentArray::select_course()</span>
00071 
00072     think_summer_course();
00073 
00074     <span class="comment">//--- reset counters before starting the selection process ---//</span>
00075 
00076     this-&gt;course_denials_this_trimester = 0;
00077     this-&gt;course_failures_this_trimester = 0;
00078     memset(course_taking_array, 0, <span class="keyword">sizeof</span>(course_taking_array));
00079 
00080     total_course_this_trimester=0;
00081     total_required_course_this_trimester=0;
00082 
00083     <span class="comment">//--------------------------------------------//</span>
00084 
00085     <span class="keywordtype">int</span> loopCount=0;
00086     <span class="keywordtype">int</span> oldDept = department_recno;
00087 
00088     <span class="keywordflow">while</span>(1) {
00089         <span class="keywordflow">if</span>( has_selected_all_course() )
00090             <span class="keywordflow">return</span>;
00091 
00092         <span class="comment">//sys.yield();</span>
00093 
00094         <span class="keywordflow">if</span> ( oldDept == 0 &amp;&amp; department_recno != 0 ) {
00095             <span class="keywordflow">return</span>;                                     <span class="comment">// since think_change_major(1) called</span>
00096         }
00097 
00098         loopCount++;
00099         <a class="code" href="ALL_8H.html#a0">err_when</a>( loopCount &gt; 1000 );
00100 
00101         <span class="comment">//---- first attempts to select a required course ----//</span>
00102 
00103         <span class="keywordtype">int</span> isRequiredCourse=1;
00104 
00105 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00106 <span class="preprocessor"></span>        <span class="keywordflow">if</span>( select_course2( isRequiredCourse, ignoreFaculty, initPrevFlag ) )
00107 <span class="preprocessor">#else</span>
00108 <span class="preprocessor"></span>            <span class="keywordflow">if</span>( select_course2( isRequiredCourse, ignoreFaculty ) )
00109 <span class="preprocessor">#endif</span>
00110 <span class="preprocessor"></span>            {
00111                 <span class="comment">//                      info.debug_enroll5++;</span>
00112                 <span class="keywordflow">continue</span>;                                 <span class="comment">// select next course until no course can be selected</span>
00113             }
00114         <span class="comment">//sys.yield();</span>
00115 
00116         <span class="comment">//--- if the first attempt failed and it is a required course, convert it to an elective course ---//</span>
00117 
00118         <span class="keywordflow">if</span>( isRequiredCourse ) {
00119             isRequiredCourse = 0;
00120 
00121 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00122 <span class="preprocessor"></span>            <span class="keywordflow">if</span>( select_course2( isRequiredCourse, ignoreFaculty, initPrevFlag ) )
00123 <span class="preprocessor">#else</span>
00124 <span class="preprocessor"></span>                <span class="keywordflow">if</span>( select_course2( isRequiredCourse, ignoreFaculty ) )
00125 <span class="preprocessor">#endif</span>
00126 <span class="preprocessor"></span>                {
00127                     <span class="comment">//                          info.debug_enroll6++;</span>
00128                     <span class="keywordflow">continue</span>;
00129                 }
00130         }
00131 
00132         <span class="keywordflow">if</span> (loopCount&gt;5) {                            <span class="comment">// 1118   //try making a bigger loop</span>
00133             <span class="comment">//          if (loopCount&gt;100)      // 1118   //try making a bigger loop 118</span>
00134             <span class="keywordflow">return</span>;
00135         }
00136 
00137     }
00138 
00139     <span class="comment">/*</span>
00140 <span class="comment">      if(total_course_this_trimester&lt;4) //## chea 270899</span>
00141 <span class="comment">      info.debug_enroll4++;</span>
00142 <span class="comment">      else if (total_course_this_trimester&lt;3)</span>
00143 <span class="comment">      info.debug_enroll5++;</span>
00144 <span class="comment">      else if (total_course_this_trimester&lt;2)</span>
00145 <span class="comment">      info.debug_enroll6++;</span>
00146 <span class="comment">      else if (total_course_this_trimester&lt;1)</span>
00147 <span class="comment">      info.debug_enroll7++;</span>
00148 <span class="comment">    */</span>
00149 
00150 }
00151 
00152 <span class="comment">//----------- End of function Student::select_course ------------//</span>
00153 
00154 <span class="comment">//---------- Begin of function Student::select_course2 -----------//</span>
00175 <span class="comment">#if(GAME_VERSION&gt;=200)</span>
00176 <span class="keywordtype">int</span> Student::select_course2(<span class="keywordtype">int</span>&amp; isRequiredCourse, <span class="keywordtype">int</span> ignoreFaculty, <span class="keywordtype">int</span> initPrevFlag)
00177 #<span class="keywordflow">else</span>
00178     <span class="keywordtype">int</span> Student::select_course2(<span class="keywordtype">int</span>&amp; isRequiredCourse, <span class="keywordtype">int</span> ignoreFaculty)
00179 #endif
00180 {
00181 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00182 <span class="preprocessor"></span><span class="preprocessor">#else</span>
00183 <span class="preprocessor"></span>    initPrevFlag = 0;
00184 <span class="preprocessor">#endif</span>
00185 <span class="preprocessor"></span>
00186     <span class="keywordtype">int</span> selectedCourseDept=0, selectedCourseFocus=0, selectedCourseDepth=0;
00187     <span class="comment">//bool allSelected = false;</span>
00188 
00189     <span class="comment">//------- attempt to select a required course -------//</span>
00190 
00191     <span class="keywordflow">if</span>( isRequiredCourse ) {
00192 
00193         <span class="keywordflow">if</span>(this-&gt;department_recno ==0)
00194             <span class="keywordtype">int</span> sdgf=0;
00195 
00196         select_required_course(selectedCourseDept, selectedCourseDepth, selectedCourseFocus);
00197         <span class="comment">//              info.debug_enroll++;</span>
00198         <span class="comment">//              if(selectedCourseDept!=8 &amp;&amp; selectedCourseDept!=7 &amp;&amp; selectedCourseDept!=10</span>
00199         <span class="comment">//                      &amp;&amp; selectedCourseDept!=9 &amp;&amp; selectedCourseDept!=2 &amp;&amp; selectedCourseDept!=4</span>
00200         <span class="comment">//                      &amp;&amp; selectedCourseDept!=0 &amp;&amp; selectedCourseDept!=1 &amp;&amp; selectedCourseDept!=5</span>
00201         <span class="comment">//                      &amp;&amp; selectedCourseDept!=3 &amp;&amp; selectedCourseDept!=6)</span>
00202         <span class="comment">//                      int gfg=1;</span>
00203 
00204         <span class="comment">//              info.debug[selectedCourseDept]++;</span>
00205     }
00206     <span class="keywordflow">else</span> {
00207         select_elective_course(selectedCourseDept, selectedCourseDepth, selectedCourseFocus);
00208         <span class="comment">//              info.debug_enroll2++;</span>
00209         <span class="comment">//              info.debug1[selectedCourseDept]++;</span>
00210     }
00211 
00212     <span class="keywordflow">if</span>( !selectedCourseDept ) {
00213         <span class="comment">//              info.debug_enroll3++;</span>
00214         <span class="keywordflow">return</span> 0;
00215     }
00216     <span class="comment">//------- attemp to assign this student to a course ------//</span>
00217 
00218     <span class="keywordtype">int</span> maxTry=2;                                   <span class="comment">// try a maximum of two times to select a teaching method and match a course</span>
00219 
00220     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;maxTry ; i++ ) {
00221         <span class="comment">//-------- select a teaching method -------//</span>
00222 
00223         <span class="keywordtype">int</span> selectedTeachingMethod, selectedTeachingMethod2= -1;
00224 
00225         selectedTeachingMethod = select_teaching_method(selectedCourseDept);
00226 
00227         <span class="comment">//      if( selectedTeachingMethod  == CLASS_WITH_BREAKOUT )</span>
00228         <span class="comment">//      {</span>
00229         <span class="comment">//         selectedTeachingMethod2 = BREAKOUT_LAB;      //**BUGHERE, selectedTeachingMethod2 hasn't be taken care of yet</span>
00230         <span class="comment">//      }</span>
00231 
00232         <span class="comment">//sys.yield();</span>
00233 
00234 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00235 <span class="preprocessor"></span>        <span class="keywordflow">if</span>( assign_course(selectedCourseDept, selectedCourseDepth,
00236                           selectedCourseFocus, selectedTeachingMethod, isRequiredCourse, ignoreFaculty, initPrevFlag) )
00237 <span class="preprocessor">#else</span>
00238 <span class="preprocessor"></span>            <span class="keywordflow">if</span>( assign_course(selectedCourseDept, selectedCourseDepth,
00239                               selectedCourseFocus, selectedTeachingMethod, isRequiredCourse, ignoreFaculty) )
00240 <span class="preprocessor">#endif</span>
00241 <span class="preprocessor"></span>            {
00242                 <span class="comment">//                      info.debug[selectedCourseDept]++;</span>
00243                 <span class="keywordflow">return</span> 1;
00244             }
00245             <span class="keywordflow">else</span> {
00246                 <span class="comment">//                      this-&gt;course_denials_this_trimester = 1;                        // 990415</span>
00247                 <span class="comment">//                      this-&gt;course_denials_this_trimester++;</span>
00248                 this-&gt;course_denials_this_trimester += 1;   <span class="comment">//## chea may be this is right</span>
00249 
00250             }
00251     }
00252 
00253     <span class="keywordflow">return</span> 0;
00254 }
00255 
00256 <span class="comment">//---------- End of function Student::select_course2 -----------//</span>
00257 
00258 <span class="comment">//-------- Begin of function Student::assign_course --------//</span>
00265 <span class="comment">#if(GAME_VERSION&gt;=200)</span>
00266 <span class="keywordtype">int</span> Student::assign_course(<span class="keywordtype">int</span> selectedCourseDept, <span class="keywordtype">int</span> selectedCourseDepth,
00267                            <span class="keywordtype">int</span> selectedCourseFocus, <span class="keywordtype">int</span> selectedTeachingMethod,
00268                            <span class="keywordtype">int</span> isRequiredCourse, <span class="keywordtype">int</span> ignoreFaculty, <span class="keywordtype">int</span> initPrevFlag)
00269 #<span class="keywordflow">else</span>
00270     <span class="keywordtype">int</span> Student::assign_course(<span class="keywordtype">int</span> selectedCourseDept, <span class="keywordtype">int</span> selectedCourseDepth,
00271                                <span class="keywordtype">int</span> selectedCourseFocus, <span class="keywordtype">int</span> selectedTeachingMethod,
00272                                <span class="keywordtype">int</span> isRequiredCourse, <span class="keywordtype">int</span> ignoreFaculty)
00273 #endif
00274 {
00275 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00276 <span class="preprocessor"></span><span class="preprocessor">#else</span>
00277 <span class="preprocessor"></span>    initPrevFlag = 0;
00278 <span class="preprocessor">#endif</span>
00279 <span class="preprocessor"></span>
00280     <span class="comment">// init var</span>
00281 
00282     <span class="comment">//if ( !ignoreFaculty &amp;&amp; math.get_random_float() &gt; player_school.delay_rate[student_level] )</span>
00283     <span class="comment">//  return 0;</span>
00284 
00285     <span class="comment">//-------- supply-demand balance --------//</span>
00286 
00287     <a class="code" href="classDepartment.html">Department</a>* deptPtr = department_array[selectedCourseDept];
00288 
00289     <a class="code" href="classCourse.html">Course</a>* coursePtr = deptPtr-&gt;<a class="code" href="classDepartment.html#m1">course_array</a>.<a class="code" href="classCourseArray.html#a9">get_course</a>(selectedCourseDepth, selectedCourseFocus, selectedTeachingMethod);
00290 
00291 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00292 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( audit_flag ) {
00293         <a class="code" href="classFile.html">File</a> file;
00294 
00295         <span class="keywordtype">char</span> fileName[123];
00296 
00297         <span class="keywordflow">switch</span>( student_level ) {
00298         <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>:    strcpy( fileName, <span class="stringliteral">"TRADITION"</span> );
00299             <span class="keywordflow">break</span>;
00300         <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a4">UG_NONTRADITION</a>: strcpy( fileName, <span class="stringliteral">"NONTRADITION"</span> );
00301             <span class="keywordflow">break</span>;
00302         <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a5">MASTER</a>:        strcpy( fileName, <span class="stringliteral">"MASTER"</span> );
00303             <span class="keywordflow">break</span>;
00304         <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a6">DOCTOR</a>:        strcpy( fileName, <span class="stringliteral">"DOCTOR"</span> );
00305             <span class="keywordflow">break</span>;
00306         }
00307 
00308         strcat( fileName, m.format(old_student_recno) );
00309         strcat( fileName, <span class="stringliteral">".txt"</span> );
00310 
00311         file.<a class="code" href="classFile.html#a4">file_append</a>( fileName );
00312         file.<a class="code" href="classFile.html#a7">file_seek</a>(0, FILE_END);
00313 
00314         file_course_id++;
00315 
00316         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> z=0; z&lt;6; z++ ) {
00317             <span class="comment">// Cohet</span>
00318             <span class="keywordflow">if</span> ( info.prerun_year ) {
00319                 <a class="code" href="ogfile5_8cpp.html#a2">WRITE_NUM_FIELD</a>( (&amp;file), -1 );
00320             }
00321             <span class="keywordflow">else</span> {
00322                 <a class="code" href="ogfile5_8cpp.html#a2">WRITE_NUM_FIELD</a>( (&amp;file), info.financial_year() );
00323             }
00324 
00325             <a class="code" href="ogfile5_8cpp.html#a0">WRITE_FIELD_SEPARATOR</a>( (&amp;file) );
00326 
00327             <span class="comment">// Trimester</span>
00328             <span class="keywordflow">switch</span>( player_school.cur_trimester ) {
00329             <span class="keywordflow">case</span> <a class="code" href="Gamedef_8h.html#a79a36">AUTUMN</a>:  <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"A"</span> ); <span class="keywordflow">break</span>;
00330             <span class="keywordflow">case</span> <a class="code" href="Gamedef_8h.html#a79a37">WINTER</a>:  <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"W"</span> ); <span class="keywordflow">break</span>;
00331             <span class="keywordflow">case</span> <a class="code" href="Gamedef_8h.html#a79a38">SUMMER</a>:  <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"S"</span> ); <span class="keywordflow">break</span>;
00332             }
00333 
00334             <span class="comment">// ID</span>
00335             <a class="code" href="ogfile5_8cpp.html#a0">WRITE_FIELD_SEPARATOR</a>( (&amp;file) );
00336             <a class="code" href="ogfile5_8cpp.html#a0">WRITE_FIELD_SEPARATOR</a>( (&amp;file) );
00337             <a class="code" href="ogfile5_8cpp.html#a2">WRITE_NUM_FIELD</a>( (&amp;file), file_course_id );
00338             <a class="code" href="ogfile5_8cpp.html#a0">WRITE_FIELD_SEPARATOR</a>( (&amp;file) );
00339 
00340             <span class="comment">// Variables</span>
00341             <span class="keywordflow">switch</span>(z) {
00342             <span class="keywordflow">case</span> 0:                                   <span class="comment">// CourseDept</span>
00343                 <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"CourseDept"</span> );
00344                 <a class="code" href="ogfile5_8cpp.html#a0">WRITE_FIELD_SEPARATOR</a>( (&amp;file) );
00345                 <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), department_res[department_array[coursePtr-&gt;<a class="code" href="classCourse.html#m1">department_recno</a>]-&gt;department_id]-&gt;name );
00346                 <a class="code" href="ogfile5_8cpp.html#a4">WRITE_RECORD_SEPARATOR</a>( (&amp;file) );
00347                 <span class="keywordflow">break</span>;
00348 
00349             <span class="keywordflow">case</span> 1:                                   <span class="comment">// Depth</span>
00350                 <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"Depth"</span> );
00351                 <a class="code" href="ogfile5_8cpp.html#a0">WRITE_FIELD_SEPARATOR</a>( (&amp;file) );
00352                 <a class="code" href="ogfile5_8cpp.html#a0">WRITE_FIELD_SEPARATOR</a>( (&amp;file) );
00353                 <span class="keywordflow">switch</span>( selectedCourseDepth ) {
00354                 <span class="keywordflow">case</span> <a class="code" href="Ocourse_8h.html#a36a14">DEPTH_D1</a>:  <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"D1"</span> ); <span class="keywordflow">break</span>;
00355                 <span class="keywordflow">case</span> <a class="code" href="Ocourse_8h.html#a36a15">DEPTH_D2</a>: <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"D2"</span> ); <span class="keywordflow">break</span>;
00356                 <span class="keywordflow">case</span> <a class="code" href="Ocourse_8h.html#a36a16">DEPTH_D3</a>: <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"D3"</span> ); <span class="keywordflow">break</span>;
00357                 <span class="keywordflow">case</span> <a class="code" href="Ocourse_8h.html#a36a17">DEPTH_GR</a>: <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"GR"</span> ); <span class="keywordflow">break</span>;
00358                 }
00359                 <a class="code" href="ogfile5_8cpp.html#a4">WRITE_RECORD_SEPARATOR</a>( (&amp;file) );
00360                 <span class="keywordflow">break</span>;
00361 
00362             <span class="keywordflow">case</span> 2:                                   <span class="comment">// Focus</span>
00363                 <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"Focus"</span> );
00364                 <a class="code" href="ogfile5_8cpp.html#a0">WRITE_FIELD_SEPARATOR</a>( (&amp;file) );
00365                 <a class="code" href="ogfile5_8cpp.html#a0">WRITE_FIELD_SEPARATOR</a>( (&amp;file) );
00366                 <span class="keywordflow">switch</span>( selectedCourseFocus ) {
00367                 <span class="keywordflow">case</span> <a class="code" href="Ocourse_8h.html#a37a18">FOCUS_LD</a>: <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"LD"</span> ); <span class="keywordflow">break</span>;
00368                 <span class="keywordflow">case</span> <a class="code" href="Ocourse_8h.html#a37a19">FOCUS_M</a>:  <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"M"</span> ); <span class="keywordflow">break</span>;
00369                 <span class="keywordflow">case</span> <a class="code" href="Ocourse_8h.html#a37a20">FOCUS_UD</a>: <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"UD"</span> ); <span class="keywordflow">break</span>;
00370                 <span class="keywordflow">case</span> <a class="code" href="Ocourse_8h.html#a37a21">FOCUS_GR</a>: <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"GR"</span> ); <span class="keywordflow">break</span>;
00371                 }
00372                 <a class="code" href="ogfile5_8cpp.html#a4">WRITE_RECORD_SEPARATOR</a>( (&amp;file) );
00373                 <span class="keywordflow">break</span>;
00374 
00375             <span class="keywordflow">case</span> 3:                                   <span class="comment">// TchMethod</span>
00376                 <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"TchMethod"</span> );
00377                 <a class="code" href="ogfile5_8cpp.html#a0">WRITE_FIELD_SEPARATOR</a>( (&amp;file) );
00378                 <span class="keywordflow">switch</span>( selectedTeachingMethod ) {
00379                 <span class="keywordflow">case</span> <a class="code" href="Ocourse_8h.html#a40a31">SEMINAR</a>:             <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"Sem"</span> ); <span class="keywordflow">break</span>;
00380                 <span class="keywordflow">case</span> <a class="code" href="Ocourse_8h.html#a40a32">DISTANCE_LEARN_COURSE</a>:   <a class="code" href="ALL_8H.html#a1">err_here</a>(); <span class="keywordflow">break</span>;
00381                 <span class="keywordflow">case</span> <a class="code" href="Ocourse_8h.html#a40a33">CLASS_WITH_BREAKOUT</a>:     <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"CLA"</span> ); <span class="keywordflow">break</span>;
00382                 <span class="keywordflow">case</span> <a class="code" href="Ocourse_8h.html#a40a34">BREAKOUT_LAB</a>:          <a class="code" href="ALL_8H.html#a1">err_here</a>(); <span class="keywordflow">break</span>;
00383                 <span class="keywordflow">case</span> <a class="code" href="Ocourse_8h.html#a40a35">GENERAL</a>:             <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"GEN"</span> ); <span class="keywordflow">break</span>;
00384                 }
00385                 <a class="code" href="ogfile5_8cpp.html#a4">WRITE_RECORD_SEPARATOR</a>( (&amp;file) );
00386                 <span class="keywordflow">break</span>;
00387 
00388             <span class="keywordflow">case</span> 4:                                   <span class="comment">// Req/elect</span>
00389                 <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"Req/elect"</span> );
00390                 <a class="code" href="ogfile5_8cpp.html#a0">WRITE_FIELD_SEPARATOR</a>( (&amp;file) );
00391                 <span class="keywordflow">if</span> ( isRequiredCourse ) {
00392                     <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"Req"</span> );
00393                 }
00394                 <span class="keywordflow">else</span>
00395                     <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"Elect"</span> );
00396                 <a class="code" href="ogfile5_8cpp.html#a4">WRITE_RECORD_SEPARATOR</a>( (&amp;file) );
00397                 <span class="keywordflow">break</span>;
00398 
00399             <span class="keywordflow">case</span> 5:                                   <span class="comment">// Result</span>
00400                 <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"Result"</span> );
00401                 <a class="code" href="ogfile5_8cpp.html#a0">WRITE_FIELD_SEPARATOR</a>( (&amp;file) );
00402                 <a class="code" href="ogfile5_8cpp.html#a0">WRITE_FIELD_SEPARATOR</a>( (&amp;file) );
00403                 <span class="keywordflow">break</span>;
00404             }
00405         }
00406 
00407         file.<a class="code" href="classFile.html#a5">file_close</a>();
00408     }
00409 <span class="preprocessor">#endif</span>
00410 <span class="preprocessor"></span>
00411     <span class="comment">//---- check max_class_size checking here   // see email req29a_course.txt and 0830 notes sectionn 6.5.3 and 6.8</span>
00412 
00413     <span class="keywordtype">float</span> maxClassSize = 0;
00414 
00415     <span class="keywordflow">if</span> ( coursePtr-&gt;<a class="code" href="classCourse.html#m4">teaching_method</a> == <a class="code" href="Ocourse_8h.html#a40a32">DISTANCE_LEARN_COURSE</a> ) {
00416         maxClassSize = department_res[deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m2">department_id</a>]-&gt;max_dl_class_size;
00417     }
00418     <span class="keywordflow">else</span> {
00419         maxClassSize = deptPtr-&gt;<a class="code" href="classDepartment.html#m46">cummulative_tech_utilization</a>;
00420         maxClassSize = math.single_response_func(0.0f, 3.0f, 10.0f, 5.0f, maxClassSize/100);
00421 
00422         <span class="comment">//trick</span>
00423         maxClassSize = float(coursePtr-&gt;<a class="code" href="classCourse.html#a0">normal_class_size</a>() );
00424     }
00425 
00426     <span class="keywordflow">if</span>( !initPrevFlag &amp;&amp; coursePtr-&gt;<a class="code" href="classCourse.html#m5">is_closed</a> ) {   <span class="comment">// if initPrevFlag, never deny</span>
00427         <span class="comment">//      coursePtr-&gt;admission_denied_count++;</span>
00428 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00429 <span class="preprocessor"></span>        <span class="comment">// Version 2.0 Item 8d iv)</span>
00430         <span class="keywordtype">int</span> randomNumber = m.random(100);
00431         <span class="comment">// if the denied is canceled</span>
00432         <span class="keywordflow">if</span> (randomNumber &lt; deptPtr-&gt;ease_outsourcing_credits ) {
00433             coursePtr-&gt;outsourcing_credits = 1;
00434             <span class="comment">//         coursePtr-&gt;cur_section_student_count++;</span>
00435             <span class="keywordflow">if</span> ( audit_flag ) {
00436                 <a class="code" href="classFile.html">File</a> file;
00437 
00438                 <span class="keywordtype">char</span> fileName[123];
00439 
00440                 <span class="keywordflow">switch</span>( student_level ) {
00441                 <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>:    strcpy( fileName, <span class="stringliteral">"TRADITION"</span> );
00442                     <span class="keywordflow">break</span>;
00443                 <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a4">UG_NONTRADITION</a>: strcpy( fileName, <span class="stringliteral">"NONTRADITION"</span> );
00444                     <span class="keywordflow">break</span>;
00445                 <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a5">MASTER</a>:        strcpy( fileName, <span class="stringliteral">"MASTER"</span> );
00446                     <span class="keywordflow">break</span>;
00447                 <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a6">DOCTOR</a>:        strcpy( fileName, <span class="stringliteral">"DOCTOR"</span> );
00448                     <span class="keywordflow">break</span>;
00449                 }
00450 
00451                 strcat( fileName, m.format(old_student_recno) );
00452                 strcat( fileName, <span class="stringliteral">".txt"</span> );
00453 
00454                 file.<a class="code" href="classFile.html#a4">file_append</a>( fileName );
00455                 file.<a class="code" href="classFile.html#a7">file_seek</a>(0, FILE_END);
00456 
00457                 <span class="comment">// Pass</span>
00458                 <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"Pass"</span> );
00459                 <a class="code" href="ogfile5_8cpp.html#a4">WRITE_RECORD_SEPARATOR</a>( (&amp;file) );
00460 
00461                 file.<a class="code" href="classFile.html#a5">file_close</a>();
00462             }
00463             <span class="keywordflow">return</span> 0;
00464         }
00465 <span class="preprocessor">#endif</span>
00466 <span class="preprocessor"></span>        coursePtr-&gt;<a class="code" href="classCourse.html#m8">admission_denied_count</a> = 1;        <span class="comment">// 990415</span>
00467 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00468 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ( audit_flag ) {
00469             <a class="code" href="classFile.html">File</a> file;
00470 
00471             <span class="keywordtype">char</span> fileName[123];
00472 
00473             <span class="keywordflow">switch</span>( student_level ) {
00474             <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>:    strcpy( fileName, <span class="stringliteral">"TRADITION"</span> );
00475                 <span class="keywordflow">break</span>;
00476             <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a4">UG_NONTRADITION</a>: strcpy( fileName, <span class="stringliteral">"NONTRADITION"</span> );
00477                 <span class="keywordflow">break</span>;
00478             <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a5">MASTER</a>:        strcpy( fileName, <span class="stringliteral">"MASTER"</span> );
00479                 <span class="keywordflow">break</span>;
00480             <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a6">DOCTOR</a>:        strcpy( fileName, <span class="stringliteral">"DOCTOR"</span> );
00481                 <span class="keywordflow">break</span>;
00482             }
00483 
00484             strcat( fileName, m.format(old_student_recno) );
00485             strcat( fileName, <span class="stringliteral">".txt"</span> );
00486 
00487             file.<a class="code" href="classFile.html#a4">file_append</a>( fileName );
00488             file.<a class="code" href="classFile.html#a7">file_seek</a>(0, FILE_END);
00489 
00490             <span class="comment">// denied</span>
00491             <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"Denied"</span> );
00492             <a class="code" href="ogfile5_8cpp.html#a4">WRITE_RECORD_SEPARATOR</a>( (&amp;file) );
00493 
00494             file.<a class="code" href="classFile.html#a5">file_close</a>();
00495         }
00496 <span class="preprocessor">#endif</span>
00497 <span class="preprocessor"></span>        <span class="keywordflow">return</span> 0;
00498     }
00499 
00500     <span class="comment">//--- if a course already exists for the course cell ---//</span>
00501 
00502     <span class="keywordtype">int</span> facultyRecno;
00503 
00504     <span class="keywordflow">if</span>( initPrevFlag )
00505         <span class="keywordflow">goto</span> assign_course_succeeded;                 <span class="comment">//always successful, skip initing course</span>
00506 
00507     <span class="keywordflow">if</span>( coursePtr-&gt;<a class="code" href="classCourse.html#m10">class_section_count</a> &gt; 0 ) {
00508         <span class="keywordflow">if</span>( coursePtr-&gt;<a class="code" href="classCourse.html#m11">cur_section_student_count</a> &lt;=
00509             <span class="comment">// 1.25 implies that a 25% overload will be allowed before another section is created.</span>
00510             (float) coursePtr-&gt;<a class="code" href="classCourse.html#a0">normal_class_size</a>() * 1.25 - 1 ) {
00511             coursePtr-&gt;<a class="code" href="classCourse.html#m11">cur_section_student_count</a>++;
00512 
00513             <span class="keywordflow">goto</span> assign_course_succeeded;
00514         }
00515     }
00516 
00517     <span class="comment">//---- if no course exists or the current section is already full ----//</span>
00518 
00519     <span class="comment">//  if( ignoreFaculty ) // allow course denial in pre-run year (but not initialization)</span>
00520     <span class="comment">// use (info.prerun_year &amp;&amp; info.game_year==1) to exclude start of year 1 (info.prerun_year still 1) )</span>
00521     <span class="keywordflow">if</span>( ignoreFaculty || (info.prerun_year &amp;&amp; info.game_year==1) )
00522         facultyRecno = 1;
00523     <span class="keywordflow">else</span>
00524         facultyRecno = get_available_faculty(selectedCourseDept);
00525 
00526     <span class="comment">//--- if a faculty is found, open a new section for this course ---//</span>
00527 
00528     <span class="keywordflow">if</span>( facultyRecno ) {
00529         <span class="keywordflow">if</span>( !ignoreFaculty )
00530             deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>[facultyRecno]-&gt;<a class="code" href="classFacultyArray.html#m10">teaching_contact_hour</a> += <a class="code" href="Ocourse_8h.html#a4">CONTACT_HOUR_PER_COURSE</a>;
00531 
00532         coursePtr-&gt;<a class="code" href="classCourse.html#m10">class_section_count</a>++;
00533         coursePtr-&gt;<a class="code" href="classCourse.html#m11">cur_section_student_count</a> = 1;     <span class="comment">// 0112      282</span>
00534 
00535     }
00536     <span class="comment">// 1217</span>
00537     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( player_school.cur_trimester == <a class="code" href="Gamedef_8h.html#a79a38">SUMMER</a> ) {
00538         <span class="comment">// pretend to add a dummy phantom faculty by adding cost</span>
00539 
00540         <span class="comment">//BUGHERE, this following line will dramatically increase the academic staff expenses and make the financials go crazy. Therefore it is removed.</span>
00541 
00542         <span class="comment">//              finance.budget_expense_array[AC_ACADEMIC_DEPARTMENTS].staff += deptPtr-&gt;peer_numeraire_salary / 1000.0;</span>
00543         coursePtr-&gt;<a class="code" href="classCourse.html#m11">cur_section_student_count</a>++;       <span class="comment">// 0112</span>
00544 
00545     }
00546     <span class="keywordflow">else</span> {                                          <span class="comment">//--- no faculty is available for opening a new course section ---//</span>
00547         <span class="keywordflow">if</span>( coursePtr-&gt;<a class="code" href="classCourse.html#m6">convention_student_count</a> &lt;=
00548             <span class="comment">// 1.5 implies that a 33% overload will be allowed before a course is closed.</span>
00549             coursePtr-&gt;<a class="code" href="classCourse.html#m10">class_section_count</a> * coursePtr-&gt;<a class="code" href="classCourse.html#a0">normal_class_size</a>() * 1.5f - 1 ) {
00550             coursePtr-&gt;<a class="code" href="classCourse.html#m11">cur_section_student_count</a>++;
00551         }
00552         <span class="keywordflow">else</span> {
00553             coursePtr-&gt;<a class="code" href="classCourse.html#m5">is_closed</a>=1;                     <span class="comment">// 1 if this course is closed. This happens when there is no faculty member available for creating new course section.</span>
00554 
00555             <span class="comment">/*#if(GAME_VERSION&gt;=200)</span>
00556 <span class="comment">              if ( m.random(101) &lt;= deptPtr-&gt;ease_outsourcing_credits )         // if canceled denied request</span>
00557 <span class="comment">              {</span>
00558 <span class="comment">              deptPtr-&gt;outsourcing_credits++;</span>
00559 <span class="comment">              coursePtr-&gt;cur_section_student_count++;</span>
00560 <span class="comment"></span>
00561 <span class="comment">              goto assign_course_succeeded;</span>
00562 <span class="comment">              }</span>
00563 <span class="comment">              #endif*/</span>
00564 
00565             <span class="comment">//coursePtr-&gt;admission_denied_count++;</span>
00566 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00567 <span class="preprocessor"></span>            <span class="comment">// Version 2.0 Item 8d iv)</span>
00568             <span class="keywordtype">int</span> randomNumber = m.random(100);
00569             <span class="comment">// if the denied is canceled</span>
00570             <span class="keywordflow">if</span> (randomNumber &lt; deptPtr-&gt;ease_outsourcing_credits ) {
00571                 coursePtr-&gt;outsourcing_credits = 1;
00572                 <span class="comment">//         coursePtr-&gt;cur_section_student_count++;</span>
00573                 <span class="keywordflow">if</span> ( audit_flag ) {
00574                     <a class="code" href="classFile.html">File</a> file;
00575 
00576                     <span class="keywordtype">char</span> fileName[123];
00577 
00578                     <span class="keywordflow">switch</span>( student_level ) {
00579                     <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>:    strcpy( fileName, <span class="stringliteral">"TRADITION"</span> );
00580                         <span class="keywordflow">break</span>;
00581                     <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a4">UG_NONTRADITION</a>: strcpy( fileName, <span class="stringliteral">"NONTRADITION"</span> );
00582                         <span class="keywordflow">break</span>;
00583                     <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a5">MASTER</a>:        strcpy( fileName, <span class="stringliteral">"MASTER"</span> );
00584                         <span class="keywordflow">break</span>;
00585                     <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a6">DOCTOR</a>:        strcpy( fileName, <span class="stringliteral">"DOCTOR"</span> );
00586                         <span class="keywordflow">break</span>;
00587                     }
00588 
00589                     strcat( fileName, m.format(old_student_recno) );
00590                     strcat( fileName, <span class="stringliteral">".txt"</span> );
00591 
00592                     file.<a class="code" href="classFile.html#a4">file_append</a>( fileName );
00593                     file.<a class="code" href="classFile.html#a7">file_seek</a>(0, FILE_END);
00594 
00595                     <span class="comment">// Pass</span>
00596                     <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"Pass"</span> );
00597                     <a class="code" href="ogfile5_8cpp.html#a4">WRITE_RECORD_SEPARATOR</a>( (&amp;file) );
00598 
00599                     file.<a class="code" href="classFile.html#a5">file_close</a>();
00600                 }
00601                 <span class="keywordflow">return</span> 0;
00602             }
00603 <span class="preprocessor">#endif</span>
00604 <span class="preprocessor"></span>            coursePtr-&gt;<a class="code" href="classCourse.html#m8">admission_denied_count</a> = 1;      <span class="comment">// 990415</span>
00605 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00606 <span class="preprocessor"></span>            <span class="keywordflow">if</span> ( audit_flag ) {
00607                 <a class="code" href="classFile.html">File</a> file;
00608 
00609                 <span class="keywordtype">char</span> fileName[123];
00610 
00611                 <span class="keywordflow">switch</span>( student_level ) {
00612                 <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>:    strcpy( fileName, <span class="stringliteral">"TRADITION"</span> );
00613                     <span class="keywordflow">break</span>;
00614                 <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a4">UG_NONTRADITION</a>: strcpy( fileName, <span class="stringliteral">"NONTRADITION"</span> );
00615                     <span class="keywordflow">break</span>;
00616                 <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a5">MASTER</a>:        strcpy( fileName, <span class="stringliteral">"MASTER"</span> );
00617                     <span class="keywordflow">break</span>;
00618                 <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a6">DOCTOR</a>:        strcpy( fileName, <span class="stringliteral">"DOCTOR"</span> );
00619                     <span class="keywordflow">break</span>;
00620                 }
00621 
00622                 strcat( fileName, m.format(old_student_recno) );
00623                 strcat( fileName, <span class="stringliteral">".txt"</span> );
00624 
00625                 file.<a class="code" href="classFile.html#a4">file_append</a>( fileName );
00626                 file.<a class="code" href="classFile.html#a7">file_seek</a>(0, FILE_END);
00627 
00628                 <span class="comment">// denied</span>
00629                 <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"Denied"</span> );
00630                 <a class="code" href="ogfile5_8cpp.html#a4">WRITE_RECORD_SEPARATOR</a>( (&amp;file) );
00631 
00632                 file.<a class="code" href="classFile.html#a5">file_close</a>();
00633             }
00634 <span class="preprocessor">#endif</span>
00635 <span class="preprocessor"></span>
00636             <span class="keywordflow">return</span> 0;                                   <span class="comment">// admission denied, choice of D-DF-TM has failed.</span>
00637         }
00638     }
00639 
00640     <span class="comment">//--- increase counters as the course has been successfully assigned ---//</span>
00641 
00642  assign_course_succeeded:
00643 
00644     <span class="keywordflow">if</span>( !initPrevFlag ) {
00645         coursePtr-&gt;<a class="code" href="classCourse.html#m6">convention_student_count</a>++;
00646     }
00647 
00648     total_course_this_trimester++;                  <span class="comment">// increase this regardless of whether the student has passed the course or not, as it is for determining whether the student has taken all the required courses in a trimester</span>
00649 
00650     <span class="keywordflow">if</span>( isRequiredCourse )
00651         total_required_course_this_trimester++;
00652     <span class="keywordflow">else</span>
00653         total_elective_course_this_year++;
00654 
00655     <span class="comment">//  course_taking_array[selectedCourseDept-1]++;</span>
00656 
00657     <span class="keywordflow">if</span>( study_course(selectedCourseDept) ) {        <span class="comment">// return 1 if the student has passed the course</span>
00658         <span class="comment">//      if(1)    //##testing</span>
00659 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00660 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ( audit_flag ) {
00661             <a class="code" href="classFile.html">File</a> file;
00662 
00663             <span class="keywordtype">char</span> fileName[123];
00664 
00665             <span class="keywordflow">switch</span>( student_level ) {
00666             <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>:    strcpy( fileName, <span class="stringliteral">"TRADITION"</span> );
00667                 <span class="keywordflow">break</span>;
00668             <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a4">UG_NONTRADITION</a>: strcpy( fileName, <span class="stringliteral">"NONTRADITION"</span> );
00669                 <span class="keywordflow">break</span>;
00670             <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a5">MASTER</a>:        strcpy( fileName, <span class="stringliteral">"MASTER"</span> );
00671                 <span class="keywordflow">break</span>;
00672             <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a6">DOCTOR</a>:        strcpy( fileName, <span class="stringliteral">"DOCTOR"</span> );
00673                 <span class="keywordflow">break</span>;
00674             }
00675 
00676             strcat( fileName, m.format(old_student_recno) );
00677             strcat( fileName, <span class="stringliteral">".txt"</span> );
00678 
00679             file.<a class="code" href="classFile.html#a4">file_append</a>( fileName );
00680             file.<a class="code" href="classFile.html#a7">file_seek</a>(0, FILE_END);
00681 
00682             <span class="comment">// Pass</span>
00683             <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"Pass"</span> );
00684             <a class="code" href="ogfile5_8cpp.html#a4">WRITE_RECORD_SEPARATOR</a>( (&amp;file) );
00685 
00686             file.<a class="code" href="classFile.html#a5">file_close</a>();
00687         }
00688 <span class="preprocessor">#endif</span>
00689 <span class="preprocessor"></span>        <span class="comment">// increment the student's course to_take counter</span>
00690         course_taken_array[selectedCourseDept-1][selectedCourseDepth]++;
00691 
00692         total_course_all++;                           <span class="comment">// only increase the total course count if the student has passed the course</span>
00693         <span class="comment">// if the student failed the course, the counters will not be incremented</span>
00694 
00695         <span class="comment">// no need test initPrevFlag, as course_taking_array will be clear in next select_course</span>
00696         course_taking_array[selectedCourseDept-1]++;
00697 
00698         <span class="comment">//---------------------------------------------//</span>
00699         <span class="comment">//</span>
00700         <span class="comment">// Select major for undecided students right after</span>
00701         <span class="comment">// they have passed their 8th course. (that's</span>
00702         <span class="comment">// 2 semesters worth of courses for traditional</span>
00703         <span class="comment">// undergraduates</span>
00704         <span class="comment">//</span>
00705         <span class="comment">//---------------------------------------------//</span>
00706 
00707         <span class="keywordflow">if</span>( department_recno==0 &amp;&amp; total_course_all &gt;= 8 ) {
00708             think_change_major(1);                      <span class="comment">// 1: course completed</span>
00709             <span class="keywordflow">return</span> 1;                                   <span class="comment">// this dummy student is removed!</span>
00710             <span class="comment">//err_when( department_recno &lt; 1 || department_recno &gt; department_array.size() );</span>
00711         }
00712     }
00713     <span class="keywordflow">else</span> {
00714 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00715 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ( audit_flag ) {
00716             <a class="code" href="classFile.html">File</a> file;
00717 
00718             <span class="keywordtype">char</span> fileName[123];
00719 
00720             <span class="keywordflow">switch</span>( student_level ) {
00721             <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>:    strcpy( fileName, <span class="stringliteral">"TRADITION"</span> );
00722                 <span class="keywordflow">break</span>;
00723             <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a4">UG_NONTRADITION</a>: strcpy( fileName, <span class="stringliteral">"NONTRADITION"</span> );
00724                 <span class="keywordflow">break</span>;
00725             <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a5">MASTER</a>:        strcpy( fileName, <span class="stringliteral">"MASTER"</span> );
00726                 <span class="keywordflow">break</span>;
00727             <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a6">DOCTOR</a>:        strcpy( fileName, <span class="stringliteral">"DOCTOR"</span> );
00728                 <span class="keywordflow">break</span>;
00729             }
00730 
00731             strcat( fileName, m.format(old_student_recno) );
00732             strcat( fileName, <span class="stringliteral">".txt"</span> );
00733 
00734             file.<a class="code" href="classFile.html#a4">file_append</a>( fileName );
00735             file.<a class="code" href="classFile.html#a7">file_seek</a>(0, FILE_END);
00736 
00737             <span class="comment">// Fail</span>
00738             <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"Fail"</span> );
00739             <a class="code" href="ogfile5_8cpp.html#a4">WRITE_RECORD_SEPARATOR</a>( (&amp;file) );
00740 
00741             file.<a class="code" href="classFile.html#a5">file_close</a>();
00742         }
00743 <span class="preprocessor">#endif</span>
00744 <span class="preprocessor"></span>        <span class="keywordflow">if</span>( !initPrevFlag )
00745             coursePtr-&gt;<a class="code" href="classCourse.html#m9">failure_count</a>++;
00746         this-&gt;failed_course_count++;
00747         <span class="comment">// no need test initPrevFlag, as course_taking_array will be clear in next select_course</span>
00748         this-&gt;course_failures_this_trimester++;
00749     }
00750 
00751     <span class="keywordflow">return</span> 1;
00752 }
00753 
00754 <span class="comment">//-------- End of function Student::assign_course --------//</span>
00755 
00756 <span class="comment">//--------- Begin of function Student::get_available_faculty ---------//</span>
00760 <span class="comment">int Student::get_available_faculty(int departmentRecno) {</span>
00761     <a class="code" href="classDepartment.html">Department</a>* deptPtr = department_array[departmentRecno];
00762 
00763     <a class="code" href="classFaculty.html">Faculty</a>* facultyPtr;
00764     <span class="keywordtype">int</span>      facultySize = deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classDynArray.html#a28">size</a>();
00765     <span class="comment">// randomly pick a faculty to start the scanning</span>
00766     <span class="keywordtype">int</span>      facultyRecno=m.random( facultySize ) + 1;
00767 
00768     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=facultySize ; i&gt;0 ; i-- ) {
00769         <span class="keywordflow">if</span>( ++facultyRecno &gt; facultySize )
00770             facultyRecno = 1;
00771 
00772         <span class="keywordflow">if</span>( deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#a10">is_deleted</a>(facultyRecno) )
00773             <span class="keywordflow">continue</span>;
00774 
00775         facultyPtr = deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>[facultyRecno];
00776 
00777         <span class="keywordflow">if</span>( <a class="code" href="Ofaculty_8h.html#a0">NORMAL_TEACHING_CONTACT_HOUR</a> - facultyPtr-&gt;<a class="code" href="classFaculty.html#m13">teaching_contact_hour</a>
00778             &gt;= <a class="code" href="Ocourse_8h.html#a4">CONTACT_HOUR_PER_COURSE</a> ) {
00779             <span class="keywordflow">return</span> facultyRecno;
00780         }
00781     }
00782 
00783     <span class="keywordflow">return</span> 0;                                       <span class="comment">//0112</span>
00784 }
00785 
00786 <span class="comment">//--------- End of function Student::get_available_faculty -----------//</span>
00787 
00788 <span class="comment">//-------- Begin of function Student::select_required_course --------//</span>
00800 <span class="comment">int Student::select_required_course(int &amp;selectedCourseDept, int&amp; selectedCourseDepth, int &amp;selectedCourseFocus) {</span>
00801     <span class="comment">//----------------------------------------------------------//</span>
00802     <span class="comment">//</span>
00803     <span class="comment">// Calculate the number of required courses that must be taken.</span>
00804     <span class="comment">// It is 4 (a constant) minus the minimum number of elective</span>
00805     <span class="comment">// courses that must be taken.</span>
00806     <span class="comment">//</span>
00807     <span class="comment">//----------------------------------------------------------//</span>
00808 
00809     <a class="code" href="classGeneralDepartment.html">GeneralDepartment</a>* studentDept;
00810 
00811     <span class="keywordflow">if</span>( department_recno==0 )                       <span class="comment">// if the student's major is undecided, the student is currently studying general education</span>
00812         studentDept = &amp;(department_res.general_dept);
00813     <span class="keywordflow">else</span>
00814         <span class="comment">// the department where the student is currently majoring at</span>
00815         studentDept = department_array[department_recno];
00816 
00817     <a class="code" href="structDepartmentInfo.html">DepartmentInfo</a>* studDeptInfo = department_res[studentDept-&gt;<a class="code" href="classGeneralDepartment.html#m2">department_id</a>];
00818 
00819     <span class="comment">// master students do not study general education</span>
00820     <a class="code" href="ALL_8H.html#a0">err_when</a>( studentDept-&gt;<a class="code" href="classGeneralDepartment.html#m2">department_id</a>==0 &amp;&amp; (student_level == <a class="code" href="Ostudent_8h.html#a32a5">MASTER</a> || student_level == <a class="code" href="Ostudent_8h.html#a32a6">DOCTOR</a>) );
00821 
00822     <span class="comment">//------------------------------------------------------//</span>
00823 
00824     <span class="keywordtype">int</span> neededElectCourse=0;
00825 
00826     <span class="keywordflow">if</span>( student_level == <a class="code" href="Ostudent_8h.html#a32a5">MASTER</a> ) {
00827         <span class="keywordflow">if</span>( year_in_program&lt;=<a class="code" href="Ostudent_8h.html#a38a22">MASTER_YEAR_COUNT</a> )      <span class="comment">// master program only has one year</span>
00828             neededElectCourse = studDeptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m36">master_elective_year_count</a>;
00829     }
00830     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( is_ug_group(student_level) ) {
00831         <span class="keywordflow">if</span>( year_in_program&lt;=<a class="code" href="Ostudent_8h.html#a38a21">BACHELOR_YEAR_COUNT</a> )
00832             neededElectCourse = studDeptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m3">bachelor_elective_year_count</a>[year_in_program-1];
00833     }
00834 
00835     <span class="comment">//---------------------------------------------------//</span>
00836     <span class="comment">//</span>
00837     <span class="comment">// Since the sim only stores the min number of elective</span>
00838     <span class="comment">// courses in a year, we need to break it down into</span>
00839     <span class="comment">// a trimester basis. If the current trimester is the</span>
00840     <span class="comment">// first trimester, it will divide the total elective</span>
00841     <span class="comment">// courses in a year by 2 (for a trimester). If it is</span>
00842     <span class="comment">// in other trimester, it will get the remaining</span>
00843     <span class="comment">// elective courses that have yet been taken.</span>
00844     <span class="comment">//</span>
00845     <span class="comment">//---------------------------------------------------//</span>
00846 
00847     <span class="keywordflow">if</span>( player_school.cur_trimester == <a class="code" href="Gamedef_8h.html#a80a39">FIRST_TRIMESTER</a> )
00848         neededElectCourse /= 2;
00849     <span class="keywordflow">else</span>
00850         <span class="comment">// minus the total number of elective courses that have been taken gives the total number of remaining elective courses that must be taken</span>
00851         neededElectCourse -= total_elective_course_this_year;
00852 
00853     <span class="keywordtype">int</span> neededRequiredCourse = course_per_trimester[player_school.cur_trimester] - neededElectCourse;
00854 
00855     <span class="comment">//err_when( neededRequiredCourse &lt;= 0 );    // this function should have been called at all if it &lt;= 0</span>
00856 
00857     <span class="keywordflow">if</span> ( neededRequiredCourse &lt;= 0 )
00858         <span class="keywordflow">return</span> 0;
00859 
00860     <span class="keywordflow">if</span> ( total_required_course_this_trimester == neededRequiredCourse )
00861         <span class="keywordflow">return</span> 0;
00862 
00863     <a class="code" href="ALL_8H.html#a0">err_when</a>( total_required_course_this_trimester &gt; neededRequiredCourse );
00864 
00865     <span class="comment">//------ reckon the remaining courses of this student in each department ---------//</span>
00866 
00867     <span class="keywordtype">int</span> remainCourse;
00868     <span class="keywordtype">int</span> highestDepth;
00869     <span class="keywordtype">int</span> mostRemainCourse=0;
00870     <span class="keywordtype">int</span> selectedCourseHighestDepth = 0;
00871     <span class="keywordtype">int</span> deptCount = department_array.size();
00872 
00873     selectedCourseDept=0;                           <span class="comment">// it's a function parameter</span>
00874 
00875     <span class="keyword">static</span> <span class="keywordtype">char</span> bachelorCourseDepth[] = {  <a class="code" href="Ocourse_8h.html#a36a14">DEPTH_D1</a>, <a class="code" href="Ocourse_8h.html#a36a15">DEPTH_D2</a>, <a class="code" href="Ocourse_8h.html#a36a16">DEPTH_D3</a> };
00876     <span class="keyword">static</span> <span class="keywordtype">char</span> masterCourseDepth[] = { <a class="code" href="Ocourse_8h.html#a36a16">DEPTH_D3</a>, <a class="code" href="Ocourse_8h.html#a36a17">DEPTH_GR</a> };
00877     <span class="keyword">static</span> <span class="keywordtype">char</span> doctorCourseDepth[] = { <a class="code" href="Ocourse_8h.html#a36a17">DEPTH_GR</a> };
00878 
00879     <span class="keywordtype">char</span>* courseDepthArray;
00880     <span class="keywordtype">int</span>   courseDepthCount;
00881     <span class="keywordtype">char</span>  courseDepth;
00882 
00883     <span class="keywordflow">switch</span>( student_level ) {
00884     <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>:
00885     <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a4">UG_NONTRADITION</a>:
00886     <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a7">DISTANCE_LEARN</a>:
00887         courseDepthArray = bachelorCourseDepth;
00888         courseDepthCount = 3;
00889         <span class="keywordflow">break</span>;
00890 
00891     <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a5">MASTER</a>:
00892         courseDepthArray = masterCourseDepth;
00893         courseDepthCount = 2;
00894         <span class="keywordflow">break</span>;
00895 
00896     <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a6">DOCTOR</a>:
00897         courseDepthArray = doctorCourseDepth;
00898         courseDepthCount = 1;
00899         <span class="keywordflow">break</span>;
00900 
00901     <span class="keywordflow">default</span>:
00902         <a class="code" href="ALL_8H.html#a1">err_here</a>();
00903     }
00904 
00905     <span class="comment">//-------------------------------------------------------------//</span>
00906     <span class="comment">/*</span>
00907 <span class="comment">      //  990415 for debug only</span>
00908 <span class="comment">      {</span>
00909 <span class="comment">      int total = 0;</span>
00910 <span class="comment"></span>
00911 <span class="comment">      for( int deptRecno=1 ; deptRecno&lt;=deptCount ; deptRecno++ )</span>
00912 <span class="comment">      for( int i=0 ; i&lt;courseDepthCount; i++ )</span>
00913 <span class="comment">      {</span>
00914 <span class="comment">      courseDepth = courseDepthArray[i];</span>
00915 <span class="comment">      total += course_taken_array[deptRecno-1][courseDepth];</span>
00916 <span class="comment">      }</span>
00917 <span class="comment"></span>
00918 <span class="comment">      total += 0;</span>
00919 <span class="comment">      }</span>
00920 <span class="comment">    */</span>
00921 
00922     <span class="comment">//----//</span>
00923     remainCourse = 0;
00924 
00925 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00926 <span class="preprocessor"></span>    <span class="comment">// check for the department has mostRemainCourse</span>
00927     <span class="keywordtype">int</span> mostDept=0;
00928     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> deptRecno=1; deptRecno&lt;=deptCount ; deptRecno++ ) {
00929         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;courseDepthCount; i++ ) {
00930             <span class="keywordtype">int</span> remainCourseinit = 0;                   <span class="comment">//## chea 291199</span>
00931             courseDepth = courseDepthArray[i];
00932 
00933             remainCourse += studentDept-&gt;<a class="code" href="classGeneralDepartment.html#a5">get_course_requirement</a>(student_level, deptRecno, courseDepth)
00934                 - course_taken_array[deptRecno-1][courseDepth];
00935         }
00936 
00937         <span class="keywordflow">if</span> ( remainCourse &gt;= mostRemainCourse ) {
00938             mostRemainCourse = remainCourse;
00939             mostDept = deptRecno;
00940         }
00941     }
00942 
00943     <span class="keywordflow">if</span> ( mostDept == 0 )
00944         <span class="keywordflow">return</span> 0;
00945 
00946     <span class="comment">// check for the maximum depth largest number of courses</span>
00947     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=0; i&lt;courseDepthCount; i++ ) {
00948         courseDepth = courseDepthArray[i];
00949 
00950         remainCourse += studentDept-&gt;<a class="code" href="classGeneralDepartment.html#a5">get_course_requirement</a>(student_level, mostDept, courseDepth)
00951             - course_taken_array[deptRecno-1][courseDepth];
00952 
00953         <span class="keywordflow">if</span>( remainCourse &gt; 0 )                        <span class="comment">// the highest course depth of remaining courses needed to be taken in this department</span>
00954             highestDepth = courseDepth;
00955     }
00956 
00957     selectedCourseDept  = mostDept;
00958     selectedCourseHighestDepth = highestDepth;
00959 
00960 <span class="preprocessor">#else</span>
00961 <span class="preprocessor"></span>    <span class="keywordflow">for</span>( <span class="keywordtype">int</span> deptRecno=1 ; deptRecno&lt;=deptCount ; deptRecno++ ) {
00962         highestDepth = 0;
00963 
00964         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;courseDepthCount; i++ ) {
00965             <span class="keywordtype">int</span> remainCourseinit = 0;                   <span class="comment">//## chea 291199</span>
00966             courseDepth = courseDepthArray[i];
00967 
00968             <span class="comment">// get_course_requirement</span>
00969             <span class="comment">// Get the number of required courses of the specific department that</span>
00970             <span class="comment">// a student majoring in this department has to take.</span>
00971 
00972             <span class="comment">//                  if(student_level==0 &amp;&amp; deptRecno==6 &amp;&amp; courseDepth==0)</span>
00973             <span class="comment">//                          int sgs=0;</span>
00974 
00975             <span class="comment">//                  int sdf = studentDept-&gt;get_course_requirement(student_level, deptRecno, courseDepth);</span>
00976 
00977             <span class="comment">//                  if (sdf &lt; 0)</span>
00978             <span class="comment">//                           int ddfgsdf=0;</span>
00979 
00980             <span class="comment">//                  if(course_taken_array[deptRecno-1][courseDepth]&gt;0)</span>
00981             <span class="comment">//                          info.debug[deptRecno]++;</span>
00982 
00983             remainCourse += studentDept-&gt;<a class="code" href="classGeneralDepartment.html#a5">get_course_requirement</a>(student_level, deptRecno, courseDepth)
00984                 - course_taken_array[deptRecno-1][courseDepth];
00985 
00986             <span class="comment">//## chea 291199 the course_taken_array is useless in init</span>
00987             <span class="comment">//                  remainCourseinit += studentDept-&gt;get_course_requirement(student_level, deptRecno, courseDepth);</span>
00988 
00989             <span class="keywordflow">if</span>( remainCourse &gt; 0 )                      <span class="comment">// the highest course depth of remaining courses needed to be taken in this department</span>
00990                 highestDepth = courseDepth;
00991         }
00992 
00993         <span class="comment">//------ select the department with most remaining courses ------//</span>
00994 
00995         <span class="keywordflow">if</span>( remainCourse &gt;= mostRemainCourse ) {
00996             <span class="keywordflow">if</span>( remainCourse &gt; mostRemainCourse ||      <span class="comment">// either the number of remaining course is higher</span>
00997                 <span class="comment">// or has a higher course depth when the number of remaining courses are the same</span>
00998                 highestDepth &gt; selectedCourseHighestDepth ||
00999                 m.random(2)==0 ) {                          <span class="comment">// or randomly if the number of remaining courses and course depth are both the same</span>
01000                 mostRemainCourse    = remainCourse;
01001                 selectedCourseDept  = deptRecno;
01002                 selectedCourseHighestDepth = highestDepth;
01003             }
01004         }
01005     }                                               <span class="comment">// end for</span>
01006 <span class="preprocessor">#endif</span>
01007 <span class="preprocessor"></span>
01008     <span class="comment">//## chea 291199 test and this work to control the course no.</span>
01009     <span class="comment">//  selectedCourseDept = this-&gt;department_recno;</span>
01010     <span class="comment">//  info.debug[selectedCourseDept]++;</span>
01011 
01012     <span class="keywordflow">if</span>( selectedCourseDept==0 )                     <span class="comment">// no department is selected</span>
01013         <span class="keywordflow">return</span> 0;
01014 
01015     <span class="comment">//---------- select course depth ------------//</span>
01016 
01017     <span class="keywordtype">int</span> totalCourseTaken = total_course_taken_dept(selectedCourseDept);
01018 
01019     <span class="keywordflow">if</span>( totalCourseTaken &lt;=2 )
01020         selectedCourseDepth = <a class="code" href="Ocourse_8h.html#a36a14">DEPTH_D1</a>;
01021 
01022     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( totalCourseTaken &lt;=4 )
01023         selectedCourseDepth = <a class="code" href="Ocourse_8h.html#a36a15">DEPTH_D2</a>;
01024 
01025     <span class="keywordflow">else</span>
01026         selectedCourseDepth = <a class="code" href="Ocourse_8h.html#a36a16">DEPTH_D3</a>;
01027 
01028     <span class="comment">//--------- select course focus ---------//</span>
01029 
01030     <span class="keywordflow">switch</span>( selectedCourseDepth ) {                 <span class="comment">// updated by WFM notes 0909</span>
01031     <span class="keywordflow">case</span> <a class="code" href="Ocourse_8h.html#a36a14">DEPTH_D1</a>:
01032         <span class="keywordflow">if</span>( total_course_all &lt; 9 ) {
01033             selectedCourseFocus = <a class="code" href="Ocourse_8h.html#a37a18">FOCUS_LD</a>;
01034         }
01035         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( total_course_all &lt; 16 ) {
01036             selectedCourseFocus = (m.random(2)==0 ? <a class="code" href="Ocourse_8h.html#a37a18">FOCUS_LD</a> : <a class="code" href="Ocourse_8h.html#a37a19">FOCUS_M</a> );
01037         }
01038         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( total_course_all &lt; 24 ) {
01039             selectedCourseFocus = (m.random(2)==0 ? <a class="code" href="Ocourse_8h.html#a37a19">FOCUS_M</a> : <a class="code" href="Ocourse_8h.html#a37a20">FOCUS_UD</a> );
01040         }
01041         <span class="keywordflow">else</span>
01042             selectedCourseFocus = <a class="code" href="Ocourse_8h.html#a37a20">FOCUS_UD</a>;
01043         <span class="keywordflow">break</span>;
01044 
01045     <span class="keywordflow">case</span> <a class="code" href="Ocourse_8h.html#a36a15">DEPTH_D2</a>:
01046         <span class="keywordflow">if</span>( total_course_all &lt; 16 ) {
01047             selectedCourseFocus = <a class="code" href="Ocourse_8h.html#a37a19">FOCUS_M</a>;
01048         }
01049         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( total_course_all &lt; 24 ) {
01050             selectedCourseFocus = (m.random(2)==0 ? <a class="code" href="Ocourse_8h.html#a37a19">FOCUS_M</a> : <a class="code" href="Ocourse_8h.html#a37a20">FOCUS_UD</a> );
01051         }
01052         <span class="keywordflow">else</span>
01053             selectedCourseFocus = <a class="code" href="Ocourse_8h.html#a37a20">FOCUS_UD</a>;
01054         <span class="keywordflow">break</span>;
01055 
01056     <span class="keywordflow">case</span> <a class="code" href="Ocourse_8h.html#a36a16">DEPTH_D3</a>:
01057         selectedCourseFocus = <a class="code" href="Ocourse_8h.html#a37a20">FOCUS_UD</a>;
01058         <span class="keywordflow">break</span>;
01059     }
01060 
01061     <span class="keywordflow">return</span> 1;
01062 }
01063 
01064 <span class="comment">//-------- End of function Student::select_required_course --------//</span>
01065 
01066 <span class="comment">//-------- Begin of function Student::select_elective_course --------//</span>
01074 <span class="comment">void Student::select_elective_course(int &amp;selectedCourseDept, int&amp; selectedCourseDepth, int &amp;selectedCourseFocus) {</span>
01075     <span class="comment">//------------------------------------------------------------//</span>
01076     <span class="comment">//</span>
01077     <span class="comment">// A student can take as many elective courses as he/she wants</span>
01078     <span class="comment">// as long as he/she has taken all the required courses.</span>
01079     <span class="comment">//</span>
01080     <span class="comment">//------------------------------------------------------------//</span>
01081 
01082     <span class="comment">//------ select the department of the elective course ------//</span>
01083 
01084     <span class="keywordtype">int</span> deptPref;
01085     <span class="keywordtype">float</span> totalPref = (float) 0;
01086     <span class="keywordtype">int</span> deptCount = department_array.size();
01087 
01088     <a class="code" href="classGeneralDepartment.html">GeneralDepartment</a>* studentDept;
01089 
01090     <span class="keywordflow">if</span>( department_recno==0 )                       <span class="comment">// if the student's major is undecided, the student is currently studying general education</span>
01091         studentDept = &amp;(department_res.general_dept);
01092     <span class="keywordflow">else</span>
01093         <span class="comment">// the department where the student is currently majoring at</span>
01094         studentDept = department_array[department_recno];
01095 
01096     <span class="comment">// if studentDept-&gt;department_id is 0, it will return department_res.general_dept_info</span>
01097     <a class="code" href="structDepartmentInfo.html">DepartmentInfo</a>* studDeptInfo = department_res[studentDept-&gt;<a class="code" href="classGeneralDepartment.html#m2">department_id</a>];
01098 
01099     <a class="code" href="ALL_8H.html#a0">err_when</a>( department_recno==0 &amp;&amp; studDeptInfo != &amp;(department_res.general_dept_info));
01100 
01101     <span class="comment">// master students do not study general education</span>
01102     <a class="code" href="ALL_8H.html#a0">err_when</a>( studentDept-&gt;<a class="code" href="classGeneralDepartment.html#m2">department_id</a>==0 &amp;&amp; (student_level == <a class="code" href="Ostudent_8h.html#a32a5">MASTER</a> || student_level == <a class="code" href="Ostudent_8h.html#a32a6">DOCTOR</a>) );
01103 
01104     selectedCourseDept = 0;
01105 
01106     <span class="comment">//---- get the total preference weights of all existing departments and draw a random number based on it ----//</span>
01107 
01108     <span class="keywordflow">if</span>( student_level == <a class="code" href="Ostudent_8h.html#a32a5">MASTER</a> )
01109         deptPref = m.random( (<span class="keywordtype">int</span>) studDeptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m38">total_master_elective_course_pref</a> );
01110     <span class="keywordflow">else</span>
01111         deptPref = m.random( (<span class="keywordtype">int</span>) studDeptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m5">total_bachelor_elective_course_pref</a> );
01112 
01113     <span class="comment">//------ see which department the random number points to ----//</span>
01114 
01115     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=department_array.size() ; i&gt;0 ; i-- ) {
01116         <span class="keywordflow">if</span>( department_array.is_deleted(i) )
01117             <span class="keywordflow">continue</span>;
01118 
01119         <span class="keywordtype">int</span> deptId = department_array[i]-&gt;<a class="code" href="classGeneralDepartment.html#m2">department_id</a>;
01120 
01121         <span class="keywordflow">if</span>( student_level == <a class="code" href="Ostudent_8h.html#a32a5">MASTER</a> )
01122             totalPref += studDeptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m37">master_elective_course_pref</a>[deptId-1];
01123         <span class="keywordflow">else</span>
01124             totalPref += studDeptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m4">bachelor_elective_course_pref</a>[deptId-1];
01125 
01126         <span class="keywordflow">if</span>( totalPref &gt; deptPref ) {                  <span class="comment">//## fred BUGHER should be "&gt;" ##//</span>
01127             <span class="comment">//## chea 291199 the =1 below should be wrong</span>
01128             <span class="comment">//                  selectedCourseDept = 1;</span>
01129             selectedCourseDept = i;
01130             <span class="keywordflow">break</span>;
01131 
01132         }
01133 
01134     }
01135 
01136     <a class="code" href="ALL_8H.html#a0">err_when</a>( department_recno==0 &amp;&amp; studDeptInfo != &amp;(department_res.general_dept_info));
01137     <a class="code" href="ALL_8H.html#a0">err_when</a>( selectedCourseDept==0 );
01138 
01139     <span class="comment">//------- now select the course focus --------//</span>
01140 
01141     <span class="keywordtype">int</span>        selectedCourseDeptId = department_array[selectedCourseDept]-&gt;<a class="code" href="classGeneralDepartment.html#m2">department_id</a>;
01142     <a class="code" href="structFieldInfo.html">FieldInfo</a>* selectedCourseField = field_res[ department_res[selectedCourseDeptId]-&gt;<a class="code" href="structDepartmentInfo.html#m1">field_id</a> ];
01143     <span class="keywordtype">int</span>        focusPref = m.random(100);           <span class="comment">// preference on course focus. Draw a random number</span>
01144 
01145     totalPref = 0;
01146 
01147     <span class="keywordflow">for</span>( i=0 ; i&lt;<a class="code" href="Ocourse_8h.html#a12">MAX_COURSE_FOCUS_WITHOUT_GR</a> ; i++ ) {
01148         totalPref += selectedCourseField-&gt;<a class="code" href="structFieldInfo.html#m2">elective_course_focus_pref</a>[i];
01149 
01150         <span class="keywordflow">if</span>( focusPref &lt; totalPref ) {
01151             selectedCourseFocus = i;
01152 
01153             <span class="comment">//---- if the selected focus is LD but the student is not in LD, pick between M and UD randomly ----//</span>
01154 
01155             <span class="keywordflow">if</span>( selectedCourseFocus==<a class="code" href="Ocourse_8h.html#a37a18">FOCUS_LD</a> &amp;&amp;
01156                 division_status() != <a class="code" href="Ostudent_8h.html#a37a20">LOWER_DIVISION</a> ) {
01157                 <span class="keywordflow">if</span>( m.random(2)==0 )
01158                     selectedCourseFocus = <a class="code" href="Ocourse_8h.html#a37a19">FOCUS_M</a>;
01159                 <span class="keywordflow">else</span>
01160                     selectedCourseFocus = <a class="code" href="Ocourse_8h.html#a37a20">FOCUS_UD</a>;
01161             }
01162 
01163             <span class="comment">//---- if the selected focus is UD but the student is not in UD, pick between M and UD randomly ----//</span>
01164 
01165             <span class="keywordflow">if</span>( selectedCourseFocus==<a class="code" href="Ocourse_8h.html#a37a20">FOCUS_UD</a> &amp;&amp;
01166                 division_status() != <a class="code" href="Ostudent_8h.html#a37a19">UPPER_DIVISION</a> ) {
01167                 <span class="keywordflow">if</span>( m.random(2)==0 )
01168                     selectedCourseFocus = <a class="code" href="Ocourse_8h.html#a37a19">FOCUS_M</a>;
01169                 <span class="keywordflow">else</span>
01170                     selectedCourseFocus = <a class="code" href="Ocourse_8h.html#a37a18">FOCUS_LD</a>;
01171             }
01172 
01173             <span class="keywordflow">break</span>;
01174         }
01175     }
01176 
01177     <a class="code" href="ALL_8H.html#a0">err_when</a>( selectedCourseFocus&lt;0 );
01178 
01179     <span class="comment">//--------- select course depth --------//</span>
01180 
01181     <span class="keywordtype">int</span> totalCourseTaken = total_course_taken_dept(selectedCourseDept);
01182 
01183     <span class="keywordflow">switch</span>( selectedCourseFocus ) {
01184     <span class="keywordflow">case</span> <a class="code" href="Ocourse_8h.html#a37a18">FOCUS_LD</a>:
01185         selectedCourseDepth = <a class="code" href="Ocourse_8h.html#a36a14">DEPTH_D1</a>;
01186         <span class="keywordflow">break</span>;
01187 
01188     <span class="keywordflow">case</span> <a class="code" href="Ocourse_8h.html#a37a19">FOCUS_M</a>:
01189         <span class="keywordflow">if</span>( totalCourseTaken &lt;= 2 )
01190             selectedCourseDepth = <a class="code" href="Ocourse_8h.html#a36a14">DEPTH_D1</a>;
01191         <span class="keywordflow">else</span>
01192             selectedCourseDepth = <a class="code" href="Ocourse_8h.html#a36a15">DEPTH_D2</a>;
01193         <span class="keywordflow">break</span>;
01194 
01195     <span class="keywordflow">case</span> <a class="code" href="Ocourse_8h.html#a37a20">FOCUS_UD</a>:
01196         <span class="keywordflow">if</span>( totalCourseTaken &lt;= 2 )
01197             selectedCourseDepth = <a class="code" href="Ocourse_8h.html#a36a14">DEPTH_D1</a>;
01198         <span class="keywordflow">if</span>( totalCourseTaken &lt;= 4 )
01199             selectedCourseDepth = <a class="code" href="Ocourse_8h.html#a36a15">DEPTH_D2</a>;
01200         <span class="keywordflow">else</span>
01201             selectedCourseDepth = <a class="code" href="Ocourse_8h.html#a36a16">DEPTH_D3</a>;
01202         <span class="keywordflow">break</span>;
01203     }
01204 
01205     <span class="comment">//  info.debug[selectedCourseDept]++;</span>
01206 }
01207 
01208 <span class="comment">//------- End of function Student::select_elective_course ---------//</span>
01209 
01210 <span class="comment">//------ Begin of function Student::select_teaching_method --------//</span>
01212 <span class="comment">int Student::select_teaching_method(int selectedCourseDept) {</span>
01213     <span class="comment">// modified 1105 // see req29a_course.txt</span>
01214 
01215     <span class="keywordflow">if</span> ( student_level == <a class="code" href="Ostudent_8h.html#a32a7">DISTANCE_LEARN</a> )          <span class="comment">// dl student can take dl course only</span>
01216         <span class="keywordflow">return</span> <a class="code" href="Ocourse_8h.html#a40a32">DISTANCE_LEARN_COURSE</a>;
01217 
01218     <span class="keywordtype">int</span> teachingPref = m.random(100);               <span class="comment">// preference on department. Draw a random number now</span>
01219     <span class="keywordtype">int</span> totalPref = 0;
01220 
01221     <a class="code" href="classDepartment.html">Department</a> *deptPtr = department_array[selectedCourseDept];
01222 
01223     <span class="keyword">const</span> <span class="keywordtype">char</span> pref[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>]
01224         = {
01225             deptPtr-&gt;<a class="code" href="classDepartment.html#m15">course_preference</a>[<a class="code" href="OCOURRES_8H.html#a8a3">P_SEMINAR</a>],
01226             0, deptPtr-&gt;<a class="code" href="classDepartment.html#m15">course_preference</a>[<a class="code" href="OCOURRES_8H.html#a8a4">P_CLASS_WITH_BREAKOUTS</a>],
01227             0, deptPtr-&gt;<a class="code" href="classDepartment.html#m15">course_preference</a>[<a class="code" href="OCOURRES_8H.html#a8a5">P_OTHER</a>]
01228         };
01229 
01230     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>; i++ ) {
01231         totalPref += pref[i];
01232 
01233         <span class="keywordflow">if</span>( teachingPref &lt; totalPref ) {
01234             <a class="code" href="ALL_8H.html#a0">err_when</a>(<a class="code" href="Ocourse_8h.html#a40a32">DISTANCE_LEARN_COURSE</a> == i );      <span class="comment">// only dl student can take dl course</span>
01235             <span class="keywordflow">return</span> i;
01236         }
01237     }
01238 
01239     <a class="code" href="ALL_8H.html#a1">err_here</a>();
01240 
01241     <span class="keywordflow">return</span> 0;
01242 }
01243 
01244 <span class="comment">//---------- End of function Student::select_teaching_method -----------//</span>
01245 
01246 <span class="comment">//-------- Begin of function Student::total_course_taken_dept --------//</span>
01251 <span class="comment">int Student::total_course_taken_dept(int departmentRecno) {</span>
01252     <span class="keywordtype">int</span> totalCourse=0;
01253 
01254     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;<a class="code" href="Ocourse_8h.html#a9">MAX_COURSE_DEPTH</a> ; i++ )
01255         totalCourse += course_taken_array[departmentRecno-1][i];
01256 
01257     <span class="keywordflow">return</span> totalCourse;
01258 }
01259 
01260 <span class="comment">//-------- End of function Student::total_course_taken_dept --------//</span>
01261 
01262 <span class="comment">//---------- Begin of function Student::study_course -----------//</span>
01272 <span class="comment">int Student::study_course(int studyDeptRecno) {</span>
01273     <span class="comment">//----- calculate the academic achievement rating first ----//</span>
01274 
01275     <a class="code" href="classDepartment.html">Department</a>* deptPtr = department_array[studyDeptRecno];
01276 
01277     <span class="comment">//--- calculate the mean academic achievement ---//</span>
01278 
01279     <span class="keywordtype">float</span> meanAcadAch = 150 - (deptPtr-&gt;<a class="code" href="classDepartment.html#m42">p_educational_quality</a>+talent_academic) / 4
01280         - (100-deptPtr-&gt;<a class="code" href="classDepartment.html#m42">p_educational_quality</a>)*(100-talent_academic) / 100;
01281 
01282     meanAcadAch = min( meanAcadAch, 100.0f );       <span class="comment">// min &amp; max bug chea</span>
01283 
01284     <span class="comment">//---- calculate the standard deviation -----//</span>
01285 
01286     <span class="keywordtype">float</span> stdDevAcadAch = (float) sqrt( meanAcadAch * (100-meanAcadAch)/100 );
01287 
01288     <span class="comment">//---- obtain the academic achievement ------//</span>
01289 
01290     <span class="keywordtype">float</span> courseAcadAch = math.get_random_snd(meanAcadAch, <a class="code" href="Opschool_8h.html#a1">PSCH_SD</a>(stdDevAcadAch));
01291 
01292     courseAcadAch = min(courseAcadAch, 100.0f);     <span class="comment">// min &amp; max bug chea</span>
01293 
01294     <span class="comment">//------- update the student's overall academic achievement rating -----//</span>
01295 
01296     academic_achievement = float(academic_achievement * total_course_all + courseAcadAch)
01297         / (total_course_all + 1);
01298 
01299     <span class="comment">//------- calculate the Probability that a student will fail a course -----//</span>
01300     <span class="comment">//</span>
01301     <span class="comment">// rob_Course_Failure =</span>
01302     <span class="comment">// SingleResponseFunction[student_academic_talent,</span>
01303     <span class="comment">//     floor=50,ceiling=0,b1=100,m1=50]  *</span>
01304     <span class="comment">// SingleResponseFunction[departmental_educational_quality,</span>
01305     <span class="comment">//     floor=100,ceiling=0,b1=100,m1=50]/100</span>
01306     <span class="comment">//</span>
01307     <span class="comment">// The student talent and education quality numbers are in the 0-100 range.</span>
01308     <span class="comment">// Prob_Course_Failure will equal 0 if both variables are at 100 and about 40 if</span>
01309     <span class="comment">// both are at 0. Draw a random number between 0 and 100 and fail the student if</span>
01310     <span class="comment">// it is less than or equal to Prob_Course_Failure.</span>
01311     <span class="comment">//</span>
01312     <span class="comment">//--------------------------------------------------------------------------//</span>
01313     <span class="comment">/*</span>
01314 <span class="comment">      float probCourseFail = math.single_response_func(50.0f, 0.0f, 100.0f, 50.0f, talent_academic) *</span>
01315 <span class="comment">      math.single_response_func(100.0f, 0.0f, 100.0f, 50.0f, deptPtr-&gt;p_educational_quality) / 100;</span>
01316 <span class="comment"></span>
01317 <span class="comment">      return m.random(101) &gt; probCourseFail;</span>
01318 <span class="comment">    */</span>
01319     <span class="keywordtype">float</span> newValue = 40+(talent_academic)*(.2f + .8f * (deptPtr-&gt;<a class="code" href="classDepartment.html#m42">p_educational_quality</a>-50)/100);
01320 
01321     <span class="comment">// 0406</span>
01322     <span class="comment">// float newValue = 0.1f * (1 - ( 0.25f * talent_academic + 0.75f * deptPtr-&gt;p_educational_quality) / 100.0f );</span>
01323 
01324     newValue = math.single_response_func(0.0f, 0.1f, -70.11f, 53.65f, newValue);
01325 
01326     <span class="keywordflow">return</span> math.get_random_float() &gt;= newValue;     <span class="comment">// newValue equals to fail_rate</span>
01327 }
01328 
01329 <span class="comment">//----------- End of function Student::study_course ------------//</span>
01330 
01331 <span class="comment">//---------- Begin of function Student::has_selected_all_course -----------//</span>
01333 <span class="comment">int Student::has_selected_all_course() {</span>
01334     <span class="keywordflow">return</span> total_course_this_trimester &gt;= course_per_trimester[player_school.cur_trimester];
01335 }
01336 
01337 <span class="comment">//----------- End of function Student::has_selected_all_course ------------//</span>
01338 
01339 <span class="comment">//---------- Begin of function Student::think_summer_course -----------//</span>
01343 <span class="comment">void Student::think_summer_course() {</span>
01344     <span class="comment">//if ( player_school.cur_trimester != SUMMER )</span>
01345     <span class="comment">//  return;</span>
01346 
01347     <span class="comment">//--------------//</span>
01348 
01349     <a class="code" href="ALL_8H.html#a0">err_when</a>(player_school.summer_emphasis &gt; 3);
01350 
01351     <span class="keywordtype">char</span> remap[] = { 0,1,2,2 };
01352     <span class="keywordtype">char</span> t=0;
01353     <span class="keywordtype">char</span> prob = m.random(100);
01354 
01355     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="OCOURRES_8H.html#a8a7">SUMMER_COURSE_COUNT</a>; i++ ) {
01356         t += course_res.summer_course_pref[student_level][remap[player_school.summer_emphasis]][ i ];
01357 
01358         <span class="keywordflow">if</span> ( prob &lt;= t )
01359             <span class="keywordflow">break</span>;
01360     }
01361 
01362     <span class="keywordflow">if</span>( i&gt;=<a class="code" href="OCOURRES_8H.html#a8a7">SUMMER_COURSE_COUNT</a> )                    <span class="comment">// BUGHERE, these lines are for fixing bug on-fly</span>
01363         i = <a class="code" href="OCOURRES_8H.html#a8a7">SUMMER_COURSE_COUNT</a>-1;
01364 
01365     <a class="code" href="ALL_8H.html#a0">err_when</a>(i&gt;=<a class="code" href="OCOURRES_8H.html#a8a7">SUMMER_COURSE_COUNT</a>);               <span class="comment">// i must be &lt; SUMMER_COURSE_COUNT;</span>
01366 
01367     <span class="comment">//-------------// we found i as the number of courses for off_quarter</span>
01368 
01369     course_per_trimester[off_quarter] = i;
01370 }
01371 
01372 <span class="comment">//----------- End of function Student::think_summer_course ------------//</span>
01373 
01374 <span class="comment">//---------- Begin of function FacultyArray::think_summer_teaching -----------//</span>
01378 <span class="comment">void FacultyArray::think_summer_teaching() {</span>
01379     <span class="comment">// called per summer</span>
01380 
01381     <a class="code" href="classFaculty.html">Faculty</a> *fPtr;
01382     <a class="code" href="classDepartment.html">Department</a> *deptPtr = department_array[department_recno];
01383     <span class="keywordtype">int</span> sum=0, i;
01384 
01385     <span class="keywordflow">for</span> (i=deptPtr-&gt;<a class="code" href="classDepartment.html#m1">course_array</a>.<a class="code" href="classDynArray.html#a28">size</a>(); i&gt;0; i--) {
01386         sum += deptPtr-&gt;<a class="code" href="classDepartment.html#m1">course_array</a>[i]-&gt;<a class="code" href="classCourseArray.html#m2">class_section_count</a>;
01387     }
01388 
01389     <span class="keywordflow">for</span> (i=size(); i&gt;0; i--) {
01390         fPtr = operator[](i);
01391         fPtr-&gt;<a class="code" href="classFaculty.html#m23">off_duty_trimester</a> = <a class="code" href="Gamedef_8h.html#a79a38">SUMMER</a>;
01392         fPtr-&gt;<a class="code" href="classFaculty.html#m24">is_third_trimester_teaching</a> = 0;
01393     }
01394 
01395     <span class="keywordtype">int</span> targetSections = ( sum * player_school.percent_summer_teaching_load ) / 100;
01396     <span class="keywordtype">char</span>  tri = <a class="code" href="Gamedef_8h.html#a79a36">AUTUMN</a>;
01397     <span class="keywordtype">int</span> sections=0;
01398 
01399     <span class="keywordflow">while</span> ( sections &lt; targetSections ) {
01400         <span class="keywordtype">int</span> recno = m.random(faculty_count) + 1;
01401         fPtr = operator[](recno);
01402 
01403         <span class="keywordflow">if</span> ( targetSections &lt; faculty_count &amp;&amp; fPtr-&gt;<a class="code" href="classFaculty.html#m24">is_third_trimester_teaching</a> )
01404             <span class="keywordflow">continue</span>;
01405 
01406         <span class="comment">// shift course load to summer</span>
01407         fPtr-&gt;<a class="code" href="classFaculty.html#m23">off_duty_trimester</a> = tri;
01408         fPtr-&gt;<a class="code" href="classFaculty.html#m24">is_third_trimester_teaching</a> = 1;
01409 
01410         <span class="comment">// for next loop</span>
01411         sections++;
01412         tri = (tri==<a class="code" href="Gamedef_8h.html#a79a36">AUTUMN</a>) ? <a class="code" href="Gamedef_8h.html#a79a37">WINTER</a> : <a class="code" href="Gamedef_8h.html#a79a36">AUTUMN</a>;
01413     }
01414 }
01415 
01416 <span class="comment">//----------- End of function FacultyArray::think_summer_teaching ------------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:27 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
