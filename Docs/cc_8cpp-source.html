<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>cc.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>cc.cpp</h1><a href="cc_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : CC.CPP</span>
00002 <span class="comment">//Description : Virtual U Entry Program</span>
00003 <span class="comment">//Owner           : Kevin(ho)</span>
00004 
00005 <span class="preprocessor">#include &lt;windows.h&gt;</span>
00006 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00007 <span class="preprocessor">#include &lt;<a class="code" href="OBATTLE_8H.html">OBATTLE.H</a>&gt;</span>
00008 <span class="preprocessor">#include &lt;<a class="code" href="OCOMBUF_8H.html">OCOMBUF.H</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;OCONFIG.H&gt;</span>
00010 <span class="preprocessor">#include &lt;<a class="code" href="ODATE_8H.html">ODATE.H</a>&gt;</span>
00011 <span class="preprocessor">#include &lt;<a class="code" href="ODEBUGX_8H.html">ODEBUGX.H</a>&gt;</span>
00012 <span class="preprocessor">#include &lt;<a class="code" href="OGAME_8H.html">OGAME.H</a>&gt;</span>
00013 <span class="preprocessor">#include &lt;<a class="code" href="OGAMESET_8H.html">OGAMESET.H</a>&gt;</span>
00014 <span class="preprocessor">#include &lt;<a class="code" href="OIMGRES_8H.html">OIMGRES.H</a>&gt;</span>
00015 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>
00016 <span class="preprocessor">#include &lt;OMISC.H&gt;</span>
00017 <span class="preprocessor">#include &lt;OMATH.H&gt;</span>
00018 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00019 <span class="preprocessor">#include &lt;<a class="code" href="OMOUSECR_8H.html">OMOUSECR.H</a>&gt;</span>
00020 <span class="preprocessor">#include &lt;<a class="code" href="OPOWER_8H.html">OPOWER.H</a>&gt;</span>
00021 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00022 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00023 <span class="preprocessor">#include &lt;<a class="code" href="OWORLD_8H.html">OWORLD.H</a>&gt;</span>
00024 <span class="preprocessor">#include &lt;<a class="code" href="OTRANSL_8H.html">OTRANSL.H</a>&gt;</span>
00025 <span class="preprocessor">#include &lt;OAUDIO.H&gt;</span>
00026 <span class="preprocessor">#include &lt;<a class="code" href="OBOX_8H.html">OBOX.H</a>&gt;</span>
00027 <span class="preprocessor">#include &lt;OFONT.H&gt;</span>
00028 <span class="preprocessor">#include &lt;OGFILE.H&gt;</span>
00029 <span class="preprocessor">#include &lt;<a class="code" href="OVIDEO_8H.html">OVIDEO.H</a>&gt;</span>
00030 <span class="preprocessor">#include &lt;<a class="code" href="OSE_8H.html">OSE.H</a>&gt;</span>
00031 <span class="preprocessor">#include &lt;<a class="code" href="OSERES_8H.html">OSERES.H</a>&gt;</span>
00032 <span class="preprocessor">#include &lt;<a class="code" href="OMUSIC_8H.html">OMUSIC.H</a>&gt;</span>
00033 <span class="preprocessor">#include &lt;<a class="code" href="OHELP_8H.html">OHELP.H</a>&gt;</span>
00034 <span class="preprocessor">#include &lt;<a class="code" href="OGCONFIG_8H.html">OGCONFIG.H</a>&gt;</span>
00035 <span class="preprocessor">#include &lt;<a class="code" href="OSCHLRES_8H.html">OSCHLRES.H</a>&gt;</span>
00036 <span class="preprocessor">#include &lt;<a class="code" href="OCOURRES_8H.html">OCOURRES.H</a>&gt;</span>
00037 <span class="preprocessor">#include &lt;<a class="code" href="ODEPTRES_8H.html">ODEPTRES.H</a>&gt;</span>
00038 <span class="preprocessor">#include &lt;OFACURES.H&gt;</span>
00039 <span class="preprocessor">#include &lt;OGAMESTR.H&gt;</span>
00040 <span class="preprocessor">#include &lt;<a class="code" href="OFPHOTO_8H.html">OFPHOTO.H</a>&gt;</span>
00041 <span class="preprocessor">#include &lt;<a class="code" href="OFIELD_8H.html">OFIELD.H</a>&gt;</span>
00042 <span class="preprocessor">#include &lt;<a class="code" href="OFIRMRES_8H.html">OFIRMRES.H</a>&gt;</span>
00043 <span class="preprocessor">#include &lt;<a class="code" href="OSPRTRES_8H.html">OSPRTRES.H</a>&gt;</span>
00044 <span class="preprocessor">#include &lt;<a class="code" href="OTERRAIN_8H.html">OTERRAIN.H</a>&gt;</span>
00045 <span class="preprocessor">#include &lt;<a class="code" href="OPLANT_8H.html">OPLANT.H</a>&gt;</span>
00046 <span class="preprocessor">#include &lt;<a class="code" href="OROAD_8H.html">OROAD.H</a>&gt;</span>
00047 <span class="preprocessor">#include &lt;<a class="code" href="ONAMERES_8H.html">ONAMERES.H</a>&gt;</span>
00048 
00049 <span class="preprocessor">#include &lt;OENROLL.H&gt;</span>                              <span class="comment">//##### fred 980702</span>
00050 <span class="preprocessor">#include &lt;ONEWS.H&gt;</span>                                <span class="comment">//##### fred 981013</span>
00051 <span class="preprocessor">#include &lt;<a class="code" href="OTASK_8H.html">OTASK.H</a>&gt;</span>                                <span class="comment">//##### fred 981013</span>
00052 <span class="preprocessor">#include &lt;OCHANCE.H&gt;</span>                              <span class="comment">//##### fred 981013</span>
00053 <span class="preprocessor">#include &lt;ODEPT.H&gt;</span>
00054 <span class="preprocessor">#include &lt;OFINANCE.H&gt;</span>
00055 <span class="preprocessor">#include &lt;OPSCHOOL.H&gt;</span>
00056 <span class="preprocessor">#include &lt;<a class="code" href="OFIRMA_8H.html">OFIRMA.H</a>&gt;</span>
00057 <span class="comment">//## 990511 fred        #include &lt;OSPRITEA.H&gt;</span>
00058 
00059 <span class="comment">//########### begin Ho 0805 ############//</span>
00060 <span class="preprocessor">#include &lt;OIFACE.H&gt;</span>
00061 <span class="preprocessor">#include &lt;<a class="code" href="OADM__OFF_8H.html">OADM_OFF.H</a>&gt;</span>
00062 <span class="preprocessor">#include &lt;OOPT.H&gt;</span>
00063 <span class="preprocessor">#include &lt;<a class="code" href="OOPT3_8H.html">OOPT3.H</a>&gt;</span>
00064 <span class="preprocessor">#include &lt;OATHLETI.H&gt;</span>
00065 <span class="preprocessor">#include &lt;ODEVELOP.H&gt;</span>
00066 <span class="preprocessor">#include &lt;OFACILIT.H&gt;</span>
00067 <span class="preprocessor">#include &lt;OLIBTECH.H&gt;</span>
00068 <span class="preprocessor">#include &lt;OINVEST.H&gt;</span>
00069 <span class="preprocessor">#include &lt;<a class="code" href="OSTUOFF_8H.html">OSTUOFF.H</a>&gt;</span>                              <span class="comment">//##### fred</span>
00070 <span class="preprocessor">#include &lt;<a class="code" href="OTEST_8H.html">OTEST.H</a>&gt;</span>
00071 <span class="preprocessor">#include &lt;<a class="code" href="OGSET_8H.html">OGSET.H</a>&gt;</span>
00072 <span class="preprocessor">#include &lt;<a class="code" href="OHELPIF_8H.html">OHELPIF.H</a>&gt;</span>                              <span class="comment">//## chwg1015</span>
00073 <span class="preprocessor">#include &lt;OLETTER.H&gt;</span>                              <span class="comment">//## chwg1021</span>
00074 <span class="preprocessor">#include &lt;<a class="code" href="OBLCKBRD_8H.html">OBLCKBRD.H</a>&gt;</span>                             <span class="comment">//## chwg1026</span>
00075 <span class="preprocessor">#include &lt;<a class="code" href="OMORERPT_8H.html">OMORERPT.H</a>&gt;</span>                             <span class="comment">//## chwg010799</span>
00076 <span class="preprocessor">#include &lt;<a class="code" href="ODEPTLST_8H.html">ODEPTLST.H</a>&gt;</span>                             <span class="comment">//## chwg010999</span>
00077 <span class="preprocessor">#include &lt;<a class="code" href="OPARKING_8H.html">OPARKING.H</a>&gt;</span>                             <span class="comment">//## chwg021299</span>
00078 <span class="preprocessor">#include &lt;OCRIME.H&gt;</span>                               <span class="comment">//## chwg021299</span>
00079 <span class="preprocessor">#include &lt;<a class="code" href="ORETIRE_8H.html">ORETIRE.H</a>&gt;</span>                              <span class="comment">//## chwg021299</span>
00080 <span class="preprocessor">#include &lt;<a class="code" href="OBANKRUP_8H.html">OBANKRUP.H</a>&gt;</span>                             <span class="comment">//## chwg021299</span>
00081 <span class="preprocessor">#include &lt;<a class="code" href="OFINSCOR_8H.html">OFINSCOR.H</a>&gt;</span>                             <span class="comment">//## chwg021299</span>
00082 <span class="preprocessor">#include &lt;<a class="code" href="OSCEN__IF_8H.html">OSCEN_IF.H</a>&gt;</span>                             <span class="comment">//## chwg021299</span>
00083 <span class="preprocessor">#include &lt;OLOSEGAM.H&gt;</span>                             <span class="comment">//## chwg021299</span>
00084 <span class="preprocessor">#include &lt;<a class="code" href="OPRTMENU_8H.html">OPRTMENU.H</a>&gt;</span>                             <span class="comment">//## chwg021299</span>
00085 <span class="preprocessor">#include &lt;<a class="code" href="OMISCREP_8H.html">OMISCREP.H</a>&gt;</span>                             <span class="comment">//## fred0213</span>
00086 
00087 <span class="preprocessor">#include &lt;OPRINT.H&gt;</span>                               <span class="comment">//## chwg031299</span>
00088 <span class="preprocessor">#include &lt;excpt.h&gt;</span>
00089 
00090 <span class="comment">//############# end Ho 0805 ############//</span>
00091 
00092 <span class="comment">//------- define game version constant --------//</span>
00093 
<a name="l00094"></a><a class="code" href="cc_8cpp.html#a0">00094</a> <span class="keywordtype">char</span> *<a class="code" href="cc_8cpp.html#a0">GAME_VERSION_STR</a> = <span class="stringliteral">"2.01"</span>;
00095 
00096 <span class="comment">//-------- System class ----------//</span>
00097 
00098 <span class="preprocessor">#ifndef NO_MEM_CLASS</span>
<a name="l00099"></a><a class="code" href="cc_8cpp.html#a1">00099</a> <span class="preprocessor"></span><a class="code" href="classMem.html">Mem</a>   <a class="code" href="cc_8cpp.html#a1">mem</a>;                                        <span class="comment">// constructor only init var and allocate memory</span>
00100 <span class="preprocessor">#endif</span>
00101 <span class="preprocessor"></span>
<a name="l00102"></a><a class="code" href="cc_8cpp.html#a2">00102</a> <a class="code" href="classCommonBuf.html">CommonBuf</a>     <a class="code" href="cc_8cpp.html#a2">common_buf</a>;
<a name="l00103"></a><a class="code" href="cc_8cpp.html#a3">00103</a> <a class="code" href="classDateInfo.html">DateInfo</a>          <a class="code" href="cc_8cpp.html#a3">date</a>;
<a name="l00104"></a><a class="code" href="cc_8cpp.html#a4">00104</a> <a class="code" href="classDebugX.html">DebugX</a>        <a class="code" href="cc_8cpp.html#a4">debugx</a>;
<a name="l00105"></a><a class="code" href="cc_8cpp.html#a5">00105</a> <a class="code" href="classError.html">Error</a>             <a class="code" href="cc_8cpp.html#a5">err</a>;                            <span class="comment">// constructor only call set_new_handler()d</span>
<a name="l00106"></a><a class="code" href="cc_8cpp.html#a6">00106</a> <a class="code" href="classMisc.html">Misc</a>              <a class="code" href="cc_8cpp.html#a6">m</a>;
<a name="l00107"></a><a class="code" href="cc_8cpp.html#a7">00107</a> <a class="code" href="classMath.html">Math</a>          <a class="code" href="cc_8cpp.html#a7">math</a>;
00108 <span class="comment">// ###### begin Gilbert 26/04/2001 #######//</span>
00109 <span class="comment">// modified order to arrange destructor order</span>
<a name="l00110"></a><a class="code" href="cc_8cpp.html#a8">00110</a> <a class="code" href="classVideo.html">Video</a>             <a class="code" href="cc_8cpp.html#a8">video</a>;
<a name="l00111"></a><a class="code" href="cc_8cpp.html#a9">00111</a> <a class="code" href="classConfig.html">Config</a>            <a class="code" href="cc_8cpp.html#a9">config</a>;
00112 
00113 <span class="comment">//-------- objects initialized in Sys::init_directx --------//</span>
00114 
<a name="l00115"></a><a class="code" href="cc_8cpp.html#a10">00115</a> <a class="code" href="classAudio.html">Audio</a>             <a class="code" href="cc_8cpp.html#a10">audio</a>;
<a name="l00116"></a><a class="code" href="cc_8cpp.html#a11">00116</a> <a class="code" href="classMusic.html">Music</a>             <a class="code" href="cc_8cpp.html#a11">music</a>;
00117 <a class="code" href="classSECtrl.html">SECtrl</a>            <a class="code" href="cc_8cpp.html#a112">se_ctrl</a>(&amp;audio);
<a name="l00118"></a><a class="code" href="cc_8cpp.html#a12">00118</a> <a class="code" href="classSERes.html">SERes</a>             <a class="code" href="cc_8cpp.html#a12">se_res</a>;
<a name="l00119"></a><a class="code" href="cc_8cpp.html#a13">00119</a> <a class="code" href="classVga.html">Vga</a>         <a class="code" href="cc_8cpp.html#a13">vga</a>;
<a name="l00120"></a><a class="code" href="cc_8cpp.html#a16">00120</a> <a class="code" href="classVgaBuf.html">VgaBuf</a>            <a class="code" href="cc_8cpp.html#a14">vga_front</a>, <a class="code" href="cc_8cpp.html#a15">vga_back</a>, <a class="code" href="cc_8cpp.html#a16">vga_true_front</a>;
00121 
00122 <span class="comment">//--------- objects initalized in Sys::init_objects --------//</span>
00123 
<a name="l00124"></a><a class="code" href="cc_8cpp.html#a17">00124</a> <a class="code" href="classMouseCursor.html">MouseCursor</a>       <a class="code" href="cc_8cpp.html#a17">mouse_cursor</a>;
<a name="l00125"></a><a class="code" href="cc_8cpp.html#a18">00125</a> <a class="code" href="classMouse.html">Mouse</a>         <a class="code" href="cc_8cpp.html#a18">mouse</a>;
<a name="l00126"></a><a class="code" href="cc_8cpp.html#a19">00126</a> <a class="code" href="classHelp.html">Help</a>          <a class="code" href="cc_8cpp.html#a19">help</a>;
00127 
<a name="l00128"></a><a class="code" href="cc_8cpp.html#a20">00128</a> <a class="code" href="classBox.html">Box</a>               <a class="code" href="cc_8cpp.html#a20">box</a>;
<a name="l00129"></a><a class="code" href="cc_8cpp.html#a21">00129</a> <a class="code" href="classTranslate.html">Translate</a>     <a class="code" href="cc_8cpp.html#a21">translate</a>;
<a name="l00130"></a><a class="code" href="cc_8cpp.html#a22">00130</a> <a class="code" href="classUserInterface.html">UserInterface</a>   <a class="code" href="cc_8cpp.html#a22">user_interface</a>;
00131 
00132 <span class="comment">//------- Resource class ----------//</span>
00133 
<a name="l00134"></a><a class="code" href="cc_8cpp.html#a24">00134</a> <a class="code" href="classFont.html">Font</a>              <a class="code" href="cc_8cpp.html#a23">font_san</a>, <a class="code" href="cc_8cpp.html#a24">font_std</a>, <a class="code" href="cc_8cpp.html#a25">font_small</a>, <a class="code" href="cc_8cpp.html#a26">font_mid</a>, <a class="code" href="cc_8cpp.html#a27">font_news</a>, <a class="code" href="cc_8cpp.html#a28">font_casa</a>;
00135 <span class="comment">// ##### begin chwg 24/7 ###########//</span>
<a name="l00136"></a><a class="code" href="cc_8cpp.html#a29">00136</a> <a class="code" href="classFont.html">Font</a>          <a class="code" href="cc_8cpp.html#a29">font_yellow_diamond</a>;
<a name="l00137"></a><a class="code" href="cc_8cpp.html#a30">00137</a> <a class="code" href="classFont.html">Font</a>          <a class="code" href="cc_8cpp.html#a30">font_fdiamond</a>;
<a name="l00138"></a><a class="code" href="cc_8cpp.html#a31">00138</a> <a class="code" href="classFont.html">Font</a>          <a class="code" href="cc_8cpp.html#a31">font_fblack</a>;
<a name="l00139"></a><a class="code" href="cc_8cpp.html#a32">00139</a> <a class="code" href="classFont.html">Font</a>          <a class="code" href="cc_8cpp.html#a32">font_charts</a>;
<a name="l00140"></a><a class="code" href="cc_8cpp.html#a33">00140</a> <a class="code" href="classFont.html">Font</a>          <a class="code" href="cc_8cpp.html#a33">font_chartsm</a>;
<a name="l00141"></a><a class="code" href="cc_8cpp.html#a34">00141</a> <a class="code" href="classFont.html">Font</a>          <a class="code" href="cc_8cpp.html#a34">font_chart_red_sm</a>;
<a name="l00142"></a><a class="code" href="cc_8cpp.html#a35">00142</a> <a class="code" href="classFont.html">Font</a>          <a class="code" href="cc_8cpp.html#a35">font_chart_green_sm</a>;
<a name="l00143"></a><a class="code" href="cc_8cpp.html#a36">00143</a> <a class="code" href="classFont.html">Font</a>          <a class="code" href="cc_8cpp.html#a36">font_chart_blue_sm</a>;
<a name="l00144"></a><a class="code" href="cc_8cpp.html#a37">00144</a> <a class="code" href="classFont.html">Font</a>          <a class="code" href="cc_8cpp.html#a37">font_chart_orange_sm</a>;
<a name="l00145"></a><a class="code" href="cc_8cpp.html#a38">00145</a> <a class="code" href="classFont.html">Font</a>          <a class="code" href="cc_8cpp.html#a38">font_chart_purple_sm</a>;
<a name="l00146"></a><a class="code" href="cc_8cpp.html#a39">00146</a> <a class="code" href="classFont.html">Font</a>          <a class="code" href="cc_8cpp.html#a39">font_redcharts</a>;
<a name="l00147"></a><a class="code" href="cc_8cpp.html#a40">00147</a> <a class="code" href="classFont.html">Font</a>          <a class="code" href="cc_8cpp.html#a40">font_barcharts</a>;
<a name="l00148"></a><a class="code" href="cc_8cpp.html#a41">00148</a> <a class="code" href="classFont.html">Font</a>          <a class="code" href="cc_8cpp.html#a41">font_fscore</a>;
<a name="l00149"></a><a class="code" href="cc_8cpp.html#a42">00149</a> <a class="code" href="classFont.html">Font</a>          <a class="code" href="cc_8cpp.html#a42">font_numbers</a>;
<a name="l00150"></a><a class="code" href="cc_8cpp.html#a43">00150</a> <a class="code" href="classFont.html">Font</a>          <a class="code" href="cc_8cpp.html#a43">font_stone</a>;
<a name="l00151"></a><a class="code" href="cc_8cpp.html#a44">00151</a> <a class="code" href="classFont.html">Font</a>          <a class="code" href="cc_8cpp.html#a44">font_hstone</a>;
<a name="l00152"></a><a class="code" href="cc_8cpp.html#a45">00152</a> <a class="code" href="classFont.html">Font</a>          <a class="code" href="cc_8cpp.html#a45">font_small_san</a>;
<a name="l00153"></a><a class="code" href="cc_8cpp.html#a46">00153</a> <a class="code" href="classFont.html">Font</a>          <a class="code" href="cc_8cpp.html#a46">font_red_san</a>;
<a name="l00154"></a><a class="code" href="cc_8cpp.html#a47">00154</a> <a class="code" href="classFont.html">Font</a>          <a class="code" href="cc_8cpp.html#a47">font_green_san</a>;
<a name="l00155"></a><a class="code" href="cc_8cpp.html#a48">00155</a> <a class="code" href="classFont.html">Font</a>          <a class="code" href="cc_8cpp.html#a48">font_blue_san</a>;
<a name="l00156"></a><a class="code" href="cc_8cpp.html#a49">00156</a> <a class="code" href="classFont.html">Font</a>          <a class="code" href="cc_8cpp.html#a49">font_letter</a>;
<a name="l00157"></a><a class="code" href="cc_8cpp.html#a50">00157</a> <a class="code" href="classFont.html">Font</a>          <a class="code" href="cc_8cpp.html#a50">font_pgold</a>;
<a name="l00158"></a><a class="code" href="cc_8cpp.html#a51">00158</a> <a class="code" href="classFont.html">Font</a>          <a class="code" href="cc_8cpp.html#a51">font_psilver</a>;
<a name="l00159"></a><a class="code" href="cc_8cpp.html#a52">00159</a> <a class="code" href="classFont.html">Font</a>          <a class="code" href="cc_8cpp.html#a52">font_pbronze</a>;
00160 <span class="comment">// ##### end chwg 24/7 ###########//</span>
<a name="l00161"></a><a class="code" href="cc_8cpp.html#a53">00161</a> <a class="code" href="classImageRes.html">ImageRes</a>          <a class="code" href="cc_8cpp.html#a53">image_sys</a>, <a class="code" href="cc_8cpp.html#a54">image_interface</a>, <a class="code" href="cc_8cpp.html#a55">image_mascot</a>, <a class="code" href="cc_8cpp.html#a56">image_pict</a>;
<a name="l00162"></a><a class="code" href="cc_8cpp.html#a57">00162</a> <a class="code" href="classGameSet.html">GameSet</a>           <a class="code" href="cc_8cpp.html#a57">game_set</a>;
<a name="l00163"></a><a class="code" href="cc_8cpp.html#a58">00163</a> <a class="code" href="classPrint.html">Print</a>         <a class="code" href="cc_8cpp.html#a58">print</a>;
00164 
00165 <span class="comment">//-------- resource initialized in Game::init --------//</span>
00166 
<a name="l00167"></a><a class="code" href="cc_8cpp.html#a59">00167</a> <a class="code" href="classTerrainRes.html">TerrainRes</a>      <a class="code" href="cc_8cpp.html#a59">terrain_res</a>;
<a name="l00168"></a><a class="code" href="cc_8cpp.html#a60">00168</a> <a class="code" href="classPlantRes.html">PlantRes</a>        <a class="code" href="cc_8cpp.html#a60">plant_res</a>;
<a name="l00169"></a><a class="code" href="cc_8cpp.html#a61">00169</a> <a class="code" href="classRoadRes.html">RoadRes</a>       <a class="code" href="cc_8cpp.html#a61">road_res</a>;
00170 
<a name="l00171"></a><a class="code" href="cc_8cpp.html#a62">00171</a> <a class="code" href="classSchoolRes.html">SchoolRes</a>       <a class="code" href="cc_8cpp.html#a62">school_res</a>;
<a name="l00172"></a><a class="code" href="cc_8cpp.html#a63">00172</a> <a class="code" href="classFieldRes.html">FieldRes</a>        <a class="code" href="cc_8cpp.html#a63">field_res</a>;
<a name="l00173"></a><a class="code" href="cc_8cpp.html#a64">00173</a> <a class="code" href="classDepartmentRes.html">DepartmentRes</a>   <a class="code" href="cc_8cpp.html#a64">department_res</a>;
<a name="l00174"></a><a class="code" href="cc_8cpp.html#a65">00174</a> <a class="code" href="classFirmRes.html">FirmRes</a>       <a class="code" href="cc_8cpp.html#a65">firm_res</a>;
<a name="l00175"></a><a class="code" href="cc_8cpp.html#a66">00175</a> <a class="code" href="classFacultyRes.html">FacultyRes</a>      <a class="code" href="cc_8cpp.html#a66">faculty_res</a>;
<a name="l00176"></a><a class="code" href="cc_8cpp.html#a67">00176</a> <a class="code" href="classFacultyPhotoRes.html">FacultyPhotoRes</a> <a class="code" href="cc_8cpp.html#a67">faculty_photo_res</a>;
<a name="l00177"></a><a class="code" href="cc_8cpp.html#a68">00177</a> <a class="code" href="classNameRes.html">NameRes</a>       <a class="code" href="cc_8cpp.html#a68">name_res</a>;
<a name="l00178"></a><a class="code" href="cc_8cpp.html#a69">00178</a> <a class="code" href="classLetter.html">Letter</a>        <a class="code" href="cc_8cpp.html#a69">letter</a>;
<a name="l00179"></a><a class="code" href="cc_8cpp.html#a70">00179</a> <a class="code" href="classCourseRes.html">CourseRes</a>     <a class="code" href="cc_8cpp.html#a70">course_res</a>;
<a name="l00180"></a><a class="code" href="cc_8cpp.html#a71">00180</a> <a class="code" href="classEnrollRes.html">EnrollRes</a>     <a class="code" href="cc_8cpp.html#a71">enroll_res</a>;
00181 
00182 <span class="comment">//--------- arrays initialized in Game::init -------//</span>
00183 
<a name="l00184"></a><a class="code" href="cc_8cpp.html#a72">00184</a> <a class="code" href="classFirmArray.html">FirmArray</a>         <a class="code" href="cc_8cpp.html#a72">firm_array</a>;
<a name="l00185"></a><a class="code" href="cc_8cpp.html#a73">00185</a> <a class="code" href="classDepartmentArray.html">DepartmentArray</a> <a class="code" href="cc_8cpp.html#a73">department_array</a>;
00186 
00187 <span class="comment">//## 990511 fred        SpriteRes                       sprite_res;</span>
<a name="l00188"></a><a class="code" href="cc_8cpp.html#a74">00188</a> <a class="code" href="classGameStrRes.html">GameStrRes</a>      <a class="code" href="cc_8cpp.html#a74">game_str_res</a>;
<a name="l00189"></a><a class="code" href="cc_8cpp.html#a75">00189</a> <a class="code" href="classBlackBoard.html">BlackBoard</a>      <a class="code" href="cc_8cpp.html#a75">blackboard</a>;
00190 
00191 <span class="comment">//-------- Game Data class -----------//</span>
00192 
00193 <span class="comment">//## 990511 fred SpriteArray                    sprite_array;</span>
<a name="l00194"></a><a class="code" href="cc_8cpp.html#a76">00194</a> <a class="code" href="classNewsArray.html">NewsArray</a>     <a class="code" href="cc_8cpp.html#a76">news_array</a>;                         <span class="comment">// ##fred 1014</span>
<a name="l00195"></a><a class="code" href="cc_8cpp.html#a77">00195</a> <a class="code" href="classTaskArray.html">TaskArray</a>     <a class="code" href="cc_8cpp.html#a77">task_array</a>;                         <span class="comment">// 1014</span>
<a name="l00196"></a><a class="code" href="cc_8cpp.html#a78">00196</a> <a class="code" href="classChanceEvent.html">ChanceEvent</a>     <a class="code" href="cc_8cpp.html#a78">chance_event</a>;                     <span class="comment">// 1014</span>
00197 
00198 <span class="comment">//--------- Game Surface class ------------//</span>
00199 
<a name="l00200"></a><a class="code" href="cc_8cpp.html#a79">00200</a> <a class="code" href="classPlayerSchool.html">PlayerSchool</a>    <a class="code" href="cc_8cpp.html#a79">player_school</a>;
<a name="l00201"></a><a class="code" href="cc_8cpp.html#a80">00201</a> <a class="code" href="classBattle.html">Battle</a>            <a class="code" href="cc_8cpp.html#a80">battle</a>;
<a name="l00202"></a><a class="code" href="cc_8cpp.html#a81">00202</a> <a class="code" href="classGoalConfig.html">GoalConfig</a>      <a class="code" href="cc_8cpp.html#a81">goal_config</a>;
<a name="l00203"></a><a class="code" href="cc_8cpp.html#a82">00203</a> <a class="code" href="classInfo.html">Info</a>              <a class="code" href="cc_8cpp.html#a82">info</a>;
<a name="l00204"></a><a class="code" href="cc_8cpp.html#a83">00204</a> <a class="code" href="classPower.html">Power</a>             <a class="code" href="cc_8cpp.html#a83">power</a>;
<a name="l00205"></a><a class="code" href="cc_8cpp.html#a84">00205</a> <a class="code" href="classWorld.html">World</a>             <a class="code" href="cc_8cpp.html#a84">world</a>;
<a name="l00206"></a><a class="code" href="cc_8cpp.html#a85">00206</a> <a class="code" href="classFinance.html">Finance</a>       <a class="code" href="cc_8cpp.html#a85">finance</a>;
00207 
00208 <span class="comment">//########### begin Ho 0805 ############//</span>
<a name="l00209"></a><a class="code" href="cc_8cpp.html#a86">00209</a> <a class="code" href="classAdmOffice.html">AdmOffice</a>     <a class="code" href="cc_8cpp.html#a86">adm_office</a>;
<a name="l00210"></a><a class="code" href="cc_8cpp.html#a87">00210</a> <a class="code" href="classDevelopment.html">Development</a>     <a class="code" href="cc_8cpp.html#a87">development_office</a>;
<a name="l00211"></a><a class="code" href="cc_8cpp.html#a88">00211</a> <a class="code" href="classOptimization.html">Optimization</a>    <a class="code" href="cc_8cpp.html#a88">optimization</a>;
<a name="l00212"></a><a class="code" href="cc_8cpp.html#a89">00212</a> <a class="code" href="classOptStage3.html">OptStage3</a>         <a class="code" href="cc_8cpp.html#a89">opt_stage3</a>;
<a name="l00213"></a><a class="code" href="cc_8cpp.html#a90">00213</a> <a class="code" href="classAthletics.html">Athletics</a>     <a class="code" href="cc_8cpp.html#a90">athletics_office</a>;
<a name="l00214"></a><a class="code" href="cc_8cpp.html#a91">00214</a> <a class="code" href="classLibTech.html">LibTech</a>       <a class="code" href="cc_8cpp.html#a91">library_tech_office</a>;
<a name="l00215"></a><a class="code" href="cc_8cpp.html#a92">00215</a> <a class="code" href="classFacility.html">Facility</a>        <a class="code" href="cc_8cpp.html#a92">facility_office</a>;
<a name="l00216"></a><a class="code" href="cc_8cpp.html#a93">00216</a> <a class="code" href="classInvestment.html">Investment</a>      <a class="code" href="cc_8cpp.html#a93">investment_office</a>;
<a name="l00217"></a><a class="code" href="cc_8cpp.html#a94">00217</a> <a class="code" href="classStudentOffice.html">StudentOffice</a>   <a class="code" href="cc_8cpp.html#a94">student_office</a>;                   <span class="comment">// fred 980918</span>
<a name="l00218"></a><a class="code" href="cc_8cpp.html#a95">00218</a> <a class="code" href="classHelpIf.html">HelpIf</a>        <a class="code" href="cc_8cpp.html#a95">help_if</a>;
<a name="l00219"></a><a class="code" href="cc_8cpp.html#a96">00219</a> <a class="code" href="classGameSetting.html">GameSetting</a>     <a class="code" href="cc_8cpp.html#a96">game_setting</a>;
<a name="l00220"></a><a class="code" href="cc_8cpp.html#a97">00220</a> <a class="code" href="classMiscReport.html">MiscReport</a>      <a class="code" href="cc_8cpp.html#a97">misc_report</a>;                      <span class="comment">//## fred 0213</span>
<a name="l00221"></a><a class="code" href="cc_8cpp.html#a98">00221</a> <a class="code" href="classMoreReport.html">MoreReport</a>      <a class="code" href="cc_8cpp.html#a98">more_report</a>;
<a name="l00222"></a><a class="code" href="cc_8cpp.html#a99">00222</a> <a class="code" href="classDeptList.html">DeptList</a>        <a class="code" href="cc_8cpp.html#a99">dept_list</a>;
<a name="l00223"></a><a class="code" href="cc_8cpp.html#a100">00223</a> <a class="code" href="classCrime.html">Crime</a>         <a class="code" href="cc_8cpp.html#a100">crime</a>;
<a name="l00224"></a><a class="code" href="cc_8cpp.html#a101">00224</a> <a class="code" href="classParking.html">Parking</a>       <a class="code" href="cc_8cpp.html#a101">parking</a>;
00225 
<a name="l00226"></a><a class="code" href="cc_8cpp.html#a102">00226</a> <a class="code" href="classBankruptcyReport.html">BankruptcyReport</a> <a class="code" href="cc_8cpp.html#a102">bankruptcy</a>;
<a name="l00227"></a><a class="code" href="cc_8cpp.html#a103">00227</a> <a class="code" href="classFinalScoreReport.html">FinalScoreReport</a> <a class="code" href="cc_8cpp.html#a103">final_score</a>;
<a name="l00228"></a><a class="code" href="cc_8cpp.html#a104">00228</a> <a class="code" href="classScenarioReport.html">ScenarioReport</a> <a class="code" href="cc_8cpp.html#a104">scenario_report</a>;
<a name="l00229"></a><a class="code" href="cc_8cpp.html#a105">00229</a> <a class="code" href="classRetirementReport.html">RetirementReport</a> <a class="code" href="cc_8cpp.html#a105">retirement</a>;
<a name="l00230"></a><a class="code" href="cc_8cpp.html#a106">00230</a> <a class="code" href="classLoseGameReport.html">LoseGameReport</a> <a class="code" href="cc_8cpp.html#a106">lose_game</a>;
00231 
<a name="l00232"></a><a class="code" href="cc_8cpp.html#a107">00232</a> <a class="code" href="classPrintMenu.html">PrintMenu</a>     <a class="code" href="cc_8cpp.html#a107">print_menu</a>;
00233 <span class="comment">//DisplayModeInfo current_display_mode;</span>
00234 <span class="comment">//############# end Ho 0805 ############//</span>
00235 
00236 <span class="comment">// ---------------------------------------- //</span>
00237 
<a name="l00238"></a><a class="code" href="cc_8cpp.html#a108">00238</a> <a class="code" href="classGame.html">Game</a>              <a class="code" href="cc_8cpp.html#a108">game</a>;
<a name="l00239"></a><a class="code" href="cc_8cpp.html#a109">00239</a> <a class="code" href="classGameFileArray.html">GameFileArray</a>     <a class="code" href="cc_8cpp.html#a109">game_file_array</a>;
<a name="l00240"></a><a class="code" href="cc_8cpp.html#a110">00240</a> <a class="code" href="classGameFile.html">GameFile</a>          <a class="code" href="cc_8cpp.html#a110">game_file</a>;
00241 
00242 <span class="comment">// ---------------------------------------- //</span>
00243 
<a name="l00244"></a><a class="code" href="cc_8cpp.html#a111">00244</a> <a class="code" href="classSys.html">Sys</a>               <a class="code" href="cc_8cpp.html#a111">sys</a>;
00245 
00246 <span class="comment">//------- Define static functions --------//</span>
00247 
00248 <span class="keyword">static</span> <span class="keywordtype">void</span> extra_error_handler();
00249 <span class="keyword">static</span> <span class="keywordtype">int</span> is_math_exception( DWORD, _EXCEPTION_POINTERS * );
00250 <span class="keyword">static</span> <span class="keywordtype">void</span> play_video(HINSTANCE hInstance, <span class="keywordtype">int</span> videoId);
00251 
00252 <span class="preprocessor">#ifdef DEMO</span>
00253 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span> demo_screen();
00254 <span class="keyword">static</span> <span class="keywordtype">void</span> open_http(<span class="keywordtype">char</span>* shortcutFilename, <span class="keywordtype">char</span>* httpAddr);
00255 <span class="preprocessor">#endif</span>
00256 <span class="preprocessor"></span>
00257 <span class="comment">//---------- Begin of function WinMain ----------//</span>
<a name="l00275"></a><a class="code" href="cc_8cpp.html#a116">00275</a> <span class="comment">int PASCAL WinMain( HINSTANCE hInstance, HINSTANCE hPrevInstance,</span>
00276                     LPSTR lpCmdLine, <span class="keywordtype">int</span> nCmdShow) {
00277     <span class="comment">//------ set game directory and check CD ------//</span>
00278 
00279     sys.<a class="code" href="classSys.html#a17">set_game_dir</a>();
00280 
00281 <span class="preprocessor">#ifndef NO_CDCHECK</span>
00282 <span class="preprocessor"></span>
00283 <span class="preprocessor">#ifndef DEMO</span>
00284 <span class="preprocessor"></span>    <span class="keywordflow">if</span>( !sys.<a class="code" href="classSys.html#m29">cdrom_drive</a> ) {
00285 <span class="preprocessor">#ifdef ADMIN</span>
00286 <span class="preprocessor"></span>        <span class="keywordtype">char</span>* msg = <span class="stringliteral">"Please insert Virtual U - Administrator Version CDROM and try again."</span>;
00287 <span class="preprocessor">#else</span>
00288 <span class="preprocessor"></span>        <span class="keywordtype">char</span>* msg = <span class="stringliteral">"Please insert Virtual U CDROM and try again."</span>;
00289 <span class="preprocessor">#endif</span>
00290 <span class="preprocessor"></span>
00291         MessageBox(sys.<a class="code" href="classSys.html#m0">main_hwnd</a>, msg, <a class="code" href="Gamedef_8h.html#a3">WIN_TITLE</a>, MB_OK | MB_ICONERROR);
00292         <span class="keywordflow">return</span> 0;
00293     }
00294 <span class="preprocessor">#endif</span>
00295 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00296 <span class="preprocessor"></span>
00297     <span class="comment">//----------- play movie ---------------//</span>
00298 
00299     OSVERSIONINFO osVersion;
00300     memset( &amp;osVersion, 0, <span class="keyword">sizeof</span>(osVersion) );
00301     <span class="comment">// do not play movie in Win2000</span>
00302     osVersion.dwOSVersionInfoSize = <span class="keyword">sizeof</span>(osVersion);
00303 
00304     <span class="keywordflow">if</span>( !m.<a class="code" href="classMisc.html#a51">is_file_exist</a>(<span class="stringliteral">"SKIPAVI.SYS"</span>)
00305         &amp;&amp; GetVersionEx(&amp;osVersion) &amp;&amp; osVersion.dwPlatformId == VER_PLATFORM_WIN32_WINDOWS ) {
00306         play_video(hInstance, 0);
00307     }
00308 
00309     config.<a class="code" href="classConfig.html#a0">init</a>();
00310 
00311   <span class="comment">//--------------------------------------//</span>
00312 
00313     <span class="keywordflow">if</span>( !sys.<a class="code" href="classSys.html#a2">init</a>(hInstance) )
00314         <span class="keywordflow">return</span> FALSE;
00315 
00316     err.<a class="code" href="classError.html#a5">set_extra_handler</a>( extra_error_handler );   <span class="comment">// set extra error handler, save the game when a error happens</span>
00317 
00318 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00319 <span class="preprocessor"></span><span class="preprocessor">#ifdef DEBUG</span>
00320 <span class="preprocessor"></span>    <span class="comment">// break at exception, for debugging</span>
00321     <span class="keywordflow">if</span>( sys.<a class="code" href="classSys.html#m36">debug_session</a> ) {
00322         <span class="comment">// directX may change fpu control word, so change after sys.init</span>
00323         <span class="comment">// all exception but no inexact, underflow and denormal number exception</span>
00324         _control87( _EM_INEXACT | _EM_UNDERFLOW | _EM_DENORMAL, _MCW_EM );
00325     }
00326 <span class="preprocessor">#endif                                          // DEBUG</span>
00327 <span class="preprocessor"></span><span class="preprocessor">#endif                                          // GAME_VERSION&gt;=200</span>
00328 <span class="preprocessor"></span>
00329 <span class="preprocessor">#ifdef DEMO</span>
00330 <span class="preprocessor"></span>    audio.<a class="code" href="classAudio.html#a6">play_wav</a>(<span class="stringliteral">"DEMOOPEN"</span>,audio.<a class="code" href="classAudio.html#a37">int_to_DsVolume</a>(config.<a class="code" href="classConfig.html#m8">sound_effect_volume</a>));
00331 <span class="preprocessor">#endif</span>
00332 <span class="preprocessor"></span>
00333     game.<a class="code" href="classGame.html#a3">main_menu</a>();
00334 
00335 <span class="preprocessor">#ifdef DEMO</span>
00336 <span class="preprocessor"></span>    demo_screen();
00337 <span class="preprocessor">#endif</span>
00338 <span class="preprocessor"></span>
00339     sys.<a class="code" href="classSys.html#a3">deinit</a>();
00340 
00341     <span class="keywordflow">return</span> 0;
00342 }
00343 
00344 <span class="comment">//---------- End of function WinMain ----------//</span>
00345 
00346 <span class="comment">//----------- Begin of function Msg ----------//</span>
00350 <span class="comment"></span>
00351 <span class="preprocessor">#ifdef DEBUG</span>
00352 <span class="preprocessor"></span>
00353 <span class="keywordtype">void</span> __cdecl debug_msg( <span class="keywordtype">char</span>* fmt, ... ) {
00354     <span class="keywordtype">char</span> buff[256];
00355 
00356     lstrcpy( buff, <span class="stringliteral">"Virtual U: "</span> );
00357     wvsprintf( buff+lstrlen(buff), fmt, (<span class="keywordtype">char</span>*)(&amp;fmt+1) );
00358     lstrcat( buff, <span class="stringliteral">"\r\n"</span> );
00359 
00360     OutputDebugString( buff );
00361 }
00362 <span class="preprocessor">#endif</span>
00363 <span class="preprocessor"></span>
00364 <span class="comment">//----------- End of function Msg ----------//</span>
00365 
00366 <span class="comment">//------- Begin of function extra_error_handler -----------//</span>
00367 
00368 <span class="keyword">static</span> <span class="keywordtype">void</span> extra_error_handler() {
00369     <span class="comment">/*</span>
00370 <span class="comment">      if( game.game_mode != GAME_SINGLE_PLAYER )</span>
00371 <span class="comment">      return;</span>
00372 <span class="comment"></span>
00373 <span class="comment">      game_file_array.save_new_game("ERROR.SAV");  // save a new game immediately without prompting menu</span>
00374 <span class="comment"></span>
00375 <span class="comment">      box.msg( "Error encountered. The game has been saved to ERROR.SAV" );</span>
00376 <span class="comment">    */</span>
00377 }
00378 
00379 <span class="comment">//----------- End of function extra_error_handler -------------//</span>
00380 
00381 <span class="comment">//--------- Begin of function play_video --------------//</span>
00382 
00383 <span class="keyword">static</span> <span class="keywordtype">void</span> play_video(HINSTANCE hInstance, <span class="keywordtype">int</span> videoId) {
00384     <a class="code" href="classString.html">String</a> movieFileStr;
00385     <span class="comment">//  movieFileStr = DIR_MOVIE;</span>
00386     <span class="keywordflow">if</span>( videoId == 0 ) {
00387         movieFileStr += <span class="stringliteral">"INTRO.AVI"</span>;
00388     }
00389     <span class="keywordflow">else</span> {
00390         movieFileStr += <span class="stringliteral">"MOVIE"</span>;
00391         movieFileStr += videoId;
00392         movieFileStr += <span class="stringliteral">".AVI"</span>;
00393     }
00394 
00395     video.<a class="code" href="classVideo.html#a4">set_skip_on_fail</a>();
00396 
00397     <span class="keywordflow">if</span>( m.<a class="code" href="classMisc.html#a51">is_file_exist</a>(movieFileStr) ) {
00398         <span class="comment">//---------- play the movie now ---------//</span>
00399 
00400         video.<a class="code" href="classVideo.html#a2">init</a>();
00401 
00402         <span class="keywordflow">if</span>( video.<a class="code" href="classVideo.html#m3">init_success</a> ) {
00403             video.<a class="code" href="classVideo.html#a7">play_until_end</a>( movieFileStr, hInstance, 60 );
00404         }
00405         <span class="keywordflow">else</span> {
00406             <span class="comment">// display a message box (note:sys.main_hwnd is not valid)</span>
00407             <span class="comment">// MessageBox( NULL, "Cannot initialize ActiveMovie",</span>
00408             <span class="comment">//   "Virtual U", MB_OK | MB_ICONWARNING | MB_DEFBUTTON1 | MB_TASKMODAL );</span>
00409         }
00410 
00411         video.<a class="code" href="classVideo.html#a3">deinit</a>();
00412     }
00413 }
00414 
00415 <span class="comment">//--------- End of function play_video --------------//</span>
00416 
00417 <span class="preprocessor">#ifdef DEMO</span>
00418 <span class="preprocessor"></span>
00419 <span class="comment">//------- define struct DemoButton --------//</span>
00420 
00421 <span class="preprocessor">#define DEMO_BUTTON_COUNT 3</span>
00422 <span class="preprocessor"></span>
00423 <span class="keyword">enum</span> {
00424     BUTTON_WIDTH  = 201,
00425     BUTTON_HEIGHT = 37
00426 };
00427 
00430 <span class="keyword">struct </span>DemoButton {
00431     <span class="keywordtype">short</span> x1;
00432     <span class="keywordtype">short</span> y1;
00433     <span class="keywordtype">short</span> width;
00434     <span class="keywordtype">short</span> height;
00435     <span class="keywordtype">char</span>* file_name;
00436 };
00437 
00438 <span class="comment">//----------- define static vars ---------//</span>
00439 
00440 <span class="keyword">static</span> DemoButton demo_button_array[] = {
00441     { 83 , 508, 186, 65, <span class="stringliteral">"DEMOSCR1"</span> },
00442     { 339, 508, 183, 64, <span class="stringliteral">"DEMOSCR2"</span> },
00443     { 622, 508, 80, 65, <span class="stringliteral">"DEMOSCR3"</span> },
00444 };
00445 
00446 <span class="comment">//--------- Begin of function demo_screen -----------//</span>
00447 
00448 <span class="keyword">static</span> <span class="keywordtype">void</span> demo_screen() {
00449     <span class="comment">//------- display screen -----------//</span>
00450 
00451     <span class="keywordtype">int</span> dataSize;
00452     <a class="code" href="classFile.html">File</a>* filePtr = image_interface.<a class="code" href="classResourceIdx.html#a13">get_file</a>(<span class="stringliteral">"DEMOSCR"</span>, dataSize);
00453 
00454     <span class="keywordflow">if</span> (filePtr-&gt;<a class="code" href="classFile.html#a11">file_get_short</a>() != -1 ) {         <span class="comment">// use common color palette</span>
00455         filePtr-&gt;<a class="code" href="classFile.html#a7">file_seek</a>(filePtr-&gt;<a class="code" href="classFile.html#a8">file_pos</a>() - <span class="keyword">sizeof</span>(short));
00456         vga_back.<a class="code" href="classVgaBuf.html#a55">put_large_bitmap</a>(0, 0, filePtr);
00457     }
00458     <span class="keywordflow">else</span> {                                          <span class="comment">// use own color palette</span>
00459         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> palette[256 * 3];
00460         <span class="keywordtype">short</span> *remapTable;
00461         filePtr-&gt;<a class="code" href="classFile.html#a9">file_read</a>(palette, 256 * 3);
00462         <a class="code" href="structPalDesc.html">PalDesc</a> palDesc(palette, 3, 256, 6);
00463         <a class="code" href="classColorTable.html">ColorTable</a> colorTable;
00464         colorTable.<a class="code" href="classColorTable.html#a9">generate_table_fast</a>(<a class="code" href="OVGA_8H.html#a3">MAX_BRIGHTNESS_ADJUST_DEGREE</a>, palDesc, <a class="code" href="classColorTable.html#d0">ColorTable::bright_func</a>);
00465         remapTable = (<span class="keywordtype">short</span> *) colorTable.<a class="code" href="classColorTable.html#a11">get_table</a>(0);
00466         vga_back.<a class="code" href="classVgaBuf.html#a55">put_large_bitmap</a>(0, 0, filePtr, remapTable);
00467     }
00468 
00469     vga.<a class="code" href="classVga.html#a19">blt_buf</a>(0,0,<a class="code" href="OVGA_8H.html#a0">VGA_WIDTH</a>-1,<a class="code" href="OVGA_8H.html#a1">VGA_HEIGHT</a>-1);
00470     sys.<a class="code" href="classSys.html#a16">blt_virtual_buf</a>();
00471 
00472     <span class="comment">//-------- detect button --------//</span>
00473 
00474     <span class="keywordtype">int</span> highlightButton=0;
00475 
00476     <span class="keywordflow">while</span>(1) {
00477         MSG msg;
00478 
00479         <span class="keywordflow">if</span> (PeekMessage( &amp;msg, <a class="code" href="OHELP_8H.html#a0">NULL</a>, 0, 0, PM_NOREMOVE)) {
00480             <span class="keywordflow">if</span> (!GetMessage( &amp;msg, <a class="code" href="OHELP_8H.html#a0">NULL</a>, 0, 0)) {
00481                 <span class="keywordflow">return</span>;
00482             }
00483 
00484             TranslateMessage(&amp;msg);
00485             DispatchMessage(&amp;msg);
00486             <span class="keywordflow">continue</span>;
00487         }
00488         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( sys.<a class="code" href="classSys.html#m4">paused_flag</a> || !sys.<a class="code" href="classSys.html#m3">active_flag</a> ) {
00489             WaitMessage();
00490             <span class="keywordflow">continue</span>;
00491         }
00492 
00493         <span class="comment">//---------- detect menu option buttons -----------//</span>
00494 
00495         sys.<a class="code" href="classSys.html#a10">yield</a>();
00496         mouse.<a class="code" href="classMouse.html#a6">get_event</a>();
00497 
00498         DemoButton* buttonPtr = demo_button_array;
00499 
00500         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;DEMO_BUTTON_COUNT ; i++, buttonPtr++ ) {
00501             <span class="comment">//----- has clicked on a button -------//</span>
00502 
00503             <span class="keywordflow">if</span>(  mouse.<a class="code" href="classMouse.html#a19">single_click</a>( buttonPtr-&gt;x1, buttonPtr-&gt;y1,
00504                                      buttonPtr-&gt;x1+buttonPtr-&gt;width-1, buttonPtr-&gt;y1+buttonPtr-&gt;height-1, 0 ) ) {
00505                 audio.<a class="code" href="classAudio.html#a6">play_wav</a>(<span class="stringliteral">"BEEPS-1"</span>,audio.<a class="code" href="classAudio.html#a37">int_to_DsVolume</a>(config.<a class="code" href="classConfig.html#m8">sound_effect_volume</a>));
00506 
00507                 <span class="keywordflow">switch</span>(i) {
00508                 <span class="keywordflow">case</span> 0:
00509                     open_http( <span class="stringliteral">"anker.url"</span>, <span class="stringliteral">"http://www.ankerpub.com"</span> );
00510                     <span class="keywordflow">return</span>;
00511 
00512                 <span class="keywordflow">case</span> 1:
00513                     open_http( <span class="stringliteral">"vu.url"</span>, <span class="stringliteral">"http://www.virtual-u.org"</span> );
00514                     <span class="keywordflow">return</span>;
00515 
00516                 <span class="keywordflow">case</span> 2:
00517                     <span class="keywordflow">return</span>;
00518                 }
00519             }
00520 
00521             <span class="comment">//---- if the mouse cursor is in the area ----//</span>
00522 
00523             <span class="keywordflow">if</span>(  mouse.<a class="code" href="classMouse.html#a14">in_area</a>( buttonPtr-&gt;x1, buttonPtr-&gt;y1,
00524                                 buttonPtr-&gt;x1+buttonPtr-&gt;width-1, buttonPtr-&gt;y1+buttonPtr-&gt;height-1 ) ) {
00525                 <span class="keywordflow">if</span>( highlightButton != i+1 ) {
00526                     highlightButton = i+1;
00527 
00528                     <span class="comment">// restore original image first</span>
00529                     vga.<a class="code" href="classVga.html#a19">blt_buf</a>(0,0,<a class="code" href="OVGA_8H.html#a0">VGA_WIDTH</a>-1,<a class="code" href="OVGA_8H.html#a1">VGA_HEIGHT</a>-1);
00530 
00531                     mouse.<a class="code" href="classMouse.html#a12">hide_area</a>(buttonPtr-&gt;x1, buttonPtr-&gt;y1,
00532                                     buttonPtr-&gt;x1+buttonPtr-&gt;width-1,  buttonPtr-&gt;y1+buttonPtr-&gt;height-1);
00533 
00534                     image_interface.<a class="code" href="classImageRes.html#a2">put_front</a>( buttonPtr-&gt;x1, buttonPtr-&gt;y1, buttonPtr-&gt;file_name );
00535 
00536                     mouse.<a class="code" href="classMouse.html#a13">show_area</a>();
00537 
00538                     sys.<a class="code" href="classSys.html#a16">blt_virtual_buf</a>();
00539                 }
00540                 <span class="keywordflow">break</span>;
00541             }
00542         }
00543 
00544         <span class="comment">//------- the mouse cursor is not on any of the buttons ------//</span>
00545 
00546         <span class="keywordflow">if</span>( i==DEMO_BUTTON_COUNT ) {
00547             <span class="keywordflow">if</span>( highlightButton != 0 ) {
00548                 vga.<a class="code" href="classVga.html#a19">blt_buf</a>(0,0,<a class="code" href="OVGA_8H.html#a0">VGA_WIDTH</a>-1,<a class="code" href="OVGA_8H.html#a1">VGA_HEIGHT</a>-1);<span class="comment">// restore original image</span>
00549                 highlightButton = 0;
00550             }
00551         }
00552     }
00553 }
00554 
00555 <span class="comment">//--------- End of function demo_screen -----------//</span>
00556 
00557 <span class="comment">//--------- Begin of function open_http -----------//</span>
00558 
00559 <span class="keyword">static</span> <span class="keywordtype">void</span> open_http(<span class="keywordtype">char</span>* shortcutFilename, <span class="keywordtype">char</span>* httpAddr) {
00560     <span class="keywordflow">if</span>( !m.<a class="code" href="classMisc.html#a51">is_file_exist</a>(shortcutFilename) ) {
00561         <span class="comment">// create 7k2home.url file</span>
00562 
00563         <a class="code" href="classString.html">String</a> str = <span class="stringliteral">"[InternetShortcut]\r\nURL="</span>;
00564         str += httpAddr;
00565         str += <span class="stringliteral">"\r\n"</span>;
00566 
00567         <a class="code" href="classFile.html">File</a> urlFile;
00568         urlFile.<a class="code" href="classFile.html#a3">file_create</a>(shortcutFilename);
00569         urlFile.<a class="code" href="classFile.html#a10">file_write</a>( str, strlen(str) );
00570         urlFile.<a class="code" href="classFile.html#a5">file_close</a>();
00571     }
00572 
00573     <span class="keywordflow">if</span>( m.<a class="code" href="classMisc.html#a51">is_file_exist</a>(shortcutFilename) ) {
00574         sys.<a class="code" href="classSys.html#a3">deinit</a>();
00575         HINSTANCE hinst = ShellExecute( sys.<a class="code" href="classSys.html#m0">main_hwnd</a>, <span class="stringliteral">"open"</span>, shortcutFilename, <a class="code" href="OHELP_8H.html#a0">NULL</a>, <span class="stringliteral">""</span>, SW_SHOWNORMAL );
00576     }
00577 }
00578 
00579 <span class="comment">//--------- End of function open_http -----------//</span>
00580 <span class="preprocessor">#endif</span>
00581 <span class="preprocessor"></span>
00582 <span class="comment">// value from GetExceptionCode()</span>
00583 <span class="keyword">static</span> <span class="keywordtype">int</span> is_math_exception( DWORD exceptionCode, _EXCEPTION_POINTERS *exceptInfo ) {
00584     <span class="comment">// use in this way eg</span>
00585     <span class="comment">// __try</span>
00586     <span class="comment">// {</span>
00587     <span class="comment">// ....</span>
00588     <span class="comment">// }</span>
00589     <span class="comment">// __except( is_math_exception( GetExceptionCode(), GetExceptionInformation() )</span>
00590     <span class="comment">// {</span>
00591     <span class="comment">// }</span>
00592 
00593     <span class="keywordflow">switch</span>( exceptionCode ) {
00594     <span class="keywordflow">case</span> EXCEPTION_FLT_INVALID_OPERATION:
00595     <span class="keywordflow">case</span> EXCEPTION_FLT_DIVIDE_BY_ZERO:
00596     <span class="keywordflow">case</span> EXCEPTION_INT_DIVIDE_BY_ZERO:
00597     <span class="keywordflow">case</span> EXCEPTION_INT_OVERFLOW: {
00598         <span class="keywordtype">void</span> *pAddr =  exceptInfo-&gt;ExceptionRecord-&gt;ExceptionAddress;
00599         err.<a class="code" href="classError.html#a3">msg</a>( <span class="stringliteral">"math exception at %p"</span>, pAddr );
00600     }
00601     <span class="keywordflow">return</span> EXCEPTION_EXECUTE_HANDLER;
00602     <span class="keywordflow">default</span>:
00603         <span class="keywordflow">return</span> EXCEPTION_CONTINUE_SEARCH;
00604     }
00605 }
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:01 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
