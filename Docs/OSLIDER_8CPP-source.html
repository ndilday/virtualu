<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OSLIDER.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>OSLIDER.CPP</h1><a href="OSLIDER_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OSLIDER.CPP</span>
00002 <span class="comment">//Description : Object slider</span>
00003 
00004 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00005 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00007 <span class="preprocessor">#include &lt;OFONT.H&gt;</span>
00008 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00009 <span class="preprocessor">#include &lt;<a class="code" href="OSLIDER_8H.html">OSLIDER.H</a>&gt;</span>
00010 
00011 <span class="comment">//--------- Define macro constant -----------//</span>
00012 
00013 <span class="keyword">enum</span> {                                            <span class="comment">// Default height of slider</span>
00014     <a class="code" href="OSLIDER_8CPP.html#a1a0">SLIDER_HEIGHT</a> = 16
00015 };
00016 
00017 <span class="comment">//-------- Begin of function Slider::init --------//</span>
<a name="l00033"></a><a class="code" href="classSlider.html#a0">00033</a> <span class="comment">void Slider::init( int x1, int y1, int barWidth, int sliderHeight, int barColor,</span>
00034                    <span class="keywordtype">int</span>* varPtr, <span class="keywordtype">int</span> maxValue, <span class="keywordtype">int</span> stdValue, <span class="keywordtype">int</span> barColor2 ) {
00035     slider_x1    = x1;
00036     slider_y1    = y1;
00037     slider_x2    = x1+barWidth+3;
00038 
00039     <span class="keywordflow">if</span>( sliderHeight )
00040         slider_y2 = y1+sliderHeight-1;
00041     <span class="keywordflow">else</span>
00042         slider_y2 = y1+<a class="code" href="OSLIDER_8CPP.html#a1a0">SLIDER_HEIGHT</a>-1;
00043 
00044     bar_width    = barWidth;
00045     bar_color    = barColor;
00046 
00047     var_ptr      = varPtr;
00048     max_value    = maxValue;
00049 
00050     std_value    = stdValue;
00051     bar_color2   = barColor2;
00052 
00053     enable_flag  = 1;
00054 
00055     paint();
00056 }
00057 
00058 <span class="comment">//--------- End of function Slider::init ---------//</span>
00059 
00060 <span class="comment">//-------- Begin of function Slider::paint --------//</span>
<a name="l00062"></a><a class="code" href="classSlider.html#a1">00062</a> <span class="comment">void Slider::paint() {</span>
00063     vga.d3_panel_down( slider_x1, slider_y1, slider_x2, slider_y2 );
00064 
00065     refresh();
00066 }
00067 
00068 <span class="comment">//--------- End of function Slider::paint ---------//</span>
00069 
00070 <span class="comment">//-------- Begin of function Slider::refresh --------//</span>
<a name="l00072"></a><a class="code" href="classSlider.html#a2">00072</a> <span class="comment">void Slider::refresh() {</span>
00073     <a class="code" href="ALL_8H.html#a0">err_when</a>( max_value==0 );
00074 
00075     <span class="keywordtype">int</span> barWidth = (*var_ptr) * bar_width / max_value;
00076 
00077     <span class="keywordflow">if</span>( barWidth &gt; bar_width )
00078         barWidth = bar_width;
00079 
00080     mouse.hide_area(slider_x1, slider_y1, slider_x2, slider_y2);
00081 
00082     <span class="comment">//----- paint the bar area ---------//</span>
00083 
00084     <span class="keywordflow">if</span>( barWidth &gt; 0 ) {
00085         <span class="keywordflow">if</span>( std_value ) {                             <span class="comment">// if standard value is set, than use different color</span>
00086             <span class="keywordtype">int</span> stdBarWidth = std_value * bar_width / max_value;
00087 
00088             <span class="comment">//--- use bar_color for the area &lt; std_value ---//</span>
00089 
00090             <a class="code" href="ALL_8H.html#a0">err_when</a>( slider_x1+2 &gt; slider_x1+1+min(barWidth,stdBarWidth) );
00091 
00092             <a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;<a class="code" href="classVgaBuf.html#a27">bar</a>( slider_x1+2, slider_y1+2, slider_x1+1+min(barWidth,stdBarWidth),
00093                                   slider_y2-2, bar_color );
00094 
00095             <span class="comment">//--- use bar_color2 for the area &gt; std_value ---//</span>
00096 
00097             <span class="keywordflow">if</span>( barWidth &gt; stdBarWidth ) {
00098                 <a class="code" href="ALL_8H.html#a0">err_when</a>( slider_x1+2+stdBarWidth &gt; slider_x1+1+barWidth );
00099 
00100                 <a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;<a class="code" href="classVgaBuf.html#a27">bar</a>( slider_x1+2+stdBarWidth, slider_y1+2, slider_x1+1+barWidth,
00101                                       slider_y2-2, bar_color2 );
00102             }
00103         }
00104         <span class="keywordflow">else</span> {
00105             <a class="code" href="ALL_8H.html#a0">err_when</a>( slider_x1+2 &gt; slider_x1+1+barWidth );
00106 
00107             <a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;<a class="code" href="classVgaBuf.html#a27">bar</a>( slider_x1+2, slider_y1+2, slider_x1+1+barWidth,
00108                                   slider_y2-2, bar_color );
00109         }
00110     }
00111 
00112     <span class="comment">//----- paint the non-bar area ---------//</span>
00113 
00114     <span class="keywordflow">if</span>( barWidth &lt; bar_width ) {
00115         <a class="code" href="ALL_8H.html#a0">err_when</a>( slider_x1+2+barWidth &gt; slider_x2-2 );
00116 
00117         <a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;<a class="code" href="classVgaBuf.html#a27">bar</a>( slider_x1+2+barWidth, slider_y1+2, slider_x2-2, slider_y2-2, <a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;color_down );
00118     }
00119 
00120     vga_back.bar( slider_x1, slider_y1, slider_x2, slider_y2, <a class="code" href="COLOR_8H.html#a19">V_RED</a> );
00121 
00122     mouse.show_area();
00123 }
00124 
00125 <span class="comment">//--------- End of function Slider::refresh ---------//</span>
00126 
00127 <span class="comment">//-------- Begin of function Slider::detect --------//</span>
<a name="l00132"></a><a class="code" href="classSlider.html#a3">00132</a> <span class="comment">int Slider::detect() {</span>
00133     <span class="keywordflow">if</span>( !mouse.single_click( slider_x1, slider_y1, slider_x2, slider_y2 ) )
00134         <span class="keywordflow">return</span> 0;
00135 
00136     <span class="keywordtype">int</span> lastVar = *var_ptr;
00137 
00138     <span class="keywordflow">do</span> {
00139         sys.yield();
00140         mouse.get_event();
00141 
00142         *var_ptr = (long)(mouse.cur_x-slider_x1-2) * max_value / bar_width;
00143 
00144         <span class="keywordflow">if</span>( *var_ptr &lt; 0 )
00145             *var_ptr = 0;
00146 
00147         <span class="keywordflow">if</span>( *var_ptr &gt; max_value )
00148             *var_ptr = max_value;
00149 
00150         <span class="keywordflow">if</span>( lastVar != *var_ptr )
00151             refresh();
00152     }
00153     <span class="keywordflow">while</span>( mouse.left_press );
00154 
00155     <span class="keywordflow">return</span> 1;
00156 }
00157 
00158 <span class="comment">//--------- End of function Slider::detect ---------//</span>
00159 
00160 <span class="comment">//.........................................................//</span>
00161 
00162 <span class="comment">//-------- Begin of function SliderGroup::SliderGroup -------//</span>
00163 
<a name="l00164"></a><a class="code" href="classSliderGroup.html#a0">00164</a> <a class="code" href="classSliderGroup.html#a0">SliderGroup::SliderGroup</a>(<span class="keywordtype">int</span> sliderNum) {
00165     <a class="code" href="classSliderGroup.html#m0">slider_num</a>     = sliderNum;
00166     <a class="code" href="classSliderGroup.html#m1">slider_array</a>   = <span class="keyword">new</span> <a class="code" href="classSlider.html">Slider</a>[sliderNum];
00167 }
00168 
00169 <span class="comment">//---------- End of function SliderGroup::SliderGroup -------//</span>
00170 
00171 <span class="comment">//--------- Begin of function SliderGroup::paint ----------//</span>
<a name="l00175"></a><a class="code" href="classSliderGroup.html#a2">00175</a> <span class="comment">void SliderGroup::paint() {</span>
00176     <span class="keywordtype">int</span> i;
00177 
00178     <span class="keywordflow">for</span>( i=0 ; i&lt;slider_num ; i++ )
00179         slider_array[i].<a class="code" href="classSlider.html#a1">paint</a>();
00180 }
00181 
00182 <span class="comment">//----------- End of function SliderGroup::paint ----------//</span>
00183 
00184 <span class="comment">//--------- Begin of function SliderGroup::detect ----------//</span>
<a name="l00194"></a><a class="code" href="classSliderGroup.html#a3">00194</a> <span class="comment">int SliderGroup::detect() {</span>
00195     <span class="keywordtype">int</span> i, oldValue;
00196 
00197     <span class="keywordflow">for</span>( i=0 ; i&lt;slider_num ; i++ ) {
00198         oldValue = *(slider_array[i].var_ptr);
00199 
00200         <span class="keywordflow">if</span>( slider_array[i].detect() )
00201             <span class="keywordflow">break</span>;
00202     }
00203 
00204     <span class="keywordflow">if</span>( i==slider_num )                             <span class="comment">// no detect</span>
00205         <span class="keywordflow">return</span> 0;
00206 
00207     <span class="comment">//------- pull or give value to other slider ------//</span>
00208 
00209     <span class="keywordtype">int</span> j, decValue;
00210     <span class="keywordtype">int</span> deltaValue = *(slider_array[i].var_ptr) - oldValue;
00211 
00212     <span class="comment">//------- If it's the last slider ---------//</span>
00213 
00214     <span class="keywordflow">if</span>( i==slider_num-1 ) {
00215         <span class="keywordflow">if</span>( deltaValue &lt; 0 ) {                        <span class="comment">// its value goes to the first slider</span>
00216             *(slider_array[0].var_ptr) += -deltaValue;
00217             slider_array[0].refresh();
00218         }
00219         <span class="keywordflow">else</span> {                                        <span class="comment">// pull value from top sliders</span>
00220             <span class="keywordflow">for</span>( j=0 ; j&lt;slider_num-1 &amp;&amp; deltaValue&gt;0 ; j++ ) {
00221                 decValue = min( *(slider_array[j].var_ptr), deltaValue );
00222 
00223                 *(slider_array[j].var_ptr) -= decValue;
00224                 deltaValue           -= decValue;
00225 
00226                 slider_array[j].refresh();
00227             }
00228         }
00229     }
00230 
00231     <span class="comment">//----- If it's not the last slider -----//</span>
00232 
00233     <span class="keywordflow">else</span> {
00234         <span class="keywordflow">if</span>( deltaValue &lt; 0 ) {                        <span class="comment">// its value goes to the last slider</span>
00235             *(slider_array[slider_num-1].var_ptr) += -deltaValue;
00236             slider_array[slider_num-1].refresh();
00237         }
00238         <span class="keywordflow">else</span> {                                        <span class="comment">// pull value from bottom sliders</span>
00239             <span class="keywordflow">for</span>( j=slider_num-1 ; j&gt;=0 &amp;&amp; deltaValue&gt;0 ; j-- ) {
00240                 <span class="keywordflow">if</span>( j != i ) {                            <span class="comment">// don't pull from itself</span>
00241                     decValue = min( *(slider_array[j].var_ptr), deltaValue );
00242 
00243                     *(slider_array[j].var_ptr) -= decValue;
00244                     deltaValue      -= decValue;
00245 
00246                     slider_array[j].refresh();
00247                 }
00248             }
00249         }
00250     }
00251 
00252     <span class="keywordflow">return</span> 1;
00253 }
00254 
00255 <span class="comment">//----------- End of function SliderGroup::detect ----------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:23 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
