<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Ostudena.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Ostudena.cpp</h1><a href="Ostudena_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OSTUDENA.CPP</span>
00002 <span class="comment">//Description : Student Array Class Definition</span>
00003 
00004 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00005 
00006 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>
00007 <span class="preprocessor">#include &lt;OPSCHOOL.H&gt;</span>
00008 <span class="preprocessor">#include &lt;ODEPT.H&gt;</span>
00009 <span class="preprocessor">#include &lt;OFINANCE.H&gt;</span>
00010 <span class="preprocessor">#include &lt;OSTUDENT.H&gt;</span>
00011 <span class="preprocessor">#include &lt;OENROLL.H&gt;</span>
00012 
00013 <span class="comment">//----------- Begin of function StudentArray Constructor -----//</span>
<a name="l00015"></a><a class="code" href="classStudentArray.html#a0">00015</a> <span class="comment">StudentArray::StudentArray() : DynArrayB(sizeof(Student), 200, DEFAULT_REUSE_INTERVAL_DAYS) {</span>
00016     student_count=0;
00017 
00018     memset(talent_academic_all, 0, <span class="keyword">sizeof</span>(talent_academic_all));
00019     memset(performance_academic_ug, 0, <span class="keyword">sizeof</span>(performance_academic_ug));
00020 
00021     memset(talent_academic, 0, <span class="keyword">sizeof</span>(talent_academic));
00022     memset(talent_extracurricular, 0, <span class="keyword">sizeof</span>(talent_academic));
00023     memset(talent_athletics, 0, <span class="keyword">sizeof</span>(talent_academic));
00024 
00025     memset(satisfaction_academic, 0, <span class="keyword">sizeof</span>(talent_academic));
00026     memset(satisfaction_student_life, 0, <span class="keyword">sizeof</span>(talent_academic));
00027     memset(satisfaction_athletics, 0, <span class="keyword">sizeof</span>(talent_academic));
00028     memset(satisfaction_overall, 0, <span class="keyword">sizeof</span>(satisfaction_overall));
00029 
00030     memset(time_to_degree, 0, <span class="keyword">sizeof</span>(time_to_degree));
00031     memset(dropout_rate, 0, <span class="keyword">sizeof</span>(dropout_rate));
00032 
00033     <span class="comment">// ### begin Gilbert 05/06/2001 #####//</span>
00034     memset(fake_disp_time_to_degree, 0, <span class="keyword">sizeof</span>(fake_disp_time_to_degree) );
00035     <span class="comment">// ### end Gilbert 05/06/2001 #####//</span>
00036 
00037     memset(bachelor_degree,0,<span class="keyword">sizeof</span>(doctor_degree));
00038 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00039 <span class="preprocessor"></span>    memset(non_ug_bachelor_degree,0,<span class="keyword">sizeof</span>(doctor_degree));
00040 <span class="preprocessor">#endif</span>
00041 <span class="preprocessor"></span>    memset(master_degree,0,<span class="keyword">sizeof</span>(doctor_degree));
00042     memset(doctor_degree,0,<span class="keyword">sizeof</span>(doctor_degree));
00043 
00044     memset(time_to_degree_cumm,0,<span class="keyword">sizeof</span>(time_to_degree_cumm));
00045     memset(cur_dropout,0,<span class="keyword">sizeof</span>(cur_dropout));
00046     memset(ave_entering_class,0,<span class="keyword">sizeof</span>(ave_entering_class));
00047 
00048     cur_bachelor_degree = 0;
00049 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00050 <span class="preprocessor"></span>    cur_non_ug_bachelor_degree = 0;
00051 <span class="preprocessor">#endif</span>
00052 <span class="preprocessor"></span>    cur_master_degree = 0;
00053     cur_doctor_degree = 0;
00054 
00055 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00056 <span class="preprocessor"></span>    <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=0; i&lt;4; i++ ) {
00057         last_year_degree[i] = 0;
00058         last_year_dropout[i] = 0;
00059     }
00060 <span class="preprocessor">#endif</span>
00061 <span class="preprocessor"></span>
00062     ave_time_to_graduation_for_ug = 0;
00063 }
00064 
00065 <span class="comment">//------------- End of function StudentArray Constructor -----//</span>
00066 
00067 <span class="comment">//----------- Begin of function StudentArray Destructor ------//</span>
<a name="l00069"></a><a class="code" href="classStudentArray.html#a1">00069</a> <span class="comment">StudentArray::~StudentArray() {</span>
00070     <span class="comment">//----------------------------------//</span>
00071     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=size() ; i&gt;0 ; i-- ) {
00072         <span class="keywordflow">if</span>( !is_deleted(i) )
00073             del(i);
00074     }
00075 
00076     <span class="comment">//----------------------------------//</span>
00077 }
00078 
00079 <span class="comment">//------------- End of function StudentArray Destructor ------//</span>
00080 
00081 <span class="comment">//--------- Begin of function StudentArray::add ---------//</span>
00082 
<a name="l00083"></a><a class="code" href="classStudentArray.html#a4">00083</a> <span class="keywordtype">int</span> <a class="code" href="classStudentArray.html#a4">StudentArray::add</a>(<span class="keywordtype">char</span> studentLevel, <span class="keywordtype">char</span> yearInProgram, <span class="keywordtype">char</span> genderEthnicGroup, <span class="keywordtype">char</span> stuSeg, <span class="keywordtype">char</span> major, <span class="keywordtype">int</span> finAid, <span class="keywordtype">float</span>* talentArr) {
00084     <a class="code" href="classStudent.html">Student</a> student;
00085 
00086     student.<a class="code" href="classStudent.html#a2">init</a>(studentLevel, yearInProgram, genderEthnicGroup, stuSeg, major, finAid, talentArr );
00087 
00088     <a class="code" href="classDynArrayB.html#a4">linkin</a>(&amp;student);
00089 
00090     ((<a class="code" href="classStudent.html">Student</a>*)<a class="code" href="classDynArray.html#a13">get</a>())-&gt;student_recno = <a class="code" href="classDynArray.html#a27">recno</a>();
00091 
00092     <a class="code" href="classStudentArray.html#m1">student_count</a>++;
00093 
00094     <span class="keywordflow">return</span> <a class="code" href="classDynArray.html#a27">recno</a>();
00095 }
00096 
00097 <span class="comment">//----------- End of function StudentArray::add -----------//</span>
00098 
00099 <span class="comment">//--------- Begin of function StudentArray::del ---------//</span>
00100 
<a name="l00101"></a><a class="code" href="classStudentArray.html#a5">00101</a> <span class="keywordtype">void</span> <a class="code" href="classStudentArray.html#a5">StudentArray::del</a>(<span class="keywordtype">int</span> recNo) {
00102 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00103 <span class="preprocessor"></span>    <span class="comment">// BUG FIXED in Version 2.0</span>
00104     <a class="code" href="classStudent.html">Student</a> *ptr = (<a class="code" href="classStudent.html">Student</a>*) <a class="code" href="classDynArray.html#a13">get</a>(recNo);
00105 <span class="preprocessor">#else</span>
00106 <span class="preprocessor"></span>    <a class="code" href="classStudent.html">Student</a> *ptr = (<a class="code" href="classStudent.html">Student</a>*) <a class="code" href="classDynArray.html#a15">get_ptr</a>(recNo);
00107 <span class="preprocessor">#endif</span>
00108 <span class="preprocessor"></span>
00109     <span class="comment">// avoid bug 2107</span>
00110     <span class="keywordflow">if</span>(!ptr)
00111         <span class="keywordflow">return</span>;                                       <span class="comment">// temp use</span>
00112     <span class="comment">//  err_when(!ptr);</span>
00113 
00114     <span class="comment">//##### begin fred 980915 #####//</span>
00115     <a class="code" href="classStudentArray.html#m1">student_count</a>--;
00116     <span class="comment">//##### end fred 980915 #####//</span>
00117     <a class="code" href="classDynArrayB.html#a5">linkout</a>(recNo);
00118 }
00119 
00120 <span class="comment">//----------- End of function StudentArray::del -----------//</span>
00121 
00122 <span class="comment">//--------- Begin of function StudentArray::is_deleted ---------//</span>
00123 
<a name="l00124"></a><a class="code" href="classStudentArray.html#a9">00124</a> <span class="keywordtype">int</span> <a class="code" href="classStudentArray.html#a9">StudentArray::is_deleted</a>(<span class="keywordtype">int</span> recNo) {
00125     <a class="code" href="classStudent.html">Student</a>* studentPtr = (<a class="code" href="classStudent.html">Student</a>*) <a class="code" href="classDynArray.html#a13">get</a>(recNo);
00126     <span class="keywordflow">if</span>( studentPtr == <a class="code" href="OHELP_8H.html#a0">NULL</a> )
00127         <span class="keywordflow">return</span> 1;
00128     <span class="keywordflow">return</span> studentPtr-&gt;<a class="code" href="classStudent.html#m0">student_recno</a> == 0;
00129 }
00130 
00131 <span class="comment">//----------- End of function StudentArray::is_deleted -----------//</span>
00132 
00133 <span class="preprocessor">#ifdef DEBUG</span>
00134 <span class="preprocessor"></span>
00135 <span class="comment">//------- Begin of function StudentArray::operator[] -----//</span>
00136 
00137 <a class="code" href="classStudent.html">Student</a>* <a class="code" href="classStudentArray.html#a10">StudentArray::operator[]</a>(<span class="keywordtype">int</span> recNo) {
00138     <a class="code" href="classStudent.html">Student</a>* StudentPtr = (<a class="code" href="classStudent.html">Student</a>*) <a class="code" href="classDynArray.html#a13">get</a>(recNo);
00139 
00140     <span class="keywordflow">if</span>( !StudentPtr )
00141         err.run( <span class="stringliteral">"StudentArray[] is deleted"</span> );
00142 
00143     <span class="keywordflow">return</span> StudentPtr;
00144 }
00145 
00146 <span class="comment">//--------- End of function StudentArray::operator[] ----//</span>
00147 <span class="preprocessor">#endif</span>
00148 <span class="preprocessor"></span>
00149 <span class="comment">//------------------------------------------------------------//</span>
00150 <span class="comment">//------------------------------------------------------------//</span>
00151 <span class="comment">//------------------------------------------------------------//</span>
00152 <span class="comment">//------------------------------------------------------------//</span>
00153 <span class="comment">//------------------------------------------------------------//</span>
00154 
00155 <span class="comment">//--------- Begin of function StudentArray::next_day ---------//</span>
<a name="l00157"></a><a class="code" href="classStudentArray.html#a6">00157</a> <span class="comment">void StudentArray::next_day() {</span>
00158     <span class="comment">//----- call individual student's next_day() function ----//</span>
00159 
00160     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=size() ; i&gt;0 ; i-- ) {
00161         <span class="keywordflow">if</span>( is_deleted(i) )
00162             <span class="keywordflow">continue</span>;
00163 
00164         operator[](i)-&gt;next_day();
00165     }
00166 
00167     <span class="comment">//##### begin fred 980819 #####//</span>
00168     <span class="comment">//----------------------------------------//</span>
00169     <span class="comment">// start of a month</span>
00170     <span class="keywordflow">if</span> ( info.game_day == 1 ) {
00171         <span class="comment">//## 071299 chea 1.12.1</span>
00172         <span class="comment">//     update_history(UPDATE_MONTH);</span>
00173 
00174         <span class="comment">// start of a year</span>
00175         <span class="keywordflow">if</span> ( info.game_month == finance.fiscal_year_start_month )
00176             update_history(UPDATE_YEAR);
00177         <span class="comment">//## 071299 chea 1.12.1</span>
00178         <span class="keywordflow">else</span>
00179             update_history(UPDATE_MONTH);
00180 
00181     }
00182 
00183     <span class="comment">//##### end fred 980819 #####//</span>
00184 }
00185 
00186 <span class="comment">//----------- End of function StudentArray::next_day -----------//</span>
00187 
00188 <span class="comment">//--------- Begin of function StudentArray::next_trimester ---------//</span>
<a name="l00192"></a><a class="code" href="classStudentArray.html#a7">00192</a> <span class="comment">void StudentArray::next_trimester() {</span>
00193 
00194     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=size() ; i&gt;0 ; i-- ) {
00195         <span class="keywordflow">if</span>( is_deleted(i) )
00196             <span class="keywordflow">continue</span>;
00197 
00198         operator[](i)-&gt;next_trimester();
00199         sys.yield();
00200     }
00201 
00202     <span class="comment">//----- select courses for the new trimester ------//</span>
00203 
00204     <span class="comment">//### fred 980916 ###//</span>
00205     <span class="comment">// select_cours() runs after next_trimester() which handle change of major and drop out//</span>
00206 
00207     <span class="comment">//select_cours();           // remove this because it should be called after enrollment</span>
00208 }
00209 
00210 <span class="comment">//----------- End of function StudentArray::next_trimester -----------//</span>
00211 
00212 <span class="comment">//--------- Begin of function StudentArray::select_course ---------//</span>
<a name="l00221"></a><a class="code" href="classStudentArray.html#a11">00221</a> <span class="comment">void StudentArray::select_course(int ignoreFaculty) {</span>
00222     <span class="comment">//-- select courses for students in various student levels based on the priority set by the user --//</span>
00223 
00224     <span class="comment">//  int studentCount = packed_size();               // 990302  BUGHERE should use size() instead</span>
00225 
00226     <span class="keywordtype">int</span> studentCount = size();                      <span class="comment">//## chea 300899 used size() instead</span>
00227     <span class="comment">//   info.debug_enroll3 = packed_size();    //## chea 270899</span>
00228 
00229     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;<a class="code" href="Ostudent_8h.html#a0">MAX_STUDENT_LEVEL</a> ; i++ ) {
00230         <span class="keywordtype">int</span> studentLevel = player_school.course_match_order[i];
00231         <span class="keywordtype">int</span> studentRecno = m.random(studentCount);
00232 
00233         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> y=0 ; y&lt;studentCount ; y++ ) {
00234             <span class="keywordflow">if</span>( ++studentRecno &gt; studentCount )
00235                 studentRecno = 1;
00236 
00237             <span class="keywordflow">if</span>( is_deleted(studentRecno) )
00238                 <span class="keywordflow">continue</span>;
00239 
00240             <a class="code" href="classStudent.html">Student</a>* studentPtr = operator[](studentRecno);
00241 
00242             <span class="keywordflow">if</span>( studentPtr-&gt;<a class="code" href="classStudent.html#m2">student_level</a> != studentLevel )
00243                 <span class="keywordflow">continue</span>;
00244 
00245             studentPtr-&gt;file_course_id=0;
00246             studentPtr-&gt;<a class="code" href="classStudent.html#a7">select_course</a>(ignoreFaculty);
00247 
00248             <span class="comment">//                  info.debug_enroll2++; //## chea 270899</span>
00249         }
00250     }
00251 
00252     <span class="comment">//--- reset counter variables after completing course selection for the trimester ---//</span>
00253 
00254     <span class="comment">// if this is the last trimester in a year, reset annual variables</span>
00255     <span class="keywordflow">if</span>( player_school.cur_trimester == <a class="code" href="Gamedef_8h.html#a80a40">LAST_TRIMESTER</a> ) {
00256         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=studentCount ; i&gt;0 ; i-- ) {
00257             <span class="keywordflow">if</span>( is_deleted(i) )
00258                 <span class="keywordflow">continue</span>;
00259 
00260             <a class="code" href="classStudent.html">Student</a>* studentPtr = operator[](i);
00261 
00262             studentPtr-&gt;<a class="code" href="classStudent.html#m13">total_elective_course_this_year</a> = 0;
00263         }
00264     }
00265 
00266 }
00267 
00268 <span class="comment">//---------- End of function StudentArray::select_course ----------//</span>
00269 
00270 <span class="comment">//--------- Begin of function StudentArray::init_course ---------//</span>
<a name="l00279"></a><a class="code" href="classStudentArray.html#a8">00279</a> <span class="comment">void StudentArray::init_course(int processYearInProgram) {</span>
00280     <a class="code" href="ALL_8H.html#a1">err_here</a>();                                     <span class="comment">// 990413---------------------------------------</span>
00281 
00282     <span class="keywordtype">int</span> studentCount = size();
00283     <span class="keywordtype">int</span> studentRecno = m.random(studentCount);
00284 
00285     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> thisTrimester=<a class="code" href="Gamedef_8h.html#a80a39">FIRST_TRIMESTER</a> ; thisTrimester&lt;=<a class="code" href="Gamedef_8h.html#a80a40">LAST_TRIMESTER</a> ; thisTrimester++ ) {
00286         <span class="comment">//---- call course_select() for all students in this department ----//</span>
00287 
00288         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;studentCount ; i++ ) {
00289             <span class="keywordflow">if</span>( ++studentRecno &gt; studentCount )
00290                 studentRecno = 1;
00291 
00292             <span class="keywordflow">if</span>( is_deleted(studentRecno) )
00293                 <span class="keywordflow">continue</span>;
00294 
00295             <a class="code" href="classStudent.html">Student</a>* studentPtr = operator[](studentRecno);
00296 
00297             <span class="comment">//----------------------------------------//</span>
00298 
00299             <span class="keywordflow">if</span>( studentPtr-&gt;<a class="code" href="classStudent.html#m6">year_in_program</a>==1 )        <span class="comment">// no need to initialize courses for students in the first year</span>
00300                 <span class="keywordflow">continue</span>;
00301 
00302             <span class="keywordflow">if</span>( studentPtr-&gt;<a class="code" href="classStudent.html#m2">student_level</a> == <a class="code" href="Ostudent_8h.html#a32a5">MASTER</a> ) { <span class="comment">// no course selection for non-matriculated. Master student only has one year, so no initialization also</span>
00303                 <span class="comment">//studentPtr-&gt;student_level == NON_MATRICULATED )               //0107</span>
00304                 <span class="keywordflow">continue</span>;
00305             }
00306 
00307             <span class="comment">//---- clip the year in program to the standard year for easy handling ----//</span>
00308 
00309             <span class="keywordtype">int</span> yearInProgram, maxYearInProgram;
00310 
00311             <span class="keywordflow">switch</span>( studentPtr-&gt;<a class="code" href="classStudent.html#m2">student_level</a> ) {
00312             <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>:
00313             <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a4">UG_NONTRADITION</a>:
00314             <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a7">DISTANCE_LEARN</a>:                      <span class="comment">// 0107</span>
00315                 maxYearInProgram = <a class="code" href="Ostudent_8h.html#a38a21">BACHELOR_YEAR_COUNT</a>;
00316                 <span class="keywordflow">break</span>;
00317 
00318             <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a6">DOCTOR</a>:
00319                 maxYearInProgram = <a class="code" href="Ostudent_8h.html#a38a23">DOCTOR_YEAR_COUNT</a>;
00320                 <span class="keywordflow">break</span>;
00321             }
00322 
00323             yearInProgram = min( studentPtr-&gt;<a class="code" href="classStudent.html#m6">year_in_program</a>, maxYearInProgram );
00324 
00325             <span class="comment">//--- only process students whose year in program is the same as processYearInProgram ---//</span>
00326 
00327             <span class="keywordflow">if</span>( yearInProgram == processYearInProgram ) {
00328                 <span class="comment">//-- if the current year_in_program exceeds the max, set it to max and restore the original later --//</span>
00329 
00330                 <span class="keywordtype">int</span> saveYearInProgram=0;
00331 
00332                 <span class="keywordflow">if</span>( studentPtr-&gt;<a class="code" href="classStudent.html#m6">year_in_program</a> &gt; maxYearInProgram ) {
00333                     saveYearInProgram = studentPtr-&gt;<a class="code" href="classStudent.html#m6">year_in_program</a>;
00334                     studentPtr-&gt;<a class="code" href="classStudent.html#m6">year_in_program</a> = maxYearInProgram;
00335                 }
00336 
00337                 <span class="comment">//----- select course now ------//</span>
00338 
00339                 studentPtr-&gt;<a class="code" href="classStudent.html#a7">select_course</a>(1);             <span class="comment">// 1-ignore faculty resource constraints.</span>
00340 
00341                 <span class="comment">//----- restore the original year in program -----//</span>
00342 
00343                 <span class="keywordflow">if</span>( saveYearInProgram )
00344                     studentPtr-&gt;<a class="code" href="classStudent.html#m6">year_in_program</a> = saveYearInProgram;
00345 
00346                 <span class="comment">//--- reset yearly counter if this is the last trimester ---//</span>
00347 
00348                 <span class="keywordflow">if</span>( thisTrimester==<a class="code" href="Gamedef_8h.html#a80a40">LAST_TRIMESTER</a> )
00349                     studentPtr-&gt;<a class="code" href="classStudent.html#m13">total_elective_course_this_year</a> = 0;
00350             }
00351         }
00352 
00353         <span class="comment">//------ reset vars for all courses in this department ------//</span>
00354 
00355         <a class="code" href="classDepartment.html">Department</a>* deptPtr = department_array[department_recno];
00356 
00357         <span class="keywordflow">for</span>( i=deptPtr-&gt;<a class="code" href="classDepartment.html#m1">course_array</a>.<a class="code" href="classDynArray.html#a28">size</a>() ; i&gt;0 ; i-- ) {
00358             deptPtr-&gt;<a class="code" href="classDepartment.html#m1">course_array</a>[i]-&gt;reset_vars();     <span class="comment">// reset it so that we can call course later selection without previous constraints.</span>
00359         }
00360     }
00361 }
00362 
00363 <span class="comment">//----------- End of function StudentArray::init_course -----------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:27 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
