<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Obutton.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Obutton.cpp</h1><a href="Obutton_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OBUTTON.CPP</span>
00002 <span class="comment">//Description : Button Object</span>
00003 
00004 <span class="preprocessor">#include &lt;<a class="code" href="KEY_8H.html">KEY.H</a>&gt;</span>
00005 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;OFONT.H&gt;</span>
00007 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00008 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00009 <span class="preprocessor">#include &lt;OAUDIO.H&gt;</span>
00010 <span class="preprocessor">#include &lt;OCONFIG.H&gt;</span>
00011 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00012 <span class="preprocessor">#include &lt;OIFACE.H&gt;</span>
00013 <span class="preprocessor">#include &lt;<a class="code" href="OIMGRES_8H.html">OIMGRES.H</a>&gt;</span>
00014 <span class="preprocessor">#include &lt;OBUTTON.H&gt;</span>
00015 
00016 <span class="comment">//----------- Begin of function Button::Button -----------//</span>
<a name="l00018"></a><a class="code" href="classButton.html#a0">00018</a> <span class="comment">Button::Button() {</span>
00019     init_flag    = 0;
00020     x1           = -1;
00021     enable_flag  = 1;
00022     button_key   = 0;                               <span class="comment">// set by set_key()</span>
00023     use_texture_flag  = 0;
00024     is_showing   = 0;
00025 
00026     help_code[0] = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00027 
00028     button_bk_bitmap=<a class="code" href="OHELP_8H.html#a0">NULL</a>;
00029     button_up_bitmap=<a class="code" href="OHELP_8H.html#a0">NULL</a>;
00030     button_dn_bitmap=<a class="code" href="OHELP_8H.html#a0">NULL</a>;
00031     font_ptr = &amp;font_san;
00032 }
00033 
00034 <span class="comment">//-------------- End of function Button::Button ----------//</span>
00035 
00036 <span class="comment">// Ho ## 1127</span>
00037 <span class="comment">// for purpose of transparency buttons</span>
00038 <span class="comment">//----------- Begin of function Button::~Button -----------//</span>
<a name="l00040"></a><a class="code" href="classButton.html#a2">00040</a> <span class="comment">void Button::deinit() {</span>
00041     <span class="keywordflow">if</span>(button_bk_bitmap!=<a class="code" href="OHELP_8H.html#a0">NULL</a>) {
00042         <a class="code" href="ALL_8H.html#a8">mem_del</a>(button_bk_bitmap);
00043         button_bk_bitmap=<a class="code" href="OHELP_8H.html#a0">NULL</a>;
00044     }
00045     <span class="keywordflow">if</span>(button_up_bitmap!=<a class="code" href="OHELP_8H.html#a0">NULL</a>) {
00046         <a class="code" href="ALL_8H.html#a8">mem_del</a>(button_up_bitmap);
00047         button_up_bitmap=<a class="code" href="OHELP_8H.html#a0">NULL</a>;
00048     }
00049     <span class="keywordflow">if</span>(button_dn_bitmap!=<a class="code" href="OHELP_8H.html#a0">NULL</a>) {
00050         <a class="code" href="ALL_8H.html#a8">mem_del</a>(button_dn_bitmap);
00051         button_dn_bitmap=<a class="code" href="OHELP_8H.html#a0">NULL</a>;
00052     }
00053 }
00054 
<a name="l00055"></a><a class="code" href="classButton.html#a1">00055</a> <a class="code" href="classButton.html#a1">Button::~Button</a>() {
00056     <a class="code" href="classButton.html#a2">deinit</a>();
00057 }
00058 
00059 <span class="comment">//-------------- End of function Button::~Button ----------//</span>
00060 
00061 <span class="comment">//-------- Begin of function Button::set_help_code -------//</span>
<a name="l00063"></a><a class="code" href="classButton.html#a9">00063</a> <span class="comment">void Button::set_help_code(char* helpCode) {</span>
00064     strncpy( help_code, helpCode, HELP_CODE_LEN );
00065 
00066     help_code[HELP_CODE_LEN] = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00067 }
00068 
00069 <span class="comment">//--------- End of function Button::set_help_code --------//</span>
00070 
00071 <span class="comment">//-------- Begin of function Button::set_font -------//</span>
<a name="l00077"></a><a class="code" href="classButton.html#a5">00077</a> <span class="comment">void Button::set_font(Font* fontPtr) {</span>
00078     <a class="code" href="ALL_8H.html#a0">err_when</a>(!fontPtr);
00079 
00080     font_ptr = fontPtr;
00081 }
00082 
00083 <span class="comment">//--------- End of function Button::set_font --------//</span>
00084 
00085 <span class="comment">//-------- Begin of function Button::create_text -------//</span>
<a name="l00104"></a><a class="code" href="classButton.html#a12">00104</a> <span class="comment">void Button::create_text(int pX1, int pY1, char* textPtr, char pElastic, char defIsPushed) {</span>
00105     <span class="keywordtype">int</span> pX2, pY2;
00106 
00107     pX2 = pX1 + font_ptr-&gt;text_width( textPtr ) + 9;
00108     pY2 = pY1 + font_ptr-&gt;height() + 7;
00109 
00110     create( <a class="code" href="Obutton_8h.html#a5a1">BUTTON_TEXT</a>,pX1,pY1,pX2,pY2,textPtr,pElastic,defIsPushed);
00111 }
00112 
00113 <span class="comment">//-------- End of function Button::create_text -----//</span>
00114 
00115 <span class="comment">//-------- Begin of function Button::paint_text -------//</span>
<a name="l00136"></a><a class="code" href="classButton.html#a13">00136</a> <span class="comment">void Button::paint_text(int pX1, int pY1, char* textPtr, char pElastic, char defIsPushed) {</span>
00137     <span class="keywordtype">int</span> pX2, pY2;
00138 
00139     pX2 = pX1 + font_ptr-&gt;text_width( textPtr ) + 9;
00140     pY2 = pY1 + font_ptr-&gt;height() + 7;
00141 
00142     create( <a class="code" href="Obutton_8h.html#a5a1">BUTTON_TEXT</a>,pX1,pY1,pX2,pY2,textPtr,pElastic,defIsPushed);
00143     paint();
00144 }
00145 
00146 <span class="comment">//-------- End of function Button::paint_text -----//</span>
00147 
00148 <span class="comment">//-------- Begin of function Button::create -------//</span>
<a name="l00168"></a><a class="code" href="classButton.html#a7">00168</a> <span class="comment">void Button::create(int buttonType, int pX1, int pY1, int pX2, int pY2,</span>
00169                     <span class="keywordtype">void</span>* bodyPtr, <span class="keywordtype">char</span> pElastic, <span class="keywordtype">char</span> defIsPushed) {
00170     <span class="keywordtype">int</span> strLen;
00171 
00172     init_flag = 1;
00173 
00174     button_type = buttonType;
00175 
00176     x1 = pX1;
00177     y1 = pY1;
00178     x2 = pX2;
00179     y2 = pY2;
00180 
00181     elastic      = pElastic;
00182     is_pushed   = defIsPushed;
00183     enable_flag = 1;
00184 
00185     <span class="comment">// Ho ## 1127</span>
00186     <span class="comment">// for purpose of transparency buttons</span>
00187     button_bk_bitmap=vga_back.save_area(
00188         x1-2,y1-2,x2+3,y2+3,button_bk_bitmap);
00189 
00190     <span class="comment">//------------------------------------//</span>
00191 
00192     <span class="keywordflow">if</span>( buttonType == <a class="code" href="Obutton_8h.html#a5a1">BUTTON_TEXT</a> ) {
00193         strLen = strlen((<span class="keywordtype">char</span>*)bodyPtr);              <span class="comment">// copy the string to class member buffer</span>
00194         <span class="comment">// some string are temporary, we need it for repaint</span>
00195         <span class="keywordflow">if</span>( strLen &gt; STR_BUF_LEN )
00196             strLen = STR_BUF_LEN;
00197 
00198         memcpy( str_buf, bodyPtr, strLen );
00199         str_buf[strLen] = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00200 
00201         <span class="comment">// Ho ## 1127</span>
00202         <span class="comment">// for purpose of transparency buttons</span>
00203         user_interface.create_button_bitmap(
00204             x1,y1,x2,y2,(<span class="keywordtype">char</span>*)bodyPtr,&amp;button_up_bitmap,
00205             &amp;button_dn_bitmap, <a class="code" href="classVga.html#p0">Vga::active_buf</a>);
00206     }
00207     <span class="keywordflow">else</span>
00208         body_ptr = bodyPtr;
00209 }
00210 
00211 <span class="comment">//--------- End of function Button::create --------//</span>
00212 
00213 <span class="comment">//-------- Begin of function Button::set_body -------//</span>
<a name="l00217"></a><a class="code" href="classButton.html#a8">00217</a> <span class="comment">void Button::set_body(void* bodyPtr) {</span>
00218     <span class="keywordflow">if</span>( button_type == <a class="code" href="Obutton_8h.html#a5a1">BUTTON_TEXT</a> ) {
00219         <span class="keywordtype">int</span> strLen = strlen((<span class="keywordtype">char</span>*)bodyPtr);          <span class="comment">// copy the string to class member buffer</span>
00220         <span class="comment">// some string are temporary, we need it for repaint</span>
00221         <span class="keywordflow">if</span>( strLen &gt; STR_BUF_LEN )
00222             strLen = STR_BUF_LEN;
00223 
00224         memcpy( str_buf, bodyPtr, strLen );
00225         str_buf[strLen] = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00226     }
00227     <span class="keywordflow">else</span>
00228         body_ptr = bodyPtr;
00229 }
00230 
00231 <span class="comment">//--------- End of function Button::set_body --------//</span>
00232 
00233 <span class="comment">//--------- Begin of function Button::hide ----------//</span>
<a name="l00241"></a><a class="code" href="classButton.html#a22">00241</a> <span class="comment">void Button::hide(char backColor) {</span>
00242     <span class="comment">//   if( init_flag )</span>
00243     <span class="comment">//   {</span>
00244     <span class="comment">//      init_flag = 0;</span>
00245     <span class="comment">//      if( x1 &gt;= 0 )        // when create() hasn't been called x1 is -1</span>
00246     <span class="comment">//                  Vga::active_buf-&gt;bar( x1,y1,x2,y2,backColor );</span>
00247     <span class="comment">//   }</span>
00248     <span class="keywordflow">if</span>(button_bk_bitmap)
00249         <a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;<a class="code" href="classVgaBuf.html#a85">put_bitmapW</a>( x1, y1, button_bk_bitmap+4);
00250 }
00251 
00252 <span class="comment">//------------ End of function Button::hide ---------//</span>
00253 
00254 <span class="comment">//--------- Begin of function Button::show ----------//</span>
<a name="l00258"></a><a class="code" href="classButton.html#a23">00258</a> <span class="comment">void Button::show() {</span>
00259     <span class="keywordflow">if</span>( !init_flag ) {
00260         init_flag = 1;
00261         paint(0, 1);
00262     }
00263 }
00264 
00265 <span class="comment">//------------ End of function Button::show ---------//</span>
00266 
00267 <span class="comment">//----------- Begin of function Button::paint -----------//</span>
<a name="l00275"></a><a class="code" href="classButton.html#a20">00275</a> <span class="comment">void Button::paint(int defIsPushed, int repaintBody) {</span>
00276     <span class="keywordflow">if</span>( !init_flag )
00277         <span class="keywordflow">return</span>;
00278     <span class="keywordtype">int</span> colorUp    = <a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;<a class="code" href="classVgaBuf.html#p3">color_up</a>;
00279     <span class="keywordtype">int</span> colorLight = <a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;<a class="code" href="classVgaBuf.html#p1">color_light</a>;
00280 
00281     <a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;<a class="code" href="classVgaBuf.html#p1">color_light</a> = (char) <a class="code" href="COLOR_8H.html#a17">V_WHITE</a>;  <span class="comment">// don't use layer colors</span>
00282 
00283     is_showing=1;
00284 
00285     mouse.hide_area( x1, y1, x2, y2 );
00286 
00287     <span class="keywordflow">if</span>( enable_flag ) {
00288         <span class="keywordflow">if</span>( defIsPushed &gt;= 0 )
00289             is_pushed = defIsPushed;
00290 
00291         <span class="keywordflow">if</span>( !is_pushed ) {
00292             <span class="comment">/*                  if( use_texture_flag )</span>
00293 <span class="comment">                                vga.d3_panel_up( x1, y1, x2, y2 );</span>
00294 <span class="comment">                                else</span>
00295 <span class="comment">                                {</span>
00296 <span class="comment">                                Vga::active_buf-&gt;color_up  = Vga::active_buf-&gt;color_down;</span>
00297 <span class="comment">                                Vga::active_buf-&gt;d3_panel_up( x1, y1, x2, y2, 1, repaintBody || button_type==1 );</span>
00298 <span class="comment">                                }</span>
00299 <span class="comment">            */</span>
00300         }    
00301         <span class="keywordflow">else</span> {
00302             <span class="comment">/*                  if( use_texture_flag )</span>
00303 <span class="comment">                                {</span>
00304 <span class="comment">                                vga.d3_panel_down( x1, y1, x2, y2 );</span>
00305 <span class="comment">                                }</span>
00306 <span class="comment">                                else</span>
00307 <span class="comment">                                {</span>
00308 <span class="comment">                                if( repaintBody || button_type==1 )      // text button</span>
00309 <span class="comment">                                Vga::active_buf-&gt;d3_panel_up( x1, y1, x2, y2, 2 );</span>
00310 <span class="comment"></span>
00311 <span class="comment">                                Vga::active_buf-&gt;d3_panel_down( x1,y1,x2,y2, 1, 0 );</span>
00312 <span class="comment">                                }</span>
00313 <span class="comment">            */</span>
00314         }     
00315     }
00316     <span class="keywordflow">else</span> {                                          <span class="comment">// button disabled</span>
00317         <a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;<a class="code" href="classVgaBuf.html#p3">color_up</a> = <a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;<a class="code" href="classVgaBuf.html#p3">color_up</a>+1;
00318         <a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;<a class="code" href="classVgaBuf.html#a41">d3_panel_up</a>( x1, y1, x2, y2, 1, repaintBody );
00319     }
00320 
00321     <a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;<a class="code" href="classVgaBuf.html#p3">color_up</a>    = colorUp;
00322     <a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;<a class="code" href="classVgaBuf.html#p1">color_light</a> = colorLight;
00323 
00324     <span class="comment">//--------- put button body -------------//</span>
00325 
00326     <span class="keywordflow">if</span>( button_type == <a class="code" href="Obutton_8h.html#a5a1">BUTTON_TEXT</a> ) {              <span class="comment">// text button</span>
00327         <span class="comment">//              int tx = x1 + ((x2-x1) - font_ptr-&gt;text_width(str_buf))/2;</span>
00328         <span class="comment">//              int ty = y1 + ((y2-y1) - font_ptr-&gt;height())/2 - 1;</span>
00329 
00330         <span class="comment">//              tx = max( tx, x1+4 );</span>
00331         <span class="comment">//              ty = max( ty, y1+1 );</span>
00332 
00333         <span class="comment">// Ho ## 1127</span>
00334         <span class="comment">// for purpose of transparency buttons</span>
00335         <span class="keywordflow">if</span>(is_pushed||!enable_flag)
00336             <a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;<a class="code" href="classVgaBuf.html#a85">put_bitmapW</a>( x1, y1, button_dn_bitmap+4 );
00337         <span class="keywordflow">else</span>
00338             <a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;<a class="code" href="classVgaBuf.html#a85">put_bitmapW</a>( x1, y1, button_up_bitmap+4 );
00339 
00340         <span class="comment">//              font_ptr-&gt;put( tx, ty, str_buf, 0, x2-3 );</span>
00341     }
00342 
00343     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( button_type == <a class="code" href="Obutton_8h.html#a5a2">BUTTON_BITMAP</a> ) {
00344         <span class="keywordflow">if</span>( body_ptr &amp;&amp; repaintBody ) {
00345             <span class="keywordtype">int</span> tx = x1 + ((x2-x1+1) - *((<span class="keywordtype">short</span>*)body_ptr))/2;
00346             <span class="keywordtype">int</span> ty = y1 + ((y2-y1+1) - *((<span class="keywordtype">short</span>*)body_ptr+1))/2;
00347 
00348             <span class="comment">// 0 means not clear background</span>
00349             <a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;<a class="code" href="classVgaBuf.html#a57">put_bitmap</a>( tx, ty, (<span class="keywordtype">char</span>*) body_ptr );
00350         }
00351     }
00352 
00353     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( button_type == <a class="code" href="Obutton_8h.html#a5a4">BUTTON_BITMAPW</a> ) {
00354         <span class="comment">//              if( enable_flag )</span>
00355         <span class="keywordflow">if</span> ( body_ptr &amp;&amp; repaintBody) {
00356             <span class="comment">//                          int tx = x1 + ((x2-x1+1) - *((short*)body_ptr))/2;</span>
00357             <span class="comment">//                          int ty = y1 + ((y2-y1+1) - *((short*)body_ptr+1))/2;</span>
00358             <span class="comment">// 0 means not clear background</span>
00359             <a class="code" href="classVga.html#p0">Vga::active_buf</a>-&gt;<a class="code" href="classVgaBuf.html#a85">put_bitmapW</a>( x1, y1, (<span class="keywordtype">short</span>*) body_ptr );
00360         }
00361         <span class="comment">//              if( !enable_flag )</span>
00362         <span class="comment">//                      user_interface.darken( x1, y1, x2-2, y2-2 );</span>
00363     }
00364 
00365     <span class="keywordflow">else</span> {                                          <span class="comment">// BUTTON_UDF, user defined function</span>
00366         <span class="keywordflow">if</span>( body_ptr )
00367             (*((<a class="code" href="Obutton_8h.html#a0">ButtonFP</a>*)body_ptr))(x1+3,x2+3,y1-3,y2-3);
00368     }
00369 
00370     <span class="keywordflow">if</span>(is_pushed || !enable_flag)
00371         user_interface.darken( x1+2, y1+2, x2-2, y2-2 );
00372 
00373     <span class="keywordflow">if</span>(is_pushed)
00374         user_interface.darken( x1+2, y1+2, x2-2, y2-2 );
00375 
00376     mouse.show_area();
00377 
00378     sys.yield();                                    <span class="comment">// chwg032799</span>
00379 }
00380 
00381 <span class="comment">//---------- End of function Button::paint -----------//</span>
00382 
00383 <span class="comment">//-------- Begin of function Button::detect -----------//</span>
<a name="l00406"></a><a class="code" href="classButton.html#a21">00406</a> <span class="comment">int Button::detect(unsigned keyCode1, unsigned keyCode2, int detectRight, int suspendPop) {</span>
00407     <span class="keywordtype">int</span> rc=0;
00408 
00409     <span class="keywordflow">if</span>( !init_flag || !enable_flag )
00410         <span class="keywordflow">return</span> 0;
00411 
00412     <span class="comment">//  help.set_help( x1, y1, x2, y2, help_code );</span>
00413 
00414     <span class="comment">// ##### begin Gilbert 23/04/2001 ######//</span>
00415     <span class="comment">//   if( mouse.press_area(x1,y1,x2,y2,LEFT_BUTTON) )</span>
00416     <span class="comment">//   if( mouse.single_click(x1,y1,x2,y2,LEFT_BUTTON) )</span>
00417     <span class="keywordflow">if</span>( mouse.any_click(x1,y1,x2,y2,<a class="code" href="Omouse_8h.html#a28a22">LEFT_BUTTON</a>) )
00418         rc=1;
00419 
00420     <span class="comment">//   else if( detectRight &amp;&amp; mouse.press_area(x1,y1,x2,y2,RIGHT_BUTTON) )</span>
00421     <span class="comment">//   else if( detectRight &amp;&amp; mouse.single_click(x1,y1,x2,y2,RIGHT_BUTTON) )</span>
00422     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( detectRight &amp;&amp; mouse.any_click(x1,y1,x2,y2,<a class="code" href="Omouse_8h.html#a28a23">RIGHT_BUTTON</a>) )
00423         rc=2;
00424     <span class="comment">// ##### end Gilbert 23/04/2001 ######//</span>
00425 
00426     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(mouse.key_code) {
00427         <span class="keywordtype">unsigned</span> mouseKey=mouse.key_code;
00428 
00429         <span class="keywordflow">if</span>( mouseKey &gt;= <span class="charliteral">'a'</span> &amp;&amp; mouseKey &lt;= <span class="charliteral">'z'</span> )      <span class="comment">// non-case sensitive comparsion</span>
00430             mouseKey -= 32;                             <span class="comment">// convert from lower case to upper case</span>
00431 
00432         <span class="keywordflow">if</span>( mouseKey == keyCode1 || mouseKey == keyCode2 || mouseKey == button_key ) {
00433             rc=3;
00434         }
00435     }
00436 
00437     <span class="keywordflow">if</span>( !rc )
00438         <span class="keywordflow">return</span> 0;
00439 
00440     <span class="keywordflow">if</span>(!is_showing)
00441         <span class="keywordflow">return</span> rc;
00442     <span class="comment">//----- paint the button with pressed shape ------//</span>
00443 
00444 <span class="preprocessor">#define PRESSED_TIMEOUT_SECONDS  1              // 1 seconds</span>
00445 <span class="preprocessor"></span>    DWORD timeOutTime = m.get_time()+PRESSED_TIMEOUT_SECONDS*1000;
00446 
00447     <span class="keywordtype">char</span> reset_back=!vga.use_back_buf;
00448     vga.use_front();                                <span class="comment">// ## chwong 1230</span>
00449 
00450     <span class="keywordflow">if</span>( elastic ) {
00451         <span class="keywordflow">if</span>( !is_pushed )
00452             paint(1,0);                                 <span class="comment">// 0-no need to repaint button body (text or icon)</span>
00453 
00454         <span class="keywordflow">while</span>( (rc==1 &amp;&amp; mouse.left_press) || (rc==2 &amp;&amp; mouse.right_press) ) {
00455             sys.yield();
00456             mouse.get_event();
00457 
00458             <span class="keywordflow">if</span>( m.get_time() &gt;= timeOutTime )
00459                 <span class="keywordflow">break</span>;
00460         }
00461         audio.play_wav(<span class="stringliteral">"BEEPS-1"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00462         is_pushed=0;
00463         <span class="comment">//  ignore by chwg1230</span>
00464         <span class="comment">//              if( elastic )</span>
00465         <span class="comment">//                      paint(0,0);</span>
00466     }
00467     <span class="keywordflow">else</span> {                                          <span class="comment">// inelastic button</span>
00468         <span class="keywordflow">if</span>( suspendPop )
00469             is_pushed = 1;
00470         <span class="keywordflow">else</span>
00471             is_pushed = !is_pushed;
00472 
00473         paint(is_pushed,0);
00474 
00475         <span class="keywordflow">while</span>( (rc==1 &amp;&amp; mouse.left_press) || (rc==2 &amp;&amp; mouse.right_press) ) {
00476             sys.yield();
00477             mouse.get_event();
00478 
00479             <span class="keywordflow">if</span>( m.get_time() &gt;= timeOutTime )
00480                 <span class="keywordflow">break</span>;
00481         }
00482         audio.play_wav(<span class="stringliteral">"BEEPS-1"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00483     }
00484     <span class="keywordflow">if</span>(reset_back)vga.use_back();                   <span class="comment">// ## chwong 1230</span>
00485     <span class="keywordflow">return</span> rc;
00486 }
00487 
00488 <span class="comment">//----------- End of function Button::detect -------------//</span>
00489 
00490 <span class="comment">//--------- Begin of function Button::wait_press ----------//</span>
<a name="l00498"></a><a class="code" href="classButton.html#a28">00498</a> <span class="comment">void Button::wait_press(int timeOut) {</span>
00499 <span class="preprocessor">#define INACTIVE_TIMEOUT_SECONDS  10            // 10 seconds</span>
00500 <span class="preprocessor"></span>
00501     <span class="keywordtype">int</span>   lastMouseX= -1, lastMouseY;
00502     DWORD timeOutTime = m.get_time()+INACTIVE_TIMEOUT_SECONDS*1000;
00503 
00504     mouse.get_event();                              <span class="comment">// clean up previous mouse events</span>
00505 
00506     <span class="comment">// 1-only right mouse button</span>
00507     <span class="keywordflow">while</span>( !detect(<a class="code" href="KEY_8H.html#a3">KEY_RETURN</a>,<a class="code" href="KEY_8H.html#a2">KEY_ESC</a>) &amp;&amp; !mouse.single_click(1) ) {
00508         sys.yield();
00509         mouse.get_event();
00510         sys.blt_virtual_buf();
00511 
00512         <span class="comment">//--- when the user is inactive for a certain time, ----//</span>
00513         <span class="comment">//--------- close the report automatically -------------//</span>
00514 
00515         <span class="keywordflow">if</span>( timeOut ) {
00516             <span class="keywordflow">if</span>( lastMouseX == mouse.cur_x &amp;&amp; lastMouseY == mouse.cur_y ) {
00517                 <span class="keywordflow">if</span>( m.get_time() &gt;= timeOutTime )
00518                     <span class="keywordflow">break</span>;
00519             }
00520             <span class="keywordflow">else</span> {
00521                 lastMouseX  = mouse.cur_x;
00522                 lastMouseY  = mouse.cur_y;
00523                 timeOutTime = m.get_time()+INACTIVE_TIMEOUT_SECONDS*1000;
00524             }
00525         }
00526     }
00527 }
00528 
00529 <span class="comment">//----------- End of function Button::wait_press ----------//</span>
00530 
00531 <span class="comment">//.........................................................//</span>
00532 
00533 <span class="comment">//-------- Begin of function ButtonGroup::ButtonGroup -------//</span>
00534 
<a name="l00535"></a><a class="code" href="classButtonGroup.html#a0">00535</a> <a class="code" href="classButtonGroup.html#a0">ButtonGroup::ButtonGroup</a>(<span class="keywordtype">int</span> buttonNum) {
00536     <a class="code" href="classButtonGroup.html#m1">button_pressed</a> = 0;
00537     <a class="code" href="classButtonGroup.html#m0">button_num</a>     = buttonNum;
00538     <a class="code" href="classButtonGroup.html#m2">button_array</a>   = <span class="keyword">new</span> <a class="code" href="classButton.html">Button</a>[buttonNum];
00539 }
00540 
00541 <span class="comment">//---------- End of function ButtonGroup::ButtonGroup -------//</span>
00542 
00543 <span class="comment">//----------- Begin of function ButtonGroup::~ButtonGroup -----------//</span>
<a name="l00545"></a><a class="code" href="classButtonGroup.html#a1">00545</a> <span class="comment">ButtonGroup::~ButtonGroup() {</span>
00546     <span class="keyword">delete</span>[] button_array;
00547     <span class="comment">// ###### begin Gilbert 27/04/2001 #######//</span>
00548     button_array   = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00549     button_num = 0;
00550     <span class="comment">// ###### end Gilbert 27/04/2001 #######//</span>
00551 }
00552 
00553 <span class="comment">//-------------- End of function ButtonGroup::~ButtonGroup ----------//</span>
00554 
00555 <span class="comment">// ###### begin Gilbert 27/04/2001 #######//</span>
00556 <span class="comment">// ---------- Begin of function ButtonGroup::deinit_buttons -------//</span>
00557 <span class="comment">//call deinit to each button</span>
<a name="l00558"></a><a class="code" href="classButtonGroup.html#a2">00558</a> <span class="keywordtype">void</span> <a class="code" href="classButtonGroup.html#a2">ButtonGroup::deinit_buttons</a>() {
00559     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = <a class="code" href="classButtonGroup.html#m0">button_num</a>-1; i &gt;= 0; --i ) {
00560         <a class="code" href="classButtonGroup.html#m2">button_array</a>[i].<a class="code" href="classButton.html#a2">deinit</a>();
00561     }
00562 }
00563 
00564 <span class="comment">// ---------- End of function ButtonGroup::deinit_buttons -------//</span>
00565 <span class="comment">// ###### end Gilbert 27/04/2001 #######//</span>
00566 
00567 <span class="comment">//--------- Begin of function ButtonGroup::paint ----------//</span>
<a name="l00574"></a><a class="code" href="classButtonGroup.html#a3">00574</a> <span class="comment">void ButtonGroup::paint(int buttonPressed) {</span>
00575     <span class="keywordtype">int</span> i;
00576 
00577     <span class="comment">//   if( buttonPressed &gt;= 0 )</span>
00578     <span class="comment">//     button_pressed = buttonPressed;</span>
00579 
00580     button_pressed = buttonPressed;                 <span class="comment">// ## chwg 1015</span>
00581     <span class="keywordflow">for</span>( i=0 ; i&lt;button_num ; i++ )
00582         button_array[i].paint(button_pressed==i);
00583 }
00584 
00585 <span class="comment">//----------- End of function ButtonGroup::paint ----------//</span>
00586 
00587 <span class="comment">//--------- Begin of function ButtonGroup::detect ----------//</span>
<a name="l00597"></a><a class="code" href="classButtonGroup.html#a4">00597</a> <span class="comment">int ButtonGroup::detect() {</span>
00598     <span class="keywordtype">int</span> i;
00599 
00600     <span class="keywordflow">for</span>( i=0 ; i&lt;button_num ; i++ ) {
00601         <span class="keywordflow">if</span>( !button_array[i].is_pushed &amp;&amp; button_array[i].detect() ) {
00602             <span class="keywordflow">if</span>(button_pressed&gt;=0)                       <span class="comment">//##chwg1015</span>
00603                 button_array[button_pressed].pop();
00604             button_pressed = i;
00605             <span class="keywordflow">return</span> i;
00606         }
00607     }
00608     <span class="keywordflow">return</span> -1;
00609 }
00610 
00611 <span class="comment">//----------- End of function ButtonGroup::detect ----------//</span>
00612 
00613 <span class="comment">//--------- Begin of function ButtonGroup::push ----------//</span>
<a name="l00619"></a><a class="code" href="classButtonGroup.html#a5">00619</a> <span class="comment">void ButtonGroup::push(int buttonId) {</span>
00620     <span class="keywordtype">int</span> i;
00621 
00622     button_pressed = buttonId;
00623 
00624     <span class="keywordflow">for</span>( i=0 ; i&lt;button_num ; i++ ) {
00625         <span class="keywordflow">if</span>( i==buttonId )
00626             button_array[i].push();
00627         <span class="keywordflow">else</span>
00628             button_array[i].pop();
00629     }
00630 }
00631 
00632 <span class="comment">//----------- End of function ButtonGroup::push ----------//</span>
00633 
00634 <span class="comment">//--------- Begin of function ButtonGroup::operator[] ----------//</span>
<a name="l00638"></a><a class="code" href="classButtonGroup.html#a6">00638</a> <span class="comment">Button&amp; ButtonGroup::operator[](int buttonId) {</span>
00639     <a class="code" href="ALL_8H.html#a0">err_when</a>( buttonId&lt;0 || buttonId &gt;= button_num );
00640 
00641     <span class="keywordflow">return</span> button_array[buttonId];
00642 }
00643 
00644 <span class="comment">//----------- End of function ButtonGroup::operator[] ----------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:16 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
