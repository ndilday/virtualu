<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OSPRITEA.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>OSPRITEA.CPP</h1><a href="OSPRITEA_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OSPRITEA.CPP</span>
00002 <span class="comment">//Description : Object SpriteArray</span>
00003 <span class="comment">//Owner       : Fred</span>
00004 
00005 <span class="comment">//#include &lt;ALL.H&gt;</span>
00006 <span class="comment">//#include &lt;OVGA.H&gt;</span>
00007 <span class="comment">//#include &lt;OSTR.H&gt;</span>
00008 <span class="comment">//#include &lt;OSYS.H&gt;</span>
00009 <span class="comment">//#include &lt;OSPRTRES.H&gt;</span>
00010 <span class="preprocessor">#include &lt;<a class="code" href="OSPRITE_8H.html">OSPRITE.H</a>&gt;</span>
00011 <span class="preprocessor">#include &lt;<a class="code" href="OSPRITEA_8H.html">OSPRITEA.H</a>&gt;</span>
00012 <span class="comment">//#include &lt;OUNIT.H&gt;</span>
00013 
00014 <span class="comment">/*#ifdef DEBUG</span>
00015 <span class="comment">#include &lt;OBULLET.H&gt;</span>
00016 <span class="comment">#include &lt;OTORNADO.H&gt;</span>
00017 <span class="comment"></span>
00018 <span class="comment">static int num_of_unit;</span>
00019 <span class="comment">#endif*/</span>
00020 
00021 <span class="comment">//--------- Begin of function SpriteArray::SpriteArray ---------//</span>
<a name="l00024"></a><a class="code" href="classSpriteArray.html#a0">00024</a> <span class="comment">SpriteArray::SpriteArray(int initArraySize) : DynArrayB(sizeof(Sprite*),initArraySize, DEFAULT_REUSE_INTERVAL_DAYS) {</span>
00025 }
00026 
00027 <span class="comment">//----------- End of function SpriteArray::SpriteArray ---------//</span>
00028 
00029 <span class="comment">//--------- Begin of function SpriteArray::~SpriteArray ---------//</span>
<a name="l00030"></a><a class="code" href="classSpriteArray.html#a1">00030</a> <a class="code" href="classSpriteArray.html#a1">SpriteArray::~SpriteArray</a>() {
00031     <a class="code" href="classSpriteArray.html#a3">deinit</a>();
00032 }
00033 
00034 <span class="comment">//----------- End of function SpriteArray::~SpriteArray ---------//</span>
00035 
00036 <span class="comment">//--------- Begin of function SpriteArray::init ---------//</span>
<a name="l00037"></a><a class="code" href="classSpriteArray.html#a2">00037</a> <span class="keywordtype">void</span> <a class="code" href="classSpriteArray.html#a2">SpriteArray::init</a>() {
00038     <a class="code" href="classSpriteArray.html#m0">restart_recno</a> = 1;
00039 }
00040 
00041 <span class="comment">//----------- End of function SpriteArray::init ---------//</span>
00042 
00043 <span class="comment">//--------- Begin of function SpriteArray::deinit ---------//</span>
<a name="l00051"></a><a class="code" href="classSpriteArray.html#a3">00051</a> <span class="comment">void SpriteArray::deinit() {</span>
00052     <span class="keywordflow">if</span>( size()==0 )
00053         <span class="keywordflow">return</span>;
00054 
00055     <span class="comment">//----- delete sprite objects ------//</span>
00056 
00057     <a class="code" href="classSprite.html">Sprite</a>* emptyPtr = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00058     <a class="code" href="classSprite.html">Sprite</a>* spritePtr;
00059 
00060     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=1 ; i&lt;=size() ; i++ ) {
00061         spritePtr = (<a class="code" href="classSprite.html">Sprite</a>*) get_ptr(i);
00062 
00063         <span class="keywordflow">if</span>( spritePtr )
00064             <span class="keyword">delete</span> spritePtr;
00065 
00066         update( &amp;emptyPtr, i );                       <span class="comment">// set the pointer in SpriteArray to NULL, so is_deleted() can return correct result, this is needed as Unit::deinit() will call is_deleted()</span>
00067     }
00068 
00069     <span class="comment">//-------- zap the array -----------//</span>
00070 
00071     zap();
00072 }
00073 
00074 <span class="comment">//----------- End of function SpriteArray::deinit ---------//</span>
00075 
00076 <span class="comment">//--------- Begin of function SpriteArray::add ---------//</span>
<a name="l00077"></a><a class="code" href="classSpriteArray.html#a4">00077</a> <span class="keywordtype">void</span> <a class="code" href="classSpriteArray.html#a4">SpriteArray::add</a>(<a class="code" href="classSprite.html">Sprite</a> *newSprite) {
00078     <a class="code" href="classDynArrayB.html#a4">linkin</a>(&amp;newSprite);
00079 
00080     newSprite-&gt;<a class="code" href="classSprite.html#m1">sprite_recno</a> = <a class="code" href="classDynArray.html#a27">recno</a>();
00081 }
00082 
00083 <span class="comment">//----------- End of function SpriteArray::add -----------//</span>
00084 
00085 <span class="comment">//--------- Begin of function SpriteArray::add_sorted ---------//</span>
<a name="l00095"></a><a class="code" href="classSpriteArray.html#a5">00095</a> <span class="comment">void SpriteArray::add_sorted(Sprite *newSprite) {</span>
00096     <span class="comment">/*</span>
00097 <span class="comment">      int l=0, r=size(), x=0;</span>
00098 <span class="comment">      int addY  = newSprite-&gt;abs_y2;</span>
00099 <span class="comment">      int testY = addY + 1;</span>
00100 <span class="comment"></span>
00101 <span class="comment">      //---------------------------------------------------------------------//</span>
00102 <span class="comment">      // Use a binary search to find the right location to add the new sprite.</span>
00103 <span class="comment">      //---------------------------------------------------------------------//</span>
00104 <span class="comment"></span>
00105 <span class="comment">      while (r &gt; l)</span>
00106 <span class="comment">      {</span>
00107 <span class="comment">      x = (l + r) / 2;</span>
00108 <span class="comment"></span>
00109 <span class="comment">      testY = operator[](x+1)-&gt;abs_y2;   // the one to be compared with the adding one.</span>
00110 <span class="comment"></span>
00111 <span class="comment">      if (addY &lt; testY)</span>
00112 <span class="comment">      r = x;</span>
00113 <span class="comment">      else</span>
00114 <span class="comment">      l = x + 1;</span>
00115 <span class="comment"></span>
00116 <span class="comment">      if (addY == testY)</span>
00117 <span class="comment">      break;</span>
00118 <span class="comment">      }</span>
00119 <span class="comment"></span>
00120 <span class="comment">      if (addY &gt;= testY)</span>
00121 <span class="comment">      x++;</span>
00122 <span class="comment"></span>
00123 <span class="comment">      insert_at(x+1, &amp;newSprite);</span>
00124 <span class="comment">    */</span>
00125 }
00126 
00127 <span class="comment">//----------- End of function SpriteArray::add_sorted -----------//</span>
00128 
00129 <span class="comment">//--------- Begin of function SpriteArray::del ---------//</span>
<a name="l00130"></a><a class="code" href="classSpriteArray.html#a6">00130</a> <span class="keywordtype">void</span> <a class="code" href="classSpriteArray.html#a6">SpriteArray::del</a>(<span class="keywordtype">int</span> recNo) {
00131     <a class="code" href="classSprite.html">Sprite</a>* spritePtr = (<a class="code" href="classSprite.html">Sprite</a>*) <a class="code" href="classDynArray.html#a15">get_ptr</a>(recNo);
00132 
00133     <a class="code" href="ALL_8H.html#a0">err_when</a>( !spritePtr );
00134 
00135     <span class="keyword">delete</span> spritePtr;
00136 
00137     <a class="code" href="classDynArrayB.html#a5">linkout</a>(recNo);
00138 }
00139 
00140 <span class="comment">//----------- End of function SpriteArray::del -----------//</span>
00141 
00142 <span class="comment">//--------- Begin of function SpriteArray::process ---------//</span>
<a name="l00143"></a><a class="code" href="classSpriteArray.html#a7">00143</a> <span class="keywordtype">void</span> <a class="code" href="classSpriteArray.html#a7">SpriteArray::process</a>() {
00144     <a class="code" href="classSprite.html">Sprite</a>* spritePtr;
00145     <span class="keywordtype">int</span> i;
00146     <span class="keywordtype">int</span> arraySize = <a class="code" href="classDynArray.html#a28">size</a>();
00147 
00148     <span class="keywordflow">for</span> ( i=1; i&lt;=arraySize; i++) {
00149         spritePtr = (<a class="code" href="classSprite.html">Sprite</a> *) <a class="code" href="classDynArray.html#a15">get_ptr</a>(i);
00150         spritePtr-&gt;<a class="code" href="classSprite.html#a6">process</a>();
00151     }
00152 }
00153 
00154 <span class="comment">//----------- End of function SpriteArray::process -----------//</span>
00155 
00156 <span class="comment">//------- Begin of function SpriteArray::operator[] -----//</span>
00157 <span class="preprocessor">#ifdef DEBUG</span>
00158 <span class="preprocessor"></span><a class="code" href="classSprite.html">Sprite</a>* <a class="code" href="classSpriteArray.html#a8">SpriteArray::operator[]</a>(<span class="keywordtype">int</span> recNo) {
00159     <a class="code" href="classSprite.html">Sprite</a>* spritePtr = (<a class="code" href="classSprite.html">Sprite</a>*) <a class="code" href="classDynArray.html#a15">get_ptr</a>(recNo);
00160 
00161     <span class="keywordflow">if</span>( !spritePtr )
00162         err.run( <span class="stringliteral">"SpriteArray[] is deleted"</span> );
00163 
00164     <span class="keywordflow">return</span> spritePtr;
00165 }
00166 <span class="preprocessor">#endif</span>
00167 <span class="preprocessor"></span><span class="comment">//--------- End of function SpriteArray::operator[] ----//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:23 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
