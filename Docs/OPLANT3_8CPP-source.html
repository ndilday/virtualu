<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OPLANT3.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>OPLANT3.CPP</h1><a href="OPLANT3_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OPLANT.CPP</span>
00002 <span class="comment">//Description : Plant resource object</span>
00003 <span class="comment">//Owner       : Gilbert</span>
00004 
00005 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00006 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00007 <span class="preprocessor">#include &lt;<a class="code" href="OGAMESET_8H.html">OGAMESET.H</a>&gt;</span>
00008 <span class="preprocessor">#include &lt;<a class="code" href="OWORLD_8H.html">OWORLD.H</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;<a class="code" href="OTERRAIN_8H.html">OTERRAIN.H</a>&gt;</span>
00010 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>
00011 <span class="preprocessor">#include &lt;<a class="code" href="OPLANT_8H.html">OPLANT.H</a>&gt;</span>
00012 <span class="preprocessor">#include &lt;OCONFIG.H&gt;</span>
00013 <span class="preprocessor">#include &lt;OWORLDMT.H&gt;</span>
00014 <span class="preprocessor">#include &lt;<a class="code" href="OCOLTBL_8H.html">OCOLTBL.H</a>&gt;</span>
00015 <span class="preprocessor">#include &lt;<a class="code" href="OBITMAP_8H.html">OBITMAP.H</a>&gt;</span>
00016 
00017 <span class="comment">//---------- #define constant ------------//</span>
00018 
00019 <span class="comment">//#define PLANT_DB              "PLANT"</span>
00020 <span class="comment">//#define PLANT_BITMAP_DB "PLANTBMP"</span>
00021 
00022 <span class="comment">//------- Begin of function PlantRes::PlantRes -----------//</span>
00023 
00024 <a class="code" href="classPlantRes.html#a0">PlantRes::PlantRes</a>() {
00025     init_flag=0;
00026 }
00027 
00028 <span class="comment">//--------- End of function PlantRes::PlantRes -----------//</span>
00029 
00030 <span class="comment">//---------- Begin of function PlantRes::init -----------//</span>
00034 <span class="comment">void PlantRes::init() {</span>
00035     deinit();
00036 
00037     <span class="comment">//----- open plant material bitmap resource file -------//</span>
00038 
00039     <a class="code" href="classString.html">String</a> str;
00040 
00041     str  = <a class="code" href="Gamedef_8h.html#a4">DIR_RES</a>;
00042     <span class="comment">// str += "I_PLANT.RES";</span>
00043     str += <span class="stringliteral">"I_PLANT"</span>;
00044     str += config.terrain_set;
00045     str += <span class="stringliteral">".RES"</span>;
00046 
00047     res_bitmap.init_imported(str,1);                <span class="comment">// 1-read all into buffer</span>
00048 
00049     <span class="comment">//------- load database information --------//</span>
00050 
00051     load_plant_info();
00052     load_plant_bitmap();
00053 
00054     <span class="comment">// ##### begin Gilbert 15/10 ########//</span>
00055     plant_map_color = (char) V_DARK_GREEN;
00056     <span class="comment">// ##### end Gilbert 15/10 ########//</span>
00057 
00058     init_flag=1;
00059 }
00060 
00061 <span class="comment">//---------- End of function PlantRes::init -----------//</span>
00062 
00063 <span class="comment">//---------- Begin of function PlantRes::deinit -----------//</span>
00064 
00065 <span class="keywordtype">void</span> <a class="code" href="classPlantRes.html#a3">PlantRes::deinit</a>() {
00066     <span class="keywordflow">if</span>( init_flag ) {
00067         <a class="code" href="ALL_8H.html#a8">mem_del</a>(plant_info_array);
00068         <a class="code" href="ALL_8H.html#a8">mem_del</a>(plant_bitmap_array);
00069         <a class="code" href="ALL_8H.html#a8">mem_del</a>(scan_id_array);
00070         init_flag=0;
00071     }
00072 }
00073 
00074 <span class="comment">//---------- End of function PlantRes::deinit -----------//</span>
00075 
00076 <span class="comment">//------- Begin of function PlantRes::load_plant_info -------//</span>
00078 <span class="comment">void PlantRes::load_plant_info() {</span>
00079     <a class="code" href="structPlantRec.html">PlantRec</a>     *plantRec;
00080     <a class="code" href="structPlantInfo.html">PlantInfo</a>    *plantInfo;
00081     <span class="keywordtype">int</span>        i;
00082 
00083     <span class="comment">//---- read in plant count and initialize plant info array ----//</span>
00084 
00085     <a class="code" href="classString.html">String</a> plantDbName;
00086     plantDbName = <a class="code" href="Gamedef_8h.html#a4">DIR_RES</a>;
00087     plantDbName += <span class="stringliteral">"PLANT"</span>;
00088     plantDbName += config.terrain_set;
00089     plantDbName += <span class="stringliteral">".RES"</span>;
00090     <a class="code" href="classDatabase.html">Database</a> plantDbObj(plantDbName, 1);
00091     <span class="comment">// Database *dbPlant = game_set.open_db(PLANT_DB);</span>
00092     <a class="code" href="classDatabase.html">Database</a> *dbPlant = &amp;plantDbObj;
00093 
00094     plant_count      = (short) dbPlant-&gt;<a class="code" href="classDatabase.html#a7">rec_count</a>();
00095     plant_info_array = (<a class="code" href="structPlantInfo.html">PlantInfo</a>*) <a class="code" href="ALL_8H.html#a5">mem_add</a>( <span class="keyword">sizeof</span>(<a class="code" href="structPlantInfo.html">PlantInfo</a>)*plant_count );
00096 
00097     memset( plant_info_array, 0, <span class="keyword">sizeof</span>(<a class="code" href="structPlantInfo.html">PlantInfo</a>) * plant_count );
00098 
00099     <span class="comment">//---------- read in PLANT.DBF ---------//</span>
00100 
00101     <span class="keywordflow">for</span>( i=0 ; i&lt;plant_count ; i++ ) {
00102         plantRec  = (<a class="code" href="structPlantRec.html">PlantRec</a>*) dbPlant-&gt;<a class="code" href="classDatabase.html#a4">read</a>(i+1);
00103         plantInfo = plant_info_array+i;
00104 
00105         m.rtrim_fld( plantInfo-&gt;<a class="code" href="structPlantInfo.html#m2">code</a>, plantRec-&gt;<a class="code" href="structPlantRec.html#m1">code</a>, plantRec-&gt;<a class="code" href="structPlantRec.html#s7s1">CODE_LEN</a> );
00106         plantInfo-&gt;<a class="code" href="structPlantInfo.html#m3">climate_zone</a> = m.atoi( plantRec-&gt;<a class="code" href="structPlantRec.html#m2">climate_zone</a>, plantRec-&gt;<a class="code" href="structPlantRec.html#s7s2">ZONE_LEN</a> );
00107 
00108         <span class="keywordflow">if</span>( plantRec-&gt;<a class="code" href="structPlantRec.html#m3">tera_type1</a>[0] == <span class="charliteral">'T'</span> ) {        <span class="comment">// town plant</span>
00109             plantInfo-&gt;<a class="code" href="structPlantInfo.html#m4">tera_type</a>[0] = <span class="charliteral">'T'</span>;
00110         }
00111         <span class="keywordflow">else</span> {
00112             <span class="keywordflow">if</span>(plantRec-&gt;<a class="code" href="structPlantRec.html#m3">tera_type1</a>[0] != <span class="charliteral">' '</span>)
00113                 plantInfo-&gt;<a class="code" href="structPlantInfo.html#m4">tera_type</a>[0] = terrain_res.get_tera_type_id( plantRec-&gt;<a class="code" href="structPlantRec.html#m3">tera_type1</a> );
00114             <span class="keywordflow">else</span>
00115                 plantInfo-&gt;<a class="code" href="structPlantInfo.html#m4">tera_type</a>[0] = 0;
00116         }
00117 
00118         <span class="keywordflow">if</span>( plantRec-&gt;<a class="code" href="structPlantRec.html#m4">tera_type2</a>[0] == <span class="charliteral">'T'</span> ) {        <span class="comment">// town plant</span>
00119             plantInfo-&gt;<a class="code" href="structPlantInfo.html#m4">tera_type</a>[1] = <span class="charliteral">'T'</span>;
00120         }
00121         <span class="keywordflow">else</span> {
00122             <span class="keywordflow">if</span>(plantRec-&gt;<a class="code" href="structPlantRec.html#m4">tera_type2</a>[0] != <span class="charliteral">' '</span>)
00123                 plantInfo-&gt;<a class="code" href="structPlantInfo.html#m4">tera_type</a>[1] = terrain_res.get_tera_type_id( plantRec-&gt;<a class="code" href="structPlantRec.html#m4">tera_type2</a> );
00124             <span class="keywordflow">else</span>
00125                 plantInfo-&gt;<a class="code" href="structPlantInfo.html#m4">tera_type</a>[1] = 0;
00126         }
00127 
00128         <span class="keywordflow">if</span>( plantRec-&gt;<a class="code" href="structPlantRec.html#m5">tera_type3</a>[0] == <span class="charliteral">'T'</span> ) {        <span class="comment">// town plant</span>
00129             plantInfo-&gt;<a class="code" href="structPlantInfo.html#m4">tera_type</a>[2] = <span class="charliteral">'T'</span>;
00130         }
00131         <span class="keywordflow">else</span> {
00132             <span class="keywordflow">if</span>(plantRec-&gt;<a class="code" href="structPlantRec.html#m5">tera_type3</a>[0] != <span class="charliteral">' '</span>)
00133                 plantInfo-&gt;<a class="code" href="structPlantInfo.html#m4">tera_type</a>[2] = terrain_res.get_tera_type_id( plantRec-&gt;<a class="code" href="structPlantRec.html#m5">tera_type3</a> );
00134             <span class="keywordflow">else</span>
00135                 plantInfo-&gt;<a class="code" href="structPlantInfo.html#m4">tera_type</a>[2] = 0;
00136         }
00137 
00138         plantInfo-&gt;<a class="code" href="structPlantInfo.html#m5">first_bitmap</a> = m.atoi( plantRec-&gt;<a class="code" href="structPlantRec.html#m6">first_bitmap</a>, plantRec-&gt;<a class="code" href="structPlantRec.html#s7s4">FIRST_BITMAP_LEN</a> );
00139         plantInfo-&gt;<a class="code" href="structPlantInfo.html#m6">bitmap_count</a> = m.atoi( plantRec-&gt;<a class="code" href="structPlantRec.html#m7">bitmap_count</a>, plantRec-&gt;<a class="code" href="structPlantRec.html#s7s5">BITMAP_COUNT_LEN</a> );
00140     }
00141 }
00142 
00143 <span class="comment">//--------- End of function PlantRes::load_plant_info ---------//</span>
00144 
00145 <span class="comment">//------- Begin of function PlantRes::load_plant_bitmap -------//</span>
00147 <span class="comment">void PlantRes::load_plant_bitmap() {</span>
00148     <a class="code" href="structPlantBitmapRec.html">PlantBitmapRec</a>  *plantBitmapRec;
00149     <a class="code" href="structPlantBitmap.html">PlantBitmap</a>     *plantBitmap;
00150     <span class="keywordtype">int</span>         i;
00151     <span class="keywordtype">long</span>        bitmapOffset;
00152 
00153     <a class="code" href="classString.html">String</a> plantDbName;
00154     plantDbName = <a class="code" href="Gamedef_8h.html#a4">DIR_RES</a>;
00155     plantDbName += <span class="stringliteral">"PLANTBM"</span>;
00156     plantDbName += config.terrain_set;
00157     plantDbName += <span class="stringliteral">".RES"</span>;
00158     <a class="code" href="classDatabase.html">Database</a> plantDbObj(plantDbName, 1);
00159     <span class="comment">// Database                 *dbPlantBitmap = game_set.open_db(PLANT_BITMAP_DB);</span>
00160     <a class="code" href="classDatabase.html">Database</a> *dbPlantBitmap = &amp;plantDbObj;
00161 
00162     plant_bitmap_count = (short) dbPlantBitmap-&gt;<a class="code" href="classDatabase.html#a7">rec_count</a>();
00163     plant_bitmap_array = (<a class="code" href="structPlantBitmap.html">PlantBitmap</a>*) <a class="code" href="ALL_8H.html#a5">mem_add</a>( <span class="keyword">sizeof</span>(<a class="code" href="structPlantBitmap.html">PlantBitmap</a>)*plant_bitmap_count );
00164 
00165     scan_id_array = (<span class="keywordtype">short</span>*) <a class="code" href="ALL_8H.html#a5">mem_add</a>( <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>)*plant_bitmap_count );
00166 
00167     <span class="comment">//-------- read in PLANTBMP.DBF -------//</span>
00168 
00169     memset( plant_bitmap_array, 0, <span class="keyword">sizeof</span>(<a class="code" href="structPlantBitmap.html">PlantBitmap</a>) * plant_bitmap_count );
00170 
00171     <span class="keywordflow">for</span>( i=0 ; i&lt;plant_bitmap_count ; i++ ) {
00172         plantBitmapRec = (<a class="code" href="structPlantBitmapRec.html">PlantBitmapRec</a>*) dbPlantBitmap-&gt;<a class="code" href="classDatabase.html#a4">read</a>(i+1);
00173         plantBitmap    = plant_bitmap_array+i;
00174 
00175         plantBitmap-&gt;<a class="code" href="structPlantBitmap.html#m0">size</a> = m.atoi( plantBitmapRec-&gt;<a class="code" href="structPlantBitmapRec.html#m1">size</a>, plantBitmapRec-&gt;<a class="code" href="structPlantBitmapRec.html#s5s1">SIZE_LEN</a> );
00176 
00177         memcpy( &amp;bitmapOffset, plantBitmapRec-&gt;<a class="code" href="structPlantBitmapRec.html#m6">bitmap_ptr</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">long</span>) );
00178 
00179         plantBitmap-&gt;<a class="code" href="structPlantBitmap.html#m6">bitmap_ptr</a>   = res_bitmap.read_imported(bitmapOffset);
00180         plantBitmap-&gt;<a class="code" href="structPlantBitmap.html#m4">bitmap_width</a>  = *((<span class="keywordtype">short</span>*)plantBitmap-&gt;<a class="code" href="structPlantBitmap.html#m6">bitmap_ptr</a>);
00181         plantBitmap-&gt;<a class="code" href="structPlantBitmap.html#m5">bitmap_height</a> = *(((<span class="keywordtype">short</span>*)plantBitmap-&gt;<a class="code" href="structPlantBitmap.html#m6">bitmap_ptr</a>)+1);
00182 
00183         plantBitmap-&gt;<a class="code" href="structPlantBitmap.html#m1">offset_x</a> = m.atoi( plantBitmapRec-&gt;<a class="code" href="structPlantBitmapRec.html#m2">offset_x</a>, plantBitmapRec-&gt;<a class="code" href="structPlantBitmapRec.html#s5s2">OFFSET_LEN</a> );
00184         plantBitmap-&gt;<a class="code" href="structPlantBitmap.html#m2">offset_y</a> = m.atoi( plantBitmapRec-&gt;<a class="code" href="structPlantBitmapRec.html#m3">offset_y</a>, plantBitmapRec-&gt;<a class="code" href="structPlantBitmapRec.html#s5s2">OFFSET_LEN</a> );
00185 
00186         <span class="comment">// modify offset_x/y for 7k2</span>
00187         plantBitmap-&gt;<a class="code" href="structPlantBitmap.html#m1">offset_x</a> += -LOCATE_WIDTH/2 - (-ZOOM_LOC_X_WIDTH/2 + -ZOOM_LOC_Y_WIDTH/2);
00188         plantBitmap-&gt;<a class="code" href="structPlantBitmap.html#m2">offset_y</a> += -LOCATE_HEIGHT/2 - (-ZOOM_LOC_X_HEIGHT/2 + -ZOOM_LOC_Y_HEIGHT/2);
00189 
00190         <span class="keywordflow">if</span>( plantBitmapRec-&gt;<a class="code" href="structPlantBitmapRec.html#m4">town_age</a> &gt;= <span class="charliteral">'1'</span> &amp;&amp; plantBitmapRec-&gt;<a class="code" href="structPlantBitmapRec.html#m4">town_age</a> &lt;= <span class="charliteral">'9'</span> )
00191             plantBitmap-&gt;<a class="code" href="structPlantBitmap.html#m3">town_age</a> = plantBitmapRec-&gt;<a class="code" href="structPlantBitmapRec.html#m4">town_age</a>-<span class="charliteral">'0'</span>;
00192     }
00193 }
00194 
00195 <span class="comment">//--------- End of function PlantRes::load_plant_bitmap ---------//</span>
00196 
00197 <span class="comment">//---------- Begin of function PlantRes::scan -----------//</span>
<a name="l00212"></a><a class="code" href="classPlantRes.html#a8">00212</a> <span class="comment">int PlantRes::scan(int climateZone, int teraType, int townAge) {</span>
00213     <span class="keywordtype">int</span>          i, j;
00214     <span class="keywordtype">int</span>        matchCount=0;
00215     <a class="code" href="structPlantInfo.html">PlantInfo</a>*   plantInfo = plant_info_array;
00216     <a class="code" href="structPlantBitmap.html">PlantBitmap</a>* plantBitmap = plant_bitmap_array + plantInfo-&gt;<a class="code" href="structPlantInfo.html#m5">first_bitmap</a> - 1;
00217 
00218     <span class="comment">//-------- scan plant id. ----------//</span>
00219 
00220     <span class="keywordflow">for</span>( i=0 ; i&lt;plant_count ; i++, plantInfo++ ) {
00221         <span class="keywordflow">if</span>( !climateZone || (plantInfo-&gt;<a class="code" href="structPlantInfo.html#m3">climate_zone</a> &amp; climateZone) ) {
00222             <span class="keywordflow">if</span>( !teraType ||
00223                 plantInfo-&gt;<a class="code" href="structPlantInfo.html#m4">tera_type</a>[0] == teraType ||
00224                 plantInfo-&gt;<a class="code" href="structPlantInfo.html#m4">tera_type</a>[1] == teraType ||
00225                 plantInfo-&gt;<a class="code" href="structPlantInfo.html#m4">tera_type</a>[2] == teraType ) {
00226                 <span class="comment">//------ scan plant bitmap ----------//</span>
00227                 plantBitmap = plant_bitmap_array + plantInfo-&gt;<a class="code" href="structPlantInfo.html#m5">first_bitmap</a> - 1;
00228                 <span class="keywordflow">for</span>( j=0 ; j&lt;plantInfo-&gt;<a class="code" href="structPlantInfo.html#m6">bitmap_count</a> ; j++, plantBitmap++ ) {
00229                     <span class="comment">// * = wildcard type, could apply to any town age level</span>
00230                     <span class="keywordflow">if</span>( !townAge || plantBitmap-&gt;<a class="code" href="structPlantBitmap.html#m3">town_age</a> == townAge || plantBitmap-&gt;<a class="code" href="structPlantBitmap.html#m3">town_age</a>==<span class="charliteral">'*'</span> ) {
00231                         scan_id_array[matchCount++] = plantInfo-&gt;<a class="code" href="structPlantInfo.html#m5">first_bitmap</a> + j;
00232 
00233                         <a class="code" href="ALL_8H.html#a0">err_when</a>( matchCount &gt; plant_bitmap_count );
00234                     }
00235                 }
00236             }
00237         }
00238     }
00239 
00240     <span class="comment">//--- pick one from those plants that match the criteria ---//</span>
00241 
00242     <span class="keywordflow">if</span>( matchCount &gt; 0 ) {
00243         <span class="keywordtype">int</span> plantBitmapId = scan_id_array[m.random(matchCount)];
00244 
00245         <a class="code" href="ALL_8H.html#a0">err_when</a>( plantBitmapId &lt; 1 || plantBitmapId &gt; plant_bitmap_count );
00246 
00247         <span class="keywordflow">return</span> plantBitmapId;
00248     }
00249     <span class="keywordflow">else</span>
00250         <span class="keywordflow">return</span> 0;
00251 }
00252 
00253 <span class="comment">//---------- End of function PlantRes::scan -----------//</span>
00254 
00255 <span class="comment">//---------- Begin of function PlantRes::plant_recno ----------//</span>
00256 
<a name="l00257"></a><a class="code" href="classPlantRes.html#a9">00257</a> <span class="keywordtype">short</span> <a class="code" href="classPlantRes.html#a9">PlantRes::plant_recno</a>(<span class="keywordtype">short</span> bitmapId) {
00258     <span class="keywordtype">int</span> i;
00259     <a class="code" href="structPlantInfo.html">PlantInfo</a> *plantInfo = <a class="code" href="classPlantRes.html#m5">plant_info_array</a>;
00260     <span class="keywordflow">for</span>( i = 0; i&lt;<a class="code" href="classPlantRes.html#m1">plant_count</a>; ++i, plantInfo++ )
00261         <span class="keywordflow">if</span>( plantInfo-&gt;<a class="code" href="structPlantInfo.html#m5">first_bitmap</a> &lt;= bitmapId &amp;&amp;
00262             bitmapId &lt; plantInfo-&gt;<a class="code" href="structPlantInfo.html#m5">first_bitmap</a>+ plantInfo-&gt;<a class="code" href="structPlantInfo.html#m6">bitmap_count</a>)
00263             <span class="keywordflow">return</span> i+1;
00264     <span class="keywordflow">return</span> 0;
00265 }
00266 
00267 <span class="comment">//---------- End of function PlantRes::plant_recno ----------//</span>
00268 
00269 <span class="preprocessor">#ifdef DEBUG</span>
00270 <span class="preprocessor"></span>
00271 <span class="comment">//---------- Begin of function PlantRes::operator[] -----------//</span>
00272 
00273 <a class="code" href="structPlantInfo.html">PlantInfo</a>* <a class="code" href="classPlantRes.html#a4">PlantRes::operator[]</a>(<span class="keywordtype">int</span> plantId) {
00274     <a class="code" href="ALL_8H.html#a2">err_if</a>( plantId&lt;1 || plantId&gt;<a class="code" href="classPlantRes.html#m1">plant_count</a> )
00275         <a class="code" href="ALL_8H.html#a4">err_now</a>( <span class="stringliteral">"PlantRes::operator[]"</span> );
00276 
00277     <span class="keywordflow">return</span> <a class="code" href="classPlantRes.html#m5">plant_info_array</a>+plantId-1;
00278 }
00279 
00280 <span class="comment">//------------ End of function PlantRes::operator[] -----------//</span>
00281 
00282 <span class="comment">//---------- Begin of function PlantRes::get_bitmap -----------//</span>
00283 
00284 <a class="code" href="structPlantBitmap.html">PlantBitmap</a>* <a class="code" href="classPlantRes.html#a10">PlantRes::get_bitmap</a>(<span class="keywordtype">int</span> bitmapId) {
00285     <a class="code" href="ALL_8H.html#a2">err_if</a>( bitmapId&lt;1 || bitmapId&gt;<a class="code" href="classPlantRes.html#m4">plant_bitmap_count</a> )
00286         <a class="code" href="ALL_8H.html#a4">err_now</a>( <span class="stringliteral">"PlantRes::get_bitmap"</span> );
00287 
00288     <span class="keywordflow">return</span> <a class="code" href="classPlantRes.html#m6">plant_bitmap_array</a>+bitmapId-1;
00289 }
00290 
00291 <span class="comment">//------------ End of function PlantRes::get_bitmap -----------//</span>
00292 <span class="preprocessor">#endif</span>
00293 <span class="preprocessor"></span>
00294 <span class="comment">//------- Begin of function PlantBitmap::draw -----------//</span>
<a name="l00298"></a><a class="code" href="structPlantBitmap.html#a0">00298</a> <span class="comment">void PlantBitmap::draw(int xLoc, int yLoc) {</span>
00299     <span class="comment">//---- get the inner position of the plant inside the location ----//</span>
00300 
00301     <a class="code" href="classLocation.html">Location</a>* locPtr = world.get_loc(xLoc, yLoc);
00302 
00303     <span class="keywordtype">int</span> innerX  = locPtr-&gt;<a class="code" href="classLocation.html#a22">plant_inner_x</a>();
00304     <span class="keywordtype">int</span> innerY  = locPtr-&gt;<a class="code" href="classLocation.html#a23">plant_inner_y</a>();
00305 
00306     world.zoom_matrix-&gt;put_bitmap_offset(xLoc*LOCATE_WIDTH+innerX, yLoc*LOCATE_HEIGHT+innerX,
00307                                          world.interpolate_z(xLoc*LOCATE_WIDTH+innerX, yLoc*LOCATE_HEIGHT+innerY), bitmap_ptr,
00308                                          offset_x, offset_y,
00309                                          <a class="code" href="OHELP_8H.html#a0">NULL</a>, 0, 1);
00310 }
00311 
00312 <span class="comment">//--------- End of function PlantBitmap::draw -----------//</span>
00313 
00314 <span class="comment">//------- Begin of function PlantBitmap::draw_at -----------//</span>
<a name="l00323"></a><a class="code" href="structPlantBitmap.html#a1">00323</a> <span class="comment">void PlantBitmap::draw_at(int curX, int curY, int curZ, int constructionCompletionPercent ) {</span>
00324     <span class="keywordtype">short</span> *remapTable;
00325 
00326     remapTable = (<span class="keywordtype">short</span> *)vga.vga_color_table-&gt;get_table( constructionCompletionPercent * 20 / 100 - 20 );
00327 
00328     <span class="keywordtype">short</span> bitmapWidth = ((<a class="code" href="classBitmap.html">Bitmap</a> *)bitmap_ptr)-&gt;get_width();
00329     <span class="keywordtype">short</span> bitmapHeight = ((<a class="code" href="classBitmap.html">Bitmap</a> *)bitmap_ptr)-&gt;get_height();
00330 
00331     world.zoom_matrix-&gt;put_bitmap_offset(curX, curY, curZ, bitmap_ptr,
00332                                          -bitmapWidth/2, -bitmapHeight+15,
00333                                          remapTable, 0, 1);
00334 }
00335 
00336 <span class="comment">//--------- End of function PlantBitmap::draw_at -----------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:11 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
