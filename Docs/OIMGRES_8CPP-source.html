<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OIMGRES.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>OIMGRES.CPP</h1><a href="OIMGRES_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OIMGES.CPP</span>
00002 <span class="comment">//Description : Object ImageRes</span>
00003 
00004 <span class="preprocessor">#include &lt;string.h&gt;</span>
00005 
00006 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00007 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00008 <span class="preprocessor">#include &lt;<a class="code" href="OCOLTBL_8H.html">OCOLTBL.H</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00010 <span class="preprocessor">#include &lt;<a class="code" href="OIMGRES_8H.html">OIMGRES.H</a>&gt;</span>
00011 <span class="preprocessor">#include &lt;OIFACE.H&gt;</span>
00012 <span class="preprocessor">#include &lt;<a class="code" href="OBITMAP_8H.html">OBITMAP.H</a>&gt;</span>
00013 
00014 <span class="comment">//--------- Format of RES file ------------//</span>
00015 <span class="comment">//</span>
00016 <span class="comment">// In the resource file, contain many compressed images, each image</span>
00017 <span class="comment">// has the following data</span>
00018 <span class="comment">//</span>
00019 <span class="comment">// &lt;char[8]&gt; = the name of the image</span>
00020 <span class="comment">// &lt;int&gt;     = the widht of the image</span>
00021 <span class="comment">// &lt;int&gt;     = the height of the image</span>
00022 <span class="comment">// &lt;char...&gt; = the bitmap of the image</span>
00023 <span class="comment">//</span>
00024 <span class="comment">//--------------------------------------------//</span>
00025 
00026 <span class="comment">//------- Start of function ImageRes::ImageRes -------//</span>
00027 <span class="comment">//</span>
00028 <span class="comment">// &lt;char*&gt; resName   = name of the resource file (e.g. "GIF.RES")</span>
00029 <span class="comment">// [int]   readAll   = whether read all data into the buffer or read one each time</span>
00030 <span class="comment">//                     (default:0)</span>
00031 <span class="comment">// [int]   useCommonBuf = whether use the sys common buffer to store the data or not</span>
00032 <span class="comment">//                     (default:0)</span>
00033 <span class="comment">//</span>
<a name="l00034"></a><a class="code" href="classImageRes.html#a1">00034</a> <a class="code" href="classImageRes.html#a0">ImageRes::ImageRes</a>(<span class="keywordtype">char</span>* resFile, <span class="keywordtype">int</span> readAll, <span class="keywordtype">int</span> useCommonBuf) :
00035     <a class="code" href="classResourceIdx.html">ResourceIdx</a>(resFile, readAll, useCommonBuf) {
00036 }
00037 
00038 <span class="comment">//--------- End of function ImageRes::ImageRes -------//</span>
00039 
00040 <span class="comment">//-------- Start of function ImageRes::put_front --------//</span>
00041 <span class="comment">//</span>
00042 <span class="comment">// int  x,y       = the location of the image</span>
00043 <span class="comment">// char* imageName = name of the image</span>
00044 <span class="comment">// [int] compressFlag = compress flag</span>
00045 <span class="comment">//                                                              (default: 0)</span>
00046 <span class="comment">//</span>
<a name="l00047"></a><a class="code" href="classImageRes.html#a2">00047</a> <span class="keywordtype">void</span> <a class="code" href="classImageRes.html#a2">ImageRes::put_front</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">char</span>* imageName, <span class="keywordtype">int</span> compressFlag) {
00048     <span class="keywordtype">char</span>* bitmapPtr = <a class="code" href="classResourceIdx.html#a8">ResourceIdx::read</a>(imageName);
00049 
00050     <span class="keywordflow">if</span>(!bitmapPtr)
00051         <span class="keywordflow">return</span>;
00052 
00053     mouse.hide_area( x, y, x+*((<span class="keywordtype">short</span>*)bitmapPtr)-1, y+*(((<span class="keywordtype">short</span>*)bitmapPtr)+1)-1 );
00054 
00055     <span class="keywordflow">if</span>( compressFlag )
00056         vga_front.put_bitmap_trans_decompress( x, y, bitmapPtr );
00057     <span class="keywordflow">else</span>
00058         vga_front.put_bitmap_trans( x, y, bitmapPtr );
00059 
00060     mouse.show_area();
00061 }
00062 
00063 <span class="comment">//---------- End of function ImageRes::put_front --------//</span>
00064 
00065 <span class="comment">//-------- Start of function ImageRes::put_back --------//</span>
00066 <span class="comment">//</span>
00067 <span class="comment">// int  x,y       = the location of the image</span>
00068 <span class="comment">// char* imageName = name of the image</span>
00069 <span class="comment">// [int] compressFlag = compress flag</span>
00070 <span class="comment">//                                                              (default: 0)</span>
00071 <span class="comment">//</span>
<a name="l00072"></a><a class="code" href="classImageRes.html#a3">00072</a> <span class="keywordtype">void</span> <a class="code" href="classImageRes.html#a3">ImageRes::put_back</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">char</span>* imageName, <span class="keywordtype">int</span> compressFlag) {
00073     <span class="keywordtype">char</span>* bitmapPtr = <a class="code" href="classResourceIdx.html#a8">ResourceIdx::read</a>(imageName);
00074 
00075     <span class="comment">/*  if(user_interface.backgd_flag==0)</span>
00076 <span class="comment">        {</span>
00077 <span class="comment">        if(strcmp(imageName,"QUEST_UP")==0)</span>
00078 <span class="comment">        {</span>
00079 <span class="comment">        vga_back.barW_fast(x,y,x+*(short*)bitmapPtr,y+*((short*)bitmapPtr+1)+1,0xFFFF);</span>
00080 <span class="comment">        return;</span>
00081 <span class="comment">        }</span>
00082 <span class="comment">        }</span>
00083 <span class="comment">    */</span>
00084     <span class="keywordflow">if</span>( bitmapPtr ) {
00085         <span class="keywordflow">if</span>( compressFlag )
00086             vga_back.put_bitmap_trans_decompress( x, y, bitmapPtr );
00087         <span class="keywordflow">else</span>
00088             vga_back.put_bitmap_trans( x, y, bitmapPtr );
00089     }
00090 }
00091 
00092 <span class="comment">//---------- End of function ImageRes::put_back --------//</span>
00093 
00094 <span class="comment">//-------- Start of function ImageRes::put_front --------//</span>
00095 <span class="comment">//</span>
00096 <span class="comment">// int x,y      = the location of the image</span>
00097 <span class="comment">// int bitmapId = id. of the bitmap</span>
00098 <span class="comment">// [int] compressFlag = compress flag</span>
00099 <span class="comment">//                                                              (default: 0)</span>
00100 <span class="comment">//</span>
<a name="l00101"></a><a class="code" href="classImageRes.html#a4">00101</a> <span class="keywordtype">void</span> <a class="code" href="classImageRes.html#a2">ImageRes::put_front</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> bitmapId, <span class="keywordtype">int</span> compressFlag) {
00102     <span class="keywordtype">char</span>* bitmapPtr = <a class="code" href="classResourceIdx.html#a11">ResourceIdx::get_data</a>(bitmapId);
00103 
00104     <span class="keywordflow">if</span>( !bitmapPtr )
00105         <span class="keywordflow">return</span>;
00106 
00107     mouse.hide_area( x, y, x+*((<span class="keywordtype">short</span>*)bitmapPtr)-1, y+*(((<span class="keywordtype">short</span>*)bitmapPtr)+1)-1 );
00108 
00109     <span class="keywordflow">if</span>( compressFlag )
00110         vga_front.put_bitmap_trans_decompress( x, y, bitmapPtr );
00111     <span class="keywordflow">else</span>
00112         vga_front.put_bitmap_trans( x, y, bitmapPtr );
00113 
00114     mouse.show_area();
00115 }
00116 
00117 <span class="comment">//---------- End of function ImageRes::put_front --------//</span>
00118 
00119 <span class="comment">//-------- Start of function ImageRes::put_back --------//</span>
00120 <span class="comment">//</span>
00121 <span class="comment">// int ,y       = the location of the image</span>
00122 <span class="comment">// int bitmapId = id. of the bitmap</span>
00123 <span class="comment">// [int] compressFlag = compress flag</span>
00124 <span class="comment">//                                                              (default: 0)</span>
00125 <span class="comment">//</span>
<a name="l00126"></a><a class="code" href="classImageRes.html#a5">00126</a> <span class="keywordtype">void</span> <a class="code" href="classImageRes.html#a3">ImageRes::put_back</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> bitmapId, <span class="keywordtype">int</span> compressFlag) {
00127     <span class="keywordtype">char</span>* bitmapPtr = <a class="code" href="classResourceIdx.html#a11">ResourceIdx::get_data</a>(bitmapId);
00128 
00129     <span class="keywordflow">if</span>( bitmapPtr ) {
00130         <span class="keywordflow">if</span>( compressFlag )
00131             vga_back.put_bitmap_trans_decompress( x, y, bitmapPtr );
00132         <span class="keywordflow">else</span>
00133             vga_back.put_bitmap_trans( x, y, bitmapPtr );
00134     }
00135 }
00136 
00137 <span class="comment">//---------- End of function ImageRes::put_back --------//</span>
00138 
00139 <span class="comment">//-------- Start of function ImageRes::put_join --------//</span>
00140 <span class="comment">//</span>
00141 <span class="comment">// int  x,y       = the location of the image</span>
00142 <span class="comment">// char* imageName = name of the image</span>
00143 <span class="comment">//</span>
<a name="l00144"></a><a class="code" href="classImageRes.html#a6">00144</a> <span class="keywordtype">void</span> <a class="code" href="classImageRes.html#a6">ImageRes::put_join</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">char</span>* imageName) {
00145     <span class="keywordtype">char</span>* bitmapPtr = <a class="code" href="classResourceIdx.html#a8">ResourceIdx::read</a>(imageName);
00146 
00147     <span class="keywordflow">if</span>( !bitmapPtr )
00148         <span class="keywordflow">return</span>;
00149 
00150     mouse.hide_area( x, y, x+((<a class="code" href="classBitmap.html">Bitmap</a> *)bitmapPtr)-&gt;get_width()-1, y+((<a class="code" href="classBitmap.html">Bitmap</a> *)bitmapPtr)-&gt;get_height()-1 );
00151 
00152     <span class="keywordflow">if</span>( bitmapPtr )
00153         vga_front.join_trans( &amp;vga_back, x, y, bitmapPtr );
00154 
00155     mouse.show_area();
00156 }
00157 
00158 <span class="comment">//---------- End of function ImageRes::put_join --------//</span>
00159 
00160 <span class="comment">//-------- Start of function ImageRes::put_large --------//</span>
00161 <span class="comment">//</span>
00162 <span class="comment">// When a picture file is &gt; 64K, which cannot be read into a single</span>
00163 <span class="comment">// memory buffer.</span>
00164 <span class="comment">//</span>
00165 <span class="comment">// It will call vga.put_pict() which will continously read the file</span>
00166 <span class="comment">// and put to the screen until completion.</span>
00167 <span class="comment">//</span>
00168 <span class="comment">// &lt;VgaBuf*&gt; vgaBuf       = the vga buffer for display</span>
00169 <span class="comment">// &lt;int&gt;            x,y       = the location of the image</span>
00170 <span class="comment">// &lt;char*&gt;   imageName = name of the image</span>
00171 <span class="comment">//</span>
<a name="l00172"></a><a class="code" href="classImageRes.html#a8">00172</a> <span class="keywordtype">void</span> <a class="code" href="classImageRes.html#a8">ImageRes::put_large</a>(<a class="code" href="classVgaBuf.html">VgaBuf</a>* vgaBuf, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">char</span>* imageName) {
00173     <span class="keywordtype">int</span> dataSize;
00174 
00175     <a class="code" href="classFile.html">File</a>* filePtr = <a class="code" href="classResourceIdx.html#a13">get_file</a>(imageName, dataSize);
00176 
00177     <span class="keywordflow">if</span> (filePtr-&gt;<a class="code" href="classFile.html#a11">file_get_short</a>() != -1 ) {         <span class="comment">// use common color palette</span>
00178         filePtr-&gt;<a class="code" href="classFile.html#a7">file_seek</a>(filePtr-&gt;<a class="code" href="classFile.html#a8">file_pos</a>() - <span class="keyword">sizeof</span>(short));
00179         vgaBuf-&gt;<a class="code" href="classVgaBuf.html#a55">put_large_bitmap</a>(x, y, filePtr);
00180     }
00181     <span class="keywordflow">else</span> {                                          <span class="comment">// use own color palette</span>
00182         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> palette[256 * 3];
00183         <span class="keywordtype">short</span> *remapTable;
00184         filePtr-&gt;<a class="code" href="classFile.html#a9">file_read</a>(palette, 256 * 3);
00185         <a class="code" href="structPalDesc.html">PalDesc</a> palDesc(palette, 3, 256, 6);
00186         <a class="code" href="classColorTable.html">ColorTable</a> colorTable;
00187         colorTable.<a class="code" href="classColorTable.html#a9">generate_table_fast</a>(<a class="code" href="OVGA_8H.html#a3">MAX_BRIGHTNESS_ADJUST_DEGREE</a>, palDesc, <a class="code" href="classColorTable.html#d0">ColorTable::bright_func</a>);
00188         remapTable = (<span class="keywordtype">short</span> *) colorTable.<a class="code" href="classColorTable.html#a11">get_table</a>(0);
00189         vgaBuf-&gt;<a class="code" href="classVgaBuf.html#a55">put_large_bitmap</a>(x, y, filePtr, remapTable);
00190     }
00191 }
00192 
00193 <span class="comment">//---------- End of function ImageRes::put_large --------//</span>
00194 
00195 <span class="comment">//-------- Start of function ImageRes::put_large --------//</span>
00196 <span class="comment">//</span>
00197 <span class="comment">// When a picture file is &gt; 64K, which cannot be read into a single</span>
00198 <span class="comment">// memory buffer.</span>
00199 <span class="comment">//</span>
00200 <span class="comment">// It will call vga.put_pict() which will continously read the file</span>
00201 <span class="comment">// and put to the screen until completion.</span>
00202 <span class="comment">//</span>
00203 <span class="comment">// &lt;VgaBuf*&gt; vgaBuf       = the vga buffer for display</span>
00204 <span class="comment">// &lt;int&gt;            x,y       = the location of the image</span>
00205 <span class="comment">// &lt;int&gt;                 bitmapId  = id. of the bitmap in the bitmap resource file.</span>
00206 <span class="comment">//</span>
<a name="l00207"></a><a class="code" href="classImageRes.html#a9">00207</a> <span class="keywordtype">void</span> <a class="code" href="classImageRes.html#a8">ImageRes::put_large</a>(<a class="code" href="classVgaBuf.html">VgaBuf</a>* vgaBuf, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> bitmapId) {
00208     <span class="keywordtype">int</span> dataSize;
00209 
00210     vgaBuf-&gt;<a class="code" href="classVgaBuf.html#a55">put_large_bitmap</a>( x, y, <a class="code" href="classResourceIdx.html#a13">ResourceIdx::get_file</a>(bitmapId, dataSize) );
00211 }
00212 
00213 <span class="comment">//---------- End of function ImageRes::put_large --------//</span>
00214 
00215 <span class="comment">//-------- Start of function ImageRes::put_to_buf --------//</span>
00216 <span class="comment">//</span>
00217 <span class="comment">// Put the image to the specified Vga buffer.</span>
00218 <span class="comment">//</span>
00219 <span class="comment">// &lt;VgaBuf*&gt; vgaBufPtr = the pointer to the Vga buffer</span>
00220 <span class="comment">// &lt;char*&gt;       imageName = name of the image</span>
00221 <span class="comment">//</span>
<a name="l00222"></a><a class="code" href="classImageRes.html#a10">00222</a> <span class="keywordtype">void</span> <a class="code" href="classImageRes.html#a10">ImageRes::put_to_buf</a>(<a class="code" href="classVgaBuf.html">VgaBuf</a>* vgaBufPtr, <span class="keywordtype">char</span>* imageName) {
00223     <span class="keywordflow">if</span>( read_all ) {
00224         vgaBufPtr-&gt;<a class="code" href="classVgaBuf.html#a57">put_bitmap</a>(0, 0, <a class="code" href="classImageRes.html#a7">get_ptr</a>(imageName));
00225     }
00226     <span class="keywordflow">else</span> {
00227         <span class="keywordtype">int</span> dataSize;
00228         <a class="code" href="classFile.html">File</a>* filePtr = <a class="code" href="classResourceIdx.html#a13">get_file</a>(imageName, dataSize);
00229         vgaBufPtr-&gt;<a class="code" href="classVgaBuf.html#a55">put_large_bitmap</a>(0, 0, filePtr);
00230     }
00231 }
00232 
00233 <span class="comment">//---------- End of function ImageRes::put_to_buf --------//</span>
00234 
00235 <span class="comment">//-------- Start of function ImageRes::put_to_buf --------//</span>
00236 <span class="comment">//</span>
00237 <span class="comment">// Put the image to the specified Vga buffer.</span>
00238 <span class="comment">//</span>
00239 <span class="comment">// &lt;VgaBuf*&gt; vgaBufPtr = the pointer to the Vga buffer</span>
00240 <span class="comment">// &lt;int&gt;     bitmapId  = id. of the bitmap in the resource file.</span>
00241 <span class="comment">//</span>
<a name="l00242"></a><a class="code" href="classImageRes.html#a11">00242</a> <span class="keywordtype">void</span> <a class="code" href="classImageRes.html#a10">ImageRes::put_to_buf</a>(<a class="code" href="classVgaBuf.html">VgaBuf</a>* vgaBufPtr, <span class="keywordtype">int</span> bitmapId) {
00243     <span class="keywordflow">if</span>( read_all ) {
00244         vgaBufPtr-&gt;<a class="code" href="classVgaBuf.html#a57">put_bitmap</a>(0, 0, <a class="code" href="classResourceIdx.html#a11">get_data</a>(bitmapId));
00245     }
00246     <span class="keywordflow">else</span> {
00247         <span class="keywordtype">int</span> dataSize;
00248         <a class="code" href="classFile.html">File</a>* filePtr = <a class="code" href="classResourceIdx.html#a13">get_file</a>(bitmapId, dataSize);
00249         vgaBufPtr-&gt;<a class="code" href="classVgaBuf.html#a55">put_large_bitmap</a>(0, 0, filePtr);
00250     }
00251 }
00252 
00253 <span class="comment">//---------- End of function ImageRes::put_to_buf --------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:59 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
