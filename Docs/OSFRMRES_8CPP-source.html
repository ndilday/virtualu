<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OSFRMRES.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>OSFRMRES.CPP</h1><a href="OSFRMRES_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OSFRMRES.CPP</span>
00002 <span class="comment">//Description : Object Sprite Frame Resource</span>
00003 <span class="comment">//Owner       : Fred</span>
00004 
00005 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;<a class="code" href="OSTR_8H.html">OSTR.H</a>&gt;</span>
00007 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00008 <span class="preprocessor">#include &lt;<a class="code" href="OGAMESET_8H.html">OGAMESET.H</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;<a class="code" href="OSFRMRES_8H.html">OSFRMRES.H</a>&gt;</span>
00010 
00011 <span class="comment">//-------- define file name -----------//</span>
00012 
<a name="l00013"></a><a class="code" href="OSFRMRES_8CPP.html#a0">00013</a> <span class="preprocessor">#define SPRITE_FRAME_DB    "SFRAME"</span>
00014 <span class="preprocessor"></span>
00015 <span class="comment">//-------- Begin of function SpriteFrameRes::init ---------//</span>
00016 
<a name="l00017"></a><a class="code" href="classSpriteFrameRes.html#a1">00017</a> <span class="keywordtype">void</span> <a class="code" href="classSpriteFrameRes.html#a1">SpriteFrameRes::init</a>() {
00018     <a class="code" href="classSpriteFrameRes.html#a2">deinit</a>();
00019 
00020     <span class="comment">//------- load database information --------//</span>
00021 
00022     <a class="code" href="classSpriteFrameRes.html#a3">load_info</a>();
00023 
00024     <a class="code" href="classSpriteFrameRes.html#m1">init_flag</a>=1;
00025 }
00026 
00027 <span class="comment">//--------- End of function SpriteFrameRes::init ----------//</span>
00028 
00029 <span class="comment">//-------- Begin of function SpriteFrameRes::deinit ---------//</span>
00030 
<a name="l00031"></a><a class="code" href="classSpriteFrameRes.html#a2">00031</a> <span class="keywordtype">void</span> <a class="code" href="classSpriteFrameRes.html#a2">SpriteFrameRes::deinit</a>() {
00032     <span class="keywordflow">if</span>( init_flag ) {
00033         <span class="keyword">delete</span> sprite_frame_array;
00034 
00035         <a class="code" href="classSpriteFrameRes.html#m1">init_flag</a>=0;
00036     }
00037 }
00038 
00039 <span class="comment">//--------- End of function SpriteFrameRes::deinit ----------//</span>
00040 
00041 <span class="comment">//------- Begin of function SpriteFrameRes::load_info ---------//</span>
00042 
<a name="l00043"></a><a class="code" href="classSpriteFrameRes.html#a3">00043</a> <span class="keywordtype">void</span> <a class="code" href="classSpriteFrameRes.html#a3">SpriteFrameRes::load_info</a>() {
00044     <a class="code" href="classDatabase.html">Database</a>      *dbSpriteFrame = game_set.open_db(<a class="code" href="OSFRMRES_8CPP.html#a0">SPRITE_FRAME_DB</a>);
00045     <a class="code" href="structSpriteFrameRec.html">SpriteFrameRec</a> *frameRec;
00046     <a class="code" href="structSpriteFrame.html">SpriteFrame</a>   *spriteFrame;
00047     <span class="keywordtype">int</span>         i;
00048 
00049     <a class="code" href="classSpriteFrameRes.html#m0">sprite_frame_count</a> = dbSpriteFrame-&gt;<a class="code" href="classDatabase.html#a7">rec_count</a>();
00050     sprite_frame_array = <span class="keyword">new</span> <a class="code" href="structSpriteFrame.html">SpriteFrame</a>[<a class="code" href="classSpriteFrameRes.html#m0">sprite_frame_count</a>];
00051 
00052     memset( sprite_frame_array, 0, <span class="keyword">sizeof</span>(<a class="code" href="structSpriteFrame.html">SpriteFrame</a>)*<a class="code" href="classSpriteFrameRes.html#m0">sprite_frame_count</a> );
00053 
00054     <span class="comment">//--------- read in frame information ---------//</span>
00055 
00056     <span class="keywordflow">for</span>( i=0 ; i&lt;dbSpriteFrame-&gt;<a class="code" href="classDatabase.html#a7">rec_count</a>() ; i++ ) {
00057         frameRec  = (<a class="code" href="structSpriteFrameRec.html">SpriteFrameRec</a>*) dbSpriteFrame-&gt;<a class="code" href="classDatabase.html#a4">read</a>(i+1);
00058         spriteFrame = sprite_frame_array+i;
00059 
00060         spriteFrame-&gt;<a class="code" href="structSpriteFrame.html#m0">offset_x</a> = m.atoi(frameRec-&gt;<a class="code" href="structSpriteFrameRec.html#m4">offset_x</a>, frameRec-&gt;<a class="code" href="structSpriteFrameRec.html#s9s4">OFFSET_LEN</a>);
00061         spriteFrame-&gt;<a class="code" href="structSpriteFrame.html#m1">offset_y</a> = m.atoi(frameRec-&gt;<a class="code" href="structSpriteFrameRec.html#m5">offset_y</a>, frameRec-&gt;<a class="code" href="structSpriteFrameRec.html#s9s4">OFFSET_LEN</a>);
00062 
00063         spriteFrame-&gt;<a class="code" href="structSpriteFrame.html#m2">width</a>  = m.atoi(frameRec-&gt;<a class="code" href="structSpriteFrameRec.html#m6">width</a> , frameRec-&gt;<a class="code" href="structSpriteFrameRec.html#s9s5">WIDTH_LEN</a>);
00064         spriteFrame-&gt;<a class="code" href="structSpriteFrame.html#m3">height</a> = m.atoi(frameRec-&gt;<a class="code" href="structSpriteFrameRec.html#m7">height</a>, frameRec-&gt;<a class="code" href="structSpriteFrameRec.html#s9s6">HEIGHT_LEN</a>);
00065 
00066         memcpy( &amp;spriteFrame-&gt;<a class="code" href="structSpriteFrame.html#m4">bitmap_offset</a>, frameRec-&gt;<a class="code" href="structSpriteFrameRec.html#m9">bitmap_offset</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">long</span>) );
00067     }
00068 }
00069 
00070 <span class="comment">//-------- End of function SpriteFrameRes::load_info ---------//</span>
00071 
00072 <span class="preprocessor">#ifdef DEBUG</span>
00073 <span class="preprocessor"></span>
00074 <span class="comment">//-------- Begin of function SpriteFrameRes::operator[] -------//</span>
00075 
00076 <a class="code" href="structSpriteFrame.html">SpriteFrame</a>* <a class="code" href="classSpriteFrameRes.html#a4">SpriteFrameRes::operator[]</a>(<span class="keywordtype">int</span> recNo) {
00077     <span class="keywordflow">if</span>( recNo&lt;1 || recNo&gt;<a class="code" href="classSpriteFrameRes.html#m0">sprite_frame_count</a> )
00078         err.run( <span class="stringliteral">"SpriteFrameRes::operator[]"</span> );
00079 
00080     <span class="keywordflow">return</span> sprite_frame_array+recNo-1;
00081 }
00082 
00083 <span class="comment">//--------- End of function SpriteFrameRes::operator[] --------//</span>
00084 <span class="preprocessor">#endif</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:23 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
