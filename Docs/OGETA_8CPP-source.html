<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OGETA.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>OGETA.CPP</h1><a href="OGETA_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">// Filename     : OGETA.CPP</span>
00002 <span class="comment">// Description  : simple get field</span>
00003 
00004 <span class="preprocessor">#include &lt;<a class="code" href="OGETA_8H.html">OGETA.H</a>&gt;</span>
00005 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;OVGABUF.H&gt;</span>
00007 <span class="preprocessor">#include &lt;OFONT.H&gt;</span>
00008 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00009 <span class="preprocessor">#include &lt;OAUDIO.H&gt;</span>
00010 <span class="preprocessor">#include &lt;OCONFIG.H&gt;</span>
00011 <span class="preprocessor">#include &lt;<a class="code" href="KEY_8H.html">KEY.H</a>&gt;</span>
00012 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00013 <span class="preprocessor">#include &lt;<a class="code" href="COLCODE_8H.html">COLCODE.H</a>&gt;</span>
00014 
<a name="l00015"></a><a class="code" href="classGetA.html#a0">00015</a> <a class="code" href="classGetA.html#a0">GetA::GetA</a>() {
00016     <a class="code" href="classGetA.html#m3">input_field</a> = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00017     <a class="code" href="classGetA.html#m4">field_len</a> = 0;
00018     <a class="code" href="classGetA.html#m7">font_ptr</a> = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00019     <a class="code" href="classGetA.html#m8">align_flag</a> = 0;
00020     <a class="code" href="classGetA.html#m9">enable_flag</a> = 1;
00021     <a class="code" href="classGetA.html#m12">mouse_drag_flag</a> = 0;
00022     <a class="code" href="classGetA.html#m11">back_ground_bitmap</a> = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00023 }
00024 
<a name="l00025"></a><a class="code" href="classGetA.html#a1">00025</a> <span class="keywordtype">void</span> <a class="code" href="classGetA.html#a1">GetA::init</a>( <span class="keywordtype">int</span> x1, <span class="keywordtype">int</span> y1, <span class="keywordtype">int</span> x2, <span class="keywordtype">char</span> *field, <span class="keywordtype">unsigned</span> length,
00026                  <a class="code" href="classFont.html">Font</a> *fontPtr, <span class="keywordtype">char</span> align, <span class="keywordtype">char</span> detectEsc) {
00027     <a class="code" href="classGetA.html#m0">x</a> = x1;
00028     <a class="code" href="classGetA.html#m1">y</a> = y1;
00029     <a class="code" href="classGetA.html#m2">x_limit</a> = x2;
00030 
00031     <a class="code" href="classGetA.html#m3">input_field</a> = field;
00032     <a class="code" href="classGetA.html#m4">field_len</a> = length;
00033     <a class="code" href="classGetA.html#m7">font_ptr</a> = fontPtr;
00034     <a class="code" href="classGetA.html#m8">align_flag</a> = align;
00035     <a class="code" href="classGetA.html#m9">enable_flag</a> = 1;
00036     <a class="code" href="classGetA.html#m10">esc_key_flag</a> = detectEsc;
00037     <a class="code" href="classGetA.html#m12">mouse_drag_flag</a> = 0;
00038     <a class="code" href="classGetA.html#m11">back_ground_bitmap</a> = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00039 
00040     <a class="code" href="classGetA.html#a13">select_whole</a>();
00041 }
00042 
<a name="l00043"></a><a class="code" href="classGetA.html#a2">00043</a> <span class="keywordtype">int</span> <a class="code" href="classGetA.html#a2">GetA::height</a>() {
00044     <span class="keywordflow">return</span> <a class="code" href="classGetA.html#m7">font_ptr</a>-&gt;<a class="code" href="classFont.html#m6">max_font_height</a>;
00045 }
00046 
<a name="l00047"></a><a class="code" href="classGetA.html#a3">00047</a> <span class="keywordtype">void</span> <a class="code" href="classGetA.html#a3">GetA::clear</a>() {
00048     <a class="code" href="classGetA.html#m3">input_field</a>[0] = <span class="charliteral">'\0'</span>;
00049     <a class="code" href="classGetA.html#m5">cursor_pos</a> = 0;
00050     <a class="code" href="classGetA.html#a9">clear_select</a>();
00051 }
00052 
00053 <span class="comment">// return 0 for no input</span>
00054 <span class="comment">// return key code pressed such as KEY_RETURN, KEY_ESCAPE ...</span>
00055 
<a name="l00056"></a><a class="code" href="classGetA.html#a4">00056</a> <span class="keywordtype">unsigned</span> <a class="code" href="classGetA.html#a4">GetA::detect_key</a>() {
00057     <span class="keywordflow">if</span>( !<a class="code" href="classGetA.html#m9">enable_flag</a> )
00058         <span class="keywordflow">return</span> 0;
00059     <span class="comment">//  if(cursor_pos &lt; 0)</span>
00060     <span class="comment">//          cursor_pos = 0;</span>
00061     <span class="comment">//  if(cursor_pos &gt; strlen(input_field))</span>
00062     <span class="comment">//          cursor_pos = strlen(input_field);</span>
00063 
00064     <span class="comment">//  err_when( cursor_pos &lt; 0 || cursor_pos &gt; strlen(input_field) );</span>
00065     <span class="comment">//  err_when( mark_cursor_pos &lt; 0 || mark_cursor_pos &gt; strlen(input_field) );</span>
00066 
00067     <span class="keywordflow">if</span>( mouse.is_key_event() ) {
00068         <span class="keywordtype">unsigned</span> keyCode = mouse.key_code;
00069 
00070         mouse.get_event();                            <span class="comment">// clear this key from mouse buffer so that it is not processed twice</span>
00071 
00072         <span class="keywordtype">unsigned</span>  shiftPressed = mouse.event_skey_state &amp; <a class="code" href="Omouse_8h.html#a5">SHIFT_KEY_MASK</a>;
00073         audio.play_wav(<span class="stringliteral">"BEEPS-CL"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00074         <span class="comment">// printable character</span>
00075         <span class="keywordflow">if</span>( keyCode &gt;= <span class="charliteral">' '</span> &amp;&amp; keyCode &lt;= 0xff ) {
00076             <span class="keywordflow">if</span>( strlen(<a class="code" href="classGetA.html#m3">input_field</a>)-(<a class="code" href="classGetA.html#a11">mark_end</a>() - <a class="code" href="classGetA.html#a10">mark_begin</a>()) &lt; <a class="code" href="classGetA.html#m4">field_len</a>) {
00077                 <span class="comment">// insert character</span>
00078                 memmove( <a class="code" href="classGetA.html#m3">input_field</a>+<a class="code" href="classGetA.html#a10">mark_begin</a>()+1, <a class="code" href="classGetA.html#m3">input_field</a>+<a class="code" href="classGetA.html#a11">mark_end</a>(),
00079                          strlen(<a class="code" href="classGetA.html#m3">input_field</a>)-<a class="code" href="classGetA.html#a11">mark_end</a>()+1);
00080                 <a class="code" href="classGetA.html#m3">input_field</a>[<a class="code" href="classGetA.html#a10">mark_begin</a>()] = keyCode;
00081                 <a class="code" href="classGetA.html#m5">cursor_pos</a> = <a class="code" href="classGetA.html#a10">mark_begin</a>()+1;
00082                 <a class="code" href="classGetA.html#a9">clear_select</a>();
00083             }
00084             <a class="code" href="ALL_8H.html#a0">err_when</a>( cursor_pos &lt; 0 || cursor_pos &gt; strlen(<a class="code" href="classGetA.html#m3">input_field</a>) );
00085             <a class="code" href="ALL_8H.html#a0">err_when</a>( mark_cursor_pos &lt; 0 || mark_cursor_pos &gt; strlen(<a class="code" href="classGetA.html#m3">input_field</a>) );
00086             <span class="keywordflow">return</span> keyCode;
00087         }
00088         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( keyCode == <a class="code" href="KEY_8H.html#a15">KEY_DEL</a> ) {
00089             <span class="keywordflow">if</span>( <a class="code" href="classGetA.html#a12">is_select</a>() ) {
00090                 <a class="code" href="ALL_8H.html#a0">err_when</a>( cursor_pos &lt; 0 || cursor_pos &gt; strlen(<a class="code" href="classGetA.html#m3">input_field</a>) );
00091                 <a class="code" href="ALL_8H.html#a0">err_when</a>( mark_cursor_pos &lt; 0 || mark_cursor_pos &gt; strlen(<a class="code" href="classGetA.html#m3">input_field</a>) );
00092                 <span class="comment">// erase selected area</span>
00093                 memmove( <a class="code" href="classGetA.html#m3">input_field</a>+<a class="code" href="classGetA.html#a10">mark_begin</a>()-1, <a class="code" href="classGetA.html#m3">input_field</a>+<a class="code" href="classGetA.html#a11">mark_end</a>(),
00094                          strlen(<a class="code" href="classGetA.html#m3">input_field</a>)-<a class="code" href="classGetA.html#a11">mark_end</a>()+1);
00095                 <a class="code" href="classGetA.html#m5">cursor_pos</a> = <a class="code" href="classGetA.html#a10">mark_begin</a>();
00096                 <a class="code" href="classGetA.html#a9">clear_select</a>();
00097             }
00098             <span class="keywordflow">else</span> {
00099                 <span class="keywordflow">if</span>(strlen(<a class="code" href="classGetA.html#m3">input_field</a>) &gt; <a class="code" href="classGetA.html#m5">cursor_pos</a>) {
00100                     <a class="code" href="ALL_8H.html#a0">err_when</a>( cursor_pos &lt; 0 || cursor_pos &gt; strlen(<a class="code" href="classGetA.html#m3">input_field</a>) );
00101                     memmove( <a class="code" href="classGetA.html#m3">input_field</a>+<a class="code" href="classGetA.html#m5">cursor_pos</a>, <a class="code" href="classGetA.html#m3">input_field</a>+<a class="code" href="classGetA.html#m5">cursor_pos</a>+1,
00102                              strlen(<a class="code" href="classGetA.html#m3">input_field</a>)-<a class="code" href="classGetA.html#m5">cursor_pos</a>);
00103                     <a class="code" href="ALL_8H.html#a0">err_when</a>( cursor_pos &lt; 0 || cursor_pos &gt; strlen(<a class="code" href="classGetA.html#m3">input_field</a>) );
00104                 }
00105             }
00106             <a class="code" href="ALL_8H.html#a0">err_when</a>( cursor_pos &lt; 0 || cursor_pos &gt; strlen(<a class="code" href="classGetA.html#m3">input_field</a>) );
00107             <a class="code" href="ALL_8H.html#a0">err_when</a>( mark_cursor_pos &lt; 0 || mark_cursor_pos &gt; strlen(<a class="code" href="classGetA.html#m3">input_field</a>) );
00108             <span class="keywordflow">return</span> keyCode;
00109         }
00110         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( keyCode == <a class="code" href="KEY_8H.html#a0">KEY_BACK_SPACE</a> ) {
00111             <span class="keywordflow">if</span>( <a class="code" href="classGetA.html#a12">is_select</a>() ) {
00112                 <a class="code" href="ALL_8H.html#a0">err_when</a>( cursor_pos &lt; 0 || cursor_pos &gt; strlen(<a class="code" href="classGetA.html#m3">input_field</a>) );
00113                 <a class="code" href="ALL_8H.html#a0">err_when</a>( mark_cursor_pos &lt; 0 || mark_cursor_pos &gt; strlen(<a class="code" href="classGetA.html#m3">input_field</a>) );
00114                 <span class="comment">// erase selected area</span>
00115                 memmove( <a class="code" href="classGetA.html#m3">input_field</a>+<a class="code" href="classGetA.html#a10">mark_begin</a>(), <a class="code" href="classGetA.html#m3">input_field</a>+<a class="code" href="classGetA.html#a11">mark_end</a>(),
00116                          strlen(<a class="code" href="classGetA.html#m3">input_field</a>)-<a class="code" href="classGetA.html#a11">mark_end</a>()+1);
00117                 <span class="comment">//chwg1218</span>
00118                 <a class="code" href="classGetA.html#m5">cursor_pos</a> = <a class="code" href="classGetA.html#a10">mark_begin</a>();
00119                 <a class="code" href="classGetA.html#m6">mark_cursor_pos</a> = <a class="code" href="classGetA.html#m5">cursor_pos</a>;
00120                 <a class="code" href="classGetA.html#a9">clear_select</a>();
00121             }
00122             <span class="keywordflow">else</span> {
00123                 <span class="keywordflow">if</span>(<a class="code" href="classGetA.html#m5">cursor_pos</a> &gt; 0) {
00124                     <a class="code" href="ALL_8H.html#a0">err_when</a>( cursor_pos &lt; 0 || cursor_pos &gt; strlen(<a class="code" href="classGetA.html#m3">input_field</a>) );
00125                     memmove( <a class="code" href="classGetA.html#m3">input_field</a>+<a class="code" href="classGetA.html#m5">cursor_pos</a>-1, <a class="code" href="classGetA.html#m3">input_field</a>+<a class="code" href="classGetA.html#m5">cursor_pos</a>,
00126                              strlen(<a class="code" href="classGetA.html#m3">input_field</a>)-<a class="code" href="classGetA.html#m5">cursor_pos</a>+1);
00127                     <a class="code" href="classGetA.html#m5">cursor_pos</a>--;
00128                     <a class="code" href="ALL_8H.html#a0">err_when</a>( cursor_pos &lt; 0 || cursor_pos &gt; strlen(<a class="code" href="classGetA.html#m3">input_field</a>) );
00129                     <a class="code" href="classGetA.html#a9">clear_select</a>();
00130                 }
00131             }
00132             <a class="code" href="ALL_8H.html#a0">err_when</a>( cursor_pos &lt; 0 || cursor_pos &gt; strlen(<a class="code" href="classGetA.html#m3">input_field</a>) );
00133             <a class="code" href="ALL_8H.html#a0">err_when</a>( mark_cursor_pos &lt; 0 || mark_cursor_pos &gt; strlen(<a class="code" href="classGetA.html#m3">input_field</a>) );
00134             <span class="keywordflow">return</span> keyCode;
00135         }
00136         <span class="keywordflow">if</span>( keyCode == <a class="code" href="KEY_8H.html#a11">KEY_LEFT</a> ) {
00137             <span class="keywordflow">if</span>(<a class="code" href="classGetA.html#m5">cursor_pos</a> &gt; 0)
00138                 <a class="code" href="classGetA.html#m5">cursor_pos</a>--;
00139             <span class="keywordflow">if</span>( !shiftPressed )
00140                 <a class="code" href="classGetA.html#a9">clear_select</a>();
00141             <a class="code" href="ALL_8H.html#a0">err_when</a>( cursor_pos &lt; 0 || cursor_pos &gt; strlen(<a class="code" href="classGetA.html#m3">input_field</a>) );
00142             <a class="code" href="ALL_8H.html#a0">err_when</a>( mark_cursor_pos &lt; 0 || mark_cursor_pos &gt; strlen(<a class="code" href="classGetA.html#m3">input_field</a>) );
00143             <span class="keywordflow">return</span> keyCode;
00144         }
00145         <span class="keywordflow">if</span>( keyCode == <a class="code" href="KEY_8H.html#a10">KEY_RIGHT</a> ) {
00146             <span class="keywordflow">if</span>(<a class="code" href="classGetA.html#m5">cursor_pos</a> &lt; strlen(<a class="code" href="classGetA.html#m3">input_field</a>))
00147                 <a class="code" href="classGetA.html#m5">cursor_pos</a>++;
00148             <span class="keywordflow">if</span>( !shiftPressed )
00149                 <a class="code" href="classGetA.html#a9">clear_select</a>();
00150             <a class="code" href="ALL_8H.html#a0">err_when</a>( cursor_pos &lt; 0 || cursor_pos &gt; strlen(<a class="code" href="classGetA.html#m3">input_field</a>) );
00151             <a class="code" href="ALL_8H.html#a0">err_when</a>( mark_cursor_pos &lt; 0 || mark_cursor_pos &gt; strlen(<a class="code" href="classGetA.html#m3">input_field</a>) );
00152             <span class="keywordflow">return</span> keyCode;
00153         }
00154         <span class="keywordflow">if</span>( keyCode == <a class="code" href="KEY_8H.html#a4">KEY_HOME</a>) {
00155             <a class="code" href="classGetA.html#m5">cursor_pos</a> = 0;
00156             <span class="keywordflow">if</span>( !shiftPressed )
00157                 <a class="code" href="classGetA.html#a9">clear_select</a>();
00158             <a class="code" href="ALL_8H.html#a0">err_when</a>( cursor_pos &lt; 0 || cursor_pos &gt; strlen(<a class="code" href="classGetA.html#m3">input_field</a>) );
00159             <a class="code" href="ALL_8H.html#a0">err_when</a>( mark_cursor_pos &lt; 0 || mark_cursor_pos &gt; strlen(<a class="code" href="classGetA.html#m3">input_field</a>) );
00160             <span class="keywordflow">return</span> keyCode;
00161         }
00162         <span class="keywordflow">if</span>( keyCode == <a class="code" href="KEY_8H.html#a5">KEY_END</a>) {
00163             <a class="code" href="classGetA.html#m5">cursor_pos</a> = strlen(<a class="code" href="classGetA.html#m3">input_field</a>);
00164             <span class="keywordflow">if</span>( !shiftPressed )
00165                 <a class="code" href="classGetA.html#a9">clear_select</a>();
00166             <a class="code" href="ALL_8H.html#a0">err_when</a>( cursor_pos &lt; 0 || cursor_pos &gt; strlen(<a class="code" href="classGetA.html#m3">input_field</a>) );
00167             <a class="code" href="ALL_8H.html#a0">err_when</a>( mark_cursor_pos &lt; 0 || mark_cursor_pos &gt; strlen(<a class="code" href="classGetA.html#m3">input_field</a>) );
00168             <span class="keywordflow">return</span> keyCode;
00169         }
00170         <span class="keywordflow">if</span>( <a class="code" href="classGetA.html#m10">esc_key_flag</a> &amp;&amp; keyCode == <a class="code" href="KEY_8H.html#a2">KEY_ESC</a> ) {
00171             <span class="comment">// if esc_key_flag is 0 and ESC key pressed, still return 0</span>
00172             <a class="code" href="classGetA.html#a3">clear</a>();
00173             <span class="keywordflow">return</span> keyCode;
00174         }
00175         <span class="keywordflow">if</span>( keyCode == <a class="code" href="KEY_8H.html#a3">KEY_RETURN</a> || keyCode == <a class="code" href="KEY_8H.html#a8">KEY_UP</a> ||
00176             keyCode == <a class="code" href="KEY_8H.html#a9">KEY_DOWN</a> || keyCode == <a class="code" href="KEY_8H.html#a1">KEY_TAB</a> ) {
00177             <span class="keywordflow">return</span> keyCode;
00178         }
00179     }
00180 
00181     <span class="keywordflow">return</span> 0;
00182 }
00183 
00184 <span class="comment">//############# begin Norris 0707 #############//</span>
00185 
<a name="l00186"></a><a class="code" href="classGetA.html#a7">00186</a> <span class="keywordtype">void</span> <a class="code" href="classGetA.html#a7">GetA::paint</a>(<span class="keywordtype">int</span> paintCursor) {
00187 
00188     <span class="comment">//## chwg0524</span>
00189     <span class="keywordflow">if</span>(<a class="code" href="classGetA.html#m5">cursor_pos</a>&lt;0)
00190         <a class="code" href="classGetA.html#m5">cursor_pos</a>=0;
00191     <span class="keywordflow">if</span>(<a class="code" href="classGetA.html#m5">cursor_pos</a> &gt; strlen(<a class="code" href="classGetA.html#m3">input_field</a>))
00192         <a class="code" href="classGetA.html#m5">cursor_pos</a>=strlen(<a class="code" href="classGetA.html#m3">input_field</a>);
00193 
00194     <span class="keywordflow">if</span>(<a class="code" href="classGetA.html#m6">mark_cursor_pos</a>&lt;0)
00195         <a class="code" href="classGetA.html#m6">mark_cursor_pos</a>=0;
00196     <span class="keywordflow">if</span>(<a class="code" href="classGetA.html#m6">mark_cursor_pos</a> &gt; strlen(<a class="code" href="classGetA.html#m3">input_field</a>))
00197         <a class="code" href="classGetA.html#m6">mark_cursor_pos</a>=strlen(<a class="code" href="classGetA.html#m3">input_field</a>);
00198     <span class="comment">//## chwg0524 end</span>
00199 
00200     <span class="comment">//  err_when( mark_cursor_pos &lt; 0 || mark_cursor_pos &gt; strlen(input_field) );</span>
00201     <span class="comment">//  err_when( cursor_pos &lt; 0 || cursor_pos &gt; strlen(input_field) );</span>
00202 
00203     <span class="keywordtype">int</span> cursorX = <a class="code" href="classGetA.html#m7">font_ptr</a>-&gt;<a class="code" href="classFont.html#a8">text_width</a>(<a class="code" href="classGetA.html#m3">input_field</a>, <a class="code" href="classGetA.html#m5">cursor_pos</a>);
00204     <span class="keywordtype">int</span> leftX = <a class="code" href="classGetA.html#m7">font_ptr</a>-&gt;<a class="code" href="classFont.html#a8">text_width</a>(<a class="code" href="classGetA.html#m3">input_field</a>, <a class="code" href="classGetA.html#a10">mark_begin</a>());
00205     <span class="keywordtype">int</span> rightX = <a class="code" href="classGetA.html#m7">font_ptr</a>-&gt;<a class="code" href="classFont.html#a8">text_width</a>(<a class="code" href="classGetA.html#m3">input_field</a>, <a class="code" href="classGetA.html#a11">mark_end</a>());
00206 
00207     <span class="comment">// create a temp buffer to store character</span>
00208     <span class="keywordtype">int</span> rightLimit = <a class="code" href="classGetA.html#m2">x_limit</a> - <a class="code" href="classGetA.html#m0">x</a>;
00209     <span class="keywordtype">int</span> textWidth = <a class="code" href="classGetA.html#m7">font_ptr</a>-&gt;<a class="code" href="classFont.html#a8">text_width</a>(<a class="code" href="classGetA.html#m3">input_field</a>, -1, rightLimit ) + 1;
00210     <span class="keywordtype">int</span> textHeight = <a class="code" href="classGetA.html#m7">font_ptr</a>-&gt;<a class="code" href="classFont.html#m6">max_font_height</a>;
00211 
00212     <span class="keywordtype">short</span> *bitmap = (<span class="keywordtype">short</span>*)sys.common_data_buf;
00213     <a class="code" href="ALL_8H.html#a0">err_when</a>( (2 + textWidth * textHeight) * <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>)&gt; <a class="code" href="Osys_8h.html#a40a2">COMMON_DATA_BUF_SIZE</a> );
00214 
00215     *bitmap++ = textWidth;
00216     *bitmap++ = textHeight;
00217 
00218     <span class="comment">//  memset( bitmap, transparent_code_w, textWidth * textHeight * sizeof(short) );</span>
00219     <span class="keywordtype">short</span> *shortPtr = bitmap;
00220     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; textWidth * textHeight; i++) {
00221         *shortPtr++ = transparent_code_w;
00222     }
00223 
00224     <span class="keywordflow">if</span>( <a class="code" href="classGetA.html#m11">back_ground_bitmap</a> &amp;&amp; !<a class="code" href="classVga.html#p1">Vga::use_back_buf</a> ) {
00225         <span class="keywordtype">short</span> backGroundWidth = *<a class="code" href="classGetA.html#m11">back_ground_bitmap</a>;
00226         <span class="keywordtype">short</span> backGroundHeight = *(<a class="code" href="classGetA.html#m11">back_ground_bitmap</a>+1);
00227         <span class="comment">// fill backGround</span>
00228         <span class="keywordflow">switch</span>(align_flag) {
00229         <span class="keywordflow">case</span> 0:
00230             <a class="code" href="IMGFUN_8H.html#a24">IMGbltWArea</a>(bitmap, textWidth, 0, 0, <a class="code" href="classGetA.html#m11">back_ground_bitmap</a>,
00231                         0, 0, min(textWidth, backGroundWidth)-1, min(textHeight, backGroundHeight)-1);
00232             <span class="keywordflow">break</span>;
00233         <span class="keywordflow">case</span> 1: {
00234             <span class="keywordtype">int</span> l = (<a class="code" href="classGetA.html#m2">x_limit</a> - <a class="code" href="classGetA.html#m0">x</a> + 1 - textWidth ) / 2;
00235             <span class="keywordflow">if</span>( l &gt;= 0 &amp;&amp; l &lt; backGroundWidth )
00236                 <a class="code" href="IMGFUN_8H.html#a24">IMGbltWArea</a>(bitmap, textWidth, 0, 0, <a class="code" href="classGetA.html#m11">back_ground_bitmap</a>,
00237                             l, 0, min(l+textWidth, backGroundWidth)-1, min(textHeight, backGroundHeight)-1 );
00238         }
00239         <span class="keywordflow">break</span>;
00240         <span class="keywordflow">case</span> -1: {
00241             <span class="keywordtype">int</span> l = <a class="code" href="classGetA.html#m2">x_limit</a> - textWidth + 1 - <a class="code" href="classGetA.html#m0">x</a>;
00242             <span class="keywordflow">if</span>( l &lt; backGroundWidth )
00243                 <a class="code" href="IMGFUN_8H.html#a24">IMGbltWArea</a>(bitmap, textWidth, 0, 0, <a class="code" href="classGetA.html#m11">back_ground_bitmap</a>,
00244                             l, 0, min(<a class="code" href="classGetA.html#m2">x_limit</a>-<a class="code" href="classGetA.html#m0">x</a>+1, backGroundWidth)-1, min(textHeight, backGroundHeight)-1 );
00245         }
00246         <span class="keywordflow">break</span>;
00247         <span class="keywordflow">default</span>:
00248             <a class="code" href="ALL_8H.html#a1">err_here</a>();
00249         }
00250     }
00251     <a class="code" href="classGetA.html#m7">font_ptr</a>-&gt;<a class="code" href="classFont.html#a26">put_to_bufferW</a>(bitmap, textWidth * <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>), 0, 0, <a class="code" href="classGetA.html#m3">input_field</a>);
00252 
00253     <span class="keywordflow">if</span>( paintCursor &amp;&amp; <a class="code" href="classGetA.html#m9">enable_flag</a> &amp;&amp; cursorX &lt; <a class="code" href="classGetA.html#m2">x_limit</a> ) {
00254         <span class="comment">// horizontal bar for selected area</span>
00255         <span class="keywordflow">if</span>( leftX &lt; textWidth ) {
00256             <a class="code" href="IMGFUN_8H.html#a6">IMGbar</a>( bitmap, textWidth * <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>),
00257                     leftX, <a class="code" href="classGetA.html#m7">font_ptr</a>-&gt;<a class="code" href="classFont.html#a4">height</a>()-1, min(rightX, textWidth-1), <a class="code" href="classGetA.html#m7">font_ptr</a>-&gt;<a class="code" href="classFont.html#a4">height</a>()-1, 0);
00258         }
00259 
00260         <span class="comment">// vertical bar</span>
00261         <span class="keywordflow">if</span>( cursorX &lt; textWidth )
00262             <a class="code" href="IMGFUN_8H.html#a6">IMGbar</a>( bitmap, textWidth * <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>), cursorX, 0, cursorX, <a class="code" href="classGetA.html#m7">font_ptr</a>-&gt;<a class="code" href="classFont.html#a4">height</a>()-1, 0);
00263     }
00264 
00265     <span class="keywordflow">if</span>( !<a class="code" href="classVga.html#p1">Vga::use_back_buf</a>) {
00266         mouse.hide_area(<a class="code" href="classGetA.html#m0">x</a>,<a class="code" href="classGetA.html#m1">y</a>, <a class="code" href="classGetA.html#m2">x_limit</a>, <a class="code" href="classGetA.html#m1">y</a>+<a class="code" href="classGetA.html#m7">font_ptr</a>-&gt;<a class="code" href="classFont.html#m6">max_font_height</a>-1 );
00267 
00268         <span class="keywordflow">switch</span>( align_flag ) {
00269         <span class="keywordflow">case</span> 0:                                     <span class="comment">// left justified</span>
00270             <span class="keywordflow">if</span>( !<a class="code" href="classGetA.html#m11">back_ground_bitmap</a> ) {
00271                 <span class="keywordflow">if</span>( <a class="code" href="classGetA.html#m0">x</a>+textWidth &lt;= <a class="code" href="classGetA.html#m2">x_limit</a> )            <span class="comment">// fill right</span>
00272                     vga.blt_buf( <a class="code" href="classGetA.html#m0">x</a>+textWidth, <a class="code" href="classGetA.html#m1">y</a>, <a class="code" href="classGetA.html#m2">x_limit</a>, <a class="code" href="classGetA.html#m1">y</a> + <a class="code" href="classGetA.html#m7">font_ptr</a>-&gt;<a class="code" href="classFont.html#m6">max_font_height</a>-1, 0);
00273                 <span class="keywordtype">short</span> blt_buf_x2 = <a class="code" href="classGetA.html#m0">x</a> + *((<span class="keywordtype">short</span>*)sys.common_data_buf);
00274                 <span class="keywordtype">short</span> blt_buf_y2 = <a class="code" href="classGetA.html#m1">y</a> + *(((<span class="keywordtype">short</span>*)sys.common_data_buf)+1);
00275                 vga.blt_buf(<a class="code" href="classGetA.html#m0">x</a>, <a class="code" href="classGetA.html#m1">y</a>, blt_buf_x2, blt_buf_y2);
00276                 vga_front.put_bitmapW_trans(<a class="code" href="classGetA.html#m0">x</a>, <a class="code" href="classGetA.html#m1">y</a>, (<span class="keywordtype">short</span>*)sys.common_data_buf);
00277                 <span class="comment">//                              IMGjoinTrans(vga_front.buf_ptr(), vga_front.buf_pitch(),</span>
00278                 <span class="comment">//                                      vga_back.buf_ptr(), vga_back.buf_pitch(),</span>
00279                 <span class="comment">//                                      x, y, sys.common_data_buf);</span>
00280             }
00281             <span class="keywordflow">else</span> {
00282                 <span class="keywordtype">short</span> backGroundWidth = *(<span class="keywordtype">short</span> *)<a class="code" href="classGetA.html#m11">back_ground_bitmap</a>;
00283                 <span class="keywordtype">short</span> backGroundHeight = *(1+(<span class="keywordtype">short</span> *)<a class="code" href="classGetA.html#m11">back_ground_bitmap</a>);
00284                 <span class="comment">// fill right</span>
00285                 <span class="keywordflow">if</span>( textWidth &lt; backGroundWidth &amp;&amp; <a class="code" href="classGetA.html#m0">x</a>+textWidth &lt;= <a class="code" href="classGetA.html#m2">x_limit</a> )
00286                     vga_front.put_bitmapW_area(<a class="code" href="classGetA.html#m0">x</a>, <a class="code" href="classGetA.html#m1">y</a>, <a class="code" href="classGetA.html#m11">back_ground_bitmap</a>,
00287                                                textWidth, 0, min(<a class="code" href="classGetA.html#m2">x_limit</a>-<a class="code" href="classGetA.html#m0">x</a>, backGroundWidth-1), backGroundHeight-1 );
00288                 vga_front.put_bitmapW_trans(<a class="code" href="classGetA.html#m0">x</a>, <a class="code" href="classGetA.html#m1">y</a>, (<span class="keywordtype">short</span>*)sys.common_data_buf);
00289             }
00290             <span class="keywordflow">break</span>;
00291 
00292         <span class="keywordflow">case</span> 1:                                     <span class="comment">// center justified</span>
00293             <span class="keywordflow">if</span>( !<a class="code" href="classGetA.html#m11">back_ground_bitmap</a> ) {
00294                 <span class="keywordtype">int</span> l = <a class="code" href="classGetA.html#m0">x</a> + (<a class="code" href="classGetA.html#m2">x_limit</a> - <a class="code" href="classGetA.html#m0">x</a> + 1 - textWidth ) / 2;
00295                 <span class="keywordflow">if</span>( <a class="code" href="classGetA.html#m0">x</a> &lt; l ) {
00296                     vga.blt_buf( <a class="code" href="classGetA.html#m0">x</a>, <a class="code" href="classGetA.html#m1">y</a>, l-1, <a class="code" href="classGetA.html#m1">y</a> + <a class="code" href="classGetA.html#m7">font_ptr</a>-&gt;<a class="code" href="classFont.html#m6">max_font_height</a>-1, 0);
00297                 }
00298                 <span class="keywordflow">if</span>( l+textWidth &lt;= <a class="code" href="classGetA.html#m2">x_limit</a> ) {
00299                     vga.blt_buf( l+textWidth, <a class="code" href="classGetA.html#m1">y</a>, <a class="code" href="classGetA.html#m2">x_limit</a>, <a class="code" href="classGetA.html#m1">y</a> + <a class="code" href="classGetA.html#m7">font_ptr</a>-&gt;<a class="code" href="classFont.html#m6">max_font_height</a>-1, 0);
00300                 }
00301                 <span class="keywordtype">short</span> blt_buf_x2 = l + *((<span class="keywordtype">short</span>*)sys.common_data_buf);
00302                 <span class="keywordtype">short</span> blt_buf_y2 = <a class="code" href="classGetA.html#m1">y</a> + *(((<span class="keywordtype">short</span>*)sys.common_data_buf)+1);
00303                 vga.blt_buf(l, <a class="code" href="classGetA.html#m1">y</a>, blt_buf_x2, blt_buf_y2);
00304                 vga_front.put_bitmapW_trans(l, <a class="code" href="classGetA.html#m1">y</a>, (<span class="keywordtype">short</span>*)sys.common_data_buf);
00305                 <span class="comment">//                              IMGjoinTrans(vga_front.buf_ptr(), vga_front.buf_pitch(),</span>
00306                 <span class="comment">//                                      vga_back.buf_ptr(), vga_back.buf_pitch(),</span>
00307                 <span class="comment">//                                      l, y, sys.common_data_buf);</span>
00308             }
00309             <span class="keywordflow">else</span> {
00310                 <span class="keywordtype">int</span> l = <a class="code" href="classGetA.html#m0">x</a> + (<a class="code" href="classGetA.html#m2">x_limit</a> - <a class="code" href="classGetA.html#m0">x</a> + 1 - textWidth ) / 2;
00311                 <span class="keywordtype">short</span> backGroundWidth = *(<span class="keywordtype">short</span> *)<a class="code" href="classGetA.html#m11">back_ground_bitmap</a>;
00312                 <span class="keywordtype">short</span> backGroundHeight = *(1+(<span class="keywordtype">short</span> *)<a class="code" href="classGetA.html#m11">back_ground_bitmap</a>);
00313                 <span class="keywordflow">if</span>( <a class="code" href="classGetA.html#m0">x</a> &lt; l &amp;&amp; l-<a class="code" href="classGetA.html#m0">x</a> &lt;= backGroundWidth) {
00314                     vga_front.put_bitmapW_area(<a class="code" href="classGetA.html#m0">x</a>, <a class="code" href="classGetA.html#m1">y</a>, <a class="code" href="classGetA.html#m11">back_ground_bitmap</a>,
00315                                                0, 0, min(l-<a class="code" href="classGetA.html#m0">x</a>, backGroundWidth)-1, backGroundHeight-1);
00316                 }
00317                 <span class="keywordflow">if</span>( l+textWidth &lt;= <a class="code" href="classGetA.html#m2">x_limit</a> &amp;&amp; l+textWidth-<a class="code" href="classGetA.html#m0">x</a> &lt; backGroundWidth) {
00318                     vga_front.put_bitmapW_area(<a class="code" href="classGetA.html#m0">x</a>, <a class="code" href="classGetA.html#m1">y</a>, <a class="code" href="classGetA.html#m11">back_ground_bitmap</a>,
00319                                                l+textWidth-<a class="code" href="classGetA.html#m0">x</a>, 0, min(<a class="code" href="classGetA.html#m2">x_limit</a>-<a class="code" href="classGetA.html#m0">x</a>+1, backGroundWidth)-1, backGroundHeight-1);
00320                 }
00321                 vga_front.put_bitmapW_trans(l, <a class="code" href="classGetA.html#m1">y</a>, (<span class="keywordtype">short</span>*)sys.common_data_buf);
00322             }
00323             <span class="keywordflow">break</span>;
00324 
00325         <span class="keywordflow">case</span> -1:                                    <span class="comment">// right justified</span>
00326             <span class="keywordflow">if</span>( !<a class="code" href="classGetA.html#m11">back_ground_bitmap</a> ) {
00327                 <span class="keywordtype">int</span> l = <a class="code" href="classGetA.html#m2">x_limit</a> - textWidth + 1;
00328                 <span class="keywordflow">if</span>( <a class="code" href="classGetA.html#m0">x</a> &lt; l )                             <span class="comment">// fill left</span>
00329                     vga.blt_buf( <a class="code" href="classGetA.html#m0">x</a>, <a class="code" href="classGetA.html#m1">y</a>, l-1, <a class="code" href="classGetA.html#m1">y</a> + <a class="code" href="classGetA.html#m7">font_ptr</a>-&gt;<a class="code" href="classFont.html#m6">max_font_height</a>-1, 0);
00330                 <span class="keywordtype">short</span> blt_buf_x2 = l + *((<span class="keywordtype">short</span>*)sys.common_data_buf);
00331                 <span class="keywordtype">short</span> blt_buf_y2 = <a class="code" href="classGetA.html#m1">y</a> + *(((<span class="keywordtype">short</span>*)sys.common_data_buf)+1);
00332                 vga.blt_buf(l, <a class="code" href="classGetA.html#m1">y</a>, blt_buf_x2, blt_buf_y2);
00333                 vga_front.put_bitmapW_trans(l, <a class="code" href="classGetA.html#m1">y</a>, (<span class="keywordtype">short</span>*)sys.common_data_buf);
00334                 <span class="comment">//                              IMGjoinTrans(vga_front.buf_ptr(), vga_front.buf_pitch(),</span>
00335                 <span class="comment">//                                      vga_back.buf_ptr(), vga_back.buf_pitch(),</span>
00336                 <span class="comment">//                                      l, y, sys.common_data_buf);</span>
00337             }
00338             <span class="keywordflow">else</span> {
00339                 <span class="keywordtype">short</span> backGroundWidth = *(<span class="keywordtype">short</span> *)<a class="code" href="classGetA.html#m11">back_ground_bitmap</a>;
00340                 <span class="keywordtype">short</span> backGroundHeight = *(1+(<span class="keywordtype">short</span> *)<a class="code" href="classGetA.html#m11">back_ground_bitmap</a>);
00341                 <span class="keywordtype">int</span> l = <a class="code" href="classGetA.html#m2">x_limit</a> - textWidth + 1;
00342                 <span class="keywordflow">if</span>( <a class="code" href="classGetA.html#m0">x</a> &lt; l )
00343                     vga_front.put_bitmapW_area(0, 0, <a class="code" href="classGetA.html#m11">back_ground_bitmap</a>,
00344                                                0, 0, min(l-<a class="code" href="classGetA.html#m0">x</a>, backGroundWidth)-1, backGroundHeight-1 );
00345                 vga_front.put_bitmapW_trans(l, <a class="code" href="classGetA.html#m1">y</a>, (<span class="keywordtype">short</span>*)sys.common_data_buf);
00346             }
00347             <span class="keywordflow">break</span>;
00348 
00349         <span class="keywordflow">default</span>:
00350             <a class="code" href="ALL_8H.html#a1">err_here</a>();
00351         }
00352         mouse.show_area();
00353     }
00354     <span class="keywordflow">else</span> {
00355         <span class="keywordflow">switch</span>( align_flag ) {
00356         <span class="keywordflow">case</span> 0:                                     <span class="comment">// left justified</span>
00357             <span class="comment">//                  IMGbltWTrans( vga_back.buf_ptr(), vga_back.buf_pitch(),</span>
00358             <span class="comment">//                          x, y, (short*)sys.common_data_buf);</span>
00359             vga_back.put_bitmapW_trans(<a class="code" href="classGetA.html#m0">x</a>, <a class="code" href="classGetA.html#m1">y</a>, (<span class="keywordtype">short</span>*)sys.common_data_buf);
00360             <span class="keywordflow">break</span>;
00361 
00362         <span class="keywordflow">case</span> 1: {                                   <span class="comment">// center justified</span>
00363             <span class="keywordtype">int</span> l = <a class="code" href="classGetA.html#m0">x</a> + (<a class="code" href="classGetA.html#m2">x_limit</a> - <a class="code" href="classGetA.html#m0">x</a> + 1 - textWidth ) / 2;
00364             <span class="comment">//                          IMGbltWTrans( vga_back.buf_ptr(), vga_back.buf_pitch(),</span>
00365             <span class="comment">//                                  l, y, (short*)sys.common_data_buf);</span>
00366             vga_back.put_bitmapW_trans(<a class="code" href="classGetA.html#m0">x</a>, l, (<span class="keywordtype">short</span>*)sys.common_data_buf);
00367         }
00368 
00369         <span class="comment">// BUGHERE : fill left and right</span>
00370         <span class="keywordflow">break</span>;
00371 
00372         <span class="keywordflow">case</span> -1:                                    <span class="comment">// right justified</span>
00373             <span class="comment">//                  IMGbltWTrans( vga_back.buf_ptr(), vga_back.buf_pitch(),</span>
00374             <span class="comment">//                          x_limit - textWidth + 1, y, (short*)sys.common_data_buf);</span>
00375             vga_back.put_bitmapW_trans(<a class="code" href="classGetA.html#m2">x_limit</a>-textWidth+1, <a class="code" href="classGetA.html#m1">y</a>, (<span class="keywordtype">short</span>*)sys.common_data_buf);
00376             <span class="keywordflow">break</span>;
00377 
00378         <span class="keywordflow">default</span>:
00379             <a class="code" href="ALL_8H.html#a1">err_here</a>();
00380         }
00381     }
00382 }
00383 
00384 <span class="comment">//############### end Norris 0707 #############//</span>
00385 
<a name="l00386"></a><a class="code" href="classGetA.html#a8">00386</a> <span class="keywordtype">int</span> <a class="code" href="classGetA.html#a8">GetA::cursor_x</a>(<span class="keywordtype">int</span> curPos) {
00387     <span class="keywordflow">switch</span>( align_flag ) {
00388     <span class="keywordflow">case</span> 0:                                       <span class="comment">// left justified</span>
00389         <span class="keywordflow">return</span> <a class="code" href="classGetA.html#m0">x</a> + <a class="code" href="classGetA.html#m7">font_ptr</a>-&gt;<a class="code" href="classFont.html#a8">text_width</a>(<a class="code" href="classGetA.html#m3">input_field</a>, curPos);
00390     <span class="keywordflow">case</span> 1:                                       <span class="comment">// center justified</span>
00391         <span class="keywordflow">return</span> <a class="code" href="classGetA.html#m0">x</a> + ((<a class="code" href="classGetA.html#m2">x_limit</a>-<a class="code" href="classGetA.html#m0">x</a>) - <a class="code" href="classGetA.html#m7">font_ptr</a>-&gt;<a class="code" href="classFont.html#a8">text_width</a>(<a class="code" href="classGetA.html#m3">input_field</a>))/2 + <a class="code" href="classGetA.html#m7">font_ptr</a>-&gt;<a class="code" href="classFont.html#a8">text_width</a>(<a class="code" href="classGetA.html#m3">input_field</a>, curPos);
00392     <span class="keywordflow">case</span> -1:                                      <span class="comment">// right justified</span>
00393         <span class="keywordflow">return</span> <a class="code" href="classGetA.html#m2">x_limit</a> - <a class="code" href="classGetA.html#m7">font_ptr</a>-&gt;<a class="code" href="classFont.html#a8">text_width</a>(<a class="code" href="classGetA.html#m3">input_field</a>) + <a class="code" href="classGetA.html#m7">font_ptr</a>-&gt;<a class="code" href="classFont.html#a8">text_width</a>(<a class="code" href="classGetA.html#m3">input_field</a>, curPos);
00394     <span class="keywordflow">default</span>:
00395         <a class="code" href="ALL_8H.html#a1">err_here</a>();
00396         <span class="keywordflow">return</span> 0;
00397     }
00398 }
00399 
00400 <span class="comment">// return 1 for selected</span>
<a name="l00401"></a><a class="code" href="classGetA.html#a5">00401</a> <span class="keywordtype">int</span> <a class="code" href="classGetA.html#a5">GetA::detect_click</a>() {
00402     <span class="keywordflow">if</span>( !<a class="code" href="classGetA.html#m9">enable_flag</a> )
00403         <span class="keywordflow">return</span> 0;
00404 
00405     <span class="keywordflow">if</span>( !<a class="code" href="classGetA.html#m12">mouse_drag_flag</a> ) {
00406         <span class="keywordtype">int</span> clickCount = mouse.any_click(<a class="code" href="classGetA.html#m0">x</a>-<a class="code" href="classGetA.html#m7">font_ptr</a>-&gt;<a class="code" href="classFont.html#m7">max_font_width</a>, <a class="code" href="classGetA.html#m1">y</a>, <a class="code" href="classGetA.html#m2">x_limit</a>, <a class="code" href="classGetA.html#m1">y</a>+<a class="code" href="classGetA.html#a2">height</a>()-1);
00407         <span class="keywordflow">if</span>( clickCount == 1) {
00408             <span class="comment">// set cursor_pos</span>
00409             <span class="comment">// scan from the last character, until the clicked x is</span>
00410             <span class="comment">// less than the character x</span>
00411             <span class="keywordflow">for</span>( <a class="code" href="classGetA.html#m5">cursor_pos</a> = strlen(<a class="code" href="classGetA.html#m3">input_field</a>);
00412                  <a class="code" href="classGetA.html#m5">cursor_pos</a> &gt; 0 &amp;&amp; mouse.click_x() &lt; <a class="code" href="classGetA.html#a8">cursor_x</a>(<a class="code" href="classGetA.html#m5">cursor_pos</a>);
00413                  --<a class="code" href="classGetA.html#m5">cursor_pos</a> );
00414             <a class="code" href="ALL_8H.html#a0">err_when</a>( cursor_pos &lt; 0 || cursor_pos &gt; strlen(<a class="code" href="classGetA.html#m3">input_field</a>));
00415             <a class="code" href="classGetA.html#a9">clear_select</a>();
00416             <a class="code" href="classGetA.html#m12">mouse_drag_flag</a> = 1;
00417             <span class="keywordflow">return</span> 1;
00418         }
00419         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( clickCount &gt; 1 ) {
00420             <a class="code" href="classGetA.html#a13">select_whole</a>();
00421             <span class="keywordflow">return</span> 1;
00422         }
00423     }
00424     <span class="keywordflow">else</span> {
00425         <span class="keywordflow">if</span>( !mouse.left_press ) {
00426             <a class="code" href="classGetA.html#m12">mouse_drag_flag</a> = 0;
00427         }
00428         <span class="keywordflow">for</span>( <a class="code" href="classGetA.html#m5">cursor_pos</a> = strlen(<a class="code" href="classGetA.html#m3">input_field</a>);
00429              <a class="code" href="classGetA.html#m5">cursor_pos</a> &gt; 0 &amp;&amp; mouse.cur_x &lt; <a class="code" href="classGetA.html#a8">cursor_x</a>(<a class="code" href="classGetA.html#m5">cursor_pos</a>);
00430              --<a class="code" href="classGetA.html#m5">cursor_pos</a> );
00431         <a class="code" href="ALL_8H.html#a0">err_when</a>( cursor_pos &lt; 0 || cursor_pos &gt; strlen(<a class="code" href="classGetA.html#m3">input_field</a>));
00432         <span class="keywordflow">return</span> 1;
00433     }
00434     <span class="keywordflow">return</span> 0;
00435 }
00436 
<a name="l00437"></a><a class="code" href="classGetA.html#a6">00437</a> <span class="keywordtype">unsigned</span> <a class="code" href="classGetA.html#a6">GetA::detect</a>() {
00438     <span class="keywordtype">unsigned</span> keyCode = <a class="code" href="classGetA.html#a4">detect_key</a>();
00439     <span class="keywordflow">if</span>( keyCode )
00440         <span class="keywordflow">return</span> keyCode;
00441     <span class="keywordflow">else</span>
00442         <span class="keywordflow">return</span> <a class="code" href="classGetA.html#a5">detect_click</a>();
00443 }
00444 
<a name="l00445"></a><a class="code" href="classGetA.html#a10">00445</a> <span class="keywordtype">unsigned</span> <a class="code" href="classGetA.html#a10">GetA::mark_begin</a>() {
00446     <span class="keywordflow">return</span> min( <a class="code" href="classGetA.html#m5">cursor_pos</a>, <a class="code" href="classGetA.html#m6">mark_cursor_pos</a> );
00447 }
00448 
<a name="l00449"></a><a class="code" href="classGetA.html#a11">00449</a> <span class="keywordtype">unsigned</span> <a class="code" href="classGetA.html#a11">GetA::mark_end</a>() {
00450     <span class="keywordflow">return</span> max( <a class="code" href="classGetA.html#m5">cursor_pos</a>, <a class="code" href="classGetA.html#m6">mark_cursor_pos</a> );
00451 }
00452 
<a name="l00453"></a><a class="code" href="classGetA.html#a13">00453</a> <span class="keywordtype">void</span> <a class="code" href="classGetA.html#a13">GetA::select_whole</a>() {
00454     <a class="code" href="classGetA.html#m5">cursor_pos</a> = strlen(<a class="code" href="classGetA.html#m3">input_field</a>);
00455     <a class="code" href="classGetA.html#m6">mark_cursor_pos</a> = 0;
00456 }
00457 
<a name="l00458"></a><a class="code" href="classGetAGroup.html#a0">00458</a> <a class="code" href="classGetAGroup.html#a0">GetAGroup::GetAGroup</a>(<span class="keywordtype">int</span> n) {
00459     <a class="code" href="classGetAGroup.html#m0">geta_num</a> = n;
00460     <a class="code" href="classGetAGroup.html#m1">geta_array</a> = <span class="keyword">new</span> <a class="code" href="classGetA.html">GetA</a>[n];
00461     <a class="code" href="classGetAGroup.html#m2">focused_geta</a> = 0;
00462     <a class="code" href="classGetAGroup.html#m3">enable_flag</a> = 0;
00463 }
00464 
<a name="l00465"></a><a class="code" href="classGetAGroup.html#a1">00465</a> <a class="code" href="classGetAGroup.html#a1">GetAGroup::~GetAGroup</a>() {
00466     <span class="keyword">delete</span>[] <a class="code" href="classGetAGroup.html#m1">geta_array</a>;
00467 }
00468 
<a name="l00469"></a><a class="code" href="classGetAGroup.html#a2">00469</a> <span class="keywordtype">void</span> <a class="code" href="classGetAGroup.html#a2">GetAGroup::paint</a>() {
00470     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classGetAGroup.html#m0">geta_num</a>; ++i ) {
00471         <a class="code" href="classGetAGroup.html#m1">geta_array</a>[i].<a class="code" href="classGetA.html#a7">paint</a>(<a class="code" href="classGetAGroup.html#m2">focused_geta</a> == i);
00472     }
00473 }
00474 
<a name="l00475"></a><a class="code" href="classGetAGroup.html#a3">00475</a> <span class="keywordtype">int</span> <a class="code" href="classGetAGroup.html#a3">GetAGroup::detect</a>() {
00476     <span class="keywordflow">if</span>( !<a class="code" href="classGetAGroup.html#m3">enable_flag</a> )
00477         <span class="keywordflow">return</span> 0;
00478 
00479     <a class="code" href="ALL_8H.html#a0">err_when</a>( focused_geta &lt; 0 || focused_geta &gt; <a class="code" href="classGetAGroup.html#m0">geta_num</a>);
00480 
00481     <a class="code" href="classGetA.html">GetA</a> *getPtr = &amp;<a class="code" href="classGetAGroup.html#m1">geta_array</a>[<a class="code" href="classGetAGroup.html#m2">focused_geta</a>];
00482     <a class="code" href="ALL_8H.html#a0">err_when</a>( !getPtr-&gt;<a class="code" href="classGetA.html#m9">enable_flag</a> );
00483 
00484     <span class="keywordtype">unsigned</span> keyCode = getPtr-&gt;<a class="code" href="classGetA.html#a4">detect_key</a>();
00485     <span class="keywordflow">if</span>( keyCode ) {
00486         getPtr-&gt;<a class="code" href="classGetA.html#a7">paint</a>(1);
00487         <span class="comment">// detect change field focus button</span>
00488         <span class="keywordflow">if</span>( keyCode == <a class="code" href="KEY_8H.html#a3">KEY_RETURN</a> || keyCode == <a class="code" href="KEY_8H.html#a9">KEY_DOWN</a> || keyCode == <a class="code" href="KEY_8H.html#a1">KEY_TAB</a> ) {
00489             <a class="code" href="classGetAGroup.html#a4">set_focus</a>(-1);
00490         }
00491         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( keyCode == <a class="code" href="KEY_8H.html#a8">KEY_UP</a> ) {
00492             <a class="code" href="classGetAGroup.html#a4">set_focus</a>(-2);
00493         }
00494         <span class="keywordflow">return</span> 1;
00495     }
00496 
00497     <span class="comment">// detect clicking on the area</span>
00498     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classGetAGroup.html#m0">geta_num</a>; ++i ) {
00499         getPtr = &amp;geta_array[i];
00500         <span class="keywordflow">if</span>( getPtr-&gt;<a class="code" href="classGetA.html#a5">detect_click</a>() ) {
00501             <a class="code" href="classGetAGroup.html#a4">set_focus</a>(i);
00502             <span class="keywordflow">return</span> 1;
00503         }
00504     }
00505     <span class="keywordflow">return</span> 0;
00506 }
00507 
00508 <span class="comment">// n = -1, next</span>
00509 <span class="comment">// n = -2, prev</span>
00510 <span class="comment">// n = -3, top</span>
00511 <span class="comment">// n = -4, bottom</span>
<a name="l00512"></a><a class="code" href="classGetAGroup.html#a4">00512</a> <span class="keywordtype">int</span> <a class="code" href="classGetAGroup.html#a4">GetAGroup::set_focus</a>(<span class="keywordtype">int</span> n, <span class="keywordtype">int</span> paintFlag) {
00513     <span class="keywordtype">int</span> oldFocused = <a class="code" href="classGetAGroup.html#m2">focused_geta</a>;
00514     <span class="keywordtype">int</span> i, newFocused;
00515     <a class="code" href="classGetAGroup.html#m3">enable_flag</a> = 1;
00516     <a class="code" href="ALL_8H.html#a0">err_when</a>( n &lt; -4 || n &gt;= <a class="code" href="classGetAGroup.html#m0">geta_num</a> );
00517 
00518     <span class="keywordflow">switch</span>(n) {
00519     <span class="keywordflow">case</span> -1:
00520         <span class="keywordflow">for</span>( i = 0, newFocused = (oldFocused+1) % <a class="code" href="classGetAGroup.html#m0">geta_num</a>;
00521              i &lt; <a class="code" href="classGetAGroup.html#m0">geta_num</a> &amp;&amp; !<a class="code" href="classGetAGroup.html#m1">geta_array</a>[newFocused].<a class="code" href="classGetA.html#m9">enable_flag</a>;
00522              ++i, newFocused = (newFocused+1) % <a class="code" href="classGetAGroup.html#m0">geta_num</a> );
00523         <span class="keywordflow">break</span>;
00524     <span class="keywordflow">case</span> -2:
00525         <span class="keywordflow">for</span>( i = 0, newFocused = (oldFocused+<a class="code" href="classGetAGroup.html#m0">geta_num</a>-1) % <a class="code" href="classGetAGroup.html#m0">geta_num</a>;
00526              i &lt; <a class="code" href="classGetAGroup.html#m0">geta_num</a> &amp;&amp; !<a class="code" href="classGetAGroup.html#m1">geta_array</a>[newFocused].<a class="code" href="classGetA.html#m9">enable_flag</a>;
00527              ++i, newFocused = (newFocused+<a class="code" href="classGetAGroup.html#m0">geta_num</a>-1) % <a class="code" href="classGetAGroup.html#m0">geta_num</a> );
00528         <span class="keywordflow">break</span>;
00529     <span class="keywordflow">case</span> -3:
00530         <span class="keywordflow">for</span>( i = 0, newFocused = 0;
00531              i &lt; <a class="code" href="classGetAGroup.html#m0">geta_num</a> &amp;&amp; !<a class="code" href="classGetAGroup.html#m1">geta_array</a>[newFocused].<a class="code" href="classGetA.html#m9">enable_flag</a>;
00532              ++i, newFocused = (newFocused+1) % <a class="code" href="classGetAGroup.html#m0">geta_num</a> );
00533         <span class="keywordflow">break</span>;
00534     <span class="keywordflow">case</span> -4:
00535         <span class="keywordflow">for</span>( i = 0, newFocused = <a class="code" href="classGetAGroup.html#m0">geta_num</a>-1;
00536              i &lt; <a class="code" href="classGetAGroup.html#m0">geta_num</a> &amp;&amp; !<a class="code" href="classGetAGroup.html#m1">geta_array</a>[newFocused].<a class="code" href="classGetA.html#m9">enable_flag</a>;
00537              ++i, newFocused = (newFocused+<a class="code" href="classGetAGroup.html#m0">geta_num</a>-1) % <a class="code" href="classGetAGroup.html#m0">geta_num</a> );
00538         <span class="keywordflow">break</span>;
00539     <span class="keywordflow">default</span>:
00540         newFocused = n;
00541     }
00542 
00543     <a class="code" href="ALL_8H.html#a0">err_when</a>( !<a class="code" href="classGetAGroup.html#m1">geta_array</a>[newFocused].<a class="code" href="classGetAGroup.html#m3">enable_flag</a> );
00544     <a class="code" href="classGetAGroup.html#m2">focused_geta</a> = newFocused;
00545 
00546     <span class="keywordflow">if</span>( paintFlag ) {
00547         <span class="keywordflow">if</span>( oldFocused != newFocused )
00548             <a class="code" href="classGetAGroup.html#m1">geta_array</a>[oldFocused].<a class="code" href="classGetA.html#a7">paint</a>(0);
00549         <a class="code" href="classGetAGroup.html#m1">geta_array</a>[newFocused].<a class="code" href="classGetA.html#a7">paint</a>(1);
00550     }
00551 
00552     <span class="keywordflow">return</span> 1;
00553 }
00554 
<a name="l00555"></a><a class="code" href="classGetAGroup.html#a5">00555</a> <a class="code" href="classGetA.html">GetA</a>&amp; <a class="code" href="classGetAGroup.html#a5">GetAGroup::operator[]</a>(<span class="keywordtype">int</span> n) {
00556     <a class="code" href="ALL_8H.html#a0">err_when</a>( n &lt; 0 || n &gt;= <a class="code" href="classGetAGroup.html#m0">geta_num</a>);
00557     <span class="keywordflow">return</span> <a class="code" href="classGetAGroup.html#m1">geta_array</a>[n];
00558 }
00559 
<a name="l00560"></a><a class="code" href="classGetAGroup.html#a6">00560</a> <span class="keywordtype">int</span> <a class="code" href="classGetAGroup.html#a6">GetAGroup::operator()</a>() {
00561     <span class="keywordflow">return</span> <a class="code" href="classGetAGroup.html#m2">focused_geta</a>;
00562 }
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:45 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
