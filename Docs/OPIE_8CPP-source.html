<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OPIE.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>OPIE.CPP</h1><a href="OPIE_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OPIE.CPP</span>
00002 <span class="comment">//Description : Object Pie Chart</span>
00003 
00004 <span class="preprocessor">#include &lt;math.h&gt;</span>
00005 
00006 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00007 <span class="preprocessor">#include &lt;VGAFUN.H&gt;</span>
00008 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>
00010 <span class="preprocessor">#include &lt;OICONRES.H&gt;</span>
00011 <span class="preprocessor">#include &lt;<a class="code" href="OGAME_8H.html">OGAME.H</a>&gt;</span>
00012 <span class="preprocessor">#include &lt;<a class="code" href="OPIE_8H.html">OPIE.H</a>&gt;</span>
00013 
<a name="l00014"></a><a class="code" href="OPIE_8CPP.html#a0">00014</a> <span class="preprocessor">#define PI_OVER180 1.74532925199433E-002</span>
00015 <span class="preprocessor"></span>
00016 <span class="comment">//-------- Begin of function PieChart::init() ----------//</span>
<a name="l00021"></a><a class="code" href="classPieChart.html#a0">00021</a> <span class="comment">void PieChart::init(char* slotIconPtr) {</span>
00022     <span class="keywordflow">if</span>( slotIconPtr )
00023         slot_icon_ptr = slotIconPtr;
00024     <span class="keywordflow">else</span>
00025         slot_icon_ptr = icon_sys.read(<span class="stringliteral">"PIESLOT1"</span>);
00026 
00027     box_width = *((<span class="keywordtype">short</span>*)slot_icon_ptr);
00028 
00029     pie_radius = box_width/2-3;
00030 
00031     <span class="comment">//-------- create table of arc points -----------//</span>
00032 
00033     <span class="keywordtype">int</span>   i=0;
00034     <span class="keywordtype">float</span> curRadian;
00035 
00036     curRadian = <a class="code" href="OPIE_8CPP.html#a0">PI_OVER180</a> * 180;                   <span class="comment">// start from 180" degree</span>
00037 
00038     <span class="keywordflow">for</span>( i=0 ; i&lt;<a class="code" href="OPIE_8H.html#a2a1">MAX_DEGREE</a> ; curRadian+=<a class="code" href="OPIE_8CPP.html#a0">PI_OVER180</a>, i++ ) {
00039         pie_point_table[i].x = (box_width&gt;&gt;1) + sin(curRadian) * pie_radius;
00040         pie_point_table[i].y = (box_width&gt;&gt;1) + cos(curRadian) * pie_radius;
00041 
00042         <span class="keywordflow">if</span>( i&gt;=2 ) {                                  <span class="comment">// fill gaps between lines</span>
00043             <span class="keywordflow">if</span>( pie_point_table[i-1].x == pie_point_table[i-2].x &amp;&amp;
00044                 pie_point_table[i-1].y == pie_point_table[i-2].y &amp;&amp;
00045                 pie_point_table[i].x   -  pie_point_table[i-2].x &amp;&amp;
00046                 pie_point_table[i].y   -  pie_point_table[i-2].y ) {
00047                 pie_point_table[i-1].x = pie_point_table[i].x;
00048                 pie_point_table[i-1].y = pie_point_table[i-2].y;
00049             }
00050         }
00051     }
00052 }
00053 
00054 <span class="comment">//-------- End of function PieChart::init() ----------//</span>
00055 
00056 <span class="comment">//-------- Begin of function PieChart::init_image ----------//</span>
<a name="l00063"></a><a class="code" href="classPieChart.html#a1">00063</a> <span class="comment">void PieChart::init_image(int backColor) {</span>
00064     <span class="keywordflow">if</span>( backColor == -1 )
00065         backColor = <a class="code" href="COLOR_8H.html#a26">V_BACKGROUND</a>;
00066 
00067     vga.init_image( box_width, box_width );
00068 
00069     IMGputIcon( 0, 0, slot_icon_ptr );
00070 
00071     last_degree= -1;                                <span class="comment">// no last degree, first time</span>
00072 }
00073 
00074 <span class="comment">//-------- End of function PieChart::init_image ----------//</span>
00075 
00076 <span class="comment">//-------- Begin of function PieChart::draw_slice ----------//</span>
<a name="l00083"></a><a class="code" href="classPieChart.html#a3">00083</a> <span class="comment">void PieChart::draw_slice(float sliceShare, int sliceColor) {</span>
00084     <a class="code" href="ALL_8H.html#a2">err_if</a>( sliceShare&lt;0 || sliceShare&gt;100 || sliceShare==infinite_number )
00085         <a class="code" href="ALL_8H.html#a1">err_here</a>();
00086 
00087     <span class="keywordtype">int</span> i, lastX= -1, lastY = -1, pieCentre = box_width&gt;&gt;1;
00088 
00089     <span class="keywordtype">float</span> endDegree = last_degree + (float) <a class="code" href="OPIE_8H.html#a2a1">MAX_DEGREE</a> * sliceShare / 100;
00090     endDegree = min( endDegree, <a class="code" href="OPIE_8H.html#a2a1">MAX_DEGREE</a>-1 );
00091 
00092     <span class="comment">// last_degree+1 = current starting degree</span>
00093     PiePoint *curPoint = pie_point_table + (int)last_degree+1;
00094 
00095     <span class="comment">//---------- draw the slice -------------//</span>
00096 
00097     <span class="keywordflow">for</span>( i=last_degree+1 ; i&lt;=endDegree ; i++, curPoint++ ) {
00098         <span class="keywordflow">if</span>( curPoint-&gt;x != lastX || curPoint-&gt;y != lastY ) {
00099             <a class="code" href="IMGFUN_8H.html#a7">IMGline</a>( pieCentre, pieCentre, curPoint-&gt;x, curPoint-&gt;y, sliceColor );
00100 
00101             lastX = curPoint-&gt;x;
00102             lastY = curPoint-&gt;y;
00103         }
00104     }
00105 
00106     last_degree = endDegree;                        <span class="comment">// degree of the last drawn slice</span>
00107 }
00108 
00109 <span class="comment">//-------- End of function PieChart::draw_slice ----------//</span>
00110 
00111 <span class="comment">//-------- Begin of function PieChart::put_image ----------//</span>
<a name="l00118"></a><a class="code" href="classPieChart.html#a2">00118</a> <span class="comment">void PieChart::put_image(int x, int y) {</span>
00119     <span class="keywordflow">if</span>( last_degree &lt; <a class="code" href="OPIE_8H.html#a2a1">MAX_DEGREE</a>-1 )
00120         draw_slice( 100L * (<a class="code" href="OPIE_8H.html#a2a1">MAX_DEGREE</a> - last_degree+1) / 360, <a class="code" href="COLOR_8H.html#a17">V_WHITE</a> );
00121 
00122     vga.put_image( x, y );                          <span class="comment">// +3 = space between pie and panel down</span>
00123     vga.deinit_image();
00124 }
00125 
00126 <span class="comment">//-------- End of function PieChart::put_image ----------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:10 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
