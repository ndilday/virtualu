<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Osysdet.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Osysdet.cpp</h1><a href="Osysdet_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename   : OSYSDET.CPP</span>
00002 <span class="comment">//Description: System functions for detecting user inputs</span>
00003 <span class="comment">//Owner          : chwg</span>
00004 <span class="preprocessor">#include &lt;OCONFIG.H&gt;</span>
00005 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00006 <span class="preprocessor">#include &lt;<a class="code" href="OPOWER_8H.html">OPOWER.H</a>&gt;</span>
00007 <span class="preprocessor">#include &lt;OAUDIO.H&gt;</span>
00008 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;OFACURES.H&gt;</span>
00010 <span class="preprocessor">#include &lt;OPSCHOOL.H&gt;</span>
00011 <span class="preprocessor">#include &lt;OFINANCE.H&gt;</span>
00012 
00013 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00014 <span class="preprocessor">#include &lt;OFONT.H&gt;</span>
00015 <span class="preprocessor">#include &lt;OStr.H&gt;</span>                                 <span class="comment">// for this's capture_screen</span>
00016 <span class="preprocessor">#include &lt;OMisc.H&gt;</span>
00017 <span class="preprocessor">#include &lt;OVgaBuf.H&gt;</span>
00018 <span class="preprocessor">#include &lt;ODebugx.H&gt;</span>
00019 <span class="preprocessor">#include &lt;<a class="code" href="OMOUSE2_8H.html">OMOUSE2.H</a>&gt;</span>                              <span class="comment">// for K_UNIQUE_KEY</span>
00020 <span class="preprocessor">#include &lt;<a class="code" href="KEY_8H.html">KEY.H</a>&gt;</span>                                  <span class="comment">// for KEY_F11</span>
00021 <span class="preprocessor">#include &lt;<a class="code" href="OWORLD_8H.html">OWORLD.H</a>&gt;</span>                               <span class="comment">// World::on_event</span>
00022 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>                                <span class="comment">// for button coordinates - Norris 0713</span>
00023 
00024 <span class="preprocessor">#include &lt;<a class="code" href="OADM__OFF_8H.html">OADM_OFF.H</a>&gt;</span>
00025 <span class="preprocessor">#include &lt;OOPT.H&gt;</span>
00026 <span class="preprocessor">#include &lt;OATHLETI.H&gt;</span>
00027 <span class="preprocessor">#include &lt;ODEVELOP.H&gt;</span>
00028 <span class="preprocessor">#include &lt;OLIBTECH.H&gt;</span>
00029 <span class="preprocessor">#include &lt;OFACILIT.H&gt;</span>
00030 <span class="preprocessor">#include &lt;OINVEST.H&gt;</span>
00031 <span class="preprocessor">#include &lt;ODEPT.H&gt;</span>
00032 <span class="preprocessor">#include &lt;<a class="code" href="OTEST_8H.html">OTEST.H</a>&gt;</span>
00033 <span class="preprocessor">#include &lt;OLETTER.H&gt;</span>                              <span class="comment">// ##chwg1021</span>
00034 <span class="preprocessor">#include &lt;<a class="code" href="OHELPIF_8H.html">OHELPIF.H</a>&gt;</span>                              <span class="comment">// ##chwg1015</span>
00035 <span class="preprocessor">#include &lt;<a class="code" href="OBLCKBRD_8H.html">OBLCKBRD.H</a>&gt;</span>                             <span class="comment">// ##chwg1026</span>
00036 <span class="preprocessor">#include &lt;<a class="code" href="OMORERPT_8H.html">OMORERPT.H</a>&gt;</span>
00037 <span class="preprocessor">#include &lt;<a class="code" href="OMISCREP_8H.html">OMISCREP.H</a>&gt;</span>
00038 <span class="preprocessor">#include &lt;<a class="code" href="ODEPTLST_8H.html">ODEPTLST.H</a>&gt;</span>                             <span class="comment">//## chwg010999</span>
00039 <span class="preprocessor">#include &lt;<a class="code" href="ORETIRE_8H.html">ORETIRE.H</a>&gt;</span>                              <span class="comment">//## chwg021299</span>
00040 <span class="preprocessor">#include &lt;<a class="code" href="OBANKRUP_8H.html">OBANKRUP.H</a>&gt;</span>                             <span class="comment">//## chwg021299</span>
00041 <span class="preprocessor">#include &lt;<a class="code" href="OFINSCOR_8H.html">OFINSCOR.H</a>&gt;</span>                             <span class="comment">//## chwg021299</span>
00042 <span class="preprocessor">#include &lt;<a class="code" href="OSCEN__IF_8H.html">OSCEN_IF.H</a>&gt;</span>                             <span class="comment">//## chwg021299</span>
00043 <span class="preprocessor">#include &lt;OLOSEGAM.H&gt;</span>                             <span class="comment">//## chwg021299</span>
00044 <span class="preprocessor">#include &lt;<a class="code" href="OPRTMENU_8H.html">OPRTMENU.H</a>&gt;</span>                             <span class="comment">//## chwg021299</span>
00045 <span class="preprocessor">#include &lt;OENROLL.H&gt;</span>
00046 <span class="preprocessor">#include &lt;<a class="code" href="OHELP_8H.html">OHELP.H</a>&gt;</span>
00047 <span class="preprocessor">#include &lt;OIFACE.H&gt;</span>
00048 <span class="preprocessor">#include &lt;OPRINT.H&gt;</span>
00049 <span class="preprocessor">#include &lt;<a class="code" href="OBOX_8H.html">OBOX.H</a>&gt;</span>
00050 <span class="preprocessor">#include &lt;OCRIME.H&gt;</span>
00051 <span class="preprocessor">#include &lt;<a class="code" href="OVGALOCK_8H.html">OVGALOCK.H</a>&gt;</span>
00052 
00053 <span class="preprocessor">#include &lt;OCHANCE.H&gt;</span>                              <span class="comment">//## chea021000 for testing chance card only</span>
00054 <span class="comment">//----- Define interface coordinates ------//</span>
00055 
00056 <span class="keyword">enum</span> {
00057     <a class="code" href="Osysdet_8cpp.html#a38a2">REPORT_BUTTON_CAMPUS_X1</a> = 5,
00058     <a class="code" href="Osysdet_8cpp.html#a38a3">REPORT_BUTTON_CAMPUS_Y1</a> = 0,
00059     <a class="code" href="Osysdet_8cpp.html#a38a4">REPORT_BUTTON_CAMPUS_X2</a> = 56,
00060     <a class="code" href="Osysdet_8cpp.html#a38a5">REPORT_BUTTON_CAMPUS_Y2</a> = 32,
00061     <a class="code" href="Osysdet_8cpp.html#a38a6">REPORT_BUTTON_FACULTY_X1</a> = 57,
00062     <a class="code" href="Osysdet_8cpp.html#a38a7">REPORT_BUTTON_FACULTY_Y1</a> = 0,
00063     <a class="code" href="Osysdet_8cpp.html#a38a8">REPORT_BUTTON_FACULTY_X2</a> = 101,
00064     <a class="code" href="Osysdet_8cpp.html#a38a9">REPORT_BUTTON_FACULTY_Y2</a> = 32,
00065     <a class="code" href="Osysdet_8cpp.html#a38a10">REPORT_BUTTON_STUDENTS_X1</a> = 102,
00066     <a class="code" href="Osysdet_8cpp.html#a38a11">REPORT_BUTTON_STUDENTS_Y1</a> = 0,
00067     <a class="code" href="Osysdet_8cpp.html#a38a12">REPORT_BUTTON_STUDENTS_X2</a> = 155,
00068     <a class="code" href="Osysdet_8cpp.html#a38a13">REPORT_BUTTON_STUDENTS_Y2</a> = 32,
00069     <a class="code" href="Osysdet_8cpp.html#a38a14">REPORT_BUTTON_COURSES_X1</a> = 156,
00070     <a class="code" href="Osysdet_8cpp.html#a38a15">REPORT_BUTTON_COURSES_Y1</a> = 0,
00071     <a class="code" href="Osysdet_8cpp.html#a38a16">REPORT_BUTTON_COURSES_X2</a> = 205,
00072     <a class="code" href="Osysdet_8cpp.html#a38a17">REPORT_BUTTON_COURSES_Y2</a> = 32,
00073     <a class="code" href="Osysdet_8cpp.html#a38a18">REPORT_BUTTON_PERFORMANCE_X1</a> = 206,
00074     <a class="code" href="Osysdet_8cpp.html#a38a19">REPORT_BUTTON_PERFORMANCE_Y1</a> = 0,
00075     <a class="code" href="Osysdet_8cpp.html#a38a20">REPORT_BUTTON_PERFORMANCE_X2</a> = 276,
00076     <a class="code" href="Osysdet_8cpp.html#a38a21">REPORT_BUTTON_PERFORMANCE_Y2</a> = 32,
00077     <a class="code" href="Osysdet_8cpp.html#a38a22">REPORT_BUTTON_FINANCIAL_X1</a> = 277,
00078     <a class="code" href="Osysdet_8cpp.html#a38a23">REPORT_BUTTON_FINANCIAL_Y1</a> = 0,
00079     <a class="code" href="Osysdet_8cpp.html#a38a24">REPORT_BUTTON_FINANCIAL_X2</a> = 324,
00080     <a class="code" href="Osysdet_8cpp.html#a38a25">REPORT_BUTTON_FINANCIAL_Y2</a> = 32,
00081     <a class="code" href="Osysdet_8cpp.html#a38a26">REPORT_BUTTON_SCORE_X1</a> = 325,
00082     <a class="code" href="Osysdet_8cpp.html#a38a27">REPORT_BUTTON_SCORE_Y1</a> = 0,
00083     <a class="code" href="Osysdet_8cpp.html#a38a28">REPORT_BUTTON_SCORE_X2</a> = 361,
00084     <a class="code" href="Osysdet_8cpp.html#a38a29">REPORT_BUTTON_SCORE_Y2</a> = 32,
00085     <a class="code" href="Osysdet_8cpp.html#a38a30">MORE_REPORT_BUTTON_X1</a> = 10,
00086     <a class="code" href="Osysdet_8cpp.html#a38a31">MORE_REPORT_BUTTON_Y1</a> = 33,
00087     <a class="code" href="Osysdet_8cpp.html#a38a32">MORE_REPORT_BUTTON_X2</a> = 150,
00088     <a class="code" href="Osysdet_8cpp.html#a38a33">MORE_REPORT_BUTTON_Y2</a> = 45,
00089     <a class="code" href="Osysdet_8cpp.html#a38a34">NEWS_POPUP_X1</a> = 120,
00090     <a class="code" href="Osysdet_8cpp.html#a38a35">NEWS_POPUP_Y1</a> = 130,
00091     <a class="code" href="Osysdet_8cpp.html#a38a36">NEWS_POPUP_X2</a> = <a class="code" href="Osysdet_8cpp.html#a38a34">NEWS_POPUP_X1</a>+532,
00092     <a class="code" href="Osysdet_8cpp.html#a38a37">NEWS_POPUP_Y2</a> = <a class="code" href="Osysdet_8cpp.html#a38a35">NEWS_POPUP_Y1</a>+222
00093 };
00094 <span class="comment">//-------- Begin of function Sys::detect --------//</span>
00095 
00096 <span class="keyword">static</span> <span class="keywordtype">int</span> m_o_log_state[3]={2,0,0};
00097 <span class="keyword">static</span> <span class="keywordtype">int</span> m_o_log_bitmap_y[4]={0,27,57,80};
00098 
00099 <span class="keywordtype">void</span> Sys::detect() {
00100     <span class="comment">//--- if it was previously in scenario letter or evaluation letter but it has just been set to a new mode, then set_staying_view_mode(0) to enable the speed to the original value ---//</span>
00101 
00102     <span class="keywordflow">if</span>( (staying_view_mode == <a class="code" href="Osys_8h.html#a45a21">MODE_SCENARIO_LETTER</a> &amp;&amp; view_mode != <a class="code" href="Osys_8h.html#a45a21">MODE_SCENARIO_LETTER</a>) ||
00103         (staying_view_mode == <a class="code" href="Osys_8h.html#a45a34">MODE_EVALUATION_LETTER</a> &amp;&amp; view_mode != <a class="code" href="Osys_8h.html#a45a34">MODE_EVALUATION_LETTER</a>)
00104 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00105 <span class="preprocessor"></span>        || (staying_view_mode == MODE_STATE_REPORT &amp;&amp; view_mode != MODE_STATE_REPORT)
00106         || ((staying_view_mode == <a class="code" href="Osys_8h.html#a45a18">MODE_YEAR_END_REPORT</a> &amp;&amp; view_mode != <a class="code" href="Osys_8h.html#a45a18">MODE_YEAR_END_REPORT</a>)
00107             &amp;&amp; (staying_view_mode == <a class="code" href="Osys_8h.html#a45a18">MODE_YEAR_END_REPORT</a> &amp;&amp; view_mode != <a class="code" href="Osys_8h.html#a45a31">MODE_HELP_DESC</a>))
00108 <span class="preprocessor">#endif</span>
00109 <span class="preprocessor"></span>        ) {
00110         save_view_mode = view_mode;
00111         set_staying_view_mode(0);
00112     }
00113 
00114     <span class="comment">//--- if the user has just switched mode, don't detect as it will detect the new mode without first initializing the controls of the new mode ----//</span>
00115 
00116     <span class="keywordflow">if</span>( redraw_all_flag || redraw_zoom_flag )
00117         <span class="keywordflow">return</span>;
00118 
00119     <span class="comment">//--------------------------------------//</span>
00120 
00121     mouse.get_event();
00122     <span class="comment">/*</span>
00123 <span class="comment">      if( in_game_menu.is_active() )</span>
00124 <span class="comment">      {</span>
00125 <span class="comment">      in_game_menu.detect();</span>
00126 <span class="comment">      return;</span>
00127 <span class="comment">      }</span>
00128 <span class="comment">    */</span>
00129 
00130     <span class="comment">// BUGHERE</span>
00131     <span class="comment">// Test for context help</span>
00132     <span class="comment">//  help.set_custom_help(0,0,100,100,"Test title","Test detail, Why I cannot see anything?");</span>
00133     <span class="comment">//  help.set_help(200,200,400,400,"COMPUTER");</span>
00134 
00135     <span class="keywordflow">if</span>(news_pop_up_flag) {
00136         <span class="comment">// 5 second timeout</span>
00137         <span class="keywordflow">if</span>( mouse.single_click(2) || m.get_time() &gt; news_pop_up_time + 8000 ) {
00138             set_speed(save_speed);
00139             news_pop_up_flag=0;
00140             redraw_all_flag=1;
00141         }
00142     }
00143 
00144     <span class="keywordflow">if</span>((view_mode==<a class="code" href="Osys_8h.html#a45a23">MODE_BANKRUPTCY</a>)
00145        ||(view_mode==<a class="code" href="Osys_8h.html#a45a22">MODE_RETIREMENT</a>)
00146        ||(view_mode==<a class="code" href="Osys_8h.html#a45a25">MODE_FINAL_SCORE</a>)
00147        ||(view_mode==<a class="code" href="Osys_8h.html#a45a24">MODE_LOSE_GAME</a>)
00148        ||(view_mode==<a class="code" href="Osys_8h.html#a45a26">MODE_AWARD_REPORT</a>)) {
00149         detect_view();
00150         <span class="keywordflow">return</span>;
00151     }
00152 
00153     <span class="keywordflow">if</span>(view_mode==<a class="code" href="Osys_8h.html#a45a28">MODE_PAUSE</a>) {
00154         <span class="keywordflow">if</span>( mouse.is_key_event() )
00155             <span class="keywordflow">if</span>( m.upper(mouse.is_key(mouse.scan_code, mouse.event_skey_state, (<a class="code" href="OCOLTBL_8H.html#a2">WORD</a>) 0, <a class="code" href="OMOUSE2_8H.html#a15a14">K_UNIQUE_KEY</a>))==<span class="charliteral">'P'</span> ) {
00156                 pause_game_flag = 1 - pause_game_flag;      <span class="comment">// toggle menu pull down</span>
00157                 <span class="keywordflow">if</span>(pause_game_flag)
00158                     set_staying_view_mode(<a class="code" href="Osys_8h.html#a45a28">MODE_PAUSE</a>);
00159                 <span class="keywordflow">else</span> {
00160                     set_staying_view_mode(0);
00161                     <span class="comment">//                  redraw_all_flag=1;</span>
00162                 }
00163             }
00164         <span class="keywordflow">return</span>;
00165     }
00166 
00167     <span class="comment">// ## begin chwg 1106</span>
00168     <span class="comment">// Used to disable all buttons in the screen while in these mode</span>
00169     <span class="comment">//  MODE_YEAR_END_REPORT,MODE_EVALUATION_LETTER and MODE_WELCOME_LETTER</span>
00170 
00171     <span class="comment">// Detect help question mark button only if in help_topic or help_desc report</span>
00172     <span class="keywordflow">if</span>((view_mode==<a class="code" href="Osys_8h.html#a45a30">MODE_HELP_TOPIC</a>)||
00173        (view_mode==<a class="code" href="Osys_8h.html#a45a31">MODE_HELP_DESC</a>)) {
00174         help.set_help(<a class="code" href="Oinfo_8h.html#a110a54">HELP_QUEST_X1</a>,<a class="code" href="Oinfo_8h.html#a110a55">HELP_QUEST_Y1</a>,<a class="code" href="Oinfo_8h.html#a110a56">HELP_QUEST_X2</a>,<a class="code" href="Oinfo_8h.html#a110a57">HELP_QUEST_Y2</a>,<span class="stringliteral">"U13."</span>);
00175         <span class="keywordflow">if</span> (mouse.single_click(<a class="code" href="Oinfo_8h.html#a110a54">HELP_QUEST_X1</a>, <a class="code" href="Oinfo_8h.html#a110a55">HELP_QUEST_Y1</a>, <a class="code" href="Oinfo_8h.html#a110a56">HELP_QUEST_X2</a>, <a class="code" href="Oinfo_8h.html#a110a57">HELP_QUEST_Y2</a>)) {
00176             audio.play_wav(<span class="stringliteral">"STONES"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00177 
00178             <span class="keywordflow">if</span>(view_mode!=<a class="code" href="Osys_8h.html#a45a30">MODE_HELP_TOPIC</a>) {
00179                 <span class="keywordflow">if</span>(view_mode!=<a class="code" href="Osys_8h.html#a45a20">MODE_DEPT_LIST</a> &amp;&amp; view_mode!=<a class="code" href="Osys_8h.html#a45a19">MODE_MORE_REPORT</a>
00180                    &amp;&amp; view_mode!=<a class="code" href="Osys_8h.html#a45a30">MODE_HELP_TOPIC</a>)
00181                     report_before_morerpt_or_deptlist=view_mode;
00182                 <span class="keywordflow">else</span>
00183                     report_before_morerpt_or_deptlist=<a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>;
00184 
00185                 set_view_mode(<a class="code" href="Osys_8h.html#a45a30">MODE_HELP_TOPIC</a>);
00186             }
00187             <span class="keywordflow">else</span>
00188                 set_view_mode(report_before_morerpt_or_deptlist);
00189 
00190             <span class="keywordflow">return</span>;
00191         }
00192         detect_view();
00193         <span class="keywordflow">return</span>;
00194     }
00195 
00196     <span class="keywordflow">if</span>(view_mode==<a class="code" href="Osys_8h.html#a45a18">MODE_YEAR_END_REPORT</a>) {
00197         finance.new_fiscal_year_report_detect();
00198         <span class="keywordflow">return</span>;
00199     }
00200 
00201     <span class="keywordflow">if</span>(view_mode==<a class="code" href="Osys_8h.html#a45a34">MODE_EVALUATION_LETTER</a>) {
00202 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00203 <span class="preprocessor"></span>        <span class="comment">// BUGHERE : temporary fix the bug which call in-correct</span>
00204         <span class="comment">// detect function when viewing evaluation letter (&gt;1year and not in year-end report)</span>
00205         <span class="keywordflow">if</span>( save_view_mode==<a class="code" href="Osys_8h.html#a45a18">MODE_YEAR_END_REPORT</a> ) {
00206             finance.new_fiscal_year_report_detect();
00207             <span class="keywordflow">return</span>;
00208         }
00209 <span class="preprocessor">#else</span>
00210 <span class="preprocessor"></span>        letter.eval_letter_detect();
00211         detect_mail_button();
00212 
00213         <span class="keywordflow">if</span>( info.game_month==8 &amp;&amp; info.game_day==30 ) <span class="comment">// if it is called up the player, then the player is free to click on any menu buttons to exit it. Otherwise, force the player to stay with it.</span>
00214             <span class="keywordflow">return</span>;
00215 <span class="preprocessor">#endif</span>
00216 <span class="preprocessor"></span>    }
00217 
00218     <span class="keywordflow">if</span>(view_mode==<a class="code" href="Osys_8h.html#a45a33">MODE_WELCOME_LETTER</a>) {
00219         letter.welcome_letter_detect();
00220         detect_mail_button();
00221         <span class="keywordflow">return</span>;
00222     }
00223 
00224     <span class="keywordflow">if</span>(view_mode==<a class="code" href="Osys_8h.html#a45a32">MODE_SCEN_WELCOME_LETTER</a>) {
00225         letter.scen_welcome_letter_detect();
00226         detect_mail_button();
00227         <span class="keywordflow">return</span>;
00228     }
00229 
00230 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00231 <span class="preprocessor"></span>    <span class="keywordflow">if</span>(view_mode==MODE_STATE_REPORT) {
00232         finance.new_fiscal_year_report_detect();
00233         <span class="comment">//              detect_mail_button();</span>
00234         <span class="keywordflow">return</span>;
00235     }
00236 <span class="preprocessor">#endif</span>
00237 <span class="preprocessor"></span>
00238     <span class="keywordflow">if</span>(player_school.scenario_id&gt;0 &amp;&amp; view_mode==<a class="code" href="Osys_8h.html#a45a21">MODE_SCENARIO_LETTER</a>) {
00239         scenario_report.scenario_report_detect();
00240         <span class="keywordflow">if</span>(sys.view_mode!=<a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>)
00241             detect_mail_button();
00242         <span class="comment">//              return;</span>
00243     }
00244 
00245     <span class="comment">// ## end chwg 1106</span>
00246 
00247     <span class="comment">//## chea 220699</span>
00248     <span class="comment">//## play department sound</span>
00249     <span class="comment">//#begin zhoubin 02/23/99</span>
00250     <span class="comment">//  remove static int old_Dept=-1;</span>
00251     <span class="comment">//#End zhoubin 02/23/99</span>
00252     <span class="keywordtype">int</span> dept=0;
00253     <span class="keywordtype">int</span> deptNo=0;
00254     <span class="comment">//##begin zhoubin 02/23/99</span>
00255     <span class="keywordflow">if</span>(old_Dept!=department_array.selected_recno&amp;&amp;bDept)
00256         <span class="comment">//##end zhoubin 02/23/99</span>
00257         <span class="keywordflow">if</span>(
00258             (view_mode!=<a class="code" href="Osys_8h.html#a45a32">MODE_SCEN_WELCOME_LETTER</a>)
00259             &amp;&amp;(view_mode!=<a class="code" href="Osys_8h.html#a45a33">MODE_WELCOME_LETTER</a>)
00260             ) {
00261             dept=department_array.selected_recno;
00262 
00263             deptNo = department_array[dept]-&gt;department_id;
00264 
00265             <span class="comment">// play sound</span>
00266             <span class="keywordflow">switch</span>(deptNo) {
00267             <span class="keywordflow">case</span> 1:
00268                 audio.play_wav(<span class="stringliteral">"AGRICULT"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00269                 <span class="keywordflow">break</span>;
00270             <span class="keywordflow">case</span> 2:
00271                 audio.play_wav(<span class="stringliteral">"TECHSERV"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00272                 <span class="keywordflow">break</span>;
00273             <span class="keywordflow">case</span> 3:
00274                 audio.play_wav(<span class="stringliteral">"BUSINESS"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00275                 <span class="keywordflow">break</span>;
00276             <span class="keywordflow">case</span> 4:
00277                 audio.play_wav(<span class="stringliteral">"COMMUNIC"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00278                 <span class="keywordflow">break</span>;
00279             <span class="keywordflow">case</span> 5:
00280                 audio.play_wav(<span class="stringliteral">"EDUCATIO"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00281                 <span class="keywordflow">break</span>;
00282             <span class="keywordflow">case</span> 6:
00283                 audio.play_wav(<span class="stringliteral">"ENGICONS"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00284                 <span class="keywordflow">break</span>;
00285             <span class="keywordflow">case</span> 7:
00286                 audio.play_wav(<span class="stringliteral">"FORELANG"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00287                 <span class="keywordflow">break</span>;
00288             <span class="keywordflow">case</span> 8:
00289                 audio.play_wav(<span class="stringliteral">"HEALSERV"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00290                 <span class="keywordflow">break</span>;
00291             <span class="keywordflow">case</span> 9:
00292                 audio.play_wav(<span class="stringliteral">"AMERSTUD"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00293                 <span class="keywordflow">break</span>;
00294                 <span class="comment">//              case 10:</span>
00295                 <span class="comment">//                      audio.play_wav("classic",audio.int_to_DsVolume(config.sound_effect_volume));</span>
00296                 <span class="keywordflow">break</span>;
00297                 <span class="comment">//              case 11:</span>
00298                 <span class="comment">//                      audio.play_wav("ENGLISH",audio.int_to_DsVolume(config.sound_effect_volume));</span>
00299                 <span class="keywordflow">break</span>;
00300             <span class="keywordflow">case</span> 12:
00301                 audio.play_wav(<span class="stringliteral">"HISTORY"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00302                 <span class="keywordflow">break</span>;
00303                 <span class="comment">//              case 13:</span>
00304                 <span class="comment">//                      audio.play_wav("Philoso",audio.int_to_DsVolume(config.sound_effect_volume));</span>
00305                 <span class="keywordflow">break</span>;
00306             <span class="keywordflow">case</span> 14:
00307                 audio.play_wav(<span class="stringliteral">"ENVIBROO"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00308                 <span class="keywordflow">break</span>;
00309             <span class="keywordflow">case</span> 15:
00310                 audio.play_wav(<span class="stringliteral">"GENDETHN"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00311                 <span class="keywordflow">break</span>;
00312             <span class="keywordflow">case</span> 16:
00313                 audio.play_wav(<span class="stringliteral">"BIOLOGY"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00314                 <span class="keywordflow">break</span>;
00315             <span class="keywordflow">case</span> 17:
00316                 audio.play_wav(<span class="stringliteral">"CHEMISTR"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00317                 <span class="keywordflow">break</span>;
00318                 <span class="comment">//              case 18:</span>
00319                 <span class="comment">//                      audio.play_wav("Physics",audio.int_to_DsVolume(config.sound_effect_volume));</span>
00320                 <span class="keywordflow">break</span>;
00321             <span class="keywordflow">case</span> 19:
00322                 audio.play_wav(<span class="stringliteral">"COMPSCIE"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00323                 <span class="keywordflow">break</span>;
00324             <span class="keywordflow">case</span> 20:
00325                 audio.play_wav(<span class="stringliteral">"MATHEMAT"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00326                 <span class="keywordflow">break</span>;
00327             <span class="keywordflow">case</span> 21:
00328                 audio.play_wav(<span class="stringliteral">"ANTHSOCI"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00329                 <span class="keywordflow">break</span>;
00330             <span class="keywordflow">case</span> 22:
00331                 audio.play_wav(<span class="stringliteral">"ECONOMIC"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00332                 <span class="keywordflow">break</span>;
00333             <span class="keywordflow">case</span> 23:
00334                 audio.play_wav(<span class="stringliteral">"LAW"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00335                 <span class="keywordflow">break</span>;
00336                 <span class="comment">//              case 24:</span>
00337                 <span class="comment">//                      audio.play_wav("Political Science",audio.int_to_DsVolume(config.sound_effect_volume));</span>
00338                 <span class="keywordflow">break</span>;
00339                 <span class="comment">//              case 25:</span>
00340                 <span class="comment">//                      audio.play_wav("Psychology",audio.int_to_DsVolume(config.sound_effect_volume));</span>
00341                 <span class="keywordflow">break</span>;
00342                 <span class="comment">//              case 26:</span>
00343                 <span class="comment">//                      audio.play_wav("Art",audio.int_to_DsVolume(config.sound_effect_volume));</span>
00344                 <span class="keywordflow">break</span>;
00345                 <span class="comment">//              case 27:</span>
00346                 <span class="comment">//                      audio.play_wav("Drama",audio.int_to_DsVolume(config.sound_effect_volume));</span>
00347                 <span class="keywordflow">break</span>;
00348             <span class="keywordflow">case</span> 28:
00349                 audio.play_wav(<span class="stringliteral">"MUSIC"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00350                 <span class="keywordflow">break</span>;
00351             <span class="keywordflow">default</span>:
00352                 <span class="keywordflow">break</span>;
00353 
00354             }
00355 
00356             old_Dept=department_array.selected_recno;
00357         }
00358     <span class="comment">//## chea 220699</span>
00359 
00360     <span class="keywordflow">if</span>( detect_report_button() )
00361         <span class="keywordflow">return</span>;
00362 
00363     <span class="comment">// No further detection if game_options window is opened! //</span>
00364     <span class="keywordflow">if</span>(view_mode==<a class="code" href="Osys_8h.html#a45a17">MODE_GAME_OPTIONS</a>) {
00365         setting_report_detect();
00366         <span class="keywordflow">if</span>( mouse.is_key_event() )
00367             <span class="keywordflow">if</span>( m.upper(mouse.is_key(mouse.scan_code, mouse.event_skey_state, (<a class="code" href="OCOLTBL_8H.html#a2">WORD</a>) 0, <a class="code" href="OMOUSE2_8H.html#a15a14">K_UNIQUE_KEY</a>))==<a class="code" href="KEY_8H.html#a25">KEY_F10</a> ) {
00368                 menu_pull_down = 1 - menu_pull_down;        <span class="comment">// toggle menu pull down</span>
00369                 <span class="keywordflow">if</span>(menu_pull_down) {
00370                     world.draw_all();
00371                     info.disp_column_bitmap(&amp;vga_back);
00372                     vga.blt_buf(<a class="code" href="Oworldmt_8h.html#a12">ZOOM_X1</a>, <a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a>, <a class="code" href="Oworldmt_8h.html#a14">ZOOM_X2</a>, <a class="code" href="Oworldmt_8h.html#a15">ZOOM_Y2</a>,1);
00373                     set_staying_view_mode(<a class="code" href="Osys_8h.html#a45a17">MODE_GAME_OPTIONS</a>);
00374                 }
00375                 <span class="keywordflow">else</span>
00376                     set_staying_view_mode(0);
00377             }
00378         <span class="keywordflow">return</span>;
00379     }
00380 
00381     <span class="keywordflow">if</span>( mouse.is_key_event() ) {
00382         <span class="keywordflow">if</span>( detect_cheat_key(mouse.scan_code, mouse.event_skey_state) )
00383             <span class="keywordflow">return</span>;
00384 
00385         process_key(mouse.scan_code, mouse.event_skey_state);
00386     }
00387 
00388     <span class="keywordflow">if</span>( detect_dept_button() )
00389         <span class="keywordflow">return</span>;
00390 
00391     <span class="keywordflow">if</span>( detect_mail_button() )
00392         <span class="keywordflow">return</span>;
00393 
00394     <span class="keywordflow">if</span>( detect_function_button() )
00395         <span class="keywordflow">return</span>;
00396 
00397     detect_main_screen_help();
00398 
00399     detect_view();
00400 
00401     <span class="comment">//------ if in staying view mode -------//</span>
00402 
00403     <span class="keywordflow">if</span>(staying_view_mode &amp;&amp; staying_view_mode!=<a class="code" href="Osys_8h.html#a45a34">MODE_EVALUATION_LETTER</a>) {
00404         <span class="keywordflow">if</span>( mouse.single_click( 234, 535, 609, 570 ) ) {
00405             redraw_all_flag=1;
00406             set_view_mode(staying_view_mode);
00407         }
00408     }
00409 }
00410 
00411 <span class="comment">//--------- End of function Sys::detect ---------//</span>
00412 
00413 <span class="comment">//-------- Begin of function Sys::detect_view --------//</span>
00414 
00415 <span class="keywordtype">void</span> Sys::detect_view() {
00416     <span class="comment">//---- if the mode is set to the detail screen of a building -----//</span>
00417 
00418     <span class="keywordflow">if</span>( view_mode &gt;= <a class="code" href="Osys_8h.html#a45a38">MODE_FIRST_NONDEPARTMENTAL_FIRM</a> &amp;&amp;
00419         view_mode &lt;= <a class="code" href="Osys_8h.html#a45a39">MODE_LAST_NONDEPARTMENTAL_FIRM</a> ) {
00420         <span class="keywordflow">switch</span>( <a class="code" href="OFIRMID_8H.html#a21a1">FIRST_NONDEPARTMENTAL_FIRM_ID</a> + view_mode - <a class="code" href="Osys_8h.html#a45a38">MODE_FIRST_NONDEPARTMENTAL_FIRM</a> ) {
00421         <span class="keywordflow">case</span> <a class="code" href="OFIRMID_8H.html#a22a5">FIRM_ADMISSIONS</a>:
00422             adm_office.detect();
00423             <span class="keywordflow">break</span>;
00424 
00425         <span class="keywordflow">case</span> <a class="code" href="OFIRMID_8H.html#a22a17">FIRM_STADIUM</a>:
00426         <span class="keywordflow">case</span> <a class="code" href="OFIRMID_8H.html#a22a18">FIRM_PLAY_FIELD</a>:
00427 
00428         <span class="keywordflow">case</span> <a class="code" href="OFIRMID_8H.html#a22a19">FIRM_INDOOR_SPORTS</a>:
00429             athletics_office.detect();
00430             <span class="keywordflow">break</span>;
00431 
00432         <span class="keywordflow">case</span> <a class="code" href="OFIRMID_8H.html#a22a6">FIRM_DEVELOPMENT</a>:
00433             development_office.detect();
00434             <span class="keywordflow">break</span>;
00435 
00436         <span class="keywordflow">case</span> <a class="code" href="OFIRMID_8H.html#a22a3">FIRM_LIBRARY</a>:
00437             library_tech_office.detect();
00438             <span class="keywordflow">break</span>;
00439 
00440         <span class="keywordflow">case</span> <a class="code" href="OFIRMID_8H.html#a22a7">FIRM_FACILITIES</a>:
00441             facility_office.detect();
00442             <span class="keywordflow">break</span>;
00443 
00444         <span class="keywordflow">case</span> <a class="code" href="OFIRMID_8H.html#a22a4">FIRM_OLD_MAIN</a>:
00445             investment_office.detect();
00446             <span class="keywordflow">break</span>;
00447 
00448         <span class="keywordflow">case</span> <a class="code" href="OFIRMID_8H.html#a22a10">FIRM_PRESIDENT</a>: {
00449             <span class="keywordflow">if</span>(info.year_passed&lt;=1) {
00450                 letter.welcome_letter_detect();
00451             }
00452             <span class="keywordflow">else</span> {
00453                 letter.eval_letter_detect();
00454             }
00455         }
00456         <span class="keywordflow">break</span>;
00457 
00458         <span class="keywordflow">case</span> <a class="code" href="OFIRMID_8H.html#a22a11">FIRM_TOWER</a>:
00459             player_school.score_report_detect();
00460             <span class="keywordflow">break</span>;
00461 
00462         <span class="keywordflow">case</span> <a class="code" href="OFIRMID_8H.html#a22a9">FIRM_RESIDENCE</a>:
00463             player_school.summary_student_report_detect();
00464             <span class="keywordflow">break</span>;
00465 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00466 <span class="preprocessor"></span>        <span class="keywordflow">case</span> <a class="code" href="OFIRMID_8H.html#a22a13">FIRM_POLICE</a>:
00467             crime.crime_detect();
00468             <span class="keywordflow">break</span>;
00469 <span class="preprocessor">#endif</span>
00470 <span class="preprocessor"></span>        }
00471     }
00472     <span class="keywordflow">else</span> {
00473         <span class="comment">//----- if the mode is set to display one of the building independent reports ----//</span>
00474 
00475         <span class="keywordflow">switch</span>( view_mode ) {
00476 
00477         <span class="keywordflow">case</span> <a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>:
00478             <span class="comment">// BUGHERE ##chwg1112</span>
00479             <span class="comment">// temporary placing here</span>
00480             m_o_log_old_selected=-2;
00481             world.detect();
00482             <span class="keywordflow">break</span>;
00483 
00484         <span class="keywordflow">case</span> <a class="code" href="Osys_8h.html#a45a16">MODE_FACULTY_LIST</a>:
00485             faculty_res.report_detect();
00486             <span class="keywordflow">break</span>;
00487 
00488         <span class="keywordflow">case</span> <a class="code" href="Osys_8h.html#a45a10">MODE_FACULTY_SUMMARY</a>:
00489             faculty_res.summary_report_detect();
00490             <span class="keywordflow">break</span>;
00491 
00492         <span class="keywordflow">case</span> <a class="code" href="Osys_8h.html#a45a11">MODE_STUDENT_REPORT</a>:
00493             player_school.summary_student_report_detect();
00494             <span class="keywordflow">break</span>;
00495 
00496         <span class="keywordflow">case</span> <a class="code" href="Osys_8h.html#a45a15">MODE_SCORE_REPORT</a>:
00497             player_school.score_report_detect();
00498             <span class="keywordflow">break</span>;
00499 
00500         <span class="keywordflow">case</span> <a class="code" href="Osys_8h.html#a45a14">MODE_FINANCIAL_REPORT</a>:
00501             finance.report_detect();
00502             <span class="keywordflow">break</span>;
00503 
00504         <span class="keywordflow">case</span> <a class="code" href="Osys_8h.html#a45a13">MODE_PERFORMANCE_REPORT</a>:
00505             department_array[department_array.selected_recno]-&gt;main_report_detect();
00506             <span class="keywordflow">break</span>;
00507 
00508         <span class="keywordflow">case</span> <a class="code" href="Osys_8h.html#a45a12">MODE_COURSE_REPORT</a>:
00509             department_array[department_array.selected_recno]-&gt;course_report_detect();
00510             <span class="keywordflow">break</span>;
00511 
00512         <span class="keywordflow">case</span> <a class="code" href="Osys_8h.html#a45a18">MODE_YEAR_END_REPORT</a>:
00513             finance.new_fiscal_year_report_detect();
00514             <span class="keywordflow">break</span>;
00515 
00516         <span class="keywordflow">case</span> <a class="code" href="Osys_8h.html#a45a21">MODE_SCENARIO_LETTER</a>:
00517             scenario_report.scenario_report_detect();
00518             <span class="keywordflow">break</span>;
00519 
00520         <span class="keywordflow">case</span> <a class="code" href="Osys_8h.html#a45a22">MODE_RETIREMENT</a>:
00521             retirement.retirement_detect();
00522             <span class="keywordflow">break</span>;
00523 
00524         <span class="keywordflow">case</span> <a class="code" href="Osys_8h.html#a45a23">MODE_BANKRUPTCY</a>:
00525             bankruptcy.bankruptcy_detect();
00526             <span class="keywordflow">break</span>;
00527 
00528         <span class="keywordflow">case</span> <a class="code" href="Osys_8h.html#a45a24">MODE_LOSE_GAME</a>:
00529             lose_game.lose_game_detect();
00530             <span class="keywordflow">break</span>;
00531 
00532         <span class="keywordflow">case</span> <a class="code" href="Osys_8h.html#a45a25">MODE_FINAL_SCORE</a>:
00533             final_score.final_score_detect();
00534             <span class="keywordflow">break</span>;
00535 
00536         <span class="keywordflow">case</span> <a class="code" href="Osys_8h.html#a45a19">MODE_MORE_REPORT</a>:
00537             more_report.more_report_detect();
00538             <span class="keywordflow">break</span>;
00539 
00540         <span class="keywordflow">case</span> <a class="code" href="Osys_8h.html#a45a20">MODE_DEPT_LIST</a>:
00541             dept_list.dept_list_detect();
00542             <span class="keywordflow">break</span>;
00543 
00544         <span class="keywordflow">case</span> <a class="code" href="Osys_8h.html#a45a30">MODE_HELP_TOPIC</a>:
00545             help_if.help_topic_detect();
00546             <span class="keywordflow">break</span>;
00547 
00548         <span class="keywordflow">case</span> <a class="code" href="Osys_8h.html#a45a31">MODE_HELP_DESC</a>:
00549             help_if.help_desc_detect();
00550             <span class="keywordflow">break</span>;
00551 
00552         <span class="keywordflow">case</span> <a class="code" href="Osys_8h.html#a45a32">MODE_SCEN_WELCOME_LETTER</a>:
00553             letter.scen_welcome_letter_detect();
00554             <span class="keywordflow">break</span>;
00555 
00556         <span class="keywordflow">case</span> <a class="code" href="Osys_8h.html#a45a33">MODE_WELCOME_LETTER</a>:
00557             letter.welcome_letter_detect();
00558             <span class="keywordflow">break</span>;
00559 
00560         <span class="keywordflow">case</span> <a class="code" href="Osys_8h.html#a45a34">MODE_EVALUATION_LETTER</a>:
00561             letter.eval_letter_detect();
00562             <span class="keywordflow">break</span>;
00563 
00564 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00565 <span class="preprocessor"></span>        <span class="keywordflow">case</span> MODE_STATE_REPORT:
00566             letter.state_report_detect();
00567             <span class="keywordflow">break</span>;
00568 <span class="preprocessor">#endif</span>
00569 <span class="preprocessor"></span>
00570         <span class="keywordflow">case</span> <a class="code" href="Osys_8h.html#a45a35">MODE_BLACKBOARD_LOG</a>:
00571             blackboard.black_log_detect();
00572             <span class="keywordflow">break</span>;
00573 
00574         <span class="keywordflow">case</span> <a class="code" href="Osys_8h.html#a45a27">MODE_PRINTING_MENU</a>:
00575             print_menu.detect();
00576             <span class="keywordflow">break</span>;
00577 
00578             <span class="comment">//## fred 0213</span>
00579         <span class="keywordflow">case</span> <a class="code" href="Osys_8h.html#a45a26">MODE_AWARD_REPORT</a>:
00580             misc_report.award_detect();
00581             <span class="keywordflow">break</span>;
00582             <span class="comment">//##</span>
00583 
00584         }
00585     }
00586 }
00587 
00588 <span class="comment">//-------- End of function Sys::detect_view --------//</span>
00589 
00590 <span class="comment">//-------- Begin of function Sys::process_key --------//</span>
00592 <span class="comment">void Sys::process_key(unsigned scanCode, unsigned skeyState) {</span>
00593     <span class="keywordtype">int</span> keyCode,i;
00594     <a class="code" href="classString.html">String</a> str,str2;
00595 
00596     <span class="keywordflow">if</span>( (keyCode = mouse.is_key(scanCode, skeyState, (<a class="code" href="OCOLTBL_8H.html#a2">WORD</a>) 0, <a class="code" href="OMOUSE2_8H.html#a15a14">K_UNIQUE_KEY</a>)) ) {
00597         <span class="keywordflow">if</span>(!news_pop_up_flag) {
00598             <span class="keywordflow">if</span>( keyCode == <span class="charliteral">'9'</span> )
00599                 set_speed(99);
00600 
00601             <span class="keywordflow">if</span>( keyCode &gt;= <span class="charliteral">'0'</span> &amp;&amp; keyCode &lt;= <span class="charliteral">'8'</span> ) {
00602                 set_speed( (keyCode-<span class="charliteral">'0'</span>) * 10 );
00603             }
00604             <span class="comment">/*</span>
00605 <span class="comment">              if( keyCode == '[' )</span>
00606 <span class="comment">              {</span>
00607 <span class="comment">              if(config.frame_speed-10&lt;=0)</span>
00608 <span class="comment">              {</span>
00609 <span class="comment">              set_speed(0);</span>
00610 <span class="comment">              sys.save_speed=0;</span>
00611 <span class="comment">              }</span>
00612 <span class="comment">              else</span>
00613 <span class="comment">              set_speed(config.frame_speed-10);</span>
00614 <span class="comment"></span>
00615 <span class="comment">              return;</span>
00616 <span class="comment">              }</span>
00617 <span class="comment"></span>
00618 <span class="comment">              if( keyCode == ']' )</span>
00619 <span class="comment">              {</span>
00620 <span class="comment">              set_speed(config.frame_speed+10);</span>
00621 <span class="comment">              return;</span>
00622 <span class="comment">              }</span>
00623 <span class="comment"></span>
00624 <span class="comment">              if( keyCode == '-' )                              // lowest game speed</span>
00625 <span class="comment">              {</span>
00626 <span class="comment">              set_speed(0);</span>
00627 <span class="comment">              }</span>
00628 <span class="comment"></span>
00629 <span class="comment">              if( keyCode == '=' )                      // highest game speed</span>
00630 <span class="comment">              {</span>
00631 <span class="comment">              set_speed(99);</span>
00632 <span class="comment">              }</span>
00633 <span class="comment">            */</span>
00634         }
00635 
00636         <span class="comment">//----------------------------------------------//</span>
00637 
00638         <span class="keywordflow">switch</span>(m.upper(keyCode)) {
00639         <span class="keywordflow">case</span> <span class="charliteral">'Z'</span>:
00640             world.set_zoom_level( world.zoom_level==1 ? 2 : 1 );
00641             <span class="keywordflow">break</span>;
00642 
00643         <span class="keywordflow">case</span> <span class="charliteral">'R'</span>:
00644             config.disp_year_end_report = !config.disp_year_end_report;
00645             <span class="keywordflow">break</span>;
00646 
00647             <span class="comment">//----- detect hot keys for reports -------//</span>
00648 
00649         <span class="keywordflow">case</span> <a class="code" href="KEY_8H.html#a16">KEY_F1</a>:
00650             audio.play_wav(<span class="stringliteral">"CAMPUS"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00651             set_view_mode(<a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>);
00652             <span class="keywordflow">break</span>;
00653 
00654         <span class="keywordflow">case</span> <a class="code" href="KEY_8H.html#a17">KEY_F2</a>:
00655             set_view_mode(<a class="code" href="Osys_8h.html#a45a10">MODE_FACULTY_SUMMARY</a>);
00656             <span class="keywordflow">break</span>;
00657 
00658         <span class="keywordflow">case</span> <a class="code" href="KEY_8H.html#a18">KEY_F3</a>:
00659             set_view_mode(<a class="code" href="Osys_8h.html#a45a11">MODE_STUDENT_REPORT</a>);
00660             <span class="keywordflow">break</span>;
00661 
00662         <span class="keywordflow">case</span> <a class="code" href="KEY_8H.html#a19">KEY_F4</a>:
00663             set_view_mode(<a class="code" href="Osys_8h.html#a45a12">MODE_COURSE_REPORT</a>);
00664             <span class="keywordflow">break</span>;
00665 
00666         <span class="keywordflow">case</span> <a class="code" href="KEY_8H.html#a20">KEY_F5</a>:
00667             set_view_mode(<a class="code" href="Osys_8h.html#a45a13">MODE_PERFORMANCE_REPORT</a>);
00668             <span class="keywordflow">break</span>;
00669 
00670         <span class="keywordflow">case</span> <a class="code" href="KEY_8H.html#a21">KEY_F6</a>:
00671             set_view_mode(<a class="code" href="Osys_8h.html#a45a14">MODE_FINANCIAL_REPORT</a>);
00672             <span class="keywordflow">break</span>;
00673 
00674         <span class="keywordflow">case</span> <a class="code" href="KEY_8H.html#a22">KEY_F7</a>:
00675             set_view_mode(<a class="code" href="Osys_8h.html#a45a15">MODE_SCORE_REPORT</a>);
00676             <span class="keywordflow">break</span>;
00677 
00678         <span class="keywordflow">case</span> <a class="code" href="KEY_8H.html#a24">KEY_F9</a>:
00679             set_view_mode(<a class="code" href="Osys_8h.html#a45a31">MODE_HELP_DESC</a>);
00680             back_view_mode=view_mode;
00681             <span class="keywordflow">break</span>;
00682 
00683         <span class="keywordflow">case</span> <a class="code" href="KEY_8H.html#a25">KEY_F10</a>:
00684             menu_pull_down = 1 - menu_pull_down;      <span class="comment">// toggle menu pull down</span>
00685             <span class="keywordflow">if</span>(menu_pull_down) {
00686                 world.draw_all();
00687                 info.disp_column_bitmap(&amp;vga_back);
00688                 vga.blt_buf(<a class="code" href="Oworldmt_8h.html#a12">ZOOM_X1</a>, <a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a>, <a class="code" href="Oworldmt_8h.html#a14">ZOOM_X2</a>, <a class="code" href="Oworldmt_8h.html#a15">ZOOM_Y2</a>,1);
00689                 set_staying_view_mode(<a class="code" href="Osys_8h.html#a45a17">MODE_GAME_OPTIONS</a>);
00690             }
00691             <span class="keywordflow">else</span>
00692                 set_staying_view_mode(0);
00693             <span class="keywordflow">break</span>;
00694 
00695             <span class="comment">//----- detect hot keys for building interfaces ------//</span>
00696 
00697         <span class="keywordflow">case</span> <span class="charliteral">'A'</span>:
00698             set_view_mode(<a class="code" href="Osys_8h.html#a45a38">MODE_FIRST_NONDEPARTMENTAL_FIRM</a> + <a class="code" href="OFIRMID_8H.html#a22a5">FIRM_ADMISSIONS</a> - <a class="code" href="OFIRMID_8H.html#a21a1">FIRST_NONDEPARTMENTAL_FIRM_ID</a> );
00699             <span class="keywordflow">break</span>;
00700 
00701         <span class="keywordflow">case</span> <span class="charliteral">'T'</span>:
00702             set_view_mode(<a class="code" href="Osys_8h.html#a45a38">MODE_FIRST_NONDEPARTMENTAL_FIRM</a> + <a class="code" href="OFIRMID_8H.html#a22a17">FIRM_STADIUM</a> - <a class="code" href="OFIRMID_8H.html#a21a1">FIRST_NONDEPARTMENTAL_FIRM_ID</a> );
00703             <span class="keywordflow">break</span>;
00704 
00705         <span class="keywordflow">case</span> <span class="charliteral">'D'</span>:
00706             set_view_mode(<a class="code" href="Osys_8h.html#a45a38">MODE_FIRST_NONDEPARTMENTAL_FIRM</a> + <a class="code" href="OFIRMID_8H.html#a22a6">FIRM_DEVELOPMENT</a> - <a class="code" href="OFIRMID_8H.html#a21a1">FIRST_NONDEPARTMENTAL_FIRM_ID</a> );
00707             <span class="keywordflow">break</span>;
00708 
00709         <span class="keywordflow">case</span> <span class="charliteral">'F'</span>:
00710             set_view_mode(<a class="code" href="Osys_8h.html#a45a38">MODE_FIRST_NONDEPARTMENTAL_FIRM</a> + <a class="code" href="OFIRMID_8H.html#a22a7">FIRM_FACILITIES</a> - <a class="code" href="OFIRMID_8H.html#a21a1">FIRST_NONDEPARTMENTAL_FIRM_ID</a> );
00711             <span class="keywordflow">break</span>;
00712 
00713         <span class="keywordflow">case</span> <span class="charliteral">'L'</span>:
00714             set_view_mode(<a class="code" href="Osys_8h.html#a45a38">MODE_FIRST_NONDEPARTMENTAL_FIRM</a> + <a class="code" href="OFIRMID_8H.html#a22a3">FIRM_LIBRARY</a> - <a class="code" href="OFIRMID_8H.html#a21a1">FIRST_NONDEPARTMENTAL_FIRM_ID</a> );
00715             <span class="keywordflow">break</span>;
00716 
00717         <span class="keywordflow">case</span> <span class="charliteral">'C'</span>:
00718             set_view_mode(<a class="code" href="Osys_8h.html#a45a38">MODE_FIRST_NONDEPARTMENTAL_FIRM</a> + <a class="code" href="OFIRMID_8H.html#a22a13">FIRM_POLICE</a> - <a class="code" href="OFIRMID_8H.html#a21a1">FIRST_NONDEPARTMENTAL_FIRM_ID</a> );
00719             <span class="keywordflow">break</span>;
00720 
00721         <span class="keywordflow">case</span> <span class="charliteral">'K'</span>:
00722             set_view_mode(<a class="code" href="Osys_8h.html#a45a38">MODE_FIRST_NONDEPARTMENTAL_FIRM</a> + <a class="code" href="OFIRMID_8H.html#a22a14">FIRM_PARK_LOTS</a> - <a class="code" href="OFIRMID_8H.html#a21a1">FIRST_NONDEPARTMENTAL_FIRM_ID</a> );
00723             <span class="keywordflow">break</span>;
00724 
00725         <span class="keywordflow">case</span> <span class="charliteral">'I'</span>:
00726             set_view_mode(<a class="code" href="Osys_8h.html#a45a38">MODE_FIRST_NONDEPARTMENTAL_FIRM</a> + <a class="code" href="OFIRMID_8H.html#a22a4">FIRM_OLD_MAIN</a> - <a class="code" href="OFIRMID_8H.html#a21a1">FIRST_NONDEPARTMENTAL_FIRM_ID</a> );
00727             <span class="keywordflow">break</span>;
00728 
00729         <span class="keywordflow">case</span> <a class="code" href="KEY_8H.html#a27">KEY_F12</a>:
00730             <span class="keywordflow">for</span>(i=0 ; i&lt;=99 ; i++ ) {
00731                 str = <span class="stringliteral">"VUSCR"</span>;
00732                 <span class="keywordflow">if</span>( i&lt;10 )
00733                     str += <span class="stringliteral">"0"</span>;
00734 
00735                 str += i;
00736                 str += <span class="stringliteral">".BMP"</span>;
00737                 <span class="keywordflow">if</span>( !m.is_file_exist(str) )
00738                     <span class="keywordflow">break</span>;
00739             }
00740 
00741             <span class="keywordflow">if</span>( i&gt;99 )                                <span class="comment">// all file names from VUSCR00 to VUSCR99 have been occupied</span>
00742                 <span class="keywordflow">return</span>;
00743 
00744             <span class="comment">//vga.use_back();</span>
00745             <span class="comment">//vga_back.bar(260, 515, 620, 590, V_BLACK );</span>
00746             str2=<span class="stringliteral">"Capture screen to file "</span>;
00747             str2+=str;
00748             str2+=<span class="stringliteral">" "</span>;
00749             <span class="comment">//font_fblack.put(265,520,str2);</span>
00750             <span class="comment">//vga.blt_buf(260, 515, 620, 590);</span>
00751             vga_front.write_bmp_file(str);
00752 
00753             box.msg( str2 );
00754             <span class="keywordflow">break</span>;
00755         }
00756     }
00757 }
00758 
00759 <span class="comment">//--------- End of function Sys::process_key ---------//</span>
00760 
00761 <span class="comment">//-------- Begin of function Sys::detect_cheat_key --------//</span>
00763 <span class="comment">int Sys::detect_cheat_key(unsigned scanCode, unsigned skeyState) {</span>
00764     <span class="keywordtype">int</span> keyCode;
00765 
00766 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00767 <span class="preprocessor"></span>    <span class="keywordflow">if</span>((keyCode = mouse.is_key(scanCode, skeyState, (<a class="code" href="OCOLTBL_8H.html#a2">WORD</a>) 0, <a class="code" href="OMOUSE2_8H.html#a15a2">K_IS_CTRL</a>))) {
00768         <span class="keywordflow">switch</span>(m.upper(keyCode)) {
00769         <span class="keywordflow">case</span> <span class="charliteral">'M'</span>: player_school.set_cks( 1, 0.1 ); <span class="keywordflow">return</span> 1;
00770         <span class="keywordflow">case</span> <span class="charliteral">'N'</span>: player_school.set_cks( 1, -0.1 ); <span class="keywordflow">return</span> 1;
00771         <span class="keywordflow">case</span> <span class="charliteral">'O'</span>: player_school.set_cks( 2, 0.1 ); <span class="keywordflow">return</span> 1;
00772         <span class="keywordflow">case</span> <span class="charliteral">'P'</span>: player_school.set_cks( 2, -0.1 ); <span class="keywordflow">return</span> 1;
00773         <span class="keywordflow">case</span> <span class="charliteral">'Q'</span>: player_school.set_cks( 3, 0.1 ); <span class="keywordflow">return</span> 1;
00774         <span class="keywordflow">case</span> <span class="charliteral">'R'</span>: player_school.set_cks( 3, -0.1 ); <span class="keywordflow">return</span> 1;
00775         }
00776     }
00777 <span class="preprocessor">#endif</span>
00778 <span class="preprocessor"></span>
00779 <span class="preprocessor">#ifdef TEST_CHANCE</span>
00780 <span class="preprocessor"></span>
00781     <span class="keywordflow">if</span>((keyCode = mouse.is_key(scanCode, skeyState, (<a class="code" href="OCOLTBL_8H.html#a2">WORD</a>) 0, <a class="code" href="OMOUSE2_8H.html#a15a2">K_IS_CTRL</a>))) {
00782         <span class="keywordflow">switch</span>(m.upper(keyCode)) {
00783             <span class="comment">//----- shortcut for testing chance cards ----//</span>
00784         <span class="keywordflow">case</span> <span class="charliteral">'1'</span>:
00785             chance_event.test_chance=1;
00786             <span class="keywordflow">break</span>;
00787         <span class="keywordflow">case</span> <span class="charliteral">'2'</span>:
00788             chance_event.test_chance=2;
00789             <span class="keywordflow">break</span>;
00790         <span class="keywordflow">case</span> <span class="charliteral">'3'</span>:
00791             chance_event.test_chance=3;
00792             <span class="keywordflow">break</span>;
00793         <span class="keywordflow">case</span> <span class="charliteral">'4'</span>:
00794             chance_event.test_chance=4;
00795             <span class="keywordflow">break</span>;
00796         <span class="keywordflow">case</span> <span class="charliteral">'5'</span>:
00797             chance_event.test_chance=5;
00798             <span class="keywordflow">break</span>;
00799         <span class="keywordflow">case</span> <span class="charliteral">'6'</span>:
00800             chance_event.test_chance=6;
00801             <span class="keywordflow">break</span>;
00802         <span class="keywordflow">case</span> <span class="charliteral">'7'</span>:
00803             chance_event.test_chance=7;
00804             <span class="keywordflow">break</span>;
00805         <span class="keywordflow">case</span> <span class="charliteral">'8'</span>:
00806             chance_event.test_chance=8;
00807             <span class="keywordflow">break</span>;
00808         <span class="keywordflow">case</span> <span class="charliteral">'9'</span>:
00809             chance_event.test_chance=9;
00810             <span class="keywordflow">break</span>;
00811         <span class="keywordflow">case</span> <span class="charliteral">'0'</span>:
00812             chance_event.test_chance=10;
00813             <span class="keywordflow">break</span>;
00814         <span class="keywordflow">case</span> <span class="charliteral">'A'</span>:
00815             chance_event.test_chance=11;
00816             <span class="keywordflow">break</span>;
00817         <span class="keywordflow">case</span> <span class="charliteral">'B'</span>:
00818             chance_event.test_chance=12;
00819             <span class="keywordflow">break</span>;
00820         <span class="keywordflow">case</span> <span class="charliteral">'C'</span>:
00821             chance_event.test_chance=13;
00822             <span class="keywordflow">break</span>;
00823         <span class="keywordflow">case</span> <span class="charliteral">'D'</span>:
00824             chance_event.test_chance=14;
00825             <span class="keywordflow">break</span>;
00826         <span class="keywordflow">case</span> <span class="charliteral">'E'</span>:
00827             chance_event.test_chance=15;
00828             <span class="keywordflow">break</span>;
00829         <span class="keywordflow">case</span> <span class="charliteral">'F'</span>:
00830             chance_event.test_chance=16;
00831             <span class="keywordflow">break</span>;
00832         <span class="keywordflow">case</span> <span class="charliteral">'G'</span>:
00833             chance_event.test_chance=17;
00834             <span class="keywordflow">break</span>;
00835         <span class="keywordflow">case</span> <span class="charliteral">'H'</span>:
00836             chance_event.test_chance=18;
00837             <span class="keywordflow">break</span>;
00838         <span class="keywordflow">case</span> <span class="charliteral">'I'</span>:
00839             chance_event.test_chance=19;
00840             <span class="keywordflow">break</span>;
00841         <span class="keywordflow">case</span> <span class="charliteral">'J'</span>:
00842             chance_event.test_chance=20;
00843             <span class="keywordflow">break</span>;
00844         <span class="keywordflow">case</span> <span class="charliteral">'K'</span>:
00845             chance_event.test_chance=<a class="code" href="Onews_8h.html#a51a38">NEWS_FOOTBALL_GAME</a>;
00846             <span class="keywordflow">break</span>;
00847         <span class="keywordflow">case</span> <span class="charliteral">'L'</span>:
00848             chance_event.test_chance=<a class="code" href="Onews_8h.html#a51a39">NEWS_BASKETBALL_GAME</a>;
00849             <span class="keywordflow">break</span>;
00850 
00851         <span class="keywordflow">default</span>:
00852             <span class="keywordflow">return</span> 0;
00853         }
00854 
00855         <span class="keywordflow">return</span> 1;
00856     }
00857 <span class="preprocessor">#endif</span>
00858 <span class="preprocessor"></span>
00859     <span class="keywordflow">return</span> 0;
00860 }
00861 
00862 <span class="comment">//--------- End of function Sys::detect_cheat_key ---------//</span>
00863 
00864 <span class="comment">//-------- Begin of function Sys::set_view_mode --------//</span>
<a name="l00866"></a><a class="code" href="classSys.html#a14">00866</a> <span class="comment">void Sys::set_view_mode(int viewMode, int playSound) {</span>
00867     view_mode = viewMode;
00868 
00869     <span class="keywordflow">if</span>( playSound ) {
00870         <span class="keywordflow">switch</span>(viewMode) {
00871         <span class="keywordflow">case</span>  <a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>:
00872             <span class="comment">//                  audio.play_wav("CAMPUS",audio.int_to_DsVolume(config.sound_effect_volume));</span>
00873             <span class="keywordflow">break</span>;
00874 
00875         <span class="keywordflow">case</span> <a class="code" href="Osys_8h.html#a45a13">MODE_PERFORMANCE_REPORT</a>:
00876             <span class="comment">//                  audio.play_wav("FACULTY",audio.int_to_DsVolume(config.sound_effect_volume));</span>
00877             <span class="keywordflow">break</span>;
00878 
00879         <span class="keywordflow">case</span>  <a class="code" href="Osys_8h.html#a45a10">MODE_FACULTY_SUMMARY</a>:
00880             audio.play_wav(<span class="stringliteral">"FACULTY"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00881             <span class="keywordflow">break</span>;
00882 
00883         <span class="keywordflow">case</span>  <a class="code" href="Osys_8h.html#a45a12">MODE_COURSE_REPORT</a>:
00884             audio.play_wav(<span class="stringliteral">"COURSE"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00885             <span class="keywordflow">break</span>;
00886 
00887         <span class="keywordflow">case</span>  <a class="code" href="Osys_8h.html#a45a11">MODE_STUDENT_REPORT</a>:
00888             audio.play_wav(<span class="stringliteral">"STUDENTS"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00889             <span class="keywordflow">break</span>;
00890 
00891         <span class="keywordflow">case</span>  <a class="code" href="Osys_8h.html#a45a14">MODE_FINANCIAL_REPORT</a>:
00892             audio.play_wav(<span class="stringliteral">"FINANCE"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00893             <span class="keywordflow">break</span>;
00894 
00895         <span class="keywordflow">case</span>  <a class="code" href="Osys_8h.html#a45a15">MODE_SCORE_REPORT</a>:
00896             audio.play_wav(<span class="stringliteral">"SCORE"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00897             <span class="keywordflow">break</span>;
00898 
00899             <span class="comment">//--------------------------------------------//</span>
00900 
00901         <span class="keywordflow">case</span>  <a class="code" href="Osys_8h.html#a45a38">MODE_FIRST_NONDEPARTMENTAL_FIRM</a> + <a class="code" href="OFIRMID_8H.html#a22a5">FIRM_ADMISSIONS</a> - <a class="code" href="OFIRMID_8H.html#a21a1">FIRST_NONDEPARTMENTAL_FIRM_ID</a>:
00902             audio.play_wav(<span class="stringliteral">"ADMISSN"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00903             <span class="keywordflow">break</span>;
00904 
00905         <span class="keywordflow">case</span>  <a class="code" href="Osys_8h.html#a45a38">MODE_FIRST_NONDEPARTMENTAL_FIRM</a> + <a class="code" href="OFIRMID_8H.html#a22a17">FIRM_STADIUM</a> - <a class="code" href="OFIRMID_8H.html#a21a1">FIRST_NONDEPARTMENTAL_FIRM_ID</a>:
00906             <span class="keywordflow">if</span>( m.random(2) )                         <span class="comment">// randomly choose between football and basketball sound</span>
00907                 audio.play_wav(<span class="stringliteral">"BBALL"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00908             <span class="keywordflow">else</span>
00909                 audio.play_wav(<span class="stringliteral">"FOOTBALL"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00910             <span class="keywordflow">break</span>;
00911 
00912         <span class="keywordflow">case</span>  <a class="code" href="Osys_8h.html#a45a38">MODE_FIRST_NONDEPARTMENTAL_FIRM</a> + <a class="code" href="OFIRMID_8H.html#a22a6">FIRM_DEVELOPMENT</a> - <a class="code" href="OFIRMID_8H.html#a21a1">FIRST_NONDEPARTMENTAL_FIRM_ID</a>:
00913             audio.play_wav(<span class="stringliteral">"DEVALUMN"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00914             <span class="keywordflow">break</span>;
00915 
00916         <span class="keywordflow">case</span>  <a class="code" href="Osys_8h.html#a45a38">MODE_FIRST_NONDEPARTMENTAL_FIRM</a> + <a class="code" href="OFIRMID_8H.html#a22a7">FIRM_FACILITIES</a> - <a class="code" href="OFIRMID_8H.html#a21a1">FIRST_NONDEPARTMENTAL_FIRM_ID</a>:
00917             audio.play_wav(<span class="stringliteral">"FACMAN"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00918             <span class="keywordflow">break</span>;
00919 
00920         <span class="keywordflow">case</span>  <a class="code" href="Osys_8h.html#a45a38">MODE_FIRST_NONDEPARTMENTAL_FIRM</a> + <a class="code" href="OFIRMID_8H.html#a22a3">FIRM_LIBRARY</a> - <a class="code" href="OFIRMID_8H.html#a21a1">FIRST_NONDEPARTMENTAL_FIRM_ID</a>:
00921             audio.play_wav(<span class="stringliteral">"INFOTECH"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00922             <span class="keywordflow">break</span>;
00923 
00924         <span class="keywordflow">case</span>  <a class="code" href="Osys_8h.html#a45a38">MODE_FIRST_NONDEPARTMENTAL_FIRM</a> + <a class="code" href="OFIRMID_8H.html#a22a4">FIRM_OLD_MAIN</a> - <a class="code" href="OFIRMID_8H.html#a21a1">FIRST_NONDEPARTMENTAL_FIRM_ID</a>:
00925             audio.play_wav(<span class="stringliteral">"INVEST"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00926             <span class="keywordflow">break</span>;
00927 
00928         <span class="keywordflow">case</span>  <a class="code" href="Osys_8h.html#a45a38">MODE_FIRST_NONDEPARTMENTAL_FIRM</a> + <a class="code" href="OFIRMID_8H.html#a22a13">FIRM_POLICE</a> - <a class="code" href="OFIRMID_8H.html#a21a1">FIRST_NONDEPARTMENTAL_FIRM_ID</a>:
00929             audio.play_wav(<span class="stringliteral">"CRIME"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00930             <span class="keywordflow">break</span>;
00931 
00932         <span class="keywordflow">case</span>  <a class="code" href="Osys_8h.html#a45a38">MODE_FIRST_NONDEPARTMENTAL_FIRM</a> + <a class="code" href="OFIRMID_8H.html#a22a14">FIRM_PARK_LOTS</a> - <a class="code" href="OFIRMID_8H.html#a21a1">FIRST_NONDEPARTMENTAL_FIRM_ID</a>:
00933             audio.play_wav(<span class="stringliteral">"PARKING"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00934             <span class="keywordflow">break</span>;
00935         }
00936     }
00937 
00938     <span class="keywordflow">if</span>( view_mode &gt;= <a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a> &amp;&amp; view_mode &lt;= <a class="code" href="Osys_8h.html#a45a15">MODE_SCORE_REPORT</a> )
00939         vga_back.put_bitmap(<a class="code" href="Oinfo_8h.html#a99a6">REPORT_BUTTON_X1</a>, <a class="code" href="Oinfo_8h.html#a99a7">REPORT_BUTTON_Y1</a>, info.report_bitmap[view_mode-<a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>+1]);
00940     <span class="keywordflow">else</span>
00941         <span class="comment">// the report does not belong to any of the buttons</span>
00942         vga_back.put_bitmap(<a class="code" href="Oinfo_8h.html#a99a6">REPORT_BUTTON_X1</a>, <a class="code" href="Oinfo_8h.html#a99a7">REPORT_BUTTON_Y1</a>, info.report_bitmap[0]);
00943 
00944     vga.blt_buf(<a class="code" href="Oinfo_8h.html#a99a6">REPORT_BUTTON_X1</a>, <a class="code" href="Oinfo_8h.html#a99a7">REPORT_BUTTON_Y1</a>, <a class="code" href="Oinfo_8h.html#a99a8">REPORT_BUTTON_X2</a>, <a class="code" href="Oinfo_8h.html#a99a9">REPORT_BUTTON_Y2</a>);
00945 
00946     redraw_all_flag = 1;
00947 
00948     <span class="comment">//------- initialize interface control vars when the user enters the screen ----//</span>
00949 
00950     <span class="keywordflow">if</span>( view_mode == <a class="code" href="Osys_8h.html#a45a38">MODE_FIRST_NONDEPARTMENTAL_FIRM</a> + <a class="code" href="OFIRMID_8H.html#a22a7">FIRM_FACILITIES</a> - <a class="code" href="OFIRMID_8H.html#a21a1">FIRST_NONDEPARTMENTAL_FIRM_ID</a> ) {
00951         facility_office.debt_spinner_var1=(float)facility_office.percent_project_funded_with_debt;
00952         facility_office.debt_spinner_var2=(float)facility_office.cur_debt_limit;
00953     }
00954 }
00955 
00956 <span class="comment">//--------- End of function Sys::set_view_mode ---------//</span>
00957 
00958 <span class="comment">//-------- Begin of function Sys::set_staying_view_mode --------//</span>
<a name="l00963"></a><a class="code" href="classSys.html#a15">00963</a> <span class="comment">void Sys::set_staying_view_mode(int viewMode) {</span>
00964     <span class="keywordflow">if</span>( viewMode==0 ) {
00965         <span class="keywordflow">if</span>(staying_view_mode&gt;0) {
00966             staying_view_mode = 0;
00967 
00968             set_speed(save_speed);
00969             set_view_mode(save_view_mode);
00970         }
00971     }
00972     <span class="keywordflow">else</span> {
00973         save_speed = config.frame_speed;
00974 
00975         save_view_mode = view_mode;
00976 
00977         set_speed(0);                                 <span class="comment">// set the gaming speed to frozen, the speed is frozen until the player reset the staying view_mode</span>
00978         set_view_mode(viewMode);
00979 
00980         staying_view_mode = viewMode;
00981     }
00982 }
00983 
00984 <span class="comment">//--------- End of function Sys::set_staying_view_mode ---------//</span>
00985 
00986 <span class="comment">//-------- Begin of function Sys::detect_report_button ---------//</span>
00991 <span class="comment">int Sys::detect_report_button() {</span>
00992 
00993     <span class="keywordflow">if</span> (mouse.single_click(<a class="code" href="Oinfo_8h.html#a98a2">MENU_BUTTON_X1</a>, <a class="code" href="Oinfo_8h.html#a98a3">MENU_BUTTON_Y1</a>, <a class="code" href="Oinfo_8h.html#a98a4">MENU_BUTTON_X2</a>, <a class="code" href="Oinfo_8h.html#a98a5">MENU_BUTTON_Y2</a>)) {
00994         audio.play_wav(<span class="stringliteral">"STONES"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00995 
00996         menu_pull_down = 1 - menu_pull_down;          <span class="comment">// toggle menu pull down</span>
00997 
00998         <span class="keywordflow">if</span>(menu_pull_down) {
00999             world.draw_all();
01000             info.disp_column_bitmap(&amp;vga_back);
01001             vga.blt_buf(<a class="code" href="Oworldmt_8h.html#a12">ZOOM_X1</a>, <a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a>, <a class="code" href="Oworldmt_8h.html#a14">ZOOM_X2</a>, <a class="code" href="Oworldmt_8h.html#a15">ZOOM_Y2</a>,1);
01002             set_staying_view_mode(<a class="code" href="Osys_8h.html#a45a17">MODE_GAME_OPTIONS</a>);
01003             <span class="comment">// BUGHERE</span>
01004             <span class="comment">// We also need to disable all buttons, besides 'menu button'</span>
01005         }
01006         <span class="keywordflow">else</span>
01007             set_staying_view_mode(0);
01008 
01009         <span class="keywordflow">return</span> 1;
01010     }
01011 
01012     <span class="keywordflow">if</span>(view_mode==<a class="code" href="Osys_8h.html#a45a17">MODE_GAME_OPTIONS</a>)
01013         <span class="keywordflow">return</span> 0;
01014 
01015     <span class="keywordflow">if</span>(view_mode!=<a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>)
01016         <span class="keywordflow">if</span>(mouse.single_click(<a class="code" href="Oworldmt_8h.html#a2">MAP_X1</a>, <a class="code" href="Oworldmt_8h.html#a3">MAP_Y1</a>, <a class="code" href="Oworldmt_8h.html#a4">MAP_X2</a>, <a class="code" href="Oworldmt_8h.html#a5">MAP_Y2</a>)) {
01017             set_view_mode(<a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>);
01018             <span class="keywordflow">return</span> 1;
01019         }
01020 
01021     help.set_help(<a class="code" href="Osysdet_8cpp.html#a38a2">REPORT_BUTTON_CAMPUS_X1</a>, <a class="code" href="Osysdet_8cpp.html#a38a3">REPORT_BUTTON_CAMPUS_Y1</a>, <a class="code" href="Osysdet_8cpp.html#a38a4">REPORT_BUTTON_CAMPUS_X2</a>, <a class="code" href="Osysdet_8cpp.html#a38a5">REPORT_BUTTON_CAMPUS_Y2</a>,<span class="stringliteral">"U01."</span>);
01022     help.set_help(<a class="code" href="Osysdet_8cpp.html#a38a6">REPORT_BUTTON_FACULTY_X1</a>, <a class="code" href="Osysdet_8cpp.html#a38a7">REPORT_BUTTON_FACULTY_Y1</a>, <a class="code" href="Osysdet_8cpp.html#a38a8">REPORT_BUTTON_FACULTY_X2</a>, <a class="code" href="Osysdet_8cpp.html#a38a9">REPORT_BUTTON_FACULTY_Y2</a>,<span class="stringliteral">"U02."</span>);
01023     help.set_help(<a class="code" href="Osysdet_8cpp.html#a38a10">REPORT_BUTTON_STUDENTS_X1</a>, <a class="code" href="Osysdet_8cpp.html#a38a11">REPORT_BUTTON_STUDENTS_Y1</a>, <a class="code" href="Osysdet_8cpp.html#a38a12">REPORT_BUTTON_STUDENTS_X2</a>, <a class="code" href="Osysdet_8cpp.html#a38a13">REPORT_BUTTON_STUDENTS_Y2</a>,<span class="stringliteral">"U03."</span>);
01024     help.set_help(<a class="code" href="Osysdet_8cpp.html#a38a14">REPORT_BUTTON_COURSES_X1</a>, <a class="code" href="Osysdet_8cpp.html#a38a15">REPORT_BUTTON_COURSES_Y1</a>, <a class="code" href="Osysdet_8cpp.html#a38a16">REPORT_BUTTON_COURSES_X2</a>, <a class="code" href="Osysdet_8cpp.html#a38a17">REPORT_BUTTON_COURSES_Y2</a>,<span class="stringliteral">"U04."</span>);
01025     help.set_help(<a class="code" href="Osysdet_8cpp.html#a38a18">REPORT_BUTTON_PERFORMANCE_X1</a>, <a class="code" href="Osysdet_8cpp.html#a38a19">REPORT_BUTTON_PERFORMANCE_Y1</a>, <a class="code" href="Osysdet_8cpp.html#a38a20">REPORT_BUTTON_PERFORMANCE_X2</a>, <a class="code" href="Osysdet_8cpp.html#a38a21">REPORT_BUTTON_PERFORMANCE_Y2</a>,<span class="stringliteral">"U05."</span>);
01026     help.set_help(<a class="code" href="Osysdet_8cpp.html#a38a22">REPORT_BUTTON_FINANCIAL_X1</a>, <a class="code" href="Osysdet_8cpp.html#a38a23">REPORT_BUTTON_FINANCIAL_Y1</a>, <a class="code" href="Osysdet_8cpp.html#a38a24">REPORT_BUTTON_FINANCIAL_X2</a>, <a class="code" href="Osysdet_8cpp.html#a38a25">REPORT_BUTTON_FINANCIAL_Y2</a>,<span class="stringliteral">"U06."</span>);
01027     help.set_help(<a class="code" href="Osysdet_8cpp.html#a38a26">REPORT_BUTTON_SCORE_X1</a>, <a class="code" href="Osysdet_8cpp.html#a38a27">REPORT_BUTTON_SCORE_Y1</a>, <a class="code" href="Osysdet_8cpp.html#a38a28">REPORT_BUTTON_SCORE_X2</a>, <a class="code" href="Osysdet_8cpp.html#a38a29">REPORT_BUTTON_SCORE_Y2</a>,<span class="stringliteral">"U07."</span>);
01028 
01029     help.set_help(<a class="code" href="Oinfo_8h.html#a101a12">SURPLUS_INFO_X1</a>,<a class="code" href="Oinfo_8h.html#a101a13">SURPLUS_INFO_Y1</a>,<a class="code" href="Oinfo_8h.html#a101a14">SURPLUS_INFO_X2</a>,<a class="code" href="Oinfo_8h.html#a101a15">SURPLUS_INFO_Y2</a>,<span class="stringliteral">"U08."</span>);
01030     help.set_help(514,0,<a class="code" href="Oinfo_8h.html#a102a18">SCORE_INFO_X2</a>,<a class="code" href="Oinfo_8h.html#a102a19">SCORE_INFO_Y2</a>,<span class="stringliteral">"U09."</span>);
01031     help.set_help(578,0,<a class="code" href="Oinfo_8h.html#a103a22">U_SCORE_INFO_X2</a>,<a class="code" href="Oinfo_8h.html#a103a23">U_SCORE_INFO_Y2</a>,<span class="stringliteral">"U10."</span>);
01032     help.set_help(<a class="code" href="Oinfo_8h.html#a105a34">DATE_INFO_X1</a>,<a class="code" href="Oinfo_8h.html#a104a25">MONTH_Y1</a>,<a class="code" href="Oinfo_8h.html#a106a40">YEAR_INFO_X2</a>,<a class="code" href="Oinfo_8h.html#a105a37">DATE_INFO_Y2</a>,<span class="stringliteral">"U11."</span>);
01033 
01034     <span class="comment">//  help.set_help(YEAR_INFO_X1,YEAR_INFO_Y1,YEAR_INFO_X2,YEAR_INFO_Y2,"");</span>
01035     <span class="comment">//  help.set_help(TOP_INFO_X1,TOP_INFO_Y1,TOP_INFO_X2,TOP_INFO_Y2,"");</span>
01036     <span class="comment">//  help.set_help(BOTTOM_INFO_X1,BOTTOM_INFO_Y1,BOTTOM_INFO_X2,BOTTOM_INFO_Y2,"");</span>
01037 
01038     help.set_help(<a class="code" href="Oinfo_8h.html#a98a2">MENU_BUTTON_X1</a>, <a class="code" href="Oinfo_8h.html#a98a3">MENU_BUTTON_Y1</a>, <a class="code" href="Oinfo_8h.html#a98a4">MENU_BUTTON_X2</a>, <a class="code" href="Oinfo_8h.html#a98a5">MENU_BUTTON_Y2</a>,<span class="stringliteral">"U12."</span>);
01039     help.set_help(<a class="code" href="Oinfo_8h.html#a109a50">MORE_REPORT_X1</a>,<a class="code" href="Oinfo_8h.html#a109a51">MORE_REPORT_Y1</a>,<a class="code" href="Oinfo_8h.html#a109a52">MORE_REPORT_X2</a>,<a class="code" href="Oinfo_8h.html#a109a53">MORE_REPORT_Y2</a>,<span class="stringliteral">"U14."</span>);
01040     help.set_help(<a class="code" href="Oinfo_8h.html#a111a58">LIST_BUTTON_X1</a>,<a class="code" href="Oinfo_8h.html#a111a59">LIST_BUTTON_Y1</a>,<a class="code" href="Oinfo_8h.html#a111a60">LIST_BUTTON_X2</a>,<a class="code" href="Oinfo_8h.html#a111a61">LIST_BUTTON_Y2</a>,<span class="stringliteral">"U15."</span>);
01041 
01042     help.set_help(557, 31, 581, 44, <span class="stringliteral">"U16."</span>);        <span class="comment">// prev department</span>
01043     help.set_help(590, 31, 614, 44, <span class="stringliteral">"U17."</span>);        <span class="comment">// next department</span>
01044 
01045     <span class="comment">// M</span>
01046     help.set_help(223, 516+m_o_log_bitmap_y[0], 253, 516+m_o_log_bitmap_y[1],<span class="stringliteral">"U18."</span>);
01047     <span class="comment">// O</span>
01048     help.set_help(223, 516+m_o_log_bitmap_y[1], 253, 516+m_o_log_bitmap_y[2],<span class="stringliteral">"U19."</span>);
01049     <span class="comment">// LOG</span>
01050     help.set_help(223, 516+m_o_log_bitmap_y[2], 253, 516+m_o_log_bitmap_y[3],<span class="stringliteral">"U20."</span>);
01051 
01052     help.set_help(260, 515, 620, 590, <span class="stringliteral">"U21."</span>);      <span class="comment">// U21 reserved for Message Board</span>
01053     help.set_help(178, 515, 208, 541, <span class="stringliteral">"U22."</span>);      <span class="comment">// Zoom</span>
01054     <span class="comment">// speed indicator</span>
01055     help.set_help( 112, 538, 110+67, 538+31, <span class="stringliteral">"U23."</span> );
01056     help.set_help(180, 564, 210, 594, <span class="stringliteral">"U24."</span>);      <span class="comment">// Printer</span>
01057     help.set_help(8, 562, 74, 599, <span class="stringliteral">"U25."</span>);         <span class="comment">// Mail</span>
01058     help.set_help(<a class="code" href="Oinfo_8h.html#a113a86">MIN_MAX_X1</a>,<a class="code" href="Oinfo_8h.html#a113a87">MIN_MAX_Y1</a>,<a class="code" href="Oinfo_8h.html#a113a88">MIN_MAX_X2</a>,<a class="code" href="Oinfo_8h.html#a113a89">MIN_MAX_Y2</a>,<span class="stringliteral">"U26."</span>);
01059 
01060     <span class="comment">// U27 reserved for Small Map</span>
01061 
01062     <span class="keywordflow">if</span> (mouse.single_click(<a class="code" href="Osysdet_8cpp.html#a38a2">REPORT_BUTTON_CAMPUS_X1</a>, <a class="code" href="Osysdet_8cpp.html#a38a3">REPORT_BUTTON_CAMPUS_Y1</a>, <a class="code" href="Osysdet_8cpp.html#a38a4">REPORT_BUTTON_CAMPUS_X2</a>, <a class="code" href="Osysdet_8cpp.html#a38a5">REPORT_BUTTON_CAMPUS_Y2</a>)) {
01063         audio.play_wav(<span class="stringliteral">"CAMPUS"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
01064         set_view_mode(<a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>);
01065         <span class="keywordflow">return</span> 1;
01066     }
01067 
01068     <span class="keywordflow">if</span> (mouse.single_click(<a class="code" href="Osysdet_8cpp.html#a38a6">REPORT_BUTTON_FACULTY_X1</a>, <a class="code" href="Osysdet_8cpp.html#a38a7">REPORT_BUTTON_FACULTY_Y1</a>, <a class="code" href="Osysdet_8cpp.html#a38a8">REPORT_BUTTON_FACULTY_X2</a>, <a class="code" href="Osysdet_8cpp.html#a38a9">REPORT_BUTTON_FACULTY_Y2</a>)) {
01069         set_view_mode(<a class="code" href="Osys_8h.html#a45a10">MODE_FACULTY_SUMMARY</a>);
01070         <span class="keywordflow">return</span> 1;
01071     }
01072 
01073     <span class="keywordflow">if</span> (mouse.single_click(<a class="code" href="Osysdet_8cpp.html#a38a10">REPORT_BUTTON_STUDENTS_X1</a>, <a class="code" href="Osysdet_8cpp.html#a38a11">REPORT_BUTTON_STUDENTS_Y1</a>, <a class="code" href="Osysdet_8cpp.html#a38a12">REPORT_BUTTON_STUDENTS_X2</a>, <a class="code" href="Osysdet_8cpp.html#a38a13">REPORT_BUTTON_STUDENTS_Y2</a>)) {
01074         set_view_mode(<a class="code" href="Osys_8h.html#a45a11">MODE_STUDENT_REPORT</a>);
01075         <span class="keywordflow">return</span> 1;
01076     }
01077 
01078     <span class="keywordflow">if</span> (mouse.single_click(<a class="code" href="Osysdet_8cpp.html#a38a14">REPORT_BUTTON_COURSES_X1</a>, <a class="code" href="Osysdet_8cpp.html#a38a15">REPORT_BUTTON_COURSES_Y1</a>, <a class="code" href="Osysdet_8cpp.html#a38a16">REPORT_BUTTON_COURSES_X2</a>, <a class="code" href="Osysdet_8cpp.html#a38a17">REPORT_BUTTON_COURSES_Y2</a>)) {
01079         set_view_mode(<a class="code" href="Osys_8h.html#a45a12">MODE_COURSE_REPORT</a>);
01080         <span class="keywordflow">return</span> 1;
01081     }
01082 
01083     <span class="keywordflow">if</span> (mouse.single_click(<a class="code" href="Osysdet_8cpp.html#a38a18">REPORT_BUTTON_PERFORMANCE_X1</a>, <a class="code" href="Osysdet_8cpp.html#a38a19">REPORT_BUTTON_PERFORMANCE_Y1</a>, <a class="code" href="Osysdet_8cpp.html#a38a20">REPORT_BUTTON_PERFORMANCE_X2</a>, <a class="code" href="Osysdet_8cpp.html#a38a21">REPORT_BUTTON_PERFORMANCE_Y2</a>)) {
01084         set_view_mode(<a class="code" href="Osys_8h.html#a45a13">MODE_PERFORMANCE_REPORT</a>);
01085         <span class="keywordflow">return</span> 1;
01086     }
01087 
01088     <span class="keywordflow">if</span> (mouse.single_click(<a class="code" href="Osysdet_8cpp.html#a38a22">REPORT_BUTTON_FINANCIAL_X1</a>, <a class="code" href="Osysdet_8cpp.html#a38a23">REPORT_BUTTON_FINANCIAL_Y1</a>, <a class="code" href="Osysdet_8cpp.html#a38a24">REPORT_BUTTON_FINANCIAL_X2</a>, <a class="code" href="Osysdet_8cpp.html#a38a25">REPORT_BUTTON_FINANCIAL_Y2</a>)) {
01089         set_view_mode(<a class="code" href="Osys_8h.html#a45a14">MODE_FINANCIAL_REPORT</a>);
01090         <span class="keywordflow">return</span> 1;
01091     }
01092 
01093     <span class="keywordflow">if</span> (mouse.single_click(<a class="code" href="Osysdet_8cpp.html#a38a26">REPORT_BUTTON_SCORE_X1</a>, <a class="code" href="Osysdet_8cpp.html#a38a27">REPORT_BUTTON_SCORE_Y1</a>, <a class="code" href="Osysdet_8cpp.html#a38a28">REPORT_BUTTON_SCORE_X2</a>, <a class="code" href="Osysdet_8cpp.html#a38a29">REPORT_BUTTON_SCORE_Y2</a>)) {
01094         set_view_mode(<a class="code" href="Osys_8h.html#a45a15">MODE_SCORE_REPORT</a>);
01095         <span class="keywordflow">return</span> 1;
01096     }
01097 
01098     <span class="keywordflow">if</span> (mouse.single_click(<a class="code" href="Osysdet_8cpp.html#a38a30">MORE_REPORT_BUTTON_X1</a>, <a class="code" href="Osysdet_8cpp.html#a38a31">MORE_REPORT_BUTTON_Y1</a>, <a class="code" href="Osysdet_8cpp.html#a38a32">MORE_REPORT_BUTTON_X2</a>, <a class="code" href="Osysdet_8cpp.html#a38a33">MORE_REPORT_BUTTON_Y2</a>)) {
01099         audio.play_wav(<span class="stringliteral">"STONES"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
01100 
01101         <span class="keywordflow">if</span>(view_mode!=<a class="code" href="Osys_8h.html#a45a19">MODE_MORE_REPORT</a>) {
01102             <span class="keywordflow">if</span>(view_mode!=<a class="code" href="Osys_8h.html#a45a20">MODE_DEPT_LIST</a> &amp;&amp; view_mode!=<a class="code" href="Osys_8h.html#a45a19">MODE_MORE_REPORT</a>
01103                &amp;&amp; view_mode!=<a class="code" href="Osys_8h.html#a45a30">MODE_HELP_TOPIC</a>)
01104                 report_before_morerpt_or_deptlist=view_mode;
01105             <span class="keywordflow">else</span>
01106                 report_before_morerpt_or_deptlist=<a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>;
01107 
01108             set_view_mode(<a class="code" href="Osys_8h.html#a45a19">MODE_MORE_REPORT</a>);
01109         }
01110         <span class="keywordflow">else</span>
01111             set_view_mode(report_before_morerpt_or_deptlist);
01112         <span class="keywordflow">return</span> 1;
01113     }
01114 
01115     help.set_help(<a class="code" href="Oinfo_8h.html#a110a54">HELP_QUEST_X1</a>,<a class="code" href="Oinfo_8h.html#a110a55">HELP_QUEST_Y1</a>,<a class="code" href="Oinfo_8h.html#a110a56">HELP_QUEST_X2</a>,<a class="code" href="Oinfo_8h.html#a110a57">HELP_QUEST_Y2</a>,<span class="stringliteral">"U13."</span>);
01116     <span class="keywordflow">if</span> (mouse.single_click(<a class="code" href="Oinfo_8h.html#a110a54">HELP_QUEST_X1</a>, <a class="code" href="Oinfo_8h.html#a110a55">HELP_QUEST_Y1</a>, <a class="code" href="Oinfo_8h.html#a110a56">HELP_QUEST_X2</a>, <a class="code" href="Oinfo_8h.html#a110a57">HELP_QUEST_Y2</a>)) {
01117         audio.play_wav(<span class="stringliteral">"STONES"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
01118 
01119         <span class="keywordflow">if</span>(view_mode!=<a class="code" href="Osys_8h.html#a45a30">MODE_HELP_TOPIC</a>) {
01120             <span class="keywordflow">if</span>(view_mode!=<a class="code" href="Osys_8h.html#a45a20">MODE_DEPT_LIST</a> &amp;&amp; view_mode!=<a class="code" href="Osys_8h.html#a45a19">MODE_MORE_REPORT</a>
01121                &amp;&amp; view_mode!=<a class="code" href="Osys_8h.html#a45a30">MODE_HELP_TOPIC</a>)
01122                 report_before_morerpt_or_deptlist=view_mode;
01123             <span class="keywordflow">else</span>
01124                 report_before_morerpt_or_deptlist=<a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>;
01125 
01126             set_view_mode(<a class="code" href="Osys_8h.html#a45a30">MODE_HELP_TOPIC</a>);
01127         }
01128         <span class="keywordflow">else</span>
01129             set_view_mode(report_before_morerpt_or_deptlist);
01130         <span class="keywordflow">return</span> 1;
01131     }
01132 
01133     <span class="keywordflow">return</span> 0;
01134 }
01135 
01136 <span class="comment">//--------- End of function Sys::detect_report_button ----------//</span>
01137 
01138 <span class="comment">//-------- Begin of function Sys::detect_dept_button ---------//</span>
01142 <span class="comment">int Sys::detect_dept_button() {</span>
01143     <span class="comment">// detect list button</span>
01144     <span class="comment">//### begin zb 02/28/99</span>
01145     <span class="keywordflow">if</span>(is_institution_report==0&amp;&amp;mouse.single_click(<a class="code" href="Oinfo_8h.html#a111a58">LIST_BUTTON_X1</a>, <a class="code" href="Oinfo_8h.html#a111a59">LIST_BUTTON_Y1</a>, <a class="code" href="Oinfo_8h.html#a111a60">LIST_BUTTON_X2</a>, <a class="code" href="Oinfo_8h.html#a111a61">LIST_BUTTON_Y2</a>, <a class="code" href="Omouse_8h.html#a28a22">LEFT_BUTTON</a>)
01146        <span class="comment">//### end zb 02/28/99</span>
01147        <span class="comment">//               ||      mouse.single_click(TOP_INFO_X1,TOP_INFO_Y1,TOP_INFO_X2,TOP_INFO_Y2, LEFT_BUTTON)</span>
01148         ) {
01149         image_interface.put_back( <a class="code" href="Oinfo_8h.html#a111a58">LIST_BUTTON_X1</a>, <a class="code" href="Oinfo_8h.html#a111a59">LIST_BUTTON_Y1</a>,<span class="stringliteral">"LIST_DN"</span> );
01150         vga.blt_buf(<a class="code" href="Oinfo_8h.html#a111a58">LIST_BUTTON_X1</a>, <a class="code" href="Oinfo_8h.html#a111a59">LIST_BUTTON_Y1</a>, <a class="code" href="Oinfo_8h.html#a111a60">LIST_BUTTON_X2</a>, <a class="code" href="Oinfo_8h.html#a111a61">LIST_BUTTON_Y2</a>, 1);
01151 
01152         <span class="keywordflow">if</span>(view_mode!=<a class="code" href="Osys_8h.html#a45a20">MODE_DEPT_LIST</a>) {
01153             <span class="keywordflow">if</span>(view_mode!=<a class="code" href="Osys_8h.html#a45a20">MODE_DEPT_LIST</a> &amp;&amp; view_mode!=<a class="code" href="Osys_8h.html#a45a19">MODE_MORE_REPORT</a>
01154                &amp;&amp; view_mode!=<a class="code" href="Osys_8h.html#a45a30">MODE_HELP_TOPIC</a>)
01155                 report_before_morerpt_or_deptlist=view_mode;
01156             <span class="keywordflow">else</span>
01157                 report_before_morerpt_or_deptlist=<a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>;
01158             set_view_mode(<a class="code" href="Osys_8h.html#a45a20">MODE_DEPT_LIST</a>);
01159             faculty_res.report_faculty_recno=1;
01160         }
01161         <span class="keywordflow">else</span>
01162             set_view_mode(report_before_morerpt_or_deptlist);
01163     }
01164 
01165     <span class="keywordtype">char</span>* bmpName;
01166     <span class="keywordtype">int</span> skipDir;
01167 
01168     <span class="keywordflow">if</span>(is_institution_report==0) {
01169         <span class="keywordflow">if</span>( mouse.single_click(557, 31, 581, 44, <a class="code" href="Omouse_8h.html#a28a22">LEFT_BUTTON</a>) ) {
01170             bmpName = <span class="stringliteral">"UPARROW"</span>;
01171             skipDir = -1;
01172             redraw_all_flag=1;
01173             audio.play_wav(<span class="stringliteral">"BEEPS-1"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
01174             faculty_res.report_faculty_recno=1;
01175         }
01176         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( mouse.single_click(590, 31, 614, 44, <a class="code" href="Omouse_8h.html#a28a22">LEFT_BUTTON</a>) ) {
01177             bmpName = <span class="stringliteral">"DWARROW"</span>;
01178             skipDir = 1;
01179             redraw_all_flag=1;
01180             audio.play_wav(<span class="stringliteral">"BEEPS-1"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
01181             faculty_res.report_faculty_recno=1;
01182         }
01183         <span class="keywordflow">else</span>
01184             <span class="keywordflow">return</span> 0;
01185 
01186         vga_front.save_area_common_buf( 555, 31, 616, 49 );
01187         <span class="comment">// ## chw1014</span>
01188 
01189         mouse.hide_area( 555, 31, 616, 49 );          <span class="comment">// ## chw1014</span>
01190 
01191         image_interface.put_back( 555, 31, bmpName );
01192 
01193         mouse.show_area();                            <span class="comment">// ## chw1014</span>
01194         vga.blt_buf( 555, 31, 616, 49 , 1);           <span class="comment">// ## chw1014</span>
01195 
01196         <span class="comment">//---------- move forward or backward ----------//</span>
01197 
01198         <span class="keywordtype">int</span> loopCount=0;
01199 
01200         <span class="keywordflow">while</span>(1) {
01201             ++loopCount;
01202             <a class="code" href="ALL_8H.html#a0">err_when</a>( loopCount &gt; 1000 );
01203 
01204             department_array.selected_recno += skipDir;
01205 
01206             <span class="keywordflow">if</span>( department_array.selected_recno &lt; 1 )
01207                 department_array.selected_recno = department_array.size();
01208 
01209             <span class="keywordflow">else</span> <span class="keywordflow">if</span>( department_array.selected_recno &gt; department_array.size() )
01210                 department_array.selected_recno = 1;
01211 
01212             <span class="comment">// if this record exists, we're done with it</span>
01213             <span class="keywordflow">if</span>( !department_array.is_deleted(department_array.selected_recno) )
01214                 <span class="keywordflow">break</span>;
01215         }
01216 
01217         <span class="comment">//------- wait until the user releases the button -------//</span>
01218 
01219         <span class="keywordflow">while</span>( mouse.left_press ) {
01220             yield();
01221             mouse.get_event();
01222         }
01223 
01224         mouse.hide_area( 555, 31, 616, 49 );          <span class="comment">// ## chw1014</span>
01225         vga_back.rest_area_common_buf();              <span class="comment">// ## chw1014</span>
01226         mouse.show_area();                            <span class="comment">// ## chw1014</span>
01227         vga.blt_buf( 555, 31, 616, 49 , 1);           <span class="comment">// ## chw1014</span>
01228     }
01229     <span class="keywordflow">else</span> {
01230         <span class="keywordflow">if</span>( mouse.single_click(557, 31, 581, 44, <a class="code" href="Omouse_8h.html#a28a22">LEFT_BUTTON</a>) ) {
01231             audio.play_wav(<span class="stringliteral">"BEEPS-N1"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
01232         }
01233         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( mouse.single_click(590, 31, 614, 44, <a class="code" href="Omouse_8h.html#a28a22">LEFT_BUTTON</a>) ) {
01234             audio.play_wav(<span class="stringliteral">"BEEPS-N1"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
01235         }
01236     }
01237 
01238     <span class="keywordflow">return</span> 0;
01239 }
01240 
01241 <span class="comment">//--------- End of function Sys::detect_dept_button ----------//</span>
01242 
01243 <span class="comment">//-------- Begin of function Sys::detect_mail_button ---------//</span>
01245 <span class="comment">int Sys::detect_mail_button() {</span>
01246     <span class="comment">//  if(!(print_menu.print_view_mode==MODE_SCENARIO_LETTER))</span>
01247     <span class="keywordflow">if</span>(!(player_school.scenario_id&gt;0 &amp;&amp; (view_mode==<a class="code" href="Osys_8h.html#a45a21">MODE_SCENARIO_LETTER</a>)))
01248         <span class="keywordflow">if</span>(view_mode!=<a class="code" href="Osys_8h.html#a45a27">MODE_PRINTING_MENU</a>)
01249             <span class="keywordflow">if</span>( mouse.single_click( 8, 562, 74, 599 )
01250                 ||
01251                 (m.upper(mouse.is_key(mouse.scan_code, mouse.event_skey_state, (<a class="code" href="OCOLTBL_8H.html#a2">WORD</a>) 0, <a class="code" href="OMOUSE2_8H.html#a15a14">K_UNIQUE_KEY</a>))==<span class="charliteral">'W'</span>)) {
01252                 <span class="keywordtype">int</span> mail_state=0;
01253                 <span class="keywordflow">if</span>(player_school.scenario_id&lt;=0) {
01254                     <span class="keywordflow">if</span>( (view_mode!=<a class="code" href="Osys_8h.html#a45a33">MODE_WELCOME_LETTER</a>)
01255                         &amp;&amp;  (view_mode!=<a class="code" href="Osys_8h.html#a45a34">MODE_EVALUATION_LETTER</a>)
01256 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
01257 <span class="preprocessor"></span>                        &amp;&amp; (view_mode!=MODE_STATE_REPORT)
01258 <span class="preprocessor">#endif</span>
01259 <span class="preprocessor"></span>                        ) {
01260                         <span class="keywordflow">if</span>(info.year_passed&lt;=1)
01261                             set_staying_view_mode(<a class="code" href="Osys_8h.html#a45a33">MODE_WELCOME_LETTER</a>);
01262                         <span class="keywordflow">else</span>
01263                             set_staying_view_mode(<a class="code" href="Osys_8h.html#a45a34">MODE_EVALUATION_LETTER</a>);
01264                         mail_state=1;
01265                     }
01266                     <span class="keywordflow">else</span> {
01267                         <span class="keywordflow">if</span>(save_view_mode!=<a class="code" href="Osys_8h.html#a45a18">MODE_YEAR_END_REPORT</a>) {
01268                             set_staying_view_mode(0);
01269                             <span class="comment">//                                          set_view_mode(MODE_NORMAL);</span>
01270                             set_view_mode(sys.save_view_mode);
01271                         }
01272                     }
01273                 }
01274                 <span class="keywordflow">else</span> {
01275                     <span class="keywordflow">if</span>( (view_mode!=<a class="code" href="Osys_8h.html#a45a33">MODE_WELCOME_LETTER</a>)
01276                         &amp;&amp;  (view_mode!=<a class="code" href="Osys_8h.html#a45a34">MODE_EVALUATION_LETTER</a>)
01277                         &amp;&amp;  (view_mode!=<a class="code" href="Osys_8h.html#a45a32">MODE_SCEN_WELCOME_LETTER</a>)
01278                         &amp;&amp;  (view_mode!=<a class="code" href="Osys_8h.html#a45a21">MODE_SCENARIO_LETTER</a>)
01279 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
01280 <span class="preprocessor"></span>                        &amp;&amp; (view_mode!=MODE_STATE_REPORT)
01281 <span class="preprocessor">#endif</span>
01282 <span class="preprocessor"></span>                        ) {
01283                         set_staying_view_mode(<a class="code" href="Osys_8h.html#a45a21">MODE_SCENARIO_LETTER</a>);
01284                     }
01285                     <span class="keywordflow">else</span> {
01286                         <span class="keywordflow">if</span>(save_view_mode!=<a class="code" href="Osys_8h.html#a45a18">MODE_YEAR_END_REPORT</a>)
01287                             set_staying_view_mode(0);
01288                     }
01289                 }
01290                 mouse.hide_area( 8, 562, 74, 599 );           <span class="comment">// ## chw1014</span>
01291                 <span class="keywordflow">if</span>((view_mode!=<a class="code" href="Osys_8h.html#a45a28">MODE_PAUSE</a>)
01292                    &amp;&amp;(view_mode!=<a class="code" href="Osys_8h.html#a45a17">MODE_GAME_OPTIONS</a>)
01293                    &amp;&amp;(view_mode!=<a class="code" href="Osys_8h.html#a45a18">MODE_YEAR_END_REPORT</a>)) {
01294                     image_interface.put_back( 8, 562, mail_state==1 ? <span class="stringliteral">"MAIL-DN"</span> : <span class="stringliteral">"MAIL-UP"</span> );
01295                 }
01296                 <span class="keywordflow">else</span> {
01297                     image_interface.put_back( 8, 562, <span class="stringliteral">"MAIL-UP"</span> );
01298                     user_interface.darken(8, 562, 74, 599);
01299                 }
01300                 mouse.show_area();
01301                 vga.blt_buf(8, 562, 74, 599 ,1);
01302                 <span class="keywordflow">return</span> 1;
01303             }
01304 
01305     <span class="comment">//------ detect Print button -----------//</span>
01306     <span class="keywordflow">if</span>((view_mode!=<a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>)
01307        &amp;&amp; (view_mode!=<a class="code" href="Osys_8h.html#a45a31">MODE_HELP_DESC</a>)
01308        &amp;&amp; (view_mode!=<a class="code" href="Osys_8h.html#a45a30">MODE_HELP_TOPIC</a>)
01309        &amp;&amp; (view_mode!=<a class="code" href="Osys_8h.html#a45a27">MODE_PRINTING_MENU</a>)
01310        &amp;&amp; (view_mode!=<a class="code" href="Osys_8h.html#a45a19">MODE_MORE_REPORT</a>)
01311        &amp;&amp; (view_mode!=<a class="code" href="Osys_8h.html#a45a20">MODE_DEPT_LIST</a>)
01312        &amp;&amp; (view_mode!=<a class="code" href="Osys_8h.html#a45a28">MODE_PAUSE</a>)
01313        &amp;&amp; (view_mode!=<a class="code" href="Osys_8h.html#a45a17">MODE_GAME_OPTIONS</a>)
01314        &amp;&amp; (view_mode!=<a class="code" href="Osys_8h.html#a45a18">MODE_YEAR_END_REPORT</a>)) {
01315         image_interface.put_back( 180, 564, <span class="stringliteral">"PRINT-UP"</span> );
01316     }
01317     <span class="keywordflow">else</span> {
01318         image_interface.put_back( 180, 564, <span class="stringliteral">"PRINT-DN"</span> );
01319         user_interface.darken(180, 564, 180+26, 564+28);
01320     }
01321 
01322     <span class="keywordflow">if</span>(view_mode!=<a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>)
01323         <span class="keywordflow">if</span>(view_mode!=<a class="code" href="Osys_8h.html#a45a19">MODE_MORE_REPORT</a>)
01324             <span class="keywordflow">if</span>(view_mode!=<a class="code" href="Osys_8h.html#a45a20">MODE_DEPT_LIST</a>)
01325                 <span class="keywordflow">if</span>(view_mode!=<a class="code" href="Osys_8h.html#a45a26">MODE_AWARD_REPORT</a>)
01326                     <span class="keywordflow">if</span>(view_mode!=<a class="code" href="Osys_8h.html#a45a17">MODE_GAME_OPTIONS</a>)
01327                         <span class="keywordflow">if</span>( mouse.press_area( 180, 564, 210, 594 )||
01328                             (m.upper(mouse.is_key(mouse.scan_code, mouse.event_skey_state, (<a class="code" href="OCOLTBL_8H.html#a2">WORD</a>) 0, <a class="code" href="OMOUSE2_8H.html#a15a14">K_UNIQUE_KEY</a>))==<a class="code" href="KEY_8H.html#a23">KEY_F8</a>)) {
01329                             <span class="keywordflow">if</span>(view_mode!=<a class="code" href="Osys_8h.html#a45a27">MODE_PRINTING_MENU</a>) {
01330                                 image_interface.put_front( 180, 564, <span class="stringliteral">"PRINT-DN"</span> );
01331 
01332                                 <span class="keywordflow">while</span>( mouse.left_press ) {
01333                                     yield();
01334                                     mouse.get_event();
01335                                 }
01336 
01337                                 image_interface.put_back( 180, 564, <span class="stringliteral">"PRINT-UP"</span> );
01338 
01339                                 print_menu.print_view_mode=view_mode;
01340                                 <span class="comment">/*</span>
01341 <span class="comment">                                  if(   (view_mode==MODE_WELCOME_LETTER)</span>
01342 <span class="comment">                                  ||    (view_mode==MODE_EVALUATION_LETTER)</span>
01343 <span class="comment">                                  ||    (view_mode==MODE_SCEN_WELCOME_LETTER)</span>
01344 <span class="comment">                                  ||    (view_mode==MODE_SCENARIO_LETTER))</span>
01345 <span class="comment">                                  {</span>
01346 <span class="comment"></span>
01347 <span class="comment">                                  set_staying_view_mode(0);</span>
01348 <span class="comment">                                  sys.view_mode=MODE_NORMAL;</span>
01349 <span class="comment">                                  }</span>
01350 <span class="comment">                                */</span>
01351                                 set_staying_view_mode(<a class="code" href="Osys_8h.html#a45a27">MODE_PRINTING_MENU</a>);
01352 
01353                                 <span class="keywordflow">return</span> 1;
01354                             }
01355                             <span class="keywordflow">else</span> {
01356                                 set_staying_view_mode(0);
01357                                 set_view_mode(print_menu.print_view_mode);
01358                                 <span class="comment">/*</span>
01359 <span class="comment">                                  if(   (print_menu.print_view_mode==MODE_WELCOME_LETTER)</span>
01360 <span class="comment">                                  ||    (print_menu.print_view_mode==MODE_EVALUATION_LETTER)</span>
01361 <span class="comment">                                  ||    (print_menu.print_view_mode==MODE_SCEN_WELCOME_LETTER)</span>
01362 <span class="comment">                                  ||    (print_menu.print_view_mode==MODE_SCENARIO_LETTER))</span>
01363 <span class="comment">                                  {</span>
01364 <span class="comment">                                  sys.save_view_mode=MODE_NORMAL;</span>
01365 <span class="comment">                                  }</span>
01366 <span class="comment">                                */</span>
01367                             }
01368                         }
01369 
01370     vga.blt_buf(180, 564, 180+26, 564+28);
01371 
01372     <span class="keywordflow">return</span> 0;
01373 }
01374 
01375 <span class="comment">//--------- End of function Sys::detect_mail_button ----------//</span>
01376 
01377 <span class="comment">//-------- Begin of function Sys::detect_function_button ---------//</span>
01379 <span class="comment">int Sys::detect_function_button() {</span>
01380     <span class="keywordtype">int</span> result=0;
01381     <span class="comment">//-------- detect Zoom button ---------//</span>
01382     <span class="keyword">static</span> <span class="keywordtype">int</span> zoom_display_updated=1;
01383 
01384     <span class="keywordflow">if</span>( mouse.single_click( 178, 515, 208, 541 ) || zoom_display_updated==1) {
01385         audio.play_wav(<span class="stringliteral">"ZOOM"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
01386         <span class="keywordflow">if</span>(zoom_display_updated==0) {
01387             world.set_zoom_level( world.zoom_level==1 ? 2 : 1 );
01388             result=1;
01389         }
01390         mouse.hide_area( 178, 515, 208, 541 );        <span class="comment">// ## chw1014</span>
01391         image_interface.put_back( 178, 515, world.zoom_level==1 ? <span class="stringliteral">"MAG-UP"</span> : <span class="stringliteral">"MAG-DN"</span> );
01392         mouse.show_area();
01393         vga.blt_buf( 178, 515, 208, 541 ,1);
01394         zoom_display_updated=0;
01395     }
01396 
01397     <span class="comment">//-------- detect Max-Min button ---------//</span>
01398     <span class="keywordflow">if</span>(view_mode==<a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>) {
01399         <span class="keywordflow">if</span>( mouse.single_click( <a class="code" href="Oinfo_8h.html#a113a86">MIN_MAX_X1</a>, <a class="code" href="Oinfo_8h.html#a113a87">MIN_MAX_Y1</a>, <a class="code" href="Oinfo_8h.html#a113a88">MIN_MAX_X2</a>, <a class="code" href="Oinfo_8h.html#a113a89">MIN_MAX_Y2</a> ) ) {
01400             info.disp_6_graphs_flag = !info.disp_6_graphs_flag;
01401             redraw_all_flag=1;
01402         }
01403     }
01404 
01405     <span class="comment">//-------- detect M-O log button ---------//</span>
01406     <span class="comment">// 32 x 81</span>
01407     <span class="comment">// Change the state of M-O-log buttons</span>
01408     <span class="keywordflow">if</span>(mouse.in_area(223, 516+m_o_log_bitmap_y[0], 253, 516+m_o_log_bitmap_y[3])) {
01409         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;3;i++) {
01410             <span class="keywordflow">if</span>( mouse.in_area(223, 516+m_o_log_bitmap_y[i], 253, 516+m_o_log_bitmap_y[i+1])) {
01411                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;3;j++) {
01412                     <span class="keywordflow">if</span>(m_o_log_state[j]==1)
01413                         m_o_log_state[j]=0;
01414 
01415                     <span class="keywordflow">if</span>(m_o_log_state[i]==0) {               <span class="comment">// highlight the button if it is not selected</span>
01416                         m_o_log_state[i]=1;
01417                         m_o_log_highlighted=i;
01418                     }
01419 
01420                     <span class="keywordflow">if</span>(m_o_log_state[i]==2)
01421                         m_o_log_highlighted=-1;
01422                 }
01423 
01424                 <span class="keywordflow">if</span>( mouse.single_click(223, 516+m_o_log_bitmap_y[i], 253, 516+m_o_log_bitmap_y[i+1])) {
01425                     audio.play_wav(<span class="stringliteral">"NEWS"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
01426 
01427                     <span class="keywordflow">if</span>( i != 2 ) {                          <span class="comment">// if click on Log, don't highlight it, as it just brings up the log report</span>
01428                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;3;j++)
01429                             m_o_log_state[j]=0;
01430                         m_o_log_highlighted=-1;
01431                         m_o_log_state[i]=2;
01432                         m_o_log_selected=i;
01433                     }
01434 
01435                     <span class="keywordflow">if</span>(i==2) {
01436                         <span class="keywordflow">if</span>(view_mode!=<a class="code" href="Osys_8h.html#a45a35">MODE_BLACKBOARD_LOG</a>)
01437                             back_view_mode=view_mode;
01438                         set_view_mode(<a class="code" href="Osys_8h.html#a45a35">MODE_BLACKBOARD_LOG</a>);
01439                     }
01440                     <span class="keywordflow">else</span> {
01441                         <span class="keywordflow">if</span>(view_mode==<a class="code" href="Osys_8h.html#a45a35">MODE_BLACKBOARD_LOG</a>)
01442                             set_view_mode(back_view_mode);
01443                     }
01444                     <span class="keywordflow">break</span>;
01445                     result=1;
01446                 }
01447             }
01448         }
01449     }
01450     <span class="keywordflow">else</span> {
01451         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;3;j++)
01452             <span class="comment">//                  if(m_o_log_state[j]!=2)</span>
01453             m_o_log_state[j]=0;
01454         m_o_log_state[m_o_log_selected]=2;
01455         m_o_log_highlighted=-1;
01456     }
01457 
01458     <span class="comment">// Check if the M_O_button need to refresh?</span>
01459     <span class="keywordflow">if</span>(m_o_log_old_selected!=m_o_log_selected||
01460        m_o_log_old_highlighted!=m_o_log_highlighted)
01461         m_o_log_display_updated=1;
01462 
01463     <span class="keywordflow">if</span>(m_o_log_display_updated) {
01464         <span class="comment">//              mouse.hide_area(223, 516+m_o_log_bitmap_y[0], 253, 516+m_o_log_bitmap_y[3]);</span>
01465         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;3;i++) {
01466             <span class="keywordflow">if</span>(m_o_log_state[i]==0)
01467                 vga_back.put_bitmap_area(223, 516,
01468                                          image_interface.get_ptr(<span class="stringliteral">"MO_LOG1"</span>),
01469                                          0,  m_o_log_bitmap_y[i],
01470                                          31,m_o_log_bitmap_y[i+1]);
01471 
01472             <span class="keywordflow">if</span>(m_o_log_state[i]==1) {
01473                 vga_back.put_bitmap_area(223, 516,        <span class="comment">//highlighted</span>
01474                                          image_interface.get_ptr(<span class="stringliteral">"MO_LOG2"</span>),
01475                                          0,  m_o_log_bitmap_y[i],
01476                                          31,m_o_log_bitmap_y[i+1]);
01477             }
01478 
01479             <span class="keywordflow">if</span>(m_o_log_state[i]==2) {                   <span class="comment">//selected</span>
01480                 vga_back.put_bitmap_area(223, 516,
01481                                          image_interface.get_ptr(<span class="stringliteral">"MO_LOG3"</span>),
01482                                          0,  m_o_log_bitmap_y[i],
01483                                          31,m_o_log_bitmap_y[i+1]);
01484             }
01485         }
01486         <span class="comment">//              mouse.show_area();</span>
01487         vga.blt_buf(223, 516+m_o_log_bitmap_y[0], 253, 516+m_o_log_bitmap_y[3],1);
01488         m_o_log_old_selected=m_o_log_selected;
01489         m_o_log_old_highlighted=m_o_log_highlighted;
01490         m_o_log_display_updated=0;
01491     }
01492 
01493     <span class="comment">// ## begin chwg 050299</span>
01494     <span class="keywordflow">if</span>(staying_view_mode==0) {
01495         <span class="keywordflow">if</span> (m_o_log_selected==0)
01496             blackboard.black_message_report(redraw_all_flag);
01497 
01498         <span class="keywordflow">if</span> (m_o_log_selected==1)
01499             blackboard.black_objective_report(redraw_all_flag);
01500 
01501         <span class="keywordflow">if</span> (m_o_log_selected==2)
01502             <span class="keywordflow">if</span>(blackboard.log_mode==<a class="code" href="OBLCKBRD_8H.html#a3a1">NEWS_MODE</a>)
01503                 blackboard.black_message_report(redraw_all_flag);
01504             <span class="keywordflow">else</span>
01505                 blackboard.black_objective_report(redraw_all_flag);
01506     }
01507     <span class="comment">// ## end chwg 050299</span>
01508 
01509     <span class="comment">// detect speed indicator</span>
01510     <span class="keyword">static</span> <span class="keywordtype">int</span> showX=0;
01511     <span class="keywordflow">if</span>( mouse.press_area( 112, 538, 110+67, 538+31 ) ) {
01512         <span class="comment">// Indictor range for detection 2 to 65</span>
01513         <span class="comment">// convert 0 to 67 -&gt; 0 to 10</span>
01514         <span class="keywordtype">float</span> speedLevel =float(mouse.cur_x-112+5)/6.7f;
01515 
01516         <span class="keywordflow">if</span>( speedLevel &gt;= 9.5 )
01517             set_speed(99);
01518         <span class="keywordflow">else</span>
01519             set_speed( speedLevel * 10 );
01520 
01521         <span class="comment">// ## begin zb 02/21/99</span>
01522         sys.save_speed=config.frame_speed;
01523         <span class="comment">// ## end zb 02/21/99</span>
01524 
01525         result=1;
01526     }
01527 
01528     <span class="comment">//------ detect Print button -----------//</span>
01529 
01530     <span class="keywordflow">if</span>(view_mode!=<a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>)
01531         <span class="keywordflow">if</span>(mouse.press_area( 180, 564, 210, 594 )
01532            ||(m.upper(mouse.is_key(mouse.scan_code, mouse.event_skey_state, (<a class="code" href="OCOLTBL_8H.html#a2">WORD</a>) 0, <a class="code" href="OMOUSE2_8H.html#a15a14">K_UNIQUE_KEY</a>))==<a class="code" href="KEY_8H.html#a23">KEY_F8</a>)) {
01533             <span class="keywordflow">if</span>(view_mode!=<a class="code" href="Osys_8h.html#a45a27">MODE_PRINTING_MENU</a>) {
01534                 image_interface.put_front( 180, 564, <span class="stringliteral">"PRINT-DN"</span> );
01535 
01536                 <span class="keywordflow">while</span>( mouse.left_press ) {
01537                     yield();
01538                     mouse.get_event();
01539                 }
01540 
01541                 image_interface.put_back( 180, 564, <span class="stringliteral">"PRINT-UP"</span> );
01542                 vga.blt_buf(180, 564, 180+26, 564+28);
01543 
01544                 print_menu.print_view_mode=view_mode;
01545                 <span class="comment">/*</span>
01546 <span class="comment">                  if(   (view_mode==MODE_WELCOME_LETTER)</span>
01547 <span class="comment">                  ||    (view_mode==MODE_EVALUATION_LETTER)</span>
01548 <span class="comment">                  ||    (view_mode==MODE_SCEN_WELCOME_LETTER)</span>
01549 <span class="comment">                  ||    (view_mode==MODE_SCENARIO_LETTER))</span>
01550 <span class="comment">                  {</span>
01551 <span class="comment">                  set_staying_view_mode(0);</span>
01552 <span class="comment">                  sys.view_mode=MODE_NORMAL;</span>
01553 <span class="comment">                  }</span>
01554 <span class="comment">                */</span>
01555                 set_staying_view_mode(<a class="code" href="Osys_8h.html#a45a27">MODE_PRINTING_MENU</a>);
01556 
01557                 <span class="keywordflow">return</span> 1;
01558             }
01559             <span class="keywordflow">else</span> {
01560                 set_staying_view_mode(0);
01561                 set_view_mode(print_menu.print_view_mode);
01562                 <span class="comment">/*</span>
01563 <span class="comment">                  if(   (print_menu.print_view_mode==MODE_WELCOME_LETTER)</span>
01564 <span class="comment">                  ||    (print_menu.print_view_mode==MODE_EVALUATION_LETTER)</span>
01565 <span class="comment">                  ||    (print_menu.print_view_mode==MODE_SCEN_WELCOME_LETTER)</span>
01566 <span class="comment">                  ||    (print_menu.print_view_mode==MODE_SCENARIO_LETTER))</span>
01567 <span class="comment">                  {</span>
01568 <span class="comment">                  sys.save_view_mode=MODE_NORMAL;</span>
01569 <span class="comment">                  }</span>
01570 <span class="comment">                */</span>
01571             }
01572         }
01573 
01574     <span class="comment">/*</span>
01575 <span class="comment">      //------ detect Print button -----------//</span>
01576 <span class="comment"></span>
01577 <span class="comment">      if( mouse.press_area( 180, 564, 210, 594 ) )</span>
01578 <span class="comment">      {</span>
01579 <span class="comment">      if(view_mode!=MODE_PRINTING_MENU)</span>
01580 <span class="comment">      {</span>
01581 <span class="comment">      image_interface.put_front( 180, 564, "PRINT-DN" );</span>
01582 <span class="comment"></span>
01583 <span class="comment">      while( mouse.left_press )</span>
01584 <span class="comment">      {</span>
01585 <span class="comment">      yield();</span>
01586 <span class="comment">      mouse.get_event();</span>
01587 <span class="comment">      }</span>
01588 <span class="comment"></span>
01589 <span class="comment">      image_interface.put_back( 180, 564, "PRINT-UP" );</span>
01590 <span class="comment">      vga.blt_buf(180, 564, 210, 594);</span>
01591 <span class="comment"></span>
01592 <span class="comment">      print_menu.print_view_mode=view_mode;</span>
01593 <span class="comment">      set_staying_view_mode(MODE_PRINTING_MENU);</span>
01594 <span class="comment"></span>
01595 <span class="comment">      return 1;</span>
01596 <span class="comment">      }</span>
01597 <span class="comment">      else</span>
01598 <span class="comment">      {</span>
01599 <span class="comment">      set_staying_view_mode(0);</span>
01600 <span class="comment">      set_view_mode(print_menu.print_view_mode);</span>
01601 <span class="comment">      }</span>
01602 <span class="comment">      }</span>
01603 <span class="comment">    */</span>
01604     <span class="keywordflow">return</span> 0;
01605 }
01606 
01607 <span class="comment">//--------- End of function Sys::detect_function_button ----------//</span>
01608 
01609 <span class="comment">//-------- Begin of function Sys::detect_main_screen_help --------//</span>
01611 <span class="comment">void Sys::detect_main_screen_help() {</span>
01612     <span class="comment">//------ report buttons --------//</span>
01613 
01614     help.set_help2( 6  , 2, 50, 30, <span class="stringliteral">"H9.18.1."</span> );
01615     help.set_help2( 56 , 2, 46, 30, <span class="stringliteral">"H9.19.1."</span> );
01616     help.set_help2( 102, 2, 54, 30, <span class="stringliteral">"H9.20.1."</span> );
01617     help.set_help2( 156, 2, 51, 30, <span class="stringliteral">"H9.21.1."</span> );
01618     help.set_help2( 207, 2, 70, 30, <span class="stringliteral">"H9.22.1."</span> );
01619     help.set_help2( 277, 2, 47, 30, <span class="stringliteral">"H9.23.1."</span> );
01620     help.set_help2( 324, 2, 39, 30, <span class="stringliteral">"H9.24.1."</span> );
01621 
01622     help.set_help2( 369,1,145,29, <span class="stringliteral">"H9.12.1."</span> );     <span class="comment">// surplus</span>
01623     help.set_help2( 515,2, 48,28,  <span class="stringliteral">"H9.13.1."</span> );    <span class="comment">// trust evaluation score</span>
01624     help.set_help2( 579,1, 66,30,  <span class="stringliteral">"H9.14.1."</span> );    <span class="comment">// game score</span>
01625     help.set_help2( 661,2, 88,42,  <span class="stringliteral">"H9.15.1."</span> );    <span class="comment">// calender</span>
01626     help.set_help2( 758,32, 34,14, <span class="stringliteral">"H9.16.1."</span> );    <span class="comment">// ?</span>
01627     help.set_help2( 750,1, 49,30,  <span class="stringliteral">"H9.17.1."</span> );    <span class="comment">// menu</span>
01628     help.set_help2( 728,60, 21,16, <span class="stringliteral">"H9.25.1."</span> );    <span class="comment">// minimize</span>
01629 
01630     help.set_help2( 555,31, 65,15, <span class="stringliteral">"H9.10.1."</span> );    <span class="comment">// up/down arrows</span>
01631     help.set_help2( 625,30, 25,16, <span class="stringliteral">"H9.11.1."</span> );    <span class="comment">// double down</span>
01632     help.set_help2( 2,32, 153,14,  <span class="stringliteral">"H9.9.1."</span>  );    <span class="comment">// more report</span>
01633     help.set_help2( 634,515, 161,81, <span class="stringliteral">"H9.8.1."</span>);    <span class="comment">// mini map</span>
01634     help.set_help2( 224,518, 30,28, <span class="stringliteral">"H9.5.1."</span> );    <span class="comment">// 'M' button</span>
01635     help.set_help2( 225,547, 28,25, <span class="stringliteral">"H9.6.1."</span> );    <span class="comment">// 'O' button</span>
01636     help.set_help2( 225,575, 28,22, <span class="stringliteral">"H9.7.1."</span> );    <span class="comment">// log</span>
01637 
01638     <span class="keywordflow">if</span>( player_school.scenario_id &gt; 0 )
01639         help.set_help2( 5,563, 67,31,  <span class="stringliteral">"H9.4.3."</span> );   <span class="comment">// scenario report</span>
01640     <span class="keywordflow">else</span> {
01641         <span class="comment">// ### patch begin Gilbert 07/09/2001 #####//</span>
01642         <span class="comment">//int fiscalYear = info.game_year-1;</span>
01643         <span class="comment">//if( info.game_month &gt;= 9 )</span>
01644         <span class="comment">//      fiscalYear++;</span>
01645         <span class="keywordtype">int</span> fiscalYear = info.financial_year();
01646         <span class="comment">// ### patch end Gilbert 07/09/2001 #####//</span>
01647 
01648         <span class="keywordflow">if</span>( fiscalYear==1  )                          <span class="comment">// welcome report</span>
01649             help.set_help2( 5,563, 67,31,  <span class="stringliteral">"H9.4.1."</span> );
01650         <span class="keywordflow">else</span>                                          <span class="comment">// evaluation report</span>
01651             help.set_help2( 5,563, 67,31,  <span class="stringliteral">"H9.4.2."</span> );
01652     }
01653 
01654     help.set_help2( 108,539, 70,32, <span class="stringliteral">"H9.1.1."</span> );    <span class="comment">// speed</span>
01655     help.set_help2( 177,513, 34,33, <span class="stringliteral">"H9.3.1."</span> );    <span class="comment">// zoom</span>
01656 
01657     <span class="keywordflow">if</span>((view_mode!=<a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>)
01658        &amp;&amp;(view_mode!=<a class="code" href="Osys_8h.html#a45a31">MODE_HELP_DESC</a>)
01659        &amp;&amp;(view_mode!=<a class="code" href="Osys_8h.html#a45a30">MODE_HELP_TOPIC</a>)
01660        &amp;&amp;(view_mode!=<a class="code" href="Osys_8h.html#a45a19">MODE_MORE_REPORT</a>)
01661        &amp;&amp;(view_mode!=<a class="code" href="Osys_8h.html#a45a28">MODE_PAUSE</a>)
01662        &amp;&amp;(view_mode!=<a class="code" href="Osys_8h.html#a45a20">MODE_DEPT_LIST</a>)
01663        &amp;&amp;(view_mode!=<a class="code" href="Osys_8h.html#a45a17">MODE_GAME_OPTIONS</a>)
01664        &amp;&amp;(view_mode!=<a class="code" href="Osys_8h.html#a45a26">MODE_AWARD_REPORT</a>)
01665        &amp;&amp;(view_mode!=<a class="code" href="Osys_8h.html#a45a18">MODE_YEAR_END_REPORT</a>)) {
01666         help.set_help2( 177,564, 33,31, <span class="stringliteral">"H9.2.1."</span> );  <span class="comment">// print enabled</span>
01667     }
01668     <span class="keywordflow">else</span> {
01669         help.set_help2( 177,564, 33,31, <span class="stringliteral">"H9.2.2."</span> );  <span class="comment">// print disabled</span>
01670     }
01671 }
01672 
01673 <span class="comment">//--------- End of function Sys::detect_main_screen_help ---------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:29 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
