<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OLINALG.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>OLINALG.CPP</h1><a href="OLINALG_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OLinAlg.cpp</span>
00002 <span class="comment">//Description : LinAlg Class Definition:LinearAlgebra</span>
00003 <span class="comment">//Owner       : Fred</span>
00004 
00005 <span class="comment">// ES library header file</span>
00006 <span class="preprocessor">#include &lt;All.h&gt;</span>                                  <span class="comment">// err*</span>
00007 
00008 <span class="comment">// CU header file</span>
00009 
00010 <span class="preprocessor">#include "OLinAlg.h"</span>
00011 
00012 <span class="comment">//#define DEBUG_VC</span>
00013 
00014 <span class="preprocessor">#ifdef DEBUG_VC</span>
00015 <span class="preprocessor"></span><span class="preprocessor">#include &lt;STDIO.H&gt;</span>                                <span class="comment">//temp for debug matrix</span>
00016 <span class="preprocessor">#endif</span>
00017 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="OLOG_8H.html">OLOG.H</a>&gt;</span>                                 <span class="comment">// for debug matrix</span>
00018 
00019 <span class="preprocessor">#ifdef DEBUG_CONSOLE</span>
00020 <span class="preprocessor"></span><span class="preprocessor">#include &lt;STDIO.H&gt;</span>
00021 <span class="preprocessor">#define PRT_MAT (cout &lt;&lt;setw(10)&lt;&lt;setprecision(5))</span>
00022 <span class="preprocessor"></span><span class="preprocessor">#define PRT_MAT15 (cout &lt;&lt;setw(10)&lt;&lt;setprecision(15))</span>
00023 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00024"></a><a class="code" href="OLINALG_8CPP.html#a0">00024</a> <span class="preprocessor"></span><span class="preprocessor">#define PRT_MAT</span>
<a name="l00025"></a><a class="code" href="OLINALG_8CPP.html#a1">00025</a> <span class="preprocessor"></span><span class="preprocessor">#define PRT_MAT15</span>
00026 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00027 <span class="preprocessor"></span>
<a name="l00028"></a><a class="code" href="OLINALG_8CPP.html#a2">00028</a> <span class="preprocessor">#define fabs(x) ((x)&gt;0 ? (x):-(x))</span>
00029 <span class="preprocessor"></span>
00030 <span class="comment">//----------- Define constants -------------//</span>
00031 <span class="comment">//----------- Define static variables -------------//</span>
00032 <span class="comment">//----------- Define static functions -------------//</span>
00033 <span class="comment">//----------- Define static class member variables -------------//</span>
00034 
00035 <span class="comment">/*</span>
00036 <span class="comment">//----------- Begin of function LinAlg Constructor -----//</span>
00041 <span class="comment">LinearAlgebra::LinearAlgebra()</span>
00042 <span class="comment">{</span>
00043 <span class="comment"></span>
00044 <span class="comment">}</span>
00045 <span class="comment">//------------- End of function LinAlg Constructor -----//</span>
00046 <span class="comment"></span>
00047 <span class="comment">//----------- Begin of function LinAlg Destructor ------//</span>
00049 <span class="comment">LinearAlgebra::~LinearAlgebra()</span>
00050 <span class="comment">{</span>
00051 <span class="comment"></span>
00052 <span class="comment">}</span>
00053 <span class="comment">//------------- End of function LinAlg Destructor ------//</span>
00054 <span class="comment"></span>
00055 <span class="comment">//----------- Begin of function LinAlg::init --------//</span>
00057 <span class="comment">void LinearAlgebra::init()</span>
00058 <span class="comment">{</span>
00059 <span class="comment">}</span>
00060 <span class="comment">//------------- End of function LinAlg::init --------//</span>
00061 <span class="comment">*/</span>
00062 
00063 <span class="comment">//----------- Begin of function LinAlg::deinit --------//</span>
00065 <span class="comment">bool LinearAlgebra::quadratic_prog_not_converged(const Vector &amp;v_x, const Vector &amp;v_y, const Vector &amp;v_Road, const Vector &amp;v_Sigma, REAL gamma) {</span>
00066     <span class="comment">//const int MAX                     = 100000;</span>
00067     <span class="comment">//const     REAL EPSILON    = 1.0/(10000000000);            // 10^-10</span>
00068     <span class="keyword">const</span> <span class="keywordtype">int</span> MAX     = 1000000;
00069     <span class="keyword">const</span> <a class="code" href="OLINALG_8H.html#a0">REAL</a> EPSILON  = 1.0/(1000000);            <span class="comment">// 10^-10</span>
00070 
00071     <span class="keywordflow">if</span> ( v_x.MaximumValue() &gt; MAX ) {
00072 <span class="preprocessor">#ifdef DEBUG_CONSOLE</span>
00073 <span class="preprocessor"></span>        cout &lt;&lt; (<span class="stringliteral">"LinAlg: Problem is primal unbounded:"</span>);
00074 <span class="preprocessor">#endif</span>
00075 <span class="preprocessor"></span>
00076         <a class="code" href="ALL_8H.html#a1">err_here</a>();
00077     }
00078 
00079     <span class="keywordflow">if</span> ( v_y.MaximumValue() &gt; MAX ) {
00080 <span class="preprocessor">#ifdef DEBUG_CONSOLE</span>
00081 <span class="preprocessor"></span>        cout &lt;&lt; (<span class="stringliteral">"LinAlg: Problem is dual unbounded"</span>);
00082 <span class="preprocessor">#endif</span>
00083 <span class="preprocessor"></span>        <a class="code" href="ALL_8H.html#a1">err_here</a>();
00084     }
00085 
00086     <span class="keywordflow">if</span> ( v_Road.Sum() &lt; EPSILON &amp;&amp; v_Sigma.Sum() &lt; EPSILON
00087          &amp;&amp; gamma &lt; EPSILON
00088         )
00089         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00090     <span class="keywordflow">else</span>
00091         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00092 }
00093 
00094 <span class="comment">//------------- End of function LinAlg::deinit --------//</span>
00095 
00096 <span class="comment">//----------- Begin of function LinAlg::quadratic_prog ------//</span>
<a name="l00107"></a><a class="code" href="classLinearAlgebra.html#d0">00107</a> <span class="comment">bool LinearAlgebra::quadratic_prog(const Vector &amp;v_c, const Matrix &amp;m_Q, const Matrix &amp;m_A, const Vector &amp;v_b, Vector &amp;v_xNames, int loopCountMultiplier) {</span>
00108     <span class="comment">// init local variables</span>
00109     <span class="keywordtype">int</span> maxIteration = 20;
00110     <span class="keyword">const</span> <a class="code" href="OLINALG_8H.html#a0">REAL</a> SIGMA    = 1/15.0;                   <span class="comment">// 1/10.0;</span>
00111     <span class="keyword">const</span> <a class="code" href="OLINALG_8H.html#a0">REAL</a> R      = 9.0/10;
00112     <span class="keywordtype">int</span> iter    = 0;
00113 
00114     <span class="keywordtype">int</span> n = v_c.Storage();
00115     <span class="keywordtype">int</span> m = v_b.Storage();
00116 
00117     maxIteration *= loopCountMultiplier;
00118 
00119 <span class="preprocessor">#ifdef DEBUG_VC</span>
00120 <span class="preprocessor"></span>    <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(<span class="stringliteral">"----------- quadratic_prog begin -----------"</span>);
00121     <span class="comment">// print_input(c,Q,A,b,xNames)</span>
00122     <span class="keywordflow">if</span> ( n==10 &amp;&amp; m==12 ) {
00123         <span class="keywordtype">char</span> s[500];
00124 
00125         <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(<span class="stringliteral">"c = "</span>);
00126         sprintf(s, <span class="stringliteral">"{ %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f };"</span>,
00127                 v_c(1),v_c(2),v_c(3),
00128                 v_c(4),v_c(5),v_c(6),
00129                 v_c(7),v_c(8),v_c(9), v_c(10));
00130         <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(s);
00131         <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(<span class="stringliteral">"Q = "</span>);
00132         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1; i&lt;=n; i++) {
00133             sprintf(s, <span class="stringliteral">"{%f, %f, %f, %f, %f, %f, %f, %f, %f, %f},"</span>,
00134                     m_Q(i,1),m_Q(i,2),m_Q(i,3),m_Q(i,4),m_Q(i,5),m_Q(i,6),m_Q(i,7),m_Q(i,8),m_Q(i,9),m_Q(i,10)
00135                 );
00136             <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(s);
00137         }
00138         <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(<span class="stringliteral">"A = "</span>);
00139         <span class="keywordflow">for</span> (i=1; i&lt;=m; i++) {
00140             sprintf(s, <span class="stringliteral">"{%f, %f, %f, %f, %f, %f, %f, %f, %f, %f},"</span>,
00141                     m_A(i,1),m_A(i,2),m_A(i,3),m_A(i,4),m_A(i,5),m_A(i,6),m_A(i,7),m_A(i,8),m_A(i,9),m_A(i,10)
00142                 );
00143             <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(s);
00144         }
00145         <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(<span class="stringliteral">"b = "</span>);
00146         sprintf(s, <span class="stringliteral">"{%.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f,"</span>,
00147                 v_b(1),v_b(2),v_b(3),
00148                 v_b(4),v_b(5),v_b(6),
00149                 v_b(7),v_b(8),v_b(9), v_b(10), v_b(11), v_b(12)
00150             );
00151         <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(s);
00152         <span class="comment">/*sprintf(s, "%f, %f, %f, %f, %f, %f, %f, %f, %f,",</span>
00153 <span class="comment">          v_b(10),v_b(11),v_b(12),</span>
00154 <span class="comment">          v_b(13),v_b(14),v_b(15),</span>
00155 <span class="comment">          v_b(16),v_b(17),v_b(18)</span>
00156 <span class="comment">          );</span>
00157 <span class="comment">          DEBUG_LOG(s);</span>
00158 <span class="comment">          sprintf(s, "%f, %f};",</span>
00159 <span class="comment">          v_b(19),v_b(20));</span>
00160 <span class="comment">          DEBUG_LOG(s);*/</span>
00161 
00162     }
00163     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( n==9 &amp;&amp; m==20 ) {                     <span class="comment">// stage 1</span>
00164         <span class="keywordtype">char</span> s[500];
00165 
00166         <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(<span class="stringliteral">"c = "</span>);
00167         sprintf(s, <span class="stringliteral">"{ %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f };"</span>,
00168                 v_c(1),v_c(2),v_c(3),
00169                 v_c(4),v_c(5),v_c(6),
00170                 v_c(7),v_c(8),v_c(9));
00171         <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(s);
00172         <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(<span class="stringliteral">"Q = "</span>);
00173         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1; i&lt;=n; i++) {
00174             sprintf(s, <span class="stringliteral">"{%f, %f, %f, %f, %f, %f, %f, %f, %f, },"</span>,
00175                     m_Q(i,1),m_Q(i,2),m_Q(i,3),m_Q(i,4),m_Q(i,5),m_Q(i,6),m_Q(i,7),m_Q(i,8),m_Q(i,9)
00176                 );
00177             <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(s);
00178         }
00179         <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(<span class="stringliteral">"A = "</span>);
00180         <span class="keywordflow">for</span> (i=1; i&lt;=m; i++) {
00181             sprintf(s, <span class="stringliteral">"{%f, %f, %f, %f, %f, %f, %f, %f, %f },"</span>,
00182                     m_A(i,1),m_A(i,2),m_A(i,3),m_A(i,4),m_A(i,5),m_A(i,6),m_A(i,7),m_A(i,8),m_A(i,9)
00183                 );
00184             <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(s);
00185         }
00186         <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(<span class="stringliteral">"b = "</span>);
00187         sprintf(s, <span class="stringliteral">"{%f, %f, %f, %f, %f, %f, %f, %f, %f, %f, %f, %f, %f, %f, %f, %f, %f, %f, %f, %f, }, "</span>,
00188                 v_b(1),v_b(2),v_b(3),
00189                 v_b(4),v_b(5),v_b(6),
00190                 v_b(7),v_b(8),v_b(9), v_b(10), v_b(11), v_b(12),
00191                 v_b(13),v_b(14),v_b(15), v_b(16), v_b(17), v_b(18), v_b(19), v_b(20)
00192             );
00193         <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(s);
00194     }
00195     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( n==10 &amp;&amp; m==22 ) {                    <span class="comment">// stage 2</span>
00196         <span class="keywordtype">char</span> s[500];
00197 
00198         <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(<span class="stringliteral">"c = "</span>);
00199         sprintf(s, <span class="stringliteral">"{ %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f };"</span>,
00200                 v_c(1),v_c(2),v_c(3),
00201                 v_c(4),v_c(5),v_c(6),
00202                 v_c(7),v_c(8),v_c(9),v_c(10));
00203         <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(s);
00204         <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(<span class="stringliteral">"Q = "</span>);
00205         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1; i&lt;=n; i++) {
00206             sprintf(s, <span class="stringliteral">"{%.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, },"</span>,
00207                     m_Q(i,1),m_Q(i,2),m_Q(i,3),m_Q(i,4),m_Q(i,5),m_Q(i,6),m_Q(i,7),m_Q(i,8),m_Q(i,9),m_Q(i,10)
00208                 );
00209             <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(s);
00210         }
00211         <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(<span class="stringliteral">"A = "</span>);
00212         <span class="keywordflow">for</span> (i=1; i&lt;=m; i++) {
00213             sprintf(s, <span class="stringliteral">"{%.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f },"</span>,
00214                     m_A(i,1),m_A(i,2),m_A(i,3),m_A(i,4),m_A(i,5),m_A(i,6),m_A(i,7),m_A(i,8),m_A(i,9),m_A(i,10)
00215                 );
00216             <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(s);
00217         }
00218         <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(<span class="stringliteral">"b = "</span>);
00219         sprintf(s, <span class="stringliteral">"{%.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, }, "</span>,
00220                 v_b(1),v_b(2),v_b(3),
00221                 v_b(4),v_b(5),v_b(6),
00222                 v_b(7),v_b(8),v_b(9), v_b(10), v_b(11), v_b(12),
00223                 v_b(13),v_b(14),v_b(15), v_b(16), v_b(17), v_b(18), v_b(19), v_b(20), v_b(21), v_b(22)
00224             );
00225         <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(s);
00226     }
00227 <span class="preprocessor">#endif</span>
00228 <span class="preprocessor"></span>
00229     <a class="code" href="OLINALG_8H.html#a1">Vector</a>  v_eN(n);    v_eN = 1;
00230     <a class="code" href="OLINALG_8H.html#a1">Vector</a>  v_eM(m);    v_eM = 1;
00231 
00232     <a class="code" href="OLINALG_8H.html#a1">Vector</a>  v_x(n);   v_x = 1;
00233     <a class="code" href="OLINALG_8H.html#a1">Vector</a>  v_z(n);   v_z = 1;
00234     <a class="code" href="OLINALG_8H.html#a1">Vector</a>  v_y(m);   v_y = 1;
00235     <a class="code" href="OLINALG_8H.html#a1">Vector</a>  v_w(m);   v_w = 1;
00236 
00237     <span class="comment">// check  m_A is nxm, m_Q is nxn</span>
00238     <a class="code" href="ALL_8H.html#a0">err_when</a>(m_A.Nrows() != m || m_A.Ncols() != n );
00239     <a class="code" href="ALL_8H.html#a0">err_when</a>(m_Q.Nrows() != n || m_Q.Ncols() != n );
00240 
00241     <span class="comment">// init for while loop not_converged() checking</span>
00242     <span class="comment">//</span>
00243     <a class="code" href="OLINALG_8H.html#a1">Vector</a> v_Road = v_b - m_A*(v_x) + v_w;
00244     <a class="code" href="OLINALG_8H.html#a1">Vector</a> v_Sigma = v_c - m_A.t() * v_y - v_z + m_Q*v_x;
00245     <a class="code" href="OLINALG_8H.html#a0">REAL</a>  gamma   = (v_z.t()*v_x + v_y.t()*v_w).AsScalar();
00246     <a class="code" href="OLINALG_8H.html#a0">REAL</a>  mute    = SIGMA*gamma / (n+m);
00247 
00248     DiagonalMatrix X(n),  Xinv(n);
00249     DiagonalMatrix Y(m),  Yinv(m);
00250     DiagonalMatrix Z(n);
00251     DiagonalMatrix W(m);
00252     <a class="code" href="classMatrix.html">Matrix</a> T1(n,n), T2(n,m), T3(m,n), T4(m,m);
00253 
00254     <a class="code" href="OLINALG_8H.html#a1">Vector</a> KKFvec(n+m);                             <span class="comment">//, v_tmp1(n), v_tmp2(m);</span>
00255 
00256     <a class="code" href="OLINALG_8H.html#a1">Vector</a> m_temp(m+n);
00257     <a class="code" href="OLINALG_8H.html#a1">Vector</a> v_dx(n), v_dy(m), v_dz(n), v_dw(m);
00258     <a class="code" href="OLINALG_8H.html#a0">REAL</a>  theeta;
00259 
00260     X=0; Xinv=0; Z=0;
00261     Y=0; Yinv=0; W=0; {
00262 
00263         <span class="comment">//      Matrix _t1(n,n), _t2(n,n);              _t1=1;  _t2=2;</span>
00264         <span class="comment">//      _t1 = SP(_t1,_t2);</span>
00265     }
00266 
00267     <a class="code" href="classMatrix.html">Matrix</a> KKFmat(m+n,m+n);
00268     <a class="code" href="classMatrix.html">Matrix</a> KKFmatInverse(m+n,m+n);
00269 
00270     <a class="code" href="OLINALG_8H.html#a0">REAL</a> min=1;
00271 
00272     <span class="keywordflow">while</span> ( quadratic_prog_not_converged(v_x,v_y,v_Road,v_Sigma,gamma) &amp;&amp; iter &lt;= maxIteration &amp;&amp; min &gt; 0.0000000001 ) {
00273         iter++;
00274         v_Road  = v_b - m_A*v_x + v_w;
00275         v_Sigma = v_c - m_A.t()*v_y - v_z + m_Q*v_x;
00276         gamma   = (v_z.t()*v_x + v_y.t()*v_w).AsScalar();
00277         mute    = SIGMA*gamma / (n+m);
00278 
00279         X.set_diagonal(v_x);
00280         Y.set_diagonal(v_y);
00281         Z.set_diagonal(v_z);
00282         W.set_diagonal(v_w);
00283 
00284         Xinv.set_diagonal(ElmDivide(v_eN, v_x));
00285         Yinv.set_diagonal(ElmDivide(v_eM, v_y));
00286 
00287         T1 = -(Xinv * Z + m_Q);
00288         T2 = m_A.t();
00289         T3 = m_A;
00290         T4 = Yinv*W;
00291         <span class="comment">//PRT_MAT &lt;&lt; "T1: " &lt;&lt; T1 &lt;&lt; endl;</span>
00292         KKFmat = (T1|T2) &amp; (T3|T4);
00293 
00294         KKFvec = (v_c - T2*v_y - mute*Xinv*v_eN + m_Q*v_x)
00295             &amp; (v_b - m_A*v_x + mute*Yinv*v_eM);
00296 
00297         Try {
00298             <span class="comment">/*{</span>
00299 <span class="comment">              bool _f;</span>
00300 <span class="comment">              DiagonalMatrix _dmat(n+m);                _dmat=1;</span>
00301 <span class="comment">              Matrix _inv(n+m,n+m);</span>
00302 <span class="comment"></span>
00303 <span class="comment">              SVD(KKFmat, _dmat, _inv);</span>
00304 <span class="comment"></span>
00305 <span class="comment">              _dmat=1;</span>
00306 <span class="comment">              if ( KKFmat*_inv == _dmat )</span>
00307 <span class="comment">              _f = true;</span>
00308 <span class="comment">              else</span>
00309 <span class="comment">              _f = false;</span>
00310 <span class="comment">              }*/</span>
00311 
00312             min = <a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(KKFmat(1,1));
00313 
00314             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=2; i&lt;=m+n; i++) {
00315                 <span class="keywordflow">if</span> ( min &gt; <a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(KKFmat(i,i)) )            <span class="comment">// check diagonal element</span>
00316                     min = <a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(KKFmat(i,i));
00317             }
00318 
00319             KKFmatInverse = KKFmat.i();
00320 
00321             <span class="comment">/*</span>
00322 <span class="comment">              if ( KKFmat.LogDeterminant().Value() )</span>
00323 <span class="comment">              KKFmatInverse = KKFmat.i();</span>
00324 <span class="comment">              else</span>
00325 <span class="comment">              break;</span>
00326 <span class="comment">            */</span>
00327 
00328             m_temp =  KKFmatInverse * KKFvec;
00329 
00330             v_dx  = m_temp.Rows(1,n);
00331             v_dy  = m_temp.Rows(n+1,n+m);
00332 
00333             v_dz  = Xinv*(mute*v_eN - X*Z*v_eN - Z*v_dx);
00334             v_dw  = Yinv*(mute*v_eM - Y*W*v_eM - W*v_dy);
00335             <span class="comment">//PRT_MAT &lt;&lt; "v_dx,z,y,w: " &lt;&lt; (v_dx|v_dz) &lt;&lt;", "&lt;&lt; (v_dy|v_dw) &lt;&lt;endl;</span>
00336             <span class="comment">//PRT_MAT &lt;&lt; "v_x: " &lt;&lt; v_x &lt;&lt; endl;</span>
00337             <span class="comment">//PRT_MAT &lt;&lt; "ElmDivide(v_x,v_dx): " &lt;&lt; ElmDivide(v_x,v_dx) &lt;&lt; endl;</span>
00338 
00339             theeta =
00340                 (R/((
00341                     ElmDivide(-v_dx,v_x)
00342                     &amp; ElmDivide(-v_dw,v_w)
00343                     &amp; ElmDivide(-v_dy,v_y)
00344                     &amp; ElmDivide(-v_dz,v_z)
00345                     )).MaximumValue()
00346                     );
00347             <span class="keywordflow">if</span>(theeta&gt;1)                                <span class="comment">// theeta = min(theeta,1)</span>
00348                 theeta = 1;
00349 
00350             v_x += theeta * v_dx;
00351             v_y += theeta * v_dy;
00352             v_w += theeta * v_dw;
00353             v_z += theeta * v_dz;
00354 
00355 <span class="preprocessor">#ifdef DEBUG_CONSOLE</span>
00356 <span class="preprocessor"></span>            cout &lt;&lt; <span class="stringliteral">"#iter "</span>&lt;&lt; iter &lt;&lt; <span class="stringliteral">": "</span> &lt;&lt; v_Road.Sum() &lt;&lt; <span class="stringliteral">", "</span> &lt;&lt; v_Sigma.Sum() &lt;&lt; <span class="stringliteral">", "</span> &lt;&lt; gamma &lt;&lt; endl;
00357             cout &lt;&lt; <span class="stringliteral">"Ro:"</span> &lt;&lt; v_Road &lt;&lt; endl;
00358             <a class="code" href="OLINALG_8CPP.html#a1">PRT_MAT15</a> &lt;&lt; <span class="stringliteral">"v_x:"</span> &lt;&lt; v_x &lt;&lt; endl;
00359             <a class="code" href="OLINALG_8CPP.html#a1">PRT_MAT15</a> &lt;&lt; <span class="stringliteral">"v_y:"</span> &lt;&lt; v_y &lt;&lt; endl;
00360             <a class="code" href="OLINALG_8CPP.html#a1">PRT_MAT15</a> &lt;&lt; <span class="stringliteral">"v_w:"</span> &lt;&lt; v_w &lt;&lt; endl;
00361             <a class="code" href="OLINALG_8CPP.html#a1">PRT_MAT15</a> &lt;&lt; <span class="stringliteral">"v_z:"</span> &lt;&lt; v_z &lt;&lt; endl;
00362 <span class="preprocessor">#elif defined(DEBUG_VC)</span>
00363 <span class="preprocessor"></span>
00364             <span class="keywordtype">char</span> s[200];
00365             sprintf(s, <span class="stringliteral">"#iter %d: %f, %f, %f"</span>,
00366                     iter, v_Road.Sum(), v_Sigma.Sum(), gamma);
00367             <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(s);
00368             <span class="keywordflow">if</span> ( n == 9 &amp;&amp; <span class="keyword">false</span> ) {
00369                 <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(<span class="stringliteral">"x = "</span>);
00370                 sprintf(s, <span class="stringliteral">"   %f, %f, %f, %f, %f, %f, %f, %f, %f"</span>,
00371                         v_x(1),v_x(2),v_x(3),
00372                         v_x(4),v_x(5),v_x(6),
00373                         v_x(7),v_x(8),v_x(9));
00374                 <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(s);
00375             }
00376 <span class="preprocessor">#endif</span>
00377 <span class="preprocessor"></span>        }
00378         CatchAll {
00379 <span class="preprocessor">#ifdef DEBUG_CONSOLE</span>
00380 <span class="preprocessor"></span>            cout &lt;&lt; <a class="code" href="classException.html#d2">Exception::what</a>();
00381 <span class="preprocessor">#endif</span>
00382 <span class="preprocessor"></span><span class="preprocessor">#ifdef DEBUG_VC</span>
00383 <span class="preprocessor"></span>            <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(<span class="stringliteral">"olinalg: failure in quad_prog"</span>);
00384             <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>((<span class="keywordtype">char</span> *)<a class="code" href="classException.html#d2">Exception::what</a>());
00385 <span class="preprocessor">#endif</span>
00386 <span class="preprocessor"></span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;
00387         }
00388     }                                               <span class="comment">// while</span>
00389 
00390     v_xNames = v_x;
00391 
00392     <span class="keywordflow">if</span> ( min &lt; 0.00001 ) {                          <span class="comment">// 1214 || KKFmat.LogDeterminant().Value() == 0 )</span>
00393         <span class="comment">//char s[200];</span>
00394 
00395         <span class="comment">//sprintf(s, "#iter %d: %f, %f, %f",</span>
00396         <span class="comment">//      iter, v_Road.Sum(), v_Sigma.Sum(), gamma);</span>
00397         <span class="comment">//DEBUG_LOG(s);</span>
00398         <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(<span class="stringliteral">"--- quad_prog early exit for min &lt; 0.00001 ---"</span>);
00399     }
00400     <span class="keywordflow">else</span>
00401         <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(<span class="stringliteral">"----------- quad_prog normal exit -----------"</span>);
00402 
00403 <span class="preprocessor">#ifdef DEBUG_CONSOLE</span>
00404 <span class="preprocessor"></span>    cout &lt;&lt; <span class="stringliteral">"#iter: "</span> &lt;&lt; iter;
00405 <span class="preprocessor">#endif</span>
00406 <span class="preprocessor"></span>
00407     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00408 }
00409 
00410 <span class="comment">//------------- End of function LinAlg::quadratic_prog ------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:03 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
