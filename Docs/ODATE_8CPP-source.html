<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ODATE.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>ODATE.CPP</h1><a href="ODATE_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : ODATE.CPP</span>
00002 <span class="comment">//Description : Date Information Object</span>
00003 
00004 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00005 <span class="preprocessor">#include &lt;string.h&gt;</span>
00006 <span class="preprocessor">#include &lt;windowsx.h&gt;</span>
00007 
00008 <span class="preprocessor">#include &lt;<a class="code" href="OSTR_8H.html">OSTR.H</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;OMISC.H&gt;</span>
00010 <span class="preprocessor">#include &lt;<a class="code" href="ODATE_8H.html">ODATE.H</a>&gt;</span>
00011 
00012 <span class="comment">//--------- Define static member variables -----------//</span>
00013 
<a name="l00014"></a><a class="code" href="ODATE_8CPP.html#a0">00014</a> <span class="preprocessor">#define  JULIAN_ADJUSTMENT    1721425L</span>
00015 <span class="preprocessor"></span>
00016 <span class="keyword">static</span> <span class="keywordtype">char</span> month_str_array[][10] = {
00017     <span class="stringliteral">"January"</span>,
00018     <span class="stringliteral">"February"</span>,
00019     <span class="stringliteral">"March"</span>,
00020     <span class="stringliteral">"April"</span>,
00021     <span class="stringliteral">"May"</span>,
00022     <span class="stringliteral">"June"</span>,
00023     <span class="stringliteral">"July"</span>,
00024     <span class="stringliteral">"August"</span>,
00025     <span class="stringliteral">"September"</span>,
00026     <span class="stringliteral">"October"</span>,
00027     <span class="stringliteral">"November"</span>,
00028     <span class="stringliteral">"December"</span>
00029 } ;
00030 
00031 <span class="keyword">static</span> <span class="keywordtype">int</span> month_tot[]=
00032 { 0, 0,  31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334, 365 }
00033 ;
00034 
00035 <span class="comment">// Jan Feb Mar  Apr  May  Jun   Jul  Aug  Sep  Oct  Nov  Dec</span>
00036 <span class="comment">// 31  28  31   30   31   30     31   31   30   31   30   31</span>
00037 
00038 <span class="comment">//------------ Begin of function DateInfo::julain ----------//</span>
<a name="l00050"></a><a class="code" href="classDateInfo.html#a0">00050</a> <span class="comment">long DateInfo::julian( int year, int month, int day ) {</span>
00051     <span class="keywordtype">long</span>  total, dayYear ;
00052 
00053     dayYear    =  day_year( year, month, day) ;
00054 
00055     <span class="keywordflow">if</span> (dayYear &lt; 1)
00056         <span class="keywordflow">return</span>( -1) ;                                 <span class="comment">/* Illegal Date */</span>
00057 
00058     total =  ytoj(year) ;
00059     total+=  dayYear ;
00060     total+=  <a class="code" href="ODATE_8CPP.html#a0">JULIAN_ADJUSTMENT</a> ;
00061 
00062     <span class="keywordflow">return</span> total;
00063 }
00064 
00065 <span class="comment">//-------------- End of function DateInfo::julian ------------//</span>
00066 
00067 <span class="comment">//--------- Begin of function DateInfo::julian ---------//</span>
<a name="l00078"></a><a class="code" href="classDateInfo.html#a1">00078</a> <span class="comment">long DateInfo::julian( char *dateStr ) {</span>
00079     <span class="keywordflow">return</span> julian( m.atoi( dateStr,4 ), m.atoi( dateStr+4,2 ),
00080                    m.atoi( dateStr+6,2 ) );
00081 }
00082 
00083 <span class="comment">//---------- End of function DateInfo::julian ----------//</span>
00084 
00085 <span class="comment">//------------ Begin of function DateInfo::get_date ---------//</span>
<a name="l00095"></a><a class="code" href="classDateInfo.html#a12">00095</a> <span class="comment">int DateInfo::get_date( long julianDate, char returnType ) {</span>
00096     <span class="keywordtype">int</span>   year, month, day, nDays, maxDays ;
00097     <span class="keywordtype">long</span>   totalDays ;
00098 
00099     <span class="comment">//JULIAN_ADJUSTMENT = 1721425</span>
00100     <span class="keywordflow">if</span> ( julianDate &gt; 5373484 || julianDate &lt; <a class="code" href="ODATE_8CPP.html#a0">JULIAN_ADJUSTMENT</a> )
00101         <span class="keywordflow">return</span> -1;
00102 
00103     totalDays  =  (long) (julianDate) - <a class="code" href="ODATE_8CPP.html#a0">JULIAN_ADJUSTMENT</a> ;
00104     year       =  (int) ((double)totalDays/365.2425) + 1 ;
00105     nDays      =  (int) (totalDays -  ytoj(year)) ;
00106 
00107     <span class="keywordflow">if</span> ( nDays &lt;= 0 ) {
00108         year-- ;
00109         nDays   =  (int) (totalDays - ytoj(year)) ;
00110     }
00111 
00112     <span class="keywordflow">if</span> (year%4 == 0 &amp;&amp; year%100 != 0 || year%400 == 0)
00113         maxDays =  366 ;
00114     <span class="keywordflow">else</span>
00115         maxDays =  365 ;
00116 
00117     <span class="keywordflow">if</span> ( nDays &gt; maxDays ) {
00118         year++ ;
00119         nDays -= maxDays ;
00120     }
00121 
00122     <span class="keywordflow">if</span> ( month_day( year, nDays, month, day ) &lt; 0 )
00123         <span class="keywordflow">return</span> -1;
00124 
00125     <span class="comment">//............................................//</span>
00126 
00127     <span class="keywordflow">switch</span>( returnType ) {
00128     <span class="keywordflow">case</span> <span class="charliteral">'Y'</span>:
00129         <span class="keywordflow">return</span> year;
00130 
00131     <span class="keywordflow">case</span> <span class="charliteral">'M'</span>:                                     <span class="comment">// return the month</span>
00132         <span class="keywordflow">return</span> month;
00133 
00134     <span class="keywordflow">case</span> <span class="charliteral">'D'</span>:
00135         <span class="keywordflow">return</span> day;
00136     }
00137 
00138     <span class="keywordflow">return</span> 0;
00139 }
00140 
00141 <span class="comment">//------------- End of function DateInfo::get_date --------//</span>
00142 
00143 <span class="comment">//------------ Begin of function DateInfo::      ---------//</span>
<a name="l00159"></a><a class="code" href="classDateInfo.html#a2">00159</a> <span class="comment">char* DateInfo::date_str( long julianDate, int shortMonthStr, int showDate) {</span>
00160     <span class="keywordtype">int</span>    year, month, day, nDays, maxDays ;
00161     <span class="keywordtype">long</span>   totalDays ;
00162     <span class="keyword">static</span> <span class="keywordtype">char</span> strBuf[10];
00163 
00164     <span class="keywordflow">if</span> ( julianDate &gt; 5373484 || julianDate &lt; <a class="code" href="ODATE_8CPP.html#a0">JULIAN_ADJUSTMENT</a> ) {
00165         strBuf[0]=<a class="code" href="OHELP_8H.html#a0">NULL</a>;
00166         <span class="keywordflow">return</span> strBuf;
00167     }
00168 
00169     totalDays  =  (long) (julianDate) - <a class="code" href="ODATE_8CPP.html#a0">JULIAN_ADJUSTMENT</a> ;
00170     year       =  (int) ((double)totalDays/365.2425) + 1 ;
00171     nDays      =  (int) (totalDays -  ytoj(year)) ;
00172 
00173     <span class="keywordflow">if</span> ( nDays &lt;= 0 ) {
00174         year-- ;
00175         nDays   =  (int) (totalDays - ytoj(year)) ;
00176     }
00177 
00178     <span class="keywordflow">if</span> (year%4 == 0 &amp;&amp; year%100 != 0 || year%400 == 0)
00179         maxDays =  366 ;
00180     <span class="keywordflow">else</span>
00181         maxDays =  365 ;
00182 
00183     <span class="keywordflow">if</span> ( nDays &gt; maxDays ) {
00184         year++ ;
00185         nDays -= maxDays ;
00186     }
00187 
00188     <span class="keywordflow">if</span> ( month_day( year, nDays, month, day ) &lt; 0 ) {
00189         strBuf[0]=<a class="code" href="OHELP_8H.html#a0">NULL</a>;
00190         <span class="keywordflow">return</span> strBuf;
00191     }
00192 
00193     <span class="comment">//--------------------------------------------//</span>
00194 
00195     <span class="keyword">static</span> <a class="code" href="classString.html">String</a> str;
00196 
00197     str = month_str_array[month-1];
00198 
00199     <span class="keywordflow">if</span>( shortMonthStr )
00200         str = str.<a class="code" href="classString.html#a8">left</a>(3);
00201 
00202     <span class="keywordflow">if</span>( showDate ) {
00203         str += <span class="stringliteral">" "</span>;
00204         str += itoa(day,strBuf,10);
00205         str += <span class="stringliteral">","</span>;
00206     }
00207     str += <span class="stringliteral">" Yr."</span>;
00208     str += itoa(year,strBuf,10);
00209 
00210     <span class="keywordflow">return</span> str;
00211 }
00212 
00213 <span class="comment">//------------- End of function DateInfo::date_str --------//</span>
00214 
00215 <span class="comment">//------------ Begin of function DateInfo::month_str ---------//</span>
<a name="l00221"></a><a class="code" href="classDateInfo.html#a3">00221</a> <span class="comment">char* DateInfo::month_str(int monthNo) {</span>
00222     <span class="keywordflow">return</span> month_str_array[monthNo-1];
00223 }
00224 
00225 <span class="comment">//------------- End of function DateInfo::month_str --------//</span>
00226 
00227 <span class="comment">//---------- Begin of function DateInfo::day_year ----------//</span>
00234 <span class="comment"></span>
<a name="l00235"></a><a class="code" href="classDateInfo.html#a9">00235</a> <span class="keywordtype">int</span> <a class="code" href="classDateInfo.html#a9">DateInfo::day_year</a>( <span class="keywordtype">int</span> year, <span class="keywordtype">int</span> month, <span class="keywordtype">int</span> day ) {
00236     <span class="keywordtype">int</span>  isLeap, monthDays ;
00237 
00238     isLeap =   ( <a class="code" href="classDateInfo.html#a4">year</a>%4 == 0 &amp;&amp; <a class="code" href="classDateInfo.html#a4">year</a>%100 != 0 || <a class="code" href="classDateInfo.html#a4">year</a>%400 == 0 ) ?  1 : 0 ;
00239 
00240     monthDays =  month_tot[ <a class="code" href="classDateInfo.html#a5">month</a>+1 ] -  month_tot[ <a class="code" href="classDateInfo.html#a5">month</a>] ;
00241     <span class="keywordflow">if</span> ( <a class="code" href="classDateInfo.html#a5">month</a> == 2 )  monthDays += isLeap ;
00242 
00243     <span class="keywordflow">if</span> ( <a class="code" href="classDateInfo.html#a4">year</a>  &lt; 0  ||
00244          month &lt; 1  ||  month &gt; 12  ||
00245          day   &lt; 1  ||  day   &gt; monthDays )
00246         <span class="keywordflow">return</span>( -1 ) ;                                <span class="comment">/* Illegal Date */</span>
00247 
00248     <span class="keywordflow">if</span> ( <a class="code" href="classDateInfo.html#a5">month</a> &lt;= 2 )  isLeap = 0 ;
00249 
00250     <span class="keywordflow">return</span>(  month_tot[<a class="code" href="classDateInfo.html#a5">month</a>] + <a class="code" href="classDateInfo.html#a6">day</a> + isLeap ) ;
00251 }
00252 
00253 <span class="comment">//------------- End of function DateInfo::day_year -----------//</span>
00254 
00255 <span class="comment">//----------- Begin of function DateInfo::ytoj ----------//</span>
00266 <span class="comment"></span>
00267 <span class="keywordtype">long</span> DateInfo::ytoj( <span class="keywordtype">int</span> yr ) {
00268     yr-- ;
00269     <span class="keywordflow">return</span>( yr*365L +  yr/4L - yr/100L + yr/400L ) ;
00270 }
00271 
00272 <span class="comment">//--------------- End of function DateInfo::ytoj -----------//</span>
00273 
00274 <span class="comment">//--------- Begin of function DateInfo::month_day ---------//</span>
00279 <span class="comment">int DateInfo::month_day( int year, int days,  int &amp;monthRef,  int &amp;dayRef ) {</span>
00280     <span class="keywordtype">int</span> isLeap, i ;
00281 
00282     isLeap =  ( year%4 == 0 &amp;&amp; year%100 != 0 || year%400 == 0 ) ?  1 : 0 ;
00283     <span class="keywordflow">if</span> ( days &lt;= 59 )  isLeap = 0 ;
00284 
00285     <span class="keywordflow">for</span>( i = 2; i &lt;= 13; i++) {
00286         <span class="keywordflow">if</span> ( days &lt;=  month_tot[i] + isLeap ) {
00287             monthRef =  --i ;
00288             <span class="keywordflow">if</span> ( i &lt;= 2) isLeap = 0 ;
00289 
00290             dayRef   =  days - month_tot[ i] - isLeap ;
00291             <span class="keywordflow">return</span>( 0) ;
00292         }
00293     }
00294     dayRef   =  0 ;
00295     monthRef =  0 ;
00296 
00297     <span class="keywordflow">return</span>( -1 ) ;
00298 }
00299 
00300 <span class="comment">//----------- End of function DateInfo::month_day -----------//</span>
00301 
00302 <span class="comment">//--------- Begin of function DateInfo::time_str ---------//</span>
<a name="l00308"></a><a class="code" href="classDateInfo.html#a7">00308</a> <span class="comment">char* DateInfo::time_str(int inTime) {</span>
00309     <span class="comment">// #### begin Gilbert 18/8 ####//</span>
00310     <span class="keyword">static</span> <span class="keywordtype">char</span> strBuf[6] = <span class="stringliteral">"00:00"</span>;
00311     <span class="comment">//itoa( inTime/100, strBuf, 10 );</span>
00312     <span class="comment">//itoa( inTime%100, strBuf+3, 10 );</span>
00313     strBuf[4] = <span class="charliteral">'0'</span> + inTime % 10;
00314     strBuf[3] = <span class="charliteral">'0'</span> + (inTime/10) % 10;
00315     strBuf[1] = <span class="charliteral">'0'</span> + (inTime/100) % 10;
00316     strBuf[0] = <span class="charliteral">'0'</span> + (inTime/1000) % 10;
00317     <span class="comment">// #### end Gilbert 18/8 ####//</span>
00318 
00319     <span class="keywordflow">return</span> strBuf;
00320 }
00321 
00322 <span class="comment">//---------- End of function DateInfo::time_str ----------//</span>
00323 
00324 <span class="comment">//-------- Begin of function DateInfo::days_in_month ------//</span>
<a name="l00332"></a><a class="code" href="classDateInfo.html#a8">00332</a> <span class="comment">int DateInfo::days_in_month(int inMonth) {</span>
00333     <span class="keywordflow">return</span> month_tot[inMonth+1] - month_tot[inMonth];
00334 }
00335 
00336 <span class="comment">//---------- End of function DateInfo::days_in_month ------//</span>
00337 
00338 <span class="comment">//-------- Begin of function DateInfo::add_months ------//</span>
<a name="l00347"></a><a class="code" href="classDateInfo.html#a10">00347</a> <span class="comment">int DateInfo::add_months(int inDate, int addMonth) {</span>
00348     <span class="keywordtype">int</span> inYear  = year(inDate);
00349     <span class="keywordtype">int</span> inMonth = month(inDate);
00350     <span class="keywordtype">int</span> inDay   = day(inDate);
00351 
00352     inMonth += addMonth;
00353 
00354     <span class="keywordflow">if</span>( inMonth &gt; 12 ) {
00355         inMonth -= 12;
00356         inYear++;
00357     }
00358 
00359     <span class="keywordflow">if</span>( inDay &gt; days_in_month(inMonth) )
00360         inDay = days_in_month(inMonth);
00361 
00362     <span class="keywordflow">return</span> julian( inYear, inMonth, inDay );
00363 }
00364 
00365 <span class="comment">//---------- End of function DateInfo::add_months ------//</span>
00366 
00367 <span class="comment">//-------- Begin of function DateInfo::file_time_to_julian ------//</span>
<a name="l00369"></a><a class="code" href="classDateInfo.html#a11">00369</a> <span class="comment">int DateInfo::file_time_to_julian(FILETIME&amp; fileTime) {</span>
00370     <span class="comment">/*</span>
00371 <span class="comment">      WORD dosTime, dosDate;</span>
00372 <span class="comment"></span>
00373 <span class="comment">      CoFileTimeToDosDateTime( &amp;fileTime, &amp;dosDate, &amp;dosTime );</span>
00374 <span class="comment"></span>
00375 <span class="comment">      //--------------------------------------------//</span>
00376 <span class="comment">      // Bits   Contents</span>
00377 <span class="comment">      // 0-4    Days of the month (1-31).</span>
00378 <span class="comment">      // 5-8    Months (1 = January, 2 = February, and so forth).</span>
00379 <span class="comment">      // 9-15   Year offset from 1980 (add 1980 to get actual year).</span>
00380 <span class="comment">      //--------------------------------------------//</span>
00381 <span class="comment"></span>
00382 <span class="comment">      return julian( 1980 + (dosDate&gt;&gt;9), (dosDate&gt;&gt;5) &amp; 0x0F, dosDate &amp; 0x0F );</span>
00383 <span class="comment">    */</span>
00384     <span class="keywordflow">return</span> 0;
00385 }
00386 
00387 <span class="comment">//---------- End of function DateInfo::file_time_to_julian ------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:20 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
