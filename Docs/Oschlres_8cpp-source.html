<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Oschlres.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Oschlres.cpp</h1><a href="Oschlres_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OSCHLRES.CPP</span>
00002 <span class="comment">//Description : PeerSchool resource object</span>
00003 <span class="comment">//Owner       : Fred</span>
00004 
00005 <span class="preprocessor">#include &lt;<a class="code" href="OBOX_8H.html">OBOX.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00007 <span class="preprocessor">#include &lt;<a class="code" href="OGAMESET_8H.html">OGAMESET.H</a>&gt;</span>
00008 <span class="preprocessor">#include &lt;<a class="code" href="ODYNARR_8H.html">ODYNARR.H</a>&gt;</span>                              <span class="comment">// for build_peer_school_array</span>
00009 <span class="preprocessor">#include &lt;<a class="code" href="OSCHLREC_8H.html">OSCHLREC.H</a>&gt;</span>
00010 <span class="preprocessor">#include &lt;<a class="code" href="OSCHREC2_8H.html">OSCHREC2.H</a>&gt;</span>
00011 <span class="preprocessor">#include &lt;<a class="code" href="OSCHLRES_8H.html">OSCHLRES.H</a>&gt;</span>
00012 <span class="preprocessor">#include &lt;OPSCHOOL.H&gt;</span>
00013 <span class="preprocessor">#include &lt;<a class="code" href="OPEERSCH_8H.html">OPEERSCH.H</a>&gt;</span>
00014 <span class="preprocessor">#include &lt;OMATH.H&gt;</span>
00015 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>                                <span class="comment">// 1027 for next_day</span>
00016 <span class="preprocessor">#include &lt;OFACURES.H&gt;</span>                             <span class="comment">// 1027 for next_day</span>
00017 <span class="preprocessor">#include &lt;OFINANCE.H&gt;</span>                             <span class="comment">// 1027 for next_day</span>
00018 
00019 <span class="preprocessor">#include &lt;<a class="code" href="OFIELD_8H.html">OFIELD.H</a>&gt;</span>                               <span class="comment">//for IPED_FILED_COUNT</span>
00020 
00021 <span class="preprocessor">#ifdef DEBUG</span>
00022 <span class="preprocessor"></span><span class="preprocessor">#include &lt;STDIO.H&gt;</span>
00023 <span class="preprocessor">#include &lt;<a class="code" href="OLOG_8H.html">OLOG.H</a>&gt;</span>
00024 <span class="preprocessor">#endif</span>
00025 <span class="preprocessor"></span>
00026 <span class="preprocessor">#include &lt;MATH.H&gt;</span>                                 <span class="comment">// sqrtf()</span>
<a name="l00027"></a><a class="code" href="Oschlres_8cpp.html#a0">00027</a> <span class="preprocessor">#define EXPO2(x)      ((x)*(x))</span>
00028 <span class="preprocessor"></span>
00029 <span class="comment">//---------- #define constant ------------//</span>
00030 
<a name="l00031"></a><a class="code" href="Oschlres_8cpp.html#a1">00031</a> <span class="preprocessor">#define SCHOOL_DB1    DIR_RES"UMASTER1.RES"</span>
<a name="l00032"></a><a class="code" href="Oschlres_8cpp.html#a2">00032</a> <span class="preprocessor"></span><span class="preprocessor">#define SCHOOL_DB2    DIR_RES"UMASTER2.RES"</span>
<a name="l00033"></a><a class="code" href="Oschlres_8cpp.html#a3">00033</a> <span class="preprocessor"></span><span class="preprocessor">#define PEER_SCHOOL_DB  "PEERNAME"</span>
00034 <span class="preprocessor"></span>
00035 <span class="comment">//--------- define static function --------//</span>
00036 
00037 <span class="keyword">static</span> <span class="keywordtype">int</span> sort_school_distance_function( <span class="keyword">const</span> <span class="keywordtype">void</span> *a, <span class="keyword">const</span> <span class="keywordtype">void</span> *b );
00038 <span class="keyword">static</span> <span class="keywordtype">int</span> sort_peerschool_prestige_function( <span class="keyword">const</span> <span class="keywordtype">void</span> *a, <span class="keyword">const</span> <span class="keywordtype">void</span> *b );
00039 
00040 <span class="comment">//------- Begin of function SchoolRes::init -------//</span>
<a name="l00042"></a><a class="code" href="classSchoolRes.html#a0">00042</a> <span class="comment">void SchoolRes::init() {</span>
00043 }
00044 
00045 <span class="comment">//--------- End of function SchoolRes::init ---------//</span>
00046 
00047 <span class="comment">//------- Begin of function SchoolRes::deinit -------//</span>
<a name="l00049"></a><a class="code" href="classSchoolRes.html#a1">00049</a> <span class="comment">void SchoolRes::deinit() {</span>
00050     <a class="code" href="ALL_8H.html#a8">mem_del</a>(peer_school_array);                     <span class="comment">// which already includes player_peer_school</span>
00051 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00052 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( desired_school_array != <a class="code" href="OHELP_8H.html#a0">NULL</a> ) {
00053         <a class="code" href="ALL_8H.html#a8">mem_del</a>( desired_school_array );
00054         desired_school_array = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00055         desired_school_count = 0;
00056     }
00057 <span class="preprocessor">#endif</span>
00058 <span class="preprocessor"></span>}
00059 
00060 <span class="comment">//--------- End of function SchoolRes::deinit ---------//</span>
00061 
00062 <span class="comment">//------- Begin of function SchoolRes::load_db_info -------//</span>
00064 <span class="comment">void SchoolRes::load_db_info() {</span>
00065 
00066     load_db_1();
00067 
00068     load_db_2();
00069 
00070     load_db_peer();
00071 }
00072 
00073 <span class="comment">//--------- End of function SchoolRes::load_db_info ---------//</span>
00074 
00075 <span class="comment">//------- Begin of function SchoolRes::free_db_info -------//</span>
00077 <span class="comment">void SchoolRes::free_db_info() {</span>
00078     <span class="keywordflow">if</span> ( !db_school_array || !peer_info_array )
00079         <span class="keywordflow">return</span>;
00080 
00081     <a class="code" href="ALL_8H.html#a8">mem_del</a>(db_school_array);
00082     <a class="code" href="ALL_8H.html#a8">mem_del</a>(peer_info_array);
00083 
00084     peer_info_count = db_school_count = 0;
00085     db_school_array = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00086     peer_info_array = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00087 }
00088 
00089 <span class="comment">//--------- End of function SchoolRes::free_db_info ---------//</span>
00090 
00091 <span class="comment">//------- Begin of function SchoolRes::load_db_1 -------//</span>
00093 <span class="comment">void SchoolRes::load_db_1() {</span>
00094     <a class="code" href="classSchoolRec1.html">SchoolRec1</a>   *sRec;
00095     <a class="code" href="classSchool.html">School</a>      *sPtr;
00096     <a class="code" href="classDatabase.html">Database</a>  dbSchool(<a class="code" href="Oschlres_8cpp.html#a1">SCHOOL_DB1</a>, 1);              <span class="comment">// 1-read the entire DB into buffer</span>
00097 
00098     db_school_count = (short) dbSchool.<a class="code" href="classDatabase.html#a7">rec_count</a>();
00099     db_school_array = (<a class="code" href="classSchool.html">School</a>*) <a class="code" href="ALL_8H.html#a5">mem_add</a>( <span class="keyword">sizeof</span>(<a class="code" href="classSchool.html">School</a>) * db_school_count );
00100 
00101     <span class="comment">//------ read in department information array -------//</span>
00102 
00103     memset( db_school_array, 0, <span class="keyword">sizeof</span>(<a class="code" href="classSchool.html">School</a>) * db_school_count );
00104 
00105     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;db_school_count ; i++ ) {
00106         sRec = (<a class="code" href="classSchoolRec1.html">SchoolRec1</a>*) dbSchool.<a class="code" href="classDatabase.html#a4">read</a>(i+1);
00107         sPtr = db_school_array+i;
00108 
00109         m.rtrim_fld( sPtr-&gt;<a class="code" href="classSchool.html#m0">name</a>, sRec-&gt;<a class="code" href="classSchoolRec1.html#m0">name</a>, sRec-&gt;<a class="code" href="classSchoolRec1.html#s1s0">NAME_LEN</a> );
00110         sPtr-&gt;<a class="code" href="classSchool.html#m1">fice</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m1">fice</a>, 8 );
00111 
00112         <span class="keywordflow">if</span>( sRec-&gt;<a class="code" href="classSchoolRec1.html#m2">control</a>[1] == <span class="charliteral">'r'</span>)                  <span class="comment">// 'r' in "Private"</span>
00113             sPtr-&gt;<a class="code" href="classSchool.html#m2">control</a> = <a class="code" href="Opschool_8h.html#a61a15">PRIVATE</a>;
00114         <span class="keywordflow">else</span>
00115             sPtr-&gt;<a class="code" href="classSchool.html#m2">control</a> = <a class="code" href="Opschool_8h.html#a61a16">PUBLIC</a>;
00116 
00117         <span class="keywordflow">switch</span>( sRec-&gt;<a class="code" href="classSchoolRec1.html#m3">carnegie</a>[0] ) {                 <span class="comment">// BUGHERE0 - to be further defined</span>
00118         <span class="keywordflow">case</span> <span class="charliteral">'R'</span>:                                   <span class="comment">// "R1"</span>
00119             sPtr-&gt;<a class="code" href="classSchool.html#m3">carnegie</a> = <a class="code" href="Gamedef_8h.html#a81a41">PRIVATE_SCHOOL</a>;
00120             <span class="keywordflow">break</span>;
00121 
00122         <span class="keywordflow">case</span> <span class="charliteral">'L'</span>:                                   <span class="comment">// LA1</span>
00123             sPtr-&gt;<a class="code" href="classSchool.html#m3">carnegie</a> = <a class="code" href="Gamedef_8h.html#a81a42">LIBERAL_ARTS_SCHOOL</a>;
00124             <span class="keywordflow">break</span>;
00125 
00126         <span class="keywordflow">default</span>:
00127             sPtr-&gt;<a class="code" href="classSchool.html#m3">carnegie</a> = <a class="code" href="Gamedef_8h.html#a81a44">COMPREHENSIVE_SCHOOL</a>;
00128             <span class="keywordflow">break</span>;
00129         }
00130 
00131         sPtr-&gt;<a class="code" href="classSchool.html#m4">cc_sort</a>     = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m4">cc_sort</a>, 5 );
00132         sPtr-&gt;<a class="code" href="classSchool.html#m5">market_score</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m5">market_score</a>, 6 );
00133 
00134         m.rtrim_fld( sPtr-&gt;<a class="code" href="classSchool.html#m6">state</a>, sRec-&gt;<a class="code" href="classSchoolRec1.html#m6">state</a>, 8 );
00135 
00136         sPtr-&gt;<a class="code" href="classSchool.html#m7">usn_wr_ranking</a>    = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m7">usn_wr_ranking</a>, 6 );
00137         sPtr-&gt;<a class="code" href="classSchool.html#m8">ave_midpt_sat_act</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m8">ave_midpt_sat_act</a>, 8 );
00138         sPtr-&gt;<a class="code" href="classSchool.html#m9">freshmen_top_10_class</a> = char(m.atof( sRec-&gt;<a class="code" href="classSchoolRec1.html#m9">freshmen_top_10_class</a>, 7 ) * 100);
00139 
00140         <span class="keywordflow">switch</span>( sRec-&gt;<a class="code" href="classSchoolRec1.html#m10">campus_environment</a>[0] ) {
00141         <span class="keywordflow">case</span> <span class="charliteral">'U'</span>:
00142             sPtr-&gt;<a class="code" href="classSchool.html#m10">campus_environment</a> = <a class="code" href="Opschool_8h.html#a62a17">URBAN</a>;
00143             <span class="keywordflow">break</span>;
00144 
00145         <span class="keywordflow">case</span> <span class="charliteral">'S'</span>:
00146             sPtr-&gt;<a class="code" href="classSchool.html#m10">campus_environment</a> = <a class="code" href="Opschool_8h.html#a62a18">SUBURBAN</a>;
00147             <span class="keywordflow">break</span>;
00148 
00149         <span class="keywordflow">case</span> <span class="charliteral">'R'</span>:
00150             sPtr-&gt;<a class="code" href="classSchool.html#m10">campus_environment</a> = <a class="code" href="Opschool_8h.html#a62a19">RURAL</a>;
00151             <span class="keywordflow">break</span>;
00152         }
00153 
00154         <span class="comment">//BUG ? m.rtrim!?</span>
00155         m.rtrim_fld( sPtr-&gt;<a class="code" href="classSchool.html#m11">ncaa_football_division</a>, sRec-&gt;<a class="code" href="classSchoolRec1.html#m11">ncaa_football_division</a>, 8 );
00156         m.rtrim_fld( sPtr-&gt;<a class="code" href="classSchool.html#m12">ncaa_basketball_division</a>, sRec-&gt;<a class="code" href="classSchoolRec1.html#m12">ncaa_basketball_division</a>, 8 );
00157         sPtr-&gt;<a class="code" href="classSchool.html#m13">football_rating</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m13">football_rating</a>, 6 );
00158         sPtr-&gt;<a class="code" href="classSchool.html#m14">basketball_rating</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m14">basketball_rating</a>, 6 );
00159 
00160         sPtr-&gt;<a class="code" href="classSchool.html#m15">in_state_tuition</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m15">in_state_tuition</a>, 7 );
00161         sPtr-&gt;<a class="code" href="classSchool.html#m16">out_state_tuition</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m16">out_state_tuition</a>, 7 );
00162 
00163         sPtr-&gt;<a class="code" href="classSchool.html#m17">room_and_board_charges</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m17">room_and_board_charges</a>, 8 );
00164         sPtr-&gt;<a class="code" href="classSchool.html#m18">ug_in_housing_percent</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m18">undergrad_in_housing_percent</a>, 8 );
00165 
00166         <span class="comment">//---------------------------------------//</span>
00167 
00168         <span class="comment">// PeerFacultyRec *pfRec = sRec-&gt;peer_faculty_rec_array;</span>
00169         <span class="comment">// PeerFaculty    *pfPtr = sPtr-&gt;peer_faculty_array;</span>
00170         <a class="code" href="structSchoolFacultyRec.html">SchoolFacultyRec</a> *pfRec = sRec-&gt;<a class="code" href="classSchoolRec1.html#m19">school_faculty_rec_array</a>;
00171         <a class="code" href="structSchoolFaculty.html">SchoolFaculty</a>    *pfPtr = sPtr-&gt;<a class="code" href="classSchool.html#m19">school_faculty_array</a>;
00172 
00173         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> j=0 ; j&lt;<a class="code" href="Ofaculty_8h.html#a26a8">FACULTY_RANK_LEVEL_COUNT</a>-2 ; j++, pfRec++, pfPtr++ ) {
00174             pfPtr-&gt;<a class="code" href="structSchoolFaculty.html#m0">faculty_count</a>    = m.atoi( pfRec-&gt;<a class="code" href="structSchoolFacultyRec.html#m0">faculty_count</a>, 8 );
00175             pfPtr-&gt;<a class="code" href="structSchoolFaculty.html#m1">salary</a>           = m.atoi( pfRec-&gt;<a class="code" href="structSchoolFacultyRec.html#m1">salary</a>, 8 );
00176             pfPtr-&gt;<a class="code" href="structSchoolFaculty.html#m2">female_percent</a>   = (float)m.atof( pfRec-&gt;<a class="code" href="structSchoolFacultyRec.html#m2">female_percent</a>, 8 ) * 100;
00177             pfPtr-&gt;<a class="code" href="structSchoolFaculty.html#m3">minority_percent</a> = (float)m.atof( pfRec-&gt;<a class="code" href="structSchoolFacultyRec.html#m3">minority_percent</a>, 8 ) * 100;
00178         }
00179 
00180         <a class="code" href="structSchoolFacultyRec2.html">SchoolFacultyRec2</a> *pfRec2 = sRec-&gt;<a class="code" href="classSchoolRec1.html#m20">school_faculty_rec_array2</a>;
00181 
00182         <span class="keywordflow">for</span>( j=0; j&lt;2 ; j++, pfRec2++, pfPtr++ ) {
00183             pfPtr-&gt;<a class="code" href="structSchoolFaculty.html#m0">faculty_count</a>    = m.atoi( pfRec2-&gt;<a class="code" href="structSchoolFacultyRec2.html#m0">adjunct_count</a>, 8 );
00184             pfPtr-&gt;<a class="code" href="structSchoolFaculty.html#m1">salary</a>        = 0;                   <span class="comment">// dummy field</span>
00185             pfPtr-&gt;<a class="code" href="structSchoolFaculty.html#m2">female_percent</a>   = (float) m.atof( pfRec2-&gt;<a class="code" href="structSchoolFacultyRec2.html#m1">female_percent</a>, 8 ) * 100;
00186             pfPtr-&gt;<a class="code" href="structSchoolFaculty.html#m3">minority_percent</a> = (float) m.atof( pfRec2-&gt;<a class="code" href="structSchoolFacultyRec2.html#m2">minority_percent</a>, 8 ) * 100; {
00187             }
00188 
00189             <span class="comment">//##### begin fred 0523 #####//</span>
00190             <span class="comment">// swap the two 'struct' since we use the following order</span>
00191             <span class="comment">// in faculty.h which is no the same with the orderin database</span>
00192             <span class="comment">//enum { ASST_PROF, ASSOC_PROF, FULL_PROF, LONG_TERM_ADJUNCT, SHORT_TERM_ADJUNCT }; // 3 professers &amp; 2 adjuncts</span>
00193             <a class="code" href="structSchoolFaculty.html">SchoolFaculty</a> tmpFac;
00194             memcpy(&amp;tmpFac, &amp;(sPtr-&gt;<a class="code" href="classSchool.html#m19">school_faculty_array</a>[<a class="code" href="Ofaculty_8h.html#a27a11">FULL_PROF</a>]), <span class="keyword">sizeof</span>(<a class="code" href="structSchoolFaculty.html">SchoolFaculty</a>));
00195             memcpy(&amp;(sPtr-&gt;<a class="code" href="classSchool.html#m19">school_faculty_array</a>[<a class="code" href="Ofaculty_8h.html#a27a11">FULL_PROF</a>]), &amp;(sPtr-&gt;<a class="code" href="classSchool.html#m19">school_faculty_array</a>[<a class="code" href="Ofaculty_8h.html#a27a9">ASST_PROF</a>]), <span class="keyword">sizeof</span>(<a class="code" href="structSchoolFaculty.html">SchoolFaculty</a>));
00196             memcpy(&amp;(sPtr-&gt;<a class="code" href="classSchool.html#m19">school_faculty_array</a>[<a class="code" href="Ofaculty_8h.html#a27a9">ASST_PROF</a>]), &amp;tmpFac, <span class="keyword">sizeof</span>(<a class="code" href="structSchoolFaculty.html">SchoolFaculty</a>));
00197         }
00198         <span class="comment">//##### end fred 0523 #####//</span>
00199 
00200         sPtr-&gt;<a class="code" href="classSchool.html#m20">parttime_faculty_percent</a> = (float) m.atof( sRec-&gt;<a class="code" href="classSchoolRec1.html#m21">parttime_faculty_percent</a>, 8 ) * 100;
00201 
00202         <span class="comment">//--------------------------------------//</span>
00203 
00204         <span class="comment">//----------------------------------------//</span>
00205         <span class="comment">// fred 0501</span>
00206         sPtr-&gt;<a class="code" href="classSchool.html#m21">student_applications</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m22">student_applications</a>, 6 );
00207         sPtr-&gt;<a class="code" href="classSchool.html#m22">student_accepted</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m23">student_accepted</a>, 6 );
00208         sPtr-&gt;<a class="code" href="classSchool.html#m23">student_enrolled</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m24">student_enrolled</a>, 6 );
00209 
00210         <span class="comment">//sPtr-&gt;student_get_bacc_in_5_year_percent = m.atoi( sRec-&gt;student_get_bacc_in_5_year_percent, 6 );</span>
00211 
00212         <span class="comment">//## chea 130899 try to lower the grads rate</span>
00213         <span class="keywordtype">char</span> getfromrec = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m25">student_get_bacc_in_5_year_percent</a>, 6 );
00214         <span class="keywordtype">float</span> final_adj_result = (float)getfromrec * (player_school.ug_get_degree_in_5year_percent /100.0f);
00215         sPtr-&gt;<a class="code" href="classSchool.html#m24">student_get_bacc_in_5_year_percent</a> = (char)final_adj_result;
00216 
00217         sPtr-&gt;<a class="code" href="classSchool.html#m25">freshmen_applied_for_aid</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m26">freshmen_applied_for_aid</a>, 7 );
00218         sPtr-&gt;<a class="code" href="classSchool.html#m26">percent_freshmen_applied_or_aid</a> = (float) m.atof( sRec-&gt;<a class="code" href="classSchoolRec1.html#m27">percent_freshmen_applied_or_aid</a>, 10 ) * 100;
00219         sPtr-&gt;<a class="code" href="classSchool.html#m27">freshmen_with_need</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m28">freshmen_with_need</a>, 8 );
00220         sPtr-&gt;<a class="code" href="classSchool.html#m28">percent_freshmen_with_need</a> = (float) m.atof( sRec-&gt;<a class="code" href="classSchoolRec1.html#m29">percent_freshmen_with_need</a>, 9 ) * 100;
00221         sPtr-&gt;<a class="code" href="classSchool.html#m29">freshmen_offered_aid</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m30">freshmen_offered_aid</a>, 8 );
00222         sPtr-&gt;<a class="code" href="classSchool.html#m30">percent_freshmen_offered_aid</a> = (float) m.atof( sRec-&gt;<a class="code" href="classSchoolRec1.html#m31">percent_freshmen_offered_aid</a>, 9 ) * 100;
00223 
00224         sPtr-&gt;<a class="code" href="classSchool.html#m31">freshmen_offered_full_aid</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m32">freshmen_offered_full_aid</a>, 8 );
00225         sPtr-&gt;<a class="code" href="classSchool.html#m32">percent_freshmen_offered_full_aid</a> = (float) m.atof( sRec-&gt;<a class="code" href="classSchoolRec1.html#m33">percent_freshmen_offered_full_aid</a>, 8 ) * 100;
00226 
00227         sPtr-&gt;<a class="code" href="classSchool.html#m33">percent_freshmen_with_fin_aid</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m34">percent_freshmen_with_fin_aid</a>, 8 );
00228         sPtr-&gt;<a class="code" href="classSchool.html#m34">percent_continuing_student_with_fin_aid</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m35">percent_continuing_student_with_fin_aid</a>, 8 );
00229 
00230         sPtr-&gt;<a class="code" href="classSchool.html#m35">institutional_aid_per_fte</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m36">institutional_aid_per_fte</a>, 9 );
00231 
00232         <span class="comment">//----------- revenue data -------------//</span>
00233         sPtr-&gt;<a class="code" href="classSchool.html#m36">total_gross_tuition_revenue</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m37">total_gross_tuition_revenue</a>, 8 );
00234         sPtr-&gt;<a class="code" href="classSchool.html#m37">total_financial_aid</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m38">total_financial_aid</a>, 8 );
00235         sPtr-&gt;<a class="code" href="classSchool.html#m38">total_sponsored_research</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m39">total_sponsored_research</a>, 8 );
00236         sPtr-&gt;<a class="code" href="classSchool.html#m39">adjusted_total_sponsored_research</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m40">adjusted_total_sponsored_research</a>, 8 );
00237         sPtr-&gt;<a class="code" href="classSchool.html#m40">raw_endowment_spending</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m41">raw_endowment_spending</a>, 8 );
00238         sPtr-&gt;<a class="code" href="classSchool.html#m41">state_and_local_appropriations</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m42">state_and_local_appropriations</a>, 8 );
00239         sPtr-&gt;<a class="code" href="classSchool.html#m42">total_gifts</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m43">total_gifts</a>, 8 );
00240         sPtr-&gt;<a class="code" href="classSchool.html#m43">gifts_to_operations</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m44">gifts_to_operations</a>, 8 );
00241         sPtr-&gt;<a class="code" href="classSchool.html#m44">athletics_revenue</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m45">athletics_revenue</a>, 8 );
00242 
00243         sPtr-&gt;<a class="code" href="classSchool.html#m45">adjusted_other_operating_income</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m46">adjusted_other_operating_income</a>, 8 );
00244         sPtr-&gt;<a class="code" href="classSchool.html#m46">raw_other_operating_income</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m47">raw_other_operating_income</a>, 8 );
00245 
00246         <span class="comment">//----------- expense data -------------//</span>
00247         sPtr-&gt;<a class="code" href="classSchool.html#m47">academic_dept_total_salaries</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m48">academic_dept_total_salaries</a>, 9 );
00248         sPtr-&gt;<a class="code" href="classSchool.html#m48">academic_dept_faculty_salaries</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m49">academic_dept_faculty_salaries</a>, 9 );
00249         sPtr-&gt;<a class="code" href="classSchool.html#m49">academic_dept_other_expense</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m50">academic_dept_other_expense</a>, 9 );
00250 
00251         sPtr-&gt;<a class="code" href="classSchool.html#m50">sponsored_research_total_salaries</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m51">sponsored_research_total_salaries</a>, 9 );
00252         sPtr-&gt;<a class="code" href="classSchool.html#m51">sponsored_research_faculty_salaries</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m52">sponsored_research_faculty_salaries</a>, 9 );
00253         sPtr-&gt;<a class="code" href="classSchool.html#m52">sponsored_research_other_expense</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m53">sponsored_research_other_expense</a>, 9 );
00254 
00255         sPtr-&gt;<a class="code" href="classSchool.html#m53">library_salaries</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m54">library_salaries</a>, 10 );
00256         sPtr-&gt;<a class="code" href="classSchool.html#m54">library_other_expense</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m55">library_other_expense</a>, 10 );
00257 
00258         sPtr-&gt;<a class="code" href="classSchool.html#m55">student_life_salaries</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m56">student_life_salaries</a>, 10 );
00259         sPtr-&gt;<a class="code" href="classSchool.html#m56">student_life_other_expense</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m57">student_life_other_expense</a>, 10 );
00260 
00261         sPtr-&gt;<a class="code" href="classSchool.html#m57">inst_support_salaries</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m58">inst_support_salaries</a>, 10 );
00262         sPtr-&gt;<a class="code" href="classSchool.html#m58">inst_support_other_expense</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m59">inst_support_other_expense</a>, 10 );
00263 
00264         sPtr-&gt;<a class="code" href="classSchool.html#m59">inst_support_net_salaries</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m60">inst_support_net_salaries</a>, 10 );
00265         sPtr-&gt;<a class="code" href="classSchool.html#m60">inst_support_net_other_expense</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m61">inst_support_net_other_expense</a>, 10 );
00266         sPtr-&gt;<a class="code" href="classSchool.html#m61">inst_advancement_salaries</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m62">inst_advancement_salaries</a>, 10 );
00267         sPtr-&gt;<a class="code" href="classSchool.html#m62">inst_advancement_other_expense</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m63">inst_advancement_other_expense</a>, 10 );
00268         sPtr-&gt;<a class="code" href="classSchool.html#m63">o_and_m_salaries</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m64">o_and_m_salaries</a>, 8 );
00269         sPtr-&gt;<a class="code" href="classSchool.html#m64">o_and_m_other_expense</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m65">o_and_m_other_expense</a>, 8 );
00270         sPtr-&gt;<a class="code" href="classSchool.html#m65">athletics_salaries</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m66">athletics_salaries</a>, 8 );
00271         sPtr-&gt;<a class="code" href="classSchool.html#m66">athletics_other_expense</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m67">athletics_other_expense</a>, 8 );
00272 
00273         sPtr-&gt;<a class="code" href="classSchool.html#m67">academic_support_salaries</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m68">academic_support_salaries</a>, 10 );
00274         sPtr-&gt;<a class="code" href="classSchool.html#m68">academic_support_other_expense</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m69">academic_support_other_expense</a>, 10 );
00275 
00276         <span class="comment">// field 87     // fred 0501</span>
00277         sPtr-&gt;<a class="code" href="classSchool.html#m69">end_of_year_endowment_market_value</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m70">end_of_year_endowment_market_value</a>, 8 );
00278         sPtr-&gt;<a class="code" href="classSchool.html#m70">current_funds_balance</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m71">current_funds_balance</a>, 8 );
00279         sPtr-&gt;<a class="code" href="classSchool.html#m71">year_end_book_value_of_plant</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m72">year_end_book_value_of_plant</a>, 8 );
00280         sPtr-&gt;<a class="code" href="classSchool.html#m72">year_end_market_value_of_plant</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m73">year_end_market_value_of_plant</a>, 8 );
00281         sPtr-&gt;<a class="code" href="classSchool.html#m73">year_end_capital_reserve</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m74">year_end_capital_reserve</a>, 8 );
00282         sPtr-&gt;<a class="code" href="classSchool.html#m74">year_end_general_plant_and_residence_hall_debt</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m75">year_end_general_plant_and_residence_hall_debt</a>, 8 );
00283         sPtr-&gt;<a class="code" href="classSchool.html#m75">residence_hall_debt</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m76">residence_hall_debt</a>, 8 );
00284 
00285         sPtr-&gt;<a class="code" href="classSchool.html#m76">raw_surplus</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m77">raw_surplus</a>, 8 );
00286         sPtr-&gt;<a class="code" href="classSchool.html#m77">adjusted_surplus</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m78">adjusted_surplus</a>, 8 );
00287         sPtr-&gt;<a class="code" href="classSchool.html#m78">transfer_to_plant</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m79">transfer_to_plant</a>, 8 );
00288         sPtr-&gt;<a class="code" href="classSchool.html#m79">amount_added_to_other_operating_income</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m80">amount_added_to_other_operating_income</a>, 8 );
00289 
00290         <span class="comment">// field 98</span>
00291         sPtr-&gt;<a class="code" href="classSchool.html#m80">full_time_undergrad</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m81">full_time_undergrad</a>, 8 );
00292         sPtr-&gt;<a class="code" href="classSchool.html#m81">part_time_undergrad</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m82">part_time_undergrad</a>, 8 );
00293         sPtr-&gt;<a class="code" href="classSchool.html#m82">master_and_professional</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m83">master_and_professional</a>, 8 );
00294         sPtr-&gt;<a class="code" href="classSchool.html#m83">non_degree_seeking</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m84">non_degree_seeking</a>, 8 );
00295         sPtr-&gt;<a class="code" href="classSchool.html#m84">female_undergrad_percent</a> = char(100 * m.atof( sRec-&gt;<a class="code" href="classSchoolRec1.html#m85">female_undergrad_percent</a>, 7 ));
00296         sPtr-&gt;<a class="code" href="classSchool.html#m85">female_grad_and_prof_percent</a> = char(100 * m.atof( sRec-&gt;<a class="code" href="classSchoolRec1.html#m86">female_grad_and_prof_percent</a>, 7 ));
00297 
00298         sPtr-&gt;<a class="code" href="classSchool.html#m86">minority_undergrad_percent</a> = char(100 * m.atof( sRec-&gt;<a class="code" href="classSchoolRec1.html#m87">minority_undergrad_percent</a>, 7 ));
00299         sPtr-&gt;<a class="code" href="classSchool.html#m87">minority_grad_and_prof_percent</a> = char(100 * m.atof( sRec-&gt;<a class="code" href="classSchoolRec1.html#m88">minority_grad_and_prof_percent</a>, 7 ));
00300         sPtr-&gt;<a class="code" href="classSchool.html#m88">non_resident_alien_grad_and_prof_percent</a> = char(100 * m.atof( sRec-&gt;<a class="code" href="classSchoolRec1.html#m89">non_resident_alien_grad_and_prof_percent</a>, 7 ));
00301         sPtr-&gt;<a class="code" href="classSchool.html#m89">full_time_freshmen</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m90">full_time_freshmen</a>, 9 );
00302         sPtr-&gt;<a class="code" href="classSchool.html#m90">freshmen_from_within_the_state_percent</a> = char(100 * m.atof( sRec-&gt;<a class="code" href="classSchoolRec1.html#m91">freshmen_from_within_the_state_percent</a>, 9 ));
00303         sPtr-&gt;<a class="code" href="classSchool.html#m91">total_bach_degrees</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m92">total_bach_degrees</a>, 9 );
00304         sPtr-&gt;<a class="code" href="classSchool.html#m92">total_masters_and_prof_degree</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m93">total_masters_and_prof_degree</a>, 9 );
00305         sPtr-&gt;<a class="code" href="classSchool.html#m93">total_doctoral_degrees</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m94">total_doctoral_degrees</a>, 9 );
00306         sPtr-&gt;<a class="code" href="classSchool.html#m94">total_certificates</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m95">total_certificates</a>, 9 );
00307 
00308         <span class="comment">// field 113</span>
00309         sPtr-&gt;<a class="code" href="classSchool.html#m95">enrollment_fte</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m96">enrollment_fte</a>, 7 );
00310         sPtr-&gt;<a class="code" href="classSchool.html#m96">ug_percent</a> = char(100 * m.atof( sRec-&gt;<a class="code" href="classSchoolRec1.html#m97">undergrad_percent</a>, 7 ));
00311         sPtr-&gt;<a class="code" href="classSchool.html#m97">part_time_ug_percent</a> = char(100 * m.atof( sRec-&gt;<a class="code" href="classSchoolRec1.html#m98">part_time_undergrad_percent</a>, 7 ));
00312         sPtr-&gt;<a class="code" href="classSchool.html#m98">non_degree_seeking_percent</a> = char(100 * m.atof( sRec-&gt;<a class="code" href="classSchoolRec1.html#m99">non_degree_seeking_percent</a>, 7 ));
00313 
00314         sPtr-&gt;<a class="code" href="classSchool.html#m99">applications_ratio</a> = (float) m.atof( sRec-&gt;<a class="code" href="classSchoolRec1.html#m100">applications_ratio</a>, 7 );
00315         sPtr-&gt;<a class="code" href="classSchool.html#m100">yield_rate</a> = char(100 * m.atof( sRec-&gt;<a class="code" href="classSchoolRec1.html#m101">yield_rate</a>, 7 ));
00316         sPtr-&gt;<a class="code" href="classSchool.html#m101">athletics_rating</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m102">athletics_rating</a>, 9 );
00317 
00318         sPtr-&gt;<a class="code" href="classSchool.html#m102">total_e_and_g_expenditure</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m103">total_e_and_g_expenditure</a>, 9 );
00319         sPtr-&gt;<a class="code" href="classSchool.html#m103">net_tutition_reenue_as_percent_of_e_and_g_expese</a> = char(100 * m.atof( sRec-&gt;<a class="code" href="classSchoolRec1.html#m104">net_tutition_reenue_as_percent_of_e_and_g_expese</a>, 9 ));
00320         sPtr-&gt;<a class="code" href="classSchool.html#m104">total_tenureline_faculty</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m105">total_tenureline_faculty</a>, 9 );
00321         sPtr-&gt;<a class="code" href="classSchool.html#m105">sponsored_research_per_reg_faculty</a> = (float) m.atof( sRec-&gt;<a class="code" href="classSchoolRec1.html#m106">sponsored_research_per_reg_faculty</a>, 9 );
00322         sPtr-&gt;<a class="code" href="classSchool.html#m106">doctoral_degrees_per_reg_faculty</a> = (float) m.atof( sRec-&gt;<a class="code" href="classSchoolRec1.html#m107">doctoral_degrees_per_reg_faculty</a>, 9 );
00323 
00324         sPtr-&gt;<a class="code" href="classSchool.html#m107">overhead_rate</a> = char(100 * m.atof( sRec-&gt;<a class="code" href="classSchoolRec1.html#m108">overhead_rate</a>, 7 ));
00325         sPtr-&gt;<a class="code" href="classSchool.html#m108">endowment_spending_rate</a> = 100 * (float) m.atof( sRec-&gt;<a class="code" href="classSchoolRec1.html#m109">endowment_spending_rate</a>, 7 );
00326         sPtr-&gt;<a class="code" href="classSchool.html#m109">enrollment_masters</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m110">enrollment_masters</a>, 8 );
00327         sPtr-&gt;<a class="code" href="classSchool.html#m110">enrollment_doctoral</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec1.html#m111">enrollment_doctoral</a>, 8 );
00328     }
00329 }
00330 
00331 <span class="comment">//--------- End of function SchoolRes::load_db_1 ---------//</span>
00332 
00333 <span class="comment">//------- Begin of function SchoolRes::load_db_2 -------//</span>
00335 <span class="comment">void SchoolRes::load_db_2() {</span>
00336     <a class="code" href="classSchoolRec2.html">SchoolRec2</a>   *sRec;
00337     <a class="code" href="classSchool.html">School</a>      *sPtr;
00338     <a class="code" href="classDatabase.html">Database</a>  dbSchool(<a class="code" href="Oschlres_8cpp.html#a2">SCHOOL_DB2</a>, 1);              <span class="comment">// 1-read the entire DB into buffer</span>
00339 
00340     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;db_school_count ; i++ ) {
00341         sRec = (<a class="code" href="classSchoolRec2.html">SchoolRec2</a>*) dbSchool.<a class="code" href="classDatabase.html#a4">read</a>(i+1);
00342         sPtr = db_school_array+i;
00343 
00344         <span class="comment">// ---------- umaster2 ------------- //</span>
00345         sPtr-&gt;<a class="code" href="classSchool.html#m111">target_student_intake_sl</a>[0] = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec2.html#m0">target_student_intake_sl1</a>, 7 );
00346         sPtr-&gt;<a class="code" href="classSchool.html#m111">target_student_intake_sl</a>[1] = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec2.html#m1">target_student_intake_sl2</a>, 7 );
00347         sPtr-&gt;<a class="code" href="classSchool.html#m111">target_student_intake_sl</a>[2] = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec2.html#m2">target_student_intake_sl3</a>, 7 );
00348         sPtr-&gt;<a class="code" href="classSchool.html#m111">target_student_intake_sl</a>[3] = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec2.html#m3">target_student_intake_sl4</a>, 7 );
00349         sPtr-&gt;<a class="code" href="classSchool.html#m111">target_student_intake_sl</a>[4] = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec2.html#m4">target_student_intake_sl5</a>, 7 );
00350 
00351         <span class="comment">//BUG ? 9</span>
00352         sPtr-&gt;<a class="code" href="classSchool.html#m112">dropout_rate_sl</a>[0] = 100 * (float) m.atof( sRec-&gt;<a class="code" href="classSchoolRec2.html#m5">dropout_rate_sl1</a>, 9 );
00353         sPtr-&gt;<a class="code" href="classSchool.html#m112">dropout_rate_sl</a>[1] = 100 * (float) m.atof( sRec-&gt;<a class="code" href="classSchoolRec2.html#m6">dropout_rate_sl2</a>, 6 );
00354         sPtr-&gt;<a class="code" href="classSchool.html#m112">dropout_rate_sl</a>[2] = 100 * (float) m.atof( sRec-&gt;<a class="code" href="classSchoolRec2.html#m7">dropout_rate_sl3</a>, 6 );
00355         sPtr-&gt;<a class="code" href="classSchool.html#m112">dropout_rate_sl</a>[3] = 100 * (float) m.atof( sRec-&gt;<a class="code" href="classSchoolRec2.html#m8">dropout_rate_sl4</a>, 6 );
00356         sPtr-&gt;<a class="code" href="classSchool.html#m112">dropout_rate_sl</a>[4] = 100 * (float) m.atof( sRec-&gt;<a class="code" href="classSchoolRec2.html#m9">dropout_rate_sl5</a>, 6 );
00357 
00358         sPtr-&gt;<a class="code" href="classSchool.html#m113">target_grad_rate_sl</a>[0] = 100 * (float) m.atof( sRec-&gt;<a class="code" href="classSchoolRec2.html#m10">target_grad_rate_sl1</a>, 6 );
00359         sPtr-&gt;<a class="code" href="classSchool.html#m113">target_grad_rate_sl</a>[1] = 100 * (float) m.atof( sRec-&gt;<a class="code" href="classSchoolRec2.html#m11">target_grad_rate_sl2</a>, 6 );
00360         sPtr-&gt;<a class="code" href="classSchool.html#m113">target_grad_rate_sl</a>[2] = 100 * (float) m.atof( sRec-&gt;<a class="code" href="classSchoolRec2.html#m12">target_grad_rate_sl3</a>, 6 );
00361         sPtr-&gt;<a class="code" href="classSchool.html#m113">target_grad_rate_sl</a>[3] = 100 * (float) m.atof( sRec-&gt;<a class="code" href="classSchoolRec2.html#m13">target_grad_rate_sl4</a>, 6 );
00362         sPtr-&gt;<a class="code" href="classSchool.html#m113">target_grad_rate_sl</a>[4] = 100 * (float) m.atof( sRec-&gt;<a class="code" href="classSchoolRec2.html#m14">target_grad_rate_sl5</a>, 6 );
00363 
00364         <span class="comment">// field 16</span>
00365         sPtr-&gt;<a class="code" href="classSchool.html#m114">percent_ug_students_on_aid</a> = char(100 * m.atof( sRec-&gt;<a class="code" href="classSchoolRec2.html#m15">pct_ug_students_on_aid</a>, 7 ));
00366         sPtr-&gt;<a class="code" href="classSchool.html#m115">endowment_per_student</a> = (float) m.atof( sRec-&gt;<a class="code" href="classSchoolRec2.html#m16">endowment_per_student</a>, 10 );
00367         sPtr-&gt;<a class="code" href="classSchool.html#m116">endowment_per_tenureline_faculty_member</a> = (float) m.atof( sRec-&gt;<a class="code" href="classSchoolRec2.html#m17">endowment_per_tenureline_faculty_member</a>, 11 );
00368         sPtr-&gt;<a class="code" href="classSchool.html#m117">ratio_of_current_funds_balance_to_total_operating_expenditure</a> = (float) m.atof( sRec-&gt;<a class="code" href="classSchoolRec2.html#m18">ratio_of_current_funds_balance_to_total_operating_expenditure</a>, 10 );
00369         sPtr-&gt;<a class="code" href="classSchool.html#m118">financial_condition</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec2.html#m19">financial_condition</a>, 10 );
00370         sPtr-&gt;<a class="code" href="classSchool.html#m119">number_of_incoming_ug_students</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec2.html#m20">number_of_incoming_ug_students</a>, 10 );
00371         sPtr-&gt;<a class="code" href="classSchool.html#m120">female_student_percent</a> = char(100 * m.atof( sRec-&gt;<a class="code" href="classSchoolRec2.html#m21">female_student_percent</a>, 9 ));
00372         sPtr-&gt;<a class="code" href="classSchool.html#m121">minority_student_percent</a> = char(100 * m.atof( sRec-&gt;<a class="code" href="classSchoolRec2.html#m22">minority_student_percent</a>, 9 ));
00373 
00374         <span class="comment">//## chea 160799 begin sponsored_research</span>
00375         <span class="comment">//              if(player_school.sponsored_research_intensity==5)</span>
00376         sPtr-&gt;<a class="code" href="classSchool.html#m122">sponsored_research_rating</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec2.html#m23">sponsored_research_rating</a>, 9 );
00377         <span class="comment">//              if(player_school.sponsored_research_intensity==10)</span>
00378         <span class="comment">//                      sPtr-&gt;sponsored_research_rating = 10;</span>
00379         <span class="comment">//## chea 160799 end sponsored_research</span>
00380 
00381         sPtr-&gt;<a class="code" href="classSchool.html#m123">doctoral_degres_per_faculty_rating</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec2.html#m24">doctoral_degres_per_faculty_rating</a>, 9 );
00382         sPtr-&gt;<a class="code" href="classSchool.html#m124">adj_freshmen_top_ten_percent_of_class</a> = char(100 * m.atof( sRec-&gt;<a class="code" href="classSchoolRec2.html#m25">adj_freshmen_top_ten_percent_of_class</a>, 9 ));
00383         sPtr-&gt;<a class="code" href="classSchool.html#m125">apps_ratio2</a> = (float) m.atof( sRec-&gt;<a class="code" href="classSchoolRec2.html#m26">apps_ratio2</a>, 8 );
00384         sPtr-&gt;<a class="code" href="classSchool.html#m126">yield_rate2</a> = (float) m.atof( sRec-&gt;<a class="code" href="classSchoolRec2.html#m27">yield_rate2</a>, 8 );
00385         sPtr-&gt;<a class="code" href="classSchool.html#m127">athletics_rating2</a> = m.atoi( sRec-&gt;<a class="code" href="classSchoolRec2.html#m28">athletics_rating2</a>, 8 );
00386         sPtr-&gt;<a class="code" href="classSchool.html#m128">net_tuition_revenue_as_percent_of_e_and_g_expense</a> = char(100 * m.atof( sRec-&gt;<a class="code" href="classSchoolRec2.html#m29">net_tuition_revenue_as_percent_of_e_and_g_expense</a>, 8 ));
00387         sPtr-&gt;<a class="code" href="classSchool.html#m129">doc_time_to_degree</a> = (float) m.atof( sRec-&gt;<a class="code" href="classSchoolRec2.html#m30">doc_time_to_degree</a>, 11 );
00388     }
00389 }
00390 
00391 <span class="comment">//--------- End of function SchoolRes::load_db_2 ---------//</span>
00392 
00393 <span class="comment">//------- Begin of function SchoolRes::load_db_peer -------//</span>
00395 <span class="comment">void SchoolRes::load_db_peer() {</span>
00396     <a class="code" href="structPeerRec.html">PeerRec</a>   *pRec;
00397     <a class="code" href="classPeerInfo.html">PeerInfo</a>    *pPtr;
00398     <span class="comment">// dbSchool(PEER_SCHOOL_DB, 1);             // 1-read the entire DB into buffer</span>
00399     <a class="code" href="classDatabase.html">Database</a>    *dbSchool = game_set.open_db(<a class="code" href="Oschlres_8cpp.html#a3">PEER_SCHOOL_DB</a>);
00400 
00401     peer_info_count = (short) dbSchool-&gt;<a class="code" href="classDatabase.html#a7">rec_count</a>();
00402     peer_info_array = (<a class="code" href="classPeerInfo.html">PeerInfo</a>*) <a class="code" href="ALL_8H.html#a5">mem_add</a>( <span class="keyword">sizeof</span>(<a class="code" href="classPeerInfo.html">PeerInfo</a>) * peer_info_count );
00403 
00404     <span class="comment">//------ read in school array -------//</span>
00405 
00406     memset( peer_info_array, 0, <span class="keyword">sizeof</span>(<a class="code" href="classPeerInfo.html">PeerInfo</a>) * peer_info_count );
00407 
00408     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;peer_info_count; i++ ) {
00409         pRec = (<a class="code" href="structPeerRec.html">PeerRec</a>*) dbSchool-&gt;<a class="code" href="classDatabase.html#a4">read</a>(i+1);
00410         pPtr = peer_info_array+i;
00411 
00412         m.rtrim_fld( pPtr-&gt;<a class="code" href="classPeerInfo.html#m0">name</a>, pRec-&gt;<a class="code" href="structPeerRec.html#m0">name</a>, pRec-&gt;<a class="code" href="structPeerRec.html#s1s0">NAME_LEN</a> );
00413     }
00414 }
00415 
00416 <span class="comment">//------- End of function SchoolRes::load_db_peer -------//</span>
00417 
00418 <span class="comment">//--------- Begin of function SchoolRes::init_game -----------//</span>
<a name="l00425"></a><a class="code" href="classSchoolRes.html#a4">00425</a> <span class="comment">void SchoolRes::init_game() {</span>
00426     <span class="comment">//-----------------------------------------------------------------//</span>
00427     <span class="comment">// Read UMASTER1.DBF and UMASTER2.DBF to SchoolRes::db_school_array[]</span>
00428     <span class="comment">// using SchoolRec1 and SchoolRec2 as the header for reading.</span>
00429     <span class="comment">// Refer to the "Main" sheet in the "Master" Excel file.</span>
00430     <span class="comment">//-----------------------------------------------------------------//</span>
00431 
00432     load_db_info();
00433 
00434 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00435 <span class="preprocessor"></span>    <span class="comment">// Item 7a)</span>
00436 
00437     <span class="comment">// --------------------------------------------------------------- //</span>
00438     <span class="comment">// Get the records in db_school_array[] with the desired type</span>
00439     <span class="comment">// Public or Private. And store it into</span>
00440     <span class="comment">// SchoolRes::desired_school_array[]</span>
00441     <span class="comment">// ---------------------------------------------------------------- //</span>
00442 
00443     get_desired_school_array();
00444 
00445     <span class="comment">// ---------------------------------------------------------------- //</span>
00446     <span class="comment">// Calculate a Distance value for all records in</span>
00447     <span class="comment">// SchoolRes::desired_school_array[],</span>
00448     <span class="comment">// The varaibles need to compare are just Number of on-campus students</span>
00449     <span class="comment">// and Sponsored research intensity.</span>
00450     <span class="comment">// ---------------------------------------------------------------- //</span>
00451 
00452     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=0; i&lt;desired_school_count; i++ )
00453         desired_school_array[i].calc_distance_first();
00454 
00455     <span class="comment">// --------------------------------------------------------------- //</span>
00456     <span class="comment">// Get 50 records in desired_school_array[] with the smallest</span>
00457     <span class="comment">// distance value. And they will store into desired_school_array again</span>
00458     <span class="comment">// --------------------------------------------------------------- //</span>
00459 
00460     get_50_school_array();
00461 <span class="preprocessor">#endif</span>
00462 <span class="preprocessor"></span>
00463     <span class="comment">//-----------------------------------------------------------------//</span>
00464     <span class="comment">// Calculate a Distance value for all records in</span>
00465     <span class="comment">// SchoolRes::db_school_array[].</span>
00466     <span class="comment">// Refer to the "Indices" sheet in the "Initialization" Excel file.</span>
00467     <span class="comment">//-----------------------------------------------------------------//</span>
00468 
00469     <a class="code" href="classSchool.html#d0">School::calc_distance_all_school</a>();
00470 
00471     <span class="comment">//-----------------------------------------------------------------//</span>
00472     <span class="comment">// Get 10 records in db_school_array[] with the smallest distance values</span>
00473     <span class="comment">// and store their record number in db_school_array[] in school_ex_array[].</span>
00474     <span class="comment">//-----------------------------------------------------------------//</span>
00475 
00476     build_school_ex_array();
00477 
00478     <span class="comment">//---- initialize player_school &amp; player_school_ex ----//</span>
00479 
00480     init_player_school_ex();
00481 
00482     <span class="comment">//----- select and build peer schools in peer_school_array from db_school_array -----//</span>
00483 
00484     build_peer_school_array();
00485 
00486     <a class="code" href="classPeerSchool.html#d1">PeerSchool::calc_average_faculty_salary</a>();
00487 
00488     <span class="comment">//-----------------------------------//</span>
00489 
00490     free_db_info();
00491 }
00492 
00493 <span class="comment">//---------- End of function SchoolRes::init_game -----------//</span>
00494 
00495 <span class="comment">//-------- Begin of function SchoolRes::build_school_ex_array --------//</span>
00499 <span class="comment">void SchoolRes::build_school_ex_array() {</span>
00500     <span class="comment">//-------------------------------------------------//</span>
00501 
00502 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00503 <span class="preprocessor"></span><span class="preprocessor">#else</span>
00504 <span class="preprocessor"></span>    <span class="comment">// 0115</span>
00505     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;db_school_count ; i++ ) {
00506         <a class="code" href="classSchool.html">School</a>* sPtr = get_db_school(i+1);
00507         <span class="keywordflow">if</span> ( sPtr-&gt;<a class="code" href="classSchool.html#m2">control</a> != player_school.control )
00508             sPtr-&gt;<a class="code" href="classSchool.html#m131">distance_value</a> = 10000;               <span class="comment">// avoid this school to be added to the ex array</span>
00509     }
00510 <span class="preprocessor">#endif</span>
00511 <span class="preprocessor"></span>
00512 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00513 <span class="preprocessor"></span>    <span class="comment">//---- create an array for sorting on distance ----//</span>
00514     <span class="keywordtype">short</span>* schoolSortArray = (<span class="keywordtype">short</span>*) <a class="code" href="ALL_8H.html#a5">mem_add</a>( desired_school_count * <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>) );
00515     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;desired_school_count ; i++ )
00516         schoolSortArray[i] = i;
00517 
00518     <span class="comment">//---- sort School in db_school_array[] by distance ----//</span>
00519 
00520     qsort( schoolSortArray, desired_school_count, <span class="keyword">sizeof</span>(schoolSortArray[0]), sort_school_distance_function );
00521 
00522 <span class="preprocessor">#else</span>
00523 <span class="preprocessor"></span>    <span class="comment">//---- create an array for sorting on distance ----//</span>
00524     <span class="keywordtype">short</span>* schoolSortArray = (<span class="keywordtype">short</span>*) <a class="code" href="ALL_8H.html#a5">mem_add</a>( db_school_count * <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>) );
00525     <span class="keywordflow">for</span>( i=0 ; i&lt;db_school_count ; i++ )
00526         schoolSortArray[i] = i+1;
00527 
00528     <span class="comment">//---- sort School in db_school_array[] by distance ----//</span>
00529 
00530     qsort( schoolSortArray, db_school_count, <span class="keyword">sizeof</span>(schoolSortArray[0]), sort_school_distance_function );
00531 <span class="preprocessor">#endif</span>
00532 <span class="preprocessor"></span>
00533     <span class="comment">//-----------------------------------------------------------------//</span>
00534     <span class="comment">// Get 10 records in db_school_array[] with the smallest distance values</span>
00535     <span class="comment">// and store their record number in db_school_array[] in school_ex_array[].</span>
00536     <span class="comment">//</span>
00537     <span class="comment">// Call SchoolEx::init() to calculate a set of new variables in</span>
00538     <span class="comment">// school_ex_array[] based on vars in db_school_array[]. Refer to</span>
00539     <span class="comment">// the "Init Cond" sheet in the "Initialization" Excel file.</span>
00540     <span class="comment">//-----------------------------------------------------------------//</span>
00541 
00542     <span class="comment">//##### begin 0825 fred #####//</span>
00543     <span class="comment">//BUGHERE for debug</span>
00544     <span class="comment">/*</span>
00545 <span class="comment">      schoolSortArray[0]=(18);          //18</span>
00546 <span class="comment">      schoolSortArray[1]=(132);         //132</span>
00547 <span class="comment">      schoolSortArray[2]=(58);</span>
00548 <span class="comment">      schoolSortArray[3]=(140);</span>
00549 <span class="comment">      schoolSortArray[4]=(64);</span>
00550 <span class="comment"></span>
00551 <span class="comment">      schoolSortArray[5]=(4);           // harvard</span>
00552 <span class="comment">      schoolSortArray[6]=(130);</span>
00553 <span class="comment">      schoolSortArray[7]=(53);</span>
00554 <span class="comment">      schoolSortArray[8]=(6);</span>
00555 <span class="comment">      schoolSortArray[9]=(50);</span>
00556 <span class="comment">    */</span>
00557     <span class="comment">//##### end 0825 fred #####//</span>
00558 
00559     <span class="comment">//---- init school_ex_array -----//</span>
00560 
00561     <span class="comment">// read database for "degree_by_field" sheet of excel file "HE.Data_xfm.Master"</span>
00562     <span class="comment">//</span>
00563     <span class="comment">//Database  dbSchool(SCHOOL_DB3, 0);        // 1-read the entire DB into buffer</span>
00564     <span class="comment">//short db3Count = (short) dbSchool.rec_count();</span>
00565     <span class="comment">//err_when(db3Count != db_school_count);</span>
00566 
00567     <span class="keywordflow">for</span>( i=0 ; i&lt;<a class="code" href="OSCHLRES_8H.html#a0">MAX_SCHOOL_EX_FOR_INIT_CONDITION</a> ; i++ ) {
00568         <span class="comment">//SchoolDegreeRec* sRec = (SchoolDegreeRec*) dbSchool.read(schoolSortArray[i]);</span>
00569         school_ex_array[i].init( schoolSortArray[i] );
00570     }
00571 
00572     <a class="code" href="ALL_8H.html#a8">mem_del</a>( schoolSortArray );
00573 }
00574 
00575 <span class="comment">//--------- End of function SchoolRes::build_school_ex_array ---------//</span>
00576 
00577 <span class="comment">//-------- Begin of function SchoolRes::init_player_school_ex --------//</span>
00581 <span class="comment">void SchoolRes::init_player_school_ex() {</span>
00582     player_peer_school = (<a class="code" href="classPeerSchool.html">PeerSchool</a> *)<a class="code" href="ALL_8H.html#a5">mem_add</a>(<span class="keyword">sizeof</span>(<a class="code" href="classPeerSchool.html">PeerSchool</a>));
00583     memset(player_peer_school, 0 ,<span class="keyword">sizeof</span>(<a class="code" href="classPeerSchool.html">PeerSchool</a>));
00584 
00585     strcpy(player_peer_school-&gt;name, player_school.school_name);
00586     <span class="comment">// some members of SchoolEx have the same name as members of School</span>
00587 
00588     <span class="comment">//-------------------------------------//</span>
00589 
00590 <span class="preprocessor">#define AVERAGE_SCHOOL_EX_VAR_FLOAT(varName) \</span>
00591 <span class="preprocessor">    player_peer_school-&gt;varName = math.average_float( (char*) school_ex_array, sizeof(SchoolEx), MAX_SCHOOL_EX_FOR_INIT_CONDITION, \</span>
00592 <span class="preprocessor">      (char*) &amp;(school_ex_array[0].varName) - (char*) &amp;(school_ex_array[0]) )</span>
00593 <span class="preprocessor"></span>
00594 <span class="preprocessor">#define AVERAGE_SCHOOL_EX_VAR_INT(varName) \</span>
00595 <span class="preprocessor">      player_peer_school-&gt;varName = math.average_int( (char*) school_ex_array, sizeof(SchoolEx), MAX_SCHOOL_EX_FOR_INIT_CONDITION, \</span>
00596 <span class="preprocessor">      (char*) &amp;(school_ex_array[0].varName) - (char*) &amp;(school_ex_array[0]) )</span>
00597 <span class="preprocessor"></span>
00598 <span class="preprocessor">#define AVERAGE_SCHOOL_EX_VAR_SHORT(varName) \</span>
00599 <span class="preprocessor">      player_peer_school-&gt;varName = math.average_short( (char*) school_ex_array, sizeof(SchoolEx), MAX_SCHOOL_EX_FOR_INIT_CONDITION, \</span>
00600 <span class="preprocessor">      (char*) &amp;(school_ex_array[0].varName) - (char*) &amp;(school_ex_array[0]) )</span>
00601 <span class="preprocessor"></span>
00602 <span class="preprocessor">#define AVERAGE_SCHOOL_EX_VAR_CHAR(varName) \</span>
00603 <span class="preprocessor">      player_peer_school-&gt;varName = math.average_char( (char*) school_ex_array, sizeof(SchoolEx), MAX_SCHOOL_EX_FOR_INIT_CONDITION, \</span>
00604 <span class="preprocessor">      (char*) &amp;(school_ex_array[0].varName) - (char*) &amp;(school_ex_array[0]) )</span>
00605 <span class="preprocessor"></span>
00606 <span class="preprocessor">#define AVERAGE_SCHOOL_EX_VAR_FLOAT_SKIP_ZERO(varName) \</span>
00607 <span class="preprocessor">      player_peer_school-&gt;varName = math.average_float( (char*) school_ex_array, sizeof(SchoolEx), MAX_SCHOOL_EX_FOR_INIT_CONDITION, \</span>
00608 <span class="preprocessor">      (char*) &amp;(school_ex_array[0].varName) - (char*) &amp;(school_ex_array[0]), true )</span>
00609 <span class="preprocessor"></span>
00610 <span class="preprocessor">#define AVERAGE_SCHOOL_EX_VAR_INT_SKIP_ZERO(varName) \</span>
00611 <span class="preprocessor">      player_peer_school-&gt;varName = math.average_int( (char*) school_ex_array, sizeof(SchoolEx), MAX_SCHOOL_EX_FOR_INIT_CONDITION, \</span>
00612 <span class="preprocessor">      (char*) &amp;(school_ex_array[0].varName) - (char*) &amp;(school_ex_array[0]), true )</span>
00613 <span class="preprocessor"></span>
00614 <span class="preprocessor">#define AVERAGE_SCHOOL_EX_VAR_SHORT_SKIP_ZERO(varName) \</span>
00615 <span class="preprocessor">      player_peer_school-&gt;varName = math.average_short( (char*) school_ex_array, sizeof(SchoolEx), MAX_SCHOOL_EX_FOR_INIT_CONDITION, \</span>
00616 <span class="preprocessor">      (char*) &amp;(school_ex_array[0].varName) - (char*) &amp;(school_ex_array[0]), true )</span>
00617 <span class="preprocessor"></span>
00618 <span class="preprocessor">#define AVERAGE_SCHOOL_EX_VAR_CHAR_SKIP_ZERO(varName) \</span>
00619 <span class="preprocessor">      player_peer_school-&gt;varName = math.average_char( (char*) school_ex_array, sizeof(SchoolEx), MAX_SCHOOL_EX_FOR_INIT_CONDITION, \</span>
00620 <span class="preprocessor">      (char*) &amp;(school_ex_array[0].varName) - (char*) &amp;(school_ex_array[0]), true )</span>
00621 <span class="preprocessor"></span>
00622     <span class="keywordtype">int</span> i;
00623 
00624     <span class="comment">//--------------------------------------//</span>
00625     <span class="comment">//-------- average vars in School ------//</span>
00626     <span class="comment">//--------------------------------------//</span>
00627     <span class="comment">// School</span>
00628     AVERAGE_SCHOOL_EX_VAR_SHORT(fice);
00629     AVERAGE_SCHOOL_EX_VAR_CHAR(control);
00630     AVERAGE_SCHOOL_EX_VAR_CHAR(carnegie);
00631     AVERAGE_SCHOOL_EX_VAR_CHAR(cc_sort);
00632     AVERAGE_SCHOOL_EX_VAR_CHAR(market_score);
00633 
00634     <span class="comment">//--------------------------------------//</span>
00635 
00636     AVERAGE_SCHOOL_EX_VAR_SHORT(usn_wr_ranking);    <span class="comment">// Raw USN&amp;WR ranking</span>
00637     AVERAGE_SCHOOL_EX_VAR_SHORT(ave_midpt_sat_act);
00638     AVERAGE_SCHOOL_EX_VAR_CHAR( freshmen_top_10_class);
00639 
00640     AVERAGE_SCHOOL_EX_VAR_CHAR(campus_environment); <span class="comment">// = URBAN, SUBURBAN, or RURAL</span>
00641 
00642     AVERAGE_SCHOOL_EX_VAR_CHAR(football_rating);
00643     AVERAGE_SCHOOL_EX_VAR_CHAR(basketball_rating);
00644 
00645     AVERAGE_SCHOOL_EX_VAR_SHORT(in_state_tuition);
00646     AVERAGE_SCHOOL_EX_VAR_SHORT(out_state_tuition);
00647     AVERAGE_SCHOOL_EX_VAR_SHORT(room_and_board_charges);
00648     AVERAGE_SCHOOL_EX_VAR_CHAR(ug_in_housing_percent);
00649 
00650     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Ofaculty_8h.html#a26a8">FACULTY_RANK_LEVEL_COUNT</a>; i++) {
00651         AVERAGE_SCHOOL_EX_VAR_SHORT(school_faculty_array[i].faculty_count);
00652         AVERAGE_SCHOOL_EX_VAR_INT(school_faculty_array[i].salary);
00653         AVERAGE_SCHOOL_EX_VAR_FLOAT(school_faculty_array[i].female_percent);
00654         AVERAGE_SCHOOL_EX_VAR_FLOAT(school_faculty_array[i].minority_percent);
00655     }
00656     AVERAGE_SCHOOL_EX_VAR_FLOAT(parttime_faculty_percent);
00657 
00658     <span class="comment">//----------------------------------------//</span>
00659     <span class="comment">// fred 0501</span>
00660 
00661     AVERAGE_SCHOOL_EX_VAR_INT(student_applications);
00662     AVERAGE_SCHOOL_EX_VAR_SHORT(student_accepted);
00663     AVERAGE_SCHOOL_EX_VAR_SHORT(student_enrolled);
00664     AVERAGE_SCHOOL_EX_VAR_CHAR(student_get_bacc_in_5_year_percent);
00665 
00666     <span class="comment">// field 43</span>
00667     AVERAGE_SCHOOL_EX_VAR_SHORT(freshmen_applied_for_aid);
00668     AVERAGE_SCHOOL_EX_VAR_FLOAT(percent_freshmen_applied_or_aid);
00669 
00670     AVERAGE_SCHOOL_EX_VAR_SHORT(freshmen_with_need);
00671     AVERAGE_SCHOOL_EX_VAR_FLOAT_SKIP_ZERO(percent_freshmen_with_need);
00672 
00673     AVERAGE_SCHOOL_EX_VAR_SHORT_SKIP_ZERO(freshmen_offered_aid);
00674     AVERAGE_SCHOOL_EX_VAR_FLOAT(percent_freshmen_offered_aid);
00675 
00676     AVERAGE_SCHOOL_EX_VAR_SHORT(freshmen_offered_full_aid);
00677     AVERAGE_SCHOOL_EX_VAR_FLOAT_SKIP_ZERO(percent_freshmen_offered_full_aid);
00678 
00679     AVERAGE_SCHOOL_EX_VAR_CHAR( percent_freshmen_with_fin_aid);
00680     AVERAGE_SCHOOL_EX_VAR_CHAR( percent_continuing_student_with_fin_aid);
00681 
00682     AVERAGE_SCHOOL_EX_VAR_SHORT_SKIP_ZERO(institutional_aid_per_fte);
00683 
00684     <span class="comment">//----------- revenue data -------------//</span>
00685     <span class="comment">// field 54</span>
00686     AVERAGE_SCHOOL_EX_VAR_INT(total_gross_tuition_revenue);
00687     AVERAGE_SCHOOL_EX_VAR_INT(total_financial_aid);
00688     AVERAGE_SCHOOL_EX_VAR_INT(total_sponsored_research);
00689     AVERAGE_SCHOOL_EX_VAR_INT(adjusted_total_sponsored_research);
00690     AVERAGE_SCHOOL_EX_VAR_INT(raw_endowment_spending);
00691     AVERAGE_SCHOOL_EX_VAR_INT(state_and_local_appropriations);
00692     AVERAGE_SCHOOL_EX_VAR_INT(total_gifts);
00693     AVERAGE_SCHOOL_EX_VAR_INT(gifts_to_operations);
00694     AVERAGE_SCHOOL_EX_VAR_SHORT(athletics_revenue);
00695     AVERAGE_SCHOOL_EX_VAR_INT(adjusted_other_operating_income);
00696     AVERAGE_SCHOOL_EX_VAR_INT(raw_other_operating_income);
00697 
00698     <span class="comment">//----------- field 65: expense data -------------//</span>
00699 
00700     AVERAGE_SCHOOL_EX_VAR_INT(academic_dept_total_salaries);
00701     AVERAGE_SCHOOL_EX_VAR_INT(academic_dept_faculty_salaries);
00702     AVERAGE_SCHOOL_EX_VAR_INT(academic_dept_other_expense);
00703 
00704     AVERAGE_SCHOOL_EX_VAR_INT(sponsored_research_total_salaries);
00705     AVERAGE_SCHOOL_EX_VAR_INT(sponsored_research_faculty_salaries);
00706     AVERAGE_SCHOOL_EX_VAR_INT(sponsored_research_other_expense);
00707 
00708     AVERAGE_SCHOOL_EX_VAR_INT(library_salaries);
00709     AVERAGE_SCHOOL_EX_VAR_INT(library_other_expense);
00710 
00711     AVERAGE_SCHOOL_EX_VAR_INT(student_life_salaries);
00712     AVERAGE_SCHOOL_EX_VAR_INT(student_life_other_expense);
00713 
00714     AVERAGE_SCHOOL_EX_VAR_INT(inst_support_salaries);
00715     AVERAGE_SCHOOL_EX_VAR_INT(inst_support_other_expense);
00716 
00717     AVERAGE_SCHOOL_EX_VAR_INT(inst_support_net_salaries);
00718     AVERAGE_SCHOOL_EX_VAR_INT(inst_support_net_other_expense);
00719 
00720     AVERAGE_SCHOOL_EX_VAR_INT(inst_advancement_salaries);
00721     AVERAGE_SCHOOL_EX_VAR_INT(inst_advancement_other_expense);
00722 
00723     AVERAGE_SCHOOL_EX_VAR_INT(o_and_m_salaries);
00724     AVERAGE_SCHOOL_EX_VAR_INT(o_and_m_other_expense);
00725 
00726     AVERAGE_SCHOOL_EX_VAR_INT(athletics_salaries);
00727     AVERAGE_SCHOOL_EX_VAR_INT(athletics_other_expense);
00728 
00729     AVERAGE_SCHOOL_EX_VAR_INT(academic_support_salaries);
00730     AVERAGE_SCHOOL_EX_VAR_INT(academic_support_other_expense);
00731 
00732     <span class="comment">// field 87 // fred 0501</span>
00733     AVERAGE_SCHOOL_EX_VAR_INT(end_of_year_endowment_market_value);
00734     AVERAGE_SCHOOL_EX_VAR_INT(current_funds_balance);
00735     AVERAGE_SCHOOL_EX_VAR_INT(year_end_book_value_of_plant);
00736     AVERAGE_SCHOOL_EX_VAR_INT(year_end_market_value_of_plant);
00737     AVERAGE_SCHOOL_EX_VAR_INT(year_end_capital_reserve);
00738     AVERAGE_SCHOOL_EX_VAR_INT(year_end_general_plant_and_residence_hall_debt);
00739     AVERAGE_SCHOOL_EX_VAR_INT(residence_hall_debt);
00740 
00741     AVERAGE_SCHOOL_EX_VAR_INT(raw_surplus);
00742     AVERAGE_SCHOOL_EX_VAR_INT(adjusted_surplus);
00743     AVERAGE_SCHOOL_EX_VAR_INT(transfer_to_plant);
00744     AVERAGE_SCHOOL_EX_VAR_INT(amount_added_to_other_operating_income);
00745 
00746     <span class="comment">// field 98</span>
00747     AVERAGE_SCHOOL_EX_VAR_SHORT(full_time_undergrad);
00748     AVERAGE_SCHOOL_EX_VAR_SHORT(part_time_undergrad);
00749     AVERAGE_SCHOOL_EX_VAR_SHORT(master_and_professional);
00750     AVERAGE_SCHOOL_EX_VAR_SHORT(non_degree_seeking);
00751     AVERAGE_SCHOOL_EX_VAR_CHAR(female_undergrad_percent);
00752     AVERAGE_SCHOOL_EX_VAR_CHAR(female_grad_and_prof_percent);
00753     AVERAGE_SCHOOL_EX_VAR_CHAR(minority_undergrad_percent);
00754     AVERAGE_SCHOOL_EX_VAR_CHAR(minority_grad_and_prof_percent);
00755     AVERAGE_SCHOOL_EX_VAR_CHAR(non_resident_alien_grad_and_prof_percent);
00756 
00757     <span class="comment">// field 107</span>
00758     AVERAGE_SCHOOL_EX_VAR_SHORT(full_time_freshmen);
00759     AVERAGE_SCHOOL_EX_VAR_CHAR(freshmen_from_within_the_state_percent);
00760     AVERAGE_SCHOOL_EX_VAR_SHORT(total_bach_degrees);
00761     AVERAGE_SCHOOL_EX_VAR_SHORT(total_masters_and_prof_degree);
00762     AVERAGE_SCHOOL_EX_VAR_SHORT(total_doctoral_degrees);
00763     AVERAGE_SCHOOL_EX_VAR_SHORT(total_certificates);
00764 
00765     <span class="comment">// field 113</span>
00766     AVERAGE_SCHOOL_EX_VAR_INT(enrollment_fte);
00767     AVERAGE_SCHOOL_EX_VAR_CHAR(ug_percent);
00768     AVERAGE_SCHOOL_EX_VAR_CHAR(part_time_ug_percent);
00769     AVERAGE_SCHOOL_EX_VAR_CHAR(non_degree_seeking_percent);
00770 
00771     AVERAGE_SCHOOL_EX_VAR_FLOAT(applications_ratio);
00772     AVERAGE_SCHOOL_EX_VAR_CHAR(yield_rate);
00773     AVERAGE_SCHOOL_EX_VAR_CHAR(athletics_rating);
00774 
00775     AVERAGE_SCHOOL_EX_VAR_INT(total_e_and_g_expenditure);
00776     AVERAGE_SCHOOL_EX_VAR_CHAR(net_tutition_reenue_as_percent_of_e_and_g_expese);
00777 
00778     AVERAGE_SCHOOL_EX_VAR_SHORT(total_tenureline_faculty);
00779     AVERAGE_SCHOOL_EX_VAR_FLOAT(sponsored_research_per_reg_faculty);
00780     AVERAGE_SCHOOL_EX_VAR_FLOAT(doctoral_degrees_per_reg_faculty);
00781 
00782     AVERAGE_SCHOOL_EX_VAR_CHAR(overhead_rate);
00783     AVERAGE_SCHOOL_EX_VAR_FLOAT(endowment_spending_rate);
00784 
00785     AVERAGE_SCHOOL_EX_VAR_SHORT(enrollment_masters);
00786     AVERAGE_SCHOOL_EX_VAR_SHORT(enrollment_doctoral);
00787 
00788     <span class="comment">// ---------- field 1 of umaster2 -------------</span>
00789 
00790     <span class="keywordflow">for</span>(i=0;i&lt;5;i++) {
00791         AVERAGE_SCHOOL_EX_VAR_SHORT(target_student_intake_sl[i]);
00792         AVERAGE_SCHOOL_EX_VAR_FLOAT_SKIP_ZERO(dropout_rate_sl[i]);
00793         AVERAGE_SCHOOL_EX_VAR_FLOAT_SKIP_ZERO(target_grad_rate_sl[i]);
00794     }
00795 
00796     <span class="comment">// field 16</span>
00797     AVERAGE_SCHOOL_EX_VAR_CHAR_SKIP_ZERO(percent_ug_students_on_aid);
00798     AVERAGE_SCHOOL_EX_VAR_FLOAT(endowment_per_student);
00799     AVERAGE_SCHOOL_EX_VAR_FLOAT(endowment_per_tenureline_faculty_member);
00800     AVERAGE_SCHOOL_EX_VAR_FLOAT(ratio_of_current_funds_balance_to_total_operating_expenditure);
00801     AVERAGE_SCHOOL_EX_VAR_CHAR(financial_condition);
00802     AVERAGE_SCHOOL_EX_VAR_SHORT(number_of_incoming_ug_students);
00803     AVERAGE_SCHOOL_EX_VAR_CHAR(female_student_percent);
00804     AVERAGE_SCHOOL_EX_VAR_CHAR(minority_student_percent);
00805     AVERAGE_SCHOOL_EX_VAR_CHAR(sponsored_research_rating);
00806     AVERAGE_SCHOOL_EX_VAR_CHAR(doctoral_degres_per_faculty_rating);
00807     AVERAGE_SCHOOL_EX_VAR_CHAR(adj_freshmen_top_ten_percent_of_class);
00808 
00809     AVERAGE_SCHOOL_EX_VAR_FLOAT(apps_ratio2);
00810     AVERAGE_SCHOOL_EX_VAR_FLOAT(yield_rate2);
00811     AVERAGE_SCHOOL_EX_VAR_CHAR(athletics_rating2);
00812     AVERAGE_SCHOOL_EX_VAR_CHAR(net_tuition_revenue_as_percent_of_e_and_g_expense);
00813     <span class="comment">// = 4.21 for debug</span>
00814     AVERAGE_SCHOOL_EX_VAR_FLOAT_SKIP_ZERO(doc_time_to_degree);
00815 
00816     <span class="comment">//---- vars for screening school records -----//</span>
00817     AVERAGE_SCHOOL_EX_VAR_FLOAT(prestige);
00818     AVERAGE_SCHOOL_EX_VAR_FLOAT(distance_value);
00819 
00820     <span class="comment">//--------------------------------------//</span>
00821     <span class="comment">//------ average vars in SchoolEx ------//</span>
00822     <span class="comment">//--------------------------------------//</span>
00823     <span class="comment">// field L-R</span>
00824     AVERAGE_SCHOOL_EX_VAR_INT(operating_reserve);   <span class="comment">// current_funds_balance</span>
00825     AVERAGE_SCHOOL_EX_VAR_INT(endowment_market);    <span class="comment">// end_of_year_endowment_market_value</span>
00826     AVERAGE_SCHOOL_EX_VAR_INT(buildings);           <span class="comment">// year_end_market_value_of_plant</span>
00827     AVERAGE_SCHOOL_EX_VAR_INT(capital_reserve);     <span class="comment">// year_end_capital_reserve</span>
00828     AVERAGE_SCHOOL_EX_VAR_INT(general_plant_debt);  <span class="comment">// year_end_general_plant_and_residence_hall_debt</span>
00829     AVERAGE_SCHOOL_EX_VAR_INT(residence_hall_debt); <span class="comment">// residence_hall_debt</span>
00830     AVERAGE_SCHOOL_EX_VAR_INT(fund_balance);        <span class="comment">// R=M1244+N1244+O1244-P1244-Q1244</span>
00831 
00832     <span class="comment">// field S</span>
00833     <span class="comment">// total_gross_tuition_revenue</span>
00834     AVERAGE_SCHOOL_EX_VAR_INT(gross_tuition_revenue);
00835     AVERAGE_SCHOOL_EX_VAR_INT(financial_aid);       <span class="comment">// total_financial_aid</span>
00836     AVERAGE_SCHOOL_EX_VAR_INT(net_tuition_revenue); <span class="comment">// =S-T</span>
00837 
00838     AVERAGE_SCHOOL_EX_VAR_INT(state_appropriations);<span class="comment">// state_and_local_appropriations</span>
00839     AVERAGE_SCHOOL_EX_VAR_INT(sponsored_research);  <span class="comment">// adjusted_total_sponsored_research</span>
00840     AVERAGE_SCHOOL_EX_VAR_INT(gifts_to_operations); <span class="comment">// gifts_to_operations</span>
00841     AVERAGE_SCHOOL_EX_VAR_INT(endowment_spending);  <span class="comment">//BUG in excel data!!! = M*B = endowment_market * fice</span>
00842 
00843     <span class="comment">// field Z</span>
00844     AVERAGE_SCHOOL_EX_VAR_SHORT(athletics);         <span class="comment">// athletics_revenue</span>
00845     <span class="comment">// adjusted_other_operating_income);</span>
00846     AVERAGE_SCHOOL_EX_VAR_INT(other_operating_income);
00847     <span class="comment">// = current_funds_balance * 0.08</span>
00848     AVERAGE_SCHOOL_EX_VAR_INT(interest_on_operating_reserve);
00849     <span class="comment">// =AC=SUM(U1244:AB1244)</span>
00850     AVERAGE_SCHOOL_EX_VAR_INT(total_sources_of_funds);
00851 
00852     <span class="comment">// field AD</span>
00853     <span class="comment">// academic_dept_faculty_salaries</span>
00854     AVERAGE_SCHOOL_EX_VAR_INT(dept_expense_faculty_salaries);
00855     <span class="comment">// = academic_dept_total_salaries - AD</span>
00856     AVERAGE_SCHOOL_EX_VAR_INT(dept_expense_staff_salaries);
00857     AVERAGE_SCHOOL_EX_VAR_INT(dept_expense_other);  <span class="comment">// academic_dept_other_expense</span>
00858     <span class="comment">// sponsored_research_faculty_salaries</span>
00859     AVERAGE_SCHOOL_EX_VAR_INT(sponsored_research_faculty_salaries);
00860     <span class="comment">// = sponsored_research_total_salaries - AG</span>
00861     AVERAGE_SCHOOL_EX_VAR_INT(sponsored_research_staff_salaries);
00862     <span class="comment">// sponsored_research_other</span>
00863     AVERAGE_SCHOOL_EX_VAR_INT(sponsored_research_other);
00864 
00865     <span class="comment">// field AJ</span>
00866     <span class="comment">// library_salaries</span>
00867     AVERAGE_SCHOOL_EX_VAR_INT(library_staff_salaries);
00868     <span class="comment">// library_other_expense</span>
00869     AVERAGE_SCHOOL_EX_VAR_INT(library_other_expense);
00870 
00871     <span class="comment">// = academic_support_salaries * 0.1</span>
00872     AVERAGE_SCHOOL_EX_VAR_INT(academic_it_staff_salaries);
00873     <span class="comment">// = academic_support_other_expense * 0.3</span>
00874     AVERAGE_SCHOOL_EX_VAR_INT(academic_it_other_expense);
00875 
00876     <span class="comment">// field AN</span>
00877     <span class="comment">// student_life_salaries</span>
00878     AVERAGE_SCHOOL_EX_VAR_INT(student_life_staff_salaries);
00879     <span class="comment">// student_life_other_expense</span>
00880     AVERAGE_SCHOOL_EX_VAR_INT(student_life_other_expense);
00881 
00882     <span class="comment">// fields already defined in base class School</span>
00883     <span class="comment">//AVERAGE_SCHOOL_EX_VAR_INT(athletics_salaries);                    // academic_support_salaries</span>
00884     <span class="comment">//AVERAGE_SCHOOL_EX_VAR_INT(athletics_other_expense);                               // academic_support_other_expense</span>
00885 
00886     <span class="comment">// field AR</span>
00887     <span class="comment">// inst_advancement_salaries</span>
00888     AVERAGE_SCHOOL_EX_VAR_INT(inst_advancement_staff_salaries);
00889     <span class="comment">// inst_advancement_other_expense</span>
00890     AVERAGE_SCHOOL_EX_VAR_INT(inst_advancement_other_expense);
00891 
00892     <span class="comment">// inst_support_net_salaries);</span>
00893     AVERAGE_SCHOOL_EX_VAR_INT(administration_staff_salaries);
00894     <span class="comment">// inst_support_net_other_expense);</span>
00895     AVERAGE_SCHOOL_EX_VAR_INT(administration_other_expense);
00896 
00897     <span class="comment">// o_and_m_salaries</span>
00898     AVERAGE_SCHOOL_EX_VAR_INT(o_and_m_staff_salaries);
00899     <span class="comment">// o_and_m_other_expense</span>
00900     AVERAGE_SCHOOL_EX_VAR_INT(o_and_m_other_expense);
00901 
00902     <span class="comment">// field AX</span>
00903     <span class="comment">// academic_support_salaries -AL</span>
00904     AVERAGE_SCHOOL_EX_VAR_INT(other_operating_expense_staff_salaries);
00905     <span class="comment">// academic_support_other_expense -AM</span>
00906     AVERAGE_SCHOOL_EX_VAR_INT(other_operating_expense_other_expense);
00907 
00908     <span class="comment">// = SUM(AD1244:AY1244)</span>
00909     AVERAGE_SCHOOL_EX_VAR_INT(total_operating_expenditure);
00910 
00911     <span class="comment">// field BA</span>
00912     <span class="comment">// (year_end_general_plant_and_residence_hall_debt</span>
00913     AVERAGE_SCHOOL_EX_VAR_INT(service_on_general_plant_debt);
00914     <span class="comment">// -residence_hall_debt)*0.065</span>
00915     <span class="comment">// transfer_to_plant</span>
00916     AVERAGE_SCHOOL_EX_VAR_INT(transfer_to_capital_reserve);
00917     AVERAGE_SCHOOL_EX_VAR_INT(total_uses_of_funds); <span class="comment">// = AZ1244+BA1244+BB1244</span>
00918     AVERAGE_SCHOOL_EX_VAR_INT(surplus_or_deficit);  <span class="comment">// = AC1244-BC1244</span>
00919 
00920     <span class="comment">// field BE</span>
00921     <span class="comment">// = freshmen_from_within_the_state_percent/100.0*in_state_tuition+(1-freshmen_from_within_the_state_percent/100.0)*out_state_tuition</span>
00922     AVERAGE_SCHOOL_EX_VAR_INT_SKIP_ZERO(tuition_rate);
00923     <span class="comment">// room_and_board_charges</span>
00924     AVERAGE_SCHOOL_EX_VAR_SHORT_SKIP_ZERO(room_and_board_rate);
00925     <span class="comment">// ug_in_housing_percent/1000.0</span>
00926     AVERAGE_SCHOOL_EX_VAR_FLOAT(percent_traditional_ug_in_residence_halls);
00927     <span class="comment">// student_get_bacc_in_5_year_percent/1000.0</span>
00928     AVERAGE_SCHOOL_EX_VAR_FLOAT(percent_get_bacc_in_5_year);
00929     <span class="comment">// overhead_rate</span>
00930     AVERAGE_SCHOOL_EX_VAR_CHAR_SKIP_ZERO(overhead_rate_on_sponsored_research);
00931     <span class="comment">// float    endowment_spending_rate);</span>
00932     AVERAGE_SCHOOL_EX_VAR_FLOAT_SKIP_ZERO(endowment_spending_rate);
00933 
00934     <span class="comment">// field BK</span>
00935     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Ofaculty_8h.html#a26a8">FACULTY_RANK_LEVEL_COUNT</a>; i++) {
00936         AVERAGE_SCHOOL_EX_VAR_SHORT(school_faculty_array_ex[i].faculty_count);
00937         AVERAGE_SCHOOL_EX_VAR_INT_SKIP_ZERO(school_faculty_array_ex[i].salary);
00938         AVERAGE_SCHOOL_EX_VAR_FLOAT_SKIP_ZERO(school_faculty_array_ex[i].female_percent);
00939         AVERAGE_SCHOOL_EX_VAR_FLOAT_SKIP_ZERO(school_faculty_array_ex[i].minority_percent);
00940         AVERAGE_SCHOOL_EX_VAR_INT(school_faculty_array_ex[i].active_research_dollars);
00941     }
00942 
00943     <span class="comment">// Enroll ft,pt_ug,etc (Enroll SL1-5);// Enroll ft,pt_ug,etc (Enroll SL1-5);  will be "scaled" later in this function</span>
00944     <span class="comment">// = sPtr-&gt;full_time_undergrad);</span>
00945     AVERAGE_SCHOOL_EX_VAR_SHORT(full_time_undergrad);
00946     <span class="comment">// = sPtr-&gt;part_time_undergrad);</span>
00947     AVERAGE_SCHOOL_EX_VAR_SHORT(part_time_undergrad);
00948     AVERAGE_SCHOOL_EX_VAR_SHORT(enrollment_masters);<span class="comment">// = sPtr-&gt;enrollment_masters);</span>
00949     <span class="comment">// = sPtr-&gt;enrollment_doctoral);</span>
00950     AVERAGE_SCHOOL_EX_VAR_SHORT(enrollment_doctoral);
00951     AVERAGE_SCHOOL_EX_VAR_SHORT(non_degree_seeking);<span class="comment">// = sPtr-&gt;non_degree_seeking</span>
00952 
00953     <span class="comment">// field CM - Percent Female SL1-5</span>
00954     <span class="comment">// = female_undergrad_percent</span>
00955     AVERAGE_SCHOOL_EX_VAR_CHAR_SKIP_ZERO(percent_female_sl[0]);
00956     <span class="comment">// = female_undergrad_percent*1.1</span>
00957     AVERAGE_SCHOOL_EX_VAR_CHAR_SKIP_ZERO(percent_female_sl[1]);
00958     <span class="comment">// = female_grad_and_prof_percent*1.1</span>
00959     AVERAGE_SCHOOL_EX_VAR_CHAR_SKIP_ZERO(percent_female_sl[2]);
00960     <span class="comment">// = female_grad_and_prof_percent*0.75</span>
00961     AVERAGE_SCHOOL_EX_VAR_CHAR_SKIP_ZERO(percent_female_sl[3]);
00962     <span class="comment">// = female_undergrad_percent*0.85</span>
00963     AVERAGE_SCHOOL_EX_VAR_CHAR_SKIP_ZERO(percent_female_sl[4]);
00964 
00965     <span class="comment">// field CR - Percent Minority SL1-5</span>
00966     <span class="comment">// = minority_undergrad_percent*0.85);</span>
00967     AVERAGE_SCHOOL_EX_VAR_CHAR_SKIP_ZERO(percent_minority_sl[0]);
00968     <span class="comment">// = minority_undergrad_percent*1.2);</span>
00969     AVERAGE_SCHOOL_EX_VAR_CHAR_SKIP_ZERO(percent_minority_sl[1]);
00970     <span class="comment">// = minority_grad_and_prof_percent);</span>
00971     AVERAGE_SCHOOL_EX_VAR_CHAR_SKIP_ZERO(percent_minority_sl[2]);
00972     <span class="comment">// = minority_grad_and_prof_percent*0.6);</span>
00973     AVERAGE_SCHOOL_EX_VAR_CHAR_SKIP_ZERO(percent_minority_sl[3]);
00974     <span class="comment">// = minority_undergrad_percent*1.1);</span>
00975     AVERAGE_SCHOOL_EX_VAR_CHAR_SKIP_ZERO(percent_minority_sl[4]);
00976 
00977     <span class="comment">// = freshmen_from_within_the_state_percent</span>
00978     AVERAGE_SCHOOL_EX_VAR_CHAR(percent_instate_freshmen);
00979     <span class="comment">// = non_resident_alien_grad_and_prof_percent);</span>
00980     AVERAGE_SCHOOL_EX_VAR_CHAR_SKIP_ZERO(percent_non_resident_alien_doctoral);
00981 
00982     <span class="comment">//##### begin fred0514 #####</span>
00983     <span class="comment">// fields already defined in base class School</span>
00984     <span class="comment">// field CY</span>
00985     <span class="comment">//for(i=0;i&lt;5;i++)</span>
00986     <span class="comment">//{</span>
00987     <span class="comment">//  AVERAGE_SCHOOL_EX_VAR_SHORT(target_student_intake_sl[i]);</span>
00988     <span class="comment">//  AVERAGE_SCHOOL_EX_VAR_FLOAT(dropout_rate_sl[i]);</span>
00989     <span class="comment">//  AVERAGE_SCHOOL_EX_VAR_FLOAT(target_grad_rate_sl[i]);</span>
00990     <span class="comment">//}</span>
00991     <span class="comment">//##### end fred0514 #####</span>
00992 
00993     <span class="comment">// field DN</span>
00994     AVERAGE_SCHOOL_EX_VAR_INT(ug_applications);     <span class="comment">// = student_applications);</span>
00995     <span class="comment">// = ug_applications/student_accepted);</span>
00996     AVERAGE_SCHOOL_EX_VAR_FLOAT(ug_applications_rate);
00997     AVERAGE_SCHOOL_EX_VAR_CHAR(ug_yield_rate);      <span class="comment">// = float(student_enrolled)/student_accepted*100);</span>
00998 
00999     <span class="comment">// fields already defined in base class School</span>
01000     <span class="comment">//AVERAGE_SCHOOL_EX_VAR_CHAR(percent_ug_students_on_aid);   // = percent_ug_students_on_aid);</span>
01001     <span class="comment">//AVERAGE_SCHOOL_EX_VAR_FLOAT(percent_freshmen_with_need);  // = percent_freshmen_with_need);</span>
01002     <span class="comment">//AVERAGE_SCHOOL_EX_VAR_FLOAT(freshmen_offered_aid);                        // = freshmen_offered_aid);</span>
01003     <span class="comment">//AVERAGE_SCHOOL_EX_VAR_FLOAT(percent_freshmen_offered_full_aid);   // = percent_freshmen_offered_full_aid);</span>
01004     <span class="comment">//AVERAGE_SCHOOL_EX_VAR_SHORT(institutional_aid_per_fte);</span>
01005 
01006     <span class="comment">// err_when(AGRICULTURE);</span>
01007 
01008     <span class="keywordflow">for</span> (<span class="keywordtype">short</span> sl=0; sl&lt;<a class="code" href="Ostudent_8h.html#a1">MAX_STUDENT_LEVEL_INI</a>; sl++)
01009         <span class="keywordflow">for</span> (<span class="keywordtype">short</span> fd=0; fd &lt; <a class="code" href="OFIELD_8H.html#a26a1">IPED_FIELD_COUNT</a>; fd++) {
01010             <span class="comment">// 1020 in latest initial_conds dated 980711, it is AVERAGE!</span>
01011             AVERAGE_SCHOOL_EX_VAR_FLOAT(student_ifield_pct[sl][fd]);
01012         }
01013 
01014 <span class="preprocessor">#ifdef DEBUG_</span>
01015 <span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">short</span> specialOrder[<a class="code" href="OFIELD_8H.html#a26a1">IPED_FIELD_COUNT</a>] = {
01016         <a class="code" href="OFIELD_8H.html#a27a2">AGRICULTURE</a>,<a class="code" href="OFIELD_8H.html#a27a11">INTER_DISCIPLINARY</a>,<a class="code" href="OFIELD_8H.html#a27a4">BUSINESS</a>,<a class="code" href="OFIELD_8H.html#a27a5">COMMUNICAIONS_LIBRARY_SCI</a>,
01017         <a class="code" href="OFIELD_8H.html#a27a13">MATH_COMP_SCI</a>,<a class="code" href="OFIELD_8H.html#a27a6">EDUCATION</a>,<a class="code" href="OFIELD_8H.html#a27a7">ENGINEERING</a>,<a class="code" href="OFIELD_8H.html#a27a8">FOREIGN_LANGUAGES</a>,<a class="code" href="OFIELD_8H.html#a27a9">HEALTH_SOCIAL_SVCS</a>,<a class="code" href="OFIELD_8H.html#a27a10">HUMANITIES</a>,
01018         <a class="code" href="OFIELD_8H.html#a27a12">LIFE_PHYSICAL_SCI</a>,<a class="code" href="OFIELD_8H.html#a27a14">SOCIAL_SCIENCES</a>,<a class="code" href="OFIELD_8H.html#a27a15">VISUAL_PERFORMING_ARTS</a>,<a class="code" href="OFIELD_8H.html#a27a3">BASIC_PERSONAL_PRACTICAL_SVCS</a>
01019     };
01020     <span class="keywordflow">for</span> (<span class="keywordtype">short</span> fd=0; fd&lt;<a class="code" href="OFIELD_8H.html#a26a1">IPED_FIELD_COUNT</a>; fd++) {
01021         <span class="keywordtype">char</span> s[300];
01022         sprintf(s, <span class="stringliteral">"schoolex: average: %f "</span>, player_peer_school-&gt;student_ifield_pct[0][specialOrder[fd]]);
01023         debug_msg(s);
01024     }
01025 <span class="preprocessor">#endif</span>
01026 <span class="preprocessor"></span>
01027     <span class="comment">// 0.0 4.7% 11.7%   9.6%    4.2%    2.9%    11.4%   2.4%    5.0%    10.4%   11.5%   33.4%   5.3%    4.0%</span>
01028 }
01029 
01030 <span class="comment">//--------- End of function SchoolRes::init_player_school_ex ---------//</span>
01031 
01032 <span class="comment">//------ Begin of function sort_school_distance_function ------//</span>
01036 <span class="comment">static int sort_school_distance_function( const void *a, const void *b ) {</span>
01037 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
01038 <span class="preprocessor"></span>    <span class="keywordtype">float</span> distanceA = school_res.desired_school_array[*((<span class="keywordtype">short</span>*)a)].distance_value;
01039     <span class="keywordtype">float</span> distanceB = school_res.desired_school_array[*((<span class="keywordtype">short</span>*)b)].distance_value;
01040 <span class="preprocessor">#else</span>
01041 <span class="preprocessor"></span>    <span class="keywordtype">float</span> distanceA = school_res.get_db_school(*((<span class="keywordtype">short</span>*)a))-&gt;distance_value;
01042     <span class="keywordtype">float</span> distanceB = school_res.get_db_school(*((<span class="keywordtype">short</span>*)b))-&gt;distance_value;
01043 <span class="preprocessor">#endif</span>
01044 <span class="preprocessor"></span>
01045     <span class="keywordtype">float</span> rc = distanceA-distanceB;
01046 
01047     <span class="keywordflow">if</span>( rc &gt; 0 )
01048         <span class="keywordflow">return</span> 1;
01049     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( rc &lt; 0 )
01050         <span class="keywordflow">return</span> -1;
01051     <span class="keywordflow">else</span>
01052         <span class="keywordflow">return</span> 0;
01053 }
01054 
01055 <span class="comment">//------- End of function sort_school_distance_function ------//</span>
01056 
01057 <span class="comment">//------ Begin of function sort_peerschool_prestige_function ------//</span>
01061 <span class="comment">static int sort_peerschool_prestige_function( const void *a, const void *b ) {</span>
01062 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
01063 <span class="preprocessor"></span>    <span class="keywordtype">float</span> prestigeA = school_res.desired_school_array[*((<span class="keywordtype">short</span>*)a)].prestige;
01064     <span class="keywordtype">float</span> prestigeB = school_res.desired_school_array[*((<span class="keywordtype">short</span>*)b)].prestige;
01065 <span class="preprocessor">#else</span>
01066 <span class="preprocessor"></span>    <span class="keywordtype">float</span> prestigeA = school_res.get_db_school(*((<span class="keywordtype">short</span>*)a))-&gt;prestige;
01067     <span class="keywordtype">float</span> prestigeB = school_res.get_db_school(*((<span class="keywordtype">short</span>*)b))-&gt;prestige;
01068 <span class="preprocessor">#endif</span>
01069 <span class="preprocessor"></span>
01070     <span class="keywordtype">float</span> rc = prestigeA - prestigeB;
01071 
01072     <span class="keywordflow">if</span>( rc &gt; 0 )
01073         <span class="keywordflow">return</span> 1;
01074     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( rc &lt; 0 )
01075         <span class="keywordflow">return</span> -1;
01076     <span class="keywordflow">else</span>
01077         <span class="keywordflow">return</span> 0;
01078 }
01079 
01080 <span class="comment">//------- End of function sort_peerschool_prestige_function ------//</span>
01081 
01082 <span class="comment">//------- Begin of function SchoolRes::get_db_school -------//</span>
01084 <span class="comment">#ifdef DEBUG</span>
01085 <a class="code" href="classSchool.html">School</a>* <a class="code" href="classSchoolRes.html#a6">SchoolRes::get_db_school</a>(<span class="keywordtype">int</span> recno) {
01086     <a class="code" href="ALL_8H.html#a0">err_when</a>( recno &lt; 1 || recno &gt; <a class="code" href="classSchoolRes.html#m0">db_school_count</a> );
01087 
01088     <span class="keywordflow">return</span> <a class="code" href="classSchoolRes.html#m1">db_school_array</a>+recno-1;
01089 }
01090 <span class="preprocessor">#endif</span>
01091 <span class="preprocessor"></span><span class="comment">//--------- End of function SchoolRes::get_db_school ---------//</span>
01092 
01093 <span class="comment">//-------- Begin of function SchoolRes::build_peer_school_array --------//</span>
01097 <span class="comment">void SchoolRes::build_peer_school_array() {</span>
01098     <span class="keywordtype">int</span> i, recno;
01099     <span class="keywordtype">float</span> distanceDeviation = 0.0f;
01100     <span class="keywordtype">float</span> distanceAverage = 0.0f;
01101 
01102 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
01103 <span class="preprocessor"></span>    <a class="code" href="classSchool.html">School</a> *sPtr = desired_school_array;
01104 
01105     <span class="comment">//</span>
01106     <span class="comment">//--- calculate standard deviation of distance in db_school_array ---//</span>
01107     <span class="comment">//</span>
01108     <span class="keywordflow">for</span>( recno=1; recno&lt;=desired_school_count; recno++ ) {
01109         distanceAverage += desired_school_array[recno-1].<a class="code" href="classSchool.html#m131">distance_value</a>;
01110     }
01111     distanceAverage /= desired_school_count;
01112 
01113     <span class="keywordflow">for</span>( recno=1; recno&lt;=desired_school_count; recno++ )
01114         distanceDeviation += <a class="code" href="Oschlres_8cpp.html#a0">EXPO2</a>(desired_school_array[recno-1].distance_value - distanceAverage);
01115     distanceDeviation /= desired_school_count;
01116     distanceDeviation = sqrtf(distanceDeviation);
01117 
01118     <span class="comment">// distanceDeviation = 0.3f;        // 0.483f;</span>
01119 <span class="preprocessor">#else</span>
01120 <span class="preprocessor"></span>    <a class="code" href="classSchool.html">School</a> *sPtr = db_school_array;
01121 
01122     <span class="comment">//</span>
01123     <span class="comment">//--- calculate standard deviation of distance in db_school_array ---//</span>
01124     <span class="comment">//</span>
01125     <span class="keywordflow">for</span>( recno=1; recno&lt;=db_school_count; recno++ ) {
01126         distanceAverage += db_school_array[recno-1].<a class="code" href="classSchool.html#m131">distance_value</a>;
01127     }
01128     distanceAverage /= db_school_count;
01129 
01130     <span class="keywordflow">for</span>( recno=1; recno&lt;=db_school_count; recno++ )
01131         distanceDeviation += <a class="code" href="Oschlres_8cpp.html#a0">EXPO2</a>(db_school_array[recno-1].distance_value - distanceAverage);
01132     distanceDeviation /= db_school_count;
01133     distanceDeviation = sqrtf(distanceDeviation);
01134 
01135     <span class="comment">// distanceDeviation = 0.3f;        // 0.483f;</span>
01136 <span class="preprocessor">#endif</span>
01137 <span class="preprocessor"></span>
01138     <span class="comment">//</span>
01139     <span class="comment">//--- select school in db_school_array ---//</span>
01140     <span class="comment">//</span>
01141     <a class="code" href="classDynArray.html">DynArray</a>    peerRecnoArr(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), 20);
01142 
01143     <span class="comment">// C = 0.1 is proposed by Bill in email on 0531</span>
01144     <span class="keyword">const</span> <span class="keywordtype">float</span> C = 0.1f;                           <span class="comment">// number of deviation in screening range</span>
01145     <span class="keyword">const</span> <span class="keywordtype">float</span> screenRange = player_peer_school-&gt;distance_value + C * distanceDeviation;
01146     <span class="keywordtype">int</span> count = 0;
01147 
01148 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
01149 <span class="preprocessor"></span>    sPtr = desired_school_array;
01150     <span class="keywordflow">for</span>( recno=0; recno&lt;desired_school_count ; recno++, sPtr++ ) {
01151         <span class="keywordflow">if</span> ( sPtr-&gt;<a class="code" href="classSchool.html#m131">distance_value</a> &lt; screenRange ) {
01152             peerRecnoArr.<a class="code" href="classDynArray.html#a4">linkin</a>((<span class="keywordtype">void</span> *) &amp;recno);
01153 
01154             <span class="keywordflow">if</span>( ++count == <a class="code" href="OSCHLRES_8H.html#a1">MAX_PEER_SCHOOL_COUNT</a> )
01155                 <span class="keywordflow">break</span>;
01156         }
01157     }
01158 <span class="preprocessor">#else</span>
01159 <span class="preprocessor"></span>    sPtr = db_school_array;
01160     <span class="keywordflow">for</span>( recno=1; recno&lt;=db_school_count ; recno++, sPtr++ ) {
01161         <span class="keywordflow">if</span> ( sPtr-&gt;<a class="code" href="classSchool.html#m131">distance_value</a> &lt; screenRange ) {
01162             peerRecnoArr.<a class="code" href="classDynArray.html#a4">linkin</a>((<span class="keywordtype">void</span> *) &amp;recno);
01163 
01164             <span class="keywordflow">if</span>( ++count == <a class="code" href="OSCHLRES_8H.html#a1">MAX_PEER_SCHOOL_COUNT</a> )
01165                 <span class="keywordflow">break</span>;
01166         }
01167     }
01168 <span class="preprocessor">#endif</span>
01169 <span class="preprocessor"></span>
01170     peer_school_count = peerRecnoArr.<a class="code" href="classDynArray.html#a28">size</a>();
01171 
01172     <span class="comment">//</span>
01173     <span class="comment">//---sort the peer_school_array---//</span>
01174     <span class="comment">//</span>
01175 
01176     <span class="comment">//---- create an array for sorting on prestige ----//</span>
01177 
01178     <span class="keywordtype">short</span>* schoolSortArray = (<span class="keywordtype">short</span>*) <a class="code" href="ALL_8H.html#a5">mem_add</a>( peer_school_count * <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>) );
01179 
01180     <span class="keywordflow">for</span>( i=1; i&lt;=peer_school_count; i++ ) {
01181         schoolSortArray[i-1] = *((<span class="keywordtype">int</span> *) peerRecnoArr.<a class="code" href="classDynArray.html#a13">get</a>(i));
01182 
01183 <span class="preprocessor">#ifdef DEBUG_PEER</span>
01184 <span class="preprocessor"></span>        <span class="keywordtype">char</span> s[100];
01185         recno = *((<span class="keywordtype">int</span> *) peerRecnoArr.<a class="code" href="classDynArray.html#a13">get</a>(i));
01186 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
01187 <span class="preprocessor"></span>        sprintf(s, <span class="stringliteral">"b4 sort: recno/prestige/distance #%d = %d   %f   %f"</span>, i, recno, desired_school_array[recno-1].prestige, desired_school_array[recno-1].distance_value);
01188 <span class="preprocessor">#else</span>
01189 <span class="preprocessor"></span>        sprintf(s, <span class="stringliteral">"b4 sort: recno/prestige/distance #%d = %d   %f   %f"</span>, i, recno, db_school_array[recno-1].prestige, db_school_array[recno-1].distance_value);
01190 <span class="preprocessor">#endif</span>
01191 <span class="preprocessor"></span>        <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(s);
01192 <span class="preprocessor">#endif</span>
01193 <span class="preprocessor"></span>    }
01194 
01195     <span class="comment">//---- sort School in array[] by prestige ----//</span>
01196     qsort( schoolSortArray, peer_school_count, <span class="keyword">sizeof</span>(schoolSortArray[0]), sort_peerschool_prestige_function );
01197 
01198     <span class="comment">//</span>
01199     <span class="comment">//---create PeerSchool records in peer_school_array---//</span>
01200     <span class="comment">//</span>
01201     peer_school_array = (<a class="code" href="classPeerSchool.html">PeerSchool</a>*) <a class="code" href="ALL_8H.html#a5">mem_add</a>( <span class="keyword">sizeof</span>(<a class="code" href="classPeerSchool.html">PeerSchool</a>) * (peer_school_count+1) );
01202     <a class="code" href="classPeerSchool.html">PeerSchool</a> *psPtr = peer_school_array;
01203     <span class="keywordtype">bool</span> isPlayerAdded = <span class="keyword">false</span>;
01204 
01205     <span class="comment">// loop through schoolSortArray</span>
01206     <span class="keywordflow">for</span> ( i=0; i&lt;peer_school_count; i++, psPtr++) {
01207         recno = schoolSortArray[i];
01208 
01209 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
01210 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ( !isPlayerAdded &amp;&amp; desired_school_array[recno].<a class="code" href="classSchool.html#m130">prestige</a> &gt; player_peer_school-&gt;prestige )
01211 <span class="preprocessor">#else</span>
01212 <span class="preprocessor"></span>            <span class="keywordflow">if</span> ( !isPlayerAdded &amp;&amp; db_school_array[recno-1].<a class="code" href="classSchool.html#m130">prestige</a> &gt; player_peer_school-&gt;prestige )
01213 <span class="preprocessor">#endif</span>
01214 <span class="preprocessor"></span>            {
01215                 <span class="comment">// insert player_school to the peer_school_array</span>
01216                 <span class="comment">// then deallocate memory pointed by player_peer_school</span>
01217 
01218                 <span class="comment">// if player_peer_school-&gt;prestige is the largest, this segment is not run, see segment after for loop</span>
01219                 psPtr-&gt;<a class="code" href="classPeerSchool.html#a0">init</a>(-1);
01220 
01221                 memcpy(psPtr, player_peer_school, <span class="keyword">sizeof</span>(<a class="code" href="classPeerSchool.html">PeerSchool</a>));
01222                 <a class="code" href="ALL_8H.html#a8">mem_del</a>(player_peer_school);
01223                 player_peer_school = psPtr;
01224 
01225                 psPtr++;
01226                 isPlayerAdded = <span class="keyword">true</span>;
01227                 <span class="comment">//psPtr-&gt;init(recno);           // 1008</span>
01228                 <span class="comment">//continue;</span>
01229             }
01230 
01231         <span class="comment">//psPtr-&gt;init(db_school_array+recno-1);</span>
01232         psPtr-&gt;<a class="code" href="classPeerSchool.html#a0">init</a>(recno);
01233 
01234         <span class="comment">//--------- assign a new name from made-up names database PEERNAME.DBF  ---//</span>
01235 
01236         <span class="keywordtype">int</span> loopCount=0;
01237 
01238         <span class="keywordflow">while</span>(1) {
01239             <a class="code" href="ALL_8H.html#a0">err_when</a>( loopCount++ &gt; 10000 );
01240 
01241             <span class="keywordtype">int</span> peerId = m.random(peer_info_count);
01242 
01243             <span class="comment">//--- filter out duplication -----//</span>
01244 
01245             <span class="keywordtype">char</span>* newName = peer_info_array[peerId].name;
01246 
01247             <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j=0; j&lt;peer_school_count; j++ ) {
01248                 <span class="keywordflow">if</span>( strcmp( peer_school_array[j].name, newName )==0 )
01249                     <span class="keywordflow">break</span>;
01250             }
01251 
01252             <span class="keywordflow">if</span>( j&lt;peer_school_count )                   <span class="comment">// duplicated.</span>
01253                 <span class="keywordflow">continue</span>;
01254 
01255             <span class="comment">//-------- set the peer name now -------------//</span>
01256 
01257             strcpy(psPtr-&gt;<a class="code" href="classSchool.html#m0">name</a>, newName);
01258             <span class="keywordflow">break</span>;
01259         }
01260 
01261 <span class="preprocessor">#ifdef DEBUG_PEER</span>
01262 <span class="preprocessor"></span>        <span class="keywordtype">char</span> s[100];
01263         sprintf(s, <span class="stringliteral">"af sort: recno/prestige/distance %d = %d   %f   %f"</span>, i+1, recno, psPtr-&gt;<a class="code" href="classSchool.html#m130">prestige</a>, psPtr-&gt;<a class="code" href="classSchool.html#m131">distance_value</a>);
01264         <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(s);
01265 <span class="preprocessor">#endif</span>
01266 <span class="preprocessor"></span>    }
01267 
01268     <span class="comment">// ##### begin Gilbert 16/01/2002 #####//</span>
01269     <span class="comment">// fix in version 2 but also apply for version 1</span>
01270     <span class="comment">// if player_peer_school has the largest prestige, it was not added to peer_school_array</span>
01271     <span class="keywordflow">if</span>( !isPlayerAdded ) {
01272         psPtr-&gt;<a class="code" href="classPeerSchool.html#a0">init</a>(-1);
01273 
01274         memcpy(psPtr, player_peer_school, <span class="keyword">sizeof</span>(<a class="code" href="classPeerSchool.html">PeerSchool</a>));
01275         <a class="code" href="ALL_8H.html#a8">mem_del</a>(player_peer_school);
01276         player_peer_school = psPtr;
01277 
01278         psPtr++;
01279         isPlayerAdded = <span class="keyword">true</span>;
01280     }
01281     <span class="comment">// ##### end Gilbert 16/01/2002 #####//</span>
01282 
01283     peer_school_count++;                            <span class="comment">// include the player school</span>
01284     <a class="code" href="ALL_8H.html#a8">mem_del</a>( schoolSortArray );                     <span class="comment">// sorting finished</span>
01285 
01286     <span class="comment">//----------------------------//</span>
01287     <span class="comment">// 1029 // see WFM Notes, 19 Sept, section5.4</span>
01288 
01289     memset(<a class="code" href="classPeerSchool.html#p2">PeerSchool::average_faculty_salary</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="classPeerSchool.html#p2">PeerSchool::average_faculty_salary</a>));
01290 
01291     psPtr = peer_school_array;
01292 
01293     <span class="keywordflow">for</span> ( i=0; i&lt;peer_school_count; i++, psPtr++) {
01294         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> r=0; r&lt;<a class="code" href="Ofaculty_8h.html#a26a8">FACULTY_RANK_LEVEL_COUNT</a>; r++) {
01295             <span class="comment">// 51: full professor: middle age group</span>
01296             <a class="code" href="classPeerSchool.html#p2">PeerSchool::average_faculty_salary</a>[<a class="code" href="classFaculty.html#a2">Faculty::rank_age_group</a>(r, 51)] += psPtr-&gt;<a class="code" href="classSchoolEx.html#m50">school_faculty_array_ex</a>[r].<a class="code" href="structSchoolFaculty.html#m1">salary</a>;
01297         }
01298     }
01299 
01300     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> r=0; r&lt;<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>; r++)
01301         <a class="code" href="classPeerSchool.html#p2">PeerSchool::average_faculty_salary</a>[r] /= peer_school_count;
01302 
01303     <span class="comment">//------------------//</span>
01304 
01305     <span class="keywordtype">int</span> lowFullProf = <a class="code" href="classFaculty.html#a2">Faculty::rank_age_group</a>(<a class="code" href="Ofaculty_8h.html#a27a11">FULL_PROF</a>, 41);
01306     <span class="keywordtype">int</span> midFullProf = <a class="code" href="classFaculty.html#a2">Faculty::rank_age_group</a>(<a class="code" href="Ofaculty_8h.html#a27a11">FULL_PROF</a>, 51);
01307     <span class="keywordtype">int</span> highFullProf = <a class="code" href="classFaculty.html#a2">Faculty::rank_age_group</a>(<a class="code" href="Ofaculty_8h.html#a27a11">FULL_PROF</a>, 61);
01308 
01309     <span class="keywordtype">char</span> templateCode[1] = { <a class="code" href="Ofacures_8h.html#a4">FIRST_TEMPLATE_CODE</a> };
01310     <a class="code" href="structFacultyTemplate.html">FacultyTemplate</a>* facultyTemplate = faculty_res.get_faculty_template( templateCode, lowFullProf );
01311     <a class="code" href="structFacultyTemplate.html">FacultyTemplate</a>* facultyTemplate2 = faculty_res.get_faculty_template( templateCode, midFullProf );
01312     <a class="code" href="structFacultyTemplate.html">FacultyTemplate</a>* facultyTemplate3 = faculty_res.get_faculty_template( templateCode, highFullProf );
01313 
01314     <span class="keywordtype">float</span> lowRatio = float(facultyTemplate-&gt;<a class="code" href="structFacultyTemplate.html#m5">overall_salary_multiplier</a>) / facultyTemplate2-&gt;<a class="code" href="structFacultyTemplate.html#m5">overall_salary_multiplier</a>;
01315     <span class="keywordtype">float</span> highRatio = float(facultyTemplate3-&gt;<a class="code" href="structFacultyTemplate.html#m5">overall_salary_multiplier</a>) / facultyTemplate2-&gt;<a class="code" href="structFacultyTemplate.html#m5">overall_salary_multiplier</a>;
01316 
01317     <a class="code" href="classPeerSchool.html#p2">PeerSchool::average_faculty_salary</a>[lowFullProf] = int(lowRatio * <a class="code" href="classPeerSchool.html#p2">PeerSchool::average_faculty_salary</a>[midFullProf]);
01318     <a class="code" href="classPeerSchool.html#p2">PeerSchool::average_faculty_salary</a>[highFullProf] = int(highRatio * <a class="code" href="classPeerSchool.html#p2">PeerSchool::average_faculty_salary</a>[midFullProf]);
01319 
01320     <span class="comment">//-----------------//</span>
01321     <span class="comment">// 0130 scenario(2)</span>
01322 
01323     <span class="keywordflow">if</span> ( player_school.scenario_id == <a class="code" href="Opschool_8h.html#a63a22">SCN_RAISE_SALARY</a> ) {
01324         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> r=0; r&lt;<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>; r++)
01325             <a class="code" href="classPeerSchool.html#p2">PeerSchool::average_faculty_salary</a>[r] = int(<a class="code" href="classPeerSchool.html#p2">PeerSchool::average_faculty_salary</a>[r] * 1.1);
01326     }
01327 }
01328 
01329 <span class="comment">//-------- End of function SchoolRes::build_peer_school_array --------//</span>
01330 
01331 <span class="comment">//-------- Begin of function SchoolRes::next_day --------//</span>
<a name="l01335"></a><a class="code" href="classSchoolRes.html#a5">01335</a> <span class="comment">void  SchoolRes::next_day() {</span>
01336     <span class="comment">// per year</span>
01337     <span class="keywordflow">if</span> ( info.game_day == 1  &amp;&amp; info.game_month == finance.fiscal_year_start_month )
01338         <a class="code" href="classPeerSchool.html#d1">PeerSchool::calc_average_faculty_salary</a>();
01339 }
01340 
01341 <span class="comment">//-------- End of function SchoolRes::next_day --------//</span>
01342 
01343 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
01344 <span class="preprocessor"></span>
01345 <span class="comment">// --- Begin of function SchoolRes::get_desired_school_array --- //</span>
01346 <span class="comment">//</span>
01347 <span class="keywordtype">void</span> SchoolRes::get_desired_school_array() {
01348     <span class="keywordtype">short</span> numCount=0;
01349 
01350     <span class="comment">// get the number count of school are in desired type</span>
01351     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classSchoolRes.html#m0">db_school_count</a>; i++ ) {
01352         <span class="comment">// they are in desired type</span>
01353         <span class="keywordflow">if</span> ( <a class="code" href="classSchoolRes.html#a6">get_db_school</a>(i+1)-&gt;<a class="code" href="classSchool.html#m2">control</a> == player_school.control ) {
01354             numCount++;
01355         }
01356     }
01357 
01358     desired_school_count = numCount;
01359     desired_school_array = (<a class="code" href="classSchool.html">School</a>*) <a class="code" href="ALL_8H.html#a5">mem_add</a>( <span class="keyword">sizeof</span>(<a class="code" href="classSchool.html">School</a>) * desired_school_count );
01360 
01361     numCount = 0;
01362     <span class="comment">// copy the desired school into desired_school_array</span>
01363     <span class="keywordflow">for</span> ( i=0; i&lt;<a class="code" href="classSchoolRes.html#m0">db_school_count</a>; i++ ) {
01364         <span class="comment">// if they are in desired type</span>
01365         <span class="keywordflow">if</span> ( <a class="code" href="classSchoolRes.html#a6">get_db_school</a>(i+1)-&gt;<a class="code" href="classSchool.html#m2">control</a> == player_school.control ) {
01366             memcpy( &amp;desired_school_array[numCount], <a class="code" href="classSchoolRes.html#a6">get_db_school</a>(i+1), <span class="keyword">sizeof</span>(<a class="code" href="classSchool.html">School</a>) );
01367             desired_school_array[numCount].desired_recno = i+1;
01368             numCount++;
01369         }
01370     }
01371 }
01372 
01373 <span class="comment">//</span>
01374 <span class="comment">// --- End of function SchoolRes::get_desired_school_array --- //</span>
01375 
01376 <span class="comment">// --- Begin of function SchoolRes::get_50_school_array --- //</span>
01377 <span class="comment">//</span>
01378 <span class="keywordtype">void</span> SchoolRes::get_50_school_array() {
01379     <span class="comment">// save the  of desired_school_array into schoolSortArray for sorting function</span>
01380     <span class="keywordtype">short</span>*  schoolSortArray = (<span class="keywordtype">short</span>*) <a class="code" href="ALL_8H.html#a5">mem_add</a>( desired_school_count * <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>) );
01381 
01382     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=0; i&lt;desired_school_count; i++ )
01383         schoolSortArray[i] = i;
01384 
01385   <span class="comment">// quick sort the desired array</span>
01386     qsort( schoolSortArray, desired_school_count, <span class="keyword">sizeof</span>(schoolSortArray[0]), sort_school_distance_function );
01387 
01388     <span class="comment">// copy the first 50 schools into desired_school_array</span>
01389     <span class="keywordtype">short</span>*  tempSchoolRecnoArray = (<span class="keywordtype">short</span>*) <a class="code" href="ALL_8H.html#a5">mem_add</a>( <a class="code" href="OSCHLRES_8H.html#a2">MAX_FIRST_SCHOOL</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>) );
01390     <span class="keywordflow">for</span> ( i=0; i&lt;<a class="code" href="OSCHLRES_8H.html#a2">MAX_FIRST_SCHOOL</a>; i++ )
01391         tempSchoolRecnoArray[i] = desired_school_array[schoolSortArray[i]].desired_recno;
01392     <span class="keywordflow">for</span> ( i=0; i&lt;<a class="code" href="OSCHLRES_8H.html#a2">MAX_FIRST_SCHOOL</a>; i++ ) {
01393         memcpy( &amp;desired_school_array[i], <a class="code" href="classSchoolRes.html#a6">get_db_school</a>(tempSchoolRecnoArray[i]), <span class="keyword">sizeof</span>(<a class="code" href="classSchool.html">School</a>) );
01394         desired_school_array[i].desired_recno = tempSchoolRecnoArray[i];
01395     }
01396 
01397     <span class="comment">// resize the desired_school_count and also the desired_school_array</span>
01398     desired_school_count = <a class="code" href="OSCHLRES_8H.html#a2">MAX_FIRST_SCHOOL</a>;
01399 
01400     desired_school_array = (<a class="code" href="classSchool.html">School</a>*) <a class="code" href="ALL_8H.html#a7">mem_resize</a>( desired_school_array, <span class="keyword">sizeof</span>(<a class="code" href="classSchool.html">School</a>) * desired_school_count );
01401 
01402     <a class="code" href="ALL_8H.html#a8">mem_del</a>(schoolSortArray);
01403     <a class="code" href="ALL_8H.html#a8">mem_del</a>(tempSchoolRecnoArray);
01404 }
01405 
01406 <span class="comment">//</span>
01407 <span class="comment">// --- End of function SchoolRes::get_50_school_array --- //</span>
01408 <span class="preprocessor">#endif</span>
01409 <span class="preprocessor"></span>
01410 <span class="comment">//-------- Begin of static function PeerSchool::calc_average_faculty_salary--------//</span>
01411 <span class="comment">//</span>
01412 <span class="comment">// see WFM Notes, 10 or 19 Sept, section5.4</span>
01413 <span class="comment">//</span>
<a name="l01414"></a><a class="code" href="classPeerSchool.html#p2">01414</a> <span class="keywordtype">int</span> <a class="code" href="classPeerSchool.html#p2">PeerSchool::average_faculty_salary</a>[<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>];
01415 
<a name="l01416"></a><a class="code" href="classPeerSchool.html#d1">01416</a> <span class="keywordtype">void</span>  <a class="code" href="classPeerSchool.html#d1">PeerSchool::calc_average_faculty_salary</a>() {
01417     <span class="comment">// req28a_time_variation.txt</span>
01418     <span class="keywordtype">float</span>       initValue = math.get_random_snd(.01f, .0025f);
01419     <span class="keyword">static</span> <span class="keywordtype">float</span> gen_rand[<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>] = {initValue,initValue,initValue,initValue,initValue,initValue,initValue};
01420     <span class="keyword">static</span> <span class="keywordtype">float</span> gen_rand_last2[<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>] = {0.01f,0.01f,0.01f,0.01f,0.01f,0.01f,0.01f};
01421 
01422     initValue = math.get_random_snd(.01f, .005f);   <span class="comment">// req28a_time_variation.txt</span>
01423     <span class="keyword">static</span> <span class="keywordtype">float</span> spec_rand[<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>] = {initValue,initValue,initValue,initValue,initValue,initValue,initValue};
01424     <span class="keyword">static</span> <span class="keywordtype">float</span> spec_rand_last2[<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>] = {0.01f,0.01f,0.01f,0.01f,0.01f,0.01f,0.01f};
01425 
01426     <span class="comment">// initialize static var: int average_faculty_salary[MAX_RANK_AGE_GROUP];   // not $000</span>
01427     <span class="keywordtype">float</span> inflationRate = float(finance.inflation_rate) / 100.0f;
01428 
01429     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>; i++) {
01430         <span class="keywordtype">float</span> lastGen = gen_rand[i];
01431         <span class="keywordtype">float</span> lastSpec = spec_rand[i];
01432 
01433         gen_rand[i] = math.time_variation(lastGen, gen_rand_last2[i], 1.5147f, -0.7647f, 0.001250360f);
01434         spec_rand[i] = math.time_variation(lastSpec, spec_rand_last2[i], 1.0643f, -0.7285f, 0.001660440f);
01435 
01436         gen_rand_last2[i] = lastGen;
01437         spec_rand_last2[i] = lastSpec;
01438 
01439         <a class="code" href="classPeerSchool.html#p2">average_faculty_salary</a>[i] = int( <a class="code" href="classPeerSchool.html#p2">average_faculty_salary</a>[i] * (1+inflationRate+gen_rand[i]+spec_rand[i]) );
01440     }
01441 }
01442 
01443 <span class="comment">//-------- End of static function PeerSchool::calc_average_faculty_salary--------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:20 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
