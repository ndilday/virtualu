<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OVGALOCK.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>OVGALOCK.CPP</h1><a href="OVGALOCK_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">// Filename    : OVGALOCK.CPP</span>
00002 <span class="comment">// Description : object to vga_front.temp_unlock and temp_restore_lock</span>
00003 <span class="comment">// Onwer       : Gilbert Luis</span>
00004 <span class="comment">// Mainly used by ODPLAY.CPP to separate OVGA.H</span>
00005 <span class="comment">// some GUID initialization problems exist if OVGA.H is included in ODPLAY.CPP</span>
00006 
00007 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00008 <span class="preprocessor">#include &lt;<a class="code" href="OVGALOCK_8H.html">OVGALOCK.H</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;OVGABUF.H&gt;</span>
00010 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00011 <span class="preprocessor">#include &lt;<a class="code" href="OFILE_8H.html">OFILE.H</a>&gt;</span>
00012 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00013 
<a name="l00014"></a><a class="code" href="classVgaFrontLock.html#a0">00014</a> <a class="code" href="classVgaFrontLock.html#a0">VgaFrontLock::VgaFrontLock</a>() {
00015     <span class="keywordflow">if</span>( vga_front.dd_buf )
00016         vga_front.temp_unlock();
00017 }
00018 
<a name="l00019"></a><a class="code" href="classVgaFrontLock.html#a1">00019</a> <a class="code" href="classVgaFrontLock.html#a1">VgaFrontLock::~VgaFrontLock</a>() {
00020     <span class="keywordflow">if</span>( vga_front.dd_buf )
00021         vga_front.temp_restore_lock();
00022 }
00023 
<a name="l00024"></a><a class="code" href="classVgaFrontLock.html#a2">00024</a> <span class="keywordtype">void</span> <a class="code" href="classVgaFrontLock.html#a2">VgaFrontLock::re_lock</a>() {
00025     <span class="keywordflow">if</span>( vga_front.dd_buf )
00026         vga_front.temp_restore_lock();
00027 }
00028 
<a name="l00029"></a><a class="code" href="classVgaFrontLock.html#a3">00029</a> <span class="keywordtype">void</span> <a class="code" href="classVgaFrontLock.html#a3">VgaFrontLock::re_unlock</a>() {
00030     <span class="keywordflow">if</span>( vga_front.dd_buf )
00031         vga_front.temp_unlock();
00032 }
00033 
<a name="l00034"></a><a class="code" href="classVgaCustomPalette.html#a0">00034</a> <a class="code" href="classVgaCustomPalette.html#a0">VgaCustomPalette::VgaCustomPalette</a>(<span class="keywordtype">char</span> *fileName) {
00035     backup_pal = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00036     <span class="keywordflow">if</span>( save_palette() &amp;&amp; fileName)
00037         <a class="code" href="classVgaCustomPalette.html#d0">set_custom_palette</a>(fileName);
00038 }
00039 
<a name="l00040"></a><a class="code" href="classVgaCustomPalette.html#a1">00040</a> <a class="code" href="classVgaCustomPalette.html#a1">VgaCustomPalette::~VgaCustomPalette</a>() {
00041     restore_palette();
00042     <span class="keywordflow">if</span>( backup_pal)
00043         <a class="code" href="ALL_8H.html#a8">mem_del</a>(backup_pal);
00044 }
00045 
00046 <span class="keywordtype">int</span> VgaCustomPalette::save_palette() {
00047     <span class="comment">// ------ allocate space --------//</span>
00048     <span class="keywordflow">if</span>( !backup_pal )
00049         backup_pal = <a class="code" href="ALL_8H.html#a5">mem_add</a>( <span class="keyword">sizeof</span>(PALETTEENTRY) * 256);
00050 
00051   <span class="comment">// ------- get current palette --------//</span>
00052     <span class="keywordflow">if</span>( vga.dd_pal-&gt;GetEntries(0, 0, 256, (PALETTEENTRY *)backup_pal) ) {
00053         <span class="comment">// get palette fail, free backup_pal to indicate save_palette failed</span>
00054         <a class="code" href="ALL_8H.html#a8">mem_del</a>(backup_pal);
00055         backup_pal = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00056         <span class="keywordflow">return</span> 0;
00057     }
00058     <span class="keywordflow">else</span>
00059         <span class="keywordflow">return</span> 1;
00060 }
00061 
<a name="l00062"></a><a class="code" href="classVgaCustomPalette.html#d0">00062</a> <span class="keywordtype">int</span> <a class="code" href="classVgaCustomPalette.html#d0">VgaCustomPalette::set_custom_palette</a>(<span class="keywordtype">char</span> *fileName) {
00063     PALETTEENTRY palEntry[256];
00064     <span class="keywordtype">char</span> palBuf[256][3];
00065     <a class="code" href="classFile.html">File</a> palFile;
00066 
00067     palFile.<a class="code" href="classFile.html#a2">file_open</a>(fileName);
00068     palFile.<a class="code" href="classFile.html#a7">file_seek</a>(8);                           <span class="comment">// bypass the header info</span>
00069     palFile.<a class="code" href="classFile.html#a9">file_read</a>(palBuf, 256*3);
00070     palFile.<a class="code" href="classFile.html#a5">file_close</a>();
00071 
00072     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;256; i++) {
00073         palEntry[i].peRed   = palBuf[i][0];
00074         palEntry[i].peGreen = palBuf[i][1];
00075         palEntry[i].peBlue  = palBuf[i][2];
00076         palEntry[i].peFlags = 0;
00077     }
00078 
00079     <span class="keywordflow">return</span> !vga.dd_pal-&gt;SetEntries(0, 0, 256, palEntry);
00080 }
00081 
00082 <span class="keywordtype">int</span> VgaCustomPalette::restore_palette() {
00083     <span class="keywordflow">if</span>( backup_pal)
00084         <span class="keywordflow">return</span> !vga.dd_pal-&gt;SetEntries(0, 0, 256, (PALETTEENTRY *)backup_pal);
00085     <span class="keywordflow">else</span>
00086         <span class="keywordflow">return</span> 1;
00087 }
00088 
<a name="l00089"></a><a class="code" href="classMouseDispCount.html#a0">00089</a> <a class="code" href="classMouseDispCount.html#a0">MouseDispCount::MouseDispCount</a>() {
00090     <span class="comment">// set cursor position</span>
00091     SetCursorPos( mouse.cur_x, mouse.cur_y);
00092 
00093   <span class="comment">// show cursor</span>
00094     mouse.hide();
00095     <span class="comment">// #### patch begin Gilbert 9/1 #######//</span>
00096     vga_front.temp_unlock();
00097     <span class="comment">// #### patch end Gilbert 9/1 #######//</span>
00098     ShowCursor(TRUE);
00099 }
00100 
<a name="l00101"></a><a class="code" href="classMouseDispCount.html#a1">00101</a> <a class="code" href="classMouseDispCount.html#a1">MouseDispCount::~MouseDispCount</a>() {
00102     <span class="comment">// set cursor position</span>
00103     POINT winMousePos;
00104     GetCursorPos(&amp;winMousePos);
00105     mouse.cur_x = winMousePos.x;
00106     mouse.cur_y = winMousePos.y;
00107 
00108     <span class="comment">// hide cursor</span>
00109     ShowCursor(FALSE);
00110     <span class="comment">// #### patch begin Gilbert 9/1 #######//</span>
00111     vga_front.temp_restore_lock();
00112     <span class="comment">// #### patch end Gilbert 9/1 #######//</span>
00113     mouse.show();
00114     <span class="keywordtype">int</span> ev = mouse.get_event();
00115     ev = mouse.get_event();
00116 
00117 }
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:35 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
