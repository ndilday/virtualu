<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Ogrpare2.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Ogrpare2.cpp</h1><a href="Ogrpare2_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OGrpArea2.CPP</span>
00002 <span class="comment">//Description : Object GraphArea2</span>
00003 <span class="comment">//Owner                 : Kevin(Ho) 0114</span>
00004 
00005 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;<a class="code" href="COLOR_8H.html">COLOR.H</a>&gt;</span>
00007 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>
00008 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00010 <span class="preprocessor">#include &lt;OFONT.H&gt;</span>
00011 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00012 <span class="preprocessor">#include &lt;<a class="code" href="OGRPARE2_8H.html">OGRPARE2.H</a>&gt;</span>
00013 <span class="preprocessor">#include &lt;OFINANCE.H&gt;</span>
00014 <span class="preprocessor">#include &lt;OIFACE.H&gt;</span>
00015 <span class="preprocessor">#include &lt;OMATH.H&gt;</span>
00016 
00017 <span class="preprocessor">#include &lt;math.h&gt;</span>
00018 
00019 <span class="comment">//--------- Define macro constant -----------//</span>
00020 
<a name="l00021"></a><a class="code" href="Ogrpare2_8cpp.html#a0">00021</a> <span class="preprocessor">#define MAX_LEN_LABEL "$10,000M"</span>
00022 <span class="preprocessor"></span>
00023 <span class="keyword">static</span> <span class="keywordtype">int</span> default_series_color[] = {
00024     <a class="code" href="COLOR_8H.html#a21">V_BLUE</a>,
00025     <a class="code" href="COLOR_8H.html#a19">V_RED</a>,
00026     <a class="code" href="COLOR_8H.html#a20">V_GREEN</a>,
00027     <a class="code" href="COLOR_8H.html#a18">V_ORANGE</a>,
00028     <a class="code" href="COLOR_8H.html#a22">V_VIOLET</a>,
00029     <a class="code" href="COLOR_8H.html#a23">V_BROWN</a>,
00030     <a class="code" href="COLOR_8H.html#a25">V_YELLOW</a>,
00031     <a class="code" href="COLOR_8H.html#a24">V_PINK</a>,
00032     <a class="code" href="COLOR_8H.html#a15">V_BLACK</a>,
00033     <a class="code" href="COLOR_8H.html#a17">V_WHITE</a>,
00034 };                                                <span class="comment">// 10 default series colors</span>
00035 
00036 <span class="keyword">enum</span> {  <a class="code" href="Ogrpare2_8cpp.html#a7a2">DEFAULT_SERIES_COLOR_NUM</a> = 10 };
00037 
00038 <span class="keyword">enum</span> {
00039     <a class="code" href="Ogrpare2_8cpp.html#a8a3">LEGEND_SIZE</a> = 11,
00040     <a class="code" href="Ogrpare2_8cpp.html#a8a4">LEGEND_X_SPACING</a> = 12,
00041     <a class="code" href="Ogrpare2_8cpp.html#a8a5">LEGEND_Y_SPACING</a> = 2,
00042 };
00043 
00044 <span class="keyword">enum</span> {  <a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a> = 2         };
00045 
00046 <span class="comment">//-------------- Define static vars ------------//</span>
00047 
00048 <span class="comment">//static char paint_flag = 0;</span>
00049 
00050 <span class="comment">//-------- Begin of function GraphArea2::GraphArea2 ----//</span>
<a name="l00052"></a><a class="code" href="classGraphArea2.html#a0">00052</a> <span class="comment">GraphArea2::GraphArea2() {</span>
00053     init_flag = 0;
00054     grapharea2_bitmap = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00055 }
00056 
00057 <span class="comment">//---------- End of function GraphArea2::GraphArea2 ----//</span>
00058 
00059 <span class="comment">//-------- Begin of function GraphArea2::~GraphArea2 -----//</span>
<a name="l00061"></a><a class="code" href="classGraphArea2.html#a1">00061</a> <span class="comment">GraphArea2::~GraphArea2() {</span>
00062     deinit();
00063 }
00064 
00065 <span class="comment">//---------- End of function GraphArea2::~GraphArea2 -----//</span>
00066 
00067 <span class="comment">//-------- Begin of function GraphArea2::init --------//</span>
00102 <span class="comment">void GraphArea2::init(int x1, int y1, int x2, int y2, int seriesNum,</span>
00103                       <span class="keywordtype">int</span> *dataNum,<span class="keywordtype">void</span> *dataArray, <span class="keywordtype">char</span> dataTypeFlag,<span class="keywordtype">char</span> thisYearIndicator,<span class="keywordtype">int</span> maxUpperLimit,
00104                       <span class="keywordtype">char</span> *xLabel, <span class="keywordtype">char</span> *yLabel,<span class="keywordtype">char</span> **legendArray, <span class="keywordtype">char</span> transparentFlag,  <span class="keywordtype">char</span> orientationFlag,
00105                       <span class="keywordtype">char</span> valueFlag,<span class="keywordtype">int</span> numFormat, <span class="keywordtype">int</span> *seriesColor, <span class="keywordtype">int</span> axisColor) {
00106     <a class="code" href="ALL_8H.html#a0">err_when</a>(seriesNum &gt; <a class="code" href="Ogrpare2_8cpp.html#a7a2">DEFAULT_SERIES_COLOR_NUM</a> &amp;&amp; !seriesColor);
00107     <a class="code" href="ALL_8H.html#a0">err_when</a>(seriesNum &lt;= 0);
00108 
00109     <span class="comment">//  err_when(*xEnd &lt; *xStart);</span>
00110 
00111     graph_width = x2 - x1 - 6;
00112     <a class="code" href="ALL_8H.html#a0">err_when</a>(graph_width &lt; 0);
00113 
00114     max_upper_limit=maxUpperLimit;
00115     <span class="comment">// initialization   chwg0115</span>
00116     grapharea2_x1 = x1;
00117     grapharea2_y1 = y1;
00118     grapharea2_x2 = x2;
00119     grapharea2_y2 = y2;
00120 
00121     series_num = seriesNum;
00122     data_num = dataNum;
00123     data_array = dataArray;
00124     data_type_flag = dataTypeFlag;
00125 
00126     x_label = xLabel;
00127     y_label = yLabel;
00128     legend_array = legendArray;
00129 
00130     transparent_flag = transparentFlag;
00131     orientation_flag = orientationFlag;
00132     value_flag = valueFlag;
00133     num_format = numFormat;
00134 
00135     series_color = seriesColor ? seriesColor : default_series_color;
00136     axis_color = axisColor;
00137 
00138     init_flag = 1;
00139 
00140     y_label_max_len = font_chartsm.text_width(<a class="code" href="Ogrpare2_8cpp.html#a0">MAX_LEN_LABEL</a>);
00141     set_font(&amp;font_chartsm);
00142 
00143     <span class="comment">//  paint();</span>
00144 }
00145 
00146 <span class="comment">//------------- End of function GraphArea2::init -----------//</span>
00147 
00148 <span class="comment">//-------- Begin of function GraphArea2::deinit ------------//</span>
<a name="l00150"></a><a class="code" href="classGraphArea2.html#a7">00150</a> <span class="comment">void GraphArea2::deinit() {</span>
00151     <span class="keywordflow">if</span> (grapharea2_bitmap) {
00152         <a class="code" href="ALL_8H.html#a8">mem_del</a>(grapharea2_bitmap);
00153         grapharea2_bitmap = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00154     }
00155 
00156     init_flag = 0;
00157 }
00158 
00159 <span class="comment">//------------- End of function GraphArea2::deinit ---------//</span>
00160 
00161 <span class="comment">//-------- Begin of function GraphArea2::set_font ------------//</span>
<a name="l00163"></a><a class="code" href="classGraphArea2.html#a10">00163</a> <span class="comment">void GraphArea2::set_font(Font *fontPtr) {</span>
00164     <span class="keywordflow">if</span> (!init_flag)
00165         <span class="keywordflow">return</span>;
00166 
00167     font_ptr = fontPtr;
00168 
00169     calc_pos();
00170 }
00171 
00172 <span class="comment">//------------- End of function GraphArea2::set_font ---------//</span>
00173 
00174 <span class="comment">//-------- Begin of function GraphArea2::calc_pos ------------//</span>
<a name="l00179"></a><a class="code" href="classGraphArea2.html#a11">00179</a> <span class="comment">void GraphArea2::calc_pos() {</span>
00180     <span class="keywordflow">if</span> (legend_array) {
00181         <span class="keywordtype">short</span> textWidth = 0, textHeight = font_ptr-&gt;max_font_height;
00182 
00183         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 2+series_num; i++) {
00184             <span class="keywordflow">if</span> (font_ptr-&gt;text_width(legend_array[i]) &gt; textWidth)
00185                 textWidth = font_ptr-&gt;text_width(legend_array[i]);
00186         }
00187 
00188         <a class="code" href="ALL_8H.html#a0">err_when</a>(textWidth + <a class="code" href="Ogrpare2_8cpp.html#a8a4">LEGEND_X_SPACING</a> * 2 &gt; graph_width);
00189 
00190         legend_x_num = (graph_width - <a class="code" href="Ogrpare2_8cpp.html#a8a4">LEGEND_X_SPACING</a>*2) / (textWidth + <a class="code" href="Ogrpare2_8cpp.html#a8a4">LEGEND_X_SPACING</a>*2);
00191         legend_y_num = ((2+series_num) / legend_x_num) + (((2+series_num) % legend_x_num) ? 1 : 0);
00192 
00193         graph_height = grapharea2_y2 - grapharea2_y1 - legend_y_num * (textHeight + <a class="code" href="Ogrpare2_8cpp.html#a8a5">LEGEND_Y_SPACING</a>) - 6;
00194 
00195         <a class="code" href="ALL_8H.html#a0">err_when</a>(graph_height &lt;= 0);
00196 
00197         legend_width = (graph_width - <a class="code" href="Ogrpare2_8cpp.html#a8a4">LEGEND_X_SPACING</a>*2) / legend_x_num;
00198         legend_height = textHeight + <a class="code" href="Ogrpare2_8cpp.html#a8a5">LEGEND_Y_SPACING</a>;
00199     }
00200     <span class="keywordflow">else</span> {
00201         legend_width = legend_height = legend_x_num = legend_y_num = 0;
00202         graph_height = grapharea2_y2 - grapharea2_y1 - 6;
00203     }
00204 
00205     <span class="keywordtype">short</span> YLabelWidth = y_label ? (orientation_flag ? font_ptr-&gt;max_font_height : font_ptr-&gt;text_width(y_label)) : -<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>;
00206     <span class="keywordtype">short</span> XLabelHeight = x_label ? (font_ptr-&gt;max_font_height) : -<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>;
00207     series_x1 = grapharea2_x1 + 4 + <a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>*4 + YLabelWidth + y_label_max_len;
00208     series_y1 = grapharea2_y1 + 4 + <a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>*6;
00209     series_x2 = grapharea2_x2 - 4 - <a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>*16;
00210     series_y2 = grapharea2_y1 + graph_height - <a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>*3 - (font_ptr-&gt;max_font_height) - XLabelHeight;
00211 }
00212 
00213 <span class="comment">//------------ End of function GraphArea2::calc_pos ---------//</span>
00214 
00215 <span class="comment">//-------- Begin of function GraphArea2::paint --------------//</span>
<a name="l00217"></a><a class="code" href="classGraphArea2.html#a8">00217</a> <span class="comment">void GraphArea2::paint() {</span>
00218     <span class="keywordflow">if</span> (transparent_flag) {
00219         user_interface.brighten(grapharea2_x1+4, grapharea2_y1+4, grapharea2_x2-2, grapharea2_y2-2);
00220 
00221         <span class="comment">//              vga.use_back();</span>
00222         <span class="keywordflow">if</span> (legend_array)
00223             draw_legend();
00224         draw_axis_label();
00225         <span class="comment">//              vga.use_front();</span>
00226         grapharea2_bitmap = vga_back.save_area(grapharea2_x1+4, grapharea2_y1+4, grapharea2_x2-2, grapharea2_y2-2, grapharea2_bitmap);
00227     }
00228 
00229     <span class="comment">//  paint_flag = 1;</span>
00230     refresh();
00231 }
00232 
00233 <span class="comment">//------------- End of function GraphArea2::paint -----------//</span>
00234 
00235 <span class="comment">//-------- Begin of function GraphArea2::refresh ------------//</span>
<a name="l00237"></a><a class="code" href="classGraphArea2.html#a9">00237</a> <span class="comment">void GraphArea2::refresh() {</span>
00238     <span class="comment">//  vga.use_back();</span>
00239 
00240     <span class="keywordflow">if</span> (transparent_flag) {
00241         user_interface.rect(grapharea2_x1, grapharea2_y1, grapharea2_x2, grapharea2_y2, 1);
00242         vga_back.rest_area(grapharea2_bitmap, 0, 0);
00243     }
00244     <span class="keywordflow">else</span> {
00245         user_interface.bar(grapharea2_x1, grapharea2_y1, grapharea2_x2, grapharea2_y2);
00246         user_interface.panel(grapharea2_x1+3, grapharea2_y1+3, grapharea2_x2-4, grapharea2_y2-4);
00247     }
00248     <span class="keywordflow">if</span> (legend_array)
00249         draw_legend();
00250 
00251     draw_scale();
00252     draw_series();
00253     draw_scale();
00254 
00255     <span class="comment">//  vga.use_front();</span>
00256     <span class="comment">//  if (!paint_flag)</span>
00257     <span class="comment">//          vga.blt_buf(grapharea2_x1, grapharea2_y1, grapharea2_x2+2, grapharea2_y2+2);</span>
00258     <span class="comment">//  else</span>
00259     <span class="comment">//          paint_flag = 0;</span>
00260 }
00261 
00262 <span class="comment">//------------- End of function GraphArea2::refresh ---------//</span>
00263 
00264 <span class="comment">//---------- Begin of function GraphArea2::draw_legend ------------//</span>
<a name="l00266"></a><a class="code" href="classGraphArea2.html#b0">00266</a> <span class="comment">void GraphArea2::draw_legend() {</span>
00267     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0,c = 0; i &lt; series_num+2; i++) {
00268         <span class="keywordtype">short</span> legendX = grapharea2_x1 + 4 + (c % legend_x_num) * legend_width + <a class="code" href="Ogrpare2_8cpp.html#a8a4">LEGEND_X_SPACING</a>;
00269         <span class="keywordtype">short</span> legendY = grapharea2_y1 + 4 + graph_height + (c / legend_x_num) * legend_height;
00270 
00271         <span class="keywordflow">if</span>(*(legend_array[i])==<span class="charliteral">'\0'</span>)
00272             <span class="keywordflow">continue</span>;
00273 
00274         c++;
00275         <span class="keywordflow">if</span>(i==2)
00276             user_interface.bar( legendX+<a class="code" href="Ogrpare2_8cpp.html#a8a4">LEGEND_X_SPACING</a>, legendY+<a class="code" href="Ogrpare2_8cpp.html#a8a5">LEGEND_Y_SPACING</a>,
00277                                 legendX+<a class="code" href="Ogrpare2_8cpp.html#a8a4">LEGEND_X_SPACING</a>+<a class="code" href="Ogrpare2_8cpp.html#a8a3">LEGEND_SIZE</a>, legendY+<a class="code" href="Ogrpare2_8cpp.html#a8a5">LEGEND_Y_SPACING</a>+<a class="code" href="Ogrpare2_8cpp.html#a8a3">LEGEND_SIZE</a>,
00278                                 series_color[i] );
00279         <span class="keywordflow">else</span>
00280             user_interface.bar( legendX+<a class="code" href="Ogrpare2_8cpp.html#a8a4">LEGEND_X_SPACING</a>, legendY+<a class="code" href="Ogrpare2_8cpp.html#a8a5">LEGEND_Y_SPACING</a>+<a class="code" href="Ogrpare2_8cpp.html#a8a3">LEGEND_SIZE</a>/2-1,
00281                                 legendX+<a class="code" href="Ogrpare2_8cpp.html#a8a4">LEGEND_X_SPACING</a>+<a class="code" href="Ogrpare2_8cpp.html#a8a3">LEGEND_SIZE</a>, legendY+<a class="code" href="Ogrpare2_8cpp.html#a8a5">LEGEND_Y_SPACING</a>+<a class="code" href="Ogrpare2_8cpp.html#a8a3">LEGEND_SIZE</a>/2+1,
00282                                 series_color[i] );
00283         font_ptr-&gt;put( legendX+<a class="code" href="Ogrpare2_8cpp.html#a8a4">LEGEND_X_SPACING</a>*2+<a class="code" href="Ogrpare2_8cpp.html#a8a3">LEGEND_SIZE</a>, legendY+<a class="code" href="Ogrpare2_8cpp.html#a8a5">LEGEND_Y_SPACING</a>, legend_array[i] );
00284     }
00285 }
00286 
00287 <span class="comment">//------------ End of function GraphArea2::draw_legend ------------//</span>
00288 
00289 <span class="comment">//---------- Begin of function GraphArea2::draw_axis_label --------//</span>
<a name="l00291"></a><a class="code" href="classGraphArea2.html#b1">00291</a> <span class="comment">void GraphArea2::draw_axis_label() {</span>
00292     <span class="keywordtype">short</span> textHeight = font_ptr-&gt;max_font_height;
00293 
00294     <span class="keywordflow">if</span> (x_label) {
00295         font_ptr-&gt;center_put( series_x1, series_y2+<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>*2+textHeight,
00296                               series_x2, grapharea2_y1+graph_height-<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>, x_label );
00297     }
00298 
00299     <span class="keywordflow">if</span> (y_label) {
00300         <span class="keywordtype">short</span> textWidth = font_ptr-&gt;text_width(y_label) + 1;
00301 
00302         <span class="keywordflow">if</span> (orientation_flag) {
00303             <span class="keywordtype">short</span> *fontBuf = (<span class="keywordtype">short</span> *) sys.common_data_buf;
00304             <a class="code" href="ALL_8H.html#a0">err_when</a>(textWidth * textHeight * <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>) &gt; <a class="code" href="Osys_8h.html#a40a2">COMMON_DATA_BUF_SIZE</a>);
00305 
00306             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; textWidth * textHeight; i++)
00307                 *fontBuf++ = transparent_code_w;
00308 
00309             font_ptr-&gt;put_to_bufferW(fontBuf = (<span class="keywordtype">short</span> *) sys.common_data_buf, textWidth * <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>), 0, 0, y_label);
00310 
00311             <span class="keywordtype">short</span> xStart = grapharea2_x1 + 4 + <a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a> * 2;
00312             <span class="keywordtype">short</span> yStart = (series_y1 + series_y2 - textWidth) / 2;
00313 
00314             <span class="keywordflow">for</span> (<span class="keywordtype">short</span> x = 0; x &lt; textHeight; x++) {
00315                 <span class="keywordflow">for</span> (<span class="keywordtype">short</span> y = textWidth - 1; y &gt;= 0; y--, fontBuf++) {
00316                     <span class="keywordflow">if</span> (*fontBuf != transparent_code_w)
00317                         *vga_back.buf_ptr(xStart+x, yStart+y) = *fontBuf;
00318                 }
00319             }
00320         }
00321         <span class="keywordflow">else</span> {
00322             font_ptr-&gt;center_put( grapharea2_x1+4+<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>*2, series_y1,
00323                                   grapharea2_x1+4+<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>*2+textWidth, series_y2, y_label);
00324         }
00325     }
00326 }
00327 
00328 <span class="comment">//------------ End of function GraphArea2::draw_axis_label --------//</span>
00329 
00330 <span class="comment">//---------- Begin of function GraphArea2::find_scale -------------//</span>
<a name="l00332"></a><a class="code" href="classGraphArea2.html#b2">00332</a> <span class="comment">void GraphArea2::find_scale() {</span>
00333     <span class="keywordtype">double</span> data;
00334     max_val = 0.0;
00335     min_val = 0.0;
00336     x_axis_pos = 0;
00337 
00338     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num * *data_num; i++) {
00339         <span class="keywordflow">switch</span> (data_type_flag) {
00340         <span class="keywordflow">case</span> DATA_DOUBLE:
00341             data = ((<span class="keywordtype">double</span>*)data_array)[i];
00342             <span class="keywordflow">break</span>;
00343         <span class="keywordflow">case</span> DATA_FLOAT:
00344             data = double(((<span class="keywordtype">float</span>*)data_array)[i]);
00345             <span class="keywordflow">break</span>;
00346         <span class="keywordflow">case</span> DATA_INT:
00347             data = double(((<span class="keywordtype">int</span>*)data_array)[i]);
00348             <span class="keywordflow">break</span>;
00349         <span class="keywordflow">case</span> DATA_LONG:
00350             data = double(((<span class="keywordtype">long</span>*)data_array)[i]);
00351             <span class="keywordflow">break</span>;
00352         }
00353         <span class="keywordflow">if</span> (data &gt; max_val)
00354             max_val = <a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(data);
00355         <span class="keywordflow">if</span> (data &lt; min_val)
00356             min_val = <a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(data);
00357         <span class="keywordflow">if</span> (!x_axis_pos &amp;&amp; data &lt; 0.0)
00358             x_axis_pos = 1;
00359     }
00360 
00361     <span class="keywordflow">if</span> ( max_upper_limit&gt;max_val )
00362         max_label = max_upper_limit;
00363     <span class="keywordflow">else</span>
00364         max_label = max_val;
00365 
00366     <span class="keywordflow">if</span> (min_val&lt;0)
00367         min_label = -pow(10,floor(log10(<a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(min_val))));
00368     <span class="keywordflow">else</span>
00369         min_label = 0;
00370 
00371     y_ratio=(series_y2-series_y1)/(max_label-min_label);
00372     <span class="comment">// scr y-pos of x-axis</span>
00373     x_axis_scr_pos=(int)(series_y1+max_label*y_ratio);
00374 }
00375 
00376 <span class="comment">//------------ End of function GraphArea2::find_scale -------------//</span>
00377 
00378 <span class="comment">//---------- Begin of function GraphArea2::draw_scale -------------//</span>
<a name="l00380"></a><a class="code" href="classGraphArea2.html#b3">00380</a> <span class="comment">void GraphArea2::draw_scale() {</span>
00381     find_scale();
00382 
00383     <span class="comment">//  short xAxisPos;</span>
00384 
00385     <span class="comment">//------ Draw y-axis -------//</span>
00386 
00387     <span class="comment">//  if (x_axis_pos)</span>
00388     <span class="comment">//          vga_back.bar(series_x1, series_y1-COMMON_OFFSET*2, series_x1+1, series_y2+COMMON_OFFSET*2, axis_color);</span>
00389     <span class="comment">//  else</span>
00390 
00391     vga_back.bar(series_x1, series_y1-<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>*2, series_x1+1, series_y2, axis_color);
00392 
00393     <span class="comment">//  short scaleNum = (series_y2-series_y1-font_ptr-&gt;max_font_height) / (font_ptr-&gt;max_font_height*3/2);</span>
00394     <span class="comment">//  scaleNum = short(pow(2,floor(log10(double(scaleNum))/log10(2.0))));</span>
00395     <span class="comment">//  short scaleStep = (series_y2-series_y1) / scaleNum;</span>
00396     <span class="comment">//  double scaleValue;</span>
00397 
00398     <span class="comment">// Draw +ve index</span>
00399     <span class="keywordtype">short</span> scaleNum =(int)((x_axis_scr_pos-series_y1)/ (font_ptr-&gt;max_font_height*3/2));
00400     <span class="keywordflow">if</span> ( scaleNum &gt; 0 )
00401         scaleNum = short(pow(2,floor(log10(<span class="keywordtype">double</span>(scaleNum))/log10(2.0))));
00402     <span class="keywordflow">else</span>
00403         scaleNum = 0;
00404     <span class="keywordtype">double</span> indexStep = max_label/scaleNum;
00405 
00406     <span class="comment">//------ Draw y-axis -------//</span>
00407     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt;= scaleNum; i++) {
00408         <span class="keywordtype">int</span> yPos=(int)(x_axis_scr_pos-y_ratio*indexStep*i);
00409         vga_back.bar( series_x1-<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>,yPos,
00410                       series_x1+<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>,yPos+1, axis_color);
00411 
00412         <span class="comment">//              if ( (x_axis_pos &amp;&amp; i == scaleNum / 2) || !(x_axis_pos || i) )</span>
00413         <span class="comment">//                      vga_back.bar(series_x1, xAxisPos=series_y2-i*scaleStep-1, series_x2+COMMON_OFFSET*8, series_y2-i*scaleStep, axis_color);</span>
00414         <span class="comment">//              else</span>
00415         <span class="comment">//                      vga_back.bar(series_x1, series_y2-i*scaleStep, series_x1+COMMON_OFFSET*2, series_y2-i*scaleStep, axis_color);</span>
00416         <span class="comment">//              if (x_axis_pos)</span>
00417         <span class="comment">//                      scaleValue = max_scale*2/scaleNum*i - max_scale;</span>
00418         <span class="comment">//              else</span>
00419         <span class="comment">//                      scaleValue = max_scale/scaleNum*i;</span>
00420 
00421         <span class="keywordflow">switch</span> (data_type_flag) {
00422         <span class="keywordflow">case</span> DATA_FLOAT:
00423         <span class="keywordflow">case</span> DATA_DOUBLE:
00424             font_ptr-&gt;right_put(series_x1-<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>, yPos-font_ptr-&gt;max_font_height/2, m.format(indexStep*i,num_format));
00425             <span class="keywordflow">break</span>;
00426         <span class="keywordflow">case</span> DATA_INT:
00427         <span class="keywordflow">case</span> DATA_LONG:
00428             font_ptr-&gt;right_put(series_x1-<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>, yPos-font_ptr-&gt;max_font_height/2, m.format(<span class="keywordtype">long</span>(indexStep*i),num_format));
00429         }
00430     }
00431 
00432     <span class="comment">// Draw -ve index</span>
00433     scaleNum =(int)((series_y2-x_axis_scr_pos)/ (font_ptr-&gt;max_font_height*3/2));
00434     <span class="keywordflow">if</span> ( scaleNum &gt; 0 )
00435         scaleNum = short(pow(2,floor(log10(<span class="keywordtype">double</span>(scaleNum))/log10(2.0))));
00436     <span class="keywordflow">else</span>
00437         scaleNum = 0;
00438     indexStep = <a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(math.safe_divide(min_label,(<span class="keywordtype">double</span>)scaleNum));
00439 
00440     <span class="comment">//------ Draw y-axis -------//</span>
00441     <span class="keywordflow">for</span> (i = 1; i &lt;= scaleNum; i++) {
00442         <span class="keywordtype">int</span> yPos=(int)(x_axis_scr_pos+y_ratio*indexStep*i);
00443         vga_back.bar( series_x1-<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>,yPos,
00444                       series_x1+<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>,yPos+1, axis_color);
00445 
00446         <span class="comment">//              if ( (x_axis_pos &amp;&amp; i == scaleNum / 2) || !(x_axis_pos || i) )</span>
00447         <span class="comment">//                      vga_back.bar(series_x1, xAxisPos=series_y2-i*scaleStep-1, series_x2+COMMON_OFFSET*8, series_y2-i*scaleStep, axis_color);</span>
00448         <span class="comment">//              else</span>
00449         <span class="comment">//                      vga_back.bar(series_x1, series_y2-i*scaleStep, series_x1+COMMON_OFFSET*2, series_y2-i*scaleStep, axis_color);</span>
00450         <span class="comment">//              if (x_axis_pos)</span>
00451         <span class="comment">//                      scaleValue = max_scale*2/scaleNum*i - max_scale;</span>
00452         <span class="comment">//              else</span>
00453         <span class="comment">//                      scaleValue = max_scale/scaleNum*i;</span>
00454 
00455         <span class="keywordflow">switch</span> (data_type_flag) {
00456         <span class="keywordflow">case</span> DATA_FLOAT:
00457         <span class="keywordflow">case</span> DATA_DOUBLE:
00458             font_ptr-&gt;right_put(series_x1-<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>, yPos-font_ptr-&gt;max_font_height/2, m.format(-indexStep*i,num_format));
00459             <span class="keywordflow">break</span>;
00460         <span class="keywordflow">case</span> DATA_INT:
00461         <span class="keywordflow">case</span> DATA_LONG:
00462             font_ptr-&gt;right_put(series_x1-<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>, yPos-font_ptr-&gt;max_font_height/2, m.format(-<span class="keywordtype">long</span>(indexStep*i),num_format));
00463         }
00464     }
00465 
00466     <span class="comment">// show x-axis scale</span>
00467 
00468     <span class="comment">// At max, how much data points shown for each series</span>
00469     <span class="keywordtype">int</span> data_year_shown=8;
00470 
00471     <span class="comment">// The scales within how much years should be shown</span>
00472     <span class="keywordtype">int</span> scale_year_shown=8;
00473 
00474     <span class="comment">// pesudo year = which year the indicator pointing to</span>
00475     <span class="keywordtype">double</span> pesudo_end;
00476     <span class="comment">// ##### patch begin Gilbert 07/09/2001 ######//</span>
00477     pesudo_end = info.financial_year();
00478     <span class="comment">//  if(info.game_month&lt;finance.fiscal_year_start_month)</span>
00479     <span class="comment">//          pesudo_end=info.game_year-1;</span>
00480     <span class="comment">//  else</span>
00481     <span class="comment">//          pesudo_end=info.game_year;</span>
00482     <span class="comment">// ##### patch end Gilbert 07/09/2001 ######//</span>
00483 
00484     <span class="keywordflow">if</span>(info.graph_year_passed&lt;data_year_shown)
00485         data_year_shown=info.graph_year_passed;
00486 
00487     <span class="keywordtype">short</span> maxLabelWidth = font_ptr-&gt;text_width(m.format(pesudo_end, 16));
00488     <span class="keywordtype">double</span> scaleYearRatio =1.0;
00489     x_axis_step = (series_x2-series_x1) / (scale_year_shown);
00490 
00491     <span class="keywordtype">short</span> displayInc = 1;
00492     <span class="keywordflow">while</span> (displayInc * x_axis_step &lt; maxLabelWidth ) displayInc++;
00493 
00494 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00495 <span class="preprocessor"></span>    <span class="keywordtype">double</span> printing_offset=0.0;
00496 <span class="preprocessor">#else</span>
00497 <span class="preprocessor"></span>    <span class="keywordtype">double</span> printing_offset=1-finance.fiscal_year_start_month/12.0;
00498 <span class="preprocessor">#endif</span>
00499 <span class="preprocessor"></span>
00500     <span class="keywordtype">int</span> start_printing_year=(int)(pesudo_end+
00501                                   ((this_year_indicator&gt;=0)?this_year_indicator:0)
00502                                   +1-data_year_shown);
00503 
00504     <span class="comment">//  double actual_end_year=(double)info.game_month/12.0+info.game_year+1;</span>
00505     <span class="comment">//  int show_end_year=(int)(actual_end_year-finance.fiscal_year_start_month/12.0);</span>
00506     <span class="comment">//  int show_start_year=show_end_year-year_shown+1;</span>
00507 
00508     <span class="comment">//------ Draw x-axis -------//</span>
00509     vga_back.bar(series_x1,x_axis_scr_pos-1,series_x2,x_axis_scr_pos,axis_color);
00510     <span class="keywordflow">for</span> (i = 0; i &lt; scale_year_shown ; i += displayInc) {
00511         vga_back.bar(
00512             (<span class="keywordtype">int</span>)(series_x1+(printing_offset+i)*x_axis_step),
00513             x_axis_scr_pos-<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>*2,
00514             (<span class="keywordtype">int</span>)(series_x1+(printing_offset+i)*x_axis_step),
00515             x_axis_scr_pos+<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>*2, axis_color);
00516         font_ptr-&gt;center_put(
00517             (<span class="keywordtype">int</span>)(series_x1+(printing_offset+i)*x_axis_step)-maxLabelWidth/2-<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>,
00518             x_axis_scr_pos+<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>,
00519             (<span class="keywordtype">int</span>)(series_x1+(printing_offset+i)*x_axis_step)+maxLabelWidth/2+<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>,
00520             x_axis_scr_pos+<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>+font_ptr-&gt;max_font_height,
00521             m.format((<span class="keywordtype">int</span>)(start_printing_year+i/scaleYearRatio), 16));
00522     }
00523 
00524     <span class="comment">//---- Draw this year indicators ----//</span>
00525     <span class="keywordflow">if</span>((this_year_indicator&gt;=0)&amp;&amp;(this_year_indicator&lt;HISTORY_YEAR_COUNT))
00526         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=series_y1;j&lt;series_y2+<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>;j+=8)
00527             vga_back.bar(
00528                 (<span class="keywordtype">int</span>)(series_x1+(data_year_shown-this_year_indicator-1)*x_axis_step),
00529                 j,
00530                 (<span class="keywordtype">int</span>)(series_x1+(data_year_shown-this_year_indicator-1)*x_axis_step),
00531                 j+4,
00532                 axis_color);
00533 }
00534 
00535 <span class="comment">//------------ End of function GraphArea2::draw_scale -------------//</span>
00536 
00537 <span class="comment">//---------- Begin of function GraphArea2::draw_series ------------//</span>
<a name="l00539"></a><a class="code" href="classGraphArea2.html#b4">00539</a> <span class="comment">void GraphArea2::draw_series() {</span>
00540     <span class="keywordflow">switch</span> (data_type_flag) {
00541     <span class="keywordflow">case</span> DATA_FLOAT: draw_series_float(); <span class="keywordflow">break</span>;
00542     <span class="keywordflow">case</span> DATA_DOUBLE: draw_series_double(); <span class="keywordflow">break</span>;
00543     <span class="keywordflow">case</span> DATA_INT: draw_series_int(); <span class="keywordflow">break</span>;
00544     <span class="keywordflow">case</span> DATA_LONG: draw_series_long(); <span class="keywordflow">break</span>;
00545     }
00546 }
00547 
00548 <span class="comment">//------------ End of function GraphArea2::draw_series ------------//</span>
00549 
00550 <span class="comment">//---------- Begin of function GraphArea2::draw_series_float ------------//</span>
<a name="l00552"></a><a class="code" href="classGraphArea2.html#b5">00552</a> <span class="comment">void GraphArea2::draw_series_float() {</span>
00553     <span class="keywordtype">float</span> *dataArray = (<span class="keywordtype">float</span> *) data_array;
00554     <span class="keywordtype">short</span> prevX, prevY, currX, currY;
00555     <span class="keywordtype">short</span> prevY2, currY2;
00556     <span class="keywordtype">short</span> fillY, fillY2;
00557     <span class="keywordtype">double</span> m,m2;
00558 
00559     <span class="comment">//Filling region</span>
00560     prevX = series_x1;
00561 
00562     dataArray-=info.graph_year_passed;
00563     dataArray+=*data_num;
00564 
00565     <span class="comment">// Find Y by dataArray</span>
00566     <span class="comment">//  if (x_axis_pos)</span>
00567     <span class="comment">//          prevY = (short)(series_y2 - ((*dataArray+float(max_scale)) * (series_y2-series_y1) / float(max_scale*2)));</span>
00568     <span class="comment">//  else</span>
00569     <span class="comment">//          prevY = (short)(series_y2 - *dataArray * (series_y2-series_y1) / float(max_scale));</span>
00570     <span class="comment">//  if (x_axis_pos)</span>
00571     <span class="comment">//          prevY2 = (short)(series_y2 - ((*(dataArray+(*data_num))+float(max_scale)) * (series_y2-series_y1) / float(max_scale*2)));</span>
00572     <span class="comment">//  else</span>
00573     <span class="comment">//          prevY2 = (short)(series_y2 - *(dataArray+(*data_num)) * (series_y2-series_y1) / float(max_scale));</span>
00574 
00575     prevY = (short)(x_axis_scr_pos-*dataArray*y_ratio);
00576     prevY2 = (short)(x_axis_scr_pos-*(dataArray+(*data_num))*y_ratio);
00577     dataArray++;
00578     vga_back.thick_line(prevX, prevY, prevX+1, prevY, vga_back.translate_color(series_color[0]));
00579     vga_back.thick_line(prevX, prevY2, prevX+1, prevY2, vga_back.translate_color(series_color[1]));
00580 
00581     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt; info.graph_year_passed; j++) {
00582         currX = series_x1 + j * x_axis_step;
00583         <span class="comment">//              if (x_axis_pos)</span>
00584         <span class="comment">//                      currY = (short)(series_y2 - ((*dataArray+float(max_scale)) * (series_y2-series_y1) / float(max_scale*2)));</span>
00585         <span class="comment">//              else</span>
00586         <span class="comment">//                      currY = (short)(series_y2 - *dataArray * (series_y2-series_y1) / float(max_scale));</span>
00587         <span class="comment">//              if (x_axis_pos)</span>
00588         <span class="comment">//                      currY2 = (short)(series_y2 - ((*(dataArray+(*data_num))+float(max_scale)) * (series_y2-series_y1) / float(max_scale*2)));</span>
00589         <span class="comment">//              else</span>
00590         <span class="comment">//                      currY2 = (short)(series_y2 - *(dataArray+(*data_num)) * (series_y2-series_y1) / float(max_scale));</span>
00591 
00592         currY = (short)(x_axis_scr_pos-*dataArray*y_ratio);
00593         currY2 = (short)(x_axis_scr_pos-*(dataArray+(*data_num))*y_ratio);
00594 
00595         <span class="comment">// filling region</span>
00596         m=((double)currY-prevY)/x_axis_step;
00597         m2=((double)currY2-prevY2)/x_axis_step;
00598 
00599         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;x_axis_step;i++) {
00600             fillY=(int)(m*i+prevY);
00601             fillY2=(int)(m2*i+prevY2);
00602             <span class="keywordflow">if</span>(fillY&gt;fillY2) {
00603                 <span class="keywordflow">if</span>(*(legend_array[3])!=<span class="charliteral">'\0'</span>)
00604                     vga_back.line(prevX+i, fillY, prevX+i, fillY2, vga_back.translate_color(series_color[3]));
00605             }
00606             <span class="keywordflow">else</span>
00607                 vga_back.line(prevX+i, fillY, prevX+i, fillY2, vga_back.translate_color(series_color[2]));
00608         }
00609 
00610         <span class="comment">// draw lines</span>
00611         vga_back.thick_line(prevX, prevY, currX, currY, vga_back.translate_color(series_color[0]));
00612         vga_back.thick_line(prevX, prevY2, currX, currY2, vga_back.translate_color(series_color[1]));
00613 
00614         prevX = currX;
00615         prevY = currY;
00616         prevY2 = currY2;
00617         dataArray++;
00618     }
00619 
00620     <span class="keywordflow">if</span> (value_flag) {
00621         draw_value(dataArray-1, vga_back.translate_color(series_color[0]), prevX+<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>, prevY-font_news.max_font_height/2, DATA_FLOAT);
00622         draw_value(dataArray+(*data_num-1), vga_back.translate_color(series_color[1]), prevX+<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>, prevY2, DATA_FLOAT);
00623     }
00624 
00625     <span class="comment">//---------------Draw the remain lines if they exist-----------//</span>
00626     <span class="keywordflow">if</span>(series_num&gt;2) {
00627         dataArray+=(*data_num);
00628 
00629         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 2; i &lt; series_num; i++) {
00630             dataArray-=(info.graph_year_passed);
00631             dataArray+=(*data_num);
00632             prevX = series_x1;
00633             <span class="comment">//                  if (x_axis_pos)</span>
00634             <span class="comment">//                          prevY = series_y2 - short(((*dataArray+float(max_scale)) * float(series_y2-series_y1) / float(max_scale*2)));</span>
00635             <span class="comment">//                  else</span>
00636             <span class="comment">//                          prevY = series_y2 - short(*dataArray * float(series_y2-series_y1) / float(max_scale));</span>
00637             prevY = (short)(x_axis_scr_pos-*dataArray*y_ratio);
00638 
00639             dataArray++;
00640 
00641             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt; (info.graph_year_passed); j++) {
00642                 currX = series_x1 + j * x_axis_step;
00643                 <span class="comment">//                              if (x_axis_pos)</span>
00644                 <span class="comment">//                                      currY = series_y2 - short(((*dataArray+float(max_scale)) * float(series_y2-series_y1) / float(max_scale*2)));</span>
00645                 <span class="comment">//                              else</span>
00646                 <span class="comment">//                                      currY = series_y2 - short(*dataArray * float(series_y2-series_y1) / float(max_scale));</span>
00647                 currY = (short)(x_axis_scr_pos-*dataArray*y_ratio);
00648 
00649                 vga_back.thick_line(prevX, prevY, currX, currY, vga_back.translate_color(series_color[i+2]));
00650 
00651                 prevX = currX;
00652                 prevY = currY;
00653                 dataArray++;
00654             }
00655             <span class="keywordflow">if</span> (value_flag)
00656                 draw_value(dataArray-1, vga_back.translate_color(series_color[i+2]), prevX+<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>, prevY-font_news.max_font_height/2, DATA_FLOAT);
00657         }
00658     }
00659 }
00660 
00661 <span class="comment">//------------ End of function GraphArea2::draw_series_float ------------//</span>
00662 
00663 <span class="comment">//---------- Begin of function GraphArea2::draw_series_double ------------//</span>
<a name="l00665"></a><a class="code" href="classGraphArea2.html#b6">00665</a> <span class="comment">void GraphArea2::draw_series_double() {</span>
00666     <span class="keywordtype">double</span> *dataArray = (<span class="keywordtype">double</span> *) data_array;
00667     <span class="keywordtype">short</span> prevX, prevY, currX, currY;
00668     <span class="keywordtype">short</span> prevY2, currY2;
00669     <span class="keywordtype">short</span> fillY, fillY2;
00670     <span class="keywordtype">double</span> m,m2;
00671 
00672     <span class="comment">//Filling region</span>
00673     prevX = series_x1;
00674     dataArray-=(info.graph_year_passed);
00675     dataArray+=*data_num;
00676 
00677     <span class="comment">// Find Y by dataArray</span>
00678     <span class="comment">//  if (x_axis_pos)</span>
00679     <span class="comment">//          prevY = (short)(series_y2 - ((*dataArray+double(max_scale)) * (series_y2-series_y1) / double(max_scale*2)));</span>
00680     <span class="comment">//  else</span>
00681     <span class="comment">//          prevY = (short)(series_y2 - *dataArray * (series_y2-series_y1) / double(max_scale));</span>
00682     <span class="comment">//  if (x_axis_pos)</span>
00683     <span class="comment">//          prevY2 = (short)(series_y2 - ((*(dataArray+(*data_num))+double(max_scale)) * (series_y2-series_y1) / double(max_scale*2)));</span>
00684     <span class="comment">//  else</span>
00685     <span class="comment">//          prevY2 = (short)(series_y2 - *(dataArray+(*data_num)) * (series_y2-series_y1) / double(max_scale));</span>
00686     prevY = (short)(x_axis_scr_pos-*dataArray*y_ratio);
00687     prevY2 = (short)(x_axis_scr_pos-*(dataArray+(*data_num))*y_ratio);
00688 
00689     dataArray++;
00690     vga_back.thick_line(prevX, prevY, prevX+1, prevY, vga_back.translate_color(series_color[0]));
00691     vga_back.thick_line(prevX, prevY2, prevX+1, prevY2, vga_back.translate_color(series_color[1]));
00692 
00693     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt; (info.graph_year_passed); j++) {
00694         currX = series_x1 + j * x_axis_step;
00695         <span class="comment">//              if (x_axis_pos)</span>
00696         <span class="comment">//                      currY = (short)(series_y2 - ((*dataArray+double(max_scale)) * (series_y2-series_y1) / double(max_scale*2)));</span>
00697         <span class="comment">//              else</span>
00698         <span class="comment">//                      currY = (short)(series_y2 - *dataArray * (series_y2-series_y1) / double(max_scale));</span>
00699 
00700         <span class="comment">//              if (x_axis_pos)</span>
00701         <span class="comment">//                      currY2 = (short)(series_y2 - ((*(dataArray+(*data_num))+double(max_scale)) * (series_y2-series_y1) / double(max_scale*2)));</span>
00702         <span class="comment">//              else</span>
00703         <span class="comment">//                      currY2 = (short)(series_y2 - *(dataArray+(*data_num)) * (series_y2-series_y1) / double(max_scale));</span>
00704         currY = (short)(x_axis_scr_pos-*dataArray*y_ratio);
00705         currY2 = (short)(x_axis_scr_pos-*(dataArray+(*data_num))*y_ratio);
00706 
00707         <span class="comment">// filling region</span>
00708         m=((double)currY-prevY)/x_axis_step;
00709         m2=((double)currY2-prevY2)/x_axis_step;
00710 
00711         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;x_axis_step;i++) {
00712             fillY=(int)(m*i+prevY);
00713             fillY2=(int)(m2*i+prevY2);
00714             <span class="keywordflow">if</span>(fillY&gt;fillY2) {
00715                 <span class="keywordflow">if</span>(*(legend_array[3])!=<span class="charliteral">'\0'</span>)
00716                     vga_back.line(prevX+i, fillY, prevX+i, fillY2, vga_back.translate_color(series_color[3]));
00717             }
00718             <span class="keywordflow">else</span>
00719                 vga_back.line(prevX+i, fillY, prevX+i, fillY2, vga_back.translate_color(series_color[2]));
00720         }
00721 
00722         <span class="comment">// draw lines</span>
00723         vga_back.thick_line(prevX, prevY, currX, currY, vga_back.translate_color(series_color[0]));
00724         vga_back.thick_line(prevX, prevY2, currX, currY2, vga_back.translate_color(series_color[1]));
00725 
00726         prevX = currX;
00727         prevY = currY;
00728         prevY2 = currY2;
00729         dataArray++;
00730     }
00731 
00732     <span class="keywordflow">if</span> (value_flag) {
00733         draw_value(dataArray-1, vga_back.translate_color(series_color[0]), prevX+<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>, prevY-font_news.max_font_height/2, DATA_DOUBLE);
00734         draw_value(dataArray+(*data_num-1), vga_back.translate_color(series_color[1]), prevX+<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>, prevY2, DATA_DOUBLE);
00735     }
00736 
00737     <span class="comment">//---------------Draw the remain lines if they exist-----------//</span>
00738 
00739     <span class="keywordflow">if</span>(series_num&gt;2) {
00740         dataArray+=(*data_num);
00741 
00742         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 2; i &lt; series_num; i++) {
00743             dataArray-=(info.graph_year_passed);
00744             dataArray+=*data_num;
00745             prevX = series_x1;
00746             <span class="comment">//                  if (x_axis_pos)</span>
00747             <span class="comment">//                          prevY = series_y2 - short(((*dataArray+double(max_scale)) * double(series_y2-series_y1) / double(max_scale*2)));</span>
00748             <span class="comment">//                  else</span>
00749             <span class="comment">//                          prevY = series_y2 - short(*dataArray * double(series_y2-series_y1) / double(max_scale));</span>
00750             <span class="comment">//                  prevY   = (short)(x_axis_scr_pos-*dataArray*y_ratio);</span>
00751             prevY = (short)(x_axis_scr_pos-*dataArray*y_ratio);
00752 
00753             dataArray++;
00754 
00755             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt; (info.graph_year_passed); j++) {
00756                 currX = series_x1 + j * x_axis_step;
00757                 <span class="comment">//                              if (x_axis_pos)</span>
00758                 <span class="comment">//                                      currY = series_y2 - short(((*dataArray+double(max_scale)) * double(series_y2-series_y1) / double(max_scale*2)));</span>
00759                 <span class="comment">//                              else</span>
00760                 <span class="comment">//                                      currY = series_y2 - short(*dataArray * double(series_y2-series_y1) / double(max_scale));</span>
00761                 <span class="comment">//                              currY   = (short)(x_axis_scr_pos-*dataArray*y_ratio);</span>
00762                 currY = (short)(x_axis_scr_pos-*dataArray*y_ratio);
00763 
00764                 vga_back.thick_line(prevX, prevY, currX, currY, vga_back.translate_color(series_color[i+2]));
00765 
00766                 prevX = currX;
00767                 prevY = currY;
00768                 dataArray++;
00769             }
00770             <span class="keywordflow">if</span> (value_flag)
00771                 draw_value(dataArray-1, vga_back.translate_color(series_color[i+2]), prevX+<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>, prevY-font_news.max_font_height/2, DATA_DOUBLE);
00772         }
00773     }
00774 
00775 }
00776 
00777 <span class="comment">//------------ End of function GraphArea2::draw_series_double ------------//</span>
00778 
00779 <span class="comment">//---------- Begin of function GraphArea2::draw_series_int ------------//</span>
<a name="l00781"></a><a class="code" href="classGraphArea2.html#b7">00781</a> <span class="comment">void GraphArea2::draw_series_int() {</span>
00782     <span class="keywordtype">int</span> *dataArray = (<span class="keywordtype">int</span> *) data_array;
00783     <span class="keywordtype">short</span> prevX, prevY, currX, currY;
00784     <span class="keywordtype">short</span> prevY2, currY2;
00785     <span class="keywordtype">short</span> fillY, fillY2;
00786     <span class="keywordtype">double</span> m,m2;
00787 
00788     <span class="comment">//Filling region</span>
00789     prevX = series_x1;
00790     dataArray-=(info.graph_year_passed);
00791     dataArray+=*data_num;
00792 
00793     <span class="comment">// Find Y by dataArray</span>
00794     <span class="comment">//  if (x_axis_pos)</span>
00795     <span class="comment">//          prevY = series_y2 - ((*dataArray+int(max_scale)) * (series_y2-series_y1) / int(max_scale*2));</span>
00796     <span class="comment">//  else</span>
00797     <span class="comment">//          prevY = series_y2 - *dataArray * (series_y2-series_y1) / int(max_scale);</span>
00798     <span class="comment">//  if (x_axis_pos)</span>
00799     <span class="comment">//          prevY2 = series_y2 - ((*(dataArray+(*data_num))+int(max_scale)) * (series_y2-series_y1) / int(max_scale*2));</span>
00800     <span class="comment">//  else</span>
00801     <span class="comment">//          prevY2 = series_y2 - *(dataArray+(*data_num)) * (series_y2-series_y1) / int(max_scale);</span>
00802 
00803     prevY = (short)(x_axis_scr_pos-*dataArray*y_ratio);
00804     prevY2 = (short)(x_axis_scr_pos-*(dataArray+(*data_num))*y_ratio);
00805 
00806     dataArray++;
00807 
00808     vga_back.thick_line(prevX, prevY, prevX+1, prevY, vga_back.translate_color(series_color[0]));
00809     vga_back.thick_line(prevX, prevY2, prevX+1, prevY2, vga_back.translate_color(series_color[1]));
00810 
00811     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt; (info.graph_year_passed); j++) {
00812         currX = series_x1 + j * x_axis_step;
00813         <span class="comment">//              if (x_axis_pos)</span>
00814         <span class="comment">//                      currY = series_y2 - ((*dataArray+int(max_scale)) * (series_y2-series_y1) / int(max_scale*2));</span>
00815         <span class="comment">//              else</span>
00816         <span class="comment">//                      currY = series_y2 - *dataArray * (series_y2-series_y1) / int(max_scale);</span>
00817 
00818         <span class="comment">//              if (x_axis_pos)</span>
00819         <span class="comment">//                      currY2 = series_y2 - ((*(dataArray+(*data_num))+int(max_scale)) * (series_y2-series_y1) / int(max_scale*2));</span>
00820         <span class="comment">//              else</span>
00821         <span class="comment">//                      currY2 = series_y2 - *(dataArray+(*data_num)) * (series_y2-series_y1) / int(max_scale);</span>
00822 
00823         currY = (short)(x_axis_scr_pos-*dataArray*y_ratio);
00824         currY2 = (short)(x_axis_scr_pos-*(dataArray+(*data_num))*y_ratio);
00825 
00826         <span class="comment">// filling region</span>
00827         m=((double)currY-prevY)/x_axis_step;
00828         m2=((double)currY2-prevY2)/x_axis_step;
00829 
00830         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;x_axis_step;i++) {
00831             fillY=(int)(m*i+prevY);
00832             fillY2=(int)(m2*i+prevY2);
00833             <span class="keywordflow">if</span>(fillY&gt;fillY2) {
00834                 <span class="keywordflow">if</span>(*(legend_array[3])!=<span class="charliteral">'\0'</span>)
00835                     vga_back.line(prevX+i, fillY, prevX+i, fillY2, vga_back.translate_color(series_color[3]));
00836             }
00837             <span class="keywordflow">else</span>
00838                 vga_back.line(prevX+i, fillY, prevX+i, fillY2, vga_back.translate_color(series_color[2]));
00839         }
00840 
00841         <span class="comment">// draw lines</span>
00842         vga_back.thick_line(prevX, prevY, currX, currY, vga_back.translate_color(series_color[0]));
00843         vga_back.thick_line(prevX, prevY2, currX, currY2, vga_back.translate_color(series_color[1]));
00844 
00845         prevX = currX;
00846         prevY = currY;
00847         prevY2 = currY2;
00848         dataArray++;
00849     }
00850 
00851     <span class="keywordflow">if</span> (value_flag) {
00852         draw_value(dataArray-1, vga_back.translate_color(series_color[0]), prevX+<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>, prevY-font_ptr-&gt;max_font_height/2, DATA_INT);
00853         draw_value(dataArray+(*data_num)-1, vga_back.translate_color(series_color[1]), prevX+<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>, prevY2-font_ptr-&gt;max_font_height/2, DATA_INT);
00854     }
00855 
00856     <span class="keywordflow">if</span>(series_num&gt;2) {
00857         dataArray+=(*data_num);
00858         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 2; i &lt; series_num; i++) {
00859             prevX = series_x1;
00860             dataArray-=(info.graph_year_passed);
00861             dataArray+=*data_num;
00862             <span class="comment">// Find Y by dataArray</span>
00863             <span class="comment">//                  if (x_axis_pos)</span>
00864             <span class="comment">//                          prevY = series_y2 - ((*dataArray+int(max_scale)) * (series_y2-series_y1) / int(max_scale*2));</span>
00865             <span class="comment">//                  else</span>
00866             <span class="comment">//                          prevY = series_y2 - *dataArray * (series_y2-series_y1) / int(max_scale);</span>
00867             prevY = (short)(x_axis_scr_pos-*dataArray*y_ratio);
00868 
00869             dataArray++;
00870 
00871             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt; (info.graph_year_passed); j++) {
00872                 currX = series_x1 + j * x_axis_step;
00873                 <span class="comment">//                              if (x_axis_pos)</span>
00874                 <span class="comment">//                                      currY = series_y2 - ((*dataArray+int(max_scale)) * (series_y2-series_y1) / int(max_scale*2));</span>
00875                 <span class="comment">//                              else</span>
00876                 <span class="comment">//                                      currY = series_y2 - *dataArray * (series_y2-series_y1) / int(max_scale);</span>
00877                 currY = (short)(x_axis_scr_pos-*dataArray*y_ratio);
00878 
00879                 vga_back.thick_line(prevX, prevY, currX, currY, vga_back.translate_color(series_color[i+2]));
00880 
00881                 prevX = currX;
00882                 prevY = currY;
00883                 dataArray++;
00884             }
00885             <span class="keywordflow">if</span> (value_flag)
00886                 draw_value(dataArray-1, vga_back.translate_color(series_color[i+2]), prevX+<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>, prevY-font_news.max_font_height/2, DATA_INT);
00887         }
00888 
00889     }
00890 }
00891 
00892 <span class="comment">//------------ End of function GraphArea2::draw_series_int ------------//</span>
00893 
00894 <span class="comment">//---------- Begin of function GraphArea2::draw_series_long ------------//</span>
<a name="l00896"></a><a class="code" href="classGraphArea2.html#b8">00896</a> <span class="comment">void GraphArea2::draw_series_long() {</span>
00897     <span class="keywordtype">long</span> *dataArray = (<span class="keywordtype">long</span> *) data_array;
00898     <span class="keywordtype">short</span> prevX, prevY, currX, currY;
00899     <span class="keywordtype">short</span> prevY2, currY2;
00900     <span class="keywordtype">short</span> fillY, fillY2;
00901     <span class="keywordtype">double</span> m,m2;
00902 
00903     <span class="comment">//Filling region</span>
00904     prevX = series_x1;
00905     dataArray-=(info.graph_year_passed);
00906     dataArray+=*data_num;
00907 
00908     <span class="comment">// Find Y by dataArray</span>
00909     <span class="comment">//  if (x_axis_pos)</span>
00910     <span class="comment">//          prevY = series_y2 - ((*dataArray+int(max_scale)) * (series_y2-series_y1) / int(max_scale*2));</span>
00911     <span class="comment">//  else</span>
00912     <span class="comment">//          prevY = series_y2 - *dataArray * (series_y2-series_y1) / int(max_scale);</span>
00913 
00914     <span class="comment">//  if (x_axis_pos)</span>
00915     <span class="comment">//          prevY2 = series_y2 - ((*(dataArray+(*data_num))+int(max_scale)) * (series_y2-series_y1) / int(max_scale*2));</span>
00916     <span class="comment">//  else</span>
00917     <span class="comment">//          prevY2 = series_y2 - *(dataArray+(*data_num)) * (series_y2-series_y1) / int(max_scale);</span>
00918 
00919     prevY = (short)(x_axis_scr_pos-*dataArray*y_ratio);
00920     prevY2 = (short)(x_axis_scr_pos-*(dataArray+(*data_num))*y_ratio);
00921 
00922     dataArray++;
00923 
00924     vga_back.thick_line(prevX, prevY, prevX+1, prevY, vga_back.translate_color(series_color[0]));
00925     vga_back.thick_line(prevX, prevY2, prevX+1, prevY2, vga_back.translate_color(series_color[1]));
00926 
00927     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt; (info.graph_year_passed); j++) {
00928         currX = series_x1 + j * x_axis_step;
00929         <span class="comment">//              if (x_axis_pos)</span>
00930         <span class="comment">//                      currY = series_y2 - ((*dataArray+int(max_scale)) * (series_y2-series_y1) / int(max_scale*2));</span>
00931         <span class="comment">//              else</span>
00932         <span class="comment">//                      currY = series_y2 - *dataArray * (series_y2-series_y1) / int(max_scale);</span>
00933         <span class="comment">//              if (x_axis_pos)</span>
00934         <span class="comment">//                      currY2 = series_y2 - ((*(dataArray+(*data_num))+int(max_scale)) * (series_y2-series_y1) / int(max_scale*2));</span>
00935         <span class="comment">//              else</span>
00936         <span class="comment">//                      currY2 = series_y2 - *(dataArray+(*data_num)) * (series_y2-series_y1) / int(max_scale);</span>
00937 
00938         currY = (short)(x_axis_scr_pos-*dataArray*y_ratio);
00939         currY2 = (short)(x_axis_scr_pos-*(dataArray+(*data_num))*y_ratio);
00940         <span class="comment">// filling region</span>
00941         m=((double)currY-prevY)/x_axis_step;
00942         m2=((double)currY2-prevY2)/x_axis_step;
00943 
00944         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;x_axis_step;i++) {
00945             fillY=(int)(m*i+prevY);
00946             fillY2=(int)(m2*i+prevY2);
00947             <span class="keywordflow">if</span>(fillY&gt;fillY2) {
00948                 <span class="keywordflow">if</span>(*(legend_array[3])!=<span class="charliteral">'\0'</span>)
00949                     vga_back.line(prevX+i, fillY, prevX+i, fillY2, vga_back.translate_color(series_color[3]));
00950             }
00951             <span class="keywordflow">else</span>
00952                 vga_back.line(prevX+i, fillY, prevX+i, fillY2, vga_back.translate_color(series_color[2]));
00953         }
00954 
00955         <span class="comment">// draw lines</span>
00956         vga_back.thick_line(prevX, prevY, currX, currY, vga_back.translate_color(series_color[0]));
00957         vga_back.thick_line(prevX, prevY2, currX, currY2, vga_back.translate_color(series_color[1]));
00958 
00959         prevX = currX;
00960         prevY = currY;
00961         prevY2 = currY2;
00962         dataArray++;
00963     }
00964 
00965     <span class="keywordflow">if</span> (value_flag) {
00966         draw_value(dataArray-1, vga_back.translate_color(series_color[0]), prevX+<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>, prevY-font_ptr-&gt;max_font_height/2, DATA_LONG);
00967         draw_value(dataArray+(*data_num)-1, vga_back.translate_color(series_color[1]), prevX+<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>, prevY2-font_ptr-&gt;max_font_height/2, DATA_LONG);
00968     }
00969 
00970     <span class="keywordflow">if</span>(series_num&gt;2) {
00971         dataArray+=(*data_num);
00972         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 2; i &lt; series_num; i++) {
00973             prevX = series_x1;
00974             dataArray-=(info.graph_year_passed);
00975             dataArray+=*data_num;
00976             <span class="comment">// Find Y by dataArray</span>
00977             <span class="comment">//                  if (x_axis_pos)</span>
00978             <span class="comment">//                          prevY = series_y2 - ((*dataArray+int(max_scale)) * (series_y2-series_y1) / int(max_scale*2));</span>
00979             <span class="comment">//                  else</span>
00980             <span class="comment">//                          prevY = series_y2 - *dataArray * (series_y2-series_y1) / int(max_scale);</span>
00981             prevY = (short)(x_axis_scr_pos-*dataArray*y_ratio);
00982 
00983             dataArray++;
00984 
00985             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt; (info.graph_year_passed); j++) {
00986                 currX = series_x1 + j * x_axis_step;
00987                 <span class="comment">//                              if (x_axis_pos)</span>
00988                 <span class="comment">//                                      currY = series_y2 - ((*dataArray+int(max_scale)) * (series_y2-series_y1) / int(max_scale*2));</span>
00989                 <span class="comment">//                              else</span>
00990                 <span class="comment">//                                      currY = series_y2 - *dataArray * (series_y2-series_y1) / int(max_scale);</span>
00991                 currY = (short)(x_axis_scr_pos-*dataArray*y_ratio);
00992 
00993                 vga_back.thick_line(prevX, prevY, currX, currY, vga_back.translate_color(series_color[i+2]));
00994 
00995                 prevX = currX;
00996                 prevY = currY;
00997                 dataArray++;
00998             }
00999             <span class="keywordflow">if</span> (value_flag)
01000                 draw_value(dataArray-1, vga_back.translate_color(series_color[i+2]), prevX+<a class="code" href="Ogrpare2_8cpp.html#a9a6">COMMON_OFFSET</a>, prevY-font_news.max_font_height/2, DATA_LONG);
01001         }
01002 
01003     }
01004 }
01005 
01006 <span class="comment">//------------ End of function GraphArea2::draw_series_float ------------//</span>
01007 
01008 <span class="comment">//---------- Begin of function GraphArea2::draw_value -------------------//</span>
<a name="l01010"></a><a class="code" href="classGraphArea2.html#b9">01010</a> <span class="comment">void GraphArea2::draw_value(void *value, int color, short x, short y, int dataType) {</span>
01011     <span class="keywordtype">char</span> *valueString;
01012     <span class="keywordflow">switch</span> (data_type_flag) {
01013     <span class="keywordflow">case</span> DATA_FLOAT:
01014         valueString = m.format(*((<span class="keywordtype">float</span> *) value), num_format); <span class="keywordflow">break</span>;
01015     <span class="keywordflow">case</span> DATA_DOUBLE:
01016         valueString = m.format(*((<span class="keywordtype">double</span> *) value), num_format); <span class="keywordflow">break</span>;
01017     <span class="keywordflow">case</span> DATA_INT:
01018         valueString = m.format(*((<span class="keywordtype">int</span> *) value), num_format); <span class="keywordflow">break</span>;
01019     <span class="keywordflow">case</span> DATA_LONG:
01020         valueString = m.format(*((<span class="keywordtype">long</span> *) value), num_format); <span class="keywordflow">break</span>;
01021     }
01022 
01023     <span class="keywordtype">short</span> textHeight = font_news.max_font_height;
01024     <span class="keywordtype">short</span> textWidth = font_news.text_width(valueString) + 1;
01025     <span class="comment">/*  </span>
01026 <span class="comment">        short *bitmap = (short *) sys.common_data_buf;</span>
01027 <span class="comment">        err_when( (2 + textWidth * textHeight) * sizeof(short) &gt; COMMON_DATA_BUF_SIZE );</span>
01028 <span class="comment">        *bitmap++ = textWidth;</span>
01029 <span class="comment">        *bitmap++ = textHeight;</span>
01030 <span class="comment"></span>
01031 <span class="comment">        short *shortPtr = bitmap;</span>
01032 <span class="comment">        for (int i = 0; i &lt; textWidth * textHeight; i++)</span>
01033 <span class="comment">        *shortPtr++ = transparent_code_w;</span>
01034 <span class="comment"></span>
01035 <span class="comment">        font_news.put_to_bufferW(bitmap, textWidth * sizeof(short), 0, 0, valueString);</span>
01036 <span class="comment"></span>
01037 <span class="comment">        shortPtr = bitmap;</span>
01038 <span class="comment">        for (i = 0; i &lt; textWidth * textHeight; i++, shortPtr++)</span>
01039 <span class="comment">        if (*shortPtr != transparent_code_w)</span>
01040 <span class="comment">        *shortPtr = color;</span>
01041 <span class="comment"></span>
01042 <span class="comment">        vga_back.put_bitmapW_trans(x, y, (short *) sys.common_data_buf);</span>
01043 <span class="comment">    */</span>
01044     font_chartsm.put(x+3,y,valueString);
01045 }
01046 
01047 <span class="comment">//---------- Begin of function GraphArea2::draw_value -------------------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:48 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
