<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OCOLTBL.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>OCOLTBL.CPP</h1><a href="OCOLTBL_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">// Filename    : OCOLTBL.CPP</span>
00002 <span class="comment">// Description : generated color remap table</span>
00003 
00004 <span class="preprocessor">#include &lt;<a class="code" href="OCOLTBL_8H.html">OCOLTBL.H</a>&gt;</span>
00005 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;math.h&gt;</span>
00007 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00008 
00009 <span class="comment">// ---------- define const -----------//</span>
00010 
00011 <span class="comment">// value of full intensity, 255 for 24-bit color, 64 for 18-bit color</span>
<a name="l00012"></a><a class="code" href="OCOLTBL_8CPP.html#a0">00012</a> <span class="preprocessor">#define MAX_COLOUR 255</span>
<a name="l00013"></a><a class="code" href="OCOLTBL_8CPP.html#a1">00013</a> <span class="preprocessor"></span><span class="preprocessor">#define M_PI 3.14159265359L</span>
<a name="l00014"></a><a class="code" href="OCOLTBL_8CPP.html#a2">00014</a> <span class="preprocessor"></span><span class="preprocessor">#define NEAREST_COLOR 8</span>
<a name="l00015"></a><a class="code" href="OCOLTBL_8CPP.html#a3">00015</a> <span class="preprocessor"></span><span class="preprocessor">#define BRIGHTNESS_WEIGHTING 4.0</span>
00016 <span class="preprocessor"></span>
<a name="l00017"></a><a class="code" href="classColorTable.html#p0">00017</a> BYTE <a class="code" href="classColorTable.html#p0">ColorTable::identity_table</a>[<a class="code" href="OCOLTBL_8H.html#a0">MAX_COLOUR_TABLE_SIZE</a>] = {
00018     0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f,
00019     0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17, 0x18, 0x19, 0x1a, 0x1b, 0x1c, 0x1d, 0x1e, 0x1f,
00020     0x20, 0x21, 0x22, 0x23, 0x24, 0x25, 0x26, 0x27, 0x28, 0x29, 0x2a, 0x2b, 0x2c, 0x2d, 0x2e, 0x2f,
00021     0x30, 0x31, 0x32, 0x33, 0x34, 0x35, 0x36, 0x37, 0x38, 0x39, 0x3a, 0x3b, 0x3c, 0x3d, 0x3e, 0x3f,
00022     0x40, 0x41, 0x42, 0x43, 0x44, 0x45, 0x46, 0x47, 0x48, 0x49, 0x4a, 0x4b, 0x4c, 0x4d, 0x4e, 0x4f,
00023     0x50, 0x51, 0x52, 0x53, 0x54, 0x55, 0x56, 0x57, 0x58, 0x59, 0x5a, 0x5b, 0x5c, 0x5d, 0x5e, 0x5f,
00024     0x60, 0x61, 0x62, 0x63, 0x64, 0x65, 0x66, 0x67, 0x68, 0x69, 0x6a, 0x6b, 0x6c, 0x6d, 0x6e, 0x6f,
00025     0x70, 0x71, 0x72, 0x73, 0x74, 0x75, 0x76, 0x77, 0x78, 0x79, 0x7a, 0x7b, 0x7c, 0x7d, 0x7e, 0x7f,
00026     0x80, 0x81, 0x82, 0x83, 0x84, 0x85, 0x86, 0x87, 0x88, 0x89, 0x8a, 0x8b, 0x8c, 0x8d, 0x8e, 0x8f,
00027     0x90, 0x91, 0x92, 0x93, 0x94, 0x95, 0x96, 0x97, 0x98, 0x99, 0x9a, 0x9b, 0x9c, 0x9d, 0x9e, 0x9f,
00028     0xa0, 0xa1, 0xa2, 0xa3, 0xa4, 0xa5, 0xa6, 0xa7, 0xa8, 0xa9, 0xaa, 0xab, 0xac, 0xad, 0xae, 0xaf,
00029     0xb0, 0xb1, 0xb2, 0xb3, 0xb4, 0xb5, 0xb6, 0xb7, 0xb8, 0xb9, 0xba, 0xbb, 0xbc, 0xbd, 0xbe, 0xbf,
00030     0xc0, 0xc1, 0xc2, 0xc3, 0xc4, 0xc5, 0xc6, 0xc7, 0xc8, 0xc9, 0xca, 0xcb, 0xcc, 0xcd, 0xce, 0xcf,
00031     0xd0, 0xd1, 0xd2, 0xd3, 0xd4, 0xd5, 0xd6, 0xd7, 0xd8, 0xd9, 0xda, 0xdb, 0xdc, 0xdd, 0xde, 0xdf,
00032     0xe0, 0xe1, 0xe2, 0xe3, 0xe4, 0xe5, 0xe6, 0xe7, 0xe8, 0xe9, 0xea, 0xeb, 0xec, 0xed, 0xee, 0xef,
00033     0xf0, 0xf1, 0xf2, 0xf3, 0xf4, 0xf5, 0xf6, 0xf7, 0xf8, 0xf9, 0xfa, 0xfb, 0xfc, 0xfd, 0xfe, 0xff
00034 };
00035 
00036 <span class="comment">// --------- define inline function ---------//</span>
00037 
<a name="l00038"></a><a class="code" href="OCOLTBL_8CPP.html#a4">00038</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="OCOLTBL_8CPP.html#a4">sq</a>(<span class="keywordtype">int</span> a) {
00039     <span class="keywordflow">return</span> a*a;
00040 }
00041 
00042 <span class="comment">// ---------- begin of function ColorTable::ColorTable ----------//</span>
<a name="l00043"></a><a class="code" href="classColorTable.html#a0">00043</a> <a class="code" href="classColorTable.html#a0">ColorTable::ColorTable</a>() {
00044     remap_table = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00045     remap_table_array = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00046 }
00047 
<a name="l00048"></a><a class="code" href="classColorTable.html#a1">00048</a> <a class="code" href="classColorTable.html#a0">ColorTable::ColorTable</a>(<span class="keywordtype">int</span> absScale, <span class="keywordtype">int</span> tableSize, <a class="code" href="OCOLTBL_8H.html#a2">WORD</a> *customTable) {
00049     remap_table = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00050     remap_table_array = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00051     <a class="code" href="classColorTable.html#a4">init</a>(absScale, tableSize, customTable);
00052 }
00053 
00054 <span class="comment">// ---------- end of function ColorTable::ColorTable ----------//</span>
00055 
00056 <span class="comment">// ---------- begin of function ColorTable::ColorTable ----------//</span>
<a name="l00057"></a><a class="code" href="classColorTable.html#a2">00057</a> <a class="code" href="classColorTable.html#a0">ColorTable::ColorTable</a>(<span class="keyword">const</span> <a class="code" href="classColorTable.html">ColorTable</a>&amp; ct) : abs_scale(ct.abs_scale),
00058                                                table_size(ct.table_size) {
00059     <span class="keywordflow">if</span>( ct.remap_table ) {
00060         remap_table = (<a class="code" href="OCOLTBL_8H.html#a2">WORD</a> *)<a class="code" href="ALL_8H.html#a5">mem_add</a>(<a class="code" href="classColorTable.html#m1">table_size</a> * (2*<a class="code" href="classColorTable.html#m0">abs_scale</a>+1) * <span class="keyword">sizeof</span>(<a class="code" href="OCOLTBL_8H.html#a2">WORD</a>) );
00061         memcpy(remap_table, ct.remap_table, <a class="code" href="classColorTable.html#m1">table_size</a> * (2*<a class="code" href="classColorTable.html#m0">abs_scale</a>+1) * <span class="keyword">sizeof</span>(<a class="code" href="OCOLTBL_8H.html#a2">WORD</a>) );
00062         remap_table_array = (<a class="code" href="OCOLTBL_8H.html#a2">WORD</a> **)<a class="code" href="ALL_8H.html#a5">mem_add</a>(<span class="keyword">sizeof</span>(<a class="code" href="OCOLTBL_8H.html#a2">WORD</a> *) * (2*<a class="code" href="classColorTable.html#m0">abs_scale</a>+1) );
00063         create_table_array();
00064     }
00065     <span class="keywordflow">else</span> {
00066         remap_table = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00067         remap_table_array = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00068     }
00069 }
00070 
00071 <span class="comment">// ---------- end of function ColorTable::ColorTable ----------//</span>
00072 
00073 <span class="comment">// ---------- begin of function ColorTable::~ColorTable ----------//</span>
<a name="l00074"></a><a class="code" href="classColorTable.html#a3">00074</a> <a class="code" href="classColorTable.html#a3">ColorTable::~ColorTable</a>() {
00075     <a class="code" href="classColorTable.html#a6">deinit</a>();
00076 }
00077 
00078 <span class="comment">// ---------- end of function ColorTable::~ColorTable ----------//</span>
00079 
00080 <span class="comment">// ---------- begin of function ColorTable::init ----------//</span>
<a name="l00081"></a><a class="code" href="classColorTable.html#a4">00081</a> <span class="keywordtype">void</span> <a class="code" href="classColorTable.html#a4">ColorTable::init</a>() {
00082     <a class="code" href="classColorTable.html#a6">deinit</a>();
00083     <a class="code" href="classColorTable.html#m0">abs_scale</a> = 0;
00084 }
00085 
00086 <span class="comment">// initialize a custom table, given the no. of absolute scale and table size</span>
00087 <span class="comment">// the customTable array is (2*absScale+1) groups</span>
00088 <span class="comment">// and each group has (tableSize) bytes of remapping entries</span>
<a name="l00089"></a><a class="code" href="classColorTable.html#a5">00089</a> <span class="keywordtype">void</span> <a class="code" href="classColorTable.html#a4">ColorTable::init</a>(<span class="keywordtype">int</span> absScale, <span class="keywordtype">int</span> tableSize, <a class="code" href="OCOLTBL_8H.html#a2">WORD</a> *customTable) {
00090     <a class="code" href="classColorTable.html#a6">deinit</a>();
00091 
00092     <a class="code" href="classColorTable.html#m0">abs_scale</a> = absScale;
00093     <a class="code" href="classColorTable.html#m1">table_size</a> = <a class="code" href="classColorTable.html#m1">table_size</a>;
00094     remap_table = (<a class="code" href="OCOLTBL_8H.html#a2">WORD</a> *)<a class="code" href="ALL_8H.html#a5">mem_add</a>(<a class="code" href="classColorTable.html#m1">table_size</a> * (2*absScale+1) * <span class="keyword">sizeof</span>(<a class="code" href="OCOLTBL_8H.html#a2">WORD</a>) );
00095     memcpy(remap_table, customTable, tableSize * (2*absScale+1) * <span class="keyword">sizeof</span>(<a class="code" href="OCOLTBL_8H.html#a2">WORD</a>) );
00096     remap_table_array = (<a class="code" href="OCOLTBL_8H.html#a2">WORD</a> **)<a class="code" href="ALL_8H.html#a5">mem_add</a>(<span class="keyword">sizeof</span>(<a class="code" href="OCOLTBL_8H.html#a2">WORD</a> *) * (2*absScale+1) );
00097     create_table_array();
00098 }
00099 
00100 <span class="comment">// ---------- end of function ColorTable::init ----------//</span>
00101 
00102 <span class="comment">// ---------- begin of function ColorTable::deinit ----------//</span>
<a name="l00103"></a><a class="code" href="classColorTable.html#a6">00103</a> <span class="keywordtype">void</span> <a class="code" href="classColorTable.html#a6">ColorTable::deinit</a>() {
00104     <span class="keywordflow">if</span>( remap_table ) {
00105         <a class="code" href="ALL_8H.html#a8">mem_del</a>( remap_table );
00106         remap_table = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00107     }
00108     <span class="keywordflow">if</span>( remap_table_array) {
00109         <a class="code" href="ALL_8H.html#a8">mem_del</a>( remap_table_array);
00110         remap_table_array = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00111     }
00112 }
00113 
00114 <span class="comment">// ---------- end of function ColorTable::deinit ----------//</span>
00115 
00116 <span class="comment">// ---------- begin of function ColorTable::operator= ----------//</span>
<a name="l00117"></a><a class="code" href="classColorTable.html#a7">00117</a> <a class="code" href="classColorTable.html">ColorTable</a>&amp; <a class="code" href="classColorTable.html#a7">ColorTable::operator=</a>(<span class="keyword">const</span> <a class="code" href="classColorTable.html">ColorTable</a>&amp; ct) {
00118     <a class="code" href="classColorTable.html#a6">deinit</a>();
00119 
00120     <a class="code" href="classColorTable.html#m0">abs_scale</a> = ct.<a class="code" href="classColorTable.html#m0">abs_scale</a>;
00121     <a class="code" href="classColorTable.html#m1">table_size</a>= ct.<a class="code" href="classColorTable.html#m1">table_size</a>;
00122 
00123     <span class="keywordflow">if</span>( ct.<a class="code" href="classColorTable.html#o0">remap_table</a> ) {
00124         remap_table = (<a class="code" href="OCOLTBL_8H.html#a2">WORD</a> *)<a class="code" href="ALL_8H.html#a5">mem_add</a>(<a class="code" href="classColorTable.html#m1">table_size</a> * (2*<a class="code" href="classColorTable.html#m0">abs_scale</a>+1) );
00125         memcpy(remap_table, ct.<a class="code" href="classColorTable.html#o0">remap_table</a>, <a class="code" href="classColorTable.html#m1">table_size</a> * (2*<a class="code" href="classColorTable.html#m0">abs_scale</a>+1) * <span class="keyword">sizeof</span>(<a class="code" href="OCOLTBL_8H.html#a2">WORD</a>) );
00126         remap_table_array = (<a class="code" href="OCOLTBL_8H.html#a2">WORD</a> **)<a class="code" href="ALL_8H.html#a5">mem_add</a>(<span class="keyword">sizeof</span>(<a class="code" href="OCOLTBL_8H.html#a2">WORD</a> *) * (2*<a class="code" href="classColorTable.html#m0">abs_scale</a>+1) );
00127         create_table_array();
00128     }
00129     <span class="keywordflow">else</span> {
00130         remap_table = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00131         remap_table_array = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00132     }
00133 
00134     <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00135 }
00136 
00137 <span class="comment">// ---------- begin of function ColorTable::operator= ----------//</span>
00138 
00139 <span class="comment">// ---------- begin of function ColorTable::generate_table ----------//</span>
00140 <span class="comment">//</span>
00141 <span class="comment">// generate +absScale to -absScale (total 2*absScale +1 remap table )</span>
00142 <span class="comment">// from palette pal (768 byte)</span>
00143 <span class="comment">// any color in the reservedColor is unmodified</span>
00144 <span class="comment">// note reservedColor array must be in accending order</span>
00145 <span class="comment">//</span>
00146 <span class="comment">// &lt;int&gt; absScale              number of scale to full white/full black</span>
00147 <span class="comment">// &lt;BYTE *&gt;pal                 input palette, size must be 3*table_size</span>
00148 <span class="comment">// &lt;int&gt;palSize                size of palette entry</span>
00149 <span class="comment">// &lt;BYTE *&gt;reservedColor      array of reserved color,</span>
00150 <span class="comment">// &lt;int&gt; reservedCount         size of reservedColor</span>
00151 <span class="comment">// reserved color will map to itself and will not be mapped except by itself</span>
00152 <span class="comment">//</span>
<a name="l00153"></a><a class="code" href="classColorTable.html#a8">00153</a> <span class="keywordtype">void</span> <a class="code" href="classColorTable.html#a8">ColorTable::generate_table</a>(<span class="keywordtype">int</span> absScale, <a class="code" href="structPalDesc.html">PalDesc</a> &amp; palD, <a class="code" href="structRGBColor.html">RGBColor</a> (*fp)(<a class="code" href="structRGBColor.html">RGBColor</a>, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>)) {
00154     <span class="keywordtype">int</span> palSize = palD.<a class="code" href="structPalDesc.html#m2">pal_size</a>;
00155 
00156     <a class="code" href="ALL_8H.html#a0">err_when</a>(absScale &lt; 0 || palD.<a class="code" href="structPalDesc.html#m5">reserved_count</a> &lt; 0 || palD.<a class="code" href="structPalDesc.html#m0">pal</a> == <a class="code" href="OHELP_8H.html#a0">NULL</a>);
00157     <a class="code" href="ALL_8H.html#a0">err_when</a>(palSize &gt; <a class="code" href="OCOLTBL_8H.html#a0">MAX_COLOUR_TABLE_SIZE</a>);
00158     <a class="code" href="classColorTable.html#a6">deinit</a>();
00159 
00160     <a class="code" href="classColorTable.html#m0">abs_scale</a> = absScale;
00161     <a class="code" href="classColorTable.html#m1">table_size</a> = palSize;
00162     <a class="code" href="OCOLTBL_8H.html#a2">WORD</a> *remapEntry = remap_table = (<a class="code" href="OCOLTBL_8H.html#a2">WORD</a> *)<a class="code" href="ALL_8H.html#a5">mem_add</a>(<a class="code" href="classColorTable.html#m1">table_size</a> * (2*absScale+1) * <span class="keyword">sizeof</span>(<a class="code" href="OCOLTBL_8H.html#a2">WORD</a>) );
00163     remap_table_array = (<a class="code" href="OCOLTBL_8H.html#a2">WORD</a> **)<a class="code" href="ALL_8H.html#a5">mem_add</a>(<span class="keyword">sizeof</span>(<a class="code" href="OCOLTBL_8H.html#a2">WORD</a> *) * (2*absScale+1) );
00164 
00165     <span class="keywordtype">int</span> scale, c;
00166 
00167     <span class="comment">// ------- generate negative scale ----------//</span>
00168     <span class="keywordflow">for</span>( scale = -absScale; scale &lt;= absScale; ++scale) {
00169         <span class="keywordflow">for</span>( c=0; c &lt; palSize; ++c, ++remapEntry) {
00170             <a class="code" href="structRGBColor.html">RGBColor</a> rgb = (*fp)(palD.<a class="code" href="structPalDesc.html#a5">get_rgb</a>(c), scale, absScale);
00171             *remapEntry = vga.make_pixel(&amp;rgb);
00172         }
00173     }
00174 
00175     create_table_array();
00176 }
00177 
00178 <span class="comment">// ---------- end of function ColorTable::generate_table ----------//</span>
00179 
00180 <span class="comment">// ---------- begin of function ColorTable::generate_table_fast ----------//</span>
00181 <span class="comment">//  simplified version, it ignores reserved colors</span>
<a name="l00182"></a><a class="code" href="classColorTable.html#a9">00182</a> <span class="keywordtype">void</span> <a class="code" href="classColorTable.html#a9">ColorTable::generate_table_fast</a> (<span class="keywordtype">int</span> absScale, <a class="code" href="structPalDesc.html">PalDesc</a> &amp;palD, <a class="code" href="structRGBColor.html">RGBColor</a> (*fp)(<a class="code" href="structRGBColor.html">RGBColor</a>, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>)) {
00183     <span class="keywordtype">int</span> palSize = palD.<a class="code" href="structPalDesc.html#m2">pal_size</a>;
00184 
00185     <a class="code" href="ALL_8H.html#a0">err_when</a>(absScale &lt; 0 || palD.<a class="code" href="structPalDesc.html#m5">reserved_count</a> &lt; 0 || palD.<a class="code" href="structPalDesc.html#m0">pal</a> == <a class="code" href="OHELP_8H.html#a0">NULL</a>);
00186     <a class="code" href="ALL_8H.html#a0">err_when</a>(palSize &gt; <a class="code" href="OCOLTBL_8H.html#a0">MAX_COLOUR_TABLE_SIZE</a>);
00187     <a class="code" href="classColorTable.html#a6">deinit</a>();
00188 
00189     <a class="code" href="classColorTable.html#m0">abs_scale</a> = absScale;
00190     <a class="code" href="classColorTable.html#m1">table_size</a> = palSize;
00191     <a class="code" href="OCOLTBL_8H.html#a2">WORD</a> *remapEntry = remap_table = (<a class="code" href="OCOLTBL_8H.html#a2">WORD</a> *)<a class="code" href="ALL_8H.html#a5">mem_add</a>(<a class="code" href="classColorTable.html#m1">table_size</a> * (2*absScale+1) * <span class="keyword">sizeof</span>(<a class="code" href="OCOLTBL_8H.html#a2">WORD</a>) );
00192     remap_table_array = (<a class="code" href="OCOLTBL_8H.html#a2">WORD</a> **)<a class="code" href="ALL_8H.html#a5">mem_add</a>(<span class="keyword">sizeof</span>(<a class="code" href="OCOLTBL_8H.html#a2">WORD</a> *) * (2*absScale+1) );
00193 
00194     <span class="keywordtype">int</span> scale, c;
00195 
00196     <span class="comment">// ------- generate negative scale ----------//</span>
00197     <span class="keywordflow">for</span>( scale = -absScale; scale &lt;= absScale; ++scale) {
00198         <span class="keywordflow">for</span>( c=0; c &lt; palSize; ++c, ++remapEntry) {
00199             <a class="code" href="structRGBColor.html">RGBColor</a> rgb = (*fp)(palD.<a class="code" href="structPalDesc.html#a5">get_rgb</a>(c), scale, absScale);
00200             *remapEntry = vga.make_pixel(&amp;rgb);
00201         }
00202     }
00203 
00204     create_table_array();
00205 }
00206 
00207 <span class="comment">// ---------- end of function ColorTable::generate_table_fast ----------//</span>
00208 
00209 <span class="comment">// ---------- begin of function ColorTable::generate_table ----------//</span>
00210 <span class="comment">//</span>
00211 <span class="comment">// match one set of palette with a universal palette</span>
00212 <span class="comment">// the set of palette is pointed by sPal, size is sPalSize,</span>
00213 <span class="comment">// with some reserved color pointed by sReservedColor and size is sReservedCount</span>
00214 <span class="comment">// the univeral palette is pointed by Pal, size is PalSize,</span>
00215 <span class="comment">// with some reserved color pointed by reservedColor and size is reservedCount</span>
00216 <span class="comment">// note : numbers in reservedColor must be in ascending order</span>
00217 <span class="comment">//</span>
00218 <span class="comment">// generated map size must be palSize and it has only scale</span>
00219 <span class="comment">//</span>
<a name="l00220"></a><a class="code" href="classColorTable.html#a10">00220</a> <span class="keywordtype">void</span> <a class="code" href="classColorTable.html#a8">ColorTable::generate_table</a>(<a class="code" href="structPalDesc.html">PalDesc</a> &amp;sPalD, <a class="code" href="structPalDesc.html">PalDesc</a> &amp;palD) {
00221     <span class="keywordtype">int</span> sPalSize = sPalD.<a class="code" href="structPalDesc.html#m2">pal_size</a>, palSize = palD.<a class="code" href="structPalDesc.html#m2">pal_size</a>;
00222 
00223     <a class="code" href="ALL_8H.html#a0">err_when</a>(sPalD.<a class="code" href="structPalDesc.html#m0">pal</a> == <a class="code" href="OHELP_8H.html#a0">NULL</a> || sPalSize &lt;= 0 || sPalD.<a class="code" href="structPalDesc.html#m5">reserved_count</a> &lt; 0);
00224     <a class="code" href="ALL_8H.html#a0">err_when</a>(palD.<a class="code" href="structPalDesc.html#m0">pal</a> == <a class="code" href="OHELP_8H.html#a0">NULL</a> || palSize &lt;= 0 || palD.<a class="code" href="structPalDesc.html#m5">reserved_count</a> &lt; 0);
00225     <a class="code" href="ALL_8H.html#a0">err_when</a>(palSize &gt; <a class="code" href="OCOLTBL_8H.html#a0">MAX_COLOUR_TABLE_SIZE</a> || sPalSize &gt; <a class="code" href="OCOLTBL_8H.html#a0">MAX_COLOUR_TABLE_SIZE</a>);
00226     <a class="code" href="classColorTable.html#a6">deinit</a>();
00227 
00228     <a class="code" href="classColorTable.html#m0">abs_scale</a> = 0;
00229     <a class="code" href="classColorTable.html#m1">table_size</a> = sPalSize;
00230     <a class="code" href="OCOLTBL_8H.html#a2">WORD</a> *remapEntry = remap_table = (<a class="code" href="OCOLTBL_8H.html#a2">WORD</a> *)<a class="code" href="ALL_8H.html#a5">mem_add</a>(sPalSize);
00231     remap_table_array = (<a class="code" href="OCOLTBL_8H.html#a2">WORD</a> **)<a class="code" href="ALL_8H.html#a5">mem_add</a>(<span class="keyword">sizeof</span>(<a class="code" href="OCOLTBL_8H.html#a2">WORD</a> *));
00232 
00233     <span class="keywordtype">int</span> sReservedIndex = 0;
00234     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=0; c &lt; sPalSize; ++c, ++remapEntry) {
00235         *remapEntry = c;                              <span class="comment">// put a default value (as if it is a reserved color)</span>
00236 
00237         <span class="comment">// ------ see if it is a reserved color --------//</span>
00238         <span class="keywordflow">if</span>( sPalD.<a class="code" href="structPalDesc.html#a6">is_reserved</a>(c, sReservedIndex))
00239             <span class="keywordflow">continue</span>;
00240 
00241         <a class="code" href="structRGBColor.html">RGBColor</a> rgb = sPalD.<a class="code" href="structPalDesc.html#a5">get_rgb</a>(c);
00242 
00243         <span class="comment">// ------- scan the closet color, except the reserved color</span>
00244         <span class="keywordtype">int</span> cc, dist[<a class="code" href="OCOLTBL_8CPP.html#a2">NEAREST_COLOR</a>], thisDiff;
00245         BYTE closeColor[<a class="code" href="OCOLTBL_8CPP.html#a2">NEAREST_COLOR</a>];               <span class="comment">// [0] is the closest</span>
00246 
00247         <span class="keywordflow">for</span>( cc = 0; cc &lt; <a class="code" href="OCOLTBL_8CPP.html#a2">NEAREST_COLOR</a>; ++cc ) {
00248             closeColor[cc] = c;
00249             dist[cc] = 3*0xff*0xff+1;
00250         }
00251         <span class="keywordtype">int</span> dReservedIndex = 0;
00252         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> d=0; d &lt; palSize; ++d) {
00253             <span class="comment">// ------- skip scanning reserved color ------//</span>
00254             <span class="keywordflow">if</span>( palD.<a class="code" href="structPalDesc.html#a6">is_reserved</a>(d, dReservedIndex) )
00255                 <span class="keywordflow">continue</span>;
00256 
00257             <span class="comment">// ------- compare the sqaure distance ----------//</span>
00258             thisDiff = color_dist(rgb, palD.<a class="code" href="structPalDesc.html#a5">get_rgb</a>(d));
00259 
00260             <span class="keywordflow">if</span>( thisDiff &lt; dist[<a class="code" href="OCOLTBL_8CPP.html#a2">NEAREST_COLOR</a>-1]) {
00261                 BYTE d1 = (BYTE) d;
00262                 <span class="keywordflow">for</span>( cc = 0; cc &lt; <a class="code" href="OCOLTBL_8CPP.html#a2">NEAREST_COLOR</a>; ++cc ) {
00263                     <span class="keywordflow">if</span>( thisDiff &lt; dist[cc] ) {
00264                         <span class="comment">// swap thisDiff and dist[cc]</span>
00265                         <span class="comment">// so that the replaced result will be shifted to next</span>
00266                         <span class="keywordtype">int</span> tempd;
00267                         BYTE tempc;
00268                         tempd = dist[cc];
00269                         dist[cc] = thisDiff;
00270                         thisDiff = tempd;
00271 
00272                         tempc = closeColor[cc];
00273                         closeColor[cc] = d1;
00274                         d1 = tempc;
00275                     }
00276                 }
00277             }
00278         }
00279 
00280         <span class="comment">// closeColor[] are the closest 8 colours, use hsv comparison to find the nearest</span>
00281         d = closeColor[0];
00282         *remapEntry = d;
00283         <span class="keywordtype">int</span> minDiff = color_dist_hsv(rgb, palD.<a class="code" href="structPalDesc.html#a5">get_rgb</a>(d));
00284         <span class="keywordflow">for</span>( cc = 1; cc &lt; <a class="code" href="OCOLTBL_8CPP.html#a2">NEAREST_COLOR</a>; ++cc) {
00285             d = closeColor[cc];
00286             thisDiff = color_dist_hsv(rgb, palD.<a class="code" href="structPalDesc.html#a5">get_rgb</a>(d));
00287             <span class="keywordflow">if</span>( thisDiff &lt; minDiff ) {
00288                 minDiff = thisDiff;
00289                 *remapEntry = d;
00290             }
00291         }
00292     }
00293 
00294     create_table_array();
00295 }
00296 
00297 <span class="comment">// ---------- end of function ColorTable::generate_table ----------//</span>
00298 
00299 <span class="comment">// ---------- begin of function ColorTable::get_table ----------//</span>
<a name="l00300"></a><a class="code" href="classColorTable.html#a11">00300</a> <a class="code" href="OCOLTBL_8H.html#a2">WORD</a> *<a class="code" href="classColorTable.html#a11">ColorTable::get_table</a>(<span class="keywordtype">int</span> scale) {
00301     <a class="code" href="ALL_8H.html#a0">err_when</a>( !remap_table );
00302     <a class="code" href="ALL_8H.html#a0">err_when</a>( scale &lt; -abs_scale || scale &gt; <a class="code" href="classColorTable.html#m0">abs_scale</a>);
00303     <span class="keywordflow">return</span> remap_table + <a class="code" href="classColorTable.html#m1">table_size</a> * (scale + <a class="code" href="classColorTable.html#m0">abs_scale</a>);
00304 }
00305 
00306 <span class="comment">// ---------- end of function ColorTable::get_table ----------//</span>
00307 
00308 <span class="comment">// ---------- begin of function ColorTable::create_table_array ----------//</span>
00309 <span class="keywordtype">void</span> ColorTable::create_table_array() {
00310     <a class="code" href="ALL_8H.html#a0">err_when</a>( !remap_table );
00311     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> j = 0; j &lt; 2*<a class="code" href="classColorTable.html#m0">abs_scale</a>+1; ++j) {
00312         remap_table_array[j] = remap_table + <a class="code" href="classColorTable.html#m1">table_size</a> * j;
00313     }
00314 }
00315 
00316 <span class="comment">// ---------- end of function ColorTable::create_table_array ----------//</span>
00317 
00318 <span class="comment">// ---------- begin of function ColorTable::bright_func ---------//</span>
<a name="l00319"></a><a class="code" href="classColorTable.html#d0">00319</a> <a class="code" href="structRGBColor.html">RGBColor</a> <a class="code" href="classColorTable.html#d0">ColorTable::bright_func</a>(<a class="code" href="structRGBColor.html">RGBColor</a> c, <span class="keywordtype">int</span> scale, <span class="keywordtype">int</span> absScale) {
00320     <a class="code" href="structRGBColor.html">RGBColor</a> ans;
00321     <span class="keywordflow">if</span>( scale &lt; 0) {
00322         <span class="keywordtype">double</span> factor = sqrt(<span class="keywordtype">double</span>(absScale + scale) / absScale);
00323         ans.<a class="code" href="structRGBColor.html#m0">red</a> = <a class="code" href="OVGA_8H.html#a10">BYTE</a>(c.<a class="code" href="structRGBColor.html#m0">red</a> * factor);
00324         ans.<a class="code" href="structRGBColor.html#m1">green</a> = <a class="code" href="OVGA_8H.html#a10">BYTE</a>(c.<a class="code" href="structRGBColor.html#m1">green</a> * factor);
00325         ans.<a class="code" href="structRGBColor.html#m2">blue</a> = <a class="code" href="OVGA_8H.html#a10">BYTE</a>(c.<a class="code" href="structRGBColor.html#m2">blue</a> * factor);
00326     }
00327     <span class="keywordflow">else</span> {
00328         ans.<a class="code" href="structRGBColor.html#m0">red</a> = c.<a class="code" href="structRGBColor.html#m0">red</a> + (<a class="code" href="OCOLTBL_8CPP.html#a0">MAX_COLOUR</a> - c.<a class="code" href="structRGBColor.html#m0">red</a>) * scale / absScale;
00329         ans.<a class="code" href="structRGBColor.html#m1">green</a> = c.<a class="code" href="structRGBColor.html#m1">green</a> + (<a class="code" href="OCOLTBL_8CPP.html#a0">MAX_COLOUR</a> - c.<a class="code" href="structRGBColor.html#m1">green</a>) * scale / absScale;
00330         ans.<a class="code" href="structRGBColor.html#m2">blue</a> = c.<a class="code" href="structRGBColor.html#m2">blue</a> + (<a class="code" href="OCOLTBL_8CPP.html#a0">MAX_COLOUR</a> - c.<a class="code" href="structRGBColor.html#m2">blue</a>) * scale / absScale;
00331     }
00332     <span class="keywordflow">return</span> ans;
00333 }
00334 
00335 <span class="comment">// ---------- end of function ColorTable::bright_func ---------//</span>
00336 
00337 <span class="comment">// ---------- begin of function ColorTable::patch_table --------//</span>
<a name="l00338"></a><a class="code" href="classColorTable.html#a13">00338</a> <span class="keywordtype">void</span> <a class="code" href="classColorTable.html#a13">ColorTable::patch_table</a>(BYTE from, <a class="code" href="OCOLTBL_8H.html#a2">WORD</a> to) {
00339     <a class="code" href="ALL_8H.html#a0">err_when</a>(from &gt;= <a class="code" href="classColorTable.html#m1">table_size</a>);
00340     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> s = -<a class="code" href="classColorTable.html#m0">abs_scale</a>; s &lt;= <a class="code" href="classColorTable.html#m0">abs_scale</a>; ++s) {
00341         <a class="code" href="classColorTable.html#a11">get_table</a>(s)[from] = to;
00342     }
00343 }
00344 
00345 <span class="comment">// ---------- end of function ColorTable::patch_table --------//</span>
00346 
00347 <span class="comment">// ---------- begin of function ColorTable::color_dist --------//</span>
00348 <span class="keywordtype">int</span> ColorTable::color_dist(<a class="code" href="structRGBColor.html">RGBColor</a> c1, <a class="code" href="structRGBColor.html">RGBColor</a> c2) {
00349     <span class="keywordflow">return</span> <a class="code" href="OCOLTBL_8CPP.html#a4">sq</a>((<span class="keywordtype">int</span>)c2.<a class="code" href="structRGBColor.html#m0">red</a>-c1.<a class="code" href="structRGBColor.html#m0">red</a>) + <a class="code" href="OCOLTBL_8CPP.html#a4">sq</a>((<span class="keywordtype">int</span>)c2.<a class="code" href="structRGBColor.html#m1">green</a>-c1.<a class="code" href="structRGBColor.html#m1">green</a>) + <a class="code" href="OCOLTBL_8CPP.html#a4">sq</a>((<span class="keywordtype">int</span>)c2.<a class="code" href="structRGBColor.html#m2">blue</a>-c1.<a class="code" href="structRGBColor.html#m2">blue</a>);
00350 }
00351 
00352 <span class="comment">// ---------- end of function ColorTable::color_dist --------//</span>
00353 
00354 <span class="comment">// ---------- begin of function ColorTable::color_dist_hsv --------//</span>
00355 <span class="keywordtype">int</span> ColorTable::color_dist_hsv(<a class="code" href="structRGBColor.html">RGBColor</a> c1, <a class="code" href="structRGBColor.html">RGBColor</a> c2) {
00356     <span class="comment">// calculate a distance for the colour</span>
00357     <span class="comment">// h betweeh 0 and 6</span>
00358     <span class="comment">// s between 0 and 1</span>
00359     <span class="comment">// v between 0 and 1</span>
00360     <a class="code" href="structHSVColor.html">HSVColor</a> hsv1(rgb2hsv(c1));
00361     <a class="code" href="structHSVColor.html">HSVColor</a> hsv2(rgb2hsv(c2));;
00362 
00363     <span class="keywordtype">double</span> dx = hsv2.<a class="code" href="structHSVColor.html#m1">saturation</a> * cos(hsv2.<a class="code" href="structHSVColor.html#m0">hue</a> * <a class="code" href="OCOLTBL_8CPP.html#a1">M_PI</a> / 3.0) - hsv1.<a class="code" href="structHSVColor.html#m1">saturation</a> * cos(hsv1.<a class="code" href="structHSVColor.html#m0">hue</a> * <a class="code" href="OCOLTBL_8CPP.html#a1">M_PI</a> / 3.0);
00364     <span class="keywordtype">double</span> dy = hsv2.<a class="code" href="structHSVColor.html#m1">saturation</a> * sin(hsv2.<a class="code" href="structHSVColor.html#m0">hue</a> * <a class="code" href="OCOLTBL_8CPP.html#a1">M_PI</a> / 3.0) - hsv1.<a class="code" href="structHSVColor.html#m1">saturation</a> * sin(hsv1.<a class="code" href="structHSVColor.html#m0">hue</a> * <a class="code" href="OCOLTBL_8CPP.html#a1">M_PI</a> / 3.0);
00365     <span class="keywordtype">double</span> dv = hsv2.<a class="code" href="structHSVColor.html#m2">brightness</a> - hsv1.<a class="code" href="structHSVColor.html#m2">brightness</a>;
00366 
00367     <span class="keywordflow">return</span> <span class="keywordtype">int</span>(10000 * ( dx*dx + dy*dy + dv*dv*<a class="code" href="OCOLTBL_8CPP.html#a3">BRIGHTNESS_WEIGHTING</a> ));
00368 }
00369 
00370 <span class="comment">// ---------- end of function ColorTable::color_dist_hsv --------//</span>
00371 
00372 <span class="comment">// -------- begin of function ColorTable::rgb2hsv ---------//</span>
00373 <a class="code" href="structHSVColor.html">HSVColor</a> ColorTable::rgb2hsv(<a class="code" href="structRGBColor.html">RGBColor</a> &amp;rgb) {
00374     <span class="keywordflow">if</span>( rgb.red == rgb.green &amp;&amp; rgb.red == rgb.blue) {
00375         <span class="keywordflow">return</span> <a class="code" href="structHSVColor.html">HSVColor</a>(1.0, 0.0, rgb.red / 255.0);
00376     }
00377 
00378     <span class="comment">// find the smallest colour</span>
00379     <span class="keywordflow">if</span>( rgb.red &lt;= rgb.green &amp;&amp; rgb.red &lt;= rgb.blue) {
00380         <span class="keywordflow">if</span>( rgb.green &gt;= rgb.blue ) {
00381             <span class="comment">// g is the primary, b is secondary</span>
00382             <span class="keywordflow">return</span> <a class="code" href="structHSVColor.html">HSVColor</a>( 2.0 + (<span class="keywordtype">double</span>) rgb.blue/ rgb.green,
00383                              rgb.blue != 0 ? 1.0 - (<span class="keywordtype">double</span>) rgb.red / rgb.blue : 1.0,
00384                              rgb.green / 255.0);
00385         }
00386         <span class="keywordflow">else</span> {
00387             <span class="comment">// b is the primary, g is secondary</span>
00388             <span class="keywordflow">return</span> <a class="code" href="structHSVColor.html">HSVColor</a>( 4.0 - (<span class="keywordtype">double</span>) rgb.green / rgb.blue,
00389                              rgb.green != 0 ? 1.0 - (<span class="keywordtype">double</span>) rgb.red/ rgb.green : 1.0,
00390                              rgb.blue / 255.0);
00391         }
00392     }
00393     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( rgb.green &lt;= rgb.red &amp;&amp; rgb.green &lt;= rgb.blue) {
00394         <span class="keywordflow">if</span>( rgb.red &gt;= rgb.blue) {
00395             <span class="comment">// r is the primary, b is secondary</span>
00396             <span class="keywordflow">return</span> <a class="code" href="structHSVColor.html">HSVColor</a>( 6.0 - (<span class="keywordtype">double</span>)rgb.blue/rgb.red,
00397                              rgb.blue!=0 ? 1.0 - (<span class="keywordtype">double</span>)rgb.green/rgb.blue: 1.0,
00398                              rgb.red / 255.0);
00399         }
00400         <span class="keywordflow">else</span> {
00401             <span class="comment">// b is the primary, r is secondary</span>
00402             <span class="keywordflow">return</span> <a class="code" href="structHSVColor.html">HSVColor</a>( 4.0 + (<span class="keywordtype">double</span>)rgb.red/rgb.blue,
00403                              rgb.red!=0 ? 1.0 - (<span class="keywordtype">double</span>)rgb.green/rgb.red: 1.0,
00404                              rgb.blue / 255.0);
00405         }
00406     }
00407     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( rgb.blue &lt;= rgb.red &amp;&amp; rgb.blue &lt;= rgb.green) {
00408         <span class="keywordflow">if</span>( rgb.red &gt;= rgb.green) {
00409             <span class="comment">// r is the primary, g is secondary</span>
00410             <span class="keywordflow">return</span> <a class="code" href="structHSVColor.html">HSVColor</a>( (<span class="keywordtype">double</span>)rgb.green/rgb.red,
00411                              rgb.green!=0 ? 1.0 - (<span class="keywordtype">double</span>)rgb.blue/rgb.green: 1.0,
00412                              rgb.red / 255.0);
00413         }
00414         <span class="keywordflow">else</span> {
00415             <span class="comment">// g is the primary, r is secondary</span>
00416             <span class="keywordflow">return</span> <a class="code" href="structHSVColor.html">HSVColor</a>( 2.0 - (<span class="keywordtype">double</span>)rgb.red/rgb.green,
00417                              rgb.red!=0 ? 1.0 - (<span class="keywordtype">double</span>)rgb.blue/rgb.red: 1.0,
00418                              rgb.green / 255.0);
00419         }
00420     }
00421     <span class="keywordflow">else</span> {
00422         <a class="code" href="ALL_8H.html#a0">err_when</a>(1);
00423         <span class="keywordflow">return</span> <a class="code" href="structHSVColor.html">HSVColor</a>( 1.0, 0.0, rgb.red / 255.0);
00424     }
00425 }
00426 
00427 <span class="comment">// -------- end of function ColorTable::rgb2hsv ---------//</span>
00428 
00429 <span class="comment">// -------- begin of function ColorTable::hsv2rgb ---------//</span>
00430 <a class="code" href="structRGBColor.html">RGBColor</a> ColorTable::hsv2rgb(<a class="code" href="structHSVColor.html">HSVColor</a> &amp;hsv) {
00431     <span class="keywordflow">while</span>( hsv.<a class="code" href="structHSVColor.html#m0">hue</a> &lt; 0.0)
00432         hsv.<a class="code" href="structHSVColor.html#m0">hue</a> += 6.0;
00433     <span class="keywordflow">while</span>(hsv.<a class="code" href="structHSVColor.html#m0">hue</a> &gt;= 6.0)
00434         hsv.<a class="code" href="structHSVColor.html#m0">hue</a> -= 6.0;
00435     <span class="keywordtype">double</span> p = hsv.<a class="code" href="structHSVColor.html#m2">brightness</a> * 255.0;
00436     <a class="code" href="ALL_8H.html#a0">err_when</a>( p &gt;= 256.0);
00437 
00438     <a class="code" href="structRGBColor.html">RGBColor</a> ans;
00439 
00440     <span class="keywordflow">if</span>( hsv.<a class="code" href="structHSVColor.html#m0">hue</a> &lt; 1.0) {
00441         <span class="comment">// r is primary, g is secondary</span>
00442         ans.<a class="code" href="structRGBColor.html#m0">red</a> = <a class="code" href="OVGA_8H.html#a10">BYTE</a>(p);
00443         p *= hsv.<a class="code" href="structHSVColor.html#m0">hue</a>;
00444         ans.<a class="code" href="structRGBColor.html#m1">green</a> = <a class="code" href="OVGA_8H.html#a10">BYTE</a>(p);                          <span class="comment">// *r * h;</span>
00445         p *= 1.0 - hsv.<a class="code" href="structHSVColor.html#m1">saturation</a>;
00446         ans.<a class="code" href="structRGBColor.html#m2">blue</a> = <a class="code" href="OVGA_8H.html#a10">BYTE</a>(p);
00447     }
00448     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( hsv.<a class="code" href="structHSVColor.html#m0">hue</a> &lt; 2.0) {
00449         <span class="comment">// g is primary, r is secondary</span>
00450         ans.<a class="code" href="structRGBColor.html#m1">green</a> = <a class="code" href="OVGA_8H.html#a10">BYTE</a>(p);
00451         p *= 2.0 - hsv.<a class="code" href="structHSVColor.html#m0">hue</a>;
00452         ans.<a class="code" href="structRGBColor.html#m0">red</a> = <a class="code" href="OVGA_8H.html#a10">BYTE</a>(p);
00453         p *= 1.0 - hsv.<a class="code" href="structHSVColor.html#m1">saturation</a>;
00454         ans.<a class="code" href="structRGBColor.html#m2">blue</a> = <a class="code" href="OVGA_8H.html#a10">BYTE</a>(p);
00455     }
00456     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( hsv.<a class="code" href="structHSVColor.html#m0">hue</a> &lt; 3.0) {
00457         <span class="comment">// g is primary, b is secondary</span>
00458         ans.<a class="code" href="structRGBColor.html#m1">green</a> = <a class="code" href="OVGA_8H.html#a10">BYTE</a>(p);
00459         p *= hsv.<a class="code" href="structHSVColor.html#m0">hue</a> - 2.0;
00460         ans.<a class="code" href="structRGBColor.html#m2">blue</a> = <a class="code" href="OVGA_8H.html#a10">BYTE</a>(p);
00461         p *= 1.0 - hsv.<a class="code" href="structHSVColor.html#m1">saturation</a>;
00462         ans.<a class="code" href="structRGBColor.html#m0">red</a> = <a class="code" href="OVGA_8H.html#a10">BYTE</a>(p);
00463     }
00464     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( hsv.<a class="code" href="structHSVColor.html#m0">hue</a> &lt; 4.0) {
00465         <span class="comment">// b is primary g is secondary</span>
00466         ans.<a class="code" href="structRGBColor.html#m2">blue</a> = <a class="code" href="OVGA_8H.html#a10">BYTE</a>(p);
00467         p *= 4.0 - hsv.<a class="code" href="structHSVColor.html#m0">hue</a>;
00468         ans.<a class="code" href="structRGBColor.html#m1">green</a> = <a class="code" href="OVGA_8H.html#a10">BYTE</a>(p);
00469         p *= 1.0 - hsv.<a class="code" href="structHSVColor.html#m1">saturation</a>;
00470         ans.<a class="code" href="structRGBColor.html#m0">red</a> = <a class="code" href="OVGA_8H.html#a10">BYTE</a>(p);
00471     }
00472     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( hsv.<a class="code" href="structHSVColor.html#m0">hue</a> &lt; 5.0) {
00473         <span class="comment">// b is primary, r is secondary</span>
00474         ans.<a class="code" href="structRGBColor.html#m2">blue</a> = <a class="code" href="OVGA_8H.html#a10">BYTE</a>(p);
00475         p *= hsv.<a class="code" href="structHSVColor.html#m0">hue</a> - 4.0;
00476         ans.<a class="code" href="structRGBColor.html#m0">red</a> = <a class="code" href="OVGA_8H.html#a10">BYTE</a>(p);
00477         p *= 1.0 - hsv.<a class="code" href="structHSVColor.html#m1">saturation</a>;
00478         ans.<a class="code" href="structRGBColor.html#m1">green</a> = <a class="code" href="OVGA_8H.html#a10">BYTE</a>(p);
00479     }
00480     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( hsv.<a class="code" href="structHSVColor.html#m0">hue</a> &lt; 6.0) {
00481         <span class="comment">// r is primary, b is secondary</span>
00482         ans.<a class="code" href="structRGBColor.html#m0">red</a> = <a class="code" href="OVGA_8H.html#a10">BYTE</a>(p);
00483         p *= 6.0 - hsv.<a class="code" href="structHSVColor.html#m0">hue</a>;
00484         ans.<a class="code" href="structRGBColor.html#m2">blue</a> = <a class="code" href="OVGA_8H.html#a10">BYTE</a>(p);
00485         p *= 1.0 - hsv.<a class="code" href="structHSVColor.html#m1">saturation</a>;
00486         ans.<a class="code" href="structRGBColor.html#m1">green</a> = <a class="code" href="OVGA_8H.html#a10">BYTE</a>(p);
00487     }
00488 
00489     <span class="keywordflow">return</span> ans;
00490 }
00491 
00492 <span class="comment">// -------- end of function ColorTable::hsv2rgb ---------//</span>
00493 
00494 <span class="comment">// -------- begin of function ColorTable::write_file ---------//</span>
<a name="l00495"></a><a class="code" href="classColorTable.html#a14">00495</a> <span class="keywordtype">int</span> <a class="code" href="classColorTable.html#a14">ColorTable::write_file</a>(<a class="code" href="classFile.html">File</a> *f) {
00496     <span class="keywordflow">return</span>( f-&gt;<a class="code" href="classFile.html#a16">file_put_long</a>(<a class="code" href="classColorTable.html#m0">abs_scale</a>) &amp;&amp; f-&gt;<a class="code" href="classFile.html#a16">file_put_long</a>(<a class="code" href="classColorTable.html#m1">table_size</a>)
00497             &amp;&amp; f-&gt;<a class="code" href="classFile.html#a10">file_write</a>(remap_table, <a class="code" href="classColorTable.html#m1">table_size</a> * (2*<a class="code" href="classColorTable.html#m0">abs_scale</a>+1) * remap_table[0] ) );
00498 }
00499 
00500 <span class="comment">// -------- end of function ColorTable::write_file ---------//</span>
00501 
00502 <span class="comment">// -------- begin of function ColorTable::read_file ---------//</span>
<a name="l00503"></a><a class="code" href="classColorTable.html#a15">00503</a> <span class="keywordtype">int</span> <a class="code" href="classColorTable.html#a15">ColorTable::read_file</a>(<a class="code" href="classFile.html">File</a> *f) {
00504     <a class="code" href="classColorTable.html#a6">deinit</a>();
00505     <a class="code" href="classColorTable.html#m0">abs_scale</a> = f-&gt;<a class="code" href="classFile.html#a15">file_get_long</a>();
00506     <a class="code" href="classColorTable.html#m1">table_size</a> = f-&gt;<a class="code" href="classFile.html#a15">file_get_long</a>();
00507 
00508     remap_table = (<a class="code" href="OCOLTBL_8H.html#a2">WORD</a> *)<a class="code" href="ALL_8H.html#a5">mem_add</a>(<a class="code" href="classColorTable.html#m1">table_size</a> * (2*<a class="code" href="classColorTable.html#m0">abs_scale</a>+1) * remap_table[0] );
00509     <span class="keywordflow">if</span>(! f-&gt;<a class="code" href="classFile.html#a9">file_read</a>(remap_table, <a class="code" href="classColorTable.html#m1">table_size</a> * (2*<a class="code" href="classColorTable.html#m0">abs_scale</a>+1) * remap_table[0]) ) {
00510         <a class="code" href="ALL_8H.html#a8">mem_del</a>(remap_table);
00511         remap_table = 0;
00512         <span class="keywordflow">return</span> 0;
00513     }
00514     remap_table_array = (<a class="code" href="OCOLTBL_8H.html#a2">WORD</a> **)<a class="code" href="ALL_8H.html#a5">mem_add</a>(<span class="keyword">sizeof</span>(remap_table_array[0]) * (2*<a class="code" href="classColorTable.html#m0">abs_scale</a>+1) );
00515     create_table_array();
00516     <span class="keywordflow">return</span> 1;
00517 }
00518 
00519 <span class="comment">// -------- end of function ColorTable::read_file ---------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:18 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
