<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Omath.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Omath.cpp</h1><a href="Omath_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename       : OMATH.CPP</span>
00002 <span class="comment">//Description: A class of math functions</span>
00003 <span class="comment">//Owner      : Fred</span>
00004 
00005 <span class="preprocessor">#include &lt;All.h&gt;</span>
00006 <span class="preprocessor">#include &lt;OMATH.H&gt;</span>
00007 <span class="preprocessor">#include &lt;OMISC.H&gt;</span>
00008 
00009 <span class="comment">//------- Define constant --------//</span>
00010 
<a name="l00011"></a><a class="code" href="Omath_8cpp.html#a0">00011</a> <span class="preprocessor">#define LN81    4.394449f                         // natural algorithm for response functions</span>
00012 <span class="preprocessor"></span>
00013 <span class="comment">//------ Begin of function Math::double_poisson -------//</span>
<a name="l00017"></a><a class="code" href="classMath.html#a3">00017</a> <span class="comment">float Math::double_poisson(int n, float mu) {</span>
00018     <span class="keywordtype">int</span> nFactor=1;
00019 
00020     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=2; i&lt;=n; i++) {
00021         nFactor *= i;
00022     }
00023 
00024     <span class="keywordflow">return</span> float( exp(-mu) * safe_pow(mu,(<span class="keywordtype">float</span>)n) ) / nFactor;
00025 }
00026 
00027 <span class="comment">//------- End of function Math::double_poisson --------//</span>
00028 
00029 <span class="comment">//------ Begin of function Math::single_response_func -------//</span>
<a name="l00033"></a><a class="code" href="classMath.html#a0">00033</a> <span class="comment">float Math::single_response_func(float floor, float ceiling, float b1, float m1, float v) {</span>
00034     <span class="keywordflow">return</span> float( floor + (ceiling - floor) / ( 1 + exp(-<a class="code" href="Omath_8cpp.html#a0">LN81</a> * (v-m1) / b1) ) );
00035 }
00036 
00037 <span class="comment">//------- End of function Math::single_response_func --------//</span>
00038 
00039 <span class="comment">//------ Begin of function Math::dual_response_func -------//</span>
<a name="l00043"></a><a class="code" href="classMath.html#a1">00043</a> <span class="comment">float Math::dual_response_func(float floor, float base, float ceiling,</span>
00044                                <span class="keywordtype">float</span> b1, <span class="keywordtype">float</span> b2, <span class="keywordtype">float</span> m1, <span class="keywordtype">float</span> m2, <span class="keywordtype">float</span> v) {
00045     <span class="comment">// chwong 071599</span>
00046     <span class="comment">// avoid divide 0</span>
00047     <span class="keywordflow">if</span>( <a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(b1)&lt;1e-9 ) <span class="keywordflow">return</span> floor;
00048     <span class="keywordflow">if</span>( <a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(b2)&lt;1e-9 ) <span class="keywordflow">return</span> floor;
00049     <span class="keywordflow">if</span>( <a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(1+exp(-<a class="code" href="Omath_8cpp.html#a0">LN81</a>*(v-m1)/b1))&lt;1e-9 ) <span class="keywordflow">return</span> 1e9f;
00050     <span class="keywordflow">if</span>( <a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(1+exp(-<a class="code" href="Omath_8cpp.html#a0">LN81</a>*(v-m2)/b2))&lt;1e-9 ) <span class="keywordflow">return</span> 1e9f;
00051 
00052     <span class="keywordflow">return</span> float( floor + (base-floor) / ( 1 + exp(-<a class="code" href="Omath_8cpp.html#a0">LN81</a> * (v-m1) / b1) ) +
00053                   (ceiling-base) / (1 + exp(-<a class="code" href="Omath_8cpp.html#a0">LN81</a> * (v-m2)/b2) ) );
00054 }
00055 
00056 <span class="comment">//------- End of function Math::dual_response_func --------//</span>
00057 
00058 <span class="comment">//------ Begin of function Math::latency_func -------//</span>
<a name="l00066"></a><a class="code" href="classMath.html#a2">00066</a> <span class="comment">float Math::latency_func(float latencyPara, float curValue, float inputValue) {</span>
00067     <span class="comment">// maintenance upgrade Aug 2001</span>
00068     <span class="comment">// return latencyPara * inputValue + (1 - latencyPara) * curValue;</span>
00069     <span class="keywordflow">return</span> latencyPara * curValue + (1 - latencyPara) * inputValue;
00070 }
00071 
00072 <span class="comment">//------- End of function Math::latency_func --------//</span>
00073 
00074 <span class="comment">//------ Begin of function Math::average_float -------//</span>
<a name="l00084"></a><a class="code" href="classMath.html#a4">00084</a> <span class="comment">float Math::average_float(char* structArray, short structSize, short structCount, short varOffset, bool skipZero) {</span>
00085 <span class="preprocessor">#define BOUND 0.000001</span>
00086 <span class="preprocessor"></span>    <span class="keywordtype">char</span>* ptr = structArray;
00087     <span class="keywordtype">float</span> totalValue = 0.0f, tmp;
00088 
00089     <span class="keywordflow">if</span> ( skipZero ) {
00090         <span class="keywordtype">short</span> structCountSkipZero = 0;
00091 
00092         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;structCount ; i++, ptr += structSize ) {
00093             tmp = *((<span class="keywordtype">float</span>*)(ptr + varOffset));
00094             <span class="keywordflow">if</span> ( !(tmp &lt; BOUND &amp;&amp; tmp &gt; -BOUND ) ) {
00095                 totalValue += tmp;
00096                 structCountSkipZero++;
00097             }
00098         }
00099 
00100         <span class="keywordflow">if</span> ( structCountSkipZero )
00101             <span class="keywordflow">return</span> totalValue / structCountSkipZero;
00102         <span class="keywordflow">else</span>
00103             <span class="keywordflow">return</span> 0;
00104     }
00105     <span class="keywordflow">else</span> {
00106         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;structCount ; i++, ptr += structSize ) {
00107             totalValue += *((<span class="keywordtype">float</span>*)(ptr + varOffset));
00108         }
00109 
00110         <span class="keywordflow">return</span> totalValue / structCount;
00111     }
00112 }
00113 
00114 <span class="comment">//------- End of function Math::average_float --------//</span>
00115 
00116 <span class="comment">//------ Begin of function Math::average_char -------//</span>
<a name="l00126"></a><a class="code" href="classMath.html#a5">00126</a> <span class="comment">char Math::average_char(char* structArray, short structSize, short structCount, short varOffset, bool skipZero) {</span>
00127     <span class="keywordtype">char</span>* ptr = structArray;
00128     <span class="keywordtype">int</span>   totalValue = 0, tmp;
00129 
00130     <span class="keywordflow">if</span> ( skipZero ) {
00131         <span class="keywordtype">short</span> structCountSkipZero = 0;
00132 
00133         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;structCount ; i++, ptr += structSize ) {
00134             tmp = *((<span class="keywordtype">char</span>*)(ptr + varOffset));
00135 
00136             <span class="keywordflow">if</span> ( tmp != 0 ) {
00137                 totalValue += tmp;
00138                 structCountSkipZero++;
00139             }
00140         }
00141 
00142         <span class="keywordflow">if</span> ( structCountSkipZero )
00143             <span class="keywordflow">return</span> totalValue / structCountSkipZero;
00144         <span class="keywordflow">else</span>
00145             <span class="keywordflow">return</span> 0;
00146     }
00147     <span class="keywordflow">else</span> {
00148         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;structCount ; i++, ptr += structSize ) {
00149             totalValue += *((<span class="keywordtype">char</span>*)(ptr + varOffset));
00150         }
00151 
00152         <span class="keywordflow">return</span> totalValue / structCount;
00153     }
00154 }
00155 
00156 <span class="comment">//------- End of function Math::average_char --------//</span>
00157 
00158 <span class="comment">//------ Begin of function Math::average_short -------//</span>
<a name="l00168"></a><a class="code" href="classMath.html#a6">00168</a> <span class="comment">short Math::average_short(char* structArray, short structSize, short structCount, short varOffset, bool skipZero) {</span>
00169     <span class="keywordtype">char</span>* ptr = structArray;
00170     <span class="keywordtype">int</span>   totalValue = 0, tmp;
00171 
00172     <span class="keywordflow">if</span> ( skipZero ) {
00173         <span class="keywordtype">short</span> structCountSkipZero = 0;
00174 
00175         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;structCount ; i++, ptr += structSize ) {
00176             tmp = *((<span class="keywordtype">short</span>*)(ptr + varOffset));
00177 
00178             <span class="keywordflow">if</span> ( tmp != 0 ) {
00179                 totalValue += tmp;
00180                 structCountSkipZero++;
00181             }
00182         }
00183 
00184         <span class="keywordflow">if</span> ( structCountSkipZero )
00185             <span class="keywordflow">return</span> totalValue / structCountSkipZero;
00186         <span class="keywordflow">else</span>
00187             <span class="keywordflow">return</span> 0;
00188     }
00189     <span class="keywordflow">else</span> {
00190         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;structCount ; i++, ptr += structSize ) {
00191             totalValue += *((<span class="keywordtype">short</span>*)(ptr + varOffset));
00192         }
00193 
00194         <span class="keywordflow">return</span> totalValue / structCount;
00195     }
00196 }
00197 
00198 <span class="comment">//------- End of function Math::average_short --------//</span>
00199 
00200 <span class="comment">//------ Begin of function Math::average_int -------//</span>
<a name="l00210"></a><a class="code" href="classMath.html#a7">00210</a> <span class="comment">int Math::average_int(char* structArray, short structSize, short structCount, short varOffset, bool skipZero) {</span>
00211     <span class="keywordtype">char</span>* ptr = structArray;
00212     <span class="keywordtype">long</span>  totalValue = 0;
00213     <span class="keywordtype">long</span>  tmp;
00214 
00215     <span class="keywordflow">if</span> ( skipZero ) {
00216         <span class="keywordtype">short</span> structCountSkipZero = 0;
00217 
00218         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;structCount ; i++, ptr += structSize ) {
00219             tmp = *((<span class="keywordtype">int</span>*)(ptr + varOffset));
00220 
00221             <span class="keywordflow">if</span> ( tmp != 0 ) {
00222                 totalValue += tmp;
00223                 structCountSkipZero++;
00224             }
00225         }
00226 
00227         <span class="keywordflow">if</span> ( structCountSkipZero )
00228             <span class="keywordflow">return</span> totalValue / structCountSkipZero;
00229         <span class="keywordflow">else</span>
00230             <span class="keywordflow">return</span> 0;
00231     }
00232     <span class="keywordflow">else</span> {
00233         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;structCount ; i++, ptr += structSize ) {
00234             totalValue += *((<span class="keywordtype">int</span>*)(ptr + varOffset));
00235         }
00236 
00237         <span class="keywordflow">return</span> totalValue / structCount;
00238     }
00239 
00240     <span class="comment">/* //old code</span>
00241 <span class="comment">       char* ptr = structArray;</span>
00242 <span class="comment">       int   totalValue = 0;</span>
00243 <span class="comment"></span>
00244 <span class="comment">       for( int i=0 ; i&lt;structCount ; i++, ptr += structSize )</span>
00245 <span class="comment">       {</span>
00246 <span class="comment">       totalValue += *((int*)(ptr + varOffset));</span>
00247 <span class="comment">       }</span>
00248 <span class="comment"></span>
00249 <span class="comment">       return totalValue / structCount;</span>
00250 <span class="comment">    */</span>
00251 }
00252 
00253 <span class="comment">//------- End of function Math::average_int --------//</span>
00254 
00255 <span class="comment">//------ Begin of function Math::get_random_float -------//</span>
<a name="l00259"></a><a class="code" href="classMath.html#a8">00259</a> <span class="comment">float Math:: get_random_float() {</span>
00260     <span class="keyword">const</span> <span class="keywordtype">int</span> randomPrecesion = 10000;
00261     <span class="keywordflow">return</span> float(m.random(randomPrecesion+1)) / randomPrecesion;
00262 }
00263 
00264 <span class="comment">//-------- End of function Math::get_random_float -------//</span>
00265 
00266 <span class="comment">//------ Begin of function Math::get_random_snd -------//</span>
<a name="l00275"></a><a class="code" href="classMath.html#a9">00275</a> <span class="comment">float Math::get_random_snd(float avg, float sd, bool returnNonNegative) {</span>
00276     <span class="comment">// 1. calc ret which is a normally distributed deviate with zero mean and unit variance</span>
00277     <span class="keyword">static</span> <span class="keywordtype">bool</span> iset=<span class="keyword">false</span>;
00278     <span class="keyword">static</span> <span class="keywordtype">float</span> gset;
00279 
00280     <span class="keywordtype">float</span> fac, rsq, ret, v1, v2;
00281 
00282     <span class="keywordflow">if</span> ( !iset ) {
00283         <span class="keywordflow">do</span> {
00284             v1 = 2.0f * get_random_float() - 1.0f;
00285             v2 = 2.0f * get_random_float() - 1.0f;
00286             rsq = v1*v1 + v2*v2;
00287         }
00288         <span class="keywordflow">while</span> (rsq &gt;= 1.0 || rsq == 0.0);
00289 
00290         fac = (float) sqrt(-2.0f * log(rsq) / rsq );
00291         iset = <span class="keyword">true</span>;
00292         gset = v1 * fac;
00293         ret = v2 * fac;
00294     }
00295     <span class="keywordflow">else</span> {
00296         iset = <span class="keyword">false</span>;
00297         ret = gset;
00298     }
00299 
00300     <span class="comment">// 2. re-scale gset for return</span>
00301     <span class="keywordflow">if</span> ( returnNonNegative )
00302         <span class="keywordflow">return</span> max(0.0f, gset * sd + avg);            <span class="comment">// min &amp; max bug chea</span>
00303     <span class="keywordflow">else</span>
00304         <span class="keywordflow">return</span> gset*sd + avg;
00305 }
00306 
<a name="l00307"></a><a class="code" href="classMath.html#a10">00307</a> <span class="keywordtype">int</span> <a class="code" href="classMath.html#a9">Math::get_random_snd</a>(<span class="keywordtype">int</span> avg, <span class="keywordtype">float</span> sd) {
00308     <span class="keywordtype">float</span> r = <a class="code" href="classMath.html#a9">get_random_snd</a>((<span class="keywordtype">float</span>)avg, sd);
00309 
00310     <span class="keywordflow">return</span> int(r+0.5f);                             <span class="comment">// round it</span>
00311 }
00312 
00313 <span class="comment">//------- End of function Math::get_random_snd --------//</span>
00314 
00315 <span class="comment">//------ Begin of function Math::get_random_gamma_CDF -------//</span>
<a name="l00320"></a><a class="code" href="classMath.html#a11">00320</a> <span class="comment">float Math::get_random_gamma_CDF(float avg, float sd, float zbase) {</span>
00321     <span class="comment">//askbillok gamma</span>
00322     <span class="comment">//TO</span>
00323     <span class="keywordflow">return</span> get_random_snd(avg, sd);
00324 }
00325 
00326 <span class="comment">//------- End of function Math::get_random_gamma_CDF --------//</span>
00327 
00328 <span class="comment">// new in GAME_VERSION&gt;=200</span>
00329 <span class="comment">//------ Begin of function Math::score_function -------//</span>
00330 
<a name="l00331"></a><a class="code" href="classMath.html#a18">00331</a> <span class="keywordtype">float</span> <a class="code" href="classMath.html#a18">Math::score_function</a>(<span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y, <span class="keywordtype">float</span> mx, <span class="keywordtype">float</span> my, <span class="keywordtype">int</span> <a class="code" href="OTEST_8H.html#a0">test</a> ) {
00332     <span class="keywordtype">double</span> theta = atan2( mx, my );
00333 
00334     <span class="keywordflow">if</span>( test )
00335         <span class="keywordflow">return</span> float(x * cos(theta) + y * sin(theta));<span class="comment">// strength</span>
00336     <span class="keywordflow">else</span>
00337         <span class="comment">// consistency</span>
00338         <span class="keywordflow">return</span> float(x * -sin(theta) + y * cos(theta));
00339 }
00340 
00341 <span class="comment">//------ End of function Math::score_function -------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:04 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
