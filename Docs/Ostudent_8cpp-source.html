<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Ostudent.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Ostudent.cpp</h1><a href="Ostudent_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OSTUDENT.cpp</span>
00002 <span class="comment">//Description : STUDENT Class Definition</span>
00003 
00004 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00005 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>
00006 <span class="preprocessor">#include &lt;OPSCHOOL.H&gt;</span>
00007 <span class="preprocessor">#include &lt;ODEPT.H&gt;</span>
00008 <span class="preprocessor">#include &lt;<a class="code" href="ODEPTRES_8H.html">ODEPTRES.H</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;GAMEDEF.H&gt;</span>
00010 <span class="preprocessor">#include &lt;OFINANCE.H&gt;</span>
00011 <span class="preprocessor">#include &lt;<a class="code" href="ODATE_8H.html">ODATE.H</a>&gt;</span>
00012 <span class="preprocessor">#include &lt;OSTUDENT.H&gt;</span>
00013 <span class="preprocessor">#include &lt;OMATH.H&gt;</span>                                <span class="comment">// ### 980915 fred</span>
00014 <span class="preprocessor">#include &lt;<a class="code" href="OBOX_8H.html">OBOX.H</a>&gt;</span>                                 <span class="comment">// ### testing chea</span>
00015 <span class="preprocessor">#include &lt;OCOURSE.H&gt;</span>
00016 <span class="preprocessor">#include &lt;OSTUDENT.H&gt;</span>
00017 
00018 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00019 <span class="preprocessor"></span><span class="keyword">const</span> <a class="code" href="ogfile5_8cpp.html#a5">RECORD_SEPARATOR_LEN</a> = 2;
00020 <span class="keyword">static</span> <span class="keywordtype">char</span> *RECORD_SEPARATOR = <span class="stringliteral">"\r\n"</span>;
00021 <span class="keyword">const</span> <a class="code" href="ogfile5_8cpp.html#a7">FIELD_SEPARATOR_LEN</a> = 1;
00022 <span class="keyword">static</span> <span class="keywordtype">char</span> *FIELD_SEPARATOR = <span class="stringliteral">"\t"</span>;
00023 
00024 <span class="keyword">static</span> <span class="keywordtype">char</span> *export_num(<span class="keywordtype">int</span> value) {
00025     <span class="keyword">static</span> <span class="keywordtype">char</span> num_str[20];
00026     <span class="keywordflow">return</span> itoa( value, num_str, 10 );              <span class="comment">// 10 is radix</span>
00027 }
00028 
00029 <span class="keyword">static</span> <span class="keywordtype">char</span> *export_num(<span class="keywordtype">double</span> value) {
00030     <span class="keyword">static</span> <span class="keywordtype">char</span> num_str[20];
00031     <span class="keywordflow">return</span> gcvt( value, 7, num_str );               <span class="comment">// a few more more than 7, for negative sign, decimal point and exponent</span>
00032 }
00033 
00034 <span class="keyword">static</span> <span class="keywordtype">char</span> *export_percent(<span class="keywordtype">double</span> value) {       <span class="comment">// value already multiplied by 100</span>
00035     <span class="keyword">static</span> <span class="keywordtype">char</span> num_str[20];
00036     <span class="keywordflow">return</span> gcvt( value*0.01, 7, num_str );          <span class="comment">// a few more more than 7, for negative sign, decimal point and exponent</span>
00037 }
00038 
00039 <span class="preprocessor">#define WRITE_FIELD_SEPARATOR(f)      f-&gt;file_write(FIELD_SEPARATOR, FIELD_SEPARATOR_LEN)</span>
00040 <span class="preprocessor"></span><span class="preprocessor">#define WRITE_STR_FIELD(f,s)          { f-&gt;file_write(s, strlen(s)); }</span>
00041 <span class="preprocessor"></span><span class="preprocessor">#define WRITE_NUM_FIELD(f,n)          { char *s=export_num(n); f-&gt;file_write(s, strlen(s)); }</span>
00042 <span class="preprocessor"></span><span class="preprocessor">#define WRITE_PERCENT_FIELD(f,n)      { char *s=export_percent(n); f-&gt;file_write(s, strlen(s)); }</span>
00043 <span class="preprocessor"></span><span class="preprocessor">#define WRITE_RECORD_SEPARATOR(f)     f-&gt;file_write(RECORD_SEPARATOR, RECORD_SEPARATOR_LEN)</span>
00044 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00045 <span class="preprocessor"></span>
00046 <span class="comment">//##### begin fred 980916 #####//</span>
00047 <span class="comment">//---------- Begin of function Student::init -----------//</span>
<a name="l00049"></a><a class="code" href="classStudent.html#a2">00049</a> <span class="comment">void  Student::init(char studentLevel, char yearInProgram, char genderEthnicGroup, char stuSeg, char major, int finAid, float* talentArr) {</span>
00050     memset( <span class="keyword">this</span>, 0, <span class="keyword">sizeof</span>(<a class="code" href="classStudent.html">Student</a>) );
00051 
00052     <span class="comment">//--- vars that will remain constant once initialized ---//</span>
00053 
00054     department_recno          = major;              <span class="comment">// =0 if UNDECIDED</span>
00055 
00056     student_level             = studentLevel;
00057     gender_ethnic_group       = genderEthnicGroup;
00058     student_segment         = stuSeg;
00059 
00060     date_admitted           = info.game_date-(yearInProgram-1)*365;
00061 
00062     <span class="comment">//------- vars that will change over time ------//</span>
00063 
00064     year_in_program         = yearInProgram;
00065     financial_aid           = finAid;
00066     academic_achievement        = 0;                <span class="comment">// 0 means nil, it is updated after completion of each trimester</span>
00067 
00068     <span class="comment">//--- initialize the number courses to take per trimester ---//</span>
00069 
00070 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00071 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( student_level != <a class="code" href="Ostudent_8h.html#a32a4">UG_NONTRADITION</a> ) {
00072         course_per_trimester[<a class="code" href="Gamedef_8h.html#a79a36">AUTUMN</a>]  = <a class="code" href="Ocourse_8h.html#a0">STD_COURSE_PER_TRIMESTER</a>;
00073         course_per_trimester[<a class="code" href="Gamedef_8h.html#a79a37">WINTER</a>]  = <a class="code" href="Ocourse_8h.html#a0">STD_COURSE_PER_TRIMESTER</a>;
00074     }
00075     <span class="keywordflow">else</span> {
00076         course_per_trimester[<a class="code" href="Gamedef_8h.html#a79a36">AUTUMN</a>]  = STD_COURSE_NUG_PER_TRIMESTER;
00077         course_per_trimester[<a class="code" href="Gamedef_8h.html#a79a37">WINTER</a>]  = STD_COURSE_NUG_PER_TRIMESTER;
00078     }
00079 
00080     off_quarter = <a class="code" href="Gamedef_8h.html#a79a38">SUMMER</a>;
00081 <span class="preprocessor">#else</span>
00082 <span class="preprocessor"></span>    course_per_trimester[<a class="code" href="Gamedef_8h.html#a79a36">AUTUMN</a>]  = <a class="code" href="Ocourse_8h.html#a0">STD_COURSE_PER_TRIMESTER</a>;
00083     course_per_trimester[<a class="code" href="Gamedef_8h.html#a79a37">WINTER</a>]  = <a class="code" href="Ocourse_8h.html#a0">STD_COURSE_PER_TRIMESTER</a>;
00084     off_quarter = <a class="code" href="Gamedef_8h.html#a79a38">SUMMER</a>;
00085 <span class="preprocessor">#endif</span>
00086 <span class="preprocessor"></span>
00087     <span class="comment">// newly matriculated</span>
00088     <span class="keywordflow">if</span> ( student_level == <a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a> &amp;&amp; year_in_program == 1 ) {
00089 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00090 <span class="preprocessor"></span>        <span class="keywordflow">if</span>( m.random(4)==0 )                          <span class="comment">// select 2/8 sample</span>
00091 <span class="preprocessor">#else</span>
00092 <span class="preprocessor"></span>            <span class="keywordflow">if</span> ( m.random(4) != 0 )                     <span class="comment">// select 2/8 sample</span>
00093                 <span class="keywordflow">return</span>;
00094 <span class="preprocessor">#endif</span>
00095 <span class="preprocessor"></span>        {
00096 
00097             off_quarter = m.random(1) + <a class="code" href="Gamedef_8h.html#a79a36">AUTUMN</a>;         <span class="comment">// select autumn or winter</span>
00098 
00099             <a class="code" href="ALL_8H.html#a0">err_when</a>(<a class="code" href="Gamedef_8h.html#a79a36">AUTUMN</a>!=0);
00100 
00101             course_per_trimester[off_quarter] = 0;      <span class="comment">// this is determined by summer teaching policy</span>
00102             course_per_trimester[<a class="code" href="Gamedef_8h.html#a79a38">SUMMER</a>] = <a class="code" href="Ocourse_8h.html#a0">STD_COURSE_PER_TRIMESTER</a>;
00103         }
00104     }
00105 
00106     <span class="comment">//-- to update these three from enrollres.talen_array ---//</span>
00107     <span class="comment">//## 071299 chea 1.12.1</span>
00108     <span class="comment">// min &amp; max bug chea</span>
00109     talent_academic         = (char) max(0.0f,min(100.0f, talentArr[<a class="code" href="Ostudent_8h.html#a39a26">ACADEMIC</a>] * 10));
00110     <span class="comment">//  talent_academic                                 = 33; //##200100 chea</span>
00111 
00112     <span class="comment">// min &amp; max bug chea</span>
00113     talent_extracurricular      = (char) max(0.0f,min(100.0f, talentArr[<a class="code" href="Ostudent_8h.html#a39a27">EXTRA_CURRI</a>] * 10));
00114     <span class="comment">// min &amp; max bug chea</span>
00115     talent_athletics          = (char) max(0.0f,min(100.0f, talentArr[<a class="code" href="Ostudent_8h.html#a39a28">ATHLETIC</a>] * 10));
00116 
00117     <span class="comment">//------ refer to techdoc3.3 section 4.10 -----//</span>
00118 
00119     satisfaction_academic     = 0;
00120     satisfaction_student_life   = 0;
00121     satisfaction_athletics      = 0;
00122 
00123     <a class="code" href="ALL_8H.html#a0">err_when</a>( studentLevel &lt; 0 || studentLevel &gt;= <a class="code" href="Ostudent_8h.html#a0">MAX_STUDENT_LEVEL</a> );
00124     <a class="code" href="ALL_8H.html#a0">err_when</a>( genderEthnicGroup &lt; 0 || genderEthnicGroup &gt;= <a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a> );
00125     <a class="code" href="ALL_8H.html#a0">err_when</a>( major &lt; 0 || major &gt; department_array.department_count );
00126 
00127     <span class="comment">// ug yr1 student registered in General Education Department with dept_recno=0</span>
00128     <a class="code" href="ALL_8H.html#a0">err_when</a>( major==0 &amp;&amp; student_level != <a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a> &amp;&amp; !is_nontradition_ug_group(student_level) );
00129 }
00130 
00131 <span class="comment">//---------- End of function Student::init -----------//</span>
00132 <span class="comment">//##### end fred 980806 #####//</span>
00133 
00134 <span class="comment">//---------- Begin of function Student::year_admitted -----------//</span>
<a name="l00136"></a><a class="code" href="classStudent.html#a0">00136</a> <span class="comment">int Student::year_admitted() {</span>
00137     <span class="keywordflow">return</span> date.year(date_admitted);
00138 }
00139 
00140 <span class="comment">//---------- End of function Student::year_admitted -----------//</span>
00141 
00142 <span class="comment">//---------- Begin of function Student::next_day -----------//</span>
<a name="l00144"></a><a class="code" href="classStudent.html#a5">00144</a> <span class="comment">void Student::next_day() {</span>
00145     <span class="comment">//##### begin fred 980814 #####//</span>
00146 
00147     <span class="comment">// start of a trimester</span>
00148     <span class="keywordflow">if</span> ( info.game_day == player_school.trimester_array[player_school.cur_trimester].start_day
00149          &amp;&amp; info.game_month == player_school.trimester_array[player_school.cur_trimester].start_month ) {
00150         update_history(UPDATE_TRIMESTER);
00151     }
00152 
00153     <span class="comment">// start of a month</span>
00154     <span class="keywordflow">if</span> ( info.game_day == 1 ) {
00155         update_history(UPDATE_MONTH);
00156 
00157         sys.yield();
00158 
00159         <span class="comment">// start of a year</span>
00160         <span class="keywordflow">if</span> ( info.game_month == finance.fiscal_year_start_month )
00161             update_history(UPDATE_YEAR);
00162     }
00163     <span class="comment">/*</span>
00164 <span class="comment">      //##### end fred 980814 #####//</span>
00165 <span class="comment"></span>
00166 <span class="comment">      //---- if the student has already selected all courses ----//</span>
00167 <span class="comment"></span>
00168 <span class="comment">      if( has_selected_all_course() )</span>
00169 <span class="comment">      return;</span>
00170 <span class="comment"></span>
00171 <span class="comment">      //-- only next_day a specific student level at one time --//</span>
00172 <span class="comment"></span>
00173 <span class="comment">      if( player_school.cur_select_course_student_level != student_level )</span>
00174 <span class="comment">      return;</span>
00175 <span class="comment"></span>
00176 <span class="comment">      //-------- only select courses in week days ---------//</span>
00177 <span class="comment"></span>
00178 <span class="comment">      if( info.game_day &gt; 5 )</span>
00179 <span class="comment">      return;</span>
00180 <span class="comment"></span>
00181 <span class="comment">      // remove select_cours()</span>
00182 <span class="comment">    */</span>
00183 }
00184 
00185 <span class="comment">//---------- End of function Student::next_day -----------//</span>
00186 
00187 <span class="comment">//---------- Begin of function Student::next_trimester -----------//</span>
<a name="l00189"></a><a class="code" href="classStudent.html#a6">00189</a> <span class="comment">void Student::next_trimester() {</span>
00190     <span class="comment">//----- a student graduate when he/she has completed all the required number of courses ----//</span>
00191 
00192     <span class="comment">//  if(info.game_day == 30 &amp;&amp; info.game_month == 8)  //## chea 090999 don't know is it only cl once</span>
00193     <span class="comment">//  {</span>
00194     <span class="keywordflow">if</span>( think_graduate() )                          <span class="comment">// the student is deleted from student_array after graduation</span>
00195         <span class="keywordflow">return</span>;
00196 
00197     <span class="comment">//  }</span>
00198 
00199     <span class="keywordflow">if</span>( think_dropout() )                           <span class="comment">// the student is deleted from student_array after dropout</span>
00200         <span class="keywordflow">return</span>;                                       <span class="comment">//##testing</span>
00201 
00202     <span class="comment">// change major runs after graduate and dropout</span>
00203 
00204     <span class="keywordflow">if</span>( think_change_major() )                      <span class="comment">// the student is deleted from student_array after change</span>
00205         <span class="keywordflow">return</span>;                                       <span class="comment">//##testing</span>
00206 
00207     <span class="comment">//--- if it is the first trimester, that means it's a new school year ---//</span>
00208 
00209     <span class="comment">// last call in this func, since calls above will use year_in_program.      //1125</span>
00210 
00211     <span class="keywordflow">if</span>( player_school.cur_trimester == <a class="code" href="Gamedef_8h.html#a80a39">FIRST_TRIMESTER</a> )
00212         year_in_program++;
00213 }
00214 
00215 <span class="comment">//---------- End of function Student::next_trimester -----------//</span>
00216 
00217 <span class="comment">//---------- Begin of function Student::think_graduate -----------//</span>
00221 <span class="comment">int Student::think_graduate() {</span>
00222     <span class="comment">//----- a student graduate when he/she has completed all the required number of courses ----//</span>
00223 
00224     <span class="keywordtype">int</span> requiredCourseCount;
00225 
00226     <span class="keywordflow">switch</span>( student_level ) {
00227     <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>:
00228     <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a4">UG_NONTRADITION</a>:
00229     <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a7">DISTANCE_LEARN</a>:
00230         <span class="comment">//32</span>
00231         requiredCourseCount = <a class="code" href="Ocourse_8h.html#a6">COURSE_COUNT_REQUIRED_FOR_BACHELOR</a>;
00232         <span class="keywordflow">break</span>;
00233 
00234     <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a5">MASTER</a>:
00235         <span class="comment">//8</span>
00236         requiredCourseCount = <a class="code" href="Ocourse_8h.html#a7">COURSE_COUNT_REQUIRED_FOR_MASTER</a>;
00237         <span class="keywordflow">break</span>;
00238 
00239     <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a6">DOCTOR</a>:
00240         <span class="comment">//16</span>
00241         requiredCourseCount = <a class="code" href="Ocourse_8h.html#a8">COURSE_COUNT_REQUIRED_FOR_DOCTOR</a>;
00242         <span class="keywordflow">break</span>;
00243     }
00244 
00245     <span class="comment">//##### begin fred 980915 #####//</span>
00246 
00247     <span class="comment">//Department* deptPtr = department_recno?department_array[department_recno] : department_res.general_dept;</span>
00248 
00249     <span class="keywordflow">if</span>( total_course_all &lt; requiredCourseCount ) {
00250         <span class="comment">//              info.debug_enroll++;   //## chea 281099</span>
00251         <span class="keywordflow">return</span> 0;
00252     }
00253 
00254     <a class="code" href="ALL_8H.html#a0">err_when</a>(department_recno == 0);
00255     <a class="code" href="classDepartment.html">Department</a>* deptPtr = department_array[department_recno];
00256 
00257     <span class="keywordflow">if</span> ( student_level == <a class="code" href="Ostudent_8h.html#a32a6">DOCTOR</a> ) {
00258         <a class="code" href="ALL_8H.html#a0">err_when</a>(department_recno == 0);
00259 
00260         <span class="keywordtype">char</span> yearIn = min(year_in_program-1, <a class="code" href="Ostudent_8h.html#a2">MAX_GRADUATE_YEARS</a>-1);
00261         <span class="keywordtype">float</span> gradProb = department_res[deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m2">department_id</a>]-&gt;doctor_graduate_trans_prob[yearIn];
00262 
00263         <span class="comment">//</span>
00264         <span class="keywordtype">float</span> input[2];
00265         <span class="keywordtype">float</span> multiplier = 1;
00266         <span class="comment">//0223</span>
00267         input[0] = math.dual_response_func(0.80f, 1.02f, 1.30f, 0.891f, 1.295f, 0.557f, 2.326f, 0);
00268         <span class="comment">//0223</span>
00269         input[1] = math.dual_response_func(0.80f, 1.00f, 1.30f, -0.912f, -0.863f, 2.502f, 0.489f, 0);
00270 
00271         multiplier = 0.5f * input[0] + 0.5f * input[1];
00272         <span class="comment">// response_func var 28: multiplier = math.latency_func(0.33f, multiplier, lastMultiplier);</span>
00273 
00274         <span class="keywordflow">if</span> ( math.get_random_float() &gt; gradProb * multiplier ) {
00275             <span class="comment">//                  info.debug_enroll++;</span>
00276             <span class="keywordflow">return</span> 0;
00277         }
00278     }
00279     <span class="comment">//##### end fred 980915 #####//</span>
00280 
00281     <span class="comment">//-------- graduate now ----------------//</span>
00282 
00283     <span class="comment">//----- update the graduation count -----//</span>
00284 
00285     <span class="keywordflow">switch</span>( student_level ) {
00286     <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>:
00287     <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a4">UG_NONTRADITION</a>:
00288 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00289 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ( student_level == <a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a> ) {
00290             deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#m20">cur_bachelor_degree</a>++;
00291             deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.last_year_degree[0]++;
00292         }
00293         <span class="keywordflow">else</span> {
00294             deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.cur_non_ug_bachelor_degree++;
00295             deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.last_year_degree[1]++;
00296         }
00297 <span class="preprocessor">#else</span>
00298 <span class="preprocessor"></span>    <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a7">DISTANCE_LEARN</a>:                          <span class="comment">//### 1009 ###//</span>
00299         deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#m20">cur_bachelor_degree</a>++;
00300 <span class="preprocessor">#endif</span>
00301 <span class="preprocessor"></span>        deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#m17">time_to_degree_cumm</a>[<a class="code" href="Ostudent_8h.html#a33a9">BACHELOR_DEGREE</a>] += year_in_program;
00302         <span class="keywordflow">break</span>;
00303 
00304     <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a5">MASTER</a>:
00305         deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#m21">cur_master_degree</a>++;
00306 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00307 <span class="preprocessor"></span>        deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.last_year_degree[2]++;
00308 <span class="preprocessor">#endif</span>
00309 <span class="preprocessor"></span>        deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#m17">time_to_degree_cumm</a>[<a class="code" href="Ostudent_8h.html#a33a10">MASTER_DEGREE</a>] += year_in_program;
00310         <span class="keywordflow">break</span>;
00311 
00312     <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a6">DOCTOR</a>:
00313         deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#m22">cur_doctor_degree</a>++;
00314 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00315 <span class="preprocessor"></span>        deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.last_year_degree[3]++;
00316 <span class="preprocessor">#endif</span>
00317 <span class="preprocessor"></span>        deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#m17">time_to_degree_cumm</a>[<a class="code" href="Ostudent_8h.html#a33a11">DOCTOR_DEGREE</a>] += year_in_program;
00318         <span class="keywordflow">break</span>;
00319     }
00320 
00321     <span class="comment">//-- update average time to graduation for traditional undergraduates --//</span>
00322 
00323     <span class="keywordflow">if</span>( student_level == <a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a> ) {
00324 
00325         <span class="keywordtype">int</span> graduationTime = info.game_date - date_admitted;
00326 
00327         deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#m23">ave_time_to_graduation_for_ug</a> =
00328             ( deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#m23">ave_time_to_graduation_for_ug</a> *
00329               (deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#m20">cur_bachelor_degree</a> - 1) + graduationTime ) /
00330             deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#m20">cur_bachelor_degree</a>;
00331 
00332 <span class="preprocessor">#ifdef DEBUG</span>
00333 <span class="preprocessor"></span>        <span class="keyword">static</span> <span class="keywordtype">int</span>  grad4Year[2] = { 0, 0 };
00334         <span class="keywordflow">if</span>( graduationTime &gt; 1461 ) {                 <span class="comment">// 4 year</span>
00335             grad4Year[1]++;
00336         }
00337         <span class="keywordflow">else</span> {
00338             grad4Year[0]++;
00339         }
00340 <span class="preprocessor">#endif</span>
00341 <span class="preprocessor"></span>    }
00342 
00343 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00344 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( audit_flag ) {
00345         <a class="code" href="classFile.html">File</a> file;
00346 
00347         <span class="keywordtype">char</span> fileName[123];
00348 
00349         <span class="keywordflow">switch</span>( student_level ) {
00350         <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>:    strcpy( fileName, <span class="stringliteral">"TRADITION"</span> );
00351             <span class="keywordflow">break</span>;
00352         <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a4">UG_NONTRADITION</a>: strcpy( fileName, <span class="stringliteral">"NONTRADITION"</span> );
00353             <span class="keywordflow">break</span>;
00354         <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a5">MASTER</a>:        strcpy( fileName, <span class="stringliteral">"MASTER"</span> );
00355             <span class="keywordflow">break</span>;
00356         <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a6">DOCTOR</a>:        strcpy( fileName, <span class="stringliteral">"DOCTOR"</span> );
00357             <span class="keywordflow">break</span>;
00358         }
00359 
00360         strcat( fileName, m.format(old_student_recno) );
00361         strcat( fileName, <span class="stringliteral">".txt"</span> );
00362 
00363         file.<a class="code" href="classFile.html#a4">file_append</a>( fileName );
00364         file.<a class="code" href="classFile.html#a7">file_seek</a>(0, FILE_END);
00365 
00366         <span class="comment">// Cohet</span>
00367         <span class="keywordflow">if</span> ( info.prerun_year ) {
00368             <a class="code" href="ogfile5_8cpp.html#a2">WRITE_NUM_FIELD</a>( (&amp;file), -1 );
00369         }
00370         <span class="keywordflow">else</span> {
00371             <a class="code" href="ogfile5_8cpp.html#a2">WRITE_NUM_FIELD</a>( (&amp;file), info.financial_year() );
00372         }
00373 
00374         <a class="code" href="ogfile5_8cpp.html#a0">WRITE_FIELD_SEPARATOR</a>( (&amp;file) );
00375 
00376         <span class="comment">// Trimester</span>
00377         <span class="keywordflow">switch</span>( player_school.cur_trimester ) {
00378         <span class="keywordflow">case</span> <a class="code" href="Gamedef_8h.html#a79a36">AUTUMN</a>:  <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"A"</span> ); <span class="keywordflow">break</span>;
00379         <span class="keywordflow">case</span> <a class="code" href="Gamedef_8h.html#a79a37">WINTER</a>:  <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"W"</span> ); <span class="keywordflow">break</span>;
00380         <span class="keywordflow">case</span> <a class="code" href="Gamedef_8h.html#a79a38">SUMMER</a>:  <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"S"</span> ); <span class="keywordflow">break</span>;
00381         }
00382 
00383         <span class="comment">// ID</span>
00384         file_course_id++;
00385         <a class="code" href="ogfile5_8cpp.html#a0">WRITE_FIELD_SEPARATOR</a>( (&amp;file) );
00386         <a class="code" href="ogfile5_8cpp.html#a0">WRITE_FIELD_SEPARATOR</a>( (&amp;file) );
00387         <a class="code" href="ogfile5_8cpp.html#a2">WRITE_NUM_FIELD</a>( (&amp;file), file_course_id );
00388         <a class="code" href="ogfile5_8cpp.html#a0">WRITE_FIELD_SEPARATOR</a>( (&amp;file) );
00389 
00390         <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"Status"</span> );
00391         <a class="code" href="ogfile5_8cpp.html#a0">WRITE_FIELD_SEPARATOR</a>( (&amp;file) );
00392         <a class="code" href="ogfile5_8cpp.html#a0">WRITE_FIELD_SEPARATOR</a>( (&amp;file) );
00393         <span class="keywordflow">if</span> ( department_recno ) {
00394             <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"Grad"</span> );
00395         }
00396 
00397         file.<a class="code" href="classFile.html#a5">file_close</a>();
00398     }
00399 <span class="preprocessor">#endif</span>
00400 <span class="preprocessor"></span>
00401     <span class="comment">//----- remove the student from student_array -----//</span>
00402 
00403     deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#a5">del</a>(student_recno);
00404     <span class="comment">//  info.debug_enroll++;</span>
00405     <span class="comment">//  info.debug_enroll2++;</span>
00406     <span class="keywordflow">return</span> 1;
00407 }
00408 
00409 <span class="comment">//---------- End of function Student::think_graduate -----------//</span>
00410 
00411 <span class="comment">//##### begin fred 980915 #####//</span>
00412 <span class="comment">//---------- Begin of function Student::think_dropout -----------//</span>
00419 <span class="comment">int Student::think_dropout() {</span>
00420     calc_multiplier_on_dropout_prob();
00421 
00422     <span class="comment">//-------- find dropout_prob ----------------//</span>
00423     <a class="code" href="ALL_8H.html#a0">err_when</a>(year_in_program&lt;1);
00424 
00425     <span class="keywordtype">float</span> dropProb = 0;
00426     <span class="keywordtype">char</span> yearIn = min(year_in_program-1, <a class="code" href="Ostudent_8h.html#a2">MAX_GRADUATE_YEARS</a>-1);
00427     <a class="code" href="classGeneralDepartment.html">GeneralDepartment</a>* deptPtr = department_recno ? (<a class="code" href="classGeneralDepartment.html">GeneralDepartment</a> *) department_array[department_recno] : &amp;department_res.general_dept;
00428 
00429     <span class="comment">// 0118</span>
00430     <span class="keywordflow">if</span> ( deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#m1">student_count</a> &lt;= 10 ) {
00431         <span class="comment">//              info.debug_enroll3++; //## chea 281099 stu total</span>
00432         <span class="keywordflow">return</span> 0;
00433     }
00434     <span class="keywordflow">switch</span>( student_level ) {
00435 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00436 <span class="preprocessor"></span>    <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a4">UG_NONTRADITION</a>:
00437         dropProb = 0.5f * player_school.dropout_trans_prob[student_level][yearIn];
00438         <span class="keywordflow">break</span>;
00439     <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>:
00440     <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a5">MASTER</a>:
00441         <span class="comment">// float dropout_trans_prob[MASTER_ARRAY_SIZE][MAX_GRADUATE_YEARS];</span>
00442         dropProb = player_school.dropout_trans_prob[student_level][yearIn];
00443         <span class="keywordflow">break</span>;
00444 
00445     <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a6">DOCTOR</a>:
00446         <a class="code" href="ALL_8H.html#a0">err_when</a>(&amp;department_res.general_dept == deptPtr);
00447         dropProb = 0.5f * department_res[deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m2">department_id</a>]-&gt;doctor_dropout_trans_prob[yearIn];
00448         <span class="keywordflow">break</span>;
00449 
00450     <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a7">DISTANCE_LEARN</a>:
00451         dropProb = player_school.dropout_trans_prob[<a class="code" href="Ostudent_8h.html#a32a4">UG_NONTRADITION</a>][yearIn];
00452         <span class="keywordflow">break</span>;
00453 <span class="preprocessor">#else</span>
00454 <span class="preprocessor"></span>    <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>:
00455     <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a4">UG_NONTRADITION</a>:
00456     <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a5">MASTER</a>:
00457         <span class="comment">// float dropout_trans_prob[MASTER_ARRAY_SIZE][MAX_GRADUATE_YEARS];</span>
00458         dropProb = player_school.dropout_trans_prob[student_level][yearIn];
00459         <span class="keywordflow">break</span>;
00460 
00461     <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a6">DOCTOR</a>:
00462         <a class="code" href="ALL_8H.html#a0">err_when</a>(&amp;department_res.general_dept == deptPtr);
00463         dropProb = 0.5f * department_res[deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m2">department_id</a>]-&gt;doctor_dropout_trans_prob[yearIn];
00464         <span class="keywordflow">break</span>;
00465 
00466     <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a7">DISTANCE_LEARN</a>:
00467         dropProb = player_school.dropout_trans_prob[<a class="code" href="Ostudent_8h.html#a32a4">UG_NONTRADITION</a>][yearIn];
00468         <span class="keywordflow">break</span>;
00469 <span class="preprocessor">#endif</span>
00470 <span class="preprocessor"></span>    }
00471 
00472     <span class="comment">// min &amp; max bug chea</span>
00473     dropProb = max(0.0f, min(1.0f, dropProb * multiplier_on_dropout_prob));
00474 
00475     <span class="keywordflow">if</span> ( math.get_random_float() &gt; dropProb ) {
00476         <span class="comment">//              info.debug_enroll3++; //## chea 281099 student total</span>
00477         <span class="keywordflow">return</span> 0;
00478     }
00479     <span class="comment">//---------// else dropout! //---------//</span>
00480     <span class="comment">//----- remove the student from student_array -----//</span>
00481 
00482 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00483 <span class="preprocessor"></span>    <span class="keywordtype">char</span> level2Degree[] = {<a class="code" href="Ostudent_8h.html#a33a9">BACHELOR_DEGREE</a>, <a class="code" href="Ostudent_8h.html#a33a9">BACHELOR_DEGREE</a>, <a class="code" href="Ostudent_8h.html#a33a10">MASTER_DEGREE</a>, <a class="code" href="Ostudent_8h.html#a33a11">DOCTOR_DEGREE</a>, -1};
00484 <span class="preprocessor">#else</span>
00485 <span class="preprocessor"></span>    <span class="keywordtype">char</span> level2Degree[] = {<a class="code" href="Ostudent_8h.html#a33a9">BACHELOR_DEGREE</a>, <a class="code" href="Ostudent_8h.html#a33a9">BACHELOR_DEGREE</a>, <a class="code" href="Ostudent_8h.html#a33a10">MASTER_DEGREE</a>, <a class="code" href="Ostudent_8h.html#a33a11">DOCTOR_DEGREE</a>, <a class="code" href="Ostudent_8h.html#a33a9">BACHELOR_DEGREE</a>};
00486 <span class="preprocessor">#endif</span>
00487 <span class="preprocessor"></span>
00488     <span class="keywordflow">if</span> ( level2Degree[student_level] &gt;=0 ) {
00489 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00490 <span class="preprocessor"></span>        deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.last_year_dropout[student_level]++;
00491 <span class="preprocessor">#endif</span>
00492 <span class="preprocessor"></span>        deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#m18">cur_dropout</a>[level2Degree[student_level]]++;
00493     }
00494 
00495 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00496 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( audit_flag ) {
00497         <a class="code" href="classFile.html">File</a> file;
00498 
00499         <span class="keywordtype">char</span> fileName[123];
00500 
00501         <span class="keywordflow">switch</span>( student_level ) {
00502         <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>:    strcpy( fileName, <span class="stringliteral">"TRADITION"</span> );
00503             <span class="keywordflow">break</span>;
00504         <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a4">UG_NONTRADITION</a>: strcpy( fileName, <span class="stringliteral">"NONTRADITION"</span> );
00505             <span class="keywordflow">break</span>;
00506         <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a5">MASTER</a>:        strcpy( fileName, <span class="stringliteral">"MASTER"</span> );
00507             <span class="keywordflow">break</span>;
00508         <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a6">DOCTOR</a>:        strcpy( fileName, <span class="stringliteral">"DOCTOR"</span> );
00509             <span class="keywordflow">break</span>;
00510         }
00511 
00512         strcat( fileName, m.format(old_student_recno) );
00513         strcat( fileName, <span class="stringliteral">".txt"</span> );
00514 
00515         file.<a class="code" href="classFile.html#a4">file_append</a>( fileName );
00516         file.<a class="code" href="classFile.html#a7">file_seek</a>(0, FILE_END);
00517 
00518         <span class="comment">// Cohet</span>
00519         <span class="keywordflow">if</span> ( info.prerun_year ) {
00520             <a class="code" href="ogfile5_8cpp.html#a2">WRITE_NUM_FIELD</a>( (&amp;file), -1 );
00521         }
00522         <span class="keywordflow">else</span> {
00523             <a class="code" href="ogfile5_8cpp.html#a2">WRITE_NUM_FIELD</a>( (&amp;file), info.financial_year() );
00524         }
00525 
00526         <a class="code" href="ogfile5_8cpp.html#a0">WRITE_FIELD_SEPARATOR</a>( (&amp;file) );
00527 
00528         <span class="comment">// Trimester</span>
00529         <span class="keywordflow">switch</span>( player_school.cur_trimester ) {
00530         <span class="keywordflow">case</span> <a class="code" href="Gamedef_8h.html#a79a36">AUTUMN</a>:  <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"A"</span> ); <span class="keywordflow">break</span>;
00531         <span class="keywordflow">case</span> <a class="code" href="Gamedef_8h.html#a79a37">WINTER</a>:  <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"W"</span> ); <span class="keywordflow">break</span>;
00532         <span class="keywordflow">case</span> <a class="code" href="Gamedef_8h.html#a79a38">SUMMER</a>:  <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"S"</span> ); <span class="keywordflow">break</span>;
00533         }
00534 
00535         <span class="comment">// ID</span>
00536         file_course_id++;
00537         <a class="code" href="ogfile5_8cpp.html#a0">WRITE_FIELD_SEPARATOR</a>( (&amp;file) );
00538         <a class="code" href="ogfile5_8cpp.html#a0">WRITE_FIELD_SEPARATOR</a>( (&amp;file) );
00539         <a class="code" href="ogfile5_8cpp.html#a2">WRITE_NUM_FIELD</a>( (&amp;file), file_course_id );
00540         <a class="code" href="ogfile5_8cpp.html#a0">WRITE_FIELD_SEPARATOR</a>( (&amp;file) );
00541 
00542         <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"Status"</span> );
00543         <a class="code" href="ogfile5_8cpp.html#a0">WRITE_FIELD_SEPARATOR</a>( (&amp;file) );
00544         <a class="code" href="ogfile5_8cpp.html#a0">WRITE_FIELD_SEPARATOR</a>( (&amp;file) );
00545         <span class="keywordflow">if</span> ( department_recno ) {
00546             <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"Drop"</span> );
00547         }
00548 
00549         file.<a class="code" href="classFile.html#a5">file_close</a>();
00550     }
00551 <span class="preprocessor">#endif</span>
00552 <span class="preprocessor"></span>
00553     deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#a5">del</a>(student_recno);
00554     <span class="comment">//   info.debug_enroll3++;</span>
00555     <span class="comment">//   info.debug_enroll4++;</span>
00556     <span class="keywordflow">return</span> 1;
00557 }
00558 
00559 <span class="comment">//---------- End of function Student::think_dropout -----------//</span>
00560 
00561 <span class="comment">//---------- Begin of function Student::think_change_major -----------//</span>
00565 <span class="comment">int Student::think_change_major(char courseCompleted) {</span>
00566     <span class="comment">//-------- scenario special handling ----------//</span>
00567 
00568     <span class="keywordflow">if</span> ( player_school.scenario_id == <a class="code" href="Opschool_8h.html#a63a28">SCN_COMPENSATE_FOR_ENROLLMENT_SHIFTS</a> &amp;&amp; info.prerun_year )
00569         <span class="keywordflow">return</span> change_major(1);                       <span class="comment">// 1-force changing major</span>
00570 
00571     <span class="comment">//-------- calc prob --------------//</span>
00572 
00573     calc_probability_change_major();
00574 
00575     <span class="comment">// 990414</span>
00576     <span class="keywordflow">if</span> ( department_recno != 0 &amp;&amp; year_in_program == 1 )
00577         <span class="keywordflow">return</span> 0;
00578 
00579     <span class="keywordflow">if</span> ( department_recno != 0 &amp;&amp; math.get_random_float() &gt; probability_change_major )
00580         <span class="keywordflow">return</span> 0;
00581 
00582     <span class="comment">//---------// else change! //---------//</span>
00583 
00584     <span class="keywordflow">return</span> change_major(courseCompleted);           <span class="comment">//do this from below</span>
00585 }
00586 
00587 <span class="comment">//---------- End of function Student::think_change_major -----------//</span>
00588 <span class="comment">//##### end fred 980915 #####//</span>
00589 
00590 <span class="comment">//## chea begin 170699</span>
00591 <span class="comment">//---------- Begin of function Student::change_major -----------//</span>
<a name="l00595"></a><a class="code" href="classStudent.html#a8">00595</a> <span class="comment">int Student::change_major(int couCompleted) {     //if 1 is passed to courseCompleted then the student must change major.</span>
00596 
00597     <span class="comment">//----- relocate the student from student_array -----//</span>
00598 
00599     <span class="keywordtype">int</span> major = player_school.get_random_major(student_level);
00600 
00601     <span class="comment">// ug yr1 student registered in General Education Department</span>
00602     <span class="keywordflow">if</span> ( couCompleted ) {
00603         <span class="comment">// go selected the major above</span>
00604         <a class="code" href="ALL_8H.html#a0">err_when</a>(major == 0 );
00605     }
00606     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( department_recno==0 ) {
00607         <a class="code" href="ALL_8H.html#a0">err_when</a>( student_level != <a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a> &amp;&amp; !is_nontradition_ug_group(student_level));
00608 
00609         <span class="keywordflow">if</span> ( year_in_program == 1 )                   <span class="comment">// change major after 1st year</span>
00610             <span class="keywordflow">return</span> 0;
00611 
00612         <a class="code" href="ALL_8H.html#a0">err_when</a>(year_in_program!=2);                 <span class="comment">// this student should be just promoted to yr2</span>
00613     }
00614 
00615     <span class="keywordflow">if</span> ( department_recno == major )
00616         <span class="keywordflow">return</span> 0;                                     <span class="comment">// don't change</span>
00617 
00618     <a class="code" href="ALL_8H.html#a0">err_when</a>(major == 0);
00619 
00620     <a class="code" href="classGeneralDepartment.html">GeneralDepartment</a>* oldDeptPtr = department_recno ? (<a class="code" href="classGeneralDepartment.html">GeneralDepartment</a> *) department_array[department_recno] : &amp;department_res.general_dept;
00621     <a class="code" href="classDepartment.html">Department</a>* newDeptPtr = department_array[major];
00622 
00623     <span class="keywordtype">int</span> ods = oldDeptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classDynArrayB.html#a2">packed_size</a>();
00624     <span class="keywordtype">int</span> nds = newDeptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classDynArrayB.html#a2">packed_size</a>();
00625     <span class="keywordtype">int</span> oldStudentRecno = student_recno;
00626 
00627     <span class="keywordflow">if</span> (student_recno &lt;=0 ) {
00628         <span class="comment">//              info.debug_enroll++;</span>
00629         oldDeptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#a5">del</a>(student_recno);
00630         <span class="keywordflow">return</span> 0;
00631     }
00632 
00633     <span class="comment">// add</span>
00634     department_recno = major;
00635     newDeptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classDynArrayB.html#a4">linkin</a>(<span class="keyword">this</span>);
00636 
00637     <span class="comment">// update</span>
00638     ((<a class="code" href="classStudent.html">Student</a>*)(newDeptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classDynArray.html#a13">get</a>()))-&gt;student_recno
00639         = newDeptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classDynArray.html#a27">recno</a>();
00640 
00641     newDeptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#m1">student_count</a>++;
00642 
00643 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00644 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( audit_flag ) {
00645         <a class="code" href="classFile.html">File</a> file;
00646 
00647         <span class="keywordtype">char</span> fileName[123];
00648 
00649         <span class="keywordflow">switch</span>( student_level ) {
00650         <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>:    strcpy( fileName, <span class="stringliteral">"TRADITION"</span> );
00651             <span class="keywordflow">break</span>;
00652         <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a4">UG_NONTRADITION</a>: strcpy( fileName, <span class="stringliteral">"NONTRADITION"</span> );
00653             <span class="keywordflow">break</span>;
00654         <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a5">MASTER</a>:        strcpy( fileName, <span class="stringliteral">"MASTER"</span> );
00655             <span class="keywordflow">break</span>;
00656         <span class="keywordflow">case</span> <a class="code" href="Ostudent_8h.html#a32a6">DOCTOR</a>:        strcpy( fileName, <span class="stringliteral">"DOCTOR"</span> );
00657             <span class="keywordflow">break</span>;
00658         }
00659 
00660         strcat( fileName, m.format(old_student_recno) );
00661         strcat( fileName, <span class="stringliteral">".txt"</span> );
00662 
00663         file.<a class="code" href="classFile.html#a4">file_append</a>( fileName );
00664         file.<a class="code" href="classFile.html#a7">file_seek</a>(0, FILE_END);
00665 
00666         <span class="comment">// Cohet</span>
00667         <span class="keywordflow">if</span> ( info.prerun_year ) {
00668             <a class="code" href="ogfile5_8cpp.html#a2">WRITE_NUM_FIELD</a>( (&amp;file), -1 );
00669         }
00670         <span class="keywordflow">else</span> {
00671             <a class="code" href="ogfile5_8cpp.html#a2">WRITE_NUM_FIELD</a>( (&amp;file), info.financial_year() );
00672         }
00673 
00674         <a class="code" href="ogfile5_8cpp.html#a0">WRITE_FIELD_SEPARATOR</a>( (&amp;file) );
00675 
00676         <span class="comment">// Trimester</span>
00677         <span class="keywordflow">switch</span>( player_school.cur_trimester ) {
00678         <span class="keywordflow">case</span> <a class="code" href="Gamedef_8h.html#a79a36">AUTUMN</a>:  <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"A"</span> ); <span class="keywordflow">break</span>;
00679         <span class="keywordflow">case</span> <a class="code" href="Gamedef_8h.html#a79a37">WINTER</a>:  <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"W"</span> ); <span class="keywordflow">break</span>;
00680         <span class="keywordflow">case</span> <a class="code" href="Gamedef_8h.html#a79a38">SUMMER</a>:  <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"S"</span> ); <span class="keywordflow">break</span>;
00681         }
00682 
00683         <span class="comment">// ID</span>
00684         file_course_id++;
00685         <a class="code" href="ogfile5_8cpp.html#a0">WRITE_FIELD_SEPARATOR</a>( (&amp;file) );
00686         <a class="code" href="ogfile5_8cpp.html#a0">WRITE_FIELD_SEPARATOR</a>( (&amp;file) );
00687         <a class="code" href="ogfile5_8cpp.html#a2">WRITE_NUM_FIELD</a>( (&amp;file), 0 );
00688         <a class="code" href="ogfile5_8cpp.html#a0">WRITE_FIELD_SEPARATOR</a>( (&amp;file) );
00689 
00690         <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), <span class="stringliteral">"Status"</span> );
00691         <a class="code" href="ogfile5_8cpp.html#a0">WRITE_FIELD_SEPARATOR</a>( (&amp;file) );
00692         <a class="code" href="ogfile5_8cpp.html#a0">WRITE_FIELD_SEPARATOR</a>( (&amp;file) );
00693         <a class="code" href="ogfile5_8cpp.html#a1">WRITE_STR_FIELD</a>( (&amp;file), department_res[newDeptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m2">department_id</a>]-&gt;name );
00694 
00695         <a class="code" href="ogfile5_8cpp.html#a4">WRITE_RECORD_SEPARATOR</a>( (&amp;file) );
00696 
00697         file.<a class="code" href="classFile.html#a5">file_close</a>();
00698     }
00699 <span class="preprocessor">#endif</span>
00700 <span class="preprocessor"></span>
00701     <span class="comment">// remove</span>
00702     oldDeptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#a5">del</a>(oldStudentRecno);
00703 
00704     <span class="keywordtype">int</span> oods = oldDeptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classDynArrayB.html#a2">packed_size</a>();
00705     <span class="keywordtype">int</span> onds = newDeptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classDynArrayB.html#a2">packed_size</a>();
00706 
00707     <a class="code" href="ALL_8H.html#a0">err_when</a>(ods-1 != oods);
00708     <a class="code" href="ALL_8H.html#a0">err_when</a>(nds+1 != onds);
00709     <a class="code" href="ALL_8H.html#a0">err_when</a>( newDeptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>[newDeptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classDynArray.html#a27">recno</a>()]-&gt;department_recno != major);
00710 
00711     <span class="comment">//  this-&gt;department_recno = major; // for think_change_major(1)</span>
00712     this-&gt;department_recno = major;                 <span class="comment">// for think_change_major(1)  //##testing</span>
00713     <span class="keywordflow">return</span> 1;
00714 }
00715 
00716 <span class="comment">//---------- End of function Student::change_major -----------//</span>
00717 <span class="comment">//## chea end 170699</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:28 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
