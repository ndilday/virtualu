<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OGAMESET.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>OGAMESET.CPP</h1><a href="OGAMESET_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OGAMESET.CPP</span>
00002 <span class="comment">//Description : Object Game Set</span>
00003 
00004 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00005 <span class="preprocessor">#include &lt;<a class="code" href="OSTR_8H.html">OSTR.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;<a class="code" href="ODIR_8H.html">ODIR.H</a>&gt;</span>
00007 <span class="preprocessor">#include &lt;<a class="code" href="OGAMESET_8H.html">OGAMESET.H</a>&gt;</span>
00008 <span class="preprocessor">#include &lt;OMISC.H&gt;</span>
00009 
00010 <span class="comment">//-------- Define constant -------------//</span>
00011 
<a name="l00012"></a><a class="code" href="OGAMESET_8CPP.html#a0">00012</a> <span class="preprocessor">#define SET_HEADER_DB       "HEADER"</span>
00013 <span class="preprocessor"></span>
00014 <span class="comment">//--------- Begin of GameSet::init -------------//</span>
00015 
<a name="l00016"></a><a class="code" href="classGameSet.html#a2">00016</a> <span class="keywordtype">void</span> <a class="code" href="classGameSet.html#a2">GameSet::init</a>() {
00017     <a class="code" href="classGameSet.html#m6">set_opened_flag</a>=0;                              <span class="comment">// no set has been opened</span>
00018 
00019     load_set_header();                              <span class="comment">// load the info. of all sets</span>
00020 
00021     <a class="code" href="classGameSet.html#m0">init_flag</a>=1;
00022 }
00023 
00024 <span class="comment">//----------- End of GameSet::init -------------//</span>
00025 
00026 <span class="comment">//--------- Begin of GameSet::deinit -------------//</span>
00027 
<a name="l00028"></a><a class="code" href="classGameSet.html#a3">00028</a> <span class="keywordtype">void</span> <a class="code" href="classGameSet.html#a3">GameSet::deinit</a>() {
00029     <span class="keywordflow">if</span>( init_flag ) {
00030         <a class="code" href="ALL_8H.html#a8">mem_del</a>(<a class="code" href="classGameSet.html#m3">set_info_array</a>);
00031 
00032         <a class="code" href="classGameSet.html#m0">init_flag</a> = 0;
00033     }
00034 }
00035 
00036 <span class="comment">//----------- End of GameSet::deinit -------------//</span>
00037 
00038 <span class="comment">//--------- Begin of GameSet::load_set_header -------------//</span>
00039 
00040 <span class="keywordtype">void</span> GameSet::load_set_header() {
00041     <span class="keywordtype">int</span>        i;
00042     <a class="code" href="classDirectory.html">Directory</a>  setDir;
00043     <a class="code" href="structSetRec.html">SetRec</a>    *setRec;
00044     <a class="code" href="structSetInfo.html">SetInfo</a>   *setInfo;
00045     <span class="keywordtype">char</span>      *dataPtr;
00046     <a class="code" href="classString.html">String</a>     str;
00047 
00048     setDir.<a class="code" href="classDirectory.html#a1">read</a>( <a class="code" href="Gamedef_8h.html#a4">DIR_RES</a><span class="stringliteral">"*.SET"</span>, 1 );               <span class="comment">// read in the file list of all game sets in the directory, 1-Sort file names</span>
00049 
00050     <a class="code" href="classGameSet.html#m2">set_count</a> = setDir.<a class="code" href="classDynArray.html#a28">size</a>();                      <span class="comment">// no. of game set available to choose</span>
00051 
00052     <a class="code" href="ALL_8H.html#a0">err_when</a>( !<a class="code" href="classGameSet.html#m2">set_count</a> );                         <span class="comment">// error if there is no GameSet</span>
00053 
00054     <a class="code" href="classGameSet.html#m3">set_info_array</a> = (<a class="code" href="structSetInfo.html">SetInfo</a>*) <a class="code" href="ALL_8H.html#a5">mem_add</a>( <span class="keyword">sizeof</span>(<a class="code" href="structSetInfo.html">SetInfo</a>) * <a class="code" href="classGameSet.html#m2">set_count</a> );
00055 
00056     <span class="comment">//-------- read in the headers of all game sets -------//</span>
00057 
00058     <span class="keywordflow">for</span>( i=1 ; i&lt;=<a class="code" href="classGameSet.html#m2">set_count</a> ; i++ ) {
00059         str  = <a class="code" href="Gamedef_8h.html#a4">DIR_RES</a>;
00060         str += setDir[i]-&gt;name;
00061 
00062         <a class="code" href="classGameSet.html#m4">set_res</a>.<a class="code" href="classResourceIdx.html#a3">init</a>( str, 0 );                       <span class="comment">// open the game set first</span>
00063 
00064         dataPtr = <a class="code" href="classGameSet.html#m4">set_res</a>.<a class="code" href="classResourceIdx.html#a8">read</a>(<a class="code" href="OGAMESET_8CPP.html#a0">SET_HEADER_DB</a>);        <span class="comment">// get the pointer to the header database</span>
00065 
00066         <a class="code" href="ALL_8H.html#a0">err_when</a>( !dataPtr );
00067 
00068         <a class="code" href="classGameSet.html#m5">set_db</a>.<a class="code" href="classDatabase.html#a3">open_from_buf</a>(dataPtr);                <span class="comment">// read in the header database</span>
00069 
00070         setRec  = (<a class="code" href="structSetRec.html">SetRec</a>*) <a class="code" href="classGameSet.html#m5">set_db</a>.<a class="code" href="classDatabase.html#a4">read</a>(1);           <span class="comment">// the header database only contains one record</span>
00071         setInfo = <a class="code" href="classGameSet.html#m3">set_info_array</a>+i-1;
00072 
00073         m.rtrim_fld( setInfo-&gt;<a class="code" href="structSetInfo.html#m0">code</a>, setRec-&gt;<a class="code" href="structSetRec.html#m0">code</a>, setRec-&gt;<a class="code" href="structSetRec.html#s2s0">CODE_LEN</a> );
00074         m.rtrim_fld( setInfo-&gt;<a class="code" href="structSetInfo.html#m1">des</a> , setRec-&gt;<a class="code" href="structSetRec.html#m1">des</a> , setRec-&gt;<a class="code" href="structSetRec.html#s2s1">DES_LEN</a>  );
00075     }
00076 }
00077 
00078 <span class="comment">//----------- End of GameSet::load_set_header -------------//</span>
00079 
00080 <span class="comment">//--------- Begin of GameSet::open_set -------------//</span>
00081 <span class="comment">//</span>
00082 <span class="comment">// Open the specific set.</span>
00083 <span class="comment">// Only one set can be activiated at a time in GameSet.</span>
00084 <span class="comment">//</span>
00085 <span class="comment">// &lt;int&gt; setId = the id. of the set; = 1 to ...</span>
00086 <span class="comment">//</span>
<a name="l00087"></a><a class="code" href="classGameSet.html#a5">00087</a> <span class="keywordtype">void</span> <a class="code" href="classGameSet.html#a5">GameSet::open_set</a>(<span class="keywordtype">int</span> setId) {
00088     <a class="code" href="ALL_8H.html#a2">err_if</a>( setId&lt;0 || setId&gt;<a class="code" href="classGameSet.html#m2">set_count</a> )
00089         <a class="code" href="ALL_8H.html#a1">err_here</a>();
00090 
00091     <a class="code" href="classGameSet.html#m1">cur_set_id</a> = setId;
00092 
00093     <a class="code" href="classString.html">String</a> str;
00094 
00095     str  = <a class="code" href="Gamedef_8h.html#a4">DIR_RES</a>;
00096     str += <a class="code" href="classGameSet.html#m3">set_info_array</a>[setId-1].<a class="code" href="structSetInfo.html#m0">code</a>;
00097     str += <span class="stringliteral">".SET"</span>;
00098 
00099     <a class="code" href="classGameSet.html#m4">set_res</a>.<a class="code" href="classResourceIdx.html#a3">init</a>( str, 0 );                         <span class="comment">// 0-don't read all into the buffer</span>
00100 
00101     <span class="comment">//-----------------------------------------------//</span>
00102 
00103     <a class="code" href="classGameSet.html#m6">set_opened_flag</a>=1;
00104 }
00105 
00106 <span class="comment">//----------- End of GameSet::open_set -------------//</span>
00107 
00108 <span class="comment">//--------- Begin of GameSet::close_set -------------//</span>
00109 <span class="comment">//</span>
00110 <span class="comment">// Close current set</span>
00111 <span class="comment">//</span>
<a name="l00112"></a><a class="code" href="classGameSet.html#a6">00112</a> <span class="keywordtype">void</span> <a class="code" href="classGameSet.html#a6">GameSet::close_set</a>() {
00113     <a class="code" href="classGameSet.html#m4">set_res</a>.<a class="code" href="classResourceIdx.html#a4">deinit</a>();
00114 
00115     <a class="code" href="classGameSet.html#m6">set_opened_flag</a>=0;
00116 }
00117 
00118 <span class="comment">//----------- End of GameSet::close_set -------------//</span>
00119 
00120 <span class="comment">//--------- Begin of GameSet::open_db -------------//</span>
00121 <span class="comment">//</span>
00122 <span class="comment">// Open a database in the current set</span>
00123 <span class="comment">//</span>
00124 <span class="comment">// &lt;char*&gt; dbName = the name of the database to be opened</span>
00125 <span class="comment">//</span>
<a name="l00126"></a><a class="code" href="classGameSet.html#a7">00126</a> <a class="code" href="classDatabase.html">Database</a>* <a class="code" href="classGameSet.html#a7">GameSet::open_db</a>(<span class="keywordtype">char</span>* dbName) {
00127     <a class="code" href="ALL_8H.html#a0">err_when</a>(!<a class="code" href="classGameSet.html#m6">set_opened_flag</a>);
00128 
00129     <span class="keywordtype">char</span>* dataPtr = <a class="code" href="classGameSet.html#m4">set_res</a>.<a class="code" href="classResourceIdx.html#a8">read</a>(dbName);
00130 
00131     <a class="code" href="ALL_8H.html#a0">err_when</a>( !dataPtr );
00132 
00133     <a class="code" href="classGameSet.html#m5">set_db</a>.<a class="code" href="classDatabase.html#a3">open_from_buf</a>(dataPtr);
00134 
00135     <span class="keywordflow">return</span> &amp;<a class="code" href="classGameSet.html#m5">set_db</a>;
00136 }
00137 
00138 <span class="comment">//----------- End of GameSet::open_db -------------//</span>
00139 
00140 <span class="comment">//--------- Begin of GameSet::get_db -------------//</span>
00141 
<a name="l00142"></a><a class="code" href="classGameSet.html#a8">00142</a> <a class="code" href="classDatabase.html">Database</a>* <a class="code" href="classGameSet.html#a8">GameSet::get_db</a>() {
00143     <a class="code" href="ALL_8H.html#a0">err_when</a>(!<a class="code" href="classGameSet.html#m6">set_opened_flag</a>);
00144 
00145     <span class="keywordflow">return</span> &amp;<a class="code" href="classGameSet.html#m5">set_db</a>;
00146 }
00147 
00148 <span class="comment">//----------- End of GameSet::get_db -------------//</span>
00149 
00150 <span class="comment">//--------- Begin of GameSet::find_set -------------//</span>
00151 <span class="comment">//</span>
00152 <span class="comment">// Look for a specified game set</span>
00153 <span class="comment">//</span>
00154 <span class="comment">// &lt;char*&gt; setCode = the code of the game set.</span>
00155 <span class="comment">//</span>
00156 <span class="comment">// return : &lt;int&gt; &gt;=1 - the id. of the game set</span>
00157 <span class="comment">//                  0 - the game set code is not found</span>
00158 <span class="comment">//</span>
<a name="l00159"></a><a class="code" href="classGameSet.html#a9">00159</a> <span class="keywordtype">int</span> <a class="code" href="classGameSet.html#a9">GameSet::find_set</a>(<span class="keywordtype">char</span>* setCode) {
00160     <span class="keywordtype">int</span> i;
00161 
00162     <span class="keywordflow">for</span>( i=0 ; i&lt;<a class="code" href="classGameSet.html#m2">set_count</a> ; i++ ) {
00163         <span class="keywordflow">if</span>( strcmp( <a class="code" href="classGameSet.html#m3">set_info_array</a>[i].code, setCode )==0 )
00164             <span class="keywordflow">return</span> i+1;
00165     }
00166 
00167     <span class="keywordflow">return</span> 0;
00168 }
00169 
00170 <span class="comment">//----------- End of GameSet::find_set -------------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:43 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
