<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Opsch_sc.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Opsch_sc.cpp</h1><a href="Opsch__sc_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OPSCHOOL.CPP</span>
00002 <span class="comment">//Description : PlayerSchool class - scenario; refer to td3.6</span>
00003 <span class="comment">//Owner       : Fred</span>
00004 
00005 <span class="preprocessor">#include &lt;OCONFIG.H&gt;</span>
00006 <span class="preprocessor">#include &lt;OAUDIO.H&gt;</span>
00007 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00008 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;<a class="code" href="OBOX_8H.html">OBOX.H</a>&gt;</span>
00010 <span class="preprocessor">#include &lt;OMATH.H&gt;</span>
00011 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>
00012 <span class="preprocessor">#include &lt;<a class="code" href="ODATE_8H.html">ODATE.H</a>&gt;</span>
00013 <span class="preprocessor">#include &lt;<a class="code" href="OSCHLRES_8H.html">OSCHLRES.H</a>&gt;</span>
00014 <span class="preprocessor">#include &lt;<a class="code" href="OGCONFIG_8H.html">OGCONFIG.H</a>&gt;</span>
00015 <span class="preprocessor">#include &lt;OSTUDENT.H&gt;</span>
00016 <span class="preprocessor">#include &lt;ODEPT.H&gt;</span>
00017 <span class="preprocessor">#include &lt;OFACULTY.H&gt;</span>
00018 <span class="preprocessor">#include &lt;OENROLL.H&gt;</span>
00019 <span class="preprocessor">#include &lt;OFINANCE.H&gt;</span>
00020 <span class="preprocessor">#include &lt;OATHLETI.H&gt;</span>
00021 <span class="preprocessor">#include &lt;OPSCHOOL.H&gt;</span>
00022 <span class="preprocessor">#include &lt;ONEWS.H&gt;</span>
00023 
00024 <span class="comment">//---------- Begin of function PlayerSchool::init_setting_scenario ---------//</span>
<a name="l00026"></a><a class="code" href="classPlayerSchool.html#a11">00026</a> <span class="comment">void PlayerSchool::init_setting_scenario(int scenId) {</span>
00027     <span class="comment">//scenId = SCN_STUDENT_DIVERSITY;   //## BUGHER</span>
00028 
00029     <a class="code" href="ALL_8H.html#a0">err_when</a>( scenId &lt;= <a class="code" href="Opschool_8h.html#a63a21">SCN_NONE</a> );
00030 
00031     scenario_id = scenId;
00032 
00033     <span class="comment">//----------- set the base settings for all types first -------//</span>
00034 
00035     student_market = <a class="code" href="Opschool_8h.html#a58a4">REGIONAL</a>;
00036     prestige    = <a class="code" href="Gamedef_8h.html#a73a23">INPUT_MEDIUM</a>;
00037     student_count = <a class="code" href="Gamedef_8h.html#a73a23">INPUT_MEDIUM</a>;
00038     sl5_student_percent = <a class="code" href="Gamedef_8h.html#a73a23">INPUT_MEDIUM</a>;
00039 
00040     parttime_undergrad_percent = <a class="code" href="Gamedef_8h.html#a73a23">INPUT_MEDIUM</a>;
00041     ug_get_degree_in_5year_percent = <a class="code" href="Gamedef_8h.html#a73a23">INPUT_MEDIUM</a>;
00042 
00043     fulltime_ug_in_housing_percent = <a class="code" href="Gamedef_8h.html#a73a23">INPUT_MEDIUM</a>;
00044     athletic_program_intensity     = <a class="code" href="Gamedef_8h.html#a73a23">INPUT_MEDIUM</a>;
00045 
00046     graduate_student_percent  = <a class="code" href="Gamedef_8h.html#a73a23">INPUT_MEDIUM</a>;
00047     nondegree_student_percent = 30;
00048 
00049     doctoral_program_intensity    = <a class="code" href="Gamedef_8h.html#a73a23">INPUT_MEDIUM</a>;
00050     sponsored_research_intensity  = <a class="code" href="Gamedef_8h.html#a73a23">INPUT_MEDIUM</a>;   <span class="comment">// ## useless parameter</span>
00051 
00052     relative_wealth     = <a class="code" href="Opschool_8h.html#a60a13">WEALTH_IN_BETWEEN</a>;        <span class="comment">//WEALTH_STRUGGLING,WEALTH_RICH</span>
00053 
00054     control         = <a class="code" href="Opschool_8h.html#a61a15">PRIVATE</a>;
00055     campus_environment  = <a class="code" href="Opschool_8h.html#a62a18">SUBURBAN</a>;
00056 
00057     chance_event_frequency = <a class="code" href="Gamedef_8h.html#a73a22">INPUT_LOW</a>;
00058     chance_objective_frequency = <a class="code" href="Gamedef_8h.html#a73a22">INPUT_LOW</a>;
00059 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00060 <span class="preprocessor"></span>    chance_perturbations = <a class="code" href="Gamedef_8h.html#a73a23">INPUT_MEDIUM</a>;
00061     behavioral_response_speed = <a class="code" href="Gamedef_8h.html#a73a22">INPUT_LOW</a>;          <span class="comment">// INPUT_LOW=Normal,INPUT_MEDIUM=faster,INPUT_HIGH=light-speed</span>
00062     threshold_event_flag = 1;
00063 <span class="preprocessor">#endif</span>
00064 <span class="preprocessor"></span>
00065     ug_get_degree_in_5year_percent = <a class="code" href="Gamedef_8h.html#a73a23">INPUT_MEDIUM</a>;
00066     location =  <a class="code" href="Opschool_8h.html#a59a11">PACIFIC</a>;
00067 
00068     <span class="comment">//-------- custom set each school type ----------//</span>
00069 
00070     <span class="keywordflow">switch</span> (school_type) {
00071     <span class="keywordflow">case</span> <a class="code" href="Gamedef_8h.html#a81a44">COMPREHENSIVE_SCHOOL</a>:
00072         graduate_student_percent  = <a class="code" href="Gamedef_8h.html#a73a22">INPUT_LOW</a>;
00073         control = <a class="code" href="Opschool_8h.html#a61a16">PUBLIC</a>;
00074         campus_environment = <a class="code" href="Opschool_8h.html#a62a17">URBAN</a>;
00075         sponsored_research_intensity = <a class="code" href="Gamedef_8h.html#a73a22">INPUT_LOW</a>;
00076         parttime_undergrad_percent = <a class="code" href="Gamedef_8h.html#a73a24">INPUT_HIGH</a>;
00077         doctoral_program_intensity  = <a class="code" href="Gamedef_8h.html#a73a22">INPUT_LOW</a>;
00078         <span class="keywordflow">break</span>;
00079 
00080     <span class="keywordflow">case</span> <a class="code" href="Gamedef_8h.html#a81a43">PUBLIC_SCHOOL</a>:
00081         control = <a class="code" href="Opschool_8h.html#a61a16">PUBLIC</a>;
00082         <span class="keywordflow">break</span>;
00083 
00084     <span class="keywordflow">case</span> <a class="code" href="Gamedef_8h.html#a81a42">LIBERAL_ARTS_SCHOOL</a>:
00085         fulltime_ug_in_housing_percent = <a class="code" href="Gamedef_8h.html#a73a24">INPUT_HIGH</a>;
00086         graduate_student_percent  = <a class="code" href="Gamedef_8h.html#a73a22">INPUT_LOW</a>;
00087         sponsored_research_intensity = <a class="code" href="Gamedef_8h.html#a73a22">INPUT_LOW</a>;
00088         campus_environment = <a class="code" href="Opschool_8h.html#a62a19">RURAL</a>;
00089         doctoral_program_intensity  = <a class="code" href="Gamedef_8h.html#a73a22">INPUT_LOW</a>;
00090         <span class="keywordflow">break</span>;
00091 
00092     <span class="keywordflow">case</span> <a class="code" href="Gamedef_8h.html#a81a41">PRIVATE_SCHOOL</a>:
00093         sponsored_research_intensity = <a class="code" href="Gamedef_8h.html#a73a24">INPUT_HIGH</a>;
00094 
00095         <span class="keywordflow">if</span> ( scenario_id == <a class="code" href="Opschool_8h.html#a63a31">SCN_BALANCE_BUDGET</a> )
00096             sponsored_research_intensity = <a class="code" href="Gamedef_8h.html#a73a23">INPUT_MEDIUM</a>;
00097         <span class="keywordflow">break</span>;
00098 
00099     <span class="keywordflow">default</span>:
00100         <a class="code" href="ALL_8H.html#a1">err_here</a>();
00101         <span class="keywordflow">break</span>;
00102     }
00103 
00104     <span class="comment">//------- translate option to values for the settings -------//</span>
00105 
00106     init_setting_non_scenario();
00107     calc_setting_vars();
00108 
00109   <span class="comment">//-------------------------------------------------------------//</span>
00110   <span class="comment">// select active departments</span>
00111 
00112     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> deptList1[<a class="code" href="Gamedef_8h.html#a81a45">INSTITUTIONAL_TYPE_COUNT</a>][DEPARTMENT_TYPE_COUNT] = {
00113         { 16,17,18,20,7,22,6,23,11,12,3,15,26, },
00114         { 16,21,18,11,12,13,22,7,26,3 },
00115         { 16,17,18,20,7,22,6,23,11,12,3,15,26,5 },
00116         { 1,8,3,5,16,18,22,11,6,7,12,14},
00117     };
00118     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> deptList2[<a class="code" href="Gamedef_8h.html#a81a45">INSTITUTIONAL_TYPE_COUNT</a>][DEPARTMENT_TYPE_COUNT] = {
00119         { 0,0,0,19,0,25,4,24,0,13,5,14,28, },
00120         { 17,24,20,0,9,0,25,0,28,5 },
00121         { 0,0,0,19,0,25,1,24,0,13,0,14,28,0 },
00122         { 0,0,0,0,17,20,25,0,0,4,15,19},
00123     };
00124 
00125     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> deptList3[<a class="code" href="Gamedef_8h.html#a81a45">INSTITUTIONAL_TYPE_COUNT</a>][DEPARTMENT_TYPE_COUNT] = {
00126         { 0,0,0,0,0,0,0,21,0,9,0,0,27, },
00127         { 0,0,19,0,0,0,0,0,0,0 },
00128         { 0,0,0,0,0,0,0,21,0,9,0,0,27,0 },
00129         { 0,0,0,0,0,0,0,0,0,0,0,0},
00130     };
00131 
00132     <span class="comment">//------ create a dept list without the constraint of MAX_DEPARTMENT ------//</span>
00133 
00134     <span class="keywordtype">int</span> deptCount=0;
00135 
00136     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;DEPARTMENT_TYPE_COUNT; i++) {
00137         <span class="keywordflow">if</span> ( deptList1[school_type][i] == 0 )
00138             <span class="keywordflow">break</span>;
00139         <span class="keywordflow">else</span>
00140             deptCount++;
00141 
00142         <span class="keywordflow">if</span> ( deptList2[school_type][i] == 0 )
00143             selected_department_list[i] = deptList1[school_type][i];
00144         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( deptList3[school_type][i] == 0 ) {
00145             <span class="comment">// 100% between list 1&amp;2</span>
00146             selected_department_list[i] = (m.random(2)==0)?deptList1[school_type][i]:deptList2[school_type][i];
00147         }
00148         <span class="keywordflow">else</span> {
00149             <span class="keywordtype">int</span> r=m.random(3);
00150 
00151             <span class="comment">// 100% between list 1&amp;2&amp;3</span>
00152             <span class="keywordflow">if</span> ( r==0 )
00153                 selected_department_list[i] = deptList1[school_type][i];
00154             <span class="keywordflow">else</span>
00155                 selected_department_list[i] = (r==1)?deptList2[school_type][i]:deptList3[school_type][i];
00156         }
00157 
00158         <a class="code" href="ALL_8H.html#a0">err_when</a>(selected_department_list[i] == 0);
00159     }
00160 
00161     <span class="comment">//----- chop out some depts if total # of depts &gt; MAX_DEPARTMENT -----//</span>
00162 
00163     <span class="keywordflow">if</span> ( deptCount &gt; <a class="code" href="Gamedef_8h.html#a10">MAX_DEPARTMENT</a> )
00164         <span class="keywordflow">for</span> (i=deptCount-<a class="code" href="Gamedef_8h.html#a10">MAX_DEPARTMENT</a>; i&gt;0; i--) {
00165             <span class="keywordtype">int</span> r=m.random(deptCount);
00166 
00167             <span class="comment">// "swap" with the last</span>
00168             selected_department_list[r] = selected_department_list[deptCount-1];
00169             selected_department_list[deptCount-1] = 0;
00170             deptCount--;
00171         }
00172 
00173     <span class="comment">//------- pre-initialization init for some scenarios ------//</span>
00174 
00175   <span class="comment">//------------------- SCN_TEACHING_QUALITY ---------------//</span>
00176 
00177     <span class="keywordflow">if</span> ( scenario_id == <a class="code" href="Opschool_8h.html#a63a24">SCN_TEACHING_QUALITY</a> || scenario_id == <a class="code" href="Opschool_8h.html#a63a25">SCN_RESEARCH_QUALITY</a> ) {
00178         init_scen_dept_selected(66);                  <span class="comment">// 66% of the department will be selected</span>
00179     }
00180 
00181     <span class="comment">//------------------- SCN_TEACHING_QUALITY ---------------//</span>
00182 
00183     <span class="keywordflow">if</span> ( scenario_id == <a class="code" href="Opschool_8h.html#a63a28">SCN_COMPENSATE_FOR_ENROLLMENT_SHIFTS</a> ) {
00184         init_scen_dept_selected(50);
00185     }
00186 }
00187 
00188 <span class="comment">//---------- End of function PlayerSchool::init_setting_scenario ---------//</span>
00189 
00190 <span class="comment">//---------- Begin of function PlayerSchool::scenario_check_target ----------//</span>
<a name="l00192"></a><a class="code" href="classPlayerSchool.html#a2">00192</a> <span class="comment">void PlayerSchool::scenario_check_target() {</span>
00193     <span class="keywordflow">if</span> ( scenario_id &lt;= <a class="code" href="Opschool_8h.html#a63a21">SCN_NONE</a> )
00194         <span class="keywordflow">return</span>;
00195 
00196     <span class="comment">//---------------------------------------------------------------------------//</span>
00197     <span class="comment">// when the player has achieved all possible goals in a scenario, display the</span>
00198     <span class="comment">// following message in a popup window</span>
00199     <span class="comment">//---------------------------------------------------------------------------//</span>
00200 
00201     <span class="keywordflow">if</span> ( scen_quit_game_flag &gt; 0  &amp;&amp;
00202          sys.view_mode != <a class="code" href="Osys_8h.html#a45a26">MODE_AWARD_REPORT</a> &amp;&amp;
00203          sys.view_mode != <a class="code" href="Osys_8h.html#a45a25">MODE_FINAL_SCORE</a> ) {
00204         <span class="keywordtype">int</span> rc = 0;
00205 
00206         vga.use_front();
00207         rc = box.ask(<span class="stringliteral">"You have achieved all possible scenario objectives.\n Do you want to continue playing?"</span>, <span class="stringliteral">"Yes"</span>, <span class="stringliteral">"No"</span>);
00208         vga.use_back();
00209 
00210         <span class="keywordflow">if</span> ( rc == 1 ) {
00211             scen_quit_game_flag = 0;                    <span class="comment">// continue play</span>
00212             sys.redraw_all_flag = 1;
00213         }
00214         <span class="keywordflow">else</span>
00215             sys.set_staying_view_mode(<a class="code" href="Osys_8h.html#a45a25">MODE_FINAL_SCORE</a>);<span class="comment">// should go to final game score screen</span>
00216 
00217         <span class="keywordflow">return</span>;
00218     }
00219 
00220     <span class="comment">//-------- check scenario target monthly ---------///</span>
00221 
00222     <span class="keywordflow">if</span> ( info.game_day != 1 )
00223         <span class="keywordflow">return</span>;
00224 
00225     <span class="comment">//----------------------------------//</span>
00226 
00227     <span class="keywordtype">int</span> i;
00228     <span class="keywordtype">int</span> plaque = -1;                                <span class="comment">// = enum { PLAQUE_GOLD=0, PLAQUE_SILVER, PLAQUE_BRONZE, TOTAL_PLAQUE_COUNT=3 };</span>
00229     <span class="keywordtype">int</span> bonus = 0;
00230     <span class="keywordtype">int</span> gameStartYear = date.year(info.game_start_date);
00231     <span class="keywordtype">int</span> yearPassed = info.game_year - gameStartYear;
00232 
00233     <span class="keywordflow">if</span> ( info.game_month &lt; date.month(info.game_start_date) )
00234         yearPassed--;
00235 
00236     <a class="code" href="ALL_8H.html#a0">err_when</a>( yearPassed &lt; 0 );
00237 
00238     <span class="comment">//---- if the game is approaching its time limit, display warning message ------//</span>
00239 
00240     <span class="keywordflow">if</span>( yearPassed == scenario_max_game_years - 1 &amp;&amp; info.game_month == 9 ) {
00241         news_array.scenario_near_end();
00242     }
00243 
00244     <span class="comment">//------- check the target of individual scenarios ------//</span>
00245 
00246     <span class="keywordflow">switch</span> (  scenario_id ) {
00247 
00248     <span class="keywordflow">case</span> <a class="code" href="Opschool_8h.html#a63a31">SCN_BALANCE_BUDGET</a>:
00249         <span class="keywordflow">if</span>( scen_balance_budget_score() &gt;= scenario_base ) {
00250             <span class="keywordflow">if</span> ( scenario_target[2] &lt;= finance.this_year.surplus_deficit ) {
00251                 <span class="keywordflow">if</span> ( yearPassed &lt;= goal_deadline[<a class="code" href="Opschool_8h.html#a64a35">PLAQUE_BRONZE</a>] )
00252                     plaque = <a class="code" href="Opschool_8h.html#a64a35">PLAQUE_BRONZE</a>;
00253             }
00254             <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( scenario_target[1] &lt;= finance.this_year.surplus_deficit ) {
00255                 <span class="keywordflow">if</span> ( yearPassed &lt;= goal_deadline[<a class="code" href="Opschool_8h.html#a64a34">PLAQUE_SILVER</a>] )
00256                     plaque = <a class="code" href="Opschool_8h.html#a64a34">PLAQUE_SILVER</a>;
00257             }
00258             <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( scenario_target[0] &lt;= finance.this_year.asset_array[<a class="code" href="Ofinance_8h.html#a97a20">AC_OPERATING_RESERVE</a>] ) {
00259                 <span class="keywordflow">if</span> ( yearPassed &lt;= goal_deadline[<a class="code" href="Opschool_8h.html#a64a33">PLAQUE_GOLD</a>] )
00260                     plaque = <a class="code" href="Opschool_8h.html#a64a33">PLAQUE_GOLD</a>;
00261             }
00262         }
00263         <span class="keywordflow">break</span>;
00264 
00265     <span class="keywordflow">case</span> <a class="code" href="Opschool_8h.html#a63a22">SCN_RAISE_SALARY</a>: {
00266         <span class="keywordflow">for</span>( i=0 ; i&lt;<a class="code" href="Opschool_8h.html#a64a36">TOTAL_PLAQUE_COUNT</a> ; i++ ) {
00267             <span class="keywordflow">if</span> ( yearPassed &gt; goal_deadline[i] )      <span class="comment">// exceeded time limit</span>
00268                 <span class="keywordflow">continue</span>;
00269 
00270             <span class="comment">//## chea  050899 if ( curSal &gt;= targetSal ) is the org. target checking</span>
00271             <span class="keywordflow">if</span> ( scenario_faculty_salary_increase &gt;= scenario_target[i] ) {
00272                 plaque = i;
00273                 <span class="keywordflow">break</span>;
00274             }
00275         }
00276     }
00277     <span class="keywordflow">break</span>;
00278 
00279     <span class="keywordflow">case</span> <a class="code" href="Opschool_8h.html#a63a23">SCN_INVEST_ACADEMIC</a> :
00280         <span class="keywordflow">for</span>( i=0 ; i&lt;<a class="code" href="Opschool_8h.html#a64a36">TOTAL_PLAQUE_COUNT</a> ; i++ ) {
00281             <span class="keywordflow">if</span>( yearPassed &lt;= goal_deadline[i] &amp;&amp;
00282                 <span class="comment">//## chea 260799 another way to do the same alg.</span>
00283                 scenario_target[i] &lt;= scenario_invest_academic_get_cur()-scenario_base ) {
00284                 plaque = i;
00285                 <span class="keywordflow">break</span>;
00286             }
00287         }
00288         <span class="keywordflow">break</span>;
00289 
00290     <span class="keywordflow">case</span> <a class="code" href="Opschool_8h.html#a63a24">SCN_TEACHING_QUALITY</a> :
00291         <span class="keywordflow">for</span>( i=0 ; i&lt;<a class="code" href="Opschool_8h.html#a64a36">TOTAL_PLAQUE_COUNT</a> ; i++ ) {
00292             <span class="keywordflow">if</span>( yearPassed &lt;= goal_deadline[i] &amp;&amp;
00293                 <span class="comment">//## chea 260799 another way to do the same alg.</span>
00294                 scenario_target[i] &lt;= sub_score[<a class="code" href="Opschool_8h.html#a65a40">S_EDUCATIONAL_QUALITY</a>][THIS_MONTH] ) {
00295                 plaque = i;
00296                 <span class="keywordflow">break</span>;
00297             }
00298         }
00299         <span class="keywordflow">break</span>;
00300 
00301     <span class="keywordflow">case</span> <a class="code" href="Opschool_8h.html#a63a25">SCN_RESEARCH_QUALITY</a> :
00302         <span class="keywordflow">for</span>( i=0 ; i&lt;<a class="code" href="Opschool_8h.html#a64a36">TOTAL_PLAQUE_COUNT</a> ; i++ ) {
00303             <span class="keywordflow">if</span>( yearPassed &lt;= goal_deadline[i] &amp;&amp;
00304                 <span class="comment">//## chea 260799 another way to do the same alg.</span>
00305                 scenario_target[i] &lt;= sub_score[<a class="code" href="Opschool_8h.html#a65a41">S_SCHOLARSHIP_BROADLY_DEFINED</a>][THIS_MONTH]  ) {
00306                 plaque = i;
00307                 <span class="keywordflow">break</span>;
00308             }
00309         }
00310         <span class="keywordflow">break</span>;
00311 
00312     <span class="keywordflow">case</span> <a class="code" href="Opschool_8h.html#a63a26">SCN_WINNING_ATHLETICS</a>:
00313         <span class="keywordflow">if</span> ( athletics_office.football_percent_win*100 &gt;= scenario_target[2] &amp;&amp;
00314              athletics_office.basketball_percent_win*100 &gt;= scenario_target[2] &amp;&amp;
00315              yearPassed &lt;= goal_deadline[<a class="code" href="Opschool_8h.html#a64a35">PLAQUE_BRONZE</a>] ) {
00316             plaque = <a class="code" href="Opschool_8h.html#a64a35">PLAQUE_BRONZE</a>;
00317         }
00318         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( athletics_office.football_percent_win*100 &gt;= scenario_target[1] &amp;&amp;
00319                   athletics_office.basketball_percent_win*100 &gt;= scenario_target[1] &amp;&amp;
00320                   yearPassed &lt;= goal_deadline[<a class="code" href="Opschool_8h.html#a64a34">PLAQUE_SILVER</a>] ) {
00321             plaque = <a class="code" href="Opschool_8h.html#a64a34">PLAQUE_SILVER</a>;
00322         }
00323         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( athletics_office.football_percent_win*100 &gt;= scenario_target[0] &amp;&amp;
00324                   athletics_office.basketball_percent_win*100 &gt;= scenario_target[0] &amp;&amp;
00325                   yearPassed &lt;= goal_deadline[<a class="code" href="Opschool_8h.html#a64a33">PLAQUE_GOLD</a>]
00326                   &amp;&amp; athletics_office.ncaa_level_input == <a class="code" href="Gamedef_8h.html#a73a24">INPUT_HIGH</a>
00327                   &amp;&amp; <a class="code" href="Gamedef_8h.html#a73a24">INPUT_HIGH</a> &gt; scenario_base ) {
00328             plaque = <a class="code" href="Opschool_8h.html#a64a33">PLAQUE_GOLD</a>;
00329         }
00330         <span class="keywordflow">break</span>;
00331 
00332     <span class="keywordflow">case</span> <a class="code" href="Opschool_8h.html#a63a27">SCN_LIMIT_TUITION_GROWTH</a>:
00333         <span class="keywordflow">if</span>( 100.0f * (1.0f - finance.tuition_rate  / scenario_float_base) &gt;= scenario_target[0]
00334             &amp;&amp; player_school.cur_game_score &gt;= scenario_target[1] ) {
00335             <span class="keywordflow">for</span> ( i=0; i&lt;<a class="code" href="Opschool_8h.html#a64a36">TOTAL_PLAQUE_COUNT</a>; i++ ) {
00336                 <span class="keywordflow">if</span> ( yearPassed &lt;= goal_deadline[i] ) {
00337                     plaque = i;
00338                     <span class="keywordflow">break</span>;
00339                 }
00340             }
00341         }
00342         <span class="keywordflow">break</span>;
00343 
00344     <span class="keywordflow">case</span> <a class="code" href="Opschool_8h.html#a63a28">SCN_COMPENSATE_FOR_ENROLLMENT_SHIFTS</a>:
00345         <span class="keywordflow">for</span> ( i=0; i&lt;<a class="code" href="Opschool_8h.html#a64a36">TOTAL_PLAQUE_COUNT</a>; i++ ) {
00346             <span class="keywordflow">if</span>( yearPassed &lt;= goal_deadline[i] &amp;&amp;
00347                 scenario_target[i] &lt;= sub_score[<a class="code" href="Opschool_8h.html#a65a40">S_EDUCATIONAL_QUALITY</a>][THIS_MONTH] ) {
00348                 plaque = i;
00349                 <span class="keywordflow">break</span>;
00350             }
00351         }
00352         <span class="keywordflow">break</span>;
00353 
00354     <span class="keywordflow">case</span> <a class="code" href="Opschool_8h.html#a63a29">SCN_STUDENT_DIVERSITY</a>:
00355         <span class="keywordflow">for</span>( i=0 ; i&lt;<a class="code" href="Opschool_8h.html#a64a36">TOTAL_PLAQUE_COUNT</a> ; i++ ) {
00356             <span class="keywordflow">if</span>( yearPassed &lt;= goal_deadline[i] &amp;&amp;
00357                 scenario_target[i] &lt;= enroll_res.overall_percent_minority ) {
00358                 plaque = i;
00359                 <span class="keywordflow">break</span>;
00360             }
00361         }
00362         <span class="keywordflow">break</span>;
00363 
00364     <span class="keywordflow">case</span> <a class="code" href="Opschool_8h.html#a63a30">SCN_FACULTY_DIVERSITY</a>: {
00365 
00366         <span class="keywordtype">int</span> totalFacCount = department_array.faculty_gender_history[<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>][THIS_YEAR];
00367         <span class="keywordtype">int</span> valueA = ( department_array.faculty_gender_history[<a class="code" href="Gamedef_8h.html#a75a29">MINORITY_MALE</a>][THIS_YEAR] + department_array.faculty_gender_history[<a class="code" href="Gamedef_8h.html#a75a30">MINORITY_FEMALE</a>][THIS_YEAR]) * 100 / totalFacCount;
00368         <span class="keywordtype">int</span> valueB = ( department_array.faculty_gender_history[<a class="code" href="Gamedef_8h.html#a75a30">MINORITY_FEMALE</a>][THIS_YEAR] + department_array.faculty_gender_history[<a class="code" href="Gamedef_8h.html#a75a28">NONMINORITY_FEMALE</a>][THIS_YEAR]) * 100 / totalFacCount;
00369 
00370         <span class="keywordflow">if</span> ( valueA &gt;= scenario_target[0] &amp;&amp; valueB &gt;= scenario_target[1] ) {
00371             <span class="keywordflow">for</span> ( i=0; i&lt;<a class="code" href="Opschool_8h.html#a64a36">TOTAL_PLAQUE_COUNT</a>; i++ )
00372                 <span class="keywordflow">if</span> ( yearPassed &lt;= goal_deadline[i] ) {
00373                     plaque = i;
00374                     <span class="comment">//0309 scen_quit_game_flag = 1;</span>
00375                     <span class="keywordflow">break</span>;
00376                 }
00377         }
00378 
00379     }
00380     <span class="keywordflow">break</span>;
00381     }
00382 
00383     <span class="comment">//--------- if the player has achieved an objective --------//</span>
00384 
00385     <span class="keywordflow">if</span>( plaque &gt;= 0 &amp;&amp; !plaque_granted[plaque] ) {  <span class="comment">// it is the first time the player gets the plaque</span>
00386         plaque_granted[plaque] = 1;
00387         plaque_last = plaque;
00388 
00389         <span class="comment">//------- add score bonus now -------//</span>
00390 
00391         <span class="keywordtype">int</span> bonusArray[<a class="code" href="Opschool_8h.html#a64a36">TOTAL_PLAQUE_COUNT</a>] = { 300,200,100 };
00392         add_bonus(bonusArray[plaque]);
00393 
00394         sys.set_staying_view_mode(<a class="code" href="Osys_8h.html#a45a26">MODE_AWARD_REPORT</a>); <span class="comment">// go to plaque screen</span>
00395 
00396         <span class="comment">// playsound</span>
00397         audio.play_wav(<span class="stringliteral">"NEWS"</span>, audio.int_to_DsVolume(config.sound_effect_volume));
00398 
00399         <span class="comment">//--- if no other objectives can be possibly be achieved, prompt if the player wants to quit ---//</span>
00400 
00401         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0 ; i&lt;<a class="code" href="Opschool_8h.html#a64a36">TOTAL_PLAQUE_COUNT</a> ; i++) {
00402             <span class="comment">// if none of the plaque that have not been achieved are still within the time limit</span>
00403             <span class="keywordflow">if</span>( !plaque_granted[i] &amp;&amp; yearPassed &lt;= goal_deadline[i] )
00404                 <span class="keywordflow">break</span>;
00405         }
00406 
00407         <span class="keywordflow">if</span>( i==<a class="code" href="Opschool_8h.html#a64a36">TOTAL_PLAQUE_COUNT</a> )                   <span class="comment">// if none of the plaque that have not been achieved are still within the time limit</span>
00408             scen_quit_game_flag = 1;
00409     }
00410 
00411     <span class="comment">//----- End the game if it PASSED "scenario_max_game_years" years. -----//</span>
00412 
00413     <span class="keywordflow">if</span> ( yearPassed == scenario_max_game_years ) {
00414         <span class="keywordflow">if</span> ( plaque_granted[0] + plaque_granted[1] + plaque_granted[2] &lt;= 0 ) {
00415             <span class="comment">// go to lost screen and then final score screen</span>
00416             sys.set_staying_view_mode(<a class="code" href="Osys_8h.html#a45a24">MODE_LOSE_GAME</a>);
00417         }
00418         <span class="keywordflow">else</span> {                                        <span class="comment">//--- if the player has previously achieved one of the objectives ---//</span>
00419             scen_quit_game_flag = 2;                    <span class="comment">// signal MODE_FINAL_SCORE to ignore mouse.any_click</span>
00420 
00421             <span class="comment">// display newspaper</span>
00422             news_array.scenario_news(1);                <span class="comment">// 1: end of scenario</span>
00423 
00424             <span class="comment">// to go to scenario achivement report then to final score screen</span>
00425             sys.set_staying_view_mode(<a class="code" href="Osys_8h.html#a45a25">MODE_FINAL_SCORE</a>);
00426         }
00427     }
00428 }
00429 
00430 <span class="comment">//----------- End of function PlayerSchool::scenario_check_target -----------//</span>
00431 
00432 <span class="comment">//---------- Begin of function PlayerSchool::scenario_invest_academic_get_cur ---------//</span>
<a name="l00434"></a><a class="code" href="classPlayerSchool.html#a3">00434</a> <span class="comment">int PlayerSchool::scenario_invest_academic_get_cur() {</span>
00435     <a class="code" href="ALL_8H.html#a0">err_when</a>(<a class="code" href="Opschool_8h.html#a63a23">SCN_INVEST_ACADEMIC</a> != scenario_id);
00436 
00437     <span class="comment">//-------- build an array of departments whose performance is relevant to the scenario's objective ----//</span>
00438 
00439     <span class="keyword">const</span> <span class="keywordtype">int</span> deptList[<a class="code" href="Gamedef_8h.html#a81a45">INSTITUTIONAL_TYPE_COUNT</a>][DEPARTMENT_TYPE_COUNT] = {
00440         { 16,17,18,20,19,6,14, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
00441         { 9,10,11,12,13,7,26,28,27, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
00442         { 21,22,23,24,25,15,4, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
00443         { 1,2,3,5,8, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
00444     };
00445 
00446     <span class="keywordtype">int</span> scenSpecialDept[<a class="code" href="Gamedef_8h.html#a10">MAX_DEPARTMENT</a>];
00447 
00448     memset(scenSpecialDept, 0, <span class="keyword">sizeof</span>(scenSpecialDept));
00449 
00450     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;DEPARTMENT_TYPE_COUNT; i++) {
00451         <span class="keywordtype">int</span> deptId = deptList[school_type][i];
00452 
00453         <span class="keywordflow">if</span> ( deptId &lt;= 0 )
00454             <span class="keywordflow">break</span>;
00455 
00456         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> d=department_array.size(); d&gt;0; d--) {
00457             <span class="keywordflow">if</span> ( department_array[d]-&gt;department_id == deptId ) {
00458                 scenSpecialDept[i] = d;
00459                 <span class="keywordflow">break</span>;
00460             }
00461         }
00462     }
00463 
00464     <span class="keywordflow">if</span> ( scenSpecialDept[0] &lt;= 0 )
00465         <span class="keywordflow">return</span> 0;
00466 
00467     <span class="comment">//---- calc weighted average prestige of listed depts over number of students: ----//</span>
00468 
00469     <span class="keywordtype">float</span> value = 0, stuCount = 0;
00470     <a class="code" href="classDepartment.html">Department</a> *deptPtr;
00471 
00472     <span class="keywordflow">for</span> ( i=0; scenSpecialDept[i] &gt; 0 &amp;&amp; i &lt; DEPARTMENT_TYPE_COUNT ; i++ ) {
00473         deptPtr = department_array[scenSpecialDept[i]];
00474 
00475         <span class="comment">// academic standing = prestige</span>
00476         value += deptPtr-&gt;<a class="code" href="classDepartment.html#m39">p_academic_standing</a> * deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#m1">student_count</a>;
00477         stuCount += deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#m1">student_count</a>;
00478     }
00479 
00480     <span class="keywordflow">return</span> (int) max(1.0f, value/stuCount);         <span class="comment">// min &amp; max bug chea</span>
00481 }
00482 
00483 <span class="comment">//---------- Begin of function PlayerSchool::scenario_invest_academic_get_cur ---------//</span>
00484 
00485 <span class="comment">//----------- End of function init_scen_dept_selected -----------//</span>
00486 
<a name="l00487"></a><a class="code" href="classPlayerSchool.html#a4">00487</a> <span class="keywordtype">void</span> <a class="code" href="classPlayerSchool.html#a4">PlayerSchool::init_scen_dept_selected</a>(<span class="keywordtype">int</span> selectPercent) {
00488     <span class="comment">//---- Select 2/3 (rounded) of the departments at random. -----//</span>
00489 
00490     <span class="keywordtype">int</span> i, toBeSelectedDeptCount = int((<span class="keywordtype">float</span>) <a class="code" href="Gamedef_8h.html#a10">MAX_DEPARTMENT</a> * (<span class="keywordtype">float</span>) selectPercent / 100.0f + 0.5f);
00491 
00492     memset(<a class="code" href="classPlayerSchool.html#m45">scen_dept_selected_array</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="classPlayerSchool.html#m45">scen_dept_selected_array</a>));
00493 
00494     <span class="keywordflow">for</span> (i=0; i&lt;toBeSelectedDeptCount ; i++) {
00495         <span class="keywordflow">while</span>(1) {
00496             <span class="keywordtype">int</span> id = m.random(<a class="code" href="Gamedef_8h.html#a10">MAX_DEPARTMENT</a>);
00497 
00498             <span class="keywordflow">if</span> ( <a class="code" href="classPlayerSchool.html#m45">scen_dept_selected_array</a>[id] == 0 ) {
00499                 <a class="code" href="classPlayerSchool.html#m45">scen_dept_selected_array</a>[id] = 1;
00500                 <span class="keywordflow">break</span>;
00501             }
00502         }
00503     }
00504 }
00505 
00506 <span class="comment">//----------- End of function init_scen_dept_selected -----------//</span>
00507 
00508 <span class="comment">//----------- End of function scen_balance_budget_score -----------//</span>
00509 
<a name="l00510"></a><a class="code" href="classPlayerSchool.html#a5">00510</a> <span class="keywordtype">float</span> <a class="code" href="classPlayerSchool.html#a5">PlayerSchool::scen_balance_budget_score</a>() {
00511     <span class="keywordflow">return</span> <a class="code" href="classPlayerSchool.html#m94">cur_game_score</a>;
00512 
00513     <span class="comment">//  return (score_sub_total[1][THIS_MONTH] + score_sub_total[2][THIS_MONTH] ) *</span>
00514     <span class="comment">//                   100 / (score_group_weight[1] + score_group_weight[2]);</span>
00515 }
00516 
00517 <span class="comment">//----------- End of function scen_balance_budget_score -----------//</span>
00518 
00519 <span class="comment">//---------- Being of function PlayerSchool::init_scenario ---------//</span>
00520 
<a name="l00521"></a><a class="code" href="classPlayerSchool.html#a13">00521</a> <span class="keywordtype">void</span> <a class="code" href="classPlayerSchool.html#a13">PlayerSchool::init_scenario</a>() {
00522     <span class="keywordflow">if</span>( !<a class="code" href="classPlayerSchool.html#m32">scenario_id</a> )
00523         <span class="keywordflow">return</span>;
00524 
00525     <span class="comment">//--- set scenario setting before update_external_factors_monthly ---//</span>
00526 
00527     <span class="keywordtype">int</span> i;
00528 
00529     <span class="comment">//----------- SCN_BALANCE_BUDGET ------------------//</span>
00530 
00531     <span class="keywordflow">if</span>( <a class="code" href="classPlayerSchool.html#m32">scenario_id</a> == <a class="code" href="Opschool_8h.html#a63a31">SCN_BALANCE_BUDGET</a> ) {
00532         <span class="keywordflow">if</span>( <a class="code" href="classPlayerSchool.html#m31">school_type</a>==<a class="code" href="Gamedef_8h.html#a81a42">LIBERAL_ARTS_SCHOOL</a> || <a class="code" href="classPlayerSchool.html#m31">school_type</a>==<a class="code" href="Gamedef_8h.html#a81a41">PRIVATE_SCHOOL</a> ) {
00533             <span class="keywordflow">if</span>( <a class="code" href="classPlayerSchool.html#m31">school_type</a>==<a class="code" href="Gamedef_8h.html#a81a42">LIBERAL_ARTS_SCHOOL</a> )
00534                 finance.projected_revenue_array[<a class="code" href="Ofinance_8h.html#a101a33">AC_FINANCIAL_AID</a>].this_year.total *= 1.3f;
00535             <span class="keywordflow">else</span>
00536                 finance.projected_revenue_array[<a class="code" href="Ofinance_8h.html#a101a33">AC_FINANCIAL_AID</a>].this_year.total *= 1.375f;
00537 
00538             <span class="comment">// re-calculate net tuition</span>
00539             finance.projected_revenue_array[<a class="code" href="Ofinance_8h.html#a101a34">AC_NET_TUITION_INCOME</a>].this_year.total =
00540                 finance.projected_revenue_array[<a class="code" href="Ofinance_8h.html#a101a32">AC_GROSS_TUITION_INCOME</a>].this_year.total +
00541                 finance.projected_revenue_array[<a class="code" href="Ofinance_8h.html#a101a33">AC_FINANCIAL_AID</a>].this_year.total;
00542         }
00543         <span class="keywordflow">else</span> {
00544             finance.projected_revenue_array[<a class="code" href="Ofinance_8h.html#a101a41">AC_STATE_APPROPRIATION</a>].this_year.total *= 0.8;
00545             finance.projected_revenue_array[<a class="code" href="Ofinance_8h.html#a101a41">AC_STATE_APPROPRIATION</a>].next_year.total *= 0.8;
00546             finance.projected_revenue_array[<a class="code" href="Ofinance_8h.html#a101a41">AC_STATE_APPROPRIATION</a>].last_month.total *= 0.8;
00547             finance.projected_revenue_array[<a class="code" href="Ofinance_8h.html#a101a41">AC_STATE_APPROPRIATION</a>].year_to_date.total *= 0.8;
00548         }
00549 
00550         finance.calc_projected_total_n_percent(1);    <span class="comment">// 1-re-calculation, not first time calculation</span>
00551 
00552         <span class="comment">//------------ set scenario targets ----------------//</span>
00553 
00554         <a class="code" href="classPlayerSchool.html#m33">scenario_base</a> = (int) <a class="code" href="classPlayerSchool.html#a5">scen_balance_budget_score</a>()+5;
00555 
00556         <a class="code" href="classPlayerSchool.html#m35">scenario_target</a>[0] = (int) goal_config.goal_scen(<a class="code" href="Opschool_8h.html#a63a31">SCN_BALANCE_BUDGET</a>)-&gt;goal_value[0];
00557         <span class="comment">// op reseve</span>
00558         <a class="code" href="classPlayerSchool.html#m35">scenario_target</a>[1] = (int) finance.last_year.asset_array[<a class="code" href="Ofinance_8h.html#a97a20">AC_OPERATING_RESERVE</a>];
00559         <a class="code" href="classPlayerSchool.html#m35">scenario_target</a>[2] = (int) 0;
00560     }
00561 
00562     <span class="comment">//----------- SCN_RAISE_SALARY ------------------//</span>
00563 
00564     <span class="keywordflow">if</span> ( <a class="code" href="classPlayerSchool.html#m32">scenario_id</a> == <a class="code" href="Opschool_8h.html#a63a22">SCN_RAISE_SALARY</a> ) {
00565         <a class="code" href="classPlayerSchool.html#m33">scenario_base</a> = 0;                            <span class="comment">// it is not used, faculty salary increase is stored in player_school.scenario_faculty_salary_increase</span>
00566 
00567         <span class="keywordflow">for</span>( i=0 ; i&lt;3 ; i++ )
00568             <a class="code" href="classPlayerSchool.html#m35">scenario_target</a>[i] = (int) goal_config.goal_scen(<a class="code" href="Opschool_8h.html#a63a22">SCN_RAISE_SALARY</a>)-&gt;goal_value[i];
00569 
00570         <a class="code" href="classPlayerSchool.html#m39">scenario_faculty_salary_increase</a> = 0;         <span class="comment">// reset it</span>
00571     }
00572 
00573     <span class="comment">//----------- SCN_INVEST_ACADEMIC ------------------//</span>
00574 
00575     <span class="keywordflow">if</span>( <a class="code" href="classPlayerSchool.html#m32">scenario_id</a> == <a class="code" href="Opschool_8h.html#a63a23">SCN_INVEST_ACADEMIC</a> ) {
00576         <span class="comment">//---- set base variables --------//</span>
00577 
00578         <span class="keywordtype">float</span> spendRate = float( finance.revenue_policy_array[<a class="code" href="Ofinance_8h.html#a108a67">PL_ENDOWMENT_SPENDING_RATE</a>].target_value / 100 );
00579         <span class="keywordtype">int</span> scenEndowment = 20000;                    <span class="comment">// 20 million</span>
00580 
00581         scenEndowment = (int) m.fmax((<span class="keywordtype">float</span>)(math.get_random_snd(0.1f, 0.01f) * finance.last_year.asset_array[<a class="code" href="Ofinance_8h.html#a97a22">AC_ENDOWMENT</a>]),
00582                                      <span class="comment">//min &amp; max bug chea</span>
00583                                      (float)(math.get_random_snd(scenEndowment, 1000.0f)) );
00584 
00585         <a class="code" href="classPlayerSchool.html#m36">scenario_base1</a> = scenEndowment;               <span class="comment">// increased endowment amount</span>
00586         <span class="comment">// spending</span>
00587         <a class="code" href="classPlayerSchool.html#m37">scenario_base2</a> = int(spendRate * scenEndowment);
00588 
00589         <span class="comment">//-------- set scenario target ---------//</span>
00590 
00591         <a class="code" href="classPlayerSchool.html#m33">scenario_base</a> = <a class="code" href="classPlayerSchool.html#a3">scenario_invest_academic_get_cur</a>();
00592 
00593         <span class="keywordflow">for</span>( i=0 ; i&lt;3 ; i++ ) {
00594             <a class="code" href="classPlayerSchool.html#m35">scenario_target</a>[i] = (int) goal_config.goal_scen(<a class="code" href="Opschool_8h.html#a63a23">SCN_INVEST_ACADEMIC</a>)-&gt;goal_value[i];
00595         }
00596 
00597         <span class="comment">//------ modify the financial vars --------//</span>
00598 
00599         <span class="comment">//--- increase Endowment asset by $20 million ----//</span>
00600 
00601         <a class="code" href="classPlayerSchool.html#m40">scenario_endowment_increase</a> = (float) scenEndowment;
00602 
00603         finance.this_year.asset_array[<a class="code" href="Ofinance_8h.html#a97a22">AC_ENDOWMENT</a>]   += scenEndowment;
00604         <span class="comment">// this one is used to display both "Total assets" and "Total liabilities and fund balance"</span>
00605         finance.this_year.asset_array[<a class="code" href="Ofinance_8h.html#a97a25">AC_ASSET_TOTAL</a>] += scenEndowment;
00606 
00607         finance.next_year.asset_array[<a class="code" href="Ofinance_8h.html#a97a22">AC_ENDOWMENT</a>]   += scenEndowment;
00608         <span class="comment">// this one is used to display both "Total assets" and "Total liabilities and fund balance"</span>
00609         finance.next_year.asset_array[<a class="code" href="Ofinance_8h.html#a97a25">AC_ASSET_TOTAL</a>] += scenEndowment;
00610 
00611 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00612 <span class="preprocessor"></span>        finance.this_year.asset_array[AC_QUASI] += scenEndowment;
00613 <span class="preprocessor">#endif</span>
00614 <span class="preprocessor"></span>
00615         <span class="comment">//---- promise to incrase endowment spending in the next year's budget ----//</span>
00616 
00617         <span class="comment">//              finance.change_budget(ANNOUNCE_NEXT_YEAR, true, AC_ENDOWMENT_SPENDING, spendRate*100, 0);               // *100 to convert to percentage. 0-do not show budget</span>
00618     }
00619 
00620     <span class="comment">//------------------- SCN_TEACHING_QUALITY ---------------//</span>
00621 
00622     <span class="keywordflow">if</span> ( <a class="code" href="classPlayerSchool.html#m32">scenario_id</a> == <a class="code" href="Opschool_8h.html#a63a24">SCN_TEACHING_QUALITY</a> ) {
00623         <span class="comment">//-----------------------------------------------------------------------//</span>
00624         <span class="comment">// For the selected departments, reset the priorities for "course preparation",</span>
00625         <span class="comment">// "out-of-class contact", and "educational development" to Rniv[3,1]; "research",</span>
00626         <span class="comment">// "scholarship," and "institutional and public service" to Rniv[7,1].</span>
00627         <span class="comment">// (See Section 2 for the definition of Rniv[m,s].)</span>
00628         <span class="comment">//-----------------------------------------------------------------------//</span>
00629 
00630         <span class="keywordflow">for</span> (i=0; i&lt;department_array.department_count; i++) {
00631             <span class="keywordflow">if</span> ( <a class="code" href="classPlayerSchool.html#m45">scen_dept_selected_array</a>[i] != 1 )
00632                 <span class="keywordflow">continue</span>;
00633 
00634             <span class="comment">//------ set faculty discretionary time priority -------//</span>
00635 
00636             <a class="code" href="classDepartment.html">Department</a>* deptPtr = department_array[i+1];
00637             <span class="keywordtype">int</span> t;
00638 
00639             t = math.get_random_snd(3, 1);
00640             deptPtr-&gt;<a class="code" href="classDepartment.html#m10">priority_discretionary_hour_array</a>[<a class="code" href="Ofaculty_8h.html#a29a15">DT_COURSE_PREPARATION</a>] = max(0, min(10,t));
00641             t = math.get_random_snd(3, 1);
00642             deptPtr-&gt;<a class="code" href="classDepartment.html#m10">priority_discretionary_hour_array</a>[<a class="code" href="Ofaculty_8h.html#a29a16">DT_OUT_OF_CLASS_STUDENT_CONTACT</a>] = max(0, min(10,t));
00643             t = math.get_random_snd(3, 1);
00644             deptPtr-&gt;<a class="code" href="classDepartment.html#m10">priority_discretionary_hour_array</a>[<a class="code" href="Ofaculty_8h.html#a29a17">DT_EDUCATIONAL_DEVELOPMENT</a>] = max(0, min(10,t));
00645 
00646             t = math.get_random_snd(7, 1);
00647             deptPtr-&gt;<a class="code" href="classDepartment.html#m10">priority_discretionary_hour_array</a>[<a class="code" href="Ofaculty_8h.html#a29a18">DT_RESEARCH</a>] = max(0, min(10,t));
00648             t = math.get_random_snd(7, 1);
00649             deptPtr-&gt;<a class="code" href="classDepartment.html#m10">priority_discretionary_hour_array</a>[<a class="code" href="Ofaculty_8h.html#a29a19">DT_SCHOLARSHIP</a>] = max(0, min(10,t));
00650             t = math.get_random_snd(7, 1);
00651             deptPtr-&gt;<a class="code" href="classDepartment.html#m10">priority_discretionary_hour_array</a>[<a class="code" href="Ofaculty_8h.html#a29a20">DT_INSTITUTIONAL_AND_PUBLIC_SERVICE</a>] = max(0, min(10,t));
00652 
00653             memcpy( deptPtr-&gt;<a class="code" href="classDepartment.html#m11">last_priority_discretionary_hour_array</a>, deptPtr-&gt;<a class="code" href="classDepartment.html#m10">priority_discretionary_hour_array</a>, <span class="keyword">sizeof</span>(deptPtr-&gt;<a class="code" href="classDepartment.html#m10">priority_discretionary_hour_array</a>));
00654         }
00655 
00656         <span class="comment">//---------- set scenario target ----------//</span>
00657 
00658         <a class="code" href="classPlayerSchool.html#m33">scenario_base</a> = (int) <a class="code" href="classPlayerSchool.html#m84">sub_score</a>[<a class="code" href="Opschool_8h.html#a65a40">S_EDUCATIONAL_QUALITY</a>][THIS_MONTH];
00659 
00660         <span class="keywordflow">for</span>( i=0 ; i&lt;3 ; i++ ) {
00661             <a class="code" href="classPlayerSchool.html#m35">scenario_target</a>[i] = <a class="code" href="classPlayerSchool.html#m33">scenario_base</a> + (int) goal_config.goal_scen(<a class="code" href="Opschool_8h.html#a65a40">S_EDUCATIONAL_QUALITY</a>)-&gt;goal_value[i];
00662             <a class="code" href="classPlayerSchool.html#m35">scenario_target</a>[i] = min(100, <a class="code" href="classPlayerSchool.html#m35">scenario_target</a>[i]);
00663         }
00664     }
00665 
00666     <span class="comment">//------------- SCN_RESEARCH_QUALITY --------------//</span>
00667 
00668     <span class="keywordflow">if</span>( <a class="code" href="classPlayerSchool.html#m32">scenario_id</a> == <a class="code" href="Opschool_8h.html#a63a25">SCN_RESEARCH_QUALITY</a> ) {
00669         <span class="comment">//-----------------------------------------------------------------------//</span>
00670         <span class="comment">// (3)  For these departments, reset the priorities for "course preparation"</span>
00671         <span class="comment">// and "out-of-class contact" to Rniv[7,1]; set "research" and "scholarship"</span>
00672         <span class="comment">// to Rniv[3,1]. (See Section 2 for the definition of Rniv[m,s].)</span>
00673         <span class="comment">//-----------------------------------------------------------------------//</span>
00674 
00675         <span class="keywordflow">for</span> (i=0; i&lt;department_array.department_count; i++) {
00676             <span class="keywordflow">if</span> ( <a class="code" href="classPlayerSchool.html#m45">scen_dept_selected_array</a>[i] != 1 )
00677                 <span class="keywordflow">continue</span>;
00678 
00679             <a class="code" href="classDepartment.html">Department</a>* deptPtr = department_array[i+1];
00680             <span class="keywordtype">int</span> t;
00681 
00682             t = math.get_random_snd(7, 1);
00683             deptPtr-&gt;<a class="code" href="classDepartment.html#m10">priority_discretionary_hour_array</a>[<a class="code" href="Ofaculty_8h.html#a29a15">DT_COURSE_PREPARATION</a>] = max(0, min(10,t));
00684             t = math.get_random_snd(7, 1);
00685             deptPtr-&gt;<a class="code" href="classDepartment.html#m10">priority_discretionary_hour_array</a>[<a class="code" href="Ofaculty_8h.html#a29a16">DT_OUT_OF_CLASS_STUDENT_CONTACT</a>] = max(0, min(10,t));
00686 
00687             t = math.get_random_snd(3, 1);
00688             deptPtr-&gt;<a class="code" href="classDepartment.html#m10">priority_discretionary_hour_array</a>[<a class="code" href="Ofaculty_8h.html#a29a18">DT_RESEARCH</a>] = max(0, min(10,t));
00689             t = math.get_random_snd(3, 1);
00690             deptPtr-&gt;<a class="code" href="classDepartment.html#m10">priority_discretionary_hour_array</a>[<a class="code" href="Ofaculty_8h.html#a29a19">DT_SCHOLARSHIP</a>] = max(0, min(10,t));
00691 
00692             memcpy( deptPtr-&gt;<a class="code" href="classDepartment.html#m11">last_priority_discretionary_hour_array</a>, deptPtr-&gt;<a class="code" href="classDepartment.html#m10">priority_discretionary_hour_array</a>, <span class="keyword">sizeof</span>(deptPtr-&gt;<a class="code" href="classDepartment.html#m10">priority_discretionary_hour_array</a>));
00693         }
00694 
00695         <span class="comment">//-------- set scenario targets -----------//</span>
00696 
00697         <a class="code" href="classPlayerSchool.html#m33">scenario_base</a> = (int) <a class="code" href="classPlayerSchool.html#m84">sub_score</a>[<a class="code" href="Opschool_8h.html#a65a41">S_SCHOLARSHIP_BROADLY_DEFINED</a>][THIS_MONTH];
00698 
00699         <span class="keywordflow">for</span>( i=0 ; i&lt;3 ; i++ ) {
00700             <a class="code" href="classPlayerSchool.html#m35">scenario_target</a>[i] = <a class="code" href="classPlayerSchool.html#m33">scenario_base</a> + (int) goal_config.goal_scen(<a class="code" href="Opschool_8h.html#a65a41">S_SCHOLARSHIP_BROADLY_DEFINED</a>)-&gt;goal_value[i];
00701             <a class="code" href="classPlayerSchool.html#m35">scenario_target</a>[i] = min(100, <a class="code" href="classPlayerSchool.html#m35">scenario_target</a>[i]);
00702         }
00703     }
00704 
00705     <span class="comment">//------------------- SCN_WINNING_ATHLETICS -------------------//</span>
00706 
00707     <span class="keywordflow">if</span> ( <a class="code" href="classPlayerSchool.html#m32">scenario_id</a> == <a class="code" href="Opschool_8h.html#a63a26">SCN_WINNING_ATHLETICS</a> ) {
00708         <span class="comment">//-------- set scenario targets -----------//</span>
00709 
00710         <a class="code" href="classPlayerSchool.html#m33">scenario_base</a> = athletics_office.ncaa_level_input;
00711 
00712         <span class="keywordflow">for</span>( i=0 ; i&lt;3 ; i++ ) {
00713             <a class="code" href="classPlayerSchool.html#m35">scenario_target</a>[i] = (int) goal_config.goal_scen(<a class="code" href="Opschool_8h.html#a63a26">SCN_WINNING_ATHLETICS</a>)-&gt;goal_value[i];
00714         }
00715     }
00716 
00717     <span class="comment">//------------------- SCN_LIMIT_TUITION_GROWTH -------------------//</span>
00718 
00719     <span class="keywordflow">if</span> ( <a class="code" href="classPlayerSchool.html#m32">scenario_id</a> == <a class="code" href="Opschool_8h.html#a63a27">SCN_LIMIT_TUITION_GROWTH</a> ) {
00720         <a class="code" href="classPlayerSchool.html#m38">scenario_float_base</a> = (float) finance.tuition_rate;
00721 
00722         <a class="code" href="classPlayerSchool.html#m35">scenario_target</a>[0] = (int) goal_config.goal_scen(<a class="code" href="Opschool_8h.html#a63a27">SCN_LIMIT_TUITION_GROWTH</a>)-&gt;goal_value[0];
00723         <a class="code" href="classPlayerSchool.html#m35">scenario_target</a>[1] = int( player_school.cur_game_score * 1.1f );
00724     }
00725 
00726     <span class="comment">//------------- SCN_COMPENSATE_FOR_ENROLLMENT_SHIFTS --------//</span>
00727 
00728     <span class="keywordflow">if</span> ( <a class="code" href="classPlayerSchool.html#m32">scenario_id</a> == <a class="code" href="Opschool_8h.html#a63a28">SCN_COMPENSATE_FOR_ENROLLMENT_SHIFTS</a> ) {
00729         <span class="comment">// educational quality</span>
00730         <a class="code" href="classPlayerSchool.html#m33">scenario_base</a> = (int) <a class="code" href="classPlayerSchool.html#m84">sub_score</a>[<a class="code" href="Opschool_8h.html#a65a40">S_EDUCATIONAL_QUALITY</a>][THIS_MONTH];
00731 
00732         <span class="keywordflow">for</span>( i=0 ; i&lt;3 ; i++ ) {
00733             <a class="code" href="classPlayerSchool.html#m35">scenario_target</a>[i] = int( (<span class="keywordtype">float</span>) <a class="code" href="classPlayerSchool.html#m33">scenario_base</a> * goal_config.goal_scen(<a class="code" href="Opschool_8h.html#a63a28">SCN_COMPENSATE_FOR_ENROLLMENT_SHIFTS</a>)-&gt;goal_value[i] );
00734         }
00735     }
00736 
00737     <span class="comment">//------------------ SCN_STUDENT_DIVERSITY ---------------//</span>
00738 
00739     <span class="keywordflow">if</span> ( <a class="code" href="classPlayerSchool.html#m32">scenario_id</a> == <a class="code" href="Opschool_8h.html#a63a29">SCN_STUDENT_DIVERSITY</a> ) {
00740         <a class="code" href="classPlayerSchool.html#m33">scenario_base</a> = enroll_res.overall_percent_minority;
00741 
00742         <span class="keywordflow">for</span>( i=0 ; i&lt;3 ; i++ ) {
00743             <a class="code" href="classPlayerSchool.html#m35">scenario_target</a>[i] = int( enroll_res.overall_percent_minority *
00744                                       goal_config.goal_scen(<a class="code" href="Opschool_8h.html#a63a29">SCN_STUDENT_DIVERSITY</a>)-&gt;goal_value[i] );
00745 
00746             <a class="code" href="classPlayerSchool.html#m35">scenario_target</a>[i] = min(100, <a class="code" href="classPlayerSchool.html#m35">scenario_target</a>[i]);
00747         }
00748     }
00749 
00750     <span class="comment">//------------- SCN_FACULTY_DIVERSITY ----------------//</span>
00751 
00752     <span class="keywordflow">if</span> ( <a class="code" href="classPlayerSchool.html#m32">scenario_id</a> == <a class="code" href="Opschool_8h.html#a63a30">SCN_FACULTY_DIVERSITY</a> ) {
00753         <span class="keywordtype">int</span> totalFacCount = department_array.faculty_gender_history[<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>][THIS_YEAR];
00754         <a class="code" href="classPlayerSchool.html#m36">scenario_base1</a> = ( department_array.faculty_gender_history[<a class="code" href="Gamedef_8h.html#a75a29">MINORITY_MALE</a>][THIS_YEAR] + department_array.faculty_gender_history[<a class="code" href="Gamedef_8h.html#a75a30">MINORITY_FEMALE</a>][THIS_YEAR]) * 100 / totalFacCount;
00755         <a class="code" href="classPlayerSchool.html#m37">scenario_base2</a> = ( department_array.faculty_gender_history[<a class="code" href="Gamedef_8h.html#a75a30">MINORITY_FEMALE</a>][THIS_YEAR] + department_array.faculty_gender_history[<a class="code" href="Gamedef_8h.html#a75a28">NONMINORITY_FEMALE</a>][THIS_YEAR]) * 100 / totalFacCount;
00756 
00757         <span class="keywordtype">float</span> goalPerecent1 = goal_config.goal_scen(<a class="code" href="Opschool_8h.html#a63a30">SCN_FACULTY_DIVERSITY</a>)-&gt;goal_value[0];
00758         <span class="keywordtype">float</span> goalPerecent2 = goal_config.goal_scen(<a class="code" href="Opschool_8h.html#a63a30">SCN_FACULTY_DIVERSITY</a>)-&gt;goal_value[1];
00759 
00760         <span class="comment">// should be 1.5 in design doc</span>
00761         <a class="code" href="classPlayerSchool.html#m35">scenario_target</a>[0] = int(( department_array.faculty_gender_history[<a class="code" href="Gamedef_8h.html#a75a29">MINORITY_MALE</a>][THIS_YEAR] + department_array.faculty_gender_history[<a class="code" href="Gamedef_8h.html#a75a30">MINORITY_FEMALE</a>][THIS_YEAR]) * 100 * goalPerecent1 / totalFacCount );
00762         <a class="code" href="classPlayerSchool.html#m35">scenario_target</a>[1] = int(( department_array.faculty_gender_history[<a class="code" href="Gamedef_8h.html#a75a30">MINORITY_FEMALE</a>][THIS_YEAR] + department_array.faculty_gender_history[<a class="code" href="Gamedef_8h.html#a75a28">NONMINORITY_FEMALE</a>][THIS_YEAR]) * 100 * goalPerecent2 / totalFacCount);
00763 
00764         <a class="code" href="classPlayerSchool.html#m35">scenario_target</a>[0] = min(100, <a class="code" href="classPlayerSchool.html#m35">scenario_target</a>[0] );
00765         <a class="code" href="classPlayerSchool.html#m35">scenario_target</a>[1] = min(100, <a class="code" href="classPlayerSchool.html#m35">scenario_target</a>[1] );
00766         <a class="code" href="classPlayerSchool.html#m35">scenario_target</a>[2] = min(100, <a class="code" href="classPlayerSchool.html#m35">scenario_target</a>[2] );
00767     }
00768 
00769     <span class="comment">//---------- set scenario_max_game_years and goal year limit ----------//</span>
00770 
00771     <a class="code" href="classPlayerSchool.html#m42">scenario_max_game_years</a> = 0;
00772 
00773     <span class="keywordflow">for</span>( i=0 ; i&lt;3 ; i++ ) {
00774         <a class="code" href="classPlayerSchool.html#m47">goal_deadline</a>[i] = (char) goal_config.goal_scen(<a class="code" href="classPlayerSchool.html#m32">scenario_id</a>)-&gt;goal_year[i];
00775 
00776         <span class="keywordflow">if</span>( <a class="code" href="classPlayerSchool.html#m47">goal_deadline</a>[i] &gt; <a class="code" href="classPlayerSchool.html#m42">scenario_max_game_years</a> )
00777             <a class="code" href="classPlayerSchool.html#m42">scenario_max_game_years</a> = <a class="code" href="classPlayerSchool.html#m47">goal_deadline</a>[i];
00778     }
00779 }
00780 
00781 <span class="comment">//---------- End of function PlayerSchool::init_scenario ---------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:16 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
