<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Ofacures.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Ofacures.cpp</h1><a href="Ofacures_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OFACURES.CPP</span>
00002 <span class="comment">//Description : Faculty Resource object</span>
00003 
00004 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00005 <span class="preprocessor">#include &lt;<a class="code" href="OGAMESET_8H.html">OGAMESET.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;OFACURES.H&gt;</span>
00007 
00008 <span class="comment">//---------- #define constant ------------//</span>
00009 
<a name="l00010"></a><a class="code" href="Ofacures_8cpp.html#a0">00010</a> <span class="preprocessor">#define FACULTY_TEMPLATE_DB   "FAC_TMPL"</span>
00011 <span class="preprocessor"></span>
00012 <span class="comment">//------- Begin of function FacultyRes::FacultyRes -----------//</span>
00013 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00014 <span class="preprocessor"></span><span class="keyword">enum</span> {
00015     <a class="code" href="Ofacures_8cpp.html#a13a1">REPORT_TYPE_DEPARTMENT_PROFILE1</a>,
00016     <a class="code" href="Ofacures_8cpp.html#a13a2">REPORT_TYPE_DEPARTMENT_PROFILE2</a>,
00017     <a class="code" href="Ofacures_8cpp.html#a13a3">REPORT_TYPE_DEPARTMENT_ACTIVITIES</a>,
00018     <a class="code" href="Ofacures_8cpp.html#a13a4">REPORT_TYPE_DEPARTMENT_RESEARCH</a>,
00019     <a class="code" href="Ofacures_8cpp.html#a13a6">REPORT_TYPE_DEPARTMENT_HIRING</a>,
00020     <a class="code" href="Ofacures_8cpp.html#a13a5">REPORT_TYPE_DEPARTMENT_DIRECTORY</a>,
00021     REPORT_TYPE_DEPARTMENT_TURNOVER,
00022     <a class="code" href="Ofacures_8cpp.html#a13a7">REPORT_TYPE_INSTITUTION_PROFILE1</a>,
00023     <a class="code" href="Ofacures_8cpp.html#a13a8">REPORT_TYPE_INSTITUTION_PROFILE2</a>,
00024     <a class="code" href="Ofacures_8cpp.html#a13a9">REPORT_TYPE_INSTITUTION_ACTIVITIES</a>,
00025     <a class="code" href="Ofacures_8cpp.html#a13a10">REPORT_TYPE_INSTITUTION_RESEARCH</a>,
00026     <a class="code" href="Ofacures_8cpp.html#a13a11">REPORT_TYPE_INSTITUTION_SALARY</a>,
00027     <a class="code" href="Ofacures_8cpp.html#a13a12">REPORT_TYPE_INSTITUTION_PROMOTION</a>,
00028     REPORT_TYPE_INSTITUTION_TURNOVER,
00029 };
00030 <span class="preprocessor">#else</span>
00031 <span class="preprocessor"></span><span class="keyword">enum</span> {
00032     <a class="code" href="Ofacures_8cpp.html#a13a1">REPORT_TYPE_DEPARTMENT_PROFILE1</a>,
00033     <a class="code" href="Ofacures_8cpp.html#a13a2">REPORT_TYPE_DEPARTMENT_PROFILE2</a>,
00034     <a class="code" href="Ofacures_8cpp.html#a13a3">REPORT_TYPE_DEPARTMENT_ACTIVITIES</a>,
00035     <a class="code" href="Ofacures_8cpp.html#a13a4">REPORT_TYPE_DEPARTMENT_RESEARCH</a>,
00036     <a class="code" href="Ofacures_8cpp.html#a13a5">REPORT_TYPE_DEPARTMENT_DIRECTORY</a>,
00037     <a class="code" href="Ofacures_8cpp.html#a13a6">REPORT_TYPE_DEPARTMENT_HIRING</a>,
00038     <a class="code" href="Ofacures_8cpp.html#a13a7">REPORT_TYPE_INSTITUTION_PROFILE1</a>,
00039     <a class="code" href="Ofacures_8cpp.html#a13a8">REPORT_TYPE_INSTITUTION_PROFILE2</a>,
00040     <a class="code" href="Ofacures_8cpp.html#a13a9">REPORT_TYPE_INSTITUTION_ACTIVITIES</a>,
00041     <a class="code" href="Ofacures_8cpp.html#a13a10">REPORT_TYPE_INSTITUTION_RESEARCH</a>,
00042     <a class="code" href="Ofacures_8cpp.html#a13a11">REPORT_TYPE_INSTITUTION_SALARY</a>,
00043     <a class="code" href="Ofacures_8cpp.html#a13a12">REPORT_TYPE_INSTITUTION_PROMOTION</a>,
00044 };
00045 <span class="preprocessor">#endif</span>
00046 <span class="preprocessor"></span>
<a name="l00047"></a><a class="code" href="classFacultyRes.html#a0">00047</a> <a class="code" href="classFacultyRes.html#a0">FacultyRes::FacultyRes</a>() {
00048     memset( <span class="keyword">this</span>, 0, <span class="keyword">sizeof</span>(<a class="code" href="classFacultyRes.html">FacultyRes</a>) );
00049 }
00050 
00051 <span class="comment">//--------- End of function FacultyRes::FacultyRes -----------//</span>
00052 
00053 <span class="comment">//---------- Begin of function FacultyRes::init -----------//</span>
<a name="l00057"></a><a class="code" href="classFacultyRes.html#a1">00057</a> <span class="comment">void FacultyRes::init() {</span>
00058     deinit();
00059 
00060     <span class="comment">//------- load database information --------//</span>
00061 
00062     memset( <span class="keyword">this</span>, 0, <span class="keyword">sizeof</span>(<a class="code" href="classFacultyRes.html">FacultyRes</a>) );
00063 
00064     load_template();
00065 
00066     init_flag=1;
00067     current_report_type=<a class="code" href="Ofacures_8cpp.html#a13a7">REPORT_TYPE_INSTITUTION_PROFILE1</a>;
00068 }
00069 
00070 <span class="comment">//---------- End of function FacultyRes::init -----------//</span>
00071 
00072 <span class="comment">//---------- Begin of function FacultyRes::deinit -----------//</span>
00073 
<a name="l00074"></a><a class="code" href="classFacultyRes.html#a2">00074</a> <span class="keywordtype">void</span> <a class="code" href="classFacultyRes.html#a2">FacultyRes::deinit</a>() {
00075     <span class="keywordflow">if</span>( init_flag ) {
00076         <span class="keywordflow">if</span>( <a class="code" href="classFacultyRes.html#m6">faculty_template_count</a> &gt; 0 )
00077             free_template();
00078 
00079         <span class="comment">// ##### begin Gilbert 20/04/2001 #####///</span>
00080         <a class="code" href="classFacultyRes.html#a17">summary_report_deinit</a>();                      <span class="comment">// free memory allocated by faculty report</span>
00081         <span class="comment">// ##### end Gilbert 20/04/2001 #####///</span>
00082         <a class="code" href="classFacultyRes.html#m0">init_flag</a>=0;
00083     }
00084 }
00085 
00086 <span class="comment">//---------- End of function FacultyRes::deinit -----------//</span>
00087 
00088 <span class="comment">//------- Begin of function FacultyRes::load_template -------//</span>
00090 <span class="comment">void FacultyRes::load_template() {</span>
00091     <a class="code" href="ALL_8H.html#a0">err_when</a>( faculty_template_count != 0 );
00092 
00093     <a class="code" href="structFacultyTemplateRec.html">FacultyTemplateRec</a>    *templateRec;
00094     <a class="code" href="structFacultyTemplate.html">FacultyTemplate</a>       *templatePtr;
00095     <a class="code" href="classDatabase.html">Database</a>        *dbTemplate = game_set.open_db(<a class="code" href="Ofacures_8cpp.html#a0">FACULTY_TEMPLATE_DB</a>);
00096 
00097     faculty_template_count = (short) dbTemplate-&gt;<a class="code" href="classDatabase.html#a7">rec_count</a>();
00098 
00099     <a class="code" href="ALL_8H.html#a0">err_when</a>( faculty_template_array );             <span class="comment">// to prevent double allocations</span>
00100 
00101     faculty_template_array = (<a class="code" href="structFacultyTemplate.html">FacultyTemplate</a>*) <a class="code" href="ALL_8H.html#a5">mem_add</a>( <span class="keyword">sizeof</span>(<a class="code" href="structFacultyTemplate.html">FacultyTemplate</a>)*faculty_template_count );
00102 
00103     <span class="comment">//------ read in faculty information array -------//</span>
00104 
00105     memset( faculty_template_array, 0, <span class="keyword">sizeof</span>(<a class="code" href="structFacultyTemplate.html">FacultyTemplate</a>) * faculty_template_count );
00106 
00107     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;faculty_template_count ; i++ ) {
00108         templateRec  = (<a class="code" href="structFacultyTemplateRec.html">FacultyTemplateRec</a>*) dbTemplate-&gt;<a class="code" href="classDatabase.html#a4">read</a>(i+1);
00109         templatePtr = faculty_template_array+i;
00110 
00111         <span class="comment">//##### fred 0730 #####//</span>
00112 
00113         templatePtr-&gt;<a class="code" href="structFacultyTemplate.html#m0">template_code</a> = templateRec-&gt;<a class="code" href="structFacultyTemplateRec.html#m0">template_code</a>[0];
00114 
00115         <a class="code" href="ALL_8H.html#a0">err_when</a>( templatePtr-&gt;<a class="code" href="structFacultyTemplate.html#m0">template_code</a> &lt; <a class="code" href="Ofacures_8h.html#a4">FIRST_TEMPLATE_CODE</a> || templatePtr-&gt;<a class="code" href="structFacultyTemplate.html#m0">template_code</a> &gt; <span class="charliteral">'E'</span> );
00116 
00117         templatePtr-&gt;<a class="code" href="structFacultyTemplate.html#m1">rank_age_group_id</a> = (char) (m.atoi( templateRec-&gt;<a class="code" href="structFacultyTemplateRec.html#m1">rank_age_group_id</a>, 9 ) - 1);
00118 
00119         <a class="code" href="ALL_8H.html#a0">err_when</a>( templatePtr-&gt;<a class="code" href="structFacultyTemplate.html#m1">rank_age_group_id</a> &gt; <a class="code" href="Ofacures_8h.html#a3">LAST_RANK_AGE_GROUP</a> || templatePtr-&gt;<a class="code" href="structFacultyTemplate.html#m1">rank_age_group_id</a> &lt; <a class="code" href="Ofacures_8h.html#a2">FIRST_RANK_AGE_GROUP</a> );
00120 
00121         <span class="comment">//----- multipliers -----//</span>
00122         templatePtr-&gt;<a class="code" href="structFacultyTemplate.html#m2">rank_age_multiplier</a> = (float) m.atof(templateRec-&gt;<a class="code" href="structFacultyTemplateRec.html#m2">rank_age_multiplier</a>, 9);
00123         templatePtr-&gt;<a class="code" href="structFacultyTemplate.html#m3">female_multiplier</a>= (float) m.atof(templateRec-&gt;<a class="code" href="structFacultyTemplateRec.html#m3">female_multiplier</a>, 9);
00124         templatePtr-&gt;<a class="code" href="structFacultyTemplate.html#m4">minority_multiplier</a>= (float) m.atof(templateRec-&gt;<a class="code" href="structFacultyTemplateRec.html#m4">minority_multiplier</a>, 9);
00125 
00126         templatePtr-&gt;<a class="code" href="structFacultyTemplate.html#m5">overall_salary_multiplier</a> = (float) m.atof(templateRec-&gt;<a class="code" href="structFacultyTemplateRec.html#m5">overall_salary_multiplier</a>, 9);
00127         templatePtr-&gt;<a class="code" href="structFacultyTemplate.html#m6">female_salary_multiplier</a> = (float) m.atof(templateRec-&gt;<a class="code" href="structFacultyTemplateRec.html#m6">female_salary_multiplier</a>, 9);
00128         templatePtr-&gt;<a class="code" href="structFacultyTemplate.html#m7">minority_salary_multiplier</a> = (float) m.atof(templateRec-&gt;<a class="code" href="structFacultyTemplateRec.html#m7">minority_salary_multiplier</a>, 9);
00129 
00130         templatePtr-&gt;<a class="code" href="structFacultyTemplate.html#m8">talent_teaching_multiplier</a> = (float) m.atof(templateRec-&gt;<a class="code" href="structFacultyTemplateRec.html#m8">talent_teaching_multiplier</a>, 9);
00131         templatePtr-&gt;<a class="code" href="structFacultyTemplate.html#m9">talent_scholarship_multiplier</a> = (float) m.atof(templateRec-&gt;<a class="code" href="structFacultyTemplateRec.html#m9">talent_scholarship_multiplier</a>, 9);
00132         templatePtr-&gt;<a class="code" href="structFacultyTemplate.html#m10">talent_research_multiplier</a> = (float) m.atof(templateRec-&gt;<a class="code" href="structFacultyTemplateRec.html#m10">talent_research_multiplier</a>, 9);
00133 
00134         templatePtr-&gt;<a class="code" href="structFacultyTemplate.html#m11">normal_teaching_load_multiplier</a> = (float) m.atof(templateRec-&gt;<a class="code" href="structFacultyTemplateRec.html#m11">normal_teaching_load_multiplier</a>, 9);
00135 
00136         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> j=0 ; j&lt;<a class="code" href="Ofaculty_8h.html#a28a14">DISCRETIONARY_TYPE_COUNT</a> ; j++ ) {
00137             templatePtr-&gt;<a class="code" href="structFacultyTemplate.html#m12">discretionary_time_pref</a>[j] = (char) (int) (m.atof(templateRec-&gt;<a class="code" href="structFacultyTemplateRec.html#m12">discretionary_time_pref</a>[j], 9) * 100);
00138 
00139             <a class="code" href="ALL_8H.html#a0">err_when</a>(templatePtr-&gt;<a class="code" href="structFacultyTemplate.html#m12">discretionary_time_pref</a>[j] &lt; 0);
00140         }
00141     }
00142 }
00143 
00144 <span class="comment">//--------- End of function FacultyRes::load_template ---------//</span>
00145 
00146 <span class="comment">//------- Begin of function FacultyRes::free_template -------//</span>
00148 <span class="comment">void FacultyRes::free_template() {</span>
00149     <a class="code" href="ALL_8H.html#a0">err_when</a>( faculty_template_count == 0 );
00150 
00151     <a class="code" href="ALL_8H.html#a8">mem_del</a>(faculty_template_array);
00152     faculty_template_count = 0;
00153 }
00154 
00155 <span class="comment">//--------- End of function FacultyRes::free_template ---------//</span>
00156 
00157 <span class="comment">//------- Begin of function FacultyRes::get_faculty_template -------//</span>
<a name="l00167"></a><a class="code" href="classFacultyRes.html#a18">00167</a> <span class="comment">FacultyTemplate* FacultyRes::get_faculty_template(char* templateCode, int rankAgeGroup) {</span>
00168 <span class="preprocessor">#ifdef READ_OLD_DB</span>
00169 <span class="preprocessor"></span>    <span class="keyword">static</span> <a class="code" href="structFacultyTemplate.html">FacultyTemplate</a> resultTemplate;
00170 
00171     <span class="comment">//--- when two templates are given, the result is a combination of the two ----//</span>
00172 
00173     <span class="keywordflow">if</span>( templateCode[1] &gt;= <a class="code" href="Ofacures_8h.html#a4">FIRST_TEMPLATE_CODE</a> &amp;&amp;
00174         templateCode[1] &lt; <a class="code" href="Ofacures_8h.html#a4">FIRST_TEMPLATE_CODE</a> + <a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a> ) {
00175         <a class="code" href="structFacultyTemplate.html">FacultyTemplate</a>* facultyTemplate1 = faculty_template_array +
00176             (templateCode[0] - <a class="code" href="Ofacures_8h.html#a4">FIRST_TEMPLATE_CODE</a>) * <a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a> + rankAgeGroup;
00177 
00178         <a class="code" href="structFacultyTemplate.html">FacultyTemplate</a>* facultyTemplate2 = faculty_template_array +
00179             (templateCode[1] - <a class="code" href="Ofacures_8h.html#a4">FIRST_TEMPLATE_CODE</a>) * <a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a> + rankAgeGroup;
00180 
00181         <span class="comment">//------------------------------------------//</span>
00182 
00183         <span class="keywordtype">float</span> r = (float) m.random(100) / (float) 100;
00184 
00185         resultTemplate.<a class="code" href="structFacultyTemplate.html#m2">rank_age_multiplier</a> = (char) ( float(facultyTemplate1-&gt;<a class="code" href="structFacultyTemplate.html#m2">rank_age_multiplier</a>) * r / (float)1
00186                                                       + float(facultyTemplate2-&gt;<a class="code" href="structFacultyTemplate.html#m2">rank_age_multiplier</a>) * ((float)1-r) / (float)1 );
00187 
00188         resultTemplate.<a class="code" href="structFacultyTemplate.html#m3">female_multiplier</a> = facultyTemplate1-&gt;<a class="code" href="structFacultyTemplate.html#m3">female_multiplier</a> * r / (float)1
00189             + facultyTemplate2-&gt;<a class="code" href="structFacultyTemplate.html#m3">female_multiplier</a> * ((float)1-r) / (float)1;
00190 
00191         resultTemplate.<a class="code" href="structFacultyTemplate.html#m4">minority_multiplier</a> = facultyTemplate1-&gt;<a class="code" href="structFacultyTemplate.html#m4">minority_multiplier</a> * r / (float)1
00192             + facultyTemplate2-&gt;<a class="code" href="structFacultyTemplate.html#m4">minority_multiplier</a> * ((float)1-r) / (float)1;
00193 
00194         resultTemplate.<a class="code" href="structFacultyTemplate.html#m5">overall_salary_multiplier</a> = facultyTemplate1-&gt;<a class="code" href="structFacultyTemplate.html#m5">overall_salary_multiplier</a> * r / (float)1
00195             + facultyTemplate2-&gt;<a class="code" href="structFacultyTemplate.html#m5">overall_salary_multiplier</a> * ((float)1-r) / (float)1;
00196 
00197         resultTemplate.<a class="code" href="structFacultyTemplate.html#m6">female_salary_multiplier</a> = facultyTemplate1-&gt;<a class="code" href="structFacultyTemplate.html#m6">female_salary_multiplier</a> * r / (float)1
00198             + facultyTemplate2-&gt;<a class="code" href="structFacultyTemplate.html#m6">female_salary_multiplier</a> * ((float)1-r) / (float)1;
00199 
00200         resultTemplate.<a class="code" href="structFacultyTemplate.html#m7">minority_salary_multiplier</a> = facultyTemplate1-&gt;<a class="code" href="structFacultyTemplate.html#m7">minority_salary_multiplier</a> * r / (float)1
00201             + facultyTemplate2-&gt;<a class="code" href="structFacultyTemplate.html#m7">minority_salary_multiplier</a> * ((float)1-r) / (float)1;
00202 
00203         resultTemplate.<a class="code" href="structFacultyTemplate.html#m8">talent_teaching_multiplier</a> = facultyTemplate1-&gt;<a class="code" href="structFacultyTemplate.html#m8">talent_teaching_multiplier</a> * r / (float)1
00204             + facultyTemplate2-&gt;<a class="code" href="structFacultyTemplate.html#m8">talent_teaching_multiplier</a> * ((float)1-r) / (float)1;
00205 
00206         resultTemplate.<a class="code" href="structFacultyTemplate.html#m9">talent_scholarship_multiplier</a> = facultyTemplate1-&gt;<a class="code" href="structFacultyTemplate.html#m9">talent_scholarship_multiplier</a> * r / (float)1
00207             + facultyTemplate2-&gt;<a class="code" href="structFacultyTemplate.html#m9">talent_scholarship_multiplier</a> * ((float)1-r) / (float)1;
00208 
00209         resultTemplate.<a class="code" href="structFacultyTemplate.html#m10">talent_research_multiplier</a> = facultyTemplate1-&gt;<a class="code" href="structFacultyTemplate.html#m10">talent_research_multiplier</a> * r / (float)1
00210             + facultyTemplate2-&gt;<a class="code" href="structFacultyTemplate.html#m10">talent_research_multiplier</a> * ((float)1-r) / (float)1;
00211 
00212         resultTemplate.<a class="code" href="structFacultyTemplate.html#m11">normal_teaching_load_multiplier</a>= facultyTemplate1-&gt;<a class="code" href="structFacultyTemplate.html#m11">normal_teaching_load_multiplier</a>* r / (float)1
00213             + facultyTemplate2-&gt;normal_teaching_load * ((float)1-r) / (float)1;
00214 
00215         <span class="comment">//-------------- discretionary time ---------------//</span>
00216 
00217         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;<a class="code" href="Ofaculty_8h.html#a28a14">DISCRETIONARY_TYPE_COUNT</a> ; i++ ) {
00218             resultTemplate.<a class="code" href="structFacultyTemplate.html#m12">discretionary_time_pref</a>[i] =
00219                 char( (<span class="keywordtype">float</span>)facultyTemplate1-&gt;<a class="code" href="structFacultyTemplate.html#m12">discretionary_time_pref</a>[i] * r / (<span class="keywordtype">float</span>)1
00220                       + (<span class="keywordtype">float</span>)facultyTemplate2-&gt;<a class="code" href="structFacultyTemplate.html#m12">discretionary_time_pref</a>[i] * ((<span class="keywordtype">float</span>)1-r) / (<span class="keywordtype">float</span>)1 );
00221         }
00222 
00223         <span class="keywordflow">return</span> &amp;resultTemplate;
00224     }
00225     <span class="keywordflow">else</span>                                            <span class="comment">// there is just one template requested, return it now.</span>
00226 <span class="preprocessor">#endif</span>
00227 <span class="preprocessor"></span>
00228         <span class="keywordtype">int</span> offset = templateCode[0] - <a class="code" href="Ofacures_8h.html#a4">FIRST_TEMPLATE_CODE</a>;
00229     <a class="code" href="ALL_8H.html#a0">err_when</a>( offset &lt; 0 || offset &gt;= faculty_template_count );
00230     <a class="code" href="ALL_8H.html#a0">err_when</a>( rankAgeGroup &lt; 0 || rankAgeGroup &gt;= <a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a> );
00231 
00232     <span class="keywordflow">return</span> faculty_template_array + offset * <a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a> + rankAgeGroup;
00233 }
00234 
00235 <span class="comment">//--------- End of function FacultyRes::get_faculty_template ---------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:33 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
