<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OBLOB2W.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>OBLOB2W.CPP</h1><a href="OBLOB2W_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">// Filename    : OBLOB2.CPP</span>
00002 <span class="comment">// Description : 2D binary block, four side extensible</span>
00003 
00004 <span class="preprocessor">#include &lt;<a class="code" href="OBLOB2W_8H.html">OBLOB2W.H</a>&gt;</span>
00005 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;<a class="code" href="COLCODE_8H.html">COLCODE.H</a>&gt;</span>
00007 <span class="preprocessor">#include &lt;<a class="code" href="IMGFUN_8H.html">IMGFUN.H</a>&gt;</span>
00008 
00009 <span class="comment">// ------- define constant -------//</span>
00010 
<a name="l00011"></a><a class="code" href="OBLOB2W_8CPP.html#a0">00011</a> <span class="preprocessor">#define BACKGROUND_COLOR transparent_code_w</span>
<a name="l00012"></a><a class="code" href="OBLOB2W_8CPP.html#a1">00012</a> <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_BLOB2DW_SIZE 0x2000</span>
<a name="l00013"></a><a class="code" href="OBLOB2W_8CPP.html#a2">00013</a> <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_BLOB2DW_INC 0x200</span>
00014 <span class="preprocessor"></span>
<a name="l00015"></a><a class="code" href="classBlob2DW.html#a0">00015</a> <a class="code" href="classBlob2DW.html#a0">Blob2DW::Blob2DW</a>() {
00016     <a class="code" href="classBlob2DW.html#m2">left_edge</a> = <a class="code" href="classBlob2DW.html#m3">top_edge</a> = <a class="code" href="classBlob2DW.html#m4">width</a> = <a class="code" href="classBlob2DW.html#m5">height</a> = 0;
00017     <a class="code" href="classBlob2DW.html#m1">alloc_size</a> = <a class="code" href="OBLOB2W_8CPP.html#a1">DEFAULT_BLOB2DW_SIZE</a>;
00018     <a class="code" href="classBlob2DW.html#m0">ptr</a> = (<a class="code" href="classBitmapW.html">BitmapW</a> *)<a class="code" href="ALL_8H.html#a5">mem_add</a>(<a class="code" href="classBlob2DW.html#m1">alloc_size</a>);
00019     <a class="code" href="classBlob2DW.html#m0">ptr</a>-&gt;<a class="code" href="classBitmapW.html#a0">init</a>(<a class="code" href="classBlob2DW.html#m4">width</a>, <a class="code" href="classBlob2DW.html#m5">height</a>);
00020 }
00021 
<a name="l00022"></a><a class="code" href="classBlob2DW.html#a1">00022</a> <a class="code" href="classBlob2DW.html#a0">Blob2DW::Blob2DW</a>( <a class="code" href="classBlob2DW.html">Blob2DW</a> &amp;b ) {
00023     <a class="code" href="classBlob2DW.html#m2">left_edge</a> = b.<a class="code" href="classBlob2DW.html#m2">left_edge</a>;
00024     <a class="code" href="classBlob2DW.html#m3">top_edge</a> = b.<a class="code" href="classBlob2DW.html#m3">top_edge</a>;
00025     <a class="code" href="classBlob2DW.html#m4">width</a> = b.<a class="code" href="classBlob2DW.html#m4">width</a>;
00026     <a class="code" href="classBlob2DW.html#m5">height</a> = b.<a class="code" href="classBlob2DW.html#m5">height</a>;
00027     <a class="code" href="classBlob2DW.html#m1">alloc_size</a> = b.<a class="code" href="classBlob2DW.html#m1">alloc_size</a>;
00028 
00029     <a class="code" href="ALL_8H.html#a0">err_when</a>( <a class="code" href="classBlob2DW.html#m4">width</a> &lt; 0 );
00030     <a class="code" href="ALL_8H.html#a0">err_when</a>( <a class="code" href="classBlob2DW.html#m5">height</a> &lt; 0 );
00031 
00032     <a class="code" href="classBlob2DW.html#m0">ptr</a> = (<a class="code" href="classBitmapW.html">BitmapW</a> *)<a class="code" href="ALL_8H.html#a5">mem_add</a>(<a class="code" href="classBlob2DW.html#m1">alloc_size</a>);
00033     memcpy(<a class="code" href="classBlob2DW.html#m0">ptr</a>, b.<a class="code" href="classBlob2DW.html#m0">ptr</a>, <a class="code" href="classBlob2DW.html#m1">alloc_size</a>);
00034     <span class="comment">// ((BitmapW *)ptr)-&gt;init(width, height);</span>
00035 }
00036 
<a name="l00037"></a><a class="code" href="classBlob2DW.html#a2">00037</a> <a class="code" href="classBlob2DW.html#a2">Blob2DW::~Blob2DW</a>() {
00038     <a class="code" href="ALL_8H.html#a8">mem_del</a>(<a class="code" href="classBlob2DW.html#m0">ptr</a>);
00039 }
00040 
<a name="l00041"></a><a class="code" href="classBlob2DW.html#a3">00041</a> <a class="code" href="classBlob2DW.html">Blob2DW</a>&amp; <a class="code" href="classBlob2DW.html#a3">Blob2DW::operator=</a>(<a class="code" href="classBlob2DW.html">Blob2DW</a> &amp;b) {
00042     <a class="code" href="classBlob2DW.html#m2">left_edge</a> = b.<a class="code" href="classBlob2DW.html#m2">left_edge</a>;
00043     <a class="code" href="classBlob2DW.html#m3">top_edge</a> = b.<a class="code" href="classBlob2DW.html#m3">top_edge</a>;
00044     <a class="code" href="classBlob2DW.html#m4">width</a> = b.<a class="code" href="classBlob2DW.html#m4">width</a>;
00045     <a class="code" href="classBlob2DW.html#m5">height</a> = b.<a class="code" href="classBlob2DW.html#m5">height</a>;
00046 
00047     <a class="code" href="ALL_8H.html#a0">err_when</a>( <a class="code" href="classBlob2DW.html#m4">width</a> &lt; 0 );
00048     <a class="code" href="ALL_8H.html#a0">err_when</a>( <a class="code" href="classBlob2DW.html#m5">height</a> &lt; 0 );
00049 
00050     size_t siz = <a class="code" href="classBitmapW.html#a7">BitmapW::size</a>(<a class="code" href="classBlob2DW.html#m4">width</a>,<a class="code" href="classBlob2DW.html#m5">height</a>);
00051     <span class="keywordflow">if</span>( <a class="code" href="classBlob2DW.html#m1">alloc_size</a> &lt; siz ) {
00052         <a class="code" href="ALL_8H.html#a8">mem_del</a>(<a class="code" href="classBlob2DW.html#m0">ptr</a>);
00053         <a class="code" href="classBlob2DW.html#m1">alloc_size</a> = b.<a class="code" href="classBlob2DW.html#m1">alloc_size</a>;
00054         <a class="code" href="classBlob2DW.html#m0">ptr</a> = (<a class="code" href="classBitmapW.html">BitmapW</a> *)<a class="code" href="ALL_8H.html#a5">mem_add</a>(<a class="code" href="classBlob2DW.html#m1">alloc_size</a>);
00055     }
00056     memcpy(<a class="code" href="classBlob2DW.html#m0">ptr</a>, b.<a class="code" href="classBlob2DW.html#m0">ptr</a>, siz);
00057 
00058     <span class="comment">// ((BitmapW *)ptr)-&gt;init(width, height);</span>
00059 
00060     <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00061 }
00062 
<a name="l00063"></a><a class="code" href="classBlob2DW.html#a4">00063</a> <span class="keywordtype">void</span> <a class="code" href="classBlob2DW.html#a4">Blob2DW::resize</a>(<span class="keywordtype">short</span> destLeft, <span class="keywordtype">short</span> destTop, <span class="keywordtype">short</span> destWidth, <span class="keywordtype">short</span> destHeight) {
00064     <span class="keywordflow">if</span>( <a class="code" href="classBlob2DW.html#m4">width</a> == 0 &amp;&amp; <a class="code" href="classBlob2DW.html#m5">height</a> == 0) {
00065         size_t siz = <a class="code" href="classBitmapW.html#a7">BitmapW::size</a>(destWidth,destHeight);
00066         <span class="keywordflow">if</span>( <a class="code" href="classBlob2DW.html#m1">alloc_size</a> &lt; siz ) {
00067             <a class="code" href="ALL_8H.html#a8">mem_del</a>(<a class="code" href="classBlob2DW.html#m0">ptr</a>);
00068             <a class="code" href="classBlob2DW.html#m0">ptr</a> = (<a class="code" href="classBitmapW.html">BitmapW</a> *)<a class="code" href="ALL_8H.html#a5">mem_add</a>((<a class="code" href="classBlob2DW.html#m1">alloc_size</a> = siz + <a class="code" href="OBLOB2W_8CPP.html#a2">DEFAULT_BLOB2DW_INC</a>));
00069         }
00070         <a class="code" href="classBlob2DW.html#m0">ptr</a>-&gt;<a class="code" href="classBitmapW.html#a0">init</a>(destWidth, destHeight);
00071         <a class="code" href="IMGFUN_8H.html#a6">IMGbar</a>(<a class="code" href="classBlob2DW.html#m0">ptr</a>-&gt;<a class="code" href="classBitmapW.html#a5">get_ptr</a>(), <a class="code" href="classBlob2DW.html#m0">ptr</a>-&gt;<a class="code" href="classBitmapW.html#a4">get_true_pitch</a>(), 0, 0, destWidth-1, destHeight-1, <a class="code" href="OBLOB2W_8CPP.html#a0">BACKGROUND_COLOR</a>);
00072     }
00073     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( destWidth == 0 &amp;&amp; destHeight == 0 ) {
00074         <a class="code" href="ALL_8H.html#a0">err_when</a>(!<a class="code" href="classBlob2DW.html#m0">ptr</a>);
00075         <a class="code" href="classBlob2DW.html#m0">ptr</a>-&gt;<a class="code" href="classBitmapW.html#a0">init</a>(destWidth, destHeight);
00076     }
00077     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classBlob2DW.html#m2">left_edge</a> == destLeft &amp;&amp; <a class="code" href="classBlob2DW.html#m3">top_edge</a> == destTop &amp;&amp; <a class="code" href="classBlob2DW.html#m4">width</a> == destWidth ) {
00078         <span class="keywordflow">if</span>( destHeight == <a class="code" href="classBlob2DW.html#m5">height</a> )
00079             <span class="keywordflow">return</span>;                                     <span class="comment">// unchange</span>
00080 
00081         size_t siz = <a class="code" href="classBitmapW.html#a7">BitmapW::size</a>(destWidth,destHeight);
00082         <span class="keywordflow">if</span>( <a class="code" href="classBlob2DW.html#m1">alloc_size</a> &lt; siz ) {
00083             <a class="code" href="classBlob2DW.html#m0">ptr</a> = (<a class="code" href="classBitmapW.html">BitmapW</a> *)<a class="code" href="ALL_8H.html#a7">mem_resize</a>(<a class="code" href="classBlob2DW.html#m0">ptr</a>, (<a class="code" href="classBlob2DW.html#m1">alloc_size</a> = siz + <a class="code" href="OBLOB2W_8CPP.html#a2">DEFAULT_BLOB2DW_INC</a>));
00084         }
00085 
00086         <span class="keywordflow">if</span>( destHeight &gt; <a class="code" href="classBlob2DW.html#m5">height</a> &amp;&amp; destWidth &gt; 0 ) {
00087             <span class="keywordtype">int</span> y2 = <a class="code" href="classBlob2DW.html#m3">top_edge</a>+<a class="code" href="classBlob2DW.html#m5">height</a>;                   <span class="comment">// must keep the old instant</span>
00088             <a class="code" href="classBlob2DW.html#m5">height</a> = destHeight;                        <span class="comment">// as height must be change to make fill_area correct</span>
00089 
00090             <span class="comment">// extend, then fill the new with the background color</span>
00091             <a class="code" href="classBlob2DW.html#a12">fill_area</a>(destLeft, <a class="code" href="classBlob2DW.html#m3">top_edge</a>+<a class="code" href="classBlob2DW.html#m5">height</a>, destLeft+destWidth-1, destTop+destHeight-1, <a class="code" href="OBLOB2W_8CPP.html#a0">BACKGROUND_COLOR</a>, 0);
00092         }
00093     }
00094     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classBlob2DW.html#m2">left_edge</a> &lt;= destLeft &amp;&amp; <a class="code" href="classBlob2DW.html#m3">top_edge</a> &lt;= destTop &amp;&amp;
00095              <a class="code" href="classBlob2DW.html#m2">left_edge</a>+<a class="code" href="classBlob2DW.html#m4">width</a> &gt;= destLeft+destWidth &amp;&amp; <a class="code" href="classBlob2DW.html#m3">top_edge</a>+<a class="code" href="classBlob2DW.html#m5">height</a> &gt;= destTop+destHeight) {
00096         <span class="comment">// clipping</span>
00097         <span class="keywordtype">short</span> *src = <a class="code" href="classBlob2DW.html#m0">ptr</a>-&gt;<a class="code" href="classBitmapW.html#a5">get_ptr</a>(destLeft-<a class="code" href="classBlob2DW.html#m2">left_edge</a>, destTop-<a class="code" href="classBlob2DW.html#m3">top_edge</a>);
00098         <span class="keywordtype">int</span> srcPitch = <a class="code" href="classBlob2DW.html#m0">ptr</a>-&gt;<a class="code" href="classBitmapW.html#a3">get_pitch</a>();
00099         <a class="code" href="classBlob2DW.html#m0">ptr</a>-&gt;<a class="code" href="classBitmapW.html#a0">init</a>(destWidth, destHeight);
00100         <span class="keywordtype">short</span> *dest = <a class="code" href="classBlob2DW.html#m0">ptr</a>-&gt;<a class="code" href="classBitmapW.html#a5">get_ptr</a>();
00101         <span class="keywordtype">int</span> destPitch = <a class="code" href="classBlob2DW.html#m0">ptr</a>-&gt;<a class="code" href="classBitmapW.html#a3">get_pitch</a>();
00102 
00103         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> y = 0; y &lt; destHeight; ++y, src += srcPitch, dest += destPitch )
00104             memmove(dest, src, destWidth * <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>));
00105 
00106         <span class="comment">// ptr = (BitmapW *)mem_resize(ptr, ptr-&gt;size());</span>
00107     }
00108     <span class="keywordflow">else</span> {
00109         <span class="comment">// general resize, new another buffer</span>
00110         <span class="comment">// copy range, intersection of two area :</span>
00111         <span class="keywordtype">short</span> copyLeft, copyTop, copyWidth, copyHeight;
00112         copyLeft = max(destLeft, <a class="code" href="classBlob2DW.html#m2">left_edge</a>);
00113         copyTop = max(destTop, <a class="code" href="classBlob2DW.html#m3">top_edge</a>);
00114         copyWidth = min(destLeft + destWidth, <a class="code" href="classBlob2DW.html#m2">left_edge</a> + <a class="code" href="classBlob2DW.html#m4">width</a>) - copyLeft;
00115         copyHeight = min(destTop + destHeight, <a class="code" href="classBlob2DW.html#m3">top_edge</a> + <a class="code" href="classBlob2DW.html#m5">height</a>) - copyTop; {
00116 
00117             size_t siz = <a class="code" href="classBitmapW.html#a7">BitmapW::size</a>(destWidth, destHeight);
00118             <a class="code" href="classBitmapW.html">BitmapW</a> *newPtr = (<a class="code" href="classBitmapW.html">BitmapW</a> *)<a class="code" href="ALL_8H.html#a5">mem_add</a>(siz + <a class="code" href="OBLOB2W_8CPP.html#a2">DEFAULT_BLOB2DW_INC</a>);
00119             newPtr-&gt;<a class="code" href="classBitmapW.html#a0">init</a>(destWidth, destHeight);
00120             <a class="code" href="IMGFUN_8H.html#a6">IMGbar</a>(newPtr-&gt;<a class="code" href="classBitmapW.html#a5">get_ptr</a>(), newPtr-&gt;<a class="code" href="classBitmapW.html#a4">get_true_pitch</a>(), 0, 0, destWidth-1, destHeight-1, <a class="code" href="OBLOB2W_8CPP.html#a0">BACKGROUND_COLOR</a>);
00121 
00122             <span class="keywordflow">if</span>( copyWidth &gt; 0 &amp;&amp; copyHeight &gt; 0 ) {
00123                 <span class="keywordtype">int</span> yCount = 0;
00124                 <span class="keywordtype">short</span> *src = <a class="code" href="classBlob2DW.html#m0">ptr</a>-&gt;<a class="code" href="classBitmapW.html#a5">get_ptr</a>(copyLeft-<a class="code" href="classBlob2DW.html#m2">left_edge</a>, yCount+copyTop-<a class="code" href="classBlob2DW.html#m3">top_edge</a> );
00125                 <span class="keywordtype">short</span> *dest = newPtr-&gt;<a class="code" href="classBitmapW.html#a5">get_ptr</a>(copyLeft-destLeft, yCount+copyTop-destTop );
00126 
00127                 <span class="keywordflow">for</span>( ; yCount &lt; copyHeight; ++yCount, src += <a class="code" href="classBlob2DW.html#m0">ptr</a>-&gt;<a class="code" href="classBitmapW.html#a3">get_pitch</a>(), dest += <a class="code" href="classBlob2DW.html#m0">ptr</a>-&gt;<a class="code" href="classBitmapW.html#a3">get_pitch</a>() ) {
00128                     <span class="comment">// unsigned char *src = (yCount+copyTop-top_edge)*width + copyLeft-left_edge;</span>
00129                     <span class="comment">// unsigned char *dest = (yCount+copyTop-destTop)*destWdith + copyLeft-destLeft;</span>
00130                     memcpy(dest, src, copyWidth * <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>));
00131                 }
00132             }
00133 
00134             <span class="comment">// assign to the newPtr now</span>
00135             <a class="code" href="classBlob2DW.html#m2">left_edge</a> = destLeft;
00136             <a class="code" href="classBlob2DW.html#m3">top_edge</a> = destTop;
00137             <a class="code" href="classBlob2DW.html#m4">width</a> = destWidth;
00138             <a class="code" href="classBlob2DW.html#m5">height</a> = destHeight;
00139             <a class="code" href="ALL_8H.html#a8">mem_del</a>(<a class="code" href="classBlob2DW.html#m0">ptr</a>);
00140             <a class="code" href="classBlob2DW.html#m0">ptr</a> = newPtr;
00141         }
00142 
00143         <span class="comment">// fill rest area with background color</span>
00144         <span class="keywordflow">if</span>( top_edge &lt; copyTop &amp;&amp; width &gt; 0) {
00145             <a class="code" href="classBlob2DW.html#a12">fill_area</a>(<a class="code" href="classBlob2DW.html#m2">left_edge</a>, <a class="code" href="classBlob2DW.html#m3">top_edge</a>, <a class="code" href="classBlob2DW.html#m2">left_edge</a>+<a class="code" href="classBlob2DW.html#m4">width</a>-1, copyTop, <a class="code" href="OBLOB2W_8CPP.html#a0">BACKGROUND_COLOR</a>, 0 );
00146         }
00147 
00148         <span class="comment">// fill bottom</span>
00149         <span class="keywordflow">if</span>( <a class="code" href="classBlob2DW.html#m3">top_edge</a>+<a class="code" href="classBlob2DW.html#m5">height</a> &gt; copyTop+copyHeight &amp;&amp; <a class="code" href="classBlob2DW.html#m4">width</a> &gt; 0) {
00150             <a class="code" href="classBlob2DW.html#a12">fill_area</a>(<a class="code" href="classBlob2DW.html#m2">left_edge</a>, copyTop+copyHeight, <a class="code" href="classBlob2DW.html#m2">left_edge</a>+<a class="code" href="classBlob2DW.html#m4">width</a>-1, <a class="code" href="classBlob2DW.html#m3">top_edge</a>+<a class="code" href="classBlob2DW.html#m5">height</a>-1, <a class="code" href="OBLOB2W_8CPP.html#a0">BACKGROUND_COLOR</a>, 0 );
00151         }
00152 
00153         <span class="comment">// fill left</span>
00154         <span class="keywordflow">if</span>( left_edge &lt; copyLeft &amp;&amp; destHeight &gt; 0) {
00155             <a class="code" href="classBlob2DW.html#a12">fill_area</a>(<a class="code" href="classBlob2DW.html#m2">left_edge</a>, copyTop, copyLeft-1, copyTop+copyHeight-1,
00156                       <a class="code" href="OBLOB2W_8CPP.html#a0">BACKGROUND_COLOR</a>, 0);
00157         }
00158 
00159         <span class="comment">// fill right</span>
00160         <span class="keywordflow">if</span>( <a class="code" href="classBlob2DW.html#m2">left_edge</a>+<a class="code" href="classBlob2DW.html#m4">width</a> &gt; copyLeft+copyWidth &amp;&amp; destHeight &gt; 0 ) {
00161             <a class="code" href="classBlob2DW.html#a12">fill_area</a>(copyLeft+copyWidth, copyTop, <a class="code" href="classBlob2DW.html#m2">left_edge</a>+<a class="code" href="classBlob2DW.html#m4">width</a>, copyTop+copyHeight-1,
00162                       <a class="code" href="OBLOB2W_8CPP.html#a0">BACKGROUND_COLOR</a>, 0);
00163         }
00164     }
00165 
00166     <a class="code" href="classBlob2DW.html#m2">left_edge</a> = destLeft;
00167     <a class="code" href="classBlob2DW.html#m3">top_edge</a> = destTop;
00168     <a class="code" href="classBlob2DW.html#m4">width</a> = destWidth;
00169     <a class="code" href="classBlob2DW.html#m5">height</a> = destHeight;
00170 }
00171 
<a name="l00172"></a><a class="code" href="classBlob2DW.html#a5">00172</a> <span class="keywordtype">int</span> <a class="code" href="classBlob2DW.html#a5">Blob2DW::extend_to</a>(<span class="keywordtype">short</span> x, <span class="keywordtype">short</span> y) {
00173     <span class="keywordtype">int</span> resizeFlag = 0;
00174     <span class="keywordtype">short</span> newLeft = <a class="code" href="classBlob2DW.html#m2">left_edge</a>;
00175     <span class="keywordtype">short</span> newTop = <a class="code" href="classBlob2DW.html#m3">top_edge</a>;
00176     <span class="keywordtype">short</span> newWidth = <a class="code" href="classBlob2DW.html#m4">width</a>;
00177     <span class="keywordtype">short</span> newHeight = <a class="code" href="classBlob2DW.html#m5">height</a>;
00178 
00179     <span class="keywordflow">if</span>( x &lt; <a class="code" href="classBlob2DW.html#m2">left_edge</a> ) {
00180         newLeft = x;
00181         newWidth = <a class="code" href="classBlob2DW.html#m2">left_edge</a> + <a class="code" href="classBlob2DW.html#m4">width</a> - newLeft;
00182         resizeFlag = 1;
00183     }
00184     <span class="keywordflow">if</span>( x &gt;= <a class="code" href="classBlob2DW.html#m2">left_edge</a>+<a class="code" href="classBlob2DW.html#m4">width</a> ) {
00185         newWidth = x - newLeft + 1;
00186         resizeFlag = 1;
00187     }
00188     <span class="keywordflow">if</span>( y &lt; <a class="code" href="classBlob2DW.html#m3">top_edge</a> ) {
00189         newTop = y;
00190         newHeight = <a class="code" href="classBlob2DW.html#m3">top_edge</a> + <a class="code" href="classBlob2DW.html#m5">height</a> - newTop;
00191         resizeFlag = 1;
00192     }
00193     <span class="keywordflow">if</span>( y &gt;= <a class="code" href="classBlob2DW.html#m3">top_edge</a>+<a class="code" href="classBlob2DW.html#m5">height</a> ) {
00194         newHeight = y - newTop + 1;
00195         resizeFlag = 1;
00196     }
00197 
00198     <span class="keywordflow">if</span>( resizeFlag ) {
00199         <a class="code" href="classBlob2DW.html#a4">resize</a>( newLeft, newTop, newWidth, newHeight );
00200     }
00201 
00202     <span class="keywordflow">return</span> resizeFlag;
00203 }
00204 
<a name="l00205"></a><a class="code" href="classBlob2DW.html#a6">00205</a> <span class="keywordtype">int</span> <a class="code" href="classBlob2DW.html#a5">Blob2DW::extend_to</a>(<span class="keywordtype">short</span> x1, <span class="keywordtype">short</span> y1, <span class="keywordtype">short</span> x2, <span class="keywordtype">short</span> y2) {
00206     <span class="keywordtype">int</span> resizeFlag = 0;
00207     <span class="keywordtype">short</span> newLeft = <a class="code" href="classBlob2DW.html#m2">left_edge</a>;
00208     <span class="keywordtype">short</span> newTop = <a class="code" href="classBlob2DW.html#m3">top_edge</a>;
00209     <span class="keywordtype">short</span> newWidth = <a class="code" href="classBlob2DW.html#m4">width</a>;
00210     <span class="keywordtype">short</span> newHeight = <a class="code" href="classBlob2DW.html#m5">height</a>;
00211 
00212     <span class="keywordflow">if</span>( x1 &lt; <a class="code" href="classBlob2DW.html#m2">left_edge</a> ) {
00213         newLeft = x1;
00214         newWidth = <a class="code" href="classBlob2DW.html#m2">left_edge</a> + <a class="code" href="classBlob2DW.html#m4">width</a> - newLeft;
00215         resizeFlag = 1;
00216     }
00217     <span class="keywordflow">if</span>( x2 &gt;= <a class="code" href="classBlob2DW.html#m2">left_edge</a>+<a class="code" href="classBlob2DW.html#m4">width</a> ) {
00218         newWidth = x2 - newLeft + 1;
00219         resizeFlag = 1;
00220     }
00221     <span class="keywordflow">if</span>( y1 &lt; <a class="code" href="classBlob2DW.html#m3">top_edge</a> ) {
00222         newTop = y1;
00223         newHeight = <a class="code" href="classBlob2DW.html#m3">top_edge</a> + <a class="code" href="classBlob2DW.html#m5">height</a> - newTop;
00224         resizeFlag = 1;
00225     }
00226     <span class="keywordflow">if</span>( y2 &gt;= <a class="code" href="classBlob2DW.html#m3">top_edge</a>+<a class="code" href="classBlob2DW.html#m5">height</a> ) {
00227         newHeight = y2 - newTop + 1;
00228         resizeFlag = 1;
00229     }
00230 
00231     <span class="keywordflow">if</span>( resizeFlag ) {
00232         <a class="code" href="classBlob2DW.html#a4">resize</a>( newLeft, newTop, newWidth, newHeight );
00233     }
00234 
00235     <span class="keywordflow">return</span> resizeFlag;
00236 }
00237 
<a name="l00238"></a><a class="code" href="classBlob2DW.html#a11">00238</a> <span class="keywordtype">short</span> *<a class="code" href="classBlob2DW.html#a11">Blob2DW::p</a>(<span class="keywordtype">short</span> x, <span class="keywordtype">short</span> y, <span class="keywordtype">int</span> autoExtend) {
00239     <span class="keywordflow">if</span>( autoExtend ) {
00240         <a class="code" href="classBlob2DW.html#a5">extend_to</a>(x, y);
00241     }
00242     <span class="keywordflow">else</span> {
00243         <span class="keywordflow">if</span>( x &lt; left_edge || x &gt;= <a class="code" href="classBlob2DW.html#m2">left_edge</a>+<a class="code" href="classBlob2DW.html#m4">width</a>
00244             || y &lt; top_edge || y &gt;= <a class="code" href="classBlob2DW.html#m3">top_edge</a>+<a class="code" href="classBlob2DW.html#m5">height</a> )
00245             <span class="keywordflow">return</span> <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00246     }
00247 
00248     <span class="keywordflow">return</span> <a class="code" href="classBlob2DW.html#m0">ptr</a>-&gt;<a class="code" href="classBitmapW.html#a5">get_ptr</a>(x-<a class="code" href="classBlob2DW.html#m2">left_edge</a>, y-<a class="code" href="classBlob2DW.html#m3">top_edge</a>);
00249 }
00250 
<a name="l00251"></a><a class="code" href="classBlob2DW.html#a12">00251</a> <span class="keywordtype">void</span> <a class="code" href="classBlob2DW.html#a12">Blob2DW::fill_area</a>(<span class="keywordtype">short</span> x1, <span class="keywordtype">short</span> y1, <span class="keywordtype">short</span> x2, <span class="keywordtype">short</span> y2, <span class="keywordtype">short</span> color,
00252                         <span class="keywordtype">int</span> autoExtend) {
00253     <span class="keywordflow">if</span>( autoExtend ) {
00254         <a class="code" href="classBlob2DW.html#a5">extend_to</a>(x1, y1, x2, y2);
00255     }
00256     <span class="keywordflow">else</span> {
00257         <span class="comment">// adjust x1, y1, x2 ,y2</span>
00258         <span class="keywordflow">if</span>( x1 &lt; <a class="code" href="classBlob2DW.html#m2">left_edge</a> )
00259             x1 = <a class="code" href="classBlob2DW.html#m2">left_edge</a>;
00260         <span class="keywordflow">if</span>( x2 &gt;= <a class="code" href="classBlob2DW.html#m2">left_edge</a>+<a class="code" href="classBlob2DW.html#m4">width</a> )
00261             x2 = <a class="code" href="classBlob2DW.html#m2">left_edge</a>+<a class="code" href="classBlob2DW.html#m4">width</a>-1;
00262         <span class="keywordflow">if</span>( y1 &lt; <a class="code" href="classBlob2DW.html#m3">top_edge</a> )
00263             y1 = <a class="code" href="classBlob2DW.html#m3">top_edge</a>;
00264         <span class="keywordflow">if</span>( y2 &gt;= <a class="code" href="classBlob2DW.html#m3">top_edge</a>+<a class="code" href="classBlob2DW.html#m5">height</a> )
00265             y2 = <a class="code" href="classBlob2DW.html#m3">top_edge</a>+<a class="code" href="classBlob2DW.html#m5">height</a>-1;
00266 
00267         <span class="keywordflow">if</span>( x2 &lt; x1 || y2 &lt; y1 )
00268             <span class="keywordflow">return</span>;
00269     }
00270 
00271     <a class="code" href="IMGFUN_8H.html#a6">IMGbar</a>(<a class="code" href="classBlob2DW.html#m0">ptr</a>-&gt;<a class="code" href="classBitmapW.html#a5">get_ptr</a>(), <a class="code" href="classBlob2DW.html#m0">ptr</a>-&gt;<a class="code" href="classBitmapW.html#a4">get_true_pitch</a>(), x1 - <a class="code" href="classBlob2DW.html#m2">left_edge</a>, y1 - <a class="code" href="classBlob2DW.html#m3">top_edge</a>,
00272            x2 - <a class="code" href="classBlob2DW.html#m2">left_edge</a>, y2 - <a class="code" href="classBlob2DW.html#m3">top_edge</a>, color);
00273     <span class="comment">// int y = y1;</span>
00274     <span class="comment">//  short *dest = ptr-&gt;get_ptr( x1 - left_edge, y - top_edge );</span>
00275     <span class="comment">//  for( ; y &lt;= y2; ++y, dest += width )</span>
00276     <span class="comment">//          memset(dest, color, x2-x1+1);</span>
00277 }
00278 
<a name="l00279"></a><a class="code" href="classBlob2DW.html#a13">00279</a> <span class="keywordtype">void</span> <a class="code" href="classBlob2DW.html#a13">Blob2DW::auto_clip</a>( <span class="keywordtype">short</span> *pLeft, <span class="keywordtype">short</span> *pTop, <span class="keywordtype">short</span> *pWidth, <span class="keywordtype">short</span> *pHeight, <span class="keywordtype">int</span> autoResize) {
00280     <span class="keywordtype">short</span> x1, y1, x2, y2;
00281 
00282     y1 = 0;
00283     y2 = <a class="code" href="classBlob2DW.html#m5">height</a> - 1;
00284     x1 = 0;
00285     x2 = <a class="code" href="classBlob2DW.html#m4">width</a> - 1;
00286 
00287     <span class="keywordtype">int</span> pitch = <a class="code" href="classBlob2DW.html#m0">ptr</a>-&gt;<a class="code" href="classBitmapW.html#a3">get_pitch</a>();
00288 
00289     <span class="comment">// clip bottom</span>
00290     <span class="keywordflow">for</span>( ; y1 &lt;= y2; --y2) {
00291         <span class="keywordtype">int</span> x = x1;
00292         <span class="keywordtype">short</span> *src = <a class="code" href="classBlob2DW.html#m0">ptr</a>-&gt;<a class="code" href="classBitmapW.html#a5">get_ptr</a>(x, y2);
00293         <span class="keywordflow">for</span>( ; x &lt;= x2; ++x, ++src ) {
00294             <span class="keywordflow">if</span>( *src != <a class="code" href="OBLOB2W_8CPP.html#a0">BACKGROUND_COLOR</a> )
00295                 <span class="keywordflow">break</span>;                                    <span class="comment">// dirty</span>
00296         }
00297         <span class="keywordflow">if</span>( x &lt;= x2 )
00298             <span class="keywordflow">break</span>;                                      <span class="comment">// dirty</span>
00299     }                                               <span class="comment">// y2 is now the bottom margin</span>
00300 
00301     <span class="comment">// clip top</span>
00302     <span class="keywordflow">for</span>( ; y1 &lt;= y2; ++y1 ) {
00303         <span class="keywordtype">int</span> x = x1;
00304         <span class="keywordtype">short</span> *src = <a class="code" href="classBlob2DW.html#m0">ptr</a>-&gt;<a class="code" href="classBitmapW.html#a5">get_ptr</a>(x, y1);
00305         <span class="keywordflow">for</span>( ; x &lt;= x2; ++x, ++src ) {
00306             <span class="keywordflow">if</span>( *src != <a class="code" href="OBLOB2W_8CPP.html#a0">BACKGROUND_COLOR</a> )
00307                 <span class="keywordflow">break</span>;                                    <span class="comment">// dirty</span>
00308         }
00309         <span class="keywordflow">if</span>( x &lt;= x2 )
00310             <span class="keywordflow">break</span>;                                      <span class="comment">// dirty</span>
00311     }                                               <span class="comment">// y1 is now the top margin</span>
00312 
00313     <span class="comment">// clip right</span>
00314     <span class="keywordflow">for</span>( ; x1 &lt;= x2; --x2) {
00315         <span class="keywordtype">int</span> y = y1;
00316         <span class="keywordtype">short</span> *src = <a class="code" href="classBlob2DW.html#m0">ptr</a>-&gt;<a class="code" href="classBitmapW.html#a5">get_ptr</a>(x1, y);
00317         <span class="keywordflow">for</span>( ; y &lt;= y2; ++y, src+=pitch ) {
00318             <span class="keywordflow">if</span>( *src != <a class="code" href="OBLOB2W_8CPP.html#a0">BACKGROUND_COLOR</a> )
00319                 <span class="keywordflow">break</span>;                                    <span class="comment">// dirty</span>
00320         }
00321         <span class="keywordflow">if</span>( y &lt;= y2 )
00322             <span class="keywordflow">break</span>;                                      <span class="comment">// dirty</span>
00323     }                                               <span class="comment">// x2 is now the right margin</span>
00324 
00325     <span class="comment">// clip left</span>
00326     <span class="keywordflow">for</span>( ; x1 &lt;= x2; ++x1 ) {
00327         <span class="keywordtype">int</span> y = y1;
00328         <span class="keywordtype">short</span> *src = <a class="code" href="classBlob2DW.html#m0">ptr</a>-&gt;<a class="code" href="classBitmapW.html#a5">get_ptr</a>(x1, y);
00329         <span class="keywordflow">for</span>( ; y &lt;= y2; ++y, src+=pitch ) {
00330             <span class="keywordflow">if</span>( *src != <a class="code" href="OBLOB2W_8CPP.html#a0">BACKGROUND_COLOR</a> )
00331                 <span class="keywordflow">break</span>;                                    <span class="comment">// dirty</span>
00332         }
00333         <span class="keywordflow">if</span>( y &lt;= y2 )
00334             <span class="keywordflow">break</span>;                                      <span class="comment">// dirty</span>
00335     }                                               <span class="comment">// x1 is now the left margin</span>
00336 
00337     <span class="keywordflow">if</span>( pLeft )
00338         *pLeft = x1 + <a class="code" href="classBlob2DW.html#m2">left_edge</a>;
00339     <span class="keywordflow">if</span>( pTop )
00340         *pTop = y1 + <a class="code" href="classBlob2DW.html#m3">top_edge</a>;
00341     <span class="keywordflow">if</span>( pWidth )
00342         *pWidth = x2 - x1 + 1;
00343     <span class="keywordflow">if</span>( pHeight )
00344         *pHeight = y2 - y1 + 1;
00345 
00346     <span class="keywordflow">if</span>( autoResize ) {
00347         <a class="code" href="classBlob2DW.html#a4">resize</a>(x1+<a class="code" href="classBlob2DW.html#m2">left_edge</a>, y1+<a class="code" href="classBlob2DW.html#m3">top_edge</a>, x2-x1+1, y2-y1+1);
00348         <a class="code" href="classBlob2DW.html#m0">ptr</a> = (<a class="code" href="classBitmapW.html">BitmapW</a> *)<a class="code" href="ALL_8H.html#a7">mem_resize</a>(<a class="code" href="classBlob2DW.html#m0">ptr</a>, (<a class="code" href="classBlob2DW.html#m1">alloc_size</a> = <a class="code" href="classBlob2DW.html#m0">ptr</a>-&gt;<a class="code" href="classBitmapW.html#a7">size</a>()) );
00349     }
00350 }
00351 
<a name="l00352"></a><a class="code" href="classBlob2DW.html#a14">00352</a> <span class="keywordtype">void</span> <a class="code" href="classBlob2DW.html#a14">Blob2DW::clear</a>() {
00353     <a class="code" href="ALL_8H.html#a0">err_when</a>(!<a class="code" href="classBlob2DW.html#m0">ptr</a>);
00354     <a class="code" href="classBlob2DW.html#m0">ptr</a>-&gt;<a class="code" href="classBitmapW.html#a0">init</a>(0, 0);
00355 
00356     <a class="code" href="classBlob2DW.html#m2">left_edge</a> = 0;
00357     <a class="code" href="classBlob2DW.html#m3">top_edge</a> = 0;
00358     <a class="code" href="classBlob2DW.html#m4">width</a> = 0;
00359     <a class="code" href="classBlob2DW.html#m5">height</a> = 0;
00360 }
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:16 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
