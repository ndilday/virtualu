<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Ofirm.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Ofirm.cpp</h1><a href="Ofirm_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename   : OFIRM.CPP</span>
00002 <span class="comment">//Description: Class Firm functions</span>
00003 <span class="comment">//owner         : ho</span>
00004 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>
00005 <span class="preprocessor">#include &lt;<a class="code" href="OWORLD_8H.html">OWORLD.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;OAUDIO.H&gt;</span>
00007 <span class="preprocessor">#include &lt;OCONFIG.H&gt;</span>
00008 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00009 <span class="preprocessor">#include &lt;ODEPT.H&gt;</span>
00010 <span class="preprocessor">#include &lt;<a class="code" href="ODEPTRES_8H.html">ODEPTRES.H</a>&gt;</span>
00011 <span class="preprocessor">#include &lt;<a class="code" href="OFIRMRES_8H.html">OFIRMRES.H</a>&gt;</span>
00012 <span class="preprocessor">#include &lt;OFIRM.H&gt;</span>
00013 <span class="preprocessor">#include &lt;<a class="code" href="OBOX_8H.html">OBOX.H</a>&gt;</span>
00014 <span class="comment">//#include &lt;OAUDIO.H&gt;</span>
00015 <span class="comment">//#include &lt;OCONFIG.H&gt;</span>
00016 
00017 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00018 <span class="preprocessor"></span><span class="keywordtype">char</span>* chapel_display_array[] = {
00019     <span class="stringliteral">"Praying for a win on Saturday, are we?"</span>,
00020     <span class="stringliteral">"The parking situation around here needs a few prayers!"</span>,
00021     <span class="stringliteral">"Praying should help but there are more ways to raise faculty morale!"</span>,
00022     <span class="stringliteral">"Welcome to the Chapel, peace can be found here."</span>,
00023     <span class="stringliteral">"Asking for some help from above?"</span>
00024 };
00025 <span class="keyword">static</span> chapel_display_count = 5;
00026 <span class="preprocessor">#endif</span>
00027 <span class="preprocessor"></span>
00028 <span class="comment">//--------- Begin of function Firm::init --------//</span>
<a name="l00033"></a><a class="code" href="classFirm.html#a2">00033</a> <span class="comment">void Firm::init(int xLoc, int yLoc, int firmId) {</span>
00034     firm_id     = firmId;
00035     setup_date = info.game_date;
00036 
00037     department_recno = 0;
00038 
00039     <span class="comment">//----- set the firm's location &amp; absolute positions on the map -----//</span>
00040 
00041     <a class="code" href="structFirmInfo.html">FirmInfo</a>* firmInfo = firm_res[firmId];
00042 
00043     loc_x1 = xLoc;
00044     loc_y1 = yLoc;
00045     loc_x2 = loc_x1 + firmInfo-&gt;<a class="code" href="structFirmInfo.html#m3">loc_width</a> - 1;
00046     loc_y2 = loc_y1 + firmInfo-&gt;<a class="code" href="structFirmInfo.html#m4">loc_height</a> - 1;
00047 
00048     <span class="comment">//  firm_width=firmInfo-&gt;loc_width;</span>
00049     <span class="comment">//  firm_height=firmInfo-&gt;loc_height;</span>
00050 
00051     init_abs(<a class="code" href="Gamedef_8h.html#a72a19">ZOOM_SMALL</a> , <a class="code" href="Oworldmt_8h.html#a8">MAP_LOC_WIDTH</a>  , <a class="code" href="Oworldmt_8h.html#a9">MAP_LOC_HEIGHT</a>);
00052     init_abs(<a class="code" href="Gamedef_8h.html#a72a20">ZOOM_MEDIUM</a>, <a class="code" href="Oworldmt_8h.html#a18">ZOOM1_LOC_WIDTH</a>, <a class="code" href="Oworldmt_8h.html#a19">ZOOM1_LOC_HEIGHT</a>);
00053     init_abs(<a class="code" href="Gamedef_8h.html#a72a21">ZOOM_LARGE</a> , <a class="code" href="Oworldmt_8h.html#a20">ZOOM2_LOC_WIDTH</a>, <a class="code" href="Oworldmt_8h.html#a21">ZOOM2_LOC_HEIGHT</a>);
00054 
00055     <span class="comment">//------ init loc_matrix --------//</span>
00056 
00057     init_matrix();
00058 
00059     <span class="comment">//-------- init derived ---------//</span>
00060 
00061     <span class="comment">//  init_derived();</span>
00062 }
00063 
00064 <span class="comment">//----------- End of function Firm::init ---------//</span>
00065 
00066 <span class="comment">//--------- Begin of function Firm::deinit --------//</span>
<a name="l00068"></a><a class="code" href="classFirm.html#a3">00068</a> <span class="comment">void Firm::deinit() {</span>
00069     deinit_matrix();
00070 }
00071 
00072 <span class="comment">//----------- End of function Firm::deinit ---------//</span>
00073 
00074 <span class="comment">//--------- Begin of function Firm::init_abs ---------//</span>
00076 <span class="comment">void Firm::init_abs(int zoomLevel, int locWidth, int locHeight) {</span>
00077     <a class="code" href="classRect.html">Rect</a>* rectPtr = abs_rect+zoomLevel;
00078 
00079     <a class="code" href="structFirmInfo.html">FirmInfo</a>* firmInfo = firm_res[firm_id];
00080 
00081     <span class="keywordtype">int</span> bmpWidth  = *( (<span class="keywordtype">short</span>*)firmInfo-&gt;<a class="code" href="structFirmInfo.html#m5">bitmap_ptr</a>[zoomLevel] );
00082     <span class="keywordtype">int</span> bmpHeight = *( ((<span class="keywordtype">short</span>*)firmInfo-&gt;<a class="code" href="structFirmInfo.html#m5">bitmap_ptr</a>[zoomLevel])+1 );
00083 
00084     rectPtr-&gt;<a class="code" href="classRect.html#m0">x1</a> = (locWidth/2) * (loc_x1 + loc_y1);
00085     rectPtr-&gt;<a class="code" href="classRect.html#m2">x2</a> = rectPtr-&gt;<a class="code" href="classRect.html#m0">x1</a> + bmpWidth - 1;
00086 
00087     rectPtr-&gt;<a class="code" href="classRect.html#m3">y2</a> = (<a class="code" href="Oworldmt_8h.html#a1">MAX_WORLD_Y_LOC</a> / 2 * locHeight) + ((locHeight/2) * (-loc_x1 + loc_y2 + 1 ) - 1);
00088     rectPtr-&gt;<a class="code" href="classRect.html#m1">y1</a> = rectPtr-&gt;<a class="code" href="classRect.html#m3">y2</a> - bmpHeight + 1;
00089 }
00090 
00091 <span class="comment">//----------- End of function Firm::init_abs ---------//</span>
00092 
00093 <span class="comment">//--------- Begin of function Firm::init_matrix --------//</span>
00095 <span class="comment">void Firm::init_matrix() {</span>
00096     <span class="comment">//  for( int yLoc=max(1,loc_y1-1) ; yLoc&lt;=min(MAX_WORLD_Y_LOC,loc_y2+1) ; yLoc++ )</span>
00097     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> yLoc=max(1,loc_y1-1) ; yLoc&lt;=loc_y2 ; yLoc++ ) {
00098         <span class="comment">//              for( int xLoc=max(1,loc_x1-1) ; xLoc&lt;=min(MAX_WORLD_X_LOC,loc_x2+1) ; xLoc++ )</span>
00099         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> xLoc=loc_x1 ; xLoc&lt;=min(<a class="code" href="Oworldmt_8h.html#a0">MAX_WORLD_X_LOC</a>,loc_x2+1) ; xLoc++ ) {
00100             <span class="keywordflow">if</span>(!world.get_loc(xLoc,yLoc)-&gt;is_road())
00101                 <span class="keywordflow">if</span>(!world.get_loc(xLoc,yLoc)-&gt;is_road_sub())
00102                     world.get_loc(xLoc,yLoc)-&gt;set_firm(firm_recno);
00103         }
00104     }
00105 
00106     <span class="comment">// ##begin chwg0705</span>
00107     <span class="comment">// avoid invalid display of tree</span>
00108 
00109     <span class="keywordtype">int</span> w=loc_x2-loc_x1+1;
00110     <span class="keywordtype">int</span> h=loc_y2-loc_y1+1;
00111     <span class="keywordflow">if</span>(w&gt;h) {
00112         <span class="keywordtype">int</span> d=(w-h)/2;
00113         <span class="keywordtype">int</span> c;
00114         <span class="keywordflow">for</span>(c=2, yLoc=max(1,loc_y1-d) ; yLoc&lt;loc_y1 ; yLoc++ ,c++) {
00115             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> xLoc=loc_x1 ; xLoc&lt;=loc_x1+c ; xLoc++ ) {
00116                 <span class="keywordflow">if</span>(!world.get_loc(xLoc,yLoc)-&gt;is_road())
00117                     <span class="keywordflow">if</span>(!world.get_loc(xLoc,yLoc)-&gt;is_road_sub())
00118                         world.get_loc(xLoc,yLoc)-&gt;set_firm(firm_recno);
00119             }
00120         }
00121         <span class="keywordflow">for</span>(c=0, yLoc=loc_y2+1 ; yLoc&lt;=min(<a class="code" href="Oworldmt_8h.html#a1">MAX_WORLD_Y_LOC</a>,loc_y2+d) ; yLoc++ ,c++) {
00122             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> xLoc=loc_x2-d+c ; xLoc&lt;=loc_x2 ; xLoc++ ) {
00123                 <span class="keywordflow">if</span>(!world.get_loc(xLoc,yLoc)-&gt;is_road())
00124                     <span class="keywordflow">if</span>(!world.get_loc(xLoc,yLoc)-&gt;is_road_sub())
00125                         world.get_loc(xLoc,yLoc)-&gt;set_firm(firm_recno);
00126             }
00127         }
00128     }
00129 
00130     <span class="comment">// ##end chwg0705</span>
00131 
00132 }
00133 
00134 <span class="comment">//----------- End of function Firm::init_matrix --------//</span>
00135 
00136 <span class="comment">//--------- Begin of function Firm::deinit_matrix --------//</span>
00138 <span class="comment">void Firm::deinit_matrix() {</span>
00139     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> yLoc=max(1,loc_y1-2) ; yLoc&lt;=min(<a class="code" href="Oworldmt_8h.html#a1">MAX_WORLD_Y_LOC</a>,loc_y2+2) ; yLoc++ ) {
00140         <span class="comment">//      for( int yLoc=loc_y1 ; yLoc&lt;=loc_y2 ; yLoc++ )</span>
00141         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> xLoc=max(1,loc_x1-2) ; xLoc&lt;=min(<a class="code" href="Oworldmt_8h.html#a0">MAX_WORLD_X_LOC</a>,loc_x2+2) ; xLoc++ ) {
00142             <span class="comment">//          for( int xLoc=loc_x1 ; xLoc&lt;=loc_x2 ; xLoc++ )</span>
00143             <span class="keywordflow">if</span>(world.get_loc(xLoc,yLoc)-&gt;is_firm())
00144                 world.get_loc(xLoc,yLoc)-&gt;remove_firm();
00145         }
00146     }
00147 }
00148 
00149 <span class="comment">//---------- End of function Firm::deinit_matrix ---------//</span>
00150 
00151 <span class="comment">//--------- Begin of function Firm::name --------//</span>
<a name="l00153"></a><a class="code" href="classFirm.html#a0">00153</a> <span class="comment">char* Firm::name() {</span>
00154     <span class="keyword">static</span> <a class="code" href="classString.html">String</a> str;
00155 
00156     <span class="keywordflow">if</span>( department_recno ) {
00157         <span class="keywordtype">int</span> deptId = department_array[department_recno]-&gt;department_id;
00158 
00159         str  = department_res[deptId]-&gt;name;
00160         str += <span class="stringliteral">" Department"</span>;
00161     }
00162     <span class="keywordflow">else</span> {
00163         str = firm_res[firm_id]-&gt;<a class="code" href="structFirmInfo.html#m1">name</a>;
00164     }
00165 
00166     <span class="keywordflow">return</span> str;
00167 }
00168 
00169 <span class="comment">//---------- End of function Firm::name ---------//</span>
00170 
00171 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00172 <span class="preprocessor"></span>
00173 <span class="comment">//--------- Begin of function Firm::name_on_map --------//</span>
00178 <span class="comment">char* Firm::name_on_map() {</span>
00179     <span class="keywordflow">if</span>( department_recno ) {
00180         <span class="keywordtype">int</span> deptId = department_array[department_recno]-&gt;department_id;
00181         <span class="keywordflow">return</span> department_res[deptId]-&gt;name;
00182     }
00183     <span class="keywordflow">else</span> {
00184         <span class="keywordflow">return</span> firm_res[firm_id]-&gt;<a class="code" href="structFirmInfo.html#m1">name</a>;
00185     }
00186     <span class="keywordflow">return</span> <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00187 }
00188 
00189 <span class="comment">//--------- End of function Firm::name_on_map --------//</span>
00190 <span class="preprocessor">#endif</span>
00191 <span class="preprocessor"></span>
00192 <span class="comment">//--------- Begin of function Firm::double_click_firm --------//</span>
<a name="l00196"></a><a class="code" href="classFirm.html#a5">00196</a> <span class="comment">void Firm::double_click_firm() {</span>
00197     <span class="keywordtype">int</span> viewMode=0;
00198 
00199     <span class="keywordflow">if</span>( firm_id &lt; <a class="code" href="OFIRMID_8H.html#a21a1">FIRST_NONDEPARTMENTAL_FIRM_ID</a> ) { <span class="comment">// if it's a departmental building</span>
00200         viewMode = <a class="code" href="Osys_8h.html#a45a13">MODE_PERFORMANCE_REPORT</a>;
00201         <span class="keyword">enum</span> {
00202             <a class="code" href="Odept__if_8cpp.html#a138a86">MODE_INSTITUTION</a>  = 0,
00203             <a class="code" href="Odept__if_8cpp.html#a138a87">MODE_DEPARTMENT</a> = 1,
00204             MODE_RANK     = 2,
00205         };
00206         department_array.current_data_mode=<a class="code" href="Odept__if_8cpp.html#a138a87">MODE_DEPARTMENT</a>;
00207     }
00208     <span class="keywordflow">else</span> {
00209         <span class="keywordflow">switch</span>(firm_id) {
00210         <span class="keywordflow">case</span> <a class="code" href="OFIRMID_8H.html#a22a8">FIRM_STUDENT</a>:                          <span class="comment">// Student Union</span>
00211             viewMode = <a class="code" href="Osys_8h.html#a45a11">MODE_STUDENT_REPORT</a>;
00212             <span class="keywordflow">break</span>;
00213 
00214         <span class="keywordflow">case</span> <a class="code" href="OFIRMID_8H.html#a22a10">FIRM_PRESIDENT</a>: {                      <span class="comment">// ## chwg0707</span>
00215             <span class="keywordflow">if</span>(info.year_passed&lt;=1) {
00216                 viewMode = <a class="code" href="Osys_8h.html#a45a33">MODE_WELCOME_LETTER</a>;
00217             }
00218             <span class="keywordflow">else</span> {
00219                 viewMode = <a class="code" href="Osys_8h.html#a45a34">MODE_EVALUATION_LETTER</a>;
00220             }
00221         }
00222         <span class="keywordflow">break</span>;
00223 
00224         <span class="keywordflow">case</span> <a class="code" href="OFIRMID_8H.html#a22a11">FIRM_TOWER</a>:                            <span class="comment">// ## chwg0707</span>
00225             viewMode = <a class="code" href="Osys_8h.html#a45a15">MODE_SCORE_REPORT</a>;
00226             <span class="keywordflow">break</span>;
00227 
00228         <span class="keywordflow">case</span> <a class="code" href="OFIRMID_8H.html#a22a4">FIRM_OLD_MAIN</a>:
00229         <span class="keywordflow">case</span> <a class="code" href="OFIRMID_8H.html#a22a13">FIRM_POLICE</a>:
00230         <span class="keywordflow">case</span> <a class="code" href="OFIRMID_8H.html#a22a14">FIRM_PARK_LOTS</a>:
00231         <span class="keywordflow">case</span> <a class="code" href="OFIRMID_8H.html#a22a15">FIRM_PARK_STRUCTURE</a>:
00232         <span class="keywordflow">case</span> <a class="code" href="OFIRMID_8H.html#a22a5">FIRM_ADMISSIONS</a>:
00233         <span class="keywordflow">case</span> <a class="code" href="OFIRMID_8H.html#a22a6">FIRM_DEVELOPMENT</a>:
00234         <span class="keywordflow">case</span> <a class="code" href="OFIRMID_8H.html#a22a7">FIRM_FACILITIES</a>:
00235         <span class="keywordflow">case</span> <a class="code" href="OFIRMID_8H.html#a22a3">FIRM_LIBRARY</a>:
00236         <span class="keywordflow">case</span> <a class="code" href="OFIRMID_8H.html#a22a17">FIRM_STADIUM</a>:
00237         <span class="keywordflow">case</span> <a class="code" href="OFIRMID_8H.html#a22a9">FIRM_RESIDENCE</a>:                        <span class="comment">// ## chwg0930</span>
00238         <span class="keywordflow">case</span> <a class="code" href="OFIRMID_8H.html#a22a18">FIRM_PLAY_FIELD</a>:
00239         <span class="keywordflow">case</span> <a class="code" href="OFIRMID_8H.html#a22a19">FIRM_INDOOR_SPORTS</a>:
00240             <span class="comment">// if is not a departmental building</span>
00241             viewMode = <a class="code" href="Osys_8h.html#a45a38">MODE_FIRST_NONDEPARTMENTAL_FIRM</a>+
00242                 firm_id-<a class="code" href="OFIRMID_8H.html#a21a1">FIRST_NONDEPARTMENTAL_FIRM_ID</a>;
00243             <span class="keywordflow">break</span>;
00244 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00245 <span class="preprocessor"></span>        <span class="keywordflow">case</span> <a class="code" href="OFIRMID_8H.html#a22a12">FIRM_CHAPEL</a>:
00246             <span class="keywordtype">int</span> randomMsg = m.random( chapel_display_count );
00247             box.msg( chapel_display_array[randomMsg] );
00248             <span class="keywordflow">break</span>;
00249 <span class="preprocessor">#endif</span>
00250 <span class="preprocessor"></span>        }
00251     }
00252 
00253     <span class="keywordflow">if</span>( viewMode ) {
00254         sys.set_view_mode(viewMode, 0);               <span class="comment">// 0-don't play sound as it is played in FirmArray::select_firm() already</span>
00255     }
00256 }
00257 
00258 <span class="comment">//---------- End of function Firm::double_click_firm ---------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:40 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
