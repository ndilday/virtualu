<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OGRPDBAR.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>OGRPDBAR.CPP</h1><a href="OGRPDBAR_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OGrpDbar.CPP</span>
00002 <span class="comment">//Description : Object GraphDoubleBar</span>
00003 <span class="comment">//Owner           : Kevin(ho)</span>
00004 
00005 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;<a class="code" href="COLOR_8H.html">COLOR.H</a>&gt;</span>
00007 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>
00008 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00010 <span class="preprocessor">#include &lt;OFONT.H&gt;</span>
00011 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00012 <span class="preprocessor">#include &lt;<a class="code" href="OGRPDBAR_8H.html">OGRPDBAR.H</a>&gt;</span>
00013 <span class="preprocessor">#include &lt;OIFACE.H&gt;</span>
00014 
00015 <span class="preprocessor">#include &lt;math.h&gt;</span>
00016 
00017 <span class="comment">//--------- Define macro constant -----------//</span>
00018 
<a name="l00019"></a><a class="code" href="OGRPDBAR_8CPP.html#a0">00019</a> <span class="preprocessor">#define MAX_LEN_LABEL "0,000,000"</span>
00020 <span class="preprocessor"></span>
00021 <span class="keyword">static</span> <span class="keywordtype">int</span> default_series_color[] = {
00022     <a class="code" href="COLOR_8H.html#a21">V_BLUE</a>,
00023     <a class="code" href="COLOR_8H.html#a20">V_GREEN</a>,
00024     <a class="code" href="COLOR_8H.html#a19">V_RED</a>,
00025     <a class="code" href="COLOR_8H.html#a25">V_YELLOW</a>,
00026     <a class="code" href="COLOR_8H.html#a22">V_VIOLET</a>,
00027     <a class="code" href="COLOR_8H.html#a23">V_BROWN</a>,
00028     <a class="code" href="COLOR_8H.html#a18">V_ORANGE</a>,
00029     <a class="code" href="COLOR_8H.html#a24">V_PINK</a>,
00030     <a class="code" href="COLOR_8H.html#a15">V_BLACK</a>,
00031     <a class="code" href="COLOR_8H.html#a17">V_WHITE</a>,
00032 };                                                <span class="comment">// 10 default series colors</span>
00033 
00034 <span class="keyword">enum</span> {  <a class="code" href="OGRPDBAR_8CPP.html#a8a3">DEFAULT_SERIES_COLOR_NUM</a> = 10 };
00035 
00036 <span class="keyword">enum</span> {
00037     <a class="code" href="OGRPDBAR_8CPP.html#a9a4">LEGEND_SIZE</a> = 11,
00038     <a class="code" href="OGRPDBAR_8CPP.html#a9a5">LEGEND_X_SPACING</a> = 12,
00039     <a class="code" href="OGRPDBAR_8CPP.html#a9a6">LEGEND_Y_SPACING</a> = 2,
00040 };
00041 
00042 <span class="keyword">enum</span> {  <a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a> = 2         };
00043 
00044 <span class="comment">//-------------- Define static vars ------------//</span>
00045 
00046 <span class="keyword">static</span> <span class="keywordtype">char</span> paint_flag = 0;
00047 
00048 <span class="comment">//-------- Begin of function GraphDoubleBar::GraphDoubleBar ----//</span>
<a name="l00050"></a><a class="code" href="classGraphDoubleBar.html#a0">00050</a> <span class="comment">GraphDoubleBar::GraphDoubleBar() {</span>
00051     init_flag = 0;
00052     GraphDoubleBar_bitmap = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00053 }
00054 
00055 <span class="comment">//---------- End of function GraphDoubleBar::GraphDoubleBar ----//</span>
00056 
00057 <span class="comment">//-------- Begin of function GraphDoubleBar::~GraphDoubleBar -----//</span>
<a name="l00059"></a><a class="code" href="classGraphDoubleBar.html#a1">00059</a> <span class="comment">GraphDoubleBar::~GraphDoubleBar() {</span>
00060     deinit();
00061 }
00062 
00063 <span class="comment">//---------- End of function GraphDoubleBar::~GraphDoubleBar -----//</span>
00064 
00065 <span class="comment">//-------- Begin of function GraphDoubleBar::init --------//</span>
00099 <span class="comment">void GraphDoubleBar::init(int x1, int y1, int x2, int y2, int seriesNum, int *dataNum,</span>
00100                           <span class="keywordtype">void</span> *dataArray, <span class="keywordtype">char</span> dataTypeFlag,
00101                           <span class="keywordtype">int</span> *xStart, <span class="keywordtype">int</span> *xEnd, <span class="keywordtype">char</span> *xLabel, <span class="keywordtype">char</span> *yLabel,
00102                           <span class="keywordtype">char</span> **legendArray, <span class="keywordtype">char</span> transparentFlag,
00103                           <span class="keywordtype">char</span> orientationFlag, <span class="keywordtype">char</span> valueFlag,
00104                           <span class="keywordtype">int</span> numFormat, <span class="keywordtype">int</span> *seriesColor, <span class="keywordtype">int</span> axisColor) {
00105     <a class="code" href="ALL_8H.html#a0">err_when</a>(seriesNum &gt; <a class="code" href="OGRPDBAR_8CPP.html#a8a3">DEFAULT_SERIES_COLOR_NUM</a> &amp;&amp; !seriesColor);
00106     <a class="code" href="ALL_8H.html#a0">err_when</a>(seriesNum &lt;= 0);
00107     <a class="code" href="ALL_8H.html#a0">err_when</a>(*xEnd &lt; *xStart);
00108 
00109     graph_width = x2 - x1 - 6;
00110 
00111     <a class="code" href="ALL_8H.html#a0">err_when</a>(graph_width &lt; 0);
00112 
00113     GraphDoubleBar_x1 = x1;
00114     GraphDoubleBar_y1 = y1;
00115     GraphDoubleBar_x2 = x2;
00116     GraphDoubleBar_y2 = y2;
00117 
00118     series_num = seriesNum;
00119     data_num = dataNum;
00120     data_array = dataArray;
00121     data_type_flag = dataTypeFlag;
00122     x_start = xStart;
00123     x_end = xEnd;
00124 
00125     x_label = xLabel;
00126     y_label = yLabel;
00127     legend_array = legendArray;
00128 
00129     transparent_flag = transparentFlag;
00130     orientation_flag = orientationFlag;
00131     value_flag = valueFlag;
00132     num_format = num_format;
00133 
00134     series_color = seriesColor ? seriesColor : default_series_color;
00135     axis_color = axisColor;
00136 
00137     init_flag = 1;
00138 
00139     y_label_max_len = font_chartsm.text_width(<a class="code" href="OGRPDBAR_8CPP.html#a0">MAX_LEN_LABEL</a>);
00140     set_font(&amp;font_chartsm);
00141 
00142     paint();
00143 }
00144 
00145 <span class="comment">//------------- End of function GraphDoubleBar::init -----------//</span>
00146 
00147 <span class="comment">//-------- Begin of function GraphDoubleBar::deinit ------------//</span>
<a name="l00149"></a><a class="code" href="classGraphDoubleBar.html#a7">00149</a> <span class="comment">void GraphDoubleBar::deinit() {</span>
00150     <span class="keywordflow">if</span> (GraphDoubleBar_bitmap) {
00151         <a class="code" href="ALL_8H.html#a8">mem_del</a>(GraphDoubleBar_bitmap);
00152         GraphDoubleBar_bitmap = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00153     }
00154 
00155     init_flag = 0;
00156 }
00157 
00158 <span class="comment">//------------- End of function GraphDoubleBar::deinit ---------//</span>
00159 
00160 <span class="comment">//-------- Begin of function GraphDoubleBar::set_font ------------//</span>
<a name="l00162"></a><a class="code" href="classGraphDoubleBar.html#a10">00162</a> <span class="comment">void GraphDoubleBar::set_font(Font *fontPtr) {</span>
00163     <span class="keywordflow">if</span> (!init_flag)
00164         <span class="keywordflow">return</span>;
00165 
00166     font_ptr = fontPtr;
00167 
00168     calc_pos();
00169 }
00170 
00171 <span class="comment">//------------- End of function GraphDoubleBar::set_font ---------//</span>
00172 
00173 <span class="comment">//-------- Begin of function GraphDoubleBar::calc_pos ------------//</span>
<a name="l00178"></a><a class="code" href="classGraphDoubleBar.html#a11">00178</a> <span class="comment">void GraphDoubleBar::calc_pos() {</span>
00179     <span class="keywordflow">if</span> (legend_array) {
00180         <span class="keywordtype">short</span> textWidth = 0, textHeight = font_ptr-&gt;max_font_height;
00181 
00182         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num; i++) {
00183             <span class="keywordflow">if</span> (font_ptr-&gt;text_width(legend_array[i]) &gt; textWidth)
00184                 textWidth = font_ptr-&gt;text_width(legend_array[i]);
00185         }
00186 
00187         <a class="code" href="ALL_8H.html#a0">err_when</a>(textWidth + <a class="code" href="OGRPDBAR_8CPP.html#a9a5">LEGEND_X_SPACING</a> * 2 &gt; graph_width);
00188 
00189         legend_x_num = (graph_width - <a class="code" href="OGRPDBAR_8CPP.html#a9a5">LEGEND_X_SPACING</a>*2) / (textWidth + <a class="code" href="OGRPDBAR_8CPP.html#a9a5">LEGEND_X_SPACING</a>*2);
00190         legend_y_num = (series_num / legend_x_num) + ((series_num % legend_x_num) ? 1 : 0);
00191 
00192         graph_height = GraphDoubleBar_y2 - GraphDoubleBar_y1 - legend_y_num * (textHeight + <a class="code" href="OGRPDBAR_8CPP.html#a9a6">LEGEND_Y_SPACING</a>) - 6;
00193 
00194         <a class="code" href="ALL_8H.html#a0">err_when</a>(graph_height &lt;= 0);
00195 
00196         legend_width = (graph_width - <a class="code" href="OGRPDBAR_8CPP.html#a9a5">LEGEND_X_SPACING</a>*2) / legend_x_num;
00197         legend_height = textHeight + <a class="code" href="OGRPDBAR_8CPP.html#a9a6">LEGEND_Y_SPACING</a>;
00198     }
00199     <span class="keywordflow">else</span> {
00200         legend_width = legend_height = legend_x_num = legend_y_num = 0;
00201         graph_height = GraphDoubleBar_y2 - GraphDoubleBar_y1 - 6;
00202     }
00203 
00204     <span class="keywordtype">short</span> YLabelWidth = y_label ? (orientation_flag ? font_ptr-&gt;max_font_height : font_ptr-&gt;text_width(y_label)) : -<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>;
00205     <span class="keywordtype">short</span> XLabelHeight = x_label ? (font_ptr-&gt;max_font_height) : -<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>;
00206     series_x1 = GraphDoubleBar_x1 + 4 + <a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>*4 + YLabelWidth + y_label_max_len;
00207     series_y1 = GraphDoubleBar_y1 + 4 + <a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>*6;
00208     series_x2 = GraphDoubleBar_x2 - 4 - <a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>*12;
00209     series_y2 = GraphDoubleBar_y1 + graph_height - <a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>*3 - (font_ptr-&gt;max_font_height) - XLabelHeight;
00210 }
00211 
00212 <span class="comment">//------------ End of function GraphDoubleBar::calc_pos ---------//</span>
00213 
00214 <span class="comment">//-------- Begin of function GraphDoubleBar::paint --------------//</span>
<a name="l00216"></a><a class="code" href="classGraphDoubleBar.html#a8">00216</a> <span class="comment">void GraphDoubleBar::paint() {</span>
00217     <span class="keywordflow">if</span> (transparent_flag) {
00218         user_interface.brighten(GraphDoubleBar_x1+4, GraphDoubleBar_y1+4, GraphDoubleBar_x2-2, GraphDoubleBar_y2-2);
00219 
00220         <span class="comment">//              vga.use_back();</span>
00221         <span class="keywordflow">if</span> (legend_array)
00222             draw_legend();
00223         draw_axis_label();
00224         <span class="comment">//              vga.use_front();</span>
00225 
00226         GraphDoubleBar_bitmap = vga_back.save_area(GraphDoubleBar_x1+4, GraphDoubleBar_y1+4, GraphDoubleBar_x2-2, GraphDoubleBar_y2-2, GraphDoubleBar_bitmap);
00227     }
00228 
00229     paint_flag = 1;
00230     refresh();
00231 }
00232 
00233 <span class="comment">//------------- End of function GraphDoubleBar::paint -----------//</span>
00234 
00235 <span class="comment">//-------- Begin of function GraphDoubleBar::refresh ------------//</span>
<a name="l00237"></a><a class="code" href="classGraphDoubleBar.html#a9">00237</a> <span class="comment">void GraphDoubleBar::refresh() {</span>
00238     <span class="comment">//  vga.use_back();</span>
00239 
00240     <span class="keywordflow">if</span> (transparent_flag) {
00241         user_interface.rect(GraphDoubleBar_x1, GraphDoubleBar_y1, GraphDoubleBar_x2, GraphDoubleBar_y2, 2);
00242         vga_back.rest_area(GraphDoubleBar_bitmap, 0, 0);
00243     }
00244     <span class="keywordflow">else</span> {
00245         user_interface.bar(GraphDoubleBar_x1, GraphDoubleBar_y1, GraphDoubleBar_x2, GraphDoubleBar_y2);
00246         user_interface.panel(GraphDoubleBar_x1+3, GraphDoubleBar_y1+3, GraphDoubleBar_x2-4, GraphDoubleBar_y2-4);
00247         <span class="keywordflow">if</span> (legend_array)
00248             draw_legend();
00249     }
00250     draw_scale();
00251     draw_series();
00252 
00253     <span class="comment">//  vga.use_front();</span>
00254     <span class="keywordflow">if</span> (!paint_flag)
00255         vga.blt_buf(GraphDoubleBar_x1, GraphDoubleBar_y1, GraphDoubleBar_x2+2, GraphDoubleBar_y2+2);
00256     <span class="keywordflow">else</span>
00257         paint_flag = 0;
00258 }
00259 
00260 <span class="comment">//------------- End of function GraphDoubleBar::refresh ---------//</span>
00261 
00262 <span class="comment">//---------- Begin of function GraphDoubleBar::draw_legend ------------//</span>
00264 <span class="comment">void GraphDoubleBar::draw_legend() {</span>
00265     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num; i++) {
00266         <span class="keywordtype">short</span> legendX = GraphDoubleBar_x1 + 4 + (i % legend_x_num) * legend_width + <a class="code" href="OGRPDBAR_8CPP.html#a9a5">LEGEND_X_SPACING</a>;
00267         <span class="keywordtype">short</span> legendY = GraphDoubleBar_y1 + 4 + graph_height + (i / legend_x_num) * legend_height;
00268         user_interface.bar( legendX+<a class="code" href="OGRPDBAR_8CPP.html#a9a5">LEGEND_X_SPACING</a>, legendY+<a class="code" href="OGRPDBAR_8CPP.html#a9a6">LEGEND_Y_SPACING</a>,
00269                             legendX+<a class="code" href="OGRPDBAR_8CPP.html#a9a5">LEGEND_X_SPACING</a>+<a class="code" href="OGRPDBAR_8CPP.html#a9a4">LEGEND_SIZE</a>, legendY+<a class="code" href="OGRPDBAR_8CPP.html#a9a6">LEGEND_Y_SPACING</a>+<a class="code" href="OGRPDBAR_8CPP.html#a9a4">LEGEND_SIZE</a>,
00270                             series_color[i] );
00271         font_ptr-&gt;put( legendX+<a class="code" href="OGRPDBAR_8CPP.html#a9a5">LEGEND_X_SPACING</a>*2+<a class="code" href="OGRPDBAR_8CPP.html#a9a4">LEGEND_SIZE</a>, legendY+<a class="code" href="OGRPDBAR_8CPP.html#a9a6">LEGEND_Y_SPACING</a>, legend_array[i] );
00272     }
00273 }
00274 
00275 <span class="comment">//------------ End of function GraphDoubleBar::draw_legend ------------//</span>
00276 
00277 <span class="comment">//---------- Begin of function GraphDoubleBar::draw_axis_label --------//</span>
00279 <span class="comment">void GraphDoubleBar::draw_axis_label() {</span>
00280     <span class="keywordtype">short</span> textHeight = font_ptr-&gt;max_font_height;
00281 
00282     <span class="keywordflow">if</span> (x_label) {
00283         font_ptr-&gt;center_put( series_x1, series_y2+<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>*2+textHeight,
00284                               series_x2, GraphDoubleBar_y1+graph_height-<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>, x_label );
00285     }
00286 
00287     <span class="keywordflow">if</span> (y_label) {
00288         <span class="keywordtype">short</span> textWidth = font_ptr-&gt;text_width(y_label) + 1;
00289 
00290         <span class="keywordflow">if</span> (orientation_flag) {
00291             <span class="keywordtype">short</span> *fontBuf = (<span class="keywordtype">short</span> *) sys.common_data_buf;
00292             <a class="code" href="ALL_8H.html#a0">err_when</a>(textWidth * textHeight * <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>) &gt; <a class="code" href="Osys_8h.html#a40a2">COMMON_DATA_BUF_SIZE</a>);
00293 
00294             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; textWidth * textHeight; i++)
00295                 *fontBuf++ = transparent_code_w;
00296 
00297             font_ptr-&gt;put_to_bufferW(fontBuf = (<span class="keywordtype">short</span> *) sys.common_data_buf, textWidth * <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>), 0, 0, y_label);
00298 
00299             <span class="keywordtype">short</span> xStart = GraphDoubleBar_x1 + 4 + <a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a> * 2;
00300             <span class="keywordtype">short</span> yStart = (series_y1 + series_y2 - textWidth) / 2;
00301 
00302             <span class="keywordflow">for</span> (<span class="keywordtype">short</span> x = 0; x &lt; textHeight; x++) {
00303                 <span class="keywordflow">for</span> (<span class="keywordtype">short</span> y = textWidth - 1; y &gt;= 0; y--, fontBuf++) {
00304                     <span class="keywordflow">if</span> (*fontBuf != transparent_code_w)
00305                         *vga_back.buf_ptr(xStart+x, yStart+y) = *fontBuf;
00306                 }
00307             }
00308         }
00309         <span class="keywordflow">else</span> {
00310             font_ptr-&gt;center_put( GraphDoubleBar_x1+4+<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>*2, series_y1,
00311                                   GraphDoubleBar_x1+4+<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>*2+textWidth, series_y2, y_label);
00312         }
00313     }
00314 }
00315 
00316 <span class="comment">//------------ End of function GraphDoubleBar::draw_axis_label --------//</span>
00317 
00318 <span class="comment">//---------- Begin of function GraphDoubleBar::find_scale -------------//</span>
00320 <span class="comment">void GraphDoubleBar::find_scale() {</span>
00321     <span class="keywordtype">double</span> data, maxVal = 1.0;
00322     x_axis_pos = 0;
00323 
00324     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num * *data_num; i++) {
00325         <span class="keywordflow">switch</span> (data_type_flag) {
00326         <span class="keywordflow">case</span> DATA_DOUBLE:
00327             data = ((<span class="keywordtype">double</span>*)data_array)[i];
00328             <span class="keywordflow">break</span>;
00329         <span class="keywordflow">case</span> DATA_FLOAT:
00330             data = double(((<span class="keywordtype">float</span>*)data_array)[i]);
00331             <span class="keywordflow">break</span>;
00332         <span class="keywordflow">case</span> DATA_INT:
00333             data = double(((<span class="keywordtype">int</span>*)data_array)[i]);
00334             <span class="keywordflow">break</span>;
00335         <span class="keywordflow">case</span> DATA_LONG:
00336             data = double(((<span class="keywordtype">long</span>*)data_array)[i]);
00337             <span class="keywordflow">break</span>;
00338         }
00339         <span class="keywordflow">if</span> (<a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(data) &gt; maxVal)
00340             maxVal = <a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(data);
00341         <span class="keywordflow">if</span> (!x_axis_pos &amp;&amp; data &lt; 0.0)
00342             x_axis_pos = 1;
00343     }
00344 
00345     max_scale = 10+(maxVal);
00346 }
00347 
00348 <span class="comment">//------------ End of function GraphDoubleBar::find_scale -------------//</span>
00349 
00350 <span class="comment">//---------- Begin of function GraphDoubleBar::draw_scale -------------//</span>
00352 <span class="comment">void GraphDoubleBar::draw_scale() {</span>
00353     find_scale();
00354 
00355     <span class="keywordtype">short</span> xAxisPos;
00356 
00357     <span class="comment">//------ Draw y-axis -------//</span>
00358 
00359     <span class="keywordflow">if</span> (x_axis_pos)
00360         vga_back.bar(series_x1, series_y1-<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>*2, series_x1+1, series_y2+<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>*2, axis_color);
00361     <span class="keywordflow">else</span>
00362         vga_back.bar(series_x1, series_y1-<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>*2, series_x1+1, series_y2, axis_color);
00363 
00364     <span class="keywordtype">short</span> scaleNum = (series_y2-series_y1-font_ptr-&gt;max_font_height) / (font_ptr-&gt;max_font_height*3/2);
00365     <span class="keywordflow">if</span> ( scaleNum &gt; 0 )
00366         scaleNum = short(pow(2,floor(log10(<span class="keywordtype">double</span>(scaleNum))/log10(2.0))));
00367     <span class="keywordflow">else</span>
00368         scaleNum = 0;
00369     <span class="keywordtype">short</span> scaleStep = (series_y2-series_y1) / scaleNum;
00370     <span class="keywordtype">double</span> scaleValue;
00371     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt;= scaleNum; i++) {
00372         <span class="keywordflow">if</span> ( (x_axis_pos &amp;&amp; i == scaleNum / 2) || !(x_axis_pos || i) )
00373             vga_back.bar(series_x1, xAxisPos=series_y2-i*scaleStep-1, series_x2+<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>*8, series_y2-i*scaleStep, axis_color);
00374         <span class="keywordflow">else</span>
00375             vga_back.bar(series_x1, series_y2-i*scaleStep, series_x1+<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>*2, series_y2-i*scaleStep, axis_color);
00376 
00377         <span class="keywordflow">if</span> (x_axis_pos)
00378             scaleValue = max_scale*2/scaleNum*i - max_scale;
00379         <span class="keywordflow">else</span>
00380             scaleValue = max_scale/scaleNum*i;
00381 
00382         <span class="keywordflow">switch</span> (data_type_flag) {
00383         <span class="keywordflow">case</span> DATA_FLOAT:
00384         <span class="keywordflow">case</span> DATA_DOUBLE:
00385             font_ptr-&gt;right_put(series_x1-<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>, series_y2-i*scaleStep-font_ptr-&gt;max_font_height/2, m.format(scaleValue,num_format));
00386             <span class="keywordflow">break</span>;
00387         <span class="keywordflow">case</span> DATA_INT:
00388         <span class="keywordflow">case</span> DATA_LONG:
00389             font_ptr-&gt;right_put(series_x1-<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>, series_y2-i*scaleStep-font_ptr-&gt;max_font_height/2, m.format(<span class="keywordtype">long</span>(scaleValue),num_format));
00390         }
00391     }
00392 
00393     <span class="comment">//------ Draw x-axis -------//</span>
00394 
00395     <span class="keywordtype">short</span> maxLabelWidth = font_ptr-&gt;text_width(m.format(*x_end, 16))+<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>*2;
00396     x_axis_step = (series_x2-series_x1) / (*data_num);
00397     <span class="keywordtype">short</span> displayInc = 1;
00398     <span class="keywordflow">while</span> (displayInc * x_axis_step / maxLabelWidth &lt; 1) displayInc++;
00399     <span class="keywordtype">int</span> xAxisStep = ((*x_end) - (*x_start)+1) / (*data_num);
00400     <span class="keywordflow">for</span> (i = 0; i &lt; *data_num; i += displayInc) {
00401         vga_back.bar(series_x2-i*x_axis_step, xAxisPos-<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>*2, series_x2-i*x_axis_step, xAxisPos, axis_color);
00402         font_ptr-&gt;center_put((series_x2-i*x_axis_step)-maxLabelWidth/2-<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>, xAxisPos+<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>,
00403                              (series_x2-i*x_axis_step)+maxLabelWidth/2+<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>, xAxisPos+<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>+font_ptr-&gt;max_font_height, m.format(*x_end-xAxisStep*i, 16));
00404     }
00405 }
00406 
00407 <span class="comment">//------------ End of function GraphDoubleBar::draw_scale -------------//</span>
00408 
00409 <span class="comment">//---------- Begin of function GraphDoubleBar::draw_series ------------//</span>
00411 <span class="comment">void GraphDoubleBar::draw_series() {</span>
00412     <span class="keywordflow">switch</span> (data_type_flag) {
00413     <span class="keywordflow">case</span> DATA_FLOAT: draw_series_float(); <span class="keywordflow">break</span>;
00414     <span class="keywordflow">case</span> DATA_DOUBLE: draw_series_double(); <span class="keywordflow">break</span>;
00415     <span class="keywordflow">case</span> DATA_INT: draw_series_int(); <span class="keywordflow">break</span>;
00416     <span class="keywordflow">case</span> DATA_LONG: draw_series_long(); <span class="keywordflow">break</span>;
00417     }
00418 }
00419 
00420 <span class="comment">//------------ End of function GraphDoubleBar::draw_series ------------//</span>
00421 
00422 <span class="comment">//---------- Begin of function GraphDoubleBar::draw_series_float ------------//</span>
00424 <span class="comment">void GraphDoubleBar::draw_series_float() {</span>
00425     <span class="keywordtype">float</span> *dataArray = (<span class="keywordtype">float</span> *) data_array;
00426     <span class="keywordtype">short</span> currX, currY;
00427     <span class="keywordtype">int</span> barWidth = x_axis_step/(series_num+2);
00428 
00429     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num; i++) {
00430         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; *data_num; j++) {
00431             currX = series_x1 + (j+1)*x_axis_step + i*barWidth;
00432 
00433             <span class="keywordflow">if</span> (x_axis_pos)
00434                 currY = series_y2 - short(((*dataArray + <span class="keywordtype">float</span>(max_scale)) * <span class="keywordtype">float</span>(series_y2-series_y1) / <span class="keywordtype">float</span>(max_scale*2)));
00435             <span class="keywordflow">else</span>
00436                 currY = series_y2 - short(*dataArray * <span class="keywordtype">float</span>(series_y2-series_y1) / <span class="keywordtype">float</span>(max_scale));
00437 
00438             user_interface.bar( (<span class="keywordtype">int</span>)(currX-0.5*barWidth), currY,
00439                                 (<span class="keywordtype">int</span>)(currX+0.5*barWidth)-<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>, series_y2-<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>,
00440                                 vga_back.translate_color(series_color[i]));
00441 
00442             dataArray++;
00443         }
00444     }
00445 
00446     dataArray = (<span class="keywordtype">float</span> *) data_array;
00447     <span class="keywordflow">if</span> (value_flag)
00448         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num; i++) {
00449             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; *data_num; j++) {
00450                 currX = series_x1 + (j+1)*x_axis_step + i*barWidth;
00451 
00452                 <span class="keywordflow">if</span> (x_axis_pos)
00453                     currY = series_y2 - short(((*dataArray + <span class="keywordtype">float</span>(max_scale)) * <span class="keywordtype">float</span>(series_y2-series_y1) / <span class="keywordtype">float</span>(max_scale*2)));
00454                 <span class="keywordflow">else</span>
00455                     currY = series_y2 - short(*dataArray * <span class="keywordtype">float</span>(series_y2-series_y1) / <span class="keywordtype">float</span>(max_scale));
00456 
00457                 draw_value(dataArray, <a class="code" href="COLOR_8H.html#a15">V_BLACK</a>, currX+<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>, currY-font_ptr-&gt;max_font_height/2, DATA_FLOAT);
00458                 dataArray++;
00459             }
00460         }
00461 
00462 }
00463 
00464 <span class="comment">//------------ End of function GraphDoubleBar::draw_series_float ------------//</span>
00465 
00466 <span class="comment">//---------- Begin of function GraphDoubleBar::draw_series_double ------------//</span>
00468 <span class="comment">void GraphDoubleBar::draw_series_double() {</span>
00469     <span class="keywordtype">double</span> *dataArray = (<span class="keywordtype">double</span> *) data_array;
00470     <span class="keywordtype">short</span> currX, currY;
00471     <span class="keywordtype">int</span> barWidth = x_axis_step/(series_num+2);
00472 
00473     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num; i++) {
00474 
00475         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; *data_num; j++) {
00476             currX = series_x1 + (j+1)*x_axis_step + i*barWidth;
00477 
00478             <span class="keywordflow">if</span> (x_axis_pos)
00479                 currY = series_y2 - short(((*dataArray+max_scale) * <span class="keywordtype">double</span>(series_y2-series_y1) / (max_scale*2)));
00480             <span class="keywordflow">else</span>
00481                 currY = series_y2 - short(*dataArray * <span class="keywordtype">double</span>(series_y2-series_y1) / max_scale);
00482 
00483             user_interface.bar( (<span class="keywordtype">int</span>)(currX-0.5*barWidth), currY,
00484                                 (<span class="keywordtype">int</span>)(currX+0.5*barWidth)-<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>, series_y2-<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>,
00485                                 vga_back.translate_color(series_color[i]));
00486             dataArray++;
00487         }
00488     }
00489 
00490     dataArray = (<span class="keywordtype">double</span> *) data_array;
00491 
00492     <span class="keywordflow">if</span> (value_flag)
00493         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num; i++) {
00494 
00495             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; *data_num; j++) {
00496                 currX = series_x1 + (j+1)*x_axis_step + i*barWidth;
00497 
00498                 <span class="keywordflow">if</span> (x_axis_pos)
00499                     currY = series_y2 - short(((*dataArray+max_scale) * <span class="keywordtype">double</span>(series_y2-series_y1) / (max_scale*2)));
00500                 <span class="keywordflow">else</span>
00501                     currY = series_y2 - short(*dataArray * <span class="keywordtype">double</span>(series_y2-series_y1) / max_scale);
00502                 draw_value(dataArray-1, <a class="code" href="COLOR_8H.html#a15">V_BLACK</a>, currX+<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>, currY-font_ptr-&gt;max_font_height/2, DATA_DOUBLE);
00503                 dataArray++;
00504             }
00505         }
00506 
00507 }
00508 
00509 <span class="comment">//------------ End of function GraphDoubleBar::draw_series_double ------------//</span>
00510 
00511 <span class="comment">//---------- Begin of function GraphDoubleBar::draw_series_int ------------//</span>
00513 <span class="comment">void GraphDoubleBar::draw_series_int() {</span>
00514     <span class="keywordtype">int</span> *dataArray = (<span class="keywordtype">int</span>*) data_array;
00515     <span class="comment">//  char *dataArray = (char*)data_array;</span>
00516 
00517     <span class="keywordtype">short</span> currX, currY;
00518     <span class="keywordtype">int</span> barWidth = x_axis_step/(series_num+2);
00519 
00520     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num; i++) {
00521 
00522         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; *data_num; j++) {
00523             currX = series_x1 + (j+1)*x_axis_step + i*barWidth;
00524 
00525             <span class="keywordflow">if</span> (x_axis_pos)
00526                 currY = series_y2 - (((int)(*dataArray)+int(max_scale)) * (series_y2-series_y1) / int(max_scale*2));
00527             <span class="keywordflow">else</span>
00528                 currY = series_y2 - (int)*dataArray * (series_y2-series_y1) / int(max_scale);
00529 
00530             <span class="keywordflow">if</span>(currY&lt;series_y2-<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>)
00531                 user_interface.bar( (<span class="keywordtype">int</span>)(currX-0.5*barWidth),currY,
00532                                     (<span class="keywordtype">int</span>)(currX+0.5*barWidth)-<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>, series_y2-<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>,
00533                                     vga_back.translate_color(series_color[i]));
00534 
00535             dataArray++;
00536         }
00537     }
00538 
00539     <span class="comment">//  dataArray = (char*)data_array;</span>
00540     dataArray = (<span class="keywordtype">int</span>*)data_array;
00541     <span class="keywordflow">if</span> (value_flag)
00542         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num; i++) {
00543             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; *data_num; j++) {
00544                 currX = series_x1 + (j+1)*x_axis_step + i*barWidth;
00545 
00546                 <span class="keywordflow">if</span> (x_axis_pos)
00547                     currY = series_y2 - (((int)(*dataArray)+int(max_scale)) * (series_y2-series_y1) / int(max_scale*2));
00548                 <span class="keywordflow">else</span>
00549                     currY = series_y2 - (int)(*dataArray) * (series_y2-series_y1) / int(max_scale);
00550 
00551                 draw_value(dataArray, <a class="code" href="COLOR_8H.html#a15">V_BLACK</a>,  currX+<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>, currY-font_ptr-&gt;max_font_height/2, DATA_INT);
00552 
00553                 dataArray++;
00554             }
00555         }
00556 
00557 }
00558 
00559 <span class="comment">//------------ End of function GraphDoubleBar::draw_series_int ------------//</span>
00560 
00561 <span class="comment">//---------- Begin of function GraphDoubleBar::draw_series_long ------------//</span>
00563 <span class="comment">void GraphDoubleBar::draw_series_long() {</span>
00564     <span class="keywordtype">long</span> *dataArray = (<span class="keywordtype">long</span> *) data_array;
00565     <span class="keywordtype">short</span> currX, currY;
00566     <span class="keywordtype">int</span> barWidth = x_axis_step/(series_num+2);
00567 
00568     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num; i++) {
00569 
00570         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; *data_num; j++) {
00571             currX = series_x1 + (j+1)*x_axis_step + i*barWidth;
00572 
00573             <span class="keywordflow">if</span> (x_axis_pos)
00574                 currY = series_y2 - short(((*dataArray+<span class="keywordtype">long</span>(max_scale)) * <span class="keywordtype">long</span>(series_y2-series_y1) / <span class="keywordtype">long</span>(max_scale*2)));
00575             <span class="keywordflow">else</span>
00576                 currY = series_y2 - short(*dataArray * <span class="keywordtype">long</span>(series_y2-series_y1) / <span class="keywordtype">long</span>(max_scale));
00577 
00578             user_interface.bar( (<span class="keywordtype">int</span>)(currX-0.5*barWidth), currY,
00579                                 (<span class="keywordtype">int</span>)(currX+0.5*barWidth)-<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>, series_y2-<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>,
00580                                 vga_back.translate_color(series_color[i]));
00581 
00582             dataArray++;
00583         }
00584 
00585     }
00586     dataArray = (<span class="keywordtype">long</span> *) data_array;
00587     <span class="keywordflow">if</span> (value_flag)
00588         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; series_num; i++) {
00589             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; *data_num; j++) {
00590                 currX = series_x1 + (j+1)*x_axis_step + i*barWidth;
00591 
00592                 <span class="keywordflow">if</span> (x_axis_pos)
00593                     currY = series_y2 - short(((*dataArray+<span class="keywordtype">long</span>(max_scale)) * <span class="keywordtype">long</span>(series_y2-series_y1) / <span class="keywordtype">long</span>(max_scale*2)));
00594                 <span class="keywordflow">else</span>
00595                     currY = series_y2 - short(*dataArray * <span class="keywordtype">long</span>(series_y2-series_y1) / <span class="keywordtype">long</span>(max_scale));
00596 
00597                 draw_value(dataArray, <a class="code" href="COLOR_8H.html#a15">V_BLACK</a>,  currX+<a class="code" href="OGRPDBAR_8CPP.html#a10a7">COMMON_OFFSET</a>, currY-font_ptr-&gt;max_font_height/2, DATA_INT);
00598 
00599                 dataArray++;
00600             }
00601         }
00602 
00603 }
00604 
00605 <span class="comment">//------------ End of function GraphDoubleBar::draw_series_long ------------//</span>
00606 
00607 <span class="comment">//---------- Begin of function GraphDoubleBar::draw_value -------------------//</span>
00609 <span class="comment">void GraphDoubleBar::draw_value(void *value, int color, short x, short y, int dataType) {</span>
00610     <span class="keywordtype">char</span> *valueString;
00611     <span class="keywordflow">switch</span> (data_type_flag) {
00612     <span class="keywordflow">case</span> DATA_FLOAT:
00613         valueString = m.format(*((<span class="keywordtype">float</span> *) value), num_format); <span class="keywordflow">break</span>;
00614     <span class="keywordflow">case</span> DATA_DOUBLE:
00615         valueString = m.format(*((<span class="keywordtype">double</span> *) value), num_format); <span class="keywordflow">break</span>;
00616     <span class="keywordflow">case</span> DATA_INT:
00617         valueString = m.format(*((<span class="keywordtype">int</span> *) value), num_format); <span class="keywordflow">break</span>;
00618     <span class="keywordflow">case</span> DATA_LONG:
00619         valueString = m.format(*((<span class="keywordtype">long</span> *) value), num_format); <span class="keywordflow">break</span>;
00620     }
00621 
00622     <span class="keywordtype">short</span> textHeight = font_ptr-&gt;max_font_height;
00623     <span class="keywordtype">short</span> textWidth = font_ptr-&gt;text_width(valueString) + 1;
00624 
00625     <span class="comment">/*  </span>
00626 <span class="comment">        short *bitmap = (short *) sys.common_data_buf;</span>
00627 <span class="comment">        err_when( (2 + textWidth * textHeight) * sizeof(short) &gt; COMMON_DATA_BUF_SIZE );</span>
00628 <span class="comment">        *bitmap++ = textWidth;</span>
00629 <span class="comment">        *bitmap++ = textHeight;</span>
00630 <span class="comment"></span>
00631 <span class="comment">        short *shortPtr = bitmap;</span>
00632 <span class="comment">        for (int i = 0; i &lt; textWidth * textHeight; i++)</span>
00633 <span class="comment">        *shortPtr++ = transparent_code_w;</span>
00634 <span class="comment"></span>
00635 <span class="comment">        font_ptr-&gt;put_to_bufferW(bitmap, textWidth * sizeof(short), 0, 0, valueString);</span>
00636 <span class="comment"></span>
00637 <span class="comment">        shortPtr = bitmap;</span>
00638 <span class="comment">        for (i = 0; i &lt; textWidth * textHeight; i++, shortPtr++)</span>
00639 <span class="comment">        if (*shortPtr != transparent_code_w)</span>
00640 <span class="comment">        *shortPtr = color;</span>
00641 <span class="comment"></span>
00642 <span class="comment">        vga_back.put_bitmapW_trans(x, y, (short *) sys.common_data_buf);</span>
00643 <span class="comment">    */</span>
00644     font_chartsm.put(x+3,y,valueString);
00645 }
00646 
00647 <span class="comment">//---------- Begin of function GraphDoubleBar::draw_value -------------------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:49 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
