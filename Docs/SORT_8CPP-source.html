<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SORT.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>SORT.CPP</h1><a href="SORT_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Owner: Fred</span>
00002 <span class="comment">//$$ sort.cpp                            Sorting</span>
00003 
00004 <span class="comment">// Copyright (C) 1991,2,3,4: R B Davies</span>
00005 
<a name="l00006"></a><a class="code" href="SORT_8CPP.html#a0">00006</a> <span class="preprocessor">#define WANT_MATH</span>
00007 <span class="preprocessor"></span>
00008 <span class="preprocessor">#include "include.h"</span>
00009 
00010 <span class="preprocessor">#include "newmatap.h"</span>
00011 
00012 <span class="preprocessor">#ifdef use_namespace</span>
00013 <span class="preprocessor"></span><span class="keyword">namespace </span>NEWMAT {
00014 <span class="preprocessor">#endif</span>
00015 <span class="preprocessor"></span>
00016     <span class="comment">/******************************** Quick sort ********************************/</span>
00017 
00018     <span class="comment">// Quicksort.</span>
00019     <span class="comment">// Essentially the method described in Sedgewick's algorithms in C++</span>
00020     <span class="comment">// My version is still partially recursive, unlike Segewick's, but the</span>
00021     <span class="comment">// smallest segment of each split is used in the recursion, so it should</span>
00022     <span class="comment">// not overlead the stack.</span>
00023 
00024     <span class="comment">// If the process does not seems to be converging an exception is thrown.</span>
00025 
<a name="l00026"></a><a class="code" href="SORT_8CPP.html#a1">00026</a> <span class="preprocessor">#define DoSimpleSort 17                         // when to switch to insert sort</span>
<a name="l00027"></a><a class="code" href="SORT_8CPP.html#a2">00027</a> <span class="preprocessor"></span><span class="preprocessor">#define MaxDepth 50                             // maximum recursion depth</span>
00028 <span class="preprocessor"></span>
00029     <span class="keyword">static</span> <span class="keywordtype">void</span> MyQuickSortDescending(<a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* first, <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* last, <span class="keywordtype">int</span> depth);
00030     <span class="keyword">static</span> <span class="keywordtype">void</span> InsertionSortDescending(<a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* first, <span class="keyword">const</span> <span class="keywordtype">int</span> length,
00031                                         <span class="keywordtype">int</span> guard);
00032     <span class="keyword">static</span> <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> SortThreeDescending(<a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* a, <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* b, <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* c);
00033 
00034     <span class="keyword">static</span> <span class="keywordtype">void</span> MyQuickSortAscending(<a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* first, <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* last, <span class="keywordtype">int</span> depth);
00035     <span class="keyword">static</span> <span class="keywordtype">void</span> InsertionSortAscending(<a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* first, <span class="keyword">const</span> <span class="keywordtype">int</span> length,
00036                                        <span class="keywordtype">int</span> guard);
00037 
<a name="l00038"></a><a class="code" href="namespaceNEWMAT.html#a84">00038</a>     <span class="keywordtype">void</span> <a class="code" href="namespaceNEWMAT.html#a84">SortDescending</a>(<a class="code" href="classNEWMAT_1_1GeneralMatrix.html">GeneralMatrix</a>&amp; GM) {
00039 
00040         <a class="code" href="classTracer.html">Tracer</a> et(<span class="stringliteral">"QuickSortDescending"</span>);
00041 
00042         <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* data = GM.<a class="code" href="classNEWMAT_1_1GeneralMatrix.html#a5">Store</a>(); <span class="keywordtype">int</span> max = GM.<a class="code" href="classNEWMAT_1_1GeneralMatrix.html#a4">Storage</a>();
00043 
00044         <span class="keywordflow">if</span> (max &gt; <a class="code" href="SORT_8CPP.html#a1">DoSimpleSort</a>) MyQuickSortDescending(data, data + max - 1, 0);
00045         InsertionSortDescending(data, max, <a class="code" href="SORT_8CPP.html#a1">DoSimpleSort</a>);
00046 
00047     }
00048 
00049     <span class="keyword">static</span> <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> SortThreeDescending(<a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* a, <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* b, <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* c) {
00050         <span class="comment">// sort *a, *b, *c; return *b; optimise for already sorted</span>
00051         <span class="keywordflow">if</span> (*a &gt;= *b) {
00052             <span class="keywordflow">if</span> (*b &gt;= *c) <span class="keywordflow">return</span> *b;
00053             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*a &gt;= *c) { <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> x = *c; *c = *b; *b = x; <span class="keywordflow">return</span> x; }
00054             <span class="keywordflow">else</span> { <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> x = *a; *a = *c; *c = *b; *b = x; <span class="keywordflow">return</span> x; }
00055         }
00056         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*c &gt;= *b) { <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> x = *c; *c = *a; *a = x; <span class="keywordflow">return</span> *b; }
00057         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*a &gt;= *c) { <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> x = *a; *a = *b; *b = x; <span class="keywordflow">return</span> x; }
00058         <span class="keywordflow">else</span> { <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> x = *c; *c = *a; *a = *b; *b = x; <span class="keywordflow">return</span> x; }
00059     }
00060 
00061     <span class="keyword">static</span> <span class="keywordtype">void</span> InsertionSortDescending(<a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* first, <span class="keyword">const</span> <span class="keywordtype">int</span> length,
00062                                         <span class="keywordtype">int</span> guard) {
00063         <span class="comment">// guard gives the length of the sequence to scan to find first</span>
00064         <span class="comment">// element (eg = length)</span>
00065         <span class="keywordflow">if</span> (length &lt;= 1) <span class="keywordflow">return</span>;
00066 
00067         <span class="comment">// scan for first element</span>
00068         <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* f = first; <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> v = *f; <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* h = f;
00069         <span class="keywordflow">if</span> (guard &gt; length) guard = length; <span class="keywordtype">int</span> i = guard - 1;
00070         <span class="keywordflow">while</span> (i--) <span class="keywordflow">if</span> (v &lt; *(++f)) { v = *f; h = f; }
00071         *h = *first; *first = v;
00072 
00073         <span class="comment">// do the sort</span>
00074         i = length - 1; f = first;
00075         <span class="keywordflow">while</span> (i--) {
00076             <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* g = f++; h = f; v = *h;
00077             <span class="keywordflow">while</span> (*g &lt; v) *h-- = *g--;
00078             *h = v;
00079         }
00080     }
00081 
00082     <span class="keyword">static</span> <span class="keywordtype">void</span> MyQuickSortDescending(<a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* first, <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* last, <span class="keywordtype">int</span> depth) {
00083         <span class="keywordflow">for</span> (;;) {
00084             <span class="keyword">const</span> <span class="keywordtype">int</span> length = last - first + 1;
00085             <span class="keywordflow">if</span> (length &lt; <a class="code" href="SORT_8CPP.html#a1">DoSimpleSort</a>) <span class="keywordflow">return</span>;
00086             <span class="keywordflow">if</span> (depth++ &gt; <a class="code" href="SORT_8CPP.html#a2">MaxDepth</a>)
00087                 Throw(ConvergenceException(<span class="stringliteral">"QuickSortDescending fails: "</span>));
00088             <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* centre = first + length/2;
00089             <span class="keyword">const</span> <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> <a class="code" href="OTEST_8H.html#a0">test</a> = SortThreeDescending(first, centre, last);
00090             <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* f = first; <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* l = last;
00091             <span class="keywordflow">for</span> (;;) {
00092                 <span class="keywordflow">while</span> (*(++f) &gt; <a class="code" href="OTEST_8H.html#a0">test</a>) {}
00093                 <span class="keywordflow">while</span> (*(--l) &lt; <a class="code" href="OTEST_8H.html#a0">test</a>) {}
00094                 <span class="keywordflow">if</span> (l &lt;= f) <span class="keywordflow">break</span>;
00095                 <span class="keyword">const</span> <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> temp = *f; *f = *l; *l = temp;
00096             }
00097             <span class="keywordflow">if</span> (f &gt; centre) { MyQuickSortDescending(l+1, last, depth); last = f-1; }
00098             <span class="keywordflow">else</span> { MyQuickSortDescending(first, f-1, depth); first = l+1; }
00099         }
00100     }
00101 
<a name="l00102"></a><a class="code" href="namespaceNEWMAT.html#a85">00102</a>     <span class="keywordtype">void</span> <a class="code" href="namespaceNEWMAT.html#a85">SortAscending</a>(<a class="code" href="classNEWMAT_1_1GeneralMatrix.html">GeneralMatrix</a>&amp; GM) {
00103 
00104         <a class="code" href="classTracer.html">Tracer</a> et(<span class="stringliteral">"QuickSortAscending"</span>);
00105 
00106         <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* data = GM.<a class="code" href="classNEWMAT_1_1GeneralMatrix.html#a5">Store</a>(); <span class="keywordtype">int</span> max = GM.<a class="code" href="classNEWMAT_1_1GeneralMatrix.html#a4">Storage</a>();
00107 
00108         <span class="keywordflow">if</span> (max &gt; <a class="code" href="SORT_8CPP.html#a1">DoSimpleSort</a>) MyQuickSortAscending(data, data + max - 1, 0);
00109         InsertionSortAscending(data, max, <a class="code" href="SORT_8CPP.html#a1">DoSimpleSort</a>);
00110 
00111     }
00112 
00113     <span class="keyword">static</span> <span class="keywordtype">void</span> InsertionSortAscending(<a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* first, <span class="keyword">const</span> <span class="keywordtype">int</span> length,
00114                                        <span class="keywordtype">int</span> guard) {
00115         <span class="comment">// guard gives the length of the sequence to scan to find first</span>
00116         <span class="comment">// element (eg guard = length)</span>
00117         <span class="keywordflow">if</span> (length &lt;= 1) <span class="keywordflow">return</span>;
00118 
00119         <span class="comment">// scan for first element</span>
00120         <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* f = first; <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> v = *f; <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* h = f;
00121         <span class="keywordflow">if</span> (guard &gt; length) guard = length; <span class="keywordtype">int</span> i = guard - 1;
00122         <span class="keywordflow">while</span> (i--) <span class="keywordflow">if</span> (v &gt; *(++f)) { v = *f; h = f; }
00123         *h = *first; *first = v;
00124 
00125         <span class="comment">// do the sort</span>
00126         i = length - 1; f = first;
00127         <span class="keywordflow">while</span> (i--) {
00128             <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* g = f++; h = f; v = *h;
00129             <span class="keywordflow">while</span> (*g &gt; v) *h-- = *g--;
00130             *h = v;
00131         }
00132     }
00133     <span class="keyword">static</span> <span class="keywordtype">void</span> MyQuickSortAscending(<a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* first, <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* last, <span class="keywordtype">int</span> depth) {
00134         <span class="keywordflow">for</span> (;;) {
00135             <span class="keyword">const</span> <span class="keywordtype">int</span> length = last - first + 1;
00136             <span class="keywordflow">if</span> (length &lt; <a class="code" href="SORT_8CPP.html#a1">DoSimpleSort</a>) <span class="keywordflow">return</span>;
00137             <span class="keywordflow">if</span> (depth++ &gt; <a class="code" href="SORT_8CPP.html#a2">MaxDepth</a>)
00138                 Throw(ConvergenceException(<span class="stringliteral">"QuickSortAscending fails: "</span>));
00139             <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* centre = first + length/2;
00140             <span class="keyword">const</span> <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> <a class="code" href="OTEST_8H.html#a0">test</a> = SortThreeDescending(last, centre, first);
00141             <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* f = first; <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a>* l = last;
00142             <span class="keywordflow">for</span> (;;) {
00143                 <span class="keywordflow">while</span> (*(++f) &lt; <a class="code" href="OTEST_8H.html#a0">test</a>) {}
00144                 <span class="keywordflow">while</span> (*(--l) &gt; <a class="code" href="OTEST_8H.html#a0">test</a>) {}
00145                 <span class="keywordflow">if</span> (l &lt;= f) <span class="keywordflow">break</span>;
00146                 <span class="keyword">const</span> <a class="code" href="namespaceRBD__COMMON.html#a0">Real</a> temp = *f; *f = *l; *l = temp;
00147             }
00148             <span class="keywordflow">if</span> (f &gt; centre) { MyQuickSortAscending(l+1, last, depth); last = f-1; }
00149             <span class="keywordflow">else</span> { MyQuickSortAscending(first, f-1, depth); first = l+1; }
00150         }
00151     }
00152 
00153 <span class="preprocessor">#ifdef use_namespace</span>
00154 <span class="preprocessor"></span>}
00155 <span class="preprocessor">#endif</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:37 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
