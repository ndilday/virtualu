<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Odepa_pi.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Odepa_pi.cpp</h1><a href="Odepa__pi_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : ODEPT_P.CPP</span>
00002 <span class="comment">//Description : Functions for calculating departmental performance indicators</span>
00003 <span class="comment">//Owner       : Fred</span>
00004 
00005 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00006 
00007 <span class="preprocessor">#include &lt;ODEPT.H&gt;</span>
00008 <span class="preprocessor">#include &lt;OMATH.H&gt;</span>
00009 <span class="preprocessor">#include &lt;OFINANCE.H&gt;</span>
00010 <span class="preprocessor">#include &lt;<a class="code" href="ODEPTRES_8H.html">ODEPTRES.H</a>&gt;</span>
00011 <span class="preprocessor">#include &lt;<a class="code" href="OSCHLRES_8H.html">OSCHLRES.H</a>&gt;</span>
00012 <span class="preprocessor">#include &lt;OPSCHOOL.H&gt;</span>
00013 
00014 <span class="preprocessor">#ifdef DEBUG</span>
00015 <span class="preprocessor"></span><span class="preprocessor">#include &lt;STDIO.H&gt;</span>
00016 <span class="preprocessor">#include &lt;<a class="code" href="OLOG_8H.html">OLOG.H</a>&gt;</span>
00017 <span class="preprocessor">#endif</span>
00018 <span class="preprocessor"></span>
00019 <span class="comment">//------ Begin of function sort_function_faculty_research ------//</span>
00023 <span class="comment">static int sort_function_faculty_research( const void *a, const void *b ) {</span>
00024     <span class="keywordtype">float</span> valA = department_array[(*((<span class="keywordtype">short</span>*)a))]-&gt;p_faculty_research_history[THIS_MONTH];
00025     <span class="keywordtype">float</span> valB = department_array[(*((<span class="keywordtype">short</span>*)b))]-&gt;p_faculty_research_history[THIS_MONTH];
00026 
00027     <span class="keywordtype">float</span> rc = valA-valB;
00028 
00029     <span class="keywordflow">if</span>( rc &gt; 0 )
00030         <span class="keywordflow">return</span> -1;
00031     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( rc &lt; 0 )
00032         <span class="keywordflow">return</span> 1;
00033     <span class="keywordflow">else</span>
00034         <span class="keywordflow">return</span> 0;
00035 }
00036 
00037 <span class="comment">//------- End of function sort_function_faculty_research ------//</span>
00038 
00039 <span class="comment">//------ Begin of function sort_function_faculty_morale ------//</span>
00043 <span class="comment">static int sort_function_faculty_morale( const void *a, const void *b ) {</span>
00044     <span class="keywordtype">float</span> valA = department_array[(*((<span class="keywordtype">short</span>*)a))]-&gt;p_faculty_morale_history[THIS_MONTH];
00045     <span class="keywordtype">float</span> valB = department_array[(*((<span class="keywordtype">short</span>*)b))]-&gt;p_faculty_morale_history[THIS_MONTH];
00046 
00047     <span class="keywordtype">float</span> rc = valA-valB;
00048 
00049     <span class="keywordflow">if</span>( rc &gt; 0 )
00050         <span class="keywordflow">return</span> -1;
00051     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( rc &lt; 0 )
00052         <span class="keywordflow">return</span> 1;
00053     <span class="keywordflow">else</span>
00054         <span class="keywordflow">return</span> 0;
00055 }
00056 
00057 <span class="comment">//------- End of function sort_function_faculty_morale ------//</span>
00058 
00059 <span class="comment">//------ Begin of function sort_function_educational_quality ------//</span>
00063 <span class="comment">static int sort_function_educational_quality( const void *a, const void *b ) {</span>
00064     <span class="keywordtype">float</span> valA = department_array[(*((<span class="keywordtype">short</span>*)a))]-&gt;p_educational_quality_history[THIS_TRIMESTER];
00065     <span class="keywordtype">float</span> valB = department_array[(*((<span class="keywordtype">short</span>*)b))]-&gt;p_educational_quality_history[THIS_TRIMESTER];
00066 
00067     <span class="keywordtype">float</span> rc = valA-valB;
00068 
00069     <span class="keywordflow">if</span>( rc &gt; 0 )
00070         <span class="keywordflow">return</span> -1;
00071     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( rc &lt; 0 )
00072         <span class="keywordflow">return</span> 1;
00073     <span class="keywordflow">else</span>
00074         <span class="keywordflow">return</span> 0;
00075 }
00076 
00077 <span class="comment">//------- End of function sort_function_educational_quality ------//</span>
00078 
00079 <span class="comment">//------ Begin of function sort_function_student_morale ------//</span>
00083 <span class="comment">static int sort_function_student_morale( const void *a, const void *b ) {</span>
00084     <span class="keywordtype">float</span> valA = department_array[(*((<span class="keywordtype">short</span>*)a))]-&gt;p_student_morale_history[THIS_TRIMESTER];
00085     <span class="keywordtype">float</span> valB = department_array[(*((<span class="keywordtype">short</span>*)b))]-&gt;p_student_morale_history[THIS_TRIMESTER];
00086 
00087     <span class="keywordtype">float</span> rc = valA-valB;
00088 
00089     <span class="keywordflow">if</span>( rc &gt; 0 )
00090         <span class="keywordflow">return</span> -1;
00091     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( rc &lt; 0 )
00092         <span class="keywordflow">return</span> 1;
00093     <span class="keywordflow">else</span>
00094         <span class="keywordflow">return</span> 0;
00095 }
00096 
00097 <span class="comment">//------- End of function sort_function_student_morale ------//</span>
00098 
00099 <span class="comment">//------ Begin of function sort_function_academic_standing ------//</span>
00103 <span class="comment">static int sort_function_academic_standing( const void *a, const void *b ) {</span>
00104     <span class="keywordtype">float</span> valA = department_array[(*((<span class="keywordtype">short</span>*)a))]-&gt;p_academic_standing_history[THIS_YEAR];
00105     <span class="keywordtype">float</span> valB = department_array[(*((<span class="keywordtype">short</span>*)b))]-&gt;p_academic_standing_history[THIS_YEAR];
00106 
00107     <span class="keywordtype">float</span> rc = valA-valB;
00108 
00109     <span class="keywordflow">if</span>( rc &gt; 0 )
00110         <span class="keywordflow">return</span> -1;
00111     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( rc &lt; 0 )
00112         <span class="keywordflow">return</span> 1;
00113     <span class="keywordflow">else</span>
00114         <span class="keywordflow">return</span> 0;
00115 }
00116 
00117 <span class="comment">//------- End of function sort_function_academic_standing ------//</span>
00118 
00119 <span class="comment">//------ Begin of function sort_function_faculty_diversity ------//</span>
00123 <span class="comment">static int sort_function_faculty_diversity( const void *a, const void *b ) {</span>
00124     <span class="keywordtype">float</span> valA = department_array[(*((<span class="keywordtype">short</span>*)a))]-&gt;p_faculty_diversity_history[THIS_YEAR];
00125     <span class="keywordtype">float</span> valB = department_array[(*((<span class="keywordtype">short</span>*)b))]-&gt;p_faculty_diversity_history[THIS_YEAR];
00126 
00127     <span class="keywordtype">float</span> rc = valA-valB;
00128 
00129     <span class="keywordflow">if</span>( rc &gt; 0 )
00130         <span class="keywordflow">return</span> -1;
00131     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( rc &lt; 0 )
00132         <span class="keywordflow">return</span> 1;
00133     <span class="keywordflow">else</span>
00134         <span class="keywordflow">return</span> 0;
00135 }
00136 
00137 <span class="comment">//------- End of function sort_function_faculty_diversity ------//</span>
00138 
00139 <span class="comment">//---------- Begin of function DepartmentArray::update_history -----------//</span>
<a name="l00141"></a><a class="code" href="classDepartmentArray.html#a18">00141</a> <span class="comment">void DepartmentArray::update_history(char update_flag) {</span>
00142     <span class="keywordtype">int</span> i,j;
00143     <span class="keywordtype">int</span> totalFacCount = 0;
00144     <span class="keywordtype">int</span> totalStuCount = 0;
00145 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00146 <span class="preprocessor"></span>    <span class="keywordtype">int</span> totalRegularFacCount = 0;
00147 <span class="preprocessor">#endif</span>
00148 <span class="preprocessor"></span>    <a class="code" href="classDepartment.html">Department</a>* deptPtr;
00149 
00150     <span class="keywordflow">switch</span> (update_flag) {
00151     <span class="keywordflow">case</span> UPDATE_MONTH:
00152 
00153         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(p_faculty_research_history, HISTORY_MONTH_COUNT);
00154         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(p_faculty_morale_history, HISTORY_MONTH_COUNT);
00155         p_faculty_research_history[THIS_MONTH] = 0;
00156         p_faculty_morale_history[THIS_MONTH] = 0;
00157 
00158         totalFacCount = 0;
00159 
00160         <span class="keywordflow">for</span> ( i=size(); i&gt;0; i-- ) {
00161             <span class="keywordflow">if</span> ( is_deleted(i) )
00162                 <span class="keywordflow">continue</span>;
00163 
00164             deptPtr = department_array[i];
00165 
00166             <span class="keywordtype">int</span> facCount = deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#m1">faculty_count</a>;
00167 
00168             p_faculty_research_history[THIS_MONTH] += deptPtr-&gt;<a class="code" href="classDepartment.html#m55">p_faculty_research_history</a>[THIS_MONTH] * facCount;
00169             p_faculty_morale_history[THIS_MONTH] += deptPtr-&gt;<a class="code" href="classDepartment.html#m56">p_faculty_morale_history</a>[THIS_MONTH] * facCount;
00170 
00171             totalFacCount += facCount;
00172 
00173             sys.yield();
00174         }
00175 
00176         <a class="code" href="ALL_8H.html#a0">err_when</a>(totalFacCount == 0);
00177 
00178         p_faculty_research_history[THIS_MONTH] /= totalFacCount;
00179         p_faculty_morale_history[THIS_MONTH] /= totalFacCount;
00180 
00181         <span class="comment">//------//</span>
00182 
00183         <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Odept_8h.html#a19a16">RESEARCH_STATUS_COUNT</a>; i++)
00184             <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(research_m_history[i], HISTORY_MONTH_COUNT);
00185 
00186         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(research_total_history, HISTORY_MONTH_COUNT);
00187         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(research_direct_history, HISTORY_MONTH_COUNT);
00188         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(regular_faculty_with_research, HISTORY_MONTH_COUNT);
00189 
00190         calc_research_history();                    <span class="comment">// 1217</span>
00191         <span class="keywordflow">break</span>;
00192 
00193     <span class="keywordflow">case</span> UPDATE_TRIMESTER:
00194         calc_course_history();
00195 
00196         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(p_educational_quality_history, HISTORY_TRIMESTER_COUNT);
00197         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(p_student_morale_history, HISTORY_TRIMESTER_COUNT);
00198 
00199         p_educational_quality_history[THIS_TRIMESTER] = 0;
00200         p_student_morale_history[THIS_TRIMESTER] = 0;
00201 
00202         totalFacCount = 0;
00203         totalStuCount = 0;
00204 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00205 <span class="preprocessor"></span>        totalRegularFacCount = 0;
00206 <span class="preprocessor">#endif</span>
00207 <span class="preprocessor"></span>
00208         <span class="keywordflow">for</span> ( i=size(); i&gt;0; i-- ) {
00209             <span class="keywordflow">if</span> ( is_deleted(i) )
00210                 <span class="keywordflow">continue</span>;
00211 
00212             deptPtr = department_array[i];
00213 
00214             <span class="keywordtype">int</span> facCount = deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#m1">faculty_count</a>;
00215             <span class="keywordtype">int</span> stuCount = deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#m1">student_count</a>;
00216 
00217             p_educational_quality_history[THIS_TRIMESTER] += deptPtr-&gt;<a class="code" href="classDepartment.html#m52">p_educational_quality_history</a>[THIS_TRIMESTER] * facCount;
00218             p_student_morale_history[THIS_TRIMESTER] += deptPtr-&gt;<a class="code" href="classDepartment.html#m54">p_student_morale_history</a>[THIS_TRIMESTER] * stuCount;
00219 
00220             totalFacCount += facCount;
00221             totalStuCount += stuCount;
00222 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00223 <span class="preprocessor"></span>            totalRegularFacCount += deptPtr-&gt;<a class="code" href="classDepartment.html#m9">regular_faculty_count</a>;
00224 <span class="preprocessor">#endif</span>
00225 <span class="preprocessor"></span>
00226             <span class="comment">// sys.yield();</span>
00227         }
00228         sys.yield();
00229 
00230         <a class="code" href="ALL_8H.html#a0">err_when</a>(totalFacCount == 0);
00231         <a class="code" href="ALL_8H.html#a0">err_when</a>(totalStuCount == 0);
00232 
00233         p_educational_quality_history[THIS_TRIMESTER] /= totalFacCount;
00234         p_student_morale_history[THIS_TRIMESTER] /= totalStuCount;
00235 
00236         <span class="comment">//------//</span>
00237         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(teaching_contact_hour, HISTORY_TRIMESTER_COUNT);
00238         <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Ofaculty_8h.html#a30a21">DISCRETIONARY_TYPE_COUNT_N_TOTAL</a>; i++)
00239             <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(discretionary_hour_array[i], HISTORY_TRIMESTER_COUNT);
00240 
00241         <span class="comment">//discretionary_hour_array[i][THIS_TRIMESTER];</span>
00242         <span class="comment">//teaching_contact_hour[THIS_TRIMESTER]=0; // chwg0602</span>
00243 
00244         <span class="comment">//------//</span>
00245         <span class="keywordflow">for</span> ( i=size(); i&gt;0; i-- ) {
00246             <span class="keywordflow">if</span> ( is_deleted(i) )
00247                 <span class="keywordflow">continue</span>;
00248 
00249             deptPtr = department_array[i];
00250             <span class="keywordtype">int</span> facCount = deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#m1">faculty_count</a>;
00251 
00252             teaching_contact_hour[THIS_TRIMESTER] += deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#m10">teaching_contact_hour</a>[THIS_TRIMESTER] * facCount;
00253 
00254             <span class="comment">// 990419</span>
00255             <span class="keywordflow">for</span> (<span class="keywordtype">char</span> j=0;j&lt;<a class="code" href="Ofaculty_8h.html#a30a21">DISCRETIONARY_TYPE_COUNT_N_TOTAL</a>; j++)
00256                 discretionary_hour_array[j][THIS_TRIMESTER] += deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#m11">discretionary_hour_array</a>[j][THIS_TRIMESTER] * facCount;
00257 
00258 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00259 <span class="preprocessor"></span>            time_shifted_scholarship += deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.time_shifted_scholarship*facCount;;
00260 <span class="preprocessor">#endif</span>
00261 <span class="preprocessor"></span>        }
00262 
00263         teaching_contact_hour[THIS_TRIMESTER] /= totalFacCount;
00264 
00265         <span class="keywordflow">for</span> (j=0;j&lt;<a class="code" href="Ofaculty_8h.html#a30a21">DISCRETIONARY_TYPE_COUNT_N_TOTAL</a>; j++)
00266             discretionary_hour_array[j][THIS_TRIMESTER] /= totalFacCount;
00267 
00268 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00269 <span class="preprocessor"></span>        time_shifted_scholarship /= totalFacCount;
00270 <span class="preprocessor">#endif</span>
00271 <span class="preprocessor"></span>
00272         <span class="comment">//----- pi 980929 --------------------//</span>
00273         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(talent_teaching, HISTORY_TRIMESTER_COUNT);
00274         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(talent_scholarship, HISTORY_TRIMESTER_COUNT);
00275         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(talent_research, HISTORY_TRIMESTER_COUNT);
00276         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(performance_teaching, HISTORY_TRIMESTER_COUNT);
00277         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(performance_scholarship, HISTORY_TRIMESTER_COUNT);
00278         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(performance_research, HISTORY_TRIMESTER_COUNT);
00279 
00280         <span class="keywordflow">for</span> ( i=size(); i&gt;0; i-- ) {
00281             <span class="keywordflow">if</span> ( is_deleted(i) )
00282                 <span class="keywordflow">continue</span>;
00283 
00284             deptPtr = department_array[i];
00285             <span class="keywordtype">int</span> facCount = deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#m1">faculty_count</a>;
00286 
00287 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00288 <span class="preprocessor"></span>            <span class="keywordtype">int</span> regularFacCount = deptPtr-&gt;<a class="code" href="classDepartment.html#m9">regular_faculty_count</a>;
00289 
00290             talent_teaching[THIS_TRIMESTER] += deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#m2">talent_teaching</a>[THIS_TRIMESTER] * regularFacCount;
00291             talent_scholarship[THIS_TRIMESTER] += deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#m3">talent_scholarship</a>[THIS_TRIMESTER] * regularFacCount;
00292             talent_research[THIS_TRIMESTER] += deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#m4">talent_research</a>[THIS_TRIMESTER] * regularFacCount;
00293             performance_teaching[THIS_TRIMESTER] += deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#m5">performance_teaching</a>[THIS_TRIMESTER] * regularFacCount;
00294             performance_scholarship[THIS_TRIMESTER] += deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#m6">performance_scholarship</a>[THIS_TRIMESTER] * regularFacCount;
00295             performance_research[THIS_TRIMESTER] += deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#m7">performance_research</a>[THIS_TRIMESTER] * regularFacCount;
00296 <span class="preprocessor">#else</span>
00297 <span class="preprocessor"></span>            talent_teaching[THIS_TRIMESTER] += deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#m2">talent_teaching</a>[THIS_TRIMESTER] * facCount;
00298             talent_scholarship[THIS_TRIMESTER] += deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#m3">talent_scholarship</a>[THIS_TRIMESTER] * facCount;
00299             talent_research[THIS_TRIMESTER] += deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#m4">talent_research</a>[THIS_TRIMESTER] * facCount;
00300             performance_teaching[THIS_TRIMESTER] += deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#m5">performance_teaching</a>[THIS_TRIMESTER] * facCount;
00301             performance_scholarship[THIS_TRIMESTER] += deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#m6">performance_scholarship</a>[THIS_TRIMESTER] * facCount;
00302             performance_research[THIS_TRIMESTER] += deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#m7">performance_research</a>[THIS_TRIMESTER] * facCount;
00303 <span class="preprocessor">#endif</span>
00304 <span class="preprocessor"></span>
00305             <span class="comment">// sys.yield();</span>
00306         }
00307         sys.yield();
00308 
00309 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00310 <span class="preprocessor"></span>        talent_teaching[THIS_TRIMESTER] = math.safe_divide( talent_teaching[THIS_TRIMESTER], (<span class="keywordtype">float</span>)totalRegularFacCount );
00311         talent_scholarship[THIS_TRIMESTER] = math.safe_divide( talent_scholarship[THIS_TRIMESTER], (<span class="keywordtype">float</span>)totalRegularFacCount );
00312         talent_research[THIS_TRIMESTER] = math.safe_divide( talent_research[THIS_TRIMESTER], (<span class="keywordtype">float</span>)totalRegularFacCount );
00313         performance_teaching[THIS_TRIMESTER] = math.safe_divide( performance_teaching[THIS_TRIMESTER], (<span class="keywordtype">float</span>)totalRegularFacCount );
00314         performance_scholarship[THIS_TRIMESTER] = math.safe_divide( performance_scholarship[THIS_TRIMESTER], (<span class="keywordtype">float</span>)totalRegularFacCount );
00315         performance_research[THIS_TRIMESTER] = math.safe_divide( performance_research[THIS_TRIMESTER], (<span class="keywordtype">float</span>)totalRegularFacCount );
00316 <span class="preprocessor">#else</span>
00317 <span class="preprocessor"></span>        talent_teaching[THIS_TRIMESTER] /= totalFacCount;
00318         talent_scholarship[THIS_TRIMESTER] /= totalFacCount;
00319         talent_research[THIS_TRIMESTER] /= totalFacCount;
00320         performance_teaching[THIS_TRIMESTER] /= totalFacCount;
00321         performance_scholarship[THIS_TRIMESTER] /= totalFacCount;
00322         performance_research[THIS_TRIMESTER] /= totalFacCount;
00323 <span class="preprocessor">#endif</span>
00324 <span class="preprocessor"></span>
00325 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00326 <span class="preprocessor"></span>        <span class="keywordflow">for</span>( j = 0; j &lt; <a class="code" href="Ocourse_8h.html#a39a30">MAX_TEACHING_METHOD_N_TOTAL</a>; ++j ) {
00327             <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(class_section_count_history[j], HISTORY_TRIMESTER_COUNT);
00328             <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(convention_student_count_history[j], HISTORY_TRIMESTER_COUNT);
00329             <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(size_deviation_history[j], HISTORY_TRIMESTER_COUNT);
00330             <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(admission_denied_count_history[j], HISTORY_TRIMESTER_COUNT);
00331             <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(failure_count_history[j], HISTORY_TRIMESTER_COUNT);
00332 
00333 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00334 <span class="preprocessor"></span>            <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(outsourcing_credits_history[j], HISTORY_TRIMESTER_COUNT);
00335 <span class="preprocessor">#endif</span>
00336 <span class="preprocessor"></span>
00337             <span class="comment">/*</span>
00338 <span class="comment">              for ( i=size(); i&gt;0; i-- )</span>
00339 <span class="comment">              {</span>
00340 <span class="comment">              if ( is_deleted(i) )</span>
00341 <span class="comment">              continue;</span>
00342 <span class="comment"></span>
00343 <span class="comment">              deptPtr = department_array[i];</span>
00344 <span class="comment"></span>
00345 <span class="comment">              class_section_count_history[j][THIS_TRIMESTER] += deptPtr-&gt;course_array.class_section_count_history[j][THIS_TRIMESTER];</span>
00346 <span class="comment">              convention_student_count_history[j][THIS_TRIMESTER] += deptPtr-&gt;course_array.convention_student_count_history[j][THIS_TRIMESTER];</span>
00347 <span class="comment">              // BUGHERE : don't use size_deviation_history, it is not additive</span>
00348 <span class="comment">              //size_deviation_history[j][THIS_TRIMESTER] += deptPtr-&gt;course_array.size_deviation_history[j][THIS_TRIMESTER];</span>
00349 <span class="comment">              admission_denied_count_history[j][THIS_TRIMESTER] += deptPtr-&gt;course_array.admission_denied_count_history[j][THIS_TRIMESTER];</span>
00350 <span class="comment">              // BUGHERE failure_count_history may not be reliable (prior trimester...)</span>
00351 <span class="comment">              failure_count_history[j][THIS_TRIMESTER] += deptPtr-&gt;course_array.failure_count_history[j][THIS_TRIMESTER];</span>
00352 <span class="comment">              #if(GAME_VERSION&gt;=200)</span>
00353 <span class="comment">              outsourcing_credits_history[j][THIS_TRIMESTER] += deptPtr-&gt;course_array.outsourcing_credits_history[j][THIS_TRIMESTER];</span>
00354 <span class="comment">              #endif</span>
00355 <span class="comment">              }</span>
00356 <span class="comment"></span>
00357 <span class="comment">              sys.yield();</span>
00358 <span class="comment">            */</span>
00359             <span class="comment">// fix in version 2 to get from result of the calc_course_history()</span>
00360             class_section_count_history[j][THIS_TRIMESTER] = class_section_count[j];
00361             convention_student_count_history[j][THIS_TRIMESTER] = convention_student_count[j];
00362             size_deviation_history[j][THIS_TRIMESTER] = size_deviation[j];
00363             admission_denied_count_history[j][THIS_TRIMESTER] = admission_denied_count[j];
00364             failure_count_history[j][THIS_TRIMESTER] = failure_count[j];
00365 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00366 <span class="preprocessor"></span>            outsourcing_credits_history[j][THIS_TRIMESTER] = outsourcing_credits[j];
00367 <span class="preprocessor">#endif</span>
00368 <span class="preprocessor"></span>
00369         }
00370 <span class="preprocessor">#endif</span>
00371 <span class="preprocessor"></span>
00372         <span class="keywordflow">break</span>;
00373         <span class="comment">//------//</span>
00374 
00375     <span class="keywordflow">case</span> UPDATE_YEAR:
00376         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(p_academic_standing_history, HISTORY_YEAR_COUNT);
00377         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(p_faculty_diversity_history, HISTORY_YEAR_COUNT);
00378 
00379         p_academic_standing_history[THIS_YEAR] = 0;
00380         p_faculty_diversity_history[THIS_YEAR] = 0;
00381 
00382         totalFacCount = 0;
00383 
00384         <span class="keywordflow">for</span> ( i=size(); i&gt;0; i-- ) {
00385             <span class="keywordflow">if</span> ( is_deleted(i) )
00386                 <span class="keywordflow">continue</span>;
00387 
00388             deptPtr = department_array[i];
00389 
00390             <span class="keywordtype">int</span> facCount = deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#m1">faculty_count</a>;
00391 
00392             <span class="comment">//                  p_academic_standing_history[THIS_YEAR] += deptPtr-&gt;p_academic_standing_history[THIS_YEAR] * facCount;</span>
00393             p_faculty_diversity_history[THIS_YEAR] += deptPtr-&gt;<a class="code" href="classDepartment.html#m57">p_faculty_diversity_history</a>[THIS_YEAR] * facCount;
00394 
00395             totalFacCount += facCount;
00396 
00397             sys.yield();
00398         }
00399 
00400         <a class="code" href="ALL_8H.html#a0">err_when</a>(totalFacCount ==0);
00401         p_faculty_diversity_history[THIS_YEAR] /= totalFacCount;
00402 
00403         <span class="comment">//              p_academic_standing_history[THIS_YEAR] /= totalFacCount;</span>
00404         p_academic_standing_history[THIS_YEAR] = player_school.sub_score[<a class="code" href="Opschool_8h.html#a65a39">S_PRESTIGE</a>][THIS_MONTH];
00405 
00406         <span class="comment">//------//</span>
00407 
00408         <span class="keywordflow">for</span> (i=0;i&lt;<a class="code" href="Ofaculty_8h.html#a30a22">FACULTY_RANK_LEVEL_COUNT_N_TOTAL</a>; i++)
00409             <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(faculty_level_history[i], HISTORY_YEAR_COUNT);
00410 
00411         <span class="keywordflow">for</span> (i=0;i&lt;<a class="code" href="Ostudent_8h.html#a34a12">MAX_STUDENT_LEVEL_N_TOTAL</a>; i++)
00412             <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(student_level_history[i], HISTORY_YEAR_COUNT);
00413 
00414         <span class="keywordflow">for</span> (i=0;i&lt;<a class="code" href="Gamedef_8h.html#a77a33">GENDER_ETHNIC_TYPE_COUNT_N_TOTAL</a>; i++) {
00415             <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(faculty_gender_history[i], HISTORY_YEAR_COUNT);
00416             <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(student_gender_history[i], HISTORY_YEAR_COUNT);
00417         }
00418 
00419         calc_faculty_student_history();             <span class="comment">// 0406</span>
00420 
00421 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00422 <span class="preprocessor"></span>        <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(salary_gender_ethnic_equity_history, HISTORY_YEAR_COUNT);
00423         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(salary_departmental_equity_history, HISTORY_YEAR_COUNT);
00424         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(salary_rank_equity_history, HISTORY_YEAR_COUNT);
00425 
00426         calc_salary_equity();
00427 <span class="preprocessor">#endif</span>
00428 <span class="preprocessor"></span>
00429         <span class="keywordflow">break</span>;
00430 
00431     <span class="keywordflow">case</span> UPDATE_ALL:
00432         update_history(UPDATE_MONTH);
00433         update_history(UPDATE_TRIMESTER);
00434         update_history(UPDATE_YEAR);
00435         <span class="comment">/*</span>
00436 <span class="comment">          if ( player_school.scenario_id == SCN_FACULTY_DIVERSITY )</span>
00437 <span class="comment">          {</span>
00438 <span class="comment">          totalFacCount = faculty_gender_history[GENDER_ETHNIC_TYPE_COUNT][THIS_YEAR];</span>
00439 <span class="comment">          player_school.scenario_target[0] = int(( faculty_gender_history[MINORITY_MALE][THIS_YEAR] + faculty_gender_history[MINORITY_FEMALE][THIS_YEAR]) * 100 * 1.5 / totalFacCount );                // should be 1.5 in design doc</span>
00440 <span class="comment">          player_school.scenario_target[1] = int(( faculty_gender_history[MINORITY_FEMALE][THIS_YEAR] + faculty_gender_history[NONMINORITY_FEMALE][THIS_YEAR]) * 100 * 1.25 / totalFacCount);</span>
00441 <span class="comment"></span>
00442 <span class="comment">          //## chea 270799 change to a higher target</span>
00443 <span class="comment">          //player_school.scenario_target[0] = int(( faculty_gender_history[MINORITY_MALE][THIS_YEAR] + faculty_gender_history[MINORITY_FEMALE][THIS_YEAR]) * 100 * 2.0 / totalFacCount );              // should be 1.5 in design doc</span>
00444 <span class="comment">          //player_school.scenario_target[1] = int(( faculty_gender_history[MINORITY_FEMALE][THIS_YEAR] + faculty_gender_history[NONMINORITY_FEMALE][THIS_YEAR]) * 100 * 1.75 / totalFacCount);</span>
00445 <span class="comment"></span>
00446 <span class="comment">          player_school.scenario_target[0] = min(100, player_school.scenario_target[0] );</span>
00447 <span class="comment">          player_school.scenario_target[1] = min(100, player_school.scenario_target[1] );</span>
00448 <span class="comment">          }</span>
00449 <span class="comment">        */</span>
00450         <span class="comment">// 0223; fix for interface bug</span>
00451         <span class="keywordflow">for</span> (i=THIS_MONTH-1; i&gt;=THIS_MONTH-2; i--) {
00452             research_total_history[i] = research_total_history[THIS_MONTH];
00453             research_direct_history[i] = research_direct_history[THIS_MONTH];
00454             regular_faculty_with_research[i] = regular_faculty_with_research[THIS_MONTH];
00455         }
00456         <span class="keywordflow">break</span>;
00457 
00458     <span class="keywordflow">default</span>:
00459         <a class="code" href="ALL_8H.html#a1">err_here</a>();
00460         <span class="keywordflow">break</span>;
00461     }
00462 
00463     <span class="comment">//------------//</span>
00464 
00465     p_sort_performance();
00466 }
00467 
00468 <span class="comment">//---------- End of function DepartmentArray::update_history -----------//</span>
00469 
00470 <span class="comment">//---------- Begin of function DepartmentArray::p_sort_performance -----------//</span>
<a name="l00472"></a><a class="code" href="classDepartmentArray.html#a20">00472</a> <span class="comment">void DepartmentArray::p_sort_performance() {</span>
00473     <span class="keywordtype">int</span> i, deptCount=0;
00474 
00475 <span class="preprocessor">#ifdef DEBUG</span>
00476 <span class="preprocessor"></span>    <span class="keywordflow">for</span> ( i=size(); i&gt;0; i-- ) {
00477         <span class="keywordflow">if</span> ( is_deleted(i) )
00478             <span class="keywordflow">continue</span>;
00479         deptCount++;
00480     }
00481 
00482     <a class="code" href="ALL_8H.html#a0">err_when</a>(deptCount != department_count);
00483     <a class="code" href="ALL_8H.html#a0">err_when</a>(deptCount &gt; <a class="code" href="Gamedef_8h.html#a10">MAX_DEPARTMENT</a>);
00484 <span class="preprocessor">#endif</span>
00485 <span class="preprocessor"></span>
00486     <span class="comment">//-------------------//</span>
00487 
00488     <span class="keywordflow">for</span>( i=0; i&lt;deptCount; i++ )
00489         p_educational_quality_sort[i] = i+1;
00490 
00491     qsort( p_educational_quality_sort, deptCount, <span class="keyword">sizeof</span>(p_educational_quality_sort[0]), sort_function_educational_quality );
00492 
00493     <span class="comment">//-------------------//</span>
00494 
00495     <span class="keywordflow">for</span>( i=0; i&lt;deptCount; i++ )
00496         p_academic_standing_sort[i] = i+1;
00497 
00498     qsort( p_academic_standing_sort, deptCount, <span class="keyword">sizeof</span>(p_academic_standing_sort[0]), sort_function_academic_standing );
00499 
00500     <span class="comment">//-------------------//</span>
00501 
00502     <span class="keywordflow">for</span>( i=0; i&lt;deptCount; i++ )
00503         p_student_morale_sort[i] = i+1;
00504 
00505     qsort( p_student_morale_sort, deptCount, <span class="keyword">sizeof</span>(p_student_morale_sort[0]), sort_function_student_morale );
00506 
00507     <span class="comment">//-------------------//</span>
00508 
00509     <span class="keywordflow">for</span>( i=0; i&lt;deptCount; i++ )
00510         p_faculty_research_sort[i] = i+1;
00511 
00512     qsort( p_faculty_research_sort, deptCount, <span class="keyword">sizeof</span>(p_faculty_research_sort[0]), sort_function_faculty_research );
00513 
00514     <span class="comment">//-------------------//</span>
00515 
00516     <span class="keywordflow">for</span>( i=0; i&lt;deptCount; i++ )
00517         p_faculty_morale_sort[i] = i+1;
00518 
00519     qsort( p_faculty_morale_sort, deptCount, <span class="keyword">sizeof</span>(p_faculty_morale_sort[0]), sort_function_faculty_morale );
00520 
00521     <span class="comment">//-------------------//</span>
00522 
00523     <span class="keywordflow">for</span>( i=0; i&lt;deptCount; i++ )
00524         p_faculty_diversity_sort[i] = i+1;
00525 
00526     qsort( p_faculty_diversity_sort, deptCount, <span class="keyword">sizeof</span>(p_faculty_diversity_sort[0]), sort_function_faculty_diversity );
00527 
00528     sys.yield();
00529 
00530     <span class="comment">//-------------------//</span>
00531 
00532 <span class="preprocessor">#ifdef DEBUG_SORT</span>
00533 <span class="preprocessor"></span>    <span class="keywordflow">for</span>( i=0; i&lt;deptCount; i++ ) {
00534         <span class="keywordtype">float</span> value = department_array[p_educational_quality_sort[i]]-&gt;p_educational_quality_history[THIS_TRIMESTER];
00535         <span class="keywordtype">char</span> s[300];
00536         sprintf(s, <span class="stringliteral">"A. sort %dth: %f"</span>, i, value);
00537         <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(s);
00538     }
00539 
00540     <span class="keywordflow">for</span>( i=0; i&lt;deptCount; i++ ) {
00541         <span class="keywordtype">float</span> value = department_array[p_faculty_morale_sort[i]]-&gt;p_faculty_morale_history[THIS_MONTH];
00542         <span class="keywordtype">char</span> s[300];
00543         sprintf(s, <span class="stringliteral">"B. sort %dth: %f"</span>, i, value);
00544         <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(s);
00545     }
00546 <span class="preprocessor">#endif</span>
00547 <span class="preprocessor"></span>}
00548 
00549 <span class="comment">//---------- End of function DepartmentArray::p_sort_performance -----------//</span>
00550 
00551 <span class="comment">//------- Begin of function DepartmentArray::calc_course_history -----//</span>
00552 
<a name="l00553"></a><a class="code" href="classDepartmentArray.html#a21">00553</a> <span class="keywordtype">void</span> <a class="code" href="classDepartmentArray.html#a21">DepartmentArray::calc_course_history</a>() {
00554     <span class="keywordtype">int</span> sz = <span class="keyword">sizeof</span>(class_section_count), t, i;
00555 
00556     <span class="comment">//  if (info.game_month == 1 || info.game_month == 9)  //## chea 190899</span>
00557     <span class="comment">//  {</span>
00558     memset(<a class="code" href="classDepartmentArray.html#m54">class_section_count</a>, 0, sz);
00559     memset(<a class="code" href="classDepartmentArray.html#m55">convention_student_count</a>, 0, sz);
00560     memset(<a class="code" href="classDepartmentArray.html#m56">average_class_size</a>, 0, sz);
00561     memset(<a class="code" href="classDepartmentArray.html#m57">normal_class_size</a>, 0, sz);
00562     memset(<a class="code" href="classDepartmentArray.html#m55">convention_student_count</a>, 0, sz);
00563     memset(<a class="code" href="classDepartmentArray.html#m58">size_deviation</a>, 0, sz);
00564     memset(<a class="code" href="classDepartmentArray.html#m59">admission_denied_count</a>, 0, sz);
00565     memset(<a class="code" href="classDepartmentArray.html#m60">failure_count</a>, 0, sz);
00566 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00567 <span class="preprocessor"></span>    memset(outsourcing_credits, 0, sz);
00568 <span class="preprocessor">#endif</span>
00569 <span class="preprocessor"></span>    <span class="comment">//  }</span>
00570 
00571     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(<a class="code" href="classDepartmentArray.html#m61">experienced_class_size</a>, HISTORY_TRIMESTER_COUNT);
00572     <span class="comment">//  float total = 0;</span>
00573     <span class="comment">//  int count = 0;</span>
00574 
00575     <span class="keywordflow">for</span> (i=<a class="code" href="classDynArray.html#a28">size</a>(); i&gt;0; i--) {
00576         <a class="code" href="classDepartment.html">Department</a>* deptPtr = this-&gt;<a class="code" href="classDepartmentArray.html#a13">operator[]</a>(i);
00577 
00578         <span class="keywordflow">for</span>(t=0; t&lt;<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>; t++) {
00579             <a class="code" href="classDepartmentArray.html#m54">class_section_count</a>[t] += deptPtr-&gt;<a class="code" href="classDepartment.html#m1">course_array</a>.<a class="code" href="classCourseArray.html#m2">class_section_count</a>[t];
00580             <a class="code" href="classDepartmentArray.html#m55">convention_student_count</a>[t] += deptPtr-&gt;<a class="code" href="classDepartment.html#m1">course_array</a>.<a class="code" href="classCourseArray.html#m3">convention_student_count</a>[t];
00581             <a class="code" href="classDepartmentArray.html#m56">average_class_size</a>[t] += deptPtr-&gt;<a class="code" href="classDepartment.html#m1">course_array</a>.<a class="code" href="classCourseArray.html#m4">average_class_size</a>[t];
00582             <a class="code" href="classDepartmentArray.html#m57">normal_class_size</a>[t] += deptPtr-&gt;<a class="code" href="classDepartment.html#m1">course_array</a>.<a class="code" href="classCourseArray.html#m5">normal_class_size</a>[t];
00583             <span class="comment">// size_deviation[t] += deptPtr-&gt;course_array.size_deviation[t];</span>
00584             <span class="comment">// fix in version 2, size_deviation use average class size and normal for each teaching method of institution</span>
00585             <a class="code" href="classDepartmentArray.html#m59">admission_denied_count</a>[t] += deptPtr-&gt;<a class="code" href="classDepartment.html#m1">course_array</a>.<a class="code" href="classCourseArray.html#m7">admission_denied_count</a>[t];
00586             <a class="code" href="classDepartmentArray.html#m60">failure_count</a>[t] += deptPtr-&gt;<a class="code" href="classDepartment.html#m1">course_array</a>.<a class="code" href="classCourseArray.html#m8">failure_count</a>[t];
00587 
00588 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00589 <span class="preprocessor"></span>            outsourcing_credits[t] += deptPtr-&gt;<a class="code" href="classDepartment.html#m1">course_array</a>.outsourcing_credits[t];
00590 <span class="preprocessor">#endif</span>
00591 <span class="preprocessor"></span>        }
00592 
00593         <span class="comment">//------//</span>
00594 
00595         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c=deptPtr-&gt;<a class="code" href="classDepartment.html#m1">course_array</a>.<a class="code" href="classDynArray.html#a28">size</a>(); c&gt;0; c--) {
00596             <a class="code" href="classCourse.html">Course</a>* cPtr = deptPtr-&gt;<a class="code" href="classDepartment.html#m1">course_array</a>[c];
00597             <span class="comment">//int tm = cPtr-&gt;teaching_method;</span>
00598 
00599             <span class="keywordflow">if</span> ( cPtr-&gt;<a class="code" href="classCourse.html#m4">teaching_method</a> != <a class="code" href="Ocourse_8h.html#a40a34">BREAKOUT_LAB</a> ) {
00600                 <span class="comment">//                              total += math.safe_divide(cPtr-&gt;convention_student_count, cPtr-&gt;class_section_count);</span>
00601                 <span class="comment">//                              count++;</span>
00602             }
00603         }
00604     }
00605 
00606     <span class="comment">//experienced_class_size[THIS_TRIMESTER] = (int) math.safe_divide(total, (float) count);</span>
00607 
00608     <span class="comment">//if ( experienced_class_size[THIS_TRIMESTER] &lt;= 0 )        //fix bug for summer</span>
00609     <span class="comment">//  experienced_class_size[THIS_TRIMESTER] = experienced_class_size[THIS_TRIMESTER-1];</span>
00610 
00611     <span class="comment">//  if (info.game_month == 5)                               //## chea 190899 18.2</span>
00612     <span class="comment">//          convention_student_count[MAX_TEACHING_METHOD]=0;</span>
00613 
00614     <span class="keywordflow">for</span>(t=0; t&lt;<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>; t++) {
00615 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00616 <span class="preprocessor"></span>        outsourcing_credits[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>] += outsourcing_credits[t];
00617 <span class="preprocessor">#endif</span>
00618 <span class="preprocessor"></span>
00619 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00620 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ( t==<a class="code" href="Ocourse_8h.html#a40a32">DISTANCE_LEARN_COURSE</a> )
00621             <span class="keywordflow">continue</span>;
00622 <span class="preprocessor">#endif</span>
00623 <span class="preprocessor"></span>
00624         <span class="comment">//class_section_count[t] /= department_count;</span>
00625         <span class="comment">//convention_student_count[t] /= department_count;</span>
00626         <span class="comment">//990506 average_class_size[t] /= department_count;</span>
00627         <span class="comment">// 990506</span>
00628         <a class="code" href="classDepartmentArray.html#m56">average_class_size</a>[t] = (int) math.safe_divide(<a class="code" href="classDepartmentArray.html#m55">convention_student_count</a>[t], <a class="code" href="classDepartmentArray.html#m54">class_section_count</a>[t]);
00629         <a class="code" href="classDepartmentArray.html#m57">normal_class_size</a>[t] /= <a class="code" href="classDepartmentArray.html#m0">department_count</a>;
00630 
00631         <span class="comment">// size_deviation[t] /= department_count;</span>
00632         <span class="comment">// fix in version 2, size_deviation use (average_class_size-normal_class_size)/normal_class_size</span>
00633         <a class="code" href="classDepartmentArray.html#m58">size_deviation</a>[t] = (int) math.safe_divide(100 * (<a class="code" href="classDepartmentArray.html#m56">average_class_size</a>[t]-<a class="code" href="classDepartmentArray.html#m57">normal_class_size</a>[t]), <a class="code" href="classDepartmentArray.html#m57">normal_class_size</a>[t]);
00634 
00635         <span class="comment">//admission_denied_count[t] /= department_count;</span>
00636         <span class="comment">//failure_count[t] /= department_count;</span>
00637 
00638         <span class="comment">//0405</span>
00639         <a class="code" href="classDepartmentArray.html#m61">experienced_class_size</a>[THIS_TRIMESTER] += <a class="code" href="classDepartmentArray.html#m56">average_class_size</a>[t];
00640 
00641         <span class="comment">//----//</span>
00642 
00643         <a class="code" href="classDepartmentArray.html#m54">class_section_count</a>[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>] += <a class="code" href="classDepartmentArray.html#m54">class_section_count</a>[t];
00644 
00645         <a class="code" href="classDepartmentArray.html#m55">convention_student_count</a>[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>] += <a class="code" href="classDepartmentArray.html#m55">convention_student_count</a>[t];
00646 
00647         <span class="comment">//0405 average_class_size[MAX_TEACHING_METHOD] += average_class_size[t];</span>
00648 
00649         <a class="code" href="classDepartmentArray.html#m57">normal_class_size</a>[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>] += <a class="code" href="classDepartmentArray.html#m57">normal_class_size</a>[t];
00650         <span class="comment">// fix in version 2 use weighted average (weight is class_section_count[t])</span>
00651         <span class="comment">// size_deviation[MAX_TEACHING_METHOD] += size_deviation[t];</span>
00652         <a class="code" href="classDepartmentArray.html#m58">size_deviation</a>[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>] += <a class="code" href="classDepartmentArray.html#m58">size_deviation</a>[t] * <a class="code" href="classDepartmentArray.html#m54">class_section_count</a>[t];
00653         <a class="code" href="classDepartmentArray.html#m59">admission_denied_count</a>[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>] += <a class="code" href="classDepartmentArray.html#m59">admission_denied_count</a>[t];
00654         <a class="code" href="classDepartmentArray.html#m60">failure_count</a>[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>] += <a class="code" href="classDepartmentArray.html#m60">failure_count</a>[t];
00655     }
00656 
00657     <span class="comment">//## chea begin 990525</span>
00658 
00659     <span class="comment">// 0405</span>
00660     <a class="code" href="classDepartmentArray.html#m56">average_class_size</a>[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>] = (int) math.safe_divide(<a class="code" href="classDepartmentArray.html#m55">convention_student_count</a>[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>], <a class="code" href="classDepartmentArray.html#m54">class_section_count</a>[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>]);
00661 
00662     <span class="keywordflow">if</span> ( <a class="code" href="classDepartmentArray.html#m56">average_class_size</a>[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>] &lt;= 0)
00663         <a class="code" href="classDepartmentArray.html#m61">experienced_class_size</a>[THIS_TRIMESTER] = <a class="code" href="classDepartmentArray.html#m61">experienced_class_size</a>[THIS_TRIMESTER-1];
00664     <span class="keywordflow">else</span>
00665         <a class="code" href="classDepartmentArray.html#m61">experienced_class_size</a>[THIS_TRIMESTER] = <a class="code" href="classDepartmentArray.html#m56">average_class_size</a>[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>];
00666 
00667     <span class="comment">//0405 average_class_size[MAX_TEACHING_METHOD] /= department_count;</span>
00668     <span class="comment">//average_class_size[MAX_TEACHING_METHOD] = (int) math.safe_divide(convention_student_count[MAX_TEACHING_METHOD], class_section_count[MAX_TEACHING_METHOD]);        // 0405</span>
00669 
00670     <span class="comment">//## chea end 990525</span>
00671 
00672     <a class="code" href="classDepartmentArray.html#m57">normal_class_size</a>[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>] /= <a class="code" href="classDepartmentArray.html#m0">department_count</a>;
00673 
00674     <span class="comment">// size_deviation[MAX_TEACHING_METHOD] /= department_count;</span>
00675     <span class="comment">// fix in version 2 use weighted average (weight is class_section_count[t])</span>
00676     <span class="keywordflow">if</span>( <a class="code" href="classDepartmentArray.html#m54">class_section_count</a>[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>] &gt; 0 )
00677         <a class="code" href="classDepartmentArray.html#m58">size_deviation</a>[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>] = (int)math.safe_divide( <a class="code" href="classDepartmentArray.html#m58">size_deviation</a>[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>], <a class="code" href="classDepartmentArray.html#m54">class_section_count</a>[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>] );
00678     <span class="keywordflow">else</span>
00679         <a class="code" href="classDepartmentArray.html#m58">size_deviation</a>[<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a>] = 0;
00680 }
00681 
00682 <span class="comment">//------- End of function DepartmentArray::calc_course_history -----//</span>
00683 
00684 <span class="comment">//------- Begin of function DepartmentArray::calc_research_history -----//</span>
<a name="l00686"></a><a class="code" href="classDepartmentArray.html#a22">00686</a> <span class="comment">void DepartmentArray::calc_research_history() {   // 1217</span>
00687     <span class="keywordtype">int</span> i;
00688     <span class="keywordtype">int</span> total = 0;
00689 
00690     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Odept_8h.html#a19a16">RESEARCH_STATUS_COUNT</a>; i++)
00691         research_y_history[i][THIS_YEAR] = 0;
00692 
00693     <span class="keywordflow">for</span> (i=size(); i&gt;0; i--) {
00694         <span class="keywordflow">if</span> ( is_deleted(i) )
00695             <span class="keywordflow">continue</span>;
00696 
00697         <a class="code" href="classDepartment.html">Department</a>* deptPtr = department_array[i];
00698 
00699         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> s=0; s&lt;<a class="code" href="Odept_8h.html#a19a16">RESEARCH_STATUS_COUNT</a>; s++) {
00700             research_m_history[s][THIS_MONTH] += deptPtr-&gt;<a class="code" href="classDepartment.html#m66">research_m_history</a>[s][THIS_MONTH];
00701             research_y_history[s][THIS_YEAR] += deptPtr-&gt;<a class="code" href="classDepartment.html#m67">research_y_history</a>[s][THIS_YEAR];
00702         }
00703 
00704         research_total_history[THIS_MONTH] += deptPtr-&gt;<a class="code" href="classDepartment.html#m68">research_total_history</a>[THIS_MONTH];
00705         research_direct_history[THIS_MONTH] += deptPtr-&gt;<a class="code" href="classDepartment.html#m69">research_direct_history</a>[THIS_MONTH];
00706 
00707         regular_faculty_with_research[THIS_MONTH] += deptPtr-&gt;<a class="code" href="classDepartment.html#m70">regular_faculty_with_research</a>[THIS_MONTH] * deptPtr-&gt;<a class="code" href="classDepartment.html#m9">regular_faculty_count</a>;
00708         total += deptPtr-&gt;<a class="code" href="classDepartment.html#m9">regular_faculty_count</a>;
00709     }
00710 
00711     <span class="keywordflow">if</span> ( total )
00712         regular_faculty_with_research[THIS_MONTH] /= total;
00713 }
00714 
00715 <span class="comment">//------- End of function DepartmentArray::calc_research_history -----//</span>
00716 
00717 <span class="comment">//------- Begin of function DepartmentArray::calc_faculty_student_history -----//</span>
00719 <span class="comment">                                                  // 1217</span>
<a name="l00720"></a><a class="code" href="classDepartmentArray.html#a17">00720</a> <span class="keywordtype">void</span> <a class="code" href="classDepartmentArray.html#a17">DepartmentArray::calc_faculty_student_history</a>() {
00721     <span class="keywordtype">int</span> <a class="code" href="classDepartmentArray.html#m34">total_student_count</a> = 0;
00722     <span class="keywordtype">int</span> <a class="code" href="classDepartmentArray.html#m35">total_faculty_count</a> = 0;
00723 
00724     <span class="keywordtype">int</span>  i,j;
00725     <a class="code" href="classDepartment.html">Department</a>* deptPtr;
00726 
00727     <a class="code" href="ALL_8H.html#a0">err_when</a>(<a class="code" href="classDepartmentArray.html#m37">faculty_gender_history</a>[<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>][THIS_YEAR] != 0);
00728 
00729     <span class="keywordflow">for</span> ( i=<a class="code" href="classDynArray.html#a28">size</a>(); i&gt;0; i-- ) {
00730         <span class="keywordflow">if</span> ( <a class="code" href="classDepartmentArray.html#a11">is_deleted</a>(i) )
00731             <span class="keywordflow">continue</span>;
00732 
00733         deptPtr = department_array[i];
00734 
00735         <span class="keywordflow">for</span> (j=0;j&lt;<a class="code" href="Ofaculty_8h.html#a30a22">FACULTY_RANK_LEVEL_COUNT_N_TOTAL</a>; j++)
00736             <a class="code" href="classDepartmentArray.html#m36">faculty_level_history</a>[j][THIS_YEAR] += deptPtr-&gt;<a class="code" href="classDepartment.html#m64">faculty_level_history</a>[j][THIS_YEAR];
00737 
00738         <span class="keywordflow">for</span> (j=0;j&lt;<a class="code" href="Ostudent_8h.html#a34a12">MAX_STUDENT_LEVEL_N_TOTAL</a>; j++)
00739             <a class="code" href="classDepartmentArray.html#m38">student_level_history</a>[j][THIS_YEAR] += deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m5">student_level_history</a>[j][THIS_YEAR];
00740 
00741         <span class="keywordflow">for</span> (j=0;j&lt;<a class="code" href="Gamedef_8h.html#a77a33">GENDER_ETHNIC_TYPE_COUNT_N_TOTAL</a>; j++) {
00742             <a class="code" href="classDepartmentArray.html#m37">faculty_gender_history</a>[j][THIS_YEAR] += deptPtr-&gt;<a class="code" href="classDepartment.html#m65">faculty_gender_history</a>[j][THIS_YEAR];
00743             <a class="code" href="classDepartmentArray.html#m39">student_gender_history</a>[j][THIS_YEAR] += deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m6">student_gender_history</a>[j][THIS_YEAR];
00744         }
00745 
00746         <a class="code" href="classDepartmentArray.html#m34">total_student_count</a> += deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#m1">student_count</a>;
00747         <a class="code" href="classDepartmentArray.html#m35">total_faculty_count</a> += deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#m1">faculty_count</a>;
00748 
00749         sys.yield();
00750     }
00751 
00752     <span class="comment">// 0406</span>
00753 
00754     <a class="code" href="classGeneralDepartment.html">GeneralDepartment</a> *genDeptPtr = &amp;department_res.general_dept;
00755 
00756     <span class="comment">// 0406</span>
00757     department_res.general_dept.calc_student_history();
00758     <span class="comment">// calc_degree_awarded              //0408</span>
00759 
00760     <span class="keywordflow">for</span> (j=0;j&lt;<a class="code" href="Ostudent_8h.html#a34a12">MAX_STUDENT_LEVEL_N_TOTAL</a>; j++)
00761         <a class="code" href="classDepartmentArray.html#m38">student_level_history</a>[j][THIS_YEAR] += genDeptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m5">student_level_history</a>[j][THIS_YEAR];
00762 
00763     <span class="keywordflow">for</span> (j=0;j&lt;<a class="code" href="Gamedef_8h.html#a77a33">GENDER_ETHNIC_TYPE_COUNT_N_TOTAL</a>; j++)
00764         <a class="code" href="classDepartmentArray.html#m39">student_gender_history</a>[j][THIS_YEAR] += genDeptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m6">student_gender_history</a>[j][THIS_YEAR];
00765 
00766     <a class="code" href="classDepartmentArray.html#m34">total_student_count</a> += genDeptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#m1">student_count</a>;
00767 }
00768 
00769 <span class="comment">//------- End of function DepartmentArray::calc_faculty_student_history -----//</span>
00770 
00771 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00772 <span class="preprocessor"></span><span class="comment">//------- Begin of function DepartmentArray::save_initial_data -----//</span>
00773 <span class="keywordtype">void</span> DepartmentArray::save_initial_data() {
00774     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i&lt; <a class="code" href="Ofaculty_8h.html#a30a22">FACULTY_RANK_LEVEL_COUNT_N_TOTAL</a>; i++) {
00775         initial_faculty_level[i] = <a class="code" href="classDepartmentArray.html#m36">faculty_level_history</a>[i][HISTORY_YEAR_COUNT-1];
00776     }
00777 
00778     <span class="keywordflow">for</span> (i = 0; i&lt; <a class="code" href="Gamedef_8h.html#a77a33">GENDER_ETHNIC_TYPE_COUNT_N_TOTAL</a>; i++) {
00779         initial_faculty_gender[i] = <a class="code" href="classDepartmentArray.html#m37">faculty_gender_history</a>[i][HISTORY_YEAR_COUNT-1];
00780     }
00781 
00782     <span class="comment">//  a percentage from 0 to 100</span>
00783     initial_talent_teaching = <a class="code" href="classDepartmentArray.html#m48">talent_teaching</a>[HISTORY_TRIMESTER_COUNT-1];
00784     initial_talent_scholarship = <a class="code" href="classDepartmentArray.html#m49">talent_scholarship</a>[HISTORY_TRIMESTER_COUNT-1];
00785     initial_talent_research = <a class="code" href="classDepartmentArray.html#m50">talent_research</a>[HISTORY_TRIMESTER_COUNT-1];
00786 
00787     <span class="comment">//  a percentage from 0 to 100</span>
00788     initial_performance_teaching = <a class="code" href="classDepartmentArray.html#m51">performance_teaching</a>[HISTORY_TRIMESTER_COUNT-1];
00789     initial_performance_scholarship = <a class="code" href="classDepartmentArray.html#m52">performance_scholarship</a>[HISTORY_TRIMESTER_COUNT-1];
00790     <span class="comment">// BUGHRE change to monthly as in Faculty::update_history()</span>
00791     initial_performance_research = <a class="code" href="classDepartmentArray.html#m53">performance_research</a>[HISTORY_TRIMESTER_COUNT-1];
00792     <span class="comment">// unit: hour</span>
00793     initial_teaching_contact_hour = <a class="code" href="classDepartmentArray.html#m40">teaching_contact_hour</a>[HISTORY_TRIMESTER_COUNT-1];
00794 
00795     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="Odept_8h.html#a19a16">RESEARCH_STATUS_COUNT</a>; i++) {
00796         <span class="comment">// ($000)</span>
00797         initial_research_m[i] = <a class="code" href="classDepartmentArray.html#m43">research_m_history</a>[i][HISTORY_MONTH_COUNT-1];
00798     }
00799 
00800     initial_p_educational_quality = <a class="code" href="classDepartmentArray.html#m22">p_educational_quality_history</a>[HISTORY_TRIMESTER_COUNT-1];
00801     initial_p_academic_standing = <a class="code" href="classDepartmentArray.html#m23">p_academic_standing_history</a>[HISTORY_YEAR_COUNT-1];
00802 
00803     initial_p_faculty_research =  <a class="code" href="classDepartmentArray.html#m25">p_faculty_research_history</a>[HISTORY_MONTH_COUNT-1];
00804     initial_p_faculty_morale = <a class="code" href="classDepartmentArray.html#m26">p_faculty_morale_history</a>[HISTORY_MONTH_COUNT-1];
00805 
00806     <span class="comment">// ($000)</span>
00807     initial_research_total = <a class="code" href="classDepartmentArray.html#m45">research_total_history</a>[HISTORY_MONTH_COUNT-1];
00808     <span class="comment">// ($000)</span>
00809     initial_research_direct = <a class="code" href="classDepartmentArray.html#m46">research_direct_history</a>[HISTORY_MONTH_COUNT-1];
00810     <span class="comment">// 99-&gt;99%</span>
00811     initial_regular_faculty_with_research = <a class="code" href="classDepartmentArray.html#m47">regular_faculty_with_research</a>[HISTORY_MONTH_COUNT-1];
00812 
00813     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="Ofaculty_8h.html#a30a21">DISCRETIONARY_TYPE_COUNT_N_TOTAL</a>; i++) {
00814         initial_discretionary_hour_array[i] = <a class="code" href="classDepartmentArray.html#m41">discretionary_hour_array</a>[i][HISTORY_TRIMESTER_COUNT-1];
00815     }
00816 
00817 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00818 <span class="preprocessor"></span>    initial_time_shifted_scholarship = time_shifted_scholarship;
00819 <span class="preprocessor">#endif</span>
00820 <span class="preprocessor"></span>
00821     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="Odept_8h.html#a19a16">RESEARCH_STATUS_COUNT</a>; i++) {
00822         <span class="comment">// ($000)</span>
00823         initial_research_y[i] = <a class="code" href="classDepartmentArray.html#m44">research_y_history</a>[i][HISTORY_YEAR_COUNT-1];
00824     }
00825 
00826     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="Ocourse_8h.html#a39a30">MAX_TEACHING_METHOD_N_TOTAL</a>; i++) {
00827         initial_class_section_count[i] = <a class="code" href="classDepartmentArray.html#m54">class_section_count</a>[i];
00828         initial_convention_student_count[i] = <a class="code" href="classDepartmentArray.html#m55">convention_student_count</a>[i];
00829         initial_average_class_size[i] = <a class="code" href="classDepartmentArray.html#m56">average_class_size</a>[i];
00830         initial_size_deviation[i] = <a class="code" href="classDepartmentArray.html#m58">size_deviation</a>[i];
00831         initial_admission_denied_count[i] = <a class="code" href="classDepartmentArray.html#m59">admission_denied_count</a>[i];
00832         initial_failure_count[i] = <a class="code" href="classDepartmentArray.html#m60">failure_count</a>[i];
00833         initial_normal_class_size[i] = <a class="code" href="classDepartmentArray.html#m57">normal_class_size</a>[i];
00834     }
00835 
00836     initial_experienced_class_size = <a class="code" href="classDepartmentArray.html#m61">experienced_class_size</a>[HISTORY_TRIMESTER_COUNT-1];
00837 
00838     initial_salary_gender_ethnic_equity = salary_gender_ethnic_equity_history[HISTORY_YEAR_COUNT-1];
00839     initial_salary_departmental_equity = salary_departmental_equity_history[HISTORY_YEAR_COUNT-1];
00840     initial_salary_rank_equity = salary_rank_equity_history[HISTORY_YEAR_COUNT-1];
00841 }
00842 
00843 <span class="comment">//------- End of function DepartmentArray::save_initial_data -----//</span>
00844 
00845 <span class="comment">//------- Begin of function DepartmentArray::calc_salary_equity -----//</span>
00846 <span class="keywordtype">void</span> DepartmentArray::calc_salary_equity() {
00847     <span class="comment">// update salary_gender_ethnic_equity_history[HISTORY_YEAR_COUNT-1]</span>
00848     <span class="comment">//  salary_departmental_equity_history[HISTORY_YEAR_COUNT-1]</span>
00849     <span class="comment">// and salary_rank_equity_history[HISTORY_YEAR_COUNT-1]</span>
00850 
00851     <span class="keywordtype">int</span> deptRecno, geGroupId, rankAgeId;
00852 
00853     <span class="comment">// sums of faculty salaries</span>
00854     <span class="keywordtype">int</span> facultyCount = 0;                           <span class="comment">// number of faculty</span>
00855     <span class="keywordtype">float</span> facultySum = 0.0f;                        <span class="comment">// sum of salary of all faculty</span>
00856     <span class="keywordtype">float</span> facultySumSq = 0.0f;                      <span class="comment">// sum of salary^2 of all faculty</span>
00857 
00858     <span class="comment">// sums per department</span>
00859 
00860     <span class="keywordtype">int</span> deptCount[<a class="code" href="Gamedef_8h.html#a10">MAX_DEPARTMENT</a>];                  <span class="comment">// number of faculty of each deparment</span>
00861     <span class="keywordtype">float</span> deptSum[<a class="code" href="Gamedef_8h.html#a10">MAX_DEPARTMENT</a>];                  <span class="comment">// sum of salary of each department</span>
00862     memset( deptCount, 0, <span class="keyword">sizeof</span>(deptCount) );
00863     memset( deptSum, 0, <span class="keyword">sizeof</span>(deptSum) );
00864 
00865     <span class="comment">// sum per gender-ethnic group</span>
00866 
00867     <span class="keywordtype">int</span> geGroupCount[<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>];
00868     <span class="keywordtype">float</span> geGroupSum[<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>];
00869     memset( geGroupCount, 0, <span class="keyword">sizeof</span>(geGroupCount) );
00870     memset( geGroupSum, 0, <span class="keyword">sizeof</span>(geGroupSum) );
00871 
00872     <span class="comment">// sum per rank</span>
00873 
00874     <span class="keywordtype">int</span> rankCount[<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>];              <span class="comment">// FULL_PROF divied into 3 group, use Faculty::rank_age_group</span>
00875     <span class="keywordtype">float</span> rankSum[<a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>];
00876     memset( rankCount, 0, <span class="keyword">sizeof</span>(rankCount) );
00877     memset( rankSum, 0, <span class="keyword">sizeof</span>(rankSum) );
00878 
00879     <span class="comment">// collect sum and count of each faculty</span>
00880 
00881     <a class="code" href="ALL_8H.html#a0">err_when</a>( <a class="code" href="classDynArray.html#a28">size</a>() &gt; <a class="code" href="Gamedef_8h.html#a10">MAX_DEPARTMENT</a> );
00882     <span class="keywordflow">for</span>( deptRecno = 1; deptRecno &lt;= <a class="code" href="classDynArray.html#a28">size</a>(); ++deptRecno ) {
00883         <span class="keywordflow">if</span>( <a class="code" href="classDepartmentArray.html#a11">is_deleted</a>(deptRecno) )
00884             <span class="keywordflow">continue</span>;
00885 
00886         <a class="code" href="classFacultyArray.html">FacultyArray</a> &amp;facultyArray = <a class="code" href="classDepartmentArray.html#a13">operator[]</a>(deptRecno)-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>;
00887         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 1; i &lt;= facultyArray.<a class="code" href="classDynArray.html#a28">size</a>(); ++i ) {
00888             <span class="keywordflow">if</span>( facultyArray.<a class="code" href="classFacultyArray.html#a10">is_deleted</a>(i) )
00889                 <span class="keywordflow">continue</span>;
00890 
00891             <span class="keywordtype">float</span> salary = facultyArray[i]-&gt;salary;
00892 
00893             ++facultyCount;
00894             facultySum += salary;
00895             facultySumSq += salary * salary;
00896 
00897             ++deptCount[deptRecno-1];
00898             deptSum[deptRecno-1] += salary;
00899 
00900             geGroupId = facultyArray[i]-&gt;gender_ethnic_group;
00901             <a class="code" href="ALL_8H.html#a0">err_when</a>( geGroupId&lt; 0 || geGroupId &gt;= <a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a> );
00902             ++geGroupCount[geGroupId];
00903             geGroupSum[geGroupId] += salary;
00904 
00905             rankAgeId = facultyArray[i]-&gt;rank_age_group();
00906             <a class="code" href="ALL_8H.html#a0">err_when</a>( rankAgeId &lt; 0 || rankAgeId &gt;= <a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a> );
00907             ++rankCount[rankAgeId];
00908             rankSum[rankAgeId] += salary;
00909         }
00910     }
00911 
00912     <span class="keywordtype">float</span> facultyAvg = facultySum / (float)facultyCount;
00913 
00914     <span class="comment">//            n   _   _</span>
00915     <span class="comment">// S  = (n-1)Sum (x - x)</span>
00916     <span class="comment">//  d        d=1   d</span>
00917 
00918     <span class="keywordtype">float</span> deptDevSum = 0.0f;
00919     <span class="keywordtype">int</span> deptExistCount = 0;                         <span class="comment">// number of non-empty department</span>
00920     <span class="keywordflow">for</span>( deptRecno = 1; deptRecno &lt;= <a class="code" href="classDynArray.html#a28">size</a>(); ++deptRecno ) {
00921         <span class="keywordflow">if</span>( deptCount[deptRecno-1] &gt; 0 ) {
00922             ++deptExistCount;
00923             <span class="keywordtype">float</span> deptAvg = deptSum[deptRecno-1] / (float)deptCount[deptRecno-1];
00924             deptDevSum += (deptAvg - facultyAvg) * (deptAvg - facultyAvg);
00925         }
00926     }
00927     <span class="keywordtype">float</span> deptEquity = float(deptExistCount-1) * deptDevSum;
00928 
00929     <span class="comment">//           n   _   _</span>
00930     <span class="comment">// S  = 3 * Sum (x - x)</span>
00931     <span class="comment">//  g       g=1   g</span>
00932 
00933     <span class="keywordtype">float</span> geGroupDevSum = 0.0f;
00934     <span class="keywordtype">int</span> geGroupExistCount = 0;
00935     <span class="keywordflow">for</span>( geGroupId = 0; geGroupId &lt; <a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>; ++geGroupId ) {
00936         <span class="keywordflow">if</span>( geGroupCount[geGroupId] &gt; 0 ) {
00937             ++geGroupExistCount;
00938             <span class="keywordtype">float</span> geGroupAvg = geGroupSum[geGroupId] / (float)geGroupCount[geGroupId];
00939             geGroupDevSum += (geGroupAvg - facultyAvg) * (geGroupAvg - facultyAvg);
00940         }
00941     }
00942     <span class="keywordtype">float</span> geGroupEquity = (geGroupExistCount-1) * geGroupDevSum;
00943 
00944     <span class="comment">//           n   _   _</span>
00945     <span class="comment">// S  = 6 * Sum (x - x)</span>
00946     <span class="comment">//  r       r=1   r</span>
00947 
00948     <span class="keywordtype">float</span> rankDevSum = 0.0f;
00949     <span class="keywordtype">int</span> rankExistCount = 0;
00950     <span class="keywordflow">for</span>( rankAgeId = 0; rankAgeId &lt; <a class="code" href="Ofacures_8h.html#a0">MAX_RANK_AGE_GROUP</a>; ++rankAgeId ) {
00951         <span class="keywordflow">if</span>( rankCount[rankAgeId] &gt; 0 ) {
00952             ++rankExistCount;
00953             <span class="keywordtype">float</span> rankAvg = rankSum[rankAgeId] / (float)rankCount[rankAgeId];
00954             rankDevSum += (rankAvg - facultyAvg) * (rankAvg - facultyAvg);
00955         }
00956     }
00957     <span class="keywordtype">float</span> rankEquity = (rankExistCount-1) * rankDevSum;
00958 
00959     <span class="comment">//       N      _</span>
00960     <span class="comment">// S  = Sum(x - x) - S - S - S</span>
00961     <span class="comment">//  E   i=1  i         d   g   r</span>
00962 
00963     <span class="comment">//                           N          N</span>
00964     <span class="comment">// replace summation by use Sum x  - (Sum x)/N</span>
00965     <span class="comment">//                          i=1  i     i=1</span>
00966 
00967     <span class="keywordtype">float</span> facultyEquity = facultySumSq - facultySum * facultySum / float(facultyCount)
00968         - deptEquity - geGroupEquity - rankEquity;
00969 
00970     <span class="comment">// do not shift history here</span>
00971 
00972     <span class="keywordflow">if</span>( facultyEquity == 0.0f ) {
00973         salary_departmental_equity_history[THIS_YEAR] = 0.0f;
00974         salary_gender_ethnic_equity_history[THIS_YEAR] = 0.0f;
00975         salary_rank_equity_history[THIS_YEAR] = 0.0f;
00976     }
00977     <span class="keywordflow">else</span> {
00978         salary_departmental_equity_history[THIS_YEAR] = float(deptExistCount-1) * deptEquity / facultyEquity;
00979         salary_gender_ethnic_equity_history[THIS_YEAR] = float(geGroupExistCount-1) * geGroupEquity / facultyEquity;
00980         salary_rank_equity_history[THIS_YEAR] = float(rankExistCount-1) * rankEquity / facultyEquity;
00981     }
00982 }
00983 
00984 <span class="comment">//------- End of function DepartmentArray::calc_salary_equity -----//</span>
00985 <span class="preprocessor">#endif</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:21 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
