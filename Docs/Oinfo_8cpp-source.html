<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Oinfo.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Oinfo.cpp</h1><a href="Oinfo_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename: OINFO.CPP</span>
00002 <span class="comment">//Description : Info class</span>
00003 
00004 <span class="preprocessor">#include &lt;time.h&gt;</span>
00005 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;<a class="code" href="ODATE_8H.html">ODATE.H</a>&gt;</span>
00007 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>
00008 <span class="preprocessor">#include &lt;<a class="code" href="OIMGRES_8H.html">OIMGRES.H</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;OMISC.H&gt;</span>
00010 <span class="preprocessor">#include &lt;<a class="code" href="OMUSIC_8H.html">OMUSIC.H</a>&gt;</span>
00011 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00012 <span class="preprocessor">#include &lt;<a class="code" href="OMOUSECR_8H.html">OMOUSECR.H</a>&gt;</span>
00013 <span class="preprocessor">#include &lt;<a class="code" href="OFIRMRES_8H.html">OFIRMRES.H</a>&gt;</span>
00014 <span class="preprocessor">#include &lt;<a class="code" href="OSTR_8H.html">OSTR.H</a>&gt;</span>
00015 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00016 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00017 <span class="preprocessor">#include &lt;OFONT.H&gt;</span>
00018 <span class="preprocessor">#include &lt;ODEPT.H&gt;</span>
00019 <span class="preprocessor">#include &lt;OFIRM.H&gt;</span>
00020 <span class="preprocessor">#include &lt;<a class="code" href="OWORLD_8H.html">OWORLD.H</a>&gt;</span>
00021 <span class="preprocessor">#include &lt;OSTUDENT.H&gt;</span>
00022 <span class="preprocessor">#include &lt;OFACULTY.H&gt;</span>
00023 <span class="preprocessor">#include &lt;OCOURSE.H&gt;</span>
00024 <span class="preprocessor">#include &lt;<a class="code" href="OSCHOOL_8H.html">OSCHOOL.H</a>&gt;</span>
00025 <span class="preprocessor">#include &lt;OPSCHOOL.H&gt;</span>
00026 <span class="preprocessor">#include &lt;<a class="code" href="OSCHLRES_8H.html">OSCHLRES.H</a>&gt;</span>
00027 <span class="preprocessor">#include &lt;<a class="code" href="OCOLTBL_8H.html">OCOLTBL.H</a>&gt;</span>
00028 <span class="preprocessor">#include &lt;OFINANCE.H&gt;</span>
00029 <span class="preprocessor">#include &lt;OAthleti.h&gt;</span>
00030 <span class="preprocessor">#include &lt;ODEVELOP.H&gt;</span>
00031 <span class="preprocessor">#include &lt;OFACILIT.H&gt;</span>
00032 <span class="preprocessor">#include &lt;OLIBTECH.H&gt;</span>
00033 <span class="preprocessor">#include &lt;OINVEST.H&gt;</span>                              <span class="comment">//##### fred 981016 #####//</span>
00034 <span class="preprocessor">#include &lt;<a class="code" href="ODEPTRES_8H.html">ODEPTRES.H</a>&gt;</span>
00035 <span class="preprocessor">#include &lt;OENROLL.H&gt;</span>                              <span class="comment">//##### fred 980908 #####//</span>
00036 <span class="preprocessor">#include &lt;<a class="code" href="OSTUOFF_8H.html">OSTUOFF.H</a>&gt;</span>                              <span class="comment">//##### fred 980908 #####//</span>
00037 <span class="preprocessor">#include &lt;<a class="code" href="OTEXT_8H.html">OTEXT.H</a>&gt;</span>                                <span class="comment">//##### chw 981014 #####//</span>
00038 <span class="preprocessor">#include &lt;<a class="code" href="OTASK_8H.html">OTASK.H</a>&gt;</span>                                <span class="comment">//##### fred 981015 #####//</span>
00039 <span class="preprocessor">#include &lt;OCHANCE.H&gt;</span>                              <span class="comment">//##### fred 981015 #####//</span>
00040 <span class="preprocessor">#include &lt;OCONFIG.H&gt;</span>                              <span class="comment">//##### chea 140799 #####//</span>
00041 <span class="preprocessor">#include &lt;<a class="code" href="OBOX_8H.html">OBOX.H</a>&gt;</span>
00042 <span class="preprocessor">#include &lt;OLETTER.H&gt;</span>                              <span class="comment">//##### chea 140799 #####//</span>
00043 <span class="preprocessor">#include &lt;OMATH.H&gt;</span>                                <span class="comment">//##### chea 240100 #####//</span>
00044 
00045 <span class="comment">//---------- define constant ------------//</span>
00046 
<a name="l00047"></a><a class="code" href="Oinfo_8cpp.html#a0">00047</a> <span class="preprocessor">#define DATE_BMP_RES_FILE_NAME    DIR_RES"I_DATE.RES"</span>
00048 <span class="preprocessor"></span>
00049 <span class="comment">//---------- define static variables ------------//</span>
00050 
00051 <span class="keyword">static</span> <span class="keywordtype">int</span> last_month = 0, last_year = 0, last_day = 0;
00052 <span class="keyword">static</span> <span class="keywordtype">short</span> digit_y1, year_x1_1, year_x1_2, day_x1_0, day_x1_1, day_x1_2;
00053 
00054 <span class="comment">//--------- define marco function ----------//</span>
00055 
<a name="l00056"></a><a class="code" href="Oinfo_8cpp.html#a1">00056</a> <span class="preprocessor">#define YIELD { if ( info.game_day == 1 ) sys.yield(); }</span>
00057 <span class="preprocessor"></span>
00058 <span class="comment">//------- declare static function ----------//</span>
00059 
00060 <span class="keyword">static</span> <span class="keywordtype">void</span> update_faculty_count();
00061 
00062 <span class="comment">//-------- Begin of function Info::Info --------//</span>
<a name="l00064"></a><a class="code" href="classInfo.html#a1">00064</a> <span class="comment">Info::Info() {</span>
00065     disp_6_graphs_flag=<span class="keyword">true</span>;
00066 }
00067 
00068 <span class="comment">//--------- End of function Info::Info ---------//</span>
00069 
00070 <span class="comment">//-------- Begin of function Info::~Info --------//</span>
<a name="l00072"></a><a class="code" href="classInfo.html#a2">00072</a> <span class="comment">Info::~Info() {</span>
00073     deinit();
00074 }
00075 
00076 <span class="comment">//--------- End of function Info::~Info ---------//</span>
00077 
00078 <span class="comment">//-------- Begin of function Info::init --------//</span>
<a name="l00080"></a><a class="code" href="classInfo.html#a3">00080</a> <span class="comment">void Info::init() {</span>
00081     deinit();
00082 <span class="preprocessor">#define GAME_START_YEAR 1</span>
00083 <span class="preprocessor"></span>    game_day   = 1;
00084     game_month = 9;
00085     game_year  = GAME_START_YEAR;                   <span class="comment">// may have bug if 99!!!</span>
00086 
00087     game_start_date = date.julian( game_year, game_month, game_day );
00088 
00089     game_date  = game_start_date;
00090     year_day   = date.day_year( game_year, game_month, game_day );
00091 
00092     year_passed= 1;                                 <span class="comment">// no. of years has been passed since the game begins</span>
00093 
00094     <span class="comment">//#### begin fred 0911 ####//</span>
00095     graph_year_passed = 1;
00096     graph_month_passed = 1;                         <span class="comment">// see next_day() also</span>
00097     graph_trimester_passed = 1;
00098 
00099     graph_year = 3;                                 <span class="comment">// previous, this and next year on graph</span>
00100     graph_month = 3;
00101     graph_trimester = 3;
00102     <span class="comment">//#### end fred 0911 ####//</span>
00103 
00104     <span class="comment">//----------------------------------//</span>
00105 
00106     start_play_time = m.get_time();                 <span class="comment">// the time player start playing the game</span>
00107     total_play_time = 0;                            <span class="comment">// total time the player has played in all saved games</span>
00108 
00109     <span class="comment">//############### begin Norris 0706 ##############//</span>
00110 
00111     date_res_bitmap.init(<a class="code" href="Oinfo_8cpp.html#a0">DATE_BMP_RES_FILE_NAME</a>, 1, 0);
00112 
00113     <span class="keywordtype">short</span> *shortPtr = (<span class="keywordtype">short</span> *) date_res_bitmap.get_ptr(<span class="stringliteral">"0"</span>);
00114     <span class="keywordtype">short</span> digitWidth = *shortPtr++;
00115     <span class="keywordtype">short</span> digitHeight = *shortPtr;
00116 
00117     digit_y1 = (<a class="code" href="Oinfo_8h.html#a104a32">DIGIT_Y1</a> + <a class="code" href="Oinfo_8h.html#a104a33">DIGIT_Y2</a> - digitHeight) / 2;
00118     day_x1_2 = (<a class="code" href="Oinfo_8h.html#a104a28">DAY_X1</a> + <a class="code" href="Oinfo_8h.html#a104a29">DAY_X2</a>) / 2;
00119     day_x1_1 = day_x1_2 - digitWidth;
00120     day_x1_0 = day_x1_2 - digitWidth / 2;
00121     year_x1_2 = (<a class="code" href="Oinfo_8h.html#a104a30">YEAR_X1</a> + <a class="code" href="Oinfo_8h.html#a104a31">YEAR_X2</a>) / 2;
00122     year_x1_1 = year_x1_2 - digitWidth;
00123 
00124     <span class="comment">//################# end Norris 0706 ##############//</span>
00125 
00126     disp_panel_init();
00127     image_interface.put_large( &amp;vga_back, 0, 0, <span class="stringliteral">"MAINSCR"</span> );
00128 }
00129 
00130 <span class="comment">//--------- End of function Info::init ---------//</span>
00131 
00132 <span class="comment">//-------- Begin of function Info::deinit --------//</span>
<a name="l00134"></a><a class="code" href="classInfo.html#a4">00134</a> <span class="comment">void Info::deinit() {</span>
00135     <span class="comment">//############### begin Norris 0706 ##############//</span>
00136 
00137     <span class="keywordflow">if</span>( top_info_bitmap ) {
00138         <a class="code" href="ALL_8H.html#a8">mem_del</a>( top_info_bitmap );
00139         top_info_bitmap = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00140 
00141         <a class="code" href="ALL_8H.html#a8">mem_del</a>( bottom_info_bitmap );
00142         bottom_info_bitmap = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00143 
00144         <a class="code" href="ALL_8H.html#a8">mem_del</a>( surplus_info_bitmap );
00145         surplus_info_bitmap = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00146 
00147         <a class="code" href="ALL_8H.html#a8">mem_del</a>( score_info_bitmap );
00148         score_info_bitmap = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00149 
00150         <a class="code" href="ALL_8H.html#a8">mem_del</a>( uscore_info_bitmap );
00151         uscore_info_bitmap = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00152 
00153         <a class="code" href="ALL_8H.html#a8">mem_del</a>( date_info_bitmap );
00154         <a class="code" href="ALL_8H.html#a8">mem_del</a>( year_info_bitmap );
00155 
00156         <a class="code" href="ALL_8H.html#a8">mem_del</a>( top_left_column_bitmap );
00157         <a class="code" href="ALL_8H.html#a8">mem_del</a>( top_right_column_bitmap );
00158 
00159         <a class="code" href="ALL_8H.html#a8">mem_del</a>( bottom_left_column_bitmap );
00160         <a class="code" href="ALL_8H.html#a8">mem_del</a>( bottom_right_column_bitmap );
00161 
00162         <a class="code" href="ALL_8H.html#a8">mem_del</a>( menu_up_bitmap );
00163         <a class="code" href="ALL_8H.html#a8">mem_del</a>( menu_down_bitmap );
00164 
00165         <a class="code" href="ALL_8H.html#a8">mem_del</a>( more_report_bitmap );
00166         more_report_bitmap = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00167 
00168         <a class="code" href="ALL_8H.html#a8">mem_del</a>( help_quest_bitmap );
00169         help_quest_bitmap = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00170 
00171         <a class="code" href="ALL_8H.html#a8">mem_del</a>( list_button_bitmap );
00172         list_button_bitmap = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00173 
00174         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="Oinfo_8h.html#a97a1">REPORT_ITEMS</a> + 1; i++)
00175             <a class="code" href="ALL_8H.html#a8">mem_del</a>( report_bitmap[i] );
00176     }
00177 
00178     <span class="comment">//################# end Norris 0706 ##############//</span>
00179 }
00180 
00181 <span class="comment">//--------- End of function Info::deinit ---------//</span>
00182 
00183 <span class="comment">//------- Begin of function Info::init_random_seed ------//</span>
<a name="l00190"></a><a class="code" href="classInfo.html#a7">00190</a> <span class="comment">void Info::init_random_seed(int randomSeed) {</span>
00191     <span class="keywordflow">if</span>( randomSeed )
00192         random_seed = randomSeed;
00193     <span class="keywordflow">else</span> {
00194         randomSeed = time(<a class="code" href="OHELP_8H.html#a0">NULL</a>);
00195         randomSeed = (int) _rotr( randomSeed, 4 );
00196         <span class="keywordflow">if</span>( randomSeed &lt; 0 )
00197             randomSeed = ~randomSeed;
00198         <span class="keywordflow">if</span>( randomSeed == 0 )
00199             randomSeed = 1;
00200         random_seed = randomSeed;
00201     }
00202 
00203     m.set_random_seed(random_seed);
00204 }
00205 
00206 <span class="comment">//------- End of function Info::init_random_seed ------//</span>
00207 
00208 <span class="comment">//-------- Begin of function Info::next_day ---------//</span>
00209 
<a name="l00210"></a><a class="code" href="classInfo.html#a11">00210</a> <span class="keywordtype">void</span> <a class="code" href="classInfo.html#a11">Info::next_day</a>() {
00211     inc_game_day();
00212 
00213     <span class="comment">//-------- show waiting mouse cursor it is the beginning of a month -----------//</span>
00214 
00215     <span class="keywordtype">int</span> oldCursor;
00216 
00217     <span class="keywordflow">if</span> ( <a class="code" href="classInfo.html#m2">game_day</a> == 1 ) {
00218         oldCursor = mouse_cursor.get_icon();
00219         mouse_cursor.set_icon(<a class="code" href="OMOUSECR_8H.html#a6a5">CURSOR_WAITING</a>);
00220         sys.redraw_all_flag=1;                        <span class="comment">// ## chwong0625</span>
00221     }
00222 
00223     <span class="comment">//-------- yield player_school ---------//</span>
00224 
00225     player_school.next_day();                       <span class="comment">// it must be called first as it set trimester;</span>
00226     <span class="comment">// included enrollment's run_student_dropout_graduate()</span>
00227     <span class="comment">// next_trimester() will be called and hence dropout, graduate, faculty departure, etc</span>
00228     <a class="code" href="Oinfo_8cpp.html#a1">YIELD</a>;
00229 
00230     <span class="comment">//------- call core models' next_day() ------//</span>
00231 
00232     enroll_res.next_day();                          <span class="comment">// will recalc student_count</span>
00233 
00234     development_office.next_day();
00235 
00236 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00237 <span class="preprocessor"></span><span class="preprocessor">#else</span>
00238 <span class="preprocessor"></span>    finance.next_day();
00239 <span class="preprocessor">#endif</span>
00240 <span class="preprocessor"></span>
00241     <a class="code" href="Oinfo_8cpp.html#a1">YIELD</a>;
00242 
00243     <span class="comment">//---------------------// course enrollment, after enrollment model</span>
00244 
00245     <span class="keywordflow">if</span> ( <a class="code" href="classInfo.html#a12">is_begin_trimester</a>() )
00246         new_trimester_course_enrollment();
00247 
00248 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00249 <span class="preprocessor"></span>    finance.next_day();                             <span class="comment">// should after new_trimester_course_enrollment, to initial variables to calculate net distance learning expenditures</span>
00250 <span class="preprocessor">#endif</span>
00251 <span class="preprocessor"></span>
00252     <a class="code" href="Oinfo_8cpp.html#a1">YIELD</a>;
00253 
00254     <span class="comment">//---- call offices' next_day() functions -----//</span>
00255     <span class="comment">// offices which must called after finance.next_day</span>
00256 
00257     facility_office.next_day();                     <span class="comment">// should before(!?) course enrollment, after development office, before deparment_array's course_array.next_day()</span>
00258     library_tech_office.next_day();
00259 
00260     athletics_office.next_day();                    <span class="comment">// after enrollment</span>
00261     student_office.next_day();
00262     investment_office.next_day();                   <span class="comment">// after development_office</span>
00263 
00264     <a class="code" href="Oinfo_8cpp.html#a1">YIELD</a>;
00265 
00266     <span class="comment">//---- call data array next_day() functions -----//</span>
00267     <span class="comment">// should(?) after all offices for calc pi</span>
00268 
00269     department_array.next_day();                    <span class="comment">// after course selection</span>
00270 
00271     department_res.general_dept.next_day();
00272 
00273     school_res.next_day();
00274 
00275     <a class="code" href="Oinfo_8cpp.html#a1">YIELD</a>;
00276 
00277     <span class="comment">//------- start of a new trimster: calc pi of player_school ---------//</span>
00278 
00279     <span class="keywordflow">if</span> ( <a class="code" href="classInfo.html#a12">is_begin_trimester</a>() ) {
00280         player_school.update_history(UPDATE_TRIMESTER);
00281     }
00282 
00283     <span class="comment">//--------- start of a new month -------------//</span>
00284 
00285     <span class="keywordflow">if</span> ( info.game_day == 1 ) {                     <span class="comment">//## chea 300899 change to call after UPDATE_TRIMESTER</span>
00286         player_school.update_history(UPDATE_MONTH);
00287 
00288         <span class="comment">// ---- start of a new year ------//</span>
00289 
00290         <span class="keywordflow">if</span> ( info.game_month == finance.fiscal_year_start_month ) {
00291             player_school.update_history(UPDATE_YEAR);
00292 
00293             <span class="comment">//--- re-calculate percentages and totals in financial reports to make sure all are correct. Although the calculation is done once already, to be safe, do it once again here after all new year processes are done. ----//</span>
00294 
00295             finance.calc_total_last_year();             <span class="comment">// last year</span>
00296             finance.calc_projected_total_n_percent(1);  <span class="comment">// next year. 1-re-calculation, not first time calculation</span>
00297         }
00298     }
00299 
00300     <span class="comment">//------- scenario check targets -------//</span>
00301 
00302     <span class="keywordflow">if</span> (info.prerun_year==0)
00303         player_school.scenario_check_target();
00304 
00305     <span class="comment">//---- the custom game is approaching its time limit of 99 years, display warning message ----//</span>
00306 
00307     <span class="keywordflow">if</span> (info.prerun_year==0) {
00308         <span class="keywordtype">int</span> lastYear = 90;
00309 
00310 <span class="preprocessor">#ifndef ADMIN                                 // standard and demo versions have 3 year time limit only</span>
00311 <span class="preprocessor"></span>        lastYear = 3;
00312 <span class="preprocessor">#endif</span>
00313 <span class="preprocessor"></span>
00314         <span class="keywordflow">if</span>( info.game_year == lastYear-1 &amp;&amp; info.game_month == 9 &amp;&amp; info.game_day==1 ) {
00315             news_array.open_game_near_end();            <span class="comment">// the game will soon end</span>
00316         }
00317         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( info.game_year == lastYear &amp;&amp; info.game_month == 9 &amp;&amp; info.game_day==1 ) {
00318             news_array.open_game_end();                 <span class="comment">// the game ends</span>
00319         }
00320         <span class="comment">// retire on the next day</span>
00321         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( info.game_year == lastYear &amp;&amp; info.game_month == 9 &amp;&amp; info.game_day&gt;1 ) {
00322             sys.set_staying_view_mode(<a class="code" href="Osys_8h.html#a45a22">MODE_RETIREMENT</a>);
00323 
00324             <span class="keywordflow">if</span> ( config.cd_music_volume &lt;=0 )
00325                 music.stop();
00326         }
00327     }
00328 
00329     <span class="comment">//---- process chances and objectives ----//</span>
00330 
00331     <span class="keywordflow">if</span> (info.prerun_year==0) {
00332         chance_event.next_day();
00333         task_array.next_day();                        <span class="comment">// order: after all departments and offices</span>
00334 
00335 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00336 <span class="preprocessor"></span>        player_school.think_protagonist();
00337 <span class="preprocessor">#endif</span>
00338 <span class="preprocessor"></span>
00339     }
00340 
00341     <span class="comment">//------- update initializzation progress bar -------------//</span>
00342 
00343     <span class="keywordflow">if</span>( info.prerun_year==1 &amp;&amp; info.game_day==1 ) {
00344         <span class="comment">// increment 2% per month</span>
00345         box.progress_update( 28 + <span class="keywordtype">int</span>( <span class="keywordtype">float</span>(info.game_date - info.game_start_date)/5.7f ) );
00346     }
00347 
00348     <span class="comment">//------- end of prerun year -----------//</span>
00349 
00350     <span class="comment">//## chea 190799 scenario not run prerun year</span>
00351     <span class="keywordflow">if</span> (info.game_year==2 &amp;&amp; info.game_month==9 &amp;&amp; info.game_day==1 &amp;&amp; info.prerun_year==1) {
00352         end_prerun_year();
00353         oldCursor=<a class="code" href="OMOUSECR_8H.html#a6a3">CURSOR_NORMAL</a>;
00354     }
00355 
00356     <span class="comment">//---------------------------------------//</span>
00357 
00358     <span class="keywordflow">if</span> ( <a class="code" href="classInfo.html#m2">game_day</a> == 1 )
00359         mouse_cursor.restore_icon(oldCursor);
00360 }
00361 
00362 <span class="comment">//---------- End of function Info::next_day --------//</span>
00363 
00364 <span class="comment">//-------- Begin of function Info::inc_game_day ---------//</span>
00365 
00366 <span class="keywordtype">void</span> Info::inc_game_day() {
00367     <span class="comment">//--- process game day --------//</span>
00368 
00369     <span class="keywordflow">if</span>( ++<a class="code" href="classInfo.html#m2">game_day</a> &gt; 30 )
00370         <a class="code" href="classInfo.html#m2">game_day</a> = 30;                                <span class="comment">// game_day is limited to 1-30 for</span>
00371     <span class="comment">// calculation of e.g. revenue_30days()</span>
00372     <a class="code" href="classInfo.html#m1">game_date</a>++;
00373 
00374     week_day=<a class="code" href="classInfo.html#m1">game_date</a>%7;
00375 
00376     <span class="keywordflow">if</span>( date.month(<a class="code" href="classInfo.html#m1">game_date</a>) != <a class="code" href="classInfo.html#m3">game_month</a> ) {
00377         <a class="code" href="classInfo.html#m2">game_day</a>   = 1;
00378         <a class="code" href="classInfo.html#m3">game_month</a> = date.month(<a class="code" href="classInfo.html#m1">game_date</a>);
00379 
00380         <a class="code" href="classInfo.html#m8">graph_month_passed</a> = min(<a class="code" href="classInfo.html#m8">graph_month_passed</a>+1, HISTORY_MONTH_COUNT);
00381         <a class="code" href="classInfo.html#m11">graph_month</a> = min(<a class="code" href="classInfo.html#m11">graph_month</a>+1, HISTORY_MONTH_COUNT);
00382 
00383         <span class="keywordflow">if</span> ( <a class="code" href="classInfo.html#m3">game_month</a> == finance.fiscal_year_start_month ) {
00384             <a class="code" href="classInfo.html#m6">year_passed</a>++;
00385 
00386             <a class="code" href="classInfo.html#m7">graph_year_passed</a> = min(<a class="code" href="classInfo.html#m7">graph_year_passed</a>+1, HISTORY_YEAR_COUNT);
00387             <a class="code" href="classInfo.html#m10">graph_year</a> = min(<a class="code" href="classInfo.html#m10">graph_year</a>+1, HISTORY_YEAR_COUNT);
00388         }
00389     }
00390 
00391     <span class="keywordflow">if</span>( date.year(<a class="code" href="classInfo.html#m1">game_date</a>) != <a class="code" href="classInfo.html#m4">game_year</a> ) {
00392         <a class="code" href="classInfo.html#m3">game_month</a> = 1;
00393         <a class="code" href="classInfo.html#m4">game_year</a> = date.year(<a class="code" href="classInfo.html#m1">game_date</a>);
00394     }
00395 
00396     <span class="comment">// set year_day</span>
00397     year_day = date.day_year( <a class="code" href="classInfo.html#m4">game_year</a>, <a class="code" href="classInfo.html#m3">game_month</a>, <a class="code" href="classInfo.html#m2">game_day</a> );
00398 }
00399 
00400 <span class="comment">//---------- End of function Info::inc_game_day --------//</span>
00401 
00402 <span class="comment">//-------- Begin of function Info::new_trimester_course_enrollment --------//</span>
00404 <span class="comment">void Info::new_trimester_course_enrollment() {</span>
00405     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=department_array.size() ; i&gt;0 ; i--) {
00406         <span class="keywordflow">if</span>( department_array.is_deleted(i) )
00407             <span class="keywordflow">continue</span>;
00408 
00409         <span class="comment">// clear course data in last trimester</span>
00410         department_array[i]-&gt;course_array.next_trimester();
00411         <span class="comment">//sys.yield();</span>
00412     }
00413 
00414     <span class="keywordtype">int</span> count_course = 0;
00415 
00416     <span class="keywordflow">for</span>( i=department_array.size(); i&gt;0; i--) {
00417         <span class="keywordflow">if</span>( department_array.is_deleted(i) )
00418             <span class="keywordflow">continue</span>;
00419 
00420         <a class="code" href="classDepartment.html">Department</a>* deptPtr = department_array[i];
00421 
00422         deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#a11">select_course</a>();
00423     }
00424 
00425     department_res.general_dept.student_array.select_course();
00426 
00427 <span class="preprocessor">#if(GAME_VERSION&gt;=200)                          // Item 8d v)</span>
00428 <span class="preprocessor"></span>    update_distance_learning_variables();
00429 <span class="preprocessor">#endif</span>
00430 <span class="preprocessor"></span>
00431     <span class="keywordtype">int</span> w;
00432     <span class="keywordtype">int</span> gd;
00433     avg_tal_acd = 0.0;
00434     avg_tal_ext = 0.0;
00435     avg_tal_ath = 0.0;
00436     <span class="keywordtype">int</span> total_stu_no = 0;
00437     <a class="code" href="classStudentArray.html">StudentArray</a>* stuArray_cal_tal;
00438     <a class="code" href="classStudent.html">Student</a> *studentPtr_cal_tal;
00439 
00440     <a class="code" href="ALL_8H.html#a0">err_when</a>( department_array.size() == 0 );
00441 
00442     <span class="keywordflow">for</span> ( w=department_array.size(); w&gt;=0; w-- ) {
00443         <span class="keywordflow">if</span> (w) {
00444             <span class="keywordflow">if</span> ( department_array.is_deleted(w) )
00445                 <span class="keywordflow">continue</span>;
00446             stuArray_cal_tal = &amp;(department_array[w]-&gt;student_array);
00447 
00448         }
00449         <span class="keywordflow">else</span> {
00450             stuArray_cal_tal = &amp;(department_res.general_dept.student_array);
00451         }
00452 
00453         <span class="comment">// loop student</span>
00454 
00455         <span class="keywordflow">for</span> (gd=stuArray_cal_tal-&gt;<a class="code" href="classDynArray.html#a28">size</a>(); gd&gt;0; gd--) {
00456             <span class="keywordflow">if</span> ( stuArray_cal_tal-&gt;<a class="code" href="classStudentArray.html#a9">is_deleted</a>(gd) )
00457                 <span class="keywordflow">continue</span>;
00458             studentPtr_cal_tal = stuArray_cal_tal-&gt;operator[](gd);
00459             <span class="keywordflow">if</span> ( studentPtr_cal_tal-&gt;<a class="code" href="classStudent.html#m20">talent_academic</a> == 0)
00460                 <span class="keywordflow">continue</span>;
00461             avg_tal_acd += studentPtr_cal_tal-&gt;<a class="code" href="classStudent.html#m20">talent_academic</a>;
00462             avg_tal_ext += studentPtr_cal_tal-&gt;<a class="code" href="classStudent.html#m21">talent_extracurricular</a>;
00463             avg_tal_ath += studentPtr_cal_tal-&gt;<a class="code" href="classStudent.html#m22">talent_athletics</a>;
00464             total_stu_no ++;
00465         }
00466     }
00467 
00468     avg_tal_acd /= total_stu_no;
00469     avg_tal_ext /= total_stu_no;
00470     avg_tal_ath /= total_stu_no;
00471 
00472     <span class="comment">//##200100 chea END loop all student to cal avg. talent</span>
00473 
00474     <span class="comment">//##200100 chea BEGIN loop all student to make sure they all have talent</span>
00475 
00476     <span class="keywordtype">int</span> s;
00477     <span class="keywordtype">int</span> g;
00478     <a class="code" href="classStudentArray.html">StudentArray</a>* stuArray;
00479     <a class="code" href="classStudent.html">Student</a> *studentPtr;
00480     <span class="comment">//          float talentArr[TALENT_VAR_COUNT];</span>
00481     <a class="code" href="ALL_8H.html#a0">err_when</a>( department_array.size() == 0 );
00482     <span class="keywordflow">for</span> ( s=department_array.size(); s&gt;=0; s-- ) {
00483         <span class="keywordflow">if</span> (s) {
00484             <span class="keywordflow">if</span> ( department_array.is_deleted(s) )
00485                 <span class="keywordflow">continue</span>;
00486             stuArray = &amp;(department_array[s]-&gt;student_array);
00487 
00488         }
00489         <span class="keywordflow">else</span> {
00490             stuArray = &amp;(department_res.general_dept.student_array);
00491         }
00492 
00493         <span class="comment">// loop student</span>
00494 
00495         <span class="keywordflow">for</span> (g=stuArray-&gt;<a class="code" href="classDynArray.html#a28">size</a>(); g&gt;0; g--) {
00496             <span class="keywordflow">if</span> ( stuArray-&gt;<a class="code" href="classStudentArray.html#a9">is_deleted</a>(g) )
00497                 <span class="keywordflow">continue</span>;
00498             studentPtr = stuArray-&gt;operator[](g);
00499 
00500             <span class="keywordflow">if</span> (studentPtr-&gt;<a class="code" href="classStudent.html#m20">talent_academic</a> == 0) {
00501 
00502                 <span class="comment">//try cal individual talent  BUGHERE</span>
00503                 <span class="keywordtype">char</span> studentLevel = studentPtr-&gt;<a class="code" href="classStudent.html#m2">student_level</a>;
00504                 <span class="keywordtype">char</span> stuSeg = studentPtr-&gt;<a class="code" href="classStudent.html#m4">student_segment</a>;
00505                 <span class="keywordtype">char</span> genderEthnicGroup = studentPtr-&gt;<a class="code" href="classStudent.html#m3">gender_ethnic_group</a>;
00506 
00507                 <span class="keywordflow">if</span> ( studentLevel == <a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a> ) {
00508                     <span class="comment">//-------- assume: enroll_res.init() (dbf init) called --------//</span>
00509                     studentPtr-&gt;<a class="code" href="classStudent.html#m20">talent_academic</a> = (char)(math.get_random_snd(avg_tal_acd, <span class="keywordtype">float</span>(1.5),<span class="keyword">true</span>));
00510                     studentPtr-&gt;<a class="code" href="classStudent.html#m21">talent_extracurricular</a> = (char)math.get_random_snd(avg_tal_ext, <span class="keywordtype">float</span>(1.5), <span class="keyword">true</span> );
00511                     studentPtr-&gt;<a class="code" href="classStudent.html#m22">talent_athletics</a> = (char)math.get_random_snd(avg_tal_ath, <span class="keywordtype">float</span>(1.5), <span class="keyword">true</span> );
00512                 }
00513                 <span class="keywordflow">else</span> {
00514                     <span class="comment">//-------- assume: value will be assigned after enroll_res.init_data() called</span>
00515                     <span class="keywordflow">if</span> ( studentLevel == <a class="code" href="Ostudent_8h.html#a32a6">DOCTOR</a> )
00516                         studentPtr-&gt;<a class="code" href="classStudent.html#m20">talent_academic</a> = (char)(m.fmin(100.0f, math.get_random_snd(math.single_response_func(0.7f, 1.3f, 100, 50,avg_tal_acd ), float(1.5), <span class="keyword">true</span> )));
00517                     <span class="keywordflow">else</span>
00518                         studentPtr-&gt;<a class="code" href="classStudent.html#m20">talent_academic</a> = (char)(math.get_random_snd(avg_tal_acd, <span class="keywordtype">float</span>(1.5),<span class="keyword">true</span>));
00519                     studentPtr-&gt;<a class="code" href="classStudent.html#m21">talent_extracurricular</a> = 0;
00520                     studentPtr-&gt;<a class="code" href="classStudent.html#m22">talent_athletics</a>       = 0;
00521 
00522                 }
00523             }
00524 
00525         }
00526     }
00527 }
00528 
00529 <span class="comment">//-------- End of function Info::new_trimester_course_enrollment --------//</span>
00530 
00531 <span class="comment">//-------- Begin of function Info::end_prerun_year --------//</span>
00537 <span class="comment">void Info::end_prerun_year() {</span>
00538     game_day   = 1;
00539     game_month = 9;
00540     game_year  = GAME_START_YEAR;                   <span class="comment">// may have bug if 99!!!</span>
00541 
00542     game_start_date = date.julian( game_year, game_month, game_day );
00543 
00544     game_date  = game_start_date;
00545     year_day   = date.day_year( game_year, game_month, game_day );
00546     year_passed= 1;                                 <span class="comment">// no. of years has been passed since the game begins</span>
00547 
00548     graph_year_passed = 1;
00549     graph_month_passed = 1;                         <span class="comment">// see next_day() also</span>
00550     graph_trimester_passed = 1;
00551     graph_year = 3;                                 <span class="comment">// previous, this and next year on graph</span>
00552     graph_month = 3;
00553     graph_trimester = 3;
00554     chance_event.profit_competition_act = 0;        <span class="comment">//## chea 091199 4 chance only</span>
00555 
00556     start_play_time = m.get_time();                 <span class="comment">// the time player start playing the game</span>
00557     total_play_time = 0;                            <span class="comment">// total time the player has played in all saved games</span>
00558 
00559     config.disp_year_end_report=1;                  <span class="comment">//enable end of year report</span>
00560 
00561     <span class="comment">//----- update faculty count ---------//</span>
00562 
00563     update_faculty_count();
00564 
00565     <span class="comment">//---- set player_school.sub_score_start[SCORE_VAR_COUNT], set the inputs to the trustee evaluation score at the beginning of the game ---//</span>
00566 
00567     player_school.init_score();
00568 
00569     <span class="comment">//---- call scenario initialization ----//</span>
00570 
00571     player_school.init_scenario();
00572 
00573     task_array.rand_init = 1.0f - m.random(15)/10;  <span class="comment">// for init only - do this to init the prestige</span>
00574 
00575     box.progress_update(89);
00576     box.progress_val=0;
00577 
00578     letter.init_welcome_letter();                   <span class="comment">// addif</span>
00579 
00580     <span class="comment">// ##### begin Marco ##### //</span>
00581 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00582 <span class="preprocessor"></span>    finance.save_initial_value();
00583     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = department_array.size() ; i &gt; 0; i--)
00584         department_array[i]-&gt;save_initial_data();
00585 
00586     department_array.save_initial_data();
00587     player_school.save_initial_data();
00588 
00589     <span class="comment">// not update_appropiation here, moved to new Finance::new_fiscal_year</span>
00590     <span class="comment">//if ( player_school.is_public() )</span>
00591     <span class="comment">//{</span>
00592     <span class="comment">//  finance.update_appropiation();</span>
00593     <span class="comment">//  double temp = finance.revenue_array[AC_STATE_APPROPRIATION].total;</span>
00594     <span class="comment">//  RevenueItemChange* projRev;</span>
00595     <span class="comment">//  projRev = &amp;finance.projected_revenue_array[AC_STATE_APPROPRIATION];</span>
00596     <span class="comment">//  projRev-&gt;change_budget_year.total</span>
00597     <span class="comment">//          = finance.calc_change( finance.budget_revenue_array[AC_STATE_APPROPRIATION].total, temp );</span>
00598     <span class="comment">//  projRev-&gt;change_last_year.total = finance.calc_change( projRev-&gt;this_year.total, temp );</span>
00599     <span class="comment">//}</span>
00600 
00601     enroll_res.save_initial_data();
00602     development_office.save_initial_data();
00603     facility_office.save_initial_data();
00604     library_tech_office.save_initial_data();
00605     investment_office.save_initial_data();
00606     department_res.general_dept.save_initial_data();
00607     athletics_office.save_initial_data();
00608 <span class="preprocessor">#endif</span>
00609 <span class="preprocessor"></span>    <span class="comment">// ##### End Marco ##### //</span>
00610 
00611     <span class="comment">//--- reset info.prerun_year to 0 -----//</span>
00612 
00613     info.prerun_year=0;
00614 
00615 }
00616 
00617 <span class="comment">//-------- End of function Info::end_prerun_year --------//</span>
00618 
00619 <span class="comment">//-------- Begin of function update_faculty_count --------//</span>
00623 <span class="comment">static void update_faculty_count() {</span>
00624     <span class="comment">//------ for init letter loop faculty ------//</span>
00625 
00626     department_array.faculty_count_tenured = 0;
00627     department_array.faculty_count_on_tenure_line = 0;
00628     <a class="code" href="classDepartment.html">Department</a>* departPtr;
00629 
00630     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> cond=department_array.size(); cond&gt;=0; cond-- ) {
00631         <span class="keywordflow">if</span> ( department_array.is_deleted(cond) )
00632             <span class="keywordflow">continue</span>;
00633 
00634         departPtr = department_array[cond];
00635 
00636         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> con = departPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classDynArray.html#a28">size</a>(); con&gt;0; con--) {
00637             <span class="keywordflow">if</span> (departPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#a10">is_deleted</a>(con))
00638                 <span class="keywordflow">continue</span>;
00639 
00640             <span class="keywordflow">switch</span>(departPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>[con]-&gt;rank_level) {
00641             <span class="keywordflow">case</span> <a class="code" href="Ofaculty_8h.html#a27a10">ASSOC_PROF</a>:
00642             <span class="keywordflow">case</span> <a class="code" href="Ofaculty_8h.html#a27a11">FULL_PROF</a>:
00643                 department_array.faculty_count_tenured++;
00644             <span class="keywordflow">case</span> <a class="code" href="Ofaculty_8h.html#a27a9">ASST_PROF</a>:
00645                 department_array.faculty_count_on_tenure_line++;
00646                 <span class="keywordflow">break</span>;
00647             }
00648 
00649             <span class="comment">//----- try to end the prerun year research project -----//</span>
00650 
00651             <span class="keywordtype">int</span> testU =0;
00652             <span class="keywordtype">int</span> testU1 =0;
00653             <a class="code" href="classFaculty.html">Faculty</a>* facultyPtr;                        <span class="comment">// for test only</span>
00654 
00655             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> e = 0; e &lt; <a class="code" href="Ofaculty_8h.html#a5">MAX_RESEARCH_PROPOSAL</a> ; e++) {
00656                 testU = departPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>[con]-&gt;research_proposal_array[e].date_to_next_status;
00657 
00658                 <span class="keywordflow">if</span>(departPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>[con]-&gt;research_proposal_array[e].date_to_next_status!=0)
00659                     departPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>[con]-&gt;research_proposal_array[e].date_to_next_status -= 365;
00660 
00661                 facultyPtr = departPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>[con];
00662                 testU1 = departPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>[con]-&gt;research_proposal_array[e].date_to_next_status;
00663             }
00664         }
00665     }
00666 }
00667 
00668 <span class="comment">//-------- End of function update_faculty_count --------//</span>
00669 
00670 <span class="comment">//-------- Begin of function Info::disp_panel_init --------//</span>
<a name="l00672"></a><a class="code" href="classInfo.html#a12">00672</a> <span class="comment">bool Info::is_begin_trimester() {</span>
00673     <span class="keywordflow">return</span> ( game_day == player_school.trimester_array[player_school.cur_trimester].start_day
00674              &amp;&amp; game_month == player_school.trimester_array[player_school.cur_trimester].start_month );
00675 }
00676 
00677 <span class="comment">//-------- Begin of function Info::disp_panel_init --------//</span>
00678 
00679 <span class="comment">//-------- Begin of function Info::disp_panel_init --------//</span>
<a name="l00681"></a><a class="code" href="classInfo.html#a8">00681</a> <span class="comment">void Info::disp_panel_init() {</span>
00682     image_interface.put_large( &amp;vga_back, 0, 0, <span class="stringliteral">"MAINSCR2"</span> );
00683 
00684     <span class="comment">//------ keep a copy of bitmap of the panel texture -----//</span>
00685 
00686     top_info_bitmap = vga_back.save_area( <a class="code" href="Oinfo_8h.html#a107a42">TOP_INFO_X1</a>, <a class="code" href="Oinfo_8h.html#a107a43">TOP_INFO_Y1</a>+4, <a class="code" href="Oinfo_8h.html#a107a44">TOP_INFO_X2</a>, <a class="code" href="Oinfo_8h.html#a107a45">TOP_INFO_Y2</a>);
00687     bottom_info_bitmap = vga_back.save_area( <a class="code" href="Oinfo_8h.html#a108a46">BOTTOM_INFO_X1</a>, <a class="code" href="Oinfo_8h.html#a108a47">BOTTOM_INFO_Y1</a>, <a class="code" href="Oinfo_8h.html#a108a48">BOTTOM_INFO_X2</a>, <a class="code" href="Oinfo_8h.html#a108a49">BOTTOM_INFO_Y2</a>);
00688     surplus_info_bitmap = vga_back.save_area( <a class="code" href="Oinfo_8h.html#a101a12">SURPLUS_INFO_X1</a>, <a class="code" href="Oinfo_8h.html#a101a13">SURPLUS_INFO_Y1</a>, <a class="code" href="Oinfo_8h.html#a101a14">SURPLUS_INFO_X2</a>, <a class="code" href="Oinfo_8h.html#a101a15">SURPLUS_INFO_Y2</a>);
00689     score_info_bitmap = vga_back.save_area( <a class="code" href="Oinfo_8h.html#a102a16">SCORE_INFO_X1</a>, <a class="code" href="Oinfo_8h.html#a102a17">SCORE_INFO_Y1</a>, <a class="code" href="Oinfo_8h.html#a102a18">SCORE_INFO_X2</a>, <a class="code" href="Oinfo_8h.html#a102a19">SCORE_INFO_Y2</a>);
00690 
00691     <span class="comment">// ## begin zb 02/21/99</span>
00692     uscore_info_bitmap = vga_back.save_area( <a class="code" href="Oinfo_8h.html#a103a20">U_SCORE_INFO_X1</a>, <a class="code" href="Oinfo_8h.html#a103a21">U_SCORE_INFO_Y1</a>, <a class="code" href="Oinfo_8h.html#a103a22">U_SCORE_INFO_X2</a>+10, <a class="code" href="Oinfo_8h.html#a103a23">U_SCORE_INFO_Y2</a>);
00693     <span class="comment">// ## end zb 02/21/99</span>
00694 
00695     more_report_bitmap = vga_back.save_area( <a class="code" href="Oinfo_8h.html#a109a50">MORE_REPORT_X1</a>, <a class="code" href="Oinfo_8h.html#a109a51">MORE_REPORT_Y1</a>+2, <a class="code" href="Oinfo_8h.html#a109a52">MORE_REPORT_X2</a>, <a class="code" href="Oinfo_8h.html#a109a53">MORE_REPORT_Y2</a>);
00696     help_quest_bitmap = vga_back.save_area( <a class="code" href="Oinfo_8h.html#a110a54">HELP_QUEST_X1</a>, <a class="code" href="Oinfo_8h.html#a110a55">HELP_QUEST_Y1</a>+2, <a class="code" href="Oinfo_8h.html#a110a56">HELP_QUEST_X2</a>, <a class="code" href="Oinfo_8h.html#a110a57">HELP_QUEST_Y2</a>);
00697     list_button_bitmap = vga_back.save_area( <a class="code" href="Oinfo_8h.html#a111a58">LIST_BUTTON_X1</a>, <a class="code" href="Oinfo_8h.html#a111a59">LIST_BUTTON_Y1</a>, <a class="code" href="Oinfo_8h.html#a111a60">LIST_BUTTON_X2</a>, <a class="code" href="Oinfo_8h.html#a111a61">LIST_BUTTON_Y2</a>);
00698     date_info_bitmap = vga_back.save_area( <a class="code" href="Oinfo_8h.html#a105a34">DATE_INFO_X1</a>, <a class="code" href="Oinfo_8h.html#a105a35">DATE_INFO_Y1</a>, <a class="code" href="Oinfo_8h.html#a105a36">DATE_INFO_X2</a>, <a class="code" href="Oinfo_8h.html#a105a37">DATE_INFO_Y2</a>);
00699     year_info_bitmap = vga_back.save_area( <a class="code" href="Oinfo_8h.html#a106a38">YEAR_INFO_X1</a>, <a class="code" href="Oinfo_8h.html#a106a39">YEAR_INFO_Y1</a>, <a class="code" href="Oinfo_8h.html#a106a40">YEAR_INFO_X2</a>, <a class="code" href="Oinfo_8h.html#a106a41">YEAR_INFO_Y2</a>);
00700 
00701     <span class="comment">//--- save areas of the column bitmap that touch the zoom viewing area ---//</span>
00702 
00703     top_left_column_bitmap = vga_back.save_area( <a class="code" href="Oworldmt_8h.html#a12">ZOOM_X1</a>, <a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a>, <a class="code" href="Oworldmt_8h.html#a12">ZOOM_X1</a>+<a class="code" href="Oinfo_8h.html#a100a10">COLUMN_WIDTH</a>-1, <a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a>+<a class="code" href="Oinfo_8h.html#a100a11">COLUMN_HEIGHT</a>-1);
00704     top_right_column_bitmap = vga_back.save_area( <a class="code" href="Oworldmt_8h.html#a14">ZOOM_X2</a>-<a class="code" href="Oinfo_8h.html#a100a10">COLUMN_WIDTH</a>+1, <a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a>, <a class="code" href="Oworldmt_8h.html#a14">ZOOM_X2</a>, <a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a>+<a class="code" href="Oinfo_8h.html#a100a11">COLUMN_HEIGHT</a>-1);
00705 
00706     bottom_left_column_bitmap = vga_back.save_area( <a class="code" href="Oworldmt_8h.html#a12">ZOOM_X1</a>, <a class="code" href="Oworldmt_8h.html#a15">ZOOM_Y2</a>-<a class="code" href="Oinfo_8h.html#a100a11">COLUMN_HEIGHT</a>+1, <a class="code" href="Oworldmt_8h.html#a12">ZOOM_X1</a>+<a class="code" href="Oinfo_8h.html#a100a10">COLUMN_WIDTH</a>-1, <a class="code" href="Oworldmt_8h.html#a15">ZOOM_Y2</a>);
00707     bottom_right_column_bitmap = vga_back.save_area( <a class="code" href="Oworldmt_8h.html#a14">ZOOM_X2</a>-<a class="code" href="Oinfo_8h.html#a100a10">COLUMN_WIDTH</a>+1, <a class="code" href="Oworldmt_8h.html#a15">ZOOM_Y2</a>-<a class="code" href="Oinfo_8h.html#a100a11">COLUMN_HEIGHT</a>+1, <a class="code" href="Oworldmt_8h.html#a14">ZOOM_X2</a>, <a class="code" href="Oworldmt_8h.html#a15">ZOOM_Y2</a>);
00708 
00709     <span class="comment">//------ store frequent used bitmaps into memory -----//</span>
00710 
00711     menu_up_bitmap = vga_back.save_area(<a class="code" href="Oinfo_8h.html#a98a2">MENU_BUTTON_X1</a>, <a class="code" href="Oinfo_8h.html#a98a3">MENU_BUTTON_Y1</a>, <a class="code" href="Oinfo_8h.html#a98a4">MENU_BUTTON_X2</a>, <a class="code" href="Oinfo_8h.html#a98a5">MENU_BUTTON_Y2</a>);
00712     vga_back.put_bitmap(<a class="code" href="Oinfo_8h.html#a98a2">MENU_BUTTON_X1</a>, <a class="code" href="Oinfo_8h.html#a98a3">MENU_BUTTON_Y1</a>, image_interface.get_ptr(<span class="stringliteral">"MENUDOWN"</span>));
00713     menu_down_bitmap = vga_back.save_area(<a class="code" href="Oinfo_8h.html#a98a2">MENU_BUTTON_X1</a>, <a class="code" href="Oinfo_8h.html#a98a3">MENU_BUTTON_Y1</a>, <a class="code" href="Oinfo_8h.html#a98a4">MENU_BUTTON_X2</a>, <a class="code" href="Oinfo_8h.html#a98a5">MENU_BUTTON_Y2</a>);
00714 
00715     <span class="keywordtype">short</span> *bitmapPtr = (<span class="keywordtype">short</span> *)image_interface.get_ptr(<span class="stringliteral">"REPORT-0"</span>);
00716 
00717     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="Oinfo_8h.html#a97a1">REPORT_ITEMS</a>+1; i++)
00718         report_bitmap[i] = <a class="code" href="ALL_8H.html#a5">mem_add</a>(*(bitmapPtr) * *(bitmapPtr+1) + 2*<span class="keyword">sizeof</span>(<span class="keywordtype">short</span>));
00719 
00720     <span class="comment">//  char *strBuf = "REPORT-?";</span>
00721     <span class="keywordtype">char</span> strBuf[100];
00722     strcpy(strBuf,<span class="stringliteral">"REPORT-?"</span>);
00723 
00724     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="Oinfo_8h.html#a97a1">REPORT_ITEMS</a>+1; i++) {          <span class="comment">// 0 is the bitmap without all pressed buttons</span>
00725         strBuf[7] = i + <span class="charliteral">'0'</span>;
00726         bitmapPtr = (<span class="keywordtype">short</span> *)image_interface.get_ptr(strBuf);
00727         memcpy(report_bitmap[i], bitmapPtr, *(bitmapPtr) * *(bitmapPtr+1) + 2);
00728     }
00729 }
00730 
00731 <span class="comment">//--------- End of function Info::disp_panel_init ---------//</span>
00732 
00733 <span class="comment">//-------- Begin of function Info::disp --------//</span>
<a name="l00735"></a><a class="code" href="classInfo.html#a10">00735</a> <span class="comment">void Info::disp() {</span>
00736     <span class="keywordflow">if</span>( sys.signal_exit_flag )
00737         <span class="keywordflow">return</span>;
00738 
00739     <span class="comment">//-- Display the name of the selected department or the current report. --//</span>
00740 
00741     disp_selected_name();
00742 
00743     <span class="comment">//-------- display surplus ---------------//</span>
00744 
00745     vga.use_back();
00746     vga_back.rest_area( surplus_info_bitmap, 0 );
00747     font_fdiamond.center_put(<a class="code" href="Oinfo_8h.html#a101a12">SURPLUS_INFO_X1</a>, <a class="code" href="Oinfo_8h.html#a101a13">SURPLUS_INFO_Y1</a>, <a class="code" href="Oinfo_8h.html#a101a14">SURPLUS_INFO_X2</a>, <a class="code" href="Oinfo_8h.html#a101a15">SURPLUS_INFO_Y2</a>, m.format((<span class="keywordtype">float</span>)((<span class="keywordtype">int</span>)finance.this_year.surplus_deficit),7));
00748     vga.use_front();
00749 
00750     vga.blt_buf(<a class="code" href="Oinfo_8h.html#a101a12">SURPLUS_INFO_X1</a>, <a class="code" href="Oinfo_8h.html#a101a13">SURPLUS_INFO_Y1</a>, <a class="code" href="Oinfo_8h.html#a101a14">SURPLUS_INFO_X2</a>, <a class="code" href="Oinfo_8h.html#a101a15">SURPLUS_INFO_Y2</a>);
00751 
00752     <span class="comment">//-------- display calendar ----------//</span>
00753 
00754     disp_calendar();
00755 
00756     <span class="comment">//-------- display game score ------------//</span>
00757 
00758     <span class="keywordtype">int</span>    scoreChange = (int)player_school.cur_game_score - (int)player_school.game_score_history[THIS_MONTH-1];
00759     <a class="code" href="classString.html">String</a> str;
00760 
00761     image_interface.put_back( 578, 0, <span class="stringliteral">"CUP"</span> );
00762     vga.blt_buf(578,0,623,31);
00763 
00764     <span class="comment">// format type 4 - no thousand separators</span>
00765     str = m.format( (<span class="keywordtype">int</span>) player_school.cur_game_score, 4 );
00766 
00767     <span class="keywordflow">if</span>( scoreChange &gt;= 0 ) {
00768         image_interface.put_back(514, 0, <span class="stringliteral">"REPU-UP"</span> );
00769         vga.blt_buf(514,0,544,29);
00770     }
00771     <span class="keywordflow">else</span> {
00772         image_interface.put_back( 508, 0, <span class="stringliteral">"REPU-DWN"</span> );
00773         vga.blt_buf(514,0,544,29);
00774     }
00775 
00776     <span class="comment">/*  if( scoreChange )</span>
00777 <span class="comment">        {</span>
00778 <span class="comment">        str += " (";</span>
00779 <span class="comment"></span>
00780 <span class="comment">        if( scoreChange &gt; 0 )</span>
00781 <span class="comment">        str += "+";</span>
00782 <span class="comment">        else</span>
00783 <span class="comment">        str += "-";</span>
00784 <span class="comment"></span>
00785 <span class="comment">        str += abs(scoreChange);</span>
00786 <span class="comment">        str += ")";</span>
00787 <span class="comment">        }</span>
00788 <span class="comment">    */</span>
00789     vga.use_back();
00790     vga_back.rest_area(score_info_bitmap,0,0);
00791     <span class="comment">//  mouse.hide_area(SCORE_INFO_X1, SCORE_INFO_Y1, SCORE_INFO_X2, SCORE_INFO_Y2);</span>
00792     font_numbers.put( <a class="code" href="Oinfo_8h.html#a102a16">SCORE_INFO_X1</a>, <a class="code" href="Oinfo_8h.html#a102a17">SCORE_INFO_Y1</a>, str, 1, <a class="code" href="Oinfo_8h.html#a102a18">SCORE_INFO_X2</a> );
00793     <span class="comment">//  mouse.show_area();</span>
00794     vga.blt_buf(<a class="code" href="Oinfo_8h.html#a102a16">SCORE_INFO_X1</a>, <a class="code" href="Oinfo_8h.html#a102a17">SCORE_INFO_Y1</a>, <a class="code" href="Oinfo_8h.html#a102a18">SCORE_INFO_X2</a>, <a class="code" href="Oinfo_8h.html#a102a19">SCORE_INFO_Y2</a>);
00795 
00796     <span class="comment">// format type 4 - no thousand separators</span>
00797     str = m.format( (<span class="keywordtype">int</span>)player_school.ultimate_game_score, 4 );
00798     vga_back.rest_area(uscore_info_bitmap,0,0);
00799 
00800     <span class="comment">//---- display ultimate score -----//</span>
00801 
00802     <span class="keywordflow">if</span>( player_school.ultimate_game_score &gt; 0 )
00803         font_numbers.put( <a class="code" href="Oinfo_8h.html#a103a20">U_SCORE_INFO_X1</a>, <a class="code" href="Oinfo_8h.html#a103a21">U_SCORE_INFO_Y1</a>, str, 1, <a class="code" href="Oinfo_8h.html#a103a22">U_SCORE_INFO_X2</a>+10 );
00804     <span class="keywordflow">else</span>                                            <span class="comment">// font_numbers does not have "(" &amp; ")" characters, we have to use a different font</span>
00805         font_redcharts.put( <a class="code" href="Oinfo_8h.html#a103a20">U_SCORE_INFO_X1</a>, <a class="code" href="Oinfo_8h.html#a103a21">U_SCORE_INFO_Y1</a>-5, str, 1, <a class="code" href="Oinfo_8h.html#a103a22">U_SCORE_INFO_X2</a>+10 );
00806 
00807     vga.blt_buf(<a class="code" href="Oinfo_8h.html#a103a20">U_SCORE_INFO_X1</a>, <a class="code" href="Oinfo_8h.html#a103a21">U_SCORE_INFO_Y1</a>, <a class="code" href="Oinfo_8h.html#a103a22">U_SCORE_INFO_X2</a>+10, <a class="code" href="Oinfo_8h.html#a103a23">U_SCORE_INFO_Y2</a>);
00808 
00809     <span class="comment">//-------- display more report button ---------------//</span>
00810     vga_back.rest_area(more_report_bitmap,0,0);
00811     <span class="comment">//  mouse.hide_area(MORE_REPORT_X1, MORE_REPORT_Y1, MORE_REPORT_X2, MORE_REPORT_Y2);</span>
00812     <span class="keywordflow">if</span>(sys.view_mode==<a class="code" href="Osys_8h.html#a45a19">MODE_MORE_REPORT</a>)
00813         font_hstone.put( <a class="code" href="Oinfo_8h.html#a109a50">MORE_REPORT_X1</a>, <a class="code" href="Oinfo_8h.html#a109a51">MORE_REPORT_Y1</a>-1, <span class="stringliteral">"more reports"</span>, 1, <a class="code" href="Oinfo_8h.html#a109a52">MORE_REPORT_X2</a> );
00814     <span class="keywordflow">else</span>
00815         font_stone.put( <a class="code" href="Oinfo_8h.html#a109a50">MORE_REPORT_X1</a>, <a class="code" href="Oinfo_8h.html#a109a51">MORE_REPORT_Y1</a>-1, <span class="stringliteral">"more reports"</span>, 1, <a class="code" href="Oinfo_8h.html#a109a52">MORE_REPORT_X2</a> );
00816     <span class="comment">//  mouse.show_area();</span>
00817     vga.blt_buf(<a class="code" href="Oinfo_8h.html#a109a50">MORE_REPORT_X1</a>, <a class="code" href="Oinfo_8h.html#a109a51">MORE_REPORT_Y1</a>-1, <a class="code" href="Oinfo_8h.html#a109a52">MORE_REPORT_X2</a>, <a class="code" href="Oinfo_8h.html#a109a53">MORE_REPORT_Y2</a>);
00818 
00819     <span class="comment">//-------- display help quest button ---------------//</span>
00820     vga_back.rest_area(help_quest_bitmap,0,0);
00821     <span class="comment">//  mouse.hide_area(MORE_REPORT_X1, MORE_REPORT_Y1, MORE_REPORT_X2, MORE_REPORT_Y2);</span>
00822     <span class="keywordflow">if</span>(sys.view_mode==<a class="code" href="Osys_8h.html#a45a30">MODE_HELP_TOPIC</a>)
00823         font_hstone.put( <a class="code" href="Oinfo_8h.html#a110a54">HELP_QUEST_X1</a>, <a class="code" href="Oinfo_8h.html#a110a55">HELP_QUEST_Y1</a>-1, <span class="stringliteral">"?"</span>, 1, <a class="code" href="Oinfo_8h.html#a110a56">HELP_QUEST_X2</a> );
00824     <span class="keywordflow">else</span>
00825         font_stone.put( <a class="code" href="Oinfo_8h.html#a110a54">HELP_QUEST_X1</a>, <a class="code" href="Oinfo_8h.html#a110a55">HELP_QUEST_Y1</a>-1, <span class="stringliteral">"?"</span>, 1, <a class="code" href="Oinfo_8h.html#a110a56">HELP_QUEST_X2</a> );
00826     <span class="comment">//  mouse.show_area();</span>
00827     vga.blt_buf(<a class="code" href="Oinfo_8h.html#a110a54">HELP_QUEST_X1</a>, <a class="code" href="Oinfo_8h.html#a110a55">HELP_QUEST_Y1</a>-1, <a class="code" href="Oinfo_8h.html#a110a56">HELP_QUEST_X2</a>, <a class="code" href="Oinfo_8h.html#a110a57">HELP_QUEST_Y2</a>);
00828 
00829 }
00830 
00831 <span class="comment">//-------- End of function Info::disp --------//</span>
00832 
00833 <span class="comment">//-------- Begin of function Info::disp_column_bitmap --------//</span>
<a name="l00837"></a><a class="code" href="classInfo.html#a9">00837</a> <span class="comment">void Info::disp_column_bitmap(VgaBuf* vgaBuf) {</span>
00838     vgaBuf-&gt;rest_area( top_left_column_bitmap, 0, 1 );
00839     vgaBuf-&gt;rest_area( top_right_column_bitmap, 0, 1 );
00840 
00841     vgaBuf-&gt;rest_area( bottom_left_column_bitmap, 0, 1 );
00842     vgaBuf-&gt;rest_area( bottom_right_column_bitmap, 0, 1 );
00843 }
00844 
00845 <span class="comment">//-------- End of function Info::disp_column_bitmap --------//</span>
00846 
00847 <span class="comment">//-------- Begin of function Info::disp_selected_name --------//</span>
00851 <span class="comment">void Info::disp_selected_name() {</span>
00852     <span class="comment">//------ display the selected department name ------//</span>
00853 
00854     vga_back.rest_area( top_info_bitmap, 0 );
00855 
00856     <a class="code" href="classString.html">String</a> deptStr;
00857 
00858     <span class="comment">//-- if the report of a non-department building is being displayed currently --//</span>
00859 
00860     <span class="keywordflow">if</span>( sys.is_institution_report ) {               <span class="comment">// if the report currently displayed is institution-wide</span>
00861 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00862 <span class="preprocessor"></span>        <span class="keywordflow">if</span>( sys.view_mode &gt;= <a class="code" href="Osys_8h.html#a45a38">MODE_FIRST_NONDEPARTMENTAL_FIRM</a> &amp;&amp; sys.view_mode &lt;= <a class="code" href="Osys_8h.html#a45a39">MODE_LAST_NONDEPARTMENTAL_FIRM</a> )
00863             deptStr = firm_res[sys.view_mode - <a class="code" href="Osys_8h.html#a45a38">MODE_FIRST_NONDEPARTMENTAL_FIRM</a> + <a class="code" href="OFIRMID_8H.html#a21a1">FIRST_NONDEPARTMENTAL_FIRM_ID</a>]-&gt;name;
00864         <span class="keywordflow">else</span>
00865 <span class="preprocessor">#endif</span>
00866 <span class="preprocessor"></span>            deptStr = player_school.school_name;
00867     }
00868 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00869 <span class="preprocessor"></span><span class="preprocessor">#else</span>
00870 <span class="preprocessor"></span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( sys.view_mode &gt;= <a class="code" href="Osys_8h.html#a45a38">MODE_FIRST_NONDEPARTMENTAL_FIRM</a> &amp;&amp;
00871              sys.view_mode &lt;= <a class="code" href="Osys_8h.html#a45a39">MODE_LAST_NONDEPARTMENTAL_FIRM</a> ) {
00872         deptStr = firm_res[sys.view_mode - <a class="code" href="Osys_8h.html#a45a38">MODE_FIRST_NONDEPARTMENTAL_FIRM</a> + 1]-&gt;name;
00873     }
00874 <span class="preprocessor">#endif</span>
00875 <span class="preprocessor"></span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( department_array.selected_recno ) {
00876         <span class="comment">//              deptStr  = department_array.selected_recno;</span>
00877         <span class="comment">//              deptStr += ". ";</span>
00878         <span class="comment">//              deptStr = department_array[department_array.selected_recno]-&gt;name();</span>
00879         deptStr = department_res[department_array[department_array.selected_recno]-&gt;department_id]-&gt;name;
00880         deptStr += <span class="stringliteral">" Department"</span>;
00881     }
00882 
00883     <span class="keywordflow">if</span>( deptStr.<a class="code" href="classString.html#a5">len</a>() &gt; 0 ) {
00884         <span class="comment">//------- De-Capitalize the string --------//</span>
00885 
00886         <span class="keywordflow">for</span>( <span class="keywordtype">char</span> *strPtr = deptStr.<a class="code" href="classString.html#m0">str_buf</a>; *strPtr != <a class="code" href="OHELP_8H.html#a0">NULL</a>; strPtr++ ) {
00887             <span class="keywordflow">if</span> (*strPtr &gt;= <span class="charliteral">'A'</span> &amp;&amp; *strPtr &lt;= <span class="charliteral">'Z'</span>)
00888                 *strPtr += 32;
00889             <span class="keywordflow">if</span> (*strPtr ==<span class="charliteral">':'</span>)
00890                 *strPtr = <span class="charliteral">':'</span>+2;
00891         }
00892 
00893         vga.use_back();
00894         font_stone.center_put(<a class="code" href="Oinfo_8h.html#a107a42">TOP_INFO_X1</a>, <a class="code" href="Oinfo_8h.html#a107a43">TOP_INFO_Y1</a>, <a class="code" href="Oinfo_8h.html#a107a44">TOP_INFO_X2</a>, <a class="code" href="Oinfo_8h.html#a107a45">TOP_INFO_Y2</a>, deptStr);
00895         vga.use_front();
00896     }
00897 
00898     vga.blt_buf( <a class="code" href="Oinfo_8h.html#a107a42">TOP_INFO_X1</a>, <a class="code" href="Oinfo_8h.html#a107a43">TOP_INFO_Y1</a>+4, <a class="code" href="Oinfo_8h.html#a107a44">TOP_INFO_X2</a>, <a class="code" href="Oinfo_8h.html#a107a45">TOP_INFO_Y2</a> );
00899 
00900     <span class="comment">//------ display the touched firm name ------//</span>
00901 
00902     vga_back.rest_area( bottom_info_bitmap, 0 );
00903 
00904     <span class="keywordflow">if</span>( sys.view_mode == <a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a> &amp;&amp;             <span class="comment">// only display it in the campus view, as it displays the building the mouse is current over</span>
00905         firm_array.touched_recno &amp;&amp;
00906         <span class="comment">// it was just touched</span>
00907         sys.frame_count - firm_array.touched_frame_count &lt;= 1 ) {
00908         <a class="code" href="classString.html">String</a> deptStr(firm_array[firm_array.touched_recno]-&gt;name());
00909 
00910         <span class="comment">//              for (char *strPtr = deptStr.str_buf; *strPtr != NULL; strPtr++)</span>
00911         <span class="comment">//              {</span>
00912         <span class="comment">//              if (*strPtr &gt;= 'a' &amp;&amp; *strPtr &lt;= 'z')</span>
00913         <span class="comment">//                      *strPtr -= 32;                                                  // Capitalize the string</span>
00914         <span class="comment">//              }</span>
00915         <span class="keywordflow">for</span>( <span class="keywordtype">char</span> *strPtr = deptStr.<a class="code" href="classString.html#m0">str_buf</a>; *strPtr != <a class="code" href="OHELP_8H.html#a0">NULL</a>; strPtr++ ) {
00916             <span class="keywordflow">if</span> (*strPtr &gt;= <span class="charliteral">'A'</span> &amp;&amp; *strPtr &lt;= <span class="charliteral">'Z'</span>)
00917                 *strPtr += 32;
00918             <span class="keywordflow">if</span> (*strPtr ==<span class="charliteral">':'</span>)
00919                 *strPtr = <span class="charliteral">':'</span>+2;
00920         }
00921 
00922         vga.use_back();
00923         font_stone.center_put(<a class="code" href="Oinfo_8h.html#a108a46">BOTTOM_INFO_X1</a>, <a class="code" href="Oinfo_8h.html#a108a47">BOTTOM_INFO_Y1</a>, <a class="code" href="Oinfo_8h.html#a108a48">BOTTOM_INFO_X2</a>, <a class="code" href="Oinfo_8h.html#a108a49">BOTTOM_INFO_Y2</a>, deptStr);
00924         vga.use_front();
00925     }
00926 
00927     vga.blt_buf( <a class="code" href="Oinfo_8h.html#a108a46">BOTTOM_INFO_X1</a>, <a class="code" href="Oinfo_8h.html#a108a47">BOTTOM_INFO_Y1</a>, <a class="code" href="Oinfo_8h.html#a108a48">BOTTOM_INFO_X2</a>, <a class="code" href="Oinfo_8h.html#a108a49">BOTTOM_INFO_Y2</a> );
00928 }
00929 
00930 <span class="comment">//-------- End of function Info::disp_selected_name --------//</span>
00931 
00932 <span class="comment">//-------- Begin of function Info::disp_calendar --------//</span>
00933 
00934 <span class="keywordtype">void</span> Info::disp_calendar() {
00935     <span class="comment">//-------- display day ---------------//</span>
00936 
00937     <span class="keywordtype">int</span> newDay;
00938 
00939     <span class="keywordflow">if</span> (last_day != (newDay = date.day(info.game_date))||sys.redraw_all_flag==1) {
00940         mouse.hide_area(<a class="code" href="Oinfo_8h.html#a105a34">DATE_INFO_X1</a>,<a class="code" href="Oinfo_8h.html#a105a35">DATE_INFO_Y1</a>,<a class="code" href="Oinfo_8h.html#a105a36">DATE_INFO_X2</a>,<a class="code" href="Oinfo_8h.html#a105a37">DATE_INFO_Y2</a>);
00941         vga_front.rest_area( date_info_bitmap, 0 );
00942         <span class="keywordtype">char</span> digitStr[2];
00943         digitStr[1] = <span class="charliteral">'\0'</span>;
00944         digitStr[0] = char(newDay % 10) + <span class="charliteral">'0'</span>;
00945         <span class="keywordflow">if</span> (newDay &gt; 9) {
00946             vga_front.put_bitmap_trans(day_x1_2, digit_y1, date_res_bitmap.<a class="code" href="classImageRes.html#a7">get_ptr</a>(digitStr));
00947             digitStr[0] = char(newDay / 10) + <span class="charliteral">'0'</span>;
00948             vga_front.put_bitmap_trans(day_x1_1, digit_y1, date_res_bitmap.<a class="code" href="classImageRes.html#a7">get_ptr</a>(digitStr));
00949         }
00950         <span class="keywordflow">else</span> {
00951             vga_front.put_bitmap_trans(day_x1_0, digit_y1, date_res_bitmap.<a class="code" href="classImageRes.html#a7">get_ptr</a>(digitStr));
00952         }
00953         mouse.show_area();
00954         last_day = newDay;
00955     }
00956 
00957     <span class="comment">//-------- display year ---------------//</span>
00958 
00959     <span class="keywordtype">int</span> newYear;
00960 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00961 <span class="preprocessor"></span>    <span class="keywordflow">if</span>( last_year != (newYear=info.financial_year()) || sys.redraw_all_flag==1 )
00962 <span class="preprocessor">#else</span>
00963 <span class="preprocessor"></span>        <span class="keywordflow">if</span>( last_year != (newYear=info.game_year) || sys.redraw_all_flag==1 )
00964 <span class="preprocessor">#endif</span>
00965 <span class="preprocessor"></span>        {
00966             mouse.hide_area(<a class="code" href="Oinfo_8h.html#a106a38">YEAR_INFO_X1</a>,<a class="code" href="Oinfo_8h.html#a106a39">YEAR_INFO_Y1</a>,<a class="code" href="Oinfo_8h.html#a106a40">YEAR_INFO_X2</a>,<a class="code" href="Oinfo_8h.html#a106a41">YEAR_INFO_Y2</a>);
00967             vga_front.rest_area( year_info_bitmap, 0 );
00968             <span class="keywordtype">char</span> digitStr[2];
00969             digitStr[1] = <span class="charliteral">'\0'</span>;
00970             digitStr[0] = char((newYear % 100) / 10) + <span class="charliteral">'0'</span>;
00971             vga_front.put_bitmap_trans(year_x1_1, digit_y1, date_res_bitmap.<a class="code" href="classImageRes.html#a7">get_ptr</a>(digitStr));
00972             digitStr[0] = char(newYear % 10) + <span class="charliteral">'0'</span>;
00973             vga_front.put_bitmap_trans(year_x1_2, digit_y1, date_res_bitmap.<a class="code" href="classImageRes.html#a7">get_ptr</a>(digitStr));
00974             mouse.show_area();
00975             last_year = newYear;
00976         }
00977 
00978     <span class="comment">//--------- display trimester --------//</span>
00979 
00980     <span class="keywordtype">char</span>* bitmapNameArray[] = { <span class="stringliteral">"FALL"</span>, <span class="stringliteral">"WINTER"</span>, <span class="stringliteral">"SUMMER"</span> };
00981 
00982     mouse.hide_area(<a class="code" href="Oinfo_8h.html#a106a38">YEAR_INFO_X1</a>,<a class="code" href="Oinfo_8h.html#a106a39">YEAR_INFO_Y1</a>,<a class="code" href="Oinfo_8h.html#a106a40">YEAR_INFO_X2</a>,<a class="code" href="Oinfo_8h.html#a106a41">YEAR_INFO_Y2</a>);
00983     <span class="keywordflow">if</span>( player_school.is_trimester_off )            <span class="comment">// Trimester break;</span>
00984         vga_front.put_bitmap(<a class="code" href="Oinfo_8h.html#a104a26">SEASON_X1</a>, <a class="code" href="Oinfo_8h.html#a104a27">SEASON_Y1</a>, date_res_bitmap.<a class="code" href="classImageRes.html#a7">get_ptr</a>(<span class="stringliteral">"BREAK"</span>) );
00985     <span class="keywordflow">else</span>
00986         vga_front.put_bitmap(<a class="code" href="Oinfo_8h.html#a104a26">SEASON_X1</a>, <a class="code" href="Oinfo_8h.html#a104a27">SEASON_Y1</a>, date_res_bitmap.<a class="code" href="classImageRes.html#a7">get_ptr</a>(bitmapNameArray[player_school.cur_trimester]) );
00987     mouse.show_area();
00988 
00989     <span class="comment">//-------- display month --------------//</span>
00990 
00991     <span class="keywordtype">int</span> newMonth;
00992 
00993     <span class="keywordflow">if</span> (last_month != (newMonth = date.month(info.game_date))||sys.redraw_all_flag==1) {
00994         <span class="keywordtype">char</span> *monthPtr;
00995 
00996         <span class="keywordflow">switch</span> (last_month = newMonth) {
00997         <span class="keywordflow">case</span> 1:
00998             monthPtr = date_res_bitmap.<a class="code" href="classImageRes.html#a7">get_ptr</a>(<span class="stringliteral">"JAN"</span>); <span class="keywordflow">break</span>;
00999         <span class="keywordflow">case</span> 2:
01000             monthPtr = date_res_bitmap.<a class="code" href="classImageRes.html#a7">get_ptr</a>(<span class="stringliteral">"FEB"</span>); <span class="keywordflow">break</span>;
01001         <span class="keywordflow">case</span> 3:
01002             monthPtr = date_res_bitmap.<a class="code" href="classImageRes.html#a7">get_ptr</a>(<span class="stringliteral">"MAR"</span>); <span class="keywordflow">break</span>;
01003         <span class="keywordflow">case</span> 4:
01004             monthPtr = date_res_bitmap.<a class="code" href="classImageRes.html#a7">get_ptr</a>(<span class="stringliteral">"APR"</span>); <span class="keywordflow">break</span>;
01005         <span class="keywordflow">case</span> 5:
01006             monthPtr = date_res_bitmap.<a class="code" href="classImageRes.html#a7">get_ptr</a>(<span class="stringliteral">"MAY"</span>); <span class="keywordflow">break</span>;
01007         <span class="keywordflow">case</span> 6:
01008             monthPtr = date_res_bitmap.<a class="code" href="classImageRes.html#a7">get_ptr</a>(<span class="stringliteral">"JUN"</span>); <span class="keywordflow">break</span>;
01009         <span class="keywordflow">case</span> 7:
01010             monthPtr = date_res_bitmap.<a class="code" href="classImageRes.html#a7">get_ptr</a>(<span class="stringliteral">"JUL"</span>); <span class="keywordflow">break</span>;
01011         <span class="keywordflow">case</span> 8:
01012             monthPtr = date_res_bitmap.<a class="code" href="classImageRes.html#a7">get_ptr</a>(<span class="stringliteral">"AUG"</span>); <span class="keywordflow">break</span>;
01013         <span class="keywordflow">case</span> 9:
01014             monthPtr = date_res_bitmap.<a class="code" href="classImageRes.html#a7">get_ptr</a>(<span class="stringliteral">"SEP"</span>); <span class="keywordflow">break</span>;
01015         <span class="keywordflow">case</span> 10:
01016             monthPtr = date_res_bitmap.<a class="code" href="classImageRes.html#a7">get_ptr</a>(<span class="stringliteral">"OCT"</span>); <span class="keywordflow">break</span>;
01017         <span class="keywordflow">case</span> 11:
01018             monthPtr = date_res_bitmap.<a class="code" href="classImageRes.html#a7">get_ptr</a>(<span class="stringliteral">"NOV"</span>); <span class="keywordflow">break</span>;
01019         <span class="keywordflow">case</span> 12:
01020             monthPtr = date_res_bitmap.<a class="code" href="classImageRes.html#a7">get_ptr</a>(<span class="stringliteral">"DEC"</span>); <span class="keywordflow">break</span>;
01021         }
01022 
01023         mouse.hide_area(<a class="code" href="Oinfo_8h.html#a105a34">DATE_INFO_X1</a>,<a class="code" href="Oinfo_8h.html#a105a35">DATE_INFO_Y1</a>,<a class="code" href="Oinfo_8h.html#a105a36">DATE_INFO_X2</a>,<a class="code" href="Oinfo_8h.html#a105a37">DATE_INFO_Y2</a>);
01024         vga_front.put_bitmap(<a class="code" href="Oinfo_8h.html#a104a24">MONTH_X1</a>, <a class="code" href="Oinfo_8h.html#a104a25">MONTH_Y1</a>, monthPtr);
01025         mouse.show_area();
01026     }
01027 }
01028 
01029 <span class="comment">//-------- End of function Info::disp_calendar --------//</span>
01030 
01031 <span class="comment">//------ Start of function Info::financial_year -------//</span>
01032 
<a name="l01033"></a><a class="code" href="classInfo.html#a0">01033</a> <span class="keywordtype">int</span> <a class="code" href="classInfo.html#a0">Info::financial_year</a>() {
01034     <span class="keywordflow">if</span>( <a class="code" href="classInfo.html#m3">game_month</a>&lt;finance.fiscal_year_start_month )
01035         <span class="keywordflow">return</span> <a class="code" href="classInfo.html#m4">game_year</a>-1;
01036     <span class="keywordflow">else</span>
01037         <span class="keywordflow">return</span> <a class="code" href="classInfo.html#m4">game_year</a>;
01038 }
01039 
01040 <span class="comment">//------ End of function Info::financial_year -------//</span>
01041 
01042 <span class="comment">//------ Start of function Info::date_str_ymd -------//</span>
01043 <span class="comment">//</span>
<a name="l01044"></a><a class="code" href="classInfo.html#a14">01044</a> <span class="keywordtype">char</span>* <a class="code" href="classInfo.html#a14">Info::date_str_ymd</a>( <span class="keywordtype">int</span> year, <span class="keywordtype">int</span> month, <span class="keywordtype">int</span> day, <span class="keywordtype">int</span> formatFlag) {
01045     <span class="keyword">static</span> <a class="code" href="classString.html">String</a> str;
01046 
01047     str = <span class="stringliteral">""</span>;
01048 
01049     <span class="keywordtype">int</span> seperatorFlag = 0;
01050 
01051     <span class="comment">// add month</span>
01052     <span class="keywordflow">if</span>( month &amp;&amp; !(formatFlag &amp; <a class="code" href="Oinfo_8h.html#a114a91">INFO_DATE_NO_MONTH</a>) ) {
01053         <span class="keywordflow">if</span>( seperatorFlag )
01054             str += <span class="stringliteral">" "</span>;
01055 
01056         <span class="keywordflow">if</span>( formatFlag &amp; <a class="code" href="Oinfo_8h.html#a114a92">INFO_DATE_SHORT_MONTH</a> ) {
01057             <span class="keywordtype">char</span> shortMonthStr[3+1];
01058             m.str_shorten(shortMonthStr, date.month_str(month), 3 );
01059             str += shortMonthStr;
01060         }
01061         <span class="keywordflow">else</span>
01062             str += date.month_str(month);
01063 
01064         seperatorFlag = 1;
01065     }
01066 
01067     <span class="comment">// add day</span>
01068     <span class="keywordflow">if</span>( day &amp;&amp; !(formatFlag &amp; <a class="code" href="Oinfo_8h.html#a114a90">INFO_DATE_NO_DAY</a>) ) {
01069         <span class="keywordflow">if</span>( seperatorFlag )
01070             str += <span class="stringliteral">" "</span>;
01071 
01072         str += day;
01073 
01074         seperatorFlag = 1;
01075     }
01076 
01077     <span class="comment">// add year</span>
01078 
01079     <span class="keywordflow">if</span>( year &amp;&amp; !(formatFlag &amp; <a class="code" href="Oinfo_8h.html#a114a93">INFO_DATE_NO_YEAR</a>) ) {
01080         <span class="comment">// modify year</span>
01081         <span class="keywordflow">if</span>( (formatFlag &amp; <a class="code" href="Oinfo_8h.html#a114a94">INFO_DATE_F_YEAR</a>) &amp;&amp; month &amp;&amp; month &lt; finance.fiscal_year_start_month )
01082             year--;
01083 
01084         <span class="keywordflow">if</span>( formatFlag &amp; <a class="code" href="Oinfo_8h.html#a114a95">INFO_DATE_ADD_YR</a> ) {
01085             <span class="keywordflow">if</span>( seperatorFlag )
01086                 str += <span class="stringliteral">" "</span>;
01087             str += m.format( year, 16 );
01088         }
01089         <span class="keywordflow">else</span> {
01090             <span class="keywordflow">if</span>( seperatorFlag )
01091                 str += <span class="stringliteral">", "</span>;
01092             str += m.format(year, 4);                   <span class="comment">// no thousand separator</span>
01093         }
01094 
01095         seperatorFlag = 1;
01096     }
01097 
01098     <span class="keywordflow">return</span> str;
01099 }
01100 
01101 <span class="comment">//------ End of function Info::date_str_ymd -------//</span>
01102 
01103 <span class="comment">//------ Start of function Info::date_str_ymd -------//</span>
01104 <span class="comment">//</span>
<a name="l01105"></a><a class="code" href="classInfo.html#a15">01105</a> <span class="keywordtype">char</span>* <a class="code" href="classInfo.html#a15">Info::date_str_julian</a>( <span class="keywordtype">long</span> julianDate, <span class="keywordtype">int</span> formatFlag) {
01106     <span class="comment">// false field : INFO_DATE_NO_MONTH, INFO_DATE_NO_YEAR, INFO_DATE_F_YEAR</span>
01107     <span class="comment">// true field : INFO_DATE_ADD_YR</span>
01108     <span class="comment">// true/false acceptable : INFO_DATE_NO_DAY, INFO_DATE_SHORT_MONTH</span>
01109     <span class="comment">// except don't care fields here</span>
01110     <span class="keywordflow">if</span>( formatFlag &amp; (<a class="code" href="Oinfo_8h.html#a114a91">INFO_DATE_NO_MONTH</a>|<a class="code" href="Oinfo_8h.html#a114a93">INFO_DATE_NO_YEAR</a>|<a class="code" href="Oinfo_8h.html#a114a94">INFO_DATE_F_YEAR</a>|<a class="code" href="Oinfo_8h.html#a114a95">INFO_DATE_ADD_YR</a>)
01111         == <a class="code" href="Oinfo_8h.html#a114a95">INFO_DATE_ADD_YR</a> )                         <span class="comment">// true fields here</span>
01112         <span class="keywordflow">return</span> date.date_str( julianDate, formatFlag &amp; <a class="code" href="Oinfo_8h.html#a114a92">INFO_DATE_SHORT_MONTH</a>, !(formatFlag &amp; <a class="code" href="Oinfo_8h.html#a114a90">INFO_DATE_NO_DAY</a>) );
01113     <span class="keywordflow">return</span> <a class="code" href="classInfo.html#a14">date_str_ymd</a>( date.year(julianDate), date.month(julianDate), date.day(julianDate), formatFlag );
01114 }
01115 
01116 <span class="comment">//------ End of function Info::date_str_ymd -------//</span>
01117 
01118 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
01119 <span class="preprocessor"></span><span class="comment">// --- Begin of function Info::update_distance_learning_variables --- //</span>
01120 <span class="comment">//</span>
01121 <span class="comment">//      Implementation of Version 2.0 Item 8d v)</span>
01122 <span class="keywordtype">void</span>  Info::update_distance_learning_variables(<span class="keywordtype">char</span> initValue) {
01123     <span class="comment">// calculate distance_learning_place in each course in course array in each department</span>
01124     <span class="keywordtype">int</span> deptSize = department_array.size();
01125     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=deptSize ; i&gt;0 ; i--) {              <span class="comment">//  Loop for all departments</span>
01126         <span class="keywordflow">if</span> ( department_array.is_deleted(i) )
01127             <span class="keywordflow">continue</span>;
01128 
01129         <a class="code" href="classDepartment.html">Department</a>*   deptPtr = department_array[i];
01130         deptPtr-&gt;total_distance_learning_place = 0;
01131         <a class="code" href="classCourseArray.html">CourseArray</a>*  courseArrayPtr = &amp;department_array[i]-&gt;<a class="code" href="classDepartment.html#m1">course_array</a>;
01132         <span class="keywordtype">int</span> courseSize = courseArrayPtr-&gt;<a class="code" href="classDynArray.html#a28">size</a>();
01133         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=courseSize; j&gt;0; j--) {            <span class="comment">// Loop for courses</span>
01134             <span class="keywordflow">if</span> ( courseArrayPtr-&gt;<a class="code" href="classCourseArray.html#a12">is_deleted</a>(j) )
01135                 <span class="keywordflow">continue</span>;
01136 
01137             <a class="code" href="classCourse.html">Course</a>* coursePtr = courseArrayPtr-&gt;operator [](j);
01138             <span class="comment">// check this course is optimized</span>
01139             <span class="keywordtype">int</span> randomNo = m.random(100);
01140             <span class="keywordflow">if</span> ( randomNo &lt; deptPtr-&gt;<a class="code" href="classDepartment.html#m41">p_tech_utilization</a> ) {
01141                 <span class="comment">// ************** calculate distance_learning_place here **************** //</span>
01142                 <span class="comment">// courseEnr[course] : coursePtr-&gt;convention_student_count</span>
01143                 <span class="comment">// nSections[course] : coursePtr-&gt;class_section_count</span>
01144                 <span class="comment">// Normal_class_size : coursePtr-&gt;normal_class_size()</span>
01145                 <span class="comment">// 1.5               : allowance for the 33% overload of the class</span>
01146                 <span class="keywordflow">if</span> ( initValue )
01147                     coursePtr-&gt;distance_learning_place = (coursePtr-&gt;<a class="code" href="classCourse.html#a0">normal_class_size</a>()*1.25*coursePtr-&gt;<a class="code" href="classCourse.html#m10">class_section_count</a>-
01148                                                           coursePtr-&gt;<a class="code" href="classCourse.html#m6">convention_student_count</a>)*coursePtr-&gt;<a class="code" href="classCourse.html#m10">class_section_count</a>*
01149                         deptPtr-&gt;distance_learning_credits/100;
01150                 <span class="keywordflow">else</span>
01151                     coursePtr-&gt;distance_learning_place = (coursePtr-&gt;<a class="code" href="classCourse.html#a0">normal_class_size</a>()*1.5*coursePtr-&gt;<a class="code" href="classCourse.html#m10">class_section_count</a>-
01152                                                           coursePtr-&gt;<a class="code" href="classCourse.html#m6">convention_student_count</a>)*coursePtr-&gt;<a class="code" href="classCourse.html#m10">class_section_count</a>*
01153                         deptPtr-&gt;distance_learning_credits/100;
01154             }
01155             <span class="keywordflow">else</span>
01156                 coursePtr-&gt;distance_learning_place = 0;
01157 
01158             <span class="comment">// calculate the total_distance_learning_place</span>
01159             deptPtr-&gt;total_distance_learning_place += coursePtr-&gt;distance_learning_place;
01160         }
01161     }
01162 
01163     <span class="comment">// calculate actual_distance_learning_enrollment &amp; course_enrollment &amp; distance_learning_enrollment</span>
01164     <span class="keywordtype">int</span> totalDLProvided = 0;
01165     <span class="keywordflow">for</span> ( i=deptSize; i&gt;0; i-- ) {                  <span class="comment">// Loop again for departments</span>
01166         <span class="keywordflow">if</span> ( department_array.is_deleted(i) )
01167             <span class="keywordflow">continue</span>;
01168 
01169         <a class="code" href="classDepartment.html">Department</a>* deptPtr = department_array[i];
01170         <a class="code" href="classCourseArray.html">CourseArray</a>*  courseArrayPtr = &amp;department_array[i]-&gt;<a class="code" href="classDepartment.html#m1">course_array</a>;
01171         <span class="keywordtype">int</span> courseSize = courseArrayPtr-&gt;<a class="code" href="classDynArray.html#a28">size</a>();
01172 
01173         <span class="comment">// reset the distance learning enrollment</span>
01174         deptPtr-&gt;distance_learning_enrollment = 0;
01175 
01176         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j=courseSize; j&gt;0; j-- ) {          <span class="comment">// Loop again for courses</span>
01177             <span class="keywordflow">if</span> ( courseArrayPtr-&gt;<a class="code" href="classCourseArray.html#a12">is_deleted</a>(j) )
01178                 <span class="keywordflow">continue</span>;
01179 
01180             <a class="code" href="classCourse.html">Course</a>* coursePtr = courseArrayPtr-&gt;operator [](j);
01181 
01182             <span class="comment">// calculate actual distance learning enrollment</span>
01183             <span class="comment">// DL_demand : enroll_res.total_matrics[4]</span>
01184             <span class="keywordflow">if</span> ( deptPtr-&gt;total_distance_learning_place == 0 )
01185                 coursePtr-&gt;actual_distance_learning_enrollment = 0;
01186             <span class="keywordflow">else</span>
01187                 coursePtr-&gt;actual_distance_learning_enrollment = enroll_res.total_matrics[4]*coursePtr-&gt;distance_learning_place/
01188                     deptPtr-&gt;total_distance_learning_place;
01189 
01190             <span class="comment">// calculate course enrollment</span>
01191             coursePtr-&gt;<a class="code" href="classCourse.html#m6">convention_student_count</a> += coursePtr-&gt;actual_distance_learning_enrollment;
01192 
01193             <span class="comment">// calculate distance learning enrollment</span>
01194             deptPtr-&gt;distance_learning_enrollment += coursePtr-&gt;actual_distance_learning_enrollment;
01195         }
01196 
01197         <span class="comment">// calculate distance credits provided in this department</span>
01198         deptPtr-&gt;distance_credits_provided = deptPtr-&gt;distance_learning_enrollment;
01199         totalDLProvided += deptPtr-&gt;distance_credits_provided;
01200     }
01201 
01202     finance.calc_distance_learning_expenditure();
01203 
01204     <span class="comment">// Need to update the value of enroll_res.matric_history[sl][ER_CREDITS_PROVIDED]</span>
01205     <span class="keywordtype">int</span> h = THIS_YEAR;
01206     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>( enroll_res.distance_credits_provided_history, HISTORY_TRIMESTER_COUNT );
01207     enroll_res.distance_credits_provided_history[THIS_TRIMESTER] = (int)totalDLProvided;
01208 
01209 }
01210 
01211 <span class="comment">//</span>
01212 <span class="comment">// --- End of function Info::update_distance_learning_variables --- //</span>
01213 <span class="preprocessor">#endif</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:59 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
