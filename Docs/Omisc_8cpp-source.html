<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Omisc.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Omisc.cpp</h1><a href="Omisc_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OMISC.CPP</span>
00002 <span class="comment">//Description : Object of Misc useful functions</span>
00003 
00004 <span class="preprocessor">#include &lt;windows.h&gt;</span>
00005 <span class="preprocessor">#include &lt;windowsx.h&gt;</span>
00006 <span class="preprocessor">#include &lt;mmsystem.h&gt;</span>
00007 
00008 <span class="preprocessor">#include &lt;dos.h&gt;</span>
00009 <span class="preprocessor">#include &lt;string.h&gt;</span>
00010 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00011 <span class="preprocessor">#include &lt;math.h&gt;</span>
00012 <span class="preprocessor">#include &lt;time.h&gt;</span>
00013 
00014 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00015 <span class="preprocessor">#include &lt;<a class="code" href="OSTR_8H.html">OSTR.H</a>&gt;</span>
00016 <span class="preprocessor">#include &lt;OMISC.H&gt;</span>
00017 
<a name="l00018"></a><a class="code" href="Omisc_8cpp.html#a0">00018</a> <span class="preprocessor">#define MOVE_AROUND_TABLE_SIZE  900</span>
00019 <span class="preprocessor"></span>
00020 <span class="keyword">static</span> <span class="keywordtype">char</span>   move_around_table_x[<a class="code" href="Omisc_8cpp.html#a0">MOVE_AROUND_TABLE_SIZE</a>] = {0};
00021 <span class="keyword">static</span> <span class="keywordtype">char</span>   move_around_table_y[<a class="code" href="Omisc_8cpp.html#a0">MOVE_AROUND_TABLE_SIZE</a>] = {0};
00022 <span class="keyword">static</span> <span class="keywordtype">short</span>  move_around_table_size = 0;
00023 
00024 <span class="comment">//-------- Start of function Misc::delay -------------//</span>
00025 <span class="comment">//</span>
00026 <span class="comment">// Misc::delay for specified seconds</span>
00027 <span class="comment">//</span>
00028 <span class="comment">// float wait = the no. of second to wait</span>
00029 <span class="comment">//</span>
<a name="l00030"></a><a class="code" href="classMisc.html#a44">00030</a> <span class="keywordtype">void</span> <a class="code" href="classMisc.html#a44">Misc::delay</a>(<span class="keywordtype">float</span> wait) {
00031     clock_t stopTime;
00032 
00033     stopTime = (long) (clock() + (wait * CLK_TCK));
00034 
00035     <span class="keywordflow">while</span>( clock() &lt; stopTime );
00036 }
00037 
00038 <span class="comment">//--------- End of function Misc::delay ---------------//</span>
00039 
00040 <span class="comment">//-------- BEGIN OF FUNCTION Misc::str_shorten --------//</span>
00041 <span class="comment">//</span>
00042 <span class="comment">// Shorten the string with words exceed the dest. length cut.</span>
00043 <span class="comment">//</span>
00044 <span class="comment">// &lt;char *&gt; = destination string</span>
00045 <span class="comment">// &lt;char *&gt; = source string      (source should be longer than dest)</span>
00046 <span class="comment">// &lt;int&gt;    = max. no. of characters in the dest. string.</span>
00047 <span class="comment">//            ( destStr should be allocated as destStr[destLen+1] )</span>
00048 <span class="comment">//</span>
<a name="l00049"></a><a class="code" href="classMisc.html#a7">00049</a> <span class="keywordtype">void</span> <a class="code" href="classMisc.html#a7">Misc::str_shorten</a>(<span class="keywordtype">char</span>* destStr, <span class="keywordtype">char</span>* srcStr, <span class="keywordtype">int</span> destLen) {
00050     strncpy( destStr, srcStr, destLen );
00051 
00052     destStr[destLen]=<a class="code" href="OHELP_8H.html#a0">NULL</a>;
00053 
00054     <span class="comment">//------ no need to cut characters if it fit preciously ----//</span>
00055     <span class="comment">//</span>
00056     <span class="comment">// e.g. "One Two Three" ---&gt; "One Two"</span>
00057     <span class="comment">//      (srcStr)             (destStr, return it as the result)</span>
00058     <span class="comment">//----------------------------------------------------------//</span>
00059 
00060     <span class="keywordflow">if</span>( (int)strlen(srcStr) &lt; destLen || srcStr[destLen] == <span class="charliteral">' '</span> )
00061         <span class="keywordflow">return</span>;
00062 
00063     <span class="comment">//--- if there is only one word in the string, don't cut it ----//</span>
00064     <span class="comment">//</span>
00065     <span class="comment">// e.g. "VeryLongWord" --&gt; "VeryLongWo"</span>
00066     <span class="comment">//</span>
00067     <span class="comment">//--------------------------------------------------------------//</span>
00068 
00069     <span class="keywordflow">if</span>( !<a class="code" href="classMisc.html#a2">str_chr</a>( destStr, <span class="charliteral">' '</span> ) )
00070         <span class="keywordflow">return</span>;
00071 
00072     <span class="comment">//------ if there is more than one word, cut it ------//</span>
00073     <span class="comment">//</span>
00074     <span class="comment">// e.g. "One Two Three" ----&gt; "One Two Thr" ---&gt; "One Two"</span>
00075     <span class="comment">//      (srcStr)               (destStr before)   (destStr after)</span>
00076     <span class="comment">//</span>
00077     <span class="comment">//----------------------------------------------------//</span>
00078 
00079     <span class="keywordtype">int</span> i;
00080 
00081     <span class="keywordflow">for</span>( i=destLen-1 ; i&gt;0 &amp;&amp; destStr[i] != <span class="charliteral">' '</span> ; i-- )
00082         destStr[i] = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00083 
00084     destStr[i] = <a class="code" href="OHELP_8H.html#a0">NULL</a>;                              <span class="comment">// trim the space also</span>
00085 }
00086 
00087 <span class="comment">//------------ END OF FUNCTIN Misc::str_shorten -----------------//</span>
00088 
00089 <span class="comment">//-------- BEGIN OF FUNCTION Misc::str_cut --------//</span>
00090 <span class="comment">//</span>
00091 <span class="comment">// Syntax : Misc::str_cut( &lt;char*&gt;,&lt;char*&gt;,&lt;int&gt;,&lt;int&gt; )</span>
00092 <span class="comment">//</span>
00093 <span class="comment">// Description : cut up string1 and place the resuit in string 2</span>
00094 <span class="comment">//</span>
00095 <span class="comment">// &lt;char *&gt; = destination string</span>
00096 <span class="comment">// &lt;char *&gt; = source string</span>
00097 <span class="comment">// &lt;int&gt;    = the start position of the new string</span>
00098 <span class="comment">// &lt;int&gt;    = the no. of characters to copied.        (default:to the end of the string)</span>
00099 <span class="comment">//</span>
00100 
<a name="l00101"></a><a class="code" href="classMisc.html#a1">00101</a> <span class="keywordtype">int</span> <a class="code" href="classMisc.html#a1">Misc::str_cut</a>(<span class="keywordtype">char</span>* dstr, <span class="keywordtype">char</span>* sstr, <span class="keywordtype">int</span> schar, <span class="keywordtype">int</span> charnum ) {
00102     <span class="keywordtype">int</span> si,di,forever;
00103 
00104     forever = (charnum &lt; 0);
00105 
00106     <span class="keywordflow">for</span> (si=schar-1,di=0 ; ( di&lt;charnum || forever ) &amp;&amp; sstr[si] ; si++,di++)
00107         dstr[di] = sstr[si] ;
00108 
00109     dstr[di] = <a class="code" href="OHELP_8H.html#a0">NULL</a>;                                <span class="comment">// terminating NULL sign</span>
00110 
00111     <span class="keywordflow">return</span> 1;
00112 }
00113 
00114 <span class="comment">//------------ END OF FUNCTIN Misc::str_cut -----------------//</span>
00115 
00116 <span class="comment">//---------- BEGIN OF FUNCTION Misc::str_chr ----------------//</span>
00117 <span class="comment">//</span>
00118 <span class="comment">// Description : return the position of the first occurance of the character</span>
00119 <span class="comment">//               in the string</span>
00120 <span class="comment">//</span>
00121 <span class="comment">// Syntax      : Misc::str_chr( &lt;char*&gt;, &lt;char), [int], [int] )</span>
00122 <span class="comment">//</span>
00123 <span class="comment">// &lt;char*&gt; = the string to the scanned.</span>
00124 <span class="comment">// &lt;char&gt;  = the key character</span>
00125 <span class="comment">// [int]   = the start position of the string to be scanned (1)</span>
00126 <span class="comment">// [int]   = the end position of the string to be scanned   (-1)</span>
00127 <span class="comment">//</span>
00128 <span class="comment">// return : a positive number indicating the position of the first occurance</span>
00129 <span class="comment">//          FAIL / NULL if not found</span>
00130 <span class="comment">//</span>
00131 
<a name="l00132"></a><a class="code" href="classMisc.html#a2">00132</a> <span class="keywordtype">int</span> <a class="code" href="classMisc.html#a2">Misc::str_chr</a>( <span class="keywordtype">char</span>* str, <span class="keywordtype">char</span> chr, <span class="keywordtype">int</span> spos, <span class="keywordtype">int</span> epos ) {
00133     <span class="keywordtype">int</span> i;
00134 
00135     epos--;
00136 
00137     <span class="keywordflow">for</span> (i=spos-1 ; str[i] &amp;&amp; ( i&lt;=epos || epos==-2 ) ; i++) {
00138         <span class="keywordflow">if</span> ( str[i] == chr )
00139             <span class="keywordflow">return</span>(i+1);
00140     }
00141 
00142     <span class="keywordflow">return</span> 0;
00143 }
00144 
00145 <span class="comment">//----------- END OF FUNCTION Misc::str_chr -------------//</span>
00146 
00147 <span class="comment">//---------- BEGIN OF FUNCTION Misc::str_str ----------------//</span>
00148 <span class="comment">//</span>
00149 <span class="comment">// Description : return the position of the first occurance of the character</span>
00150 <span class="comment">//               in the string</span>
00151 <span class="comment">//</span>
00152 <span class="comment">// Syntax      : Misc::str_str( &lt;char*&gt;, &lt;char*&gt;, [int], [int] )</span>
00153 <span class="comment">//</span>
00154 <span class="comment">// &lt;char*&gt; = the string to the scanned.</span>
00155 <span class="comment">// &lt;char*&gt; = the key string</span>
00156 <span class="comment">// [int]   = the start position of the string to be scanned (1)</span>
00157 <span class="comment">// [int]   = the end position of the string to be scanned   (-1)</span>
00158 <span class="comment">//</span>
00159 <span class="comment">// return : a positive number indicating the position of the first occurance</span>
00160 <span class="comment">//          FAIL / NULL if not found</span>
00161 <span class="comment">//</span>
00162 
<a name="l00163"></a><a class="code" href="classMisc.html#a3">00163</a> <span class="keywordtype">int</span> <a class="code" href="classMisc.html#a3">Misc::str_str</a>( <span class="keywordtype">char</span>* str, <span class="keywordtype">char</span>* fstr, <span class="keywordtype">int</span> spos, <span class="keywordtype">int</span> epos ) {
00164     <span class="keywordtype">int</span> i,j,flen;
00165 
00166     <span class="keywordflow">if</span> (epos == -1)
00167         epos = strlen(str);
00168 
00169     flen = strlen(fstr);
00170     epos -= flen ;
00171 
00172     <span class="keywordflow">for</span> (i=spos-1 ; str[i] &amp;&amp; i&lt;=epos ; i++) {
00173         <span class="keywordflow">for</span> (j= 0; j &lt; flen &amp;&amp; str[i+j] ; j++ ) {
00174             <span class="keywordflow">if</span> ( str[i+j] != fstr[j] )                  <span class="comment">// exactly equal</span>
00175                 <span class="keywordflow">break</span>;
00176         }
00177         <span class="keywordflow">if</span> ( j==flen )                                <span class="comment">// all equal</span>
00178             <span class="keywordflow">return</span> (i+1) ;
00179     }
00180 
00181     <span class="keywordflow">return</span> 0;
00182 }
00183 
00184 <span class="comment">//----------- END OF FUNCTION Misc::str_str -------------//</span>
00185 
00186 <span class="comment">//------ BEGIN OF FUNCTION Misc::upper ---------//</span>
00187 <span class="comment">//</span>
00188 <span class="comment">// Description : Convert the character to upper case</span>
00189 <span class="comment">//</span>
00190 <span class="comment">// Syntax      : Misc::upper(&lt;char&gt;)</span>
00191 <span class="comment">//</span>
00192 <span class="comment">// return : the converted character</span>
00193 <span class="comment">//</span>
00194 <span class="comment">//</span>
<a name="l00195"></a><a class="code" href="classMisc.html#a8">00195</a> <span class="keywordtype">int</span> <a class="code" href="classMisc.html#a8">Misc::upper</a>(<span class="keywordtype">int</span> inchar) {
00196     <span class="keywordflow">if</span> ( inchar &gt;= <span class="charliteral">'a'</span> &amp;&amp; inchar &lt;= <span class="charliteral">'z'</span> )
00197         inchar -= 32;
00198 
00199     <span class="keywordflow">return</span>( inchar );
00200 }
00201 
00202 <span class="comment">//----- END OF FUNCTION Misc::upper ------------//</span>
00203 
00204 <span class="comment">//------ BEGIN OF FUNCTION Misc::lower ---------//</span>
00205 <span class="comment">//</span>
00206 <span class="comment">// Description : Convert the character to lower case</span>
00207 <span class="comment">//</span>
00208 <span class="comment">// Syntax      : Misc::lower(&lt;char&gt;)</span>
00209 <span class="comment">//</span>
00210 <span class="comment">// return : the converted character</span>
00211 <span class="comment">//</span>
00212 <span class="comment">//</span>
<a name="l00213"></a><a class="code" href="classMisc.html#a9">00213</a> <span class="keywordtype">int</span> <a class="code" href="classMisc.html#a9">Misc::lower</a>(<span class="keywordtype">int</span> inchar) {
00214     <span class="keywordflow">if</span> ( inchar &gt;= <span class="charliteral">'A'</span> &amp;&amp; inchar &lt;= <span class="charliteral">'Z'</span> )
00215         inchar += 32;
00216 
00217     <span class="keywordflow">return</span>( inchar );
00218 }
00219 
00220 <span class="comment">//----- END OF FUNCTION Misc::lower ------------//</span>
00221 
00222 <span class="comment">//--------- BEGIN OF FUNCTION Misc::ltrim_len ---------//</span>
00223 <span class="comment">//</span>
00224 <span class="comment">// Description : return the number of character in the string</span>
00225 <span class="comment">//               with left space cut</span>
00226 <span class="comment">//</span>
<a name="l00227"></a><a class="code" href="classMisc.html#a11">00227</a> <span class="keywordtype">int</span> <a class="code" href="classMisc.html#a11">Misc::ltrim_len</a>(<span class="keywordtype">char</span>* inStr,<span class="keywordtype">int</span> spos,<span class="keywordtype">int</span> len) {
00228     <span class="keywordtype">int</span> i,j;
00229 
00230     <span class="keywordflow">if</span> ( len == -1 )
00231         len = strlen(inStr);
00232 
00233     <span class="keywordflow">for</span>( i = spos-1,j=0 ; j&lt;len &amp;&amp; inStr[i]==<span class="charliteral">' '</span> ; i++ )
00234         j++;
00235 
00236     <span class="keywordflow">return</span> len-j;
00237 }
00238 
00239 <span class="comment">//--------- END OF FUNCTION Misc::ltrim_len -------------//</span>
00240 
00241 <span class="comment">//--------- BEGIN OF FUNCTION Misc::rtrim_len ---------//</span>
00242 <span class="comment">//</span>
00243 <span class="comment">// Description : return the number of character in the string</span>
00244 <span class="comment">//               with right space cut</span>
00245 <span class="comment">//</span>
00246 <span class="comment">// &lt;char*&gt; inStr = the pointer to the string</span>
00247 <span class="comment">// [int]   spos  = start position of the string from the pointer</span>
00248 <span class="comment">//                 (default : 1)</span>
00249 <span class="comment">// [int]   len   = length of the string</span>
00250 <span class="comment">//                 (default : until NULL)</span>
00251 <span class="comment">//</span>
<a name="l00252"></a><a class="code" href="classMisc.html#a10">00252</a> <span class="keywordtype">int</span> <a class="code" href="classMisc.html#a10">Misc::rtrim_len</a>(<span class="keywordtype">char</span>* inStr,<span class="keywordtype">int</span> spos,<span class="keywordtype">int</span> len) {
00253     <span class="keywordtype">int</span> i,j;
00254 
00255     <span class="keywordflow">if</span> ( len == -1 )
00256         len = strlen(inStr);
00257 
00258     <span class="keywordflow">for</span>( i = spos+len-2,j=0 ; j&lt;len &amp;&amp; inStr[i]==<span class="charliteral">' '</span> ; i-- )
00259         j++;
00260 
00261     <span class="keywordflow">return</span> len-j;
00262 }
00263 
00264 <span class="comment">//--------- END OF FUNCTION Misc::rtrim_len -------------//</span>
00265 
00266 <span class="comment">//------ BEGIN OF FUNCTION Misc::rtrim ---------//</span>
00267 <span class="comment">//</span>
00268 <span class="comment">// &lt;char*&gt; = the destination</span>
00269 <span class="comment">// &lt;char*&gt; = the source</span>
00270 <span class="comment">//</span>
00271 <span class="comment">// Note : the destination memory must be allocated</span>
00272 <span class="comment">//</span>
<a name="l00273"></a><a class="code" href="classMisc.html#a12">00273</a> <span class="keywordtype">void</span> <a class="code" href="classMisc.html#a12">Misc::rtrim</a>( <span class="keywordtype">char</span>* des, <span class="keywordtype">char</span>* src ) {
00274     <span class="keywordtype">int</span> i;
00275 
00276     <span class="keywordflow">for</span> ( i=strlen(src)-1 ; src[i]==<span class="charliteral">' '</span> &amp;&amp; i&gt;=0 ; i-- )
00277         des[i] = src[i];
00278 
00279     des[i+1] = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00280 }
00281 
00282 <span class="comment">//------- END OF FUNCTION Misc::rtrim --------//</span>
00283 
00284 <span class="comment">//------ BEGIN OF FUNCTION Misc::ltrim ---------//</span>
00285 <span class="comment">//</span>
00286 <span class="comment">// &lt;char*&gt; = the destination</span>
00287 <span class="comment">// &lt;char*&gt; = the source</span>
00288 <span class="comment">//</span>
00289 <span class="comment">// Note : the destination memory must be allocated</span>
00290 <span class="comment">//</span>
<a name="l00291"></a><a class="code" href="classMisc.html#a13">00291</a> <span class="keywordtype">void</span> <a class="code" href="classMisc.html#a13">Misc::ltrim</a>( <span class="keywordtype">char</span>* des, <span class="keywordtype">char</span>* src ) {
00292     <span class="keywordtype">int</span> i,j;
00293 
00294     <span class="keywordflow">for</span> ( i=0 ; src[i]==<span class="charliteral">' '</span> &amp;&amp; src[i] ; )
00295         i++ ;
00296 
00297     <span class="keywordflow">for</span> ( j=0 ; src[i] ; i++,j++ )
00298         des[j] = src[i];
00299 
00300     des[j] = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00301 }
00302 
00303 <span class="comment">//------- END OF FUNCTION Misc::ltrim --------//</span>
00304 
00305 <span class="comment">//------ BEGIN OF FUNCTION Misc::alltrim ---------//</span>
00306 <span class="comment">//</span>
00307 <span class="comment">// &lt;char*&gt; = the destination</span>
00308 <span class="comment">// &lt;char*&gt; = the source</span>
00309 <span class="comment">//</span>
00310 <span class="comment">// Note : the destination memory must be allocated</span>
00311 <span class="comment">//</span>
<a name="l00312"></a><a class="code" href="classMisc.html#a14">00312</a> <span class="keywordtype">void</span> <a class="code" href="classMisc.html#a14">Misc::alltrim</a>( <span class="keywordtype">char</span>* des, <span class="keywordtype">char</span>* src) {
00313     <span class="keywordtype">int</span> i,j;
00314 
00315     <span class="keywordflow">for</span> ( i=0 ; src[i]==<span class="charliteral">' '</span> &amp;&amp; src[i] ; )
00316         i++ ;
00317 
00318     <span class="keywordflow">for</span> ( j=0 ; src[i] &amp;&amp; src[i]!=<span class="charliteral">' '</span> ; i++,j++ )
00319         des[j] = src[i];
00320 
00321     des[j] = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00322 }
00323 
00324 <span class="comment">//------- END OF FUNCTION Misc::alltrim --------//</span>
00325 
00326 <span class="comment">//------ BEGIN OF FUNCTION Misc::rtrim ---------//</span>
00327 <span class="comment">//</span>
00328 <span class="comment">// &lt;char*&gt; = the string, the result is put back into the original string pointer</span>
00329 <span class="comment">//</span>
<a name="l00330"></a><a class="code" href="classMisc.html#a15">00330</a> <span class="keywordtype">char</span>* <a class="code" href="classMisc.html#a12">Misc::rtrim</a>( <span class="keywordtype">char</span>* str ) {
00331     <span class="keywordtype">int</span> i;
00332 
00333     <span class="keywordflow">for</span> ( i=strlen(str)-1 ; str[i]==<span class="charliteral">' '</span> &amp;&amp; i&gt;=0 ; i-- );
00334 
00335     str[i+1] = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00336 
00337     <span class="keywordflow">return</span> str;
00338 }
00339 
00340 <span class="comment">//------- END OF FUNCTION Misc::rtrim --------//</span>
00341 
00342 <span class="comment">//------ BEGIN OF FUNCTION Misc::ltrim ---------//</span>
00343 <span class="comment">//</span>
00344 <span class="comment">// &lt;char*&gt; = the string</span>
00345 <span class="comment">//</span>
<a name="l00346"></a><a class="code" href="classMisc.html#a16">00346</a> <span class="keywordtype">char</span>* <a class="code" href="classMisc.html#a13">Misc::ltrim</a>( <span class="keywordtype">char</span>* str ) {
00347     <span class="keywordtype">int</span> i,j;
00348 
00349     <span class="keywordflow">for</span> ( i=0 ; str[i]==<span class="charliteral">' '</span> &amp;&amp; str[i] ; i++ );
00350 
00351     <span class="keywordflow">for</span> ( j=0 ; str[i] ; i++,j++ )
00352         str[j] = str[i];
00353 
00354     str[j] = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00355 
00356     <span class="keywordflow">return</span> str;
00357 }
00358 
00359 <span class="comment">//------- END OF FUNCTION Misc::ltrim --------//</span>
00360 
00361 <span class="comment">//------ BEGIN OF FUNCTION Misc::alltrim ---------//</span>
00362 <span class="comment">//</span>
00363 <span class="comment">// &lt;char*&gt; = the string</span>
00364 <span class="comment">//</span>
<a name="l00365"></a><a class="code" href="classMisc.html#a17">00365</a> <span class="keywordtype">char</span>* <a class="code" href="classMisc.html#a14">Misc::alltrim</a>( <span class="keywordtype">char</span>* str ) {
00366     <span class="keywordtype">int</span> i,j;
00367 
00368     <span class="keywordflow">for</span> ( i=0 ; str[i]==<span class="charliteral">' '</span> &amp;&amp; str[i] ; i++ );
00369 
00370     <span class="keywordflow">for</span> ( j=0 ; str[i] &amp;&amp; str[i]!=<span class="charliteral">' '</span> ; i++,j++ )
00371         str[j] = str[i];
00372 
00373     str[j] = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00374 
00375     <span class="keywordflow">return</span> str;
00376 }
00377 
00378 <span class="comment">//------- END OF FUNCTION Misc::alltrim --------//</span>
00379 
00380 <span class="comment">//------- BEGIN OF FUNCTION Misc::empty ------------//</span>
00381 <span class="comment">//</span>
00382 <span class="comment">// Description : empty a string</span>
00383 <span class="comment">//</span>
00384 <span class="comment">// Syntax      : Misc::empty(&lt;*char&gt;,&lt;int&gt;)</span>
00385 <span class="comment">//</span>
00386 <span class="comment">// &lt;*char&gt; = the pointer of the string</span>
00387 <span class="comment">// &lt;int&gt;   = the length of the string (not include the null string )</span>
00388 <span class="comment">//</span>
<a name="l00389"></a><a class="code" href="classMisc.html#a22">00389</a> <span class="keywordtype">void</span> <a class="code" href="classMisc.html#a22">Misc::empty</a>(<span class="keywordtype">char</span> *inStr, <span class="keywordtype">int</span> strLen ) {
00390     memset( inStr,<span class="charliteral">' '</span>,strLen);
00391     inStr[strLen] = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00392 }
00393 
00394 <span class="comment">//-------- END OF FUNCTION Misc::empty ---------//</span>
00395 
00396 <span class="comment">//------- BEGIN OF FUNCTION Misc::is_empty ------------//</span>
00397 <span class="comment">//</span>
00398 <span class="comment">// Description : empty a string</span>
00399 <span class="comment">//</span>
00400 <span class="comment">// Syntax      : Misc::is_empty(&lt;*char&gt;,[int],[int])</span>
00401 <span class="comment">//</span>
00402 <span class="comment">// &lt;*char&gt; = the pointer of the string</span>
00403 <span class="comment">// [int]   = the length of the string (not include the null string )</span>
00404 <span class="comment">//</span>
<a name="l00405"></a><a class="code" href="classMisc.html#a23">00405</a> <span class="keywordtype">int</span> <a class="code" href="classMisc.html#a23">Misc::is_empty</a>(<span class="keywordtype">char</span> *inStr, <span class="keywordtype">int</span> strLen) {
00406     <span class="keywordtype">int</span> i;
00407 
00408     <span class="keywordflow">if</span>( !strLen )
00409         strLen = strlen(inStr);
00410 
00411     <span class="keywordflow">for</span>( i=0 ; i&lt;strLen ; i++ ) {
00412         <span class="keywordflow">if</span>( inStr[i] != <span class="charliteral">' '</span> )
00413             <span class="keywordflow">return</span> 0;
00414     }
00415 
00416     <span class="keywordflow">return</span> 1;
00417 }
00418 
00419 <span class="comment">//-------- END OF FUNCTION Misc::is_empty ---------//</span>
00420 
00421 <span class="comment">//------- BEGIN OF FUNCTION Misc::fix_str ------//</span>
00422 <span class="comment">//</span>
00423 <span class="comment">// format the word to the fixed length</span>
00424 <span class="comment">//</span>
00425 <span class="comment">// e.g. Misc::fix_str("ABC",10) -&gt; "ABC     "</span>
00426 <span class="comment">//</span>
00427 <span class="comment">// &lt;char*&gt; str     = the string to be formated</span>
00428 <span class="comment">// &lt;int&gt;   len     = the deserved length after formatted</span>
00429 <span class="comment">// [char]  endChar = the end character of the string ( default : NULL terminator )</span>
00430 <span class="comment">//</span>
<a name="l00431"></a><a class="code" href="classMisc.html#a25">00431</a> <span class="keywordtype">void</span> <a class="code" href="classMisc.html#a25">Misc::fix_str</a>(<span class="keywordtype">char</span>* str,<span class="keywordtype">int</span> len,<span class="keywordtype">char</span> endChar) {
00432     <span class="keywordtype">int</span> oldLen;
00433 
00434     <span class="keywordflow">if</span> ( endChar == <a class="code" href="OHELP_8H.html#a0">NULL</a> )
00435         oldLen = strlen(str);
00436     <span class="keywordflow">else</span> {
00437         oldLen = <a class="code" href="classMisc.html#a2">Misc::str_chr</a>(str,endChar)-1;
00438         <a class="code" href="ALL_8H.html#a2">err_if</a> ( oldLen == -1 )                       <span class="comment">// the end character not found</span>
00439             <a class="code" href="ALL_8H.html#a4">err_now</a>(<span class="stringliteral">"Misc::fix_str"</span>);
00440     }
00441 
00442     <span class="keywordflow">if</span> ( len &gt; oldLen )
00443         memset( str+oldLen, <span class="charliteral">' '</span>, len-oldLen );
00444 
00445     str[len] = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00446 }
00447 
00448 <span class="comment">//--------- END OF FUNCTION Misc::fix_str ---------//</span>
00449 
00450 <span class="comment">//------- BEGIN OF FUNCTION Misc::valid_char --------//</span>
00451 <span class="comment">//</span>
00452 <span class="comment">// Description : test if the character is valid for field and file name</span>
00453 <span class="comment">//</span>
00454 <span class="comment">// Syntax      : Misc::valid_char(&lt;char&gt;)</span>
00455 <span class="comment">//</span>
00456 <span class="comment">// &lt;char&gt; = the character to be validify</span>
00457 <span class="comment">//</span>
00458 <span class="comment">// return      : SUCCEED or FAIL</span>
00459 <span class="comment">//</span>
00460 
<a name="l00461"></a><a class="code" href="classMisc.html#a24">00461</a> <span class="keywordtype">int</span> <a class="code" href="classMisc.html#a24">Misc::valid_char</a>( <span class="keywordtype">char</span> ch ) {
00462     <span class="keywordflow">return</span> ( ch&gt;=<span class="charliteral">'a'</span> &amp;&amp; ch&lt;=<span class="charliteral">'z'</span>  ||
00463              ch&gt;=<span class="charliteral">'A'</span> &amp;&amp; ch&lt;=<span class="charliteral">'Z'</span>  ||
00464              ch&gt;=<span class="charliteral">'0'</span> &amp;&amp; ch&lt;=<span class="charliteral">'9'</span>  ||
00465              ch==<span class="charliteral">'\\'</span>  ||  ch==<span class="charliteral">'.'</span>  || ch==<span class="charliteral">'_'</span>  ||  ch==<span class="charliteral">':'</span> ) ;
00466 }
00467 
00468 <span class="comment">//--------- END OF FUNCTION Misc::valid_char ----------//</span>
00469 
00470 <span class="comment">//------- BEGIN OF FUNCTION Misc::str_cmp -----------//</span>
00471 <span class="comment">//</span>
00472 <span class="comment">// Description : compare string</span>
00473 <span class="comment">//</span>
00474 <span class="comment">// Return : SUCCEED if the same</span>
00475 <span class="comment">//          FAIL    if different</span>
00476 <span class="comment">//</span>
00477 <span class="comment">// e.g "ABCDE"    &lt;&gt; "ABC"</span>
00478 <span class="comment">//     "ABCDE   " =  "ABCDE"</span>
00479 <span class="comment">//     "ABCDE"    &lt;&gt; "ABCDEF"</span>
00480 <span class="comment">//     "ABCDE"    &lt;&gt; "ABCDE "</span>
00481 
<a name="l00482"></a><a class="code" href="classMisc.html#a4">00482</a> <span class="keywordtype">int</span> <a class="code" href="classMisc.html#a4">Misc::str_cmp</a>( <span class="keywordtype">char</span>* str1, <span class="keywordtype">char</span>* str2 ) {
00483     <a class="code" href="ALL_8H.html#a0">err_when</a>( !str1 || !str2 );
00484 
00485     <span class="keywordtype">int</span> i;
00486 
00487     <span class="keywordflow">for</span> (i=0 ; str1[i] &amp;&amp; str2[i] ; i++)
00488         <span class="keywordflow">if</span> ( str1[i] != str2[i] )
00489             <span class="keywordflow">return</span> 0;
00490 
00491     <span class="keywordflow">return</span> ( str2[i] == <a class="code" href="OHELP_8H.html#a0">NULL</a> &amp;&amp; (str1[i]==<a class="code" href="OHELP_8H.html#a0">NULL</a> || str1[i]==<span class="charliteral">' '</span>) );
00492 }
00493 
00494 <span class="comment">//--------- END OF FUNCTION Misc::str_cmp -----------//</span>
00495 
00496 <span class="comment">//------- BEGIN OF FUNCTION Misc::str_cmpx -----------//</span>
00497 <span class="comment">//</span>
00498 <span class="comment">// Description : String Inexact comparsion</span>
00499 <span class="comment">//</span>
00500 <span class="comment">// Return : SUCCEED if the same</span>
00501 <span class="comment">//          FAIL    if different</span>
00502 <span class="comment">//</span>
00503 <span class="comment">// e.g "ABCDE"    =  "ABC"</span>
00504 <span class="comment">//     "ABCDE   " =  "ABCDE"</span>
00505 <span class="comment">//     "ABCDE"    &lt;&gt; "ABCDEF"</span>
00506 <span class="comment">//     "ABCDE"    &lt;&gt; "ABCDE "</span>
00507 <span class="comment">//</span>
<a name="l00508"></a><a class="code" href="classMisc.html#a5">00508</a> <span class="keywordtype">int</span> <a class="code" href="classMisc.html#a5">Misc::str_cmpx</a>( <span class="keywordtype">char</span>* str1, <span class="keywordtype">char</span>* str2 ) {
00509     <a class="code" href="ALL_8H.html#a0">err_when</a>( !str1 || !str2 );
00510 
00511     <span class="keywordtype">int</span> i;
00512 
00513     <span class="keywordflow">for</span> (i=0 ; str1[i] &amp;&amp; str2[i] ; i++)
00514         <span class="keywordflow">if</span> ( str1[i] != str2[i] )
00515             <span class="keywordflow">return</span> 0;
00516 
00517     <span class="keywordflow">return</span> ( str2[i] == <a class="code" href="OHELP_8H.html#a0">NULL</a> );
00518 }
00519 
00520 <span class="comment">//--------- END OF FUNCTION Misc::str_cmpx -----------//</span>
00521 
00522 <span class="comment">//------- BEGIN OF FUNCTION Misc::str_icmpx -----------//</span>
00523 <span class="comment">//</span>
00524 <span class="comment">// Description : String Inexact comparsion without case sensitive</span>
00525 <span class="comment">//</span>
00526 <span class="comment">// Return : SUCCEED if the same</span>
00527 <span class="comment">//          FAIL    if different</span>
00528 <span class="comment">//</span>
00529 <span class="comment">// e.g "ABCDE"    =  "ABC"</span>
00530 <span class="comment">//     "abcde   " =  "ABCDE"</span>
00531 <span class="comment">//     "ABCDE"    &lt;&gt; "ABCDEF"</span>
00532 <span class="comment">//     "ABCDE"    &lt;&gt; "ABCDE "</span>
00533 
<a name="l00534"></a><a class="code" href="classMisc.html#a6">00534</a> <span class="keywordtype">int</span> <a class="code" href="classMisc.html#a6">Misc::str_icmpx</a>( <span class="keywordtype">char</span>* str1, <span class="keywordtype">char</span>* str2 ) {
00535     <a class="code" href="ALL_8H.html#a0">err_when</a>( !str1 || !str2 );
00536 
00537     <span class="keywordtype">int</span> i;
00538     <span class="keyword">register</span> a,b;
00539 
00540     <span class="keywordflow">for</span> (i=0 ; (a=str1[i]) != <a class="code" href="OHELP_8H.html#a0">NULL</a> &amp;&amp; (b=str2[i]) != <a class="code" href="OHELP_8H.html#a0">NULL</a> ; i++) {
00541         <span class="keywordflow">if</span> ( a &gt;= <span class="charliteral">'a'</span> &amp;&amp; a &lt;= <span class="charliteral">'z'</span> )
00542             a -= 32;
00543 
00544         <span class="keywordflow">if</span> ( b &gt;= <span class="charliteral">'a'</span> &amp;&amp; b &lt;= <span class="charliteral">'z'</span> )
00545             b -= 32;
00546 
00547         <span class="keywordflow">if</span> ( a != b )
00548             <span class="keywordflow">return</span> 0;
00549     }
00550 
00551     <span class="keywordflow">return</span> ( str2[i] == <a class="code" href="OHELP_8H.html#a0">NULL</a> );
00552 }
00553 
00554 <span class="comment">//--------- END OF FUNCTION Misc::str_icmpx -----------//</span>
00555 
00556 <span class="comment">//-------- BEGIN OF FUNCTION Misc::check_sum ----------//</span>
00557 <span class="comment">//</span>
00558 <span class="comment">// Return the checksum of the string</span>
00559 <span class="comment">//</span>
00560 <span class="comment">// &lt;char*&gt; = the string</span>
00561 <span class="comment">// [int]   = length of the string</span>
00562 
<a name="l00563"></a><a class="code" href="classMisc.html#a26">00563</a> <span class="keywordtype">int</span> <a class="code" href="classMisc.html#a26">Misc::check_sum</a>(<span class="keywordtype">char</span>* str, <span class="keywordtype">int</span> len) {
00564     <span class="keywordtype">int</span> i,checksum;
00565 
00566     <span class="keywordflow">if</span> ( len == -1 )
00567         len = strlen( str );
00568 
00569     <span class="keywordflow">for</span>( checksum=0,i=0 ; i&lt;len ; i++,str++ )
00570         checksum += (*str) * (i+checksum+1) ;
00571 
00572     <span class="keywordflow">return</span> checksum;
00573 }
00574 
00575 <span class="comment">//--------- END OF FUNCTION Misc::check_sum -----------//</span>
00576 
00577 <span class="comment">//---------- Begin of function Misc::format --------//</span>
<a name="l00609"></a><a class="code" href="classMisc.html#a29">00609</a> <span class="comment">char* Misc::format( int inNum, int formatType ) {</span>
00610     <span class="keyword">static</span> <span class="keywordtype">char</span> outBuf[35];
00611     <span class="keyword">static</span> <span class="keywordtype">char</span> longBuf[25];
00612     <span class="keywordtype">char</span>   endingChar;
00613     <span class="keywordtype">char</span>   *outPtr=outBuf;
00614     <span class="keywordtype">char</span>   *longStr;
00615     <span class="keywordtype">int</span>    i, intDigit, <a class="code" href="NEWMATRM_8H.html#a2">sign</a>;
00616 
00617     <span class="keywordflow">if</span>( inNum &lt; 0 ) {
00618         <a class="code" href="NEWMATRM_8H.html#a2">sign</a>  = -1;
00619         inNum = -inNum;
00620     }
00621     <span class="keywordflow">else</span>
00622         <a class="code" href="NEWMATRM_8H.html#a2">sign</a>  = 0;
00623 
00624     <span class="comment">// -------- shift left 3 digits and have 1 decimal place and have a 'K' ----------- //</span>
00625     <span class="keywordflow">if</span> ( formatType == 30 ) {
00626         <span class="keywordflow">return</span> format( ((<span class="keywordtype">double</span>)(inNum)/1000), 30 );
00627     }
00628 
00629     <span class="comment">//--------- shift left 3 digits and no dollar sign----------//</span>
00630     <span class="keywordflow">if</span>( formatType == 9 || formatType == 12) {
00631         inNum=inNum/1000;
00632     }
00633     <span class="comment">//----------------------//</span>
00634 
00635     <span class="comment">//--------- shift left 2 digits and add dollar sign----------//</span>
00636     <span class="keywordflow">if</span>( formatType == 15 ) {
00637         <span class="keywordflow">return</span> format((<span class="keywordtype">double</span>)(((<a class="code" href="NEWMATRM_8H.html#a2">sign</a>==-1)?-1:1)*inNum/100.0),4);
00638     }
00639     <span class="comment">//----------------------//</span>
00640 
00641     <span class="comment">//--------- shift left 2 digits and add dollar sign----------//</span>
00642     <span class="keywordflow">if</span>( formatType == 10 ) {
00643         <span class="keywordflow">return</span> format((<span class="keywordtype">double</span>)(((<a class="code" href="NEWMATRM_8H.html#a2">sign</a>==-1)?-1:1)*inNum/100.0),4);
00644     }
00645     <span class="comment">//----------------------//</span>
00646 
00647     <span class="comment">//--------- shift left 3 digits and add dollar sign----------//</span>
00648     <span class="keywordflow">if</span>( formatType == 11 ) {
00649         <span class="keywordflow">return</span> format((<span class="keywordtype">double</span>)(((<a class="code" href="NEWMATRM_8H.html#a2">sign</a>==-1)?-1:1)*inNum/1000.0),4);
00650     }
00651     <span class="comment">//----------------------//</span>
00652 
00653     <span class="comment">//--------- shift left 3 digits and add dollar sign----------//</span>
00654     <span class="keywordflow">if</span>( formatType == 5 ) {
00655         endingChar=<span class="charliteral">'\0'</span>;
00656 
00657         <span class="keywordflow">if</span>(inNum&gt;1000)
00658             <span class="keywordflow">return</span> format((<span class="keywordtype">double</span>)(((<a class="code" href="NEWMATRM_8H.html#a2">sign</a>==-1)?-1:1)*inNum),5);
00659         *outPtr++ = <span class="charliteral">'$'</span>;
00660     }
00661     <span class="comment">//----------------------//</span>
00662 
00663     <span class="comment">//--------- shift left 3 digits and add dollar sign----------//</span>
00664     <span class="keywordflow">if</span>( formatType == 6 ) {
00665         endingChar=<span class="charliteral">'\0'</span>;
00666 
00667         <span class="keywordflow">if</span>(inNum&gt;1000)
00668             <span class="keywordflow">return</span> format((<span class="keywordtype">double</span>)(((<a class="code" href="NEWMATRM_8H.html#a2">sign</a>==-1)?-1:1)*inNum),5);
00669         *outPtr++ = <span class="charliteral">'$'</span>;
00670     }
00671     <span class="comment">//----------------------//</span>
00672 
00673     longStr  = ltoa( inNum, longBuf, 10 );
00674     intDigit = strlen(longStr);                     <span class="comment">// no. of integer digits</span>
00675 
00676     <span class="comment">//--------- negetive bracket ------------//</span>
00677 
00678     <span class="keywordflow">if</span>( formatType == 8 || formatType == 13 || formatType == 28 || formatType == 29) {
00679         <span class="keywordflow">if</span>( <a class="code" href="NEWMATRM_8H.html#a2">sign</a> &lt; 0 )
00680             *outPtr++ = <span class="charliteral">'-'</span>;
00681     }
00682     <span class="keywordflow">else</span>
00683         <span class="keywordflow">if</span>( <a class="code" href="NEWMATRM_8H.html#a2">sign</a> &lt; 0 )
00684             *outPtr++ = <span class="charliteral">'('</span>;
00685 
00686     <span class="keywordflow">if</span>( formatType == 13 || formatType == 28 || formatType == 29)
00687         *outPtr++ = <span class="charliteral">'('</span>;
00688 
00689     <span class="comment">//--------- dollar sign ------------//</span>
00690 
00691     <span class="keywordflow">if</span>( formatType == 2 )
00692         *outPtr++ = <span class="charliteral">'$'</span>;
00693 
00694     <span class="keywordflow">if</span>( formatType == 7 )
00695         <span class="keywordflow">if</span>(inNum&lt;0)
00696             *outPtr++ = (char)(<span class="charliteral">':'</span>+(int)111);
00697         <span class="keywordflow">else</span>
00698             *outPtr++ = <span class="charliteral">':'</span>;
00699     <span class="comment">//-------- integer number -----------//</span>
00700 
00701     <span class="comment">//## chea 5.1.2</span>
00702     <span class="keywordflow">if</span>( formatType == 16) {                         <span class="comment">//## chea 061199 finance 2.5.1</span>
00703         <span class="comment">//              if(inNum&lt;10 &amp;&amp; i==1)</span>
00704         <span class="comment">//              {</span>
00705         <span class="comment">//                      *outPtr++ ='0';</span>
00706         <span class="comment">//              }</span>
00707         *outPtr++ = <span class="charliteral">'Y'</span>;
00708         *outPtr++ = <span class="charliteral">'r'</span>;
00709         *outPtr++ = <span class="charliteral">'.'</span>;
00710         *outPtr++ = <span class="charliteral">' '</span>;
00711     }
00712 
00713     <span class="keywordflow">for</span>( i=intDigit ; i&gt;0 ; i-- ) {
00714         <span class="keywordflow">if</span>( formatType != 4 ) {                       <span class="comment">// no thousand separators for format 4</span>
00715             <span class="keywordflow">if</span>( i%3 == 0 &amp;&amp; i &lt; intDigit ) {
00716                 <span class="keywordflow">if</span>(formatType == 7 ) {
00717                     <span class="keywordflow">if</span>(inNum&lt;0)
00718                         *outPtr++ = (char)(<span class="charliteral">':'</span>+(int)140);
00719                     <span class="keywordflow">else</span>
00720                         *outPtr++ = (char)(<span class="charliteral">':'</span>+(int)141);
00721                 }
00722                 <span class="keywordflow">else</span>
00723                     *outPtr++ = <span class="charliteral">','</span>;
00724             }
00725         }
00726 
00727         <span class="keywordflow">if</span>((formatType == 7 )&amp;&amp;(inNum&lt;0)) {
00728             *outPtr++ = (*longStr)+111;
00729             longStr++;
00730         }
00731         <span class="keywordflow">else</span>
00732             *outPtr++ = *longStr++;
00733     }
00734 
00735     <span class="comment">//--------- percent sign (%) ------------//</span>
00736 
00737     <span class="keywordflow">if</span>( formatType == 3 || formatType == 29)
00738         *outPtr++ = <span class="charliteral">'%'</span>;
00739     <span class="keywordflow">if</span>( formatType == 23 )
00740         *outPtr++ = <span class="charliteral">'%'</span>;
00741     <span class="keywordflow">if</span>( formatType == 8 )
00742         *outPtr++ = <span class="charliteral">'%'</span>;
00743 
00744     <span class="comment">//--------- K sign ------------//</span>
00745     <span class="keywordflow">if</span>( formatType == 5 || formatType == 12 || formatType == 30 )
00746         *outPtr++ = <span class="charliteral">'K'</span>;
00747 
00748     <span class="comment">//--------- negetive bracket ----------//</span>
00749 
00750     <span class="keywordflow">if</span>( formatType != 8 &amp;&amp; formatType != 13)
00751         <span class="keywordflow">if</span>( <a class="code" href="NEWMATRM_8H.html#a2">sign</a> &lt; 0 )
00752             *outPtr++ = <span class="charliteral">')'</span>;
00753 
00754     <span class="keywordflow">if</span>( formatType == 13 || formatType == 28 || formatType == 29)
00755         *outPtr++ = <span class="charliteral">')'</span>;
00756 
00757     <span class="keywordflow">if</span>( formatType == 14 || formatType == 17) {
00758         *outPtr++ = <span class="charliteral">'h'</span>;
00759         *outPtr++ = <span class="charliteral">'r'</span>;
00760 
00761         <span class="keywordflow">if</span>( inNum &gt; 1 )
00762             *outPtr++ = <span class="charliteral">'s'</span>;
00763     }
00764 
00765     <span class="keywordflow">if</span>( formatType == 17) {
00766         *outPtr++ = <span class="charliteral">'/'</span>;
00767         *outPtr++ = <span class="charliteral">'w'</span>;
00768         *outPtr++ = <span class="charliteral">'e'</span>;
00769         *outPtr++ = <span class="charliteral">'e'</span>;
00770         *outPtr++ = <span class="charliteral">'k'</span>;
00771     }
00772 
00773     *outPtr++ = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00774 
00775     <span class="keywordflow">return</span> outBuf;
00776 }
00777 
00778 <span class="comment">//---------- End of function Misc::format ---------//</span>
00779 
00780 <span class="comment">//---------- Begin of function Misc::format --------//</span>
<a name="l00812"></a><a class="code" href="classMisc.html#a27">00812</a> <span class="comment">char* Misc::format(double inNum, int formatType) {</span>
00813     <span class="keyword">enum</span> { MONEY_DEC_PLACE = 2 };
00814 
00815     <span class="keyword">static</span> <span class="keywordtype">char</span> outBuf[35];
00816     <span class="keywordtype">char</span>   *outPtr=outBuf;
00817     <span class="keywordtype">char</span>   *floatStr;
00818     <span class="keywordtype">char</span>   endingChar;
00819     <span class="keywordtype">int</span>    i, intDigit, <a class="code" href="NEWMATRM_8H.html#a2">sign</a>;                       <span class="comment">// intDigit = no. of integer digits</span>
00820 
00821     <span class="comment">//--------- shift left 3 digits and add dollar sign----------//</span>
00822     <span class="keywordflow">if</span>( formatType == 5 ) {
00823         endingChar=<span class="charliteral">'\0'</span>;
00824 
00825         <span class="comment">//              if((inNum&gt;=1000000)||(inNum&lt;=-1000000))</span>
00826         <span class="comment">//              {       inNum/=1000000.0;</span>
00827         <span class="comment">//                      endingChar='M';</span>
00828         <span class="comment">//              }</span>
00829         <span class="comment">//              else</span>
00830         <span class="keywordflow">if</span>((inNum&gt;=1000)||(inNum&lt;=-1000)) {
00831             inNum/=1000.0;
00832             endingChar=<span class="charliteral">' '</span>;
00833         }
00834         *outPtr++ = <span class="charliteral">'$'</span>;
00835     }
00836 
00837     <span class="keywordflow">if</span>( formatType == 6 ) {
00838         endingChar=<span class="charliteral">'\0'</span>;
00839 
00840         <span class="keywordflow">if</span>((inNum&gt;=1000000)||(inNum&lt;=-1000000)) {
00841             inNum/=1000000.0;
00842             endingChar=<span class="charliteral">'M'</span>;
00843         }
00844         <span class="keywordflow">else</span>
00845             <span class="keywordflow">if</span>((inNum&gt;=1000)||(inNum&lt;=-1000)) {
00846                 inNum/=1000.0;
00847                 endingChar=<span class="charliteral">' '</span>;
00848             }
00849         *outPtr++ = <span class="charliteral">'$'</span>;
00850     }
00851 
00852     <span class="comment">// ##### Begin MArco ##### // (for 1 dec place)</span>
00853     <span class="keywordflow">if</span> ( formatType == 8 || formatType == 13 || formatType == 16 || formatType == 24 || formatType == 26 || formatType == 30)
00854         floatStr = fcvt( inNum, 1, &amp;intDigit, &amp;<a class="code" href="NEWMATRM_8H.html#a2">sign</a> );
00855     <span class="keywordflow">else</span>
00856         floatStr = fcvt( inNum, MONEY_DEC_PLACE, &amp;intDigit, &amp;<a class="code" href="NEWMATRM_8H.html#a2">sign</a> );
00857     <span class="comment">// ##### End  MArco ##### //</span>
00858     <span class="comment">//floatStr = fcvt( inNum, MONEY_DEC_PLACE, &amp;intDigit, &amp;sign );</span>
00859 
00860 <span class="preprocessor">#ifdef DEBUG</span>
00861 <span class="preprocessor"></span>    <span class="keywordflow">if</span>( intDigit &gt; 29 )                             <span class="comment">// integer digits can't exceed 29</span>
00862         err.run( <span class="stringliteral">"Misc::format(), inNum : %e, formatType : %d"</span>, inNum, formatType );
00863 <span class="preprocessor">#endif</span>
00864 <span class="preprocessor"></span>
00865     <span class="comment">//--------- negetive bracket ------------//</span>
00866     <span class="keywordflow">if</span>( formatType == 8 ) {
00867         <span class="keywordflow">if</span>( inNum &lt; 0 )
00868             *outPtr++ = <span class="charliteral">'-'</span>;
00869     }
00870     <span class="keywordflow">else</span> {
00871         <span class="keywordflow">if</span>( inNum &lt; 0 )
00872             *outPtr++ = <span class="charliteral">'('</span>;
00873     }
00874 
00875     <span class="comment">// #### Begin Marco ##### //</span>
00876     <span class="keywordflow">if</span>( formatType == 13 || formatType == 27 || formatType == 28|| formatType == 29)
00877         *outPtr++ = <span class="charliteral">'('</span>;
00878     <span class="comment">// #### End Marco ##### //</span>
00879     <span class="comment">//--------- dollar sign ($) ------------//</span>
00880     <span class="keywordflow">if</span>( formatType == 2 || formatType == 27)
00881         *outPtr++ = <span class="charliteral">'$'</span>;
00882 
00883     <span class="keywordflow">if</span>( formatType == 7 )
00884         <span class="keywordflow">if</span>(inNum&lt;0)
00885             *outPtr++ = (char)(<span class="charliteral">':'</span>+(int)111);
00886         <span class="keywordflow">else</span>
00887             *outPtr++ = <span class="charliteral">':'</span>;
00888 
00889     <span class="comment">//------- integer number -----------//</span>
00890 
00891     <span class="keywordflow">for</span>( i=intDigit ; i&gt;0 ; i-- ) {
00892         <span class="keywordflow">if</span>( i%3 == 0 &amp;&amp; i &lt; intDigit )
00893             <span class="keywordflow">if</span>(formatType == 7 ) {
00894                 <span class="keywordflow">if</span>(inNum&lt;0)
00895                     *outPtr++ = (char)(<span class="charliteral">':'</span>+(int)140);
00896                 <span class="keywordflow">else</span>
00897                     *outPtr++ = (char)(<span class="charliteral">':'</span>+(int)141);
00898             }
00899             <span class="keywordflow">else</span>
00900                 *outPtr++ = <span class="charliteral">','</span>;
00901 
00902         <span class="keywordflow">if</span>((formatType == 7 )&amp;&amp;(inNum&lt;0)) {
00903             *outPtr++ = *floatStr+111;
00904             floatStr++;
00905         }
00906         <span class="keywordflow">else</span>
00907             *outPtr++ = *floatStr++;
00908     }
00909 
00910     <span class="keywordflow">if</span>( intDigit &lt;= 0 )
00911         *outPtr++ = <span class="charliteral">'0'</span>;
00912 
00913     <span class="comment">//------- dec. place number -----------//</span>
00914     <span class="comment">/*</span>
00915 <span class="comment">      if(((formatType == 3 )&amp;&amp;(fabs(inNum-(int)inNum)&gt;1e-2))</span>
00916 <span class="comment">      ||(formatType != 3 )</span>
00917 <span class="comment">      //                &amp;&amp;(endingChar !='K')&amp;&amp;(endingChar !='M'))</span>
00918 <span class="comment">      )</span>
00919 <span class="comment">      //                if(( inNum &gt; -10) &amp;&amp; (inNum &lt; 10 ))   // if the number is less than 1000, add dec. places</span>
00920 <span class="comment">    */</span>
00921 
00922     <span class="comment">//## chea 110899</span>
00923     <span class="comment">/*Begin Marco*/</span>
00924     <span class="keywordflow">if</span>(formatType == 24 || formatType == 26 || formatType == 13<span class="comment">/*End Marco*/</span> || formatType == 30) {
00925         <span class="comment">// if the number is greater than 1000, truncate any dec. places</span>
00926         *outPtr++ = <span class="charliteral">'.'</span>;
00927         <span class="keywordflow">if</span>( *floatStr &amp;&amp; intDigit &gt;= 0 )              <span class="comment">// e.g. 0.03 --&gt; str:"3", intDight:-1</span>
00928             *outPtr++ = *floatStr++;                    <span class="comment">// 1st dec. place</span>
00929         <span class="keywordflow">else</span>
00930             *outPtr++ = <span class="charliteral">'0'</span>;                            <span class="comment">// add a '0' when intDigit &lt; 0</span>
00931     }
00932 
00933     <span class="keywordflow">if</span> ( formatType == 30 ) {
00934         *outPtr++ = <span class="charliteral">'K'</span>;
00935     }
00936 
00937     <span class="keywordflow">if</span>(
00938         (formatType == 1)
00939         ||(formatType == 23)
00940         ||(formatType == 25)
00941         ||(formatType == 16)
00942         ||(formatType == 28)
00943         <span class="comment">//                      &amp;&amp;( inNum &gt; -10) &amp;&amp; (inNum &lt; 10 ))</span>
00944         <span class="comment">//                      ||((formatType != 2 )&amp;&amp;(formatType != 3 )&amp;&amp;(formatType != 9 )&amp;&amp;(formatType != 7 ))</span>
00945         ) {
00946         <span class="comment">// if the number is greater than 1000, truncate any dec. places</span>
00947         *outPtr++ = <span class="charliteral">'.'</span>;
00948 
00949         <span class="keywordflow">if</span>( *floatStr &amp;&amp; intDigit &gt;= 0 )              <span class="comment">// e.g. 0.03 --&gt; str:"3", intDight:-1</span>
00950             *outPtr++ = *floatStr++;                    <span class="comment">// 1st dec. place</span>
00951         <span class="keywordflow">else</span>
00952             *outPtr++ = <span class="charliteral">'0'</span>;                            <span class="comment">// add a '0' when intDigit &lt; 0</span>
00953 
00954         <span class="comment">//## chea 180999</span>
00955         <span class="keywordflow">if</span>(formatType!=8 &amp;&amp; formatType!=14 &amp;&amp; formatType!=15 &amp;&amp; formatType != 16)
00956             <span class="keywordflow">if</span>( *floatStr )                             <span class="comment">// 2nd dec. place</span>
00957                 *outPtr++ = *floatStr++;
00958             <span class="keywordflow">else</span>
00959                 *outPtr++ = <span class="charliteral">'0'</span>;
00960 
00961         <span class="comment">//                      if((*(outPtr-1)=='0') &amp;&amp; (*(outPtr-2)=='0'))    // e.g. 0.00 -&gt; 0</span>
00962         <span class="comment">//                              outPtr-=3;</span>
00963         <span class="keywordflow">else</span> <span class="keywordflow">if</span>((formatType == 7 )&amp;&amp;(inNum&lt;0))
00964             *(outPtr-1)+=111;                           <span class="comment">// turn the number of f-diamond to red</span>
00965 
00966     }
00967 
00968     <span class="comment">//--------- percent sign (%) ------------//</span>
00969 
00970     <span class="keywordflow">if</span>( formatType == 3 || formatType == 8 || formatType == 24 || formatType == 25 || formatType == 29) {
00971         *outPtr++ = <span class="charliteral">'%'</span>;
00972     }
00973     <span class="comment">//--------- negetive bracket ------------//</span>
00974 
00975     <span class="keywordflow">if</span>(formatType != 8 )
00976         <span class="keywordflow">if</span>( inNum &lt; 0 )
00977             *outPtr++ = <span class="charliteral">')'</span>;
00978 
00979     <span class="comment">// #### Begin Marco ##### //</span>
00980     <span class="keywordflow">if</span>( formatType == 13 || formatType == 27 || formatType == 28 || formatType == 29)
00981         *outPtr++ = <span class="charliteral">')'</span>;
00982     <span class="comment">// #### Begin Marco ##### //</span>
00983 
00984     <span class="keywordflow">if</span>( formatType == 5 ) {
00985         *outPtr++ = endingChar;
00986     }
00987 
00988     <span class="keywordflow">if</span>( formatType == 6 ) {
00989         *outPtr++ = endingChar;
00990     }
00991 
00992     <span class="keywordflow">if</span>( formatType == 14 || formatType == 16 || formatType == 15) {
00993         *outPtr++ = <span class="charliteral">'h'</span>;
00994         *outPtr++ = <span class="charliteral">'r'</span>;
00995 
00996         <span class="keywordflow">if</span>( inNum &gt; 1 )
00997             *outPtr++ = <span class="charliteral">'s'</span>;
00998     }
00999 
01000     <span class="keywordflow">if</span>( formatType == 16 || formatType == 15) {
01001         *outPtr++ = <span class="charliteral">'/'</span>;
01002         *outPtr++ = <span class="charliteral">'w'</span>;
01003         *outPtr++ = <span class="charliteral">'e'</span>;
01004         *outPtr++ = <span class="charliteral">'e'</span>;
01005         *outPtr++ = <span class="charliteral">'k'</span>;
01006     }
01007 
01008     *outPtr++ = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
01009 
01010     <span class="keywordflow">return</span> outBuf;
01011 }
01012 
01013 <span class="comment">//---------- End of function Misc::format ---------//</span>
01014 
01015 <span class="comment">//---------- Begin of function Misc::num_to_str --------//</span>
<a name="l01023"></a><a class="code" href="classMisc.html#a33">01023</a> <span class="comment">char* Misc::num_to_str(int inNum) {</span>
01024     <span class="keyword">static</span> <span class="keywordtype">char</span> strBuf[25];
01025 
01026     <span class="keywordflow">return</span> ltoa( inNum, strBuf, 10 );
01027 }
01028 
01029 <span class="comment">//---------- End of function Misc::format ---------//</span>
01030 
01031 <span class="comment">//---------- Begin of function Misc::nullify -------//</span>
<a name="l01044"></a><a class="code" href="classMisc.html#a18">01044</a> <span class="comment">char* Misc::nullify(char* strPtr, int strLen) {</span>
01045     <span class="keywordtype">int</span> i;
01046 
01047     <span class="keywordflow">if</span>( strLen &gt; STR_BUF_LEN )
01048         strLen = STR_BUF_LEN;
01049 
01050     memcpy( str_buf, strPtr, strLen );
01051 
01052     <span class="keywordflow">for</span>( i=strLen-1 ; i&gt;=0 ; i-- ) {                <span class="comment">// Right Trim</span>
01053         <span class="keywordflow">if</span>( str_buf[i] != <span class="charliteral">' '</span> ) {
01054             str_buf[i+1] = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
01055             <span class="keywordflow">break</span>;
01056         }
01057     }
01058 
01059     <span class="keywordflow">if</span>( i&lt;0 )                                       <span class="comment">// Empty value</span>
01060         str_buf[0] = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
01061 
01062     <span class="keywordflow">return</span> str_buf;
01063 }
01064 
01065 <span class="comment">//----------- End of function Misc::nullify ----------//</span>
01066 
01067 <span class="comment">//-------- Begin of function Misc::rtrim_fld ---------//</span>
<a name="l01077"></a><a class="code" href="classMisc.html#a19">01077</a> <span class="comment">void Misc::rtrim_fld(char* varPtr, char* fldPtr, int fldLen) {</span>
01078     <span class="keywordtype">int</span> rtrimLen = rtrim_len( fldPtr, 1, fldLen );
01079 
01080     memcpy( varPtr, fldPtr, rtrimLen );
01081     varPtr[rtrimLen] = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
01082 }
01083 
01084 <span class="comment">//---------- End of function Misc::rtrim_fld ---------//</span>
01085 
01086 <span class="comment">//------- Begin of function Misc::atoi ---------//</span>
01093 <span class="comment"></span>
<a name="l01094"></a><a class="code" href="classMisc.html#a20">01094</a> <span class="keywordtype">int</span> <a class="code" href="classMisc.html#a20">Misc::atoi</a>( <span class="keywordtype">char</span> *str, <span class="keywordtype">int</span> strLen ) {
01095     <span class="keywordflow">if</span> ( strLen &gt;= <span class="keyword">sizeof</span>( str_buf ) )
01096         strLen = <span class="keyword">sizeof</span>( str_buf ) - 1 ;
01097 
01098     memcpy( <a class="code" href="classMisc.html#m0">str_buf</a>, str, (size_t)strLen ) ;
01099     <a class="code" href="classMisc.html#m0">str_buf</a>[strLen] = <span class="charliteral">'\0'</span> ;
01100     return ::atoi( <a class="code" href="classMisc.html#m0">str_buf</a> ) ;
01101 }
01102 
01103 <span class="comment">//---------- End of function Misc::atoi ---------//</span>
01104 
01105 <span class="comment">//------- Begin of function Misc::atof ---------//</span>
<a name="l01113"></a><a class="code" href="classMisc.html#a21">01113</a> <span class="comment">double Misc::atof( char *str, int strLen ) {</span>
01114     <span class="keywordflow">if</span> ( strLen &gt;= <span class="keyword">sizeof</span>( str_buf ) )
01115         strLen = <span class="keyword">sizeof</span>( str_buf ) - 1 ;
01116 
01117     memcpy( str_buf, str, (size_t)strLen ) ;
01118     str_buf[strLen] = <span class="charliteral">'\0'</span> ;
01119     return ::atof( str_buf ) ;
01120 }
01121 
01122 <span class="comment">//---------- End of function Misc::atof ---------//</span>
01123 
01124 <span class="comment">//------- Begin of function Misc::sqrt ---------//</span>
<a name="l01130"></a><a class="code" href="classMisc.html#a38">01130</a> <span class="comment">int Misc::sqrt(long x) {</span>
01131     <a class="code" href="ALL_8H.html#a0">err_when</a>( x &lt; 0 );
01132 
01133     <span class="keywordtype">long</span> OddInt, OldArg, FirstSqrt;
01134 
01135     OddInt=1;
01136     OldArg=x;
01137 
01138     <span class="keywordflow">while</span>(x&gt;=0) {
01139         x-=OddInt;
01140         OddInt+=2;
01141     }
01142 
01143     FirstSqrt=OddInt &gt;&gt; 1;
01144 
01145     <span class="keywordflow">if</span>( FirstSqrt*FirstSqrt - FirstSqrt + 1 &gt; OldArg)
01146         <span class="keywordflow">return</span>(FirstSqrt-1);
01147     <span class="keywordflow">else</span>
01148         <span class="keywordflow">return</span>(FirstSqrt);
01149 }
01150 
01151 <span class="comment">//---------- End of function Misc::sqrt ---------//</span>
01152 
01153 <span class="comment">//------- Begin of function Misc::diagonal_distance ---------//</span>
<a name="l01162"></a><a class="code" href="classMisc.html#a39">01162</a> <span class="comment">int Misc::diagonal_distance(int x1, int y1, int x2, int y2) {</span>
01163     <span class="keywordtype">int</span> x = abs(x1-x2);
01164     <span class="keywordtype">int</span> y = abs(y1-y2);
01165 
01166     <span class="keywordflow">return</span> <a class="code" href="classMisc.html#a38">Misc::sqrt</a>( x*x + y*y );
01167 }
01168 
01169 <span class="comment">//---------- End of function Misc::diagonal_distance ---------//</span>
01170 
01171 <span class="comment">//------- Begin of function Misc::points_distance ---------//</span>
<a name="l01180"></a><a class="code" href="classMisc.html#a40">01180</a> <span class="comment">int Misc::points_distance(int x1, int y1, int x2, int y2) {</span>
01181     <span class="keywordtype">int</span> x = abs(x1-x2);
01182     <span class="keywordtype">int</span> y = abs(y1-y2);
01183 
01184     <span class="keywordflow">return</span> max(x, y);
01185 }
01186 
01187 <span class="comment">//---------- End of function Misc::points_distance ---------//</span>
01188 
01189 <span class="comment">//------- Begin of function Misc::get_random_seed --------//</span>
<a name="l01191"></a><a class="code" href="classMisc.html#a48">01191</a> <span class="comment">long Misc::get_random_seed() {</span>
01192     <span class="keywordflow">return</span> random_seed;
01193 }
01194 
01195 <span class="comment">//---------- End of function Misc::get_random_seed ---------//</span>
01196 
01197 <span class="comment">//------- Begin of function Misc::randomize --------//</span>
<a name="l01199"></a><a class="code" href="classMisc.html#a46">01199</a> <span class="comment">void Misc::randomize() {</span>
01200     set_random_seed(time(<a class="code" href="OHELP_8H.html#a0">NULL</a>));
01201 }
01202 
01203 <span class="comment">//---------- End of function Misc::randomize ---------//</span>
01204 
01205 <span class="comment">//------- Begin of function Misc::set_random_seed --------//</span>
<a name="l01207"></a><a class="code" href="classMisc.html#a47">01207</a> <span class="comment">void Misc::set_random_seed(long randomSeed) {</span>
01208     <span class="comment">// ###### begin Gilbert 19/6 ######//</span>
01209     <a class="code" href="ALL_8H.html#a0">err_when</a>( is_seed_locked() );
01210     <span class="comment">// ###### end Gilbert 19/6 ######//</span>
01211     random_seed = randomSeed;
01212 }
01213 
01214 <span class="comment">//---------- End of function Misc::set_random_seed ---------//</span>
01215 
01216 <span class="comment">//------- Begin of function Misc::random ---------//</span>
<a name="l01223"></a><a class="code" href="classMisc.html#a50">01223</a> <span class="comment">int Misc::random(int maxNum) {</span>
01224     <a class="code" href="ALL_8H.html#a2">err_if</a>( maxNum &lt; 0  )
01225         <a class="code" href="ALL_8H.html#a4">err_now</a>( <span class="stringliteral">"Misc::random()"</span> );
01226 
01227     <span class="keywordflow">if</span> ( maxNum &lt;= 0x7FFF ) {
01228         <span class="comment">// ###### begin Gilbert 19/6 ######//</span>
01229         <a class="code" href="ALL_8H.html#a0">err_when</a>( is_seed_locked() );
01230         <span class="comment">// ###### end Gilbert 19/6 ######//</span>
01231 <span class="preprocessor">#define MULTIPLIER      0x015a4e35L</span>
01232 <span class="preprocessor"></span><span class="preprocessor">#define INCREMENT       1</span>
01233 <span class="preprocessor"></span><span class="preprocessor">#define RANDOM_MAX      0x7FFFU</span>
01234 <span class="preprocessor"></span>
01235         random_seed = MULTIPLIER * random_seed + INCREMENT;
01236 
01237         <span class="keywordflow">return</span> maxNum * ((random_seed &gt;&gt; 16) &amp; RANDOM_MAX) / (RANDOM_MAX+1);
01238     }
01239     <span class="keywordflow">else</span> {                                          <span class="comment">//if ( maxNum &lt;= 0x7FFF )   //BUGHERE</span>
01240         <span class="keywordflow">return</span> 16 * random(maxNum/16);
01241     }
01242 }
01243 
01244 <span class="comment">//---------- End of function Misc::random ---------//</span>
01245 
01246 <span class="comment">//------- Begin of function Misc::rand ---------//</span>
<a name="l01252"></a><a class="code" href="classMisc.html#a49">01252</a> <span class="comment">int Misc::rand() {</span>
01253 <span class="preprocessor">#define MULTIPLIER      0x015a4e35L</span>
01254 <span class="preprocessor"></span><span class="preprocessor">#define INCREMENT       1</span>
01255 <span class="preprocessor"></span><span class="preprocessor">#define RANDOM_MAX      0x7FFFU</span>
01256 <span class="preprocessor"></span>
01257     <span class="comment">// ###### begin Gilbert 19/6 ######//</span>
01258     <a class="code" href="ALL_8H.html#a0">err_when</a>( is_seed_locked() );
01259     <span class="comment">// ###### end Gilbert 19/6 ######//</span>
01260     random_seed = MULTIPLIER * random_seed + INCREMENT;
01261 
01262     <span class="keywordflow">return</span> ((random_seed &gt;&gt; 16) &amp; RANDOM_MAX);
01263 }
01264 
01265 <span class="comment">//---------- End of function Misc::rand ---------//</span>
01266 
01267 <span class="comment">//------- Begin of function Misc::round ---------//</span>
<a name="l01283"></a><a class="code" href="classMisc.html#a41">01283</a> <span class="comment">float Misc::round(float inValue, int signPlace, int roundDirection) {</span>
01284     <span class="keywordtype">int</span>   i;
01285     <span class="keywordtype">float</span> baseValue = (float) 1;
01286     <span class="keywordtype">float</span> minValue  = (float) 10;
01287 
01288     <span class="keywordflow">for</span>( i=2 ; i&lt;=signPlace ; i++ )
01289         minValue *= 10;
01290 
01291     <span class="keywordflow">while</span>( inValue &gt; minValue ) {
01292         inValue   /= 10;
01293         baseValue *= 10;
01294     }
01295 
01296     <span class="keywordtype">float</span> outValue = (float)((int)inValue) * baseValue;
01297 
01298     <span class="comment">//-----------------------------------------------//</span>
01299     <span class="comment">//</span>
01300     <span class="comment">// If the result number is smaller than the given number</span>
01301     <span class="comment">// and the roundDirection is rounding to a bigger number,</span>
01302     <span class="comment">// than increase result number.</span>
01303     <span class="comment">//</span>
01304     <span class="comment">//-----------------------------------------------//</span>
01305 
01306     <span class="keywordflow">if</span>( outValue!=inValue ) {
01307         <span class="keywordflow">if</span>( (roundDirection==0 &amp;&amp; ((int)inValue)%10 &gt;= 5) ||
01308             roundDirection==2 ) {
01309             outValue = (float)((int)inValue+1) * baseValue;
01310         }
01311     }
01312 
01313     <span class="keywordflow">return</span> outValue;
01314 }
01315 
01316 <span class="comment">//---------- End of function Misc::round ---------//</span>
01317 
01318 <span class="comment">//------- Begin of function Misc::round_dec ---------//</span>
<a name="l01326"></a><a class="code" href="classMisc.html#a42">01326</a> <span class="comment">float Misc::round_dec(float inNum) {</span>
01327     <span class="keywordflow">return</span> (float)((int)(inNum * 100)) / 100;
01328 }
01329 
01330 <span class="comment">//---------- End of function Misc::round_dec ---------//</span>
01331 
01332 <span class="comment">//------- Begin of function Misc::is_file_exist ---------//</span>
<a name="l01341"></a><a class="code" href="classMisc.html#a51">01341</a> <span class="comment">int Misc::is_file_exist(char* fileName) {</span>
01342     WIN32_FIND_DATA findData;
01343 
01344     HANDLE findHandle = FindFirstFile( fileName, &amp;findData );
01345 
01346     <span class="keywordflow">return</span> findHandle!=INVALID_HANDLE_VALUE;
01347 }
01348 
01349 <span class="comment">//---------- End of function Misc::is_file_exist ---------//</span>
01350 
01351 <span class="comment">//------- Begin of function Misc::change_file_ext ---------//</span>
<a name="l01359"></a><a class="code" href="classMisc.html#a52">01359</a> <span class="comment">void Misc::change_file_ext(char* desFileName, char* srcFileName, char* newExt) {</span>
01360     <span class="keywordtype">int</span> nameLen = m.str_chr(srcFileName, <span class="charliteral">'.'</span>);      <span class="comment">// include the '.' in the nameLen</span>
01361 
01362     <a class="code" href="ALL_8H.html#a0">err_when</a>( nameLen&lt;1 || nameLen&gt;9 || strlen(newExt)&gt;3 );
01363 
01364     memcpy( desFileName, srcFileName, nameLen );
01365     strcpy( desFileName+nameLen, newExt );          <span class="comment">// extension for scenarion text file</span>
01366 }
01367 
01368 <span class="comment">//---------- End of function Misc::change_file_ext ---------//</span>
01369 
01370 <span class="comment">//------- Begin of function Misc::extract_file_name ---------//</span>
<a name="l01377"></a><a class="code" href="classMisc.html#a53">01377</a> <span class="comment">void Misc::extract_file_name(char* desFileName, char* srcFileName) {</span>
01378     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=strlen(srcFileName) ; i&gt;=0 ; i-- ) {
01379         <span class="keywordflow">if</span>( srcFileName[i]==<span class="charliteral">'\\'</span> )                    <span class="comment">// get last '\' before the file name</span>
01380             <span class="keywordflow">break</span>;
01381     }
01382 
01383     strncpy(desFileName, srcFileName+i+1, MAX_PATH);
01384     desFileName[MAX_PATH]=<a class="code" href="OHELP_8H.html#a0">NULL</a>;
01385 }
01386 
01387 <span class="comment">//---------- End of function Misc::extract_file_name ---------//</span>
01388 
01389 <span class="comment">//------- Begin of function Misc::num_th ---------//</span>
<a name="l01397"></a><a class="code" href="classMisc.html#a32">01397</a> <span class="comment">char* Misc::num_th(int inNum) {</span>
01398     <span class="keyword">static</span> <a class="code" href="classString.html">String</a> str;
01399 
01400     str = format(inNum);
01401 
01402     <span class="keywordflow">if</span>( inNum &gt;=11 &amp;&amp; inNum &lt;= 13 ) {
01403         str += <span class="stringliteral">"th"</span>;
01404     }
01405     <span class="keywordflow">else</span> {
01406         <span class="keywordflow">switch</span>( inNum%10 ) {
01407         <span class="keywordflow">case</span> 1:
01408             str += <span class="stringliteral">"st"</span>;
01409             <span class="keywordflow">break</span>;
01410 
01411         <span class="keywordflow">case</span> 2:
01412             str += <span class="stringliteral">"nd"</span>;
01413             <span class="keywordflow">break</span>;
01414 
01415         <span class="keywordflow">case</span> 3:
01416             str += <span class="stringliteral">"rd"</span>;
01417             <span class="keywordflow">break</span>;
01418 
01419         <span class="keywordflow">default</span>:
01420             str += <span class="stringliteral">"th"</span>;
01421             <span class="keywordflow">break</span>;
01422         }
01423     }
01424 
01425     <span class="keywordflow">return</span> str;
01426 }
01427 
01428 <span class="comment">//---------- End of function Misc::num_th ---------//</span>
01429 
01430 <span class="comment">//------- Begin of function Misc::get_time ---------//</span>
<a name="l01432"></a><a class="code" href="classMisc.html#a45">01432</a> <span class="comment">unsigned long Misc::get_time() {</span>
01433     <span class="keywordflow">return</span> timeGetTime();
01434 }
01435 
01436 <span class="comment">//---------- End of function Misc::get_time ---------//</span>
01437 
01438 <span class="comment">//------- Begin of function Misc::del_array_rec ---------//</span>
<a name="l01447"></a><a class="code" href="classMisc.html#a55">01447</a> <span class="comment">void Misc::del_array_rec(void* arrayBody, int arraySize, int recSize, int delRecno) {</span>
01448     <a class="code" href="ALL_8H.html#a0">err_when</a>( arraySize&lt;1 );
01449 
01450     <a class="code" href="ALL_8H.html#a0">err_when</a>( delRecno&lt;1 || delRecno&gt;arraySize);
01451 
01452     <span class="keywordtype">int</span> t = delRecno-1;
01453 
01454     <span class="keywordtype">char</span>* arrayPtr = (<span class="keywordtype">char</span>*) arrayBody;
01455 
01456     memmove( arrayPtr+recSize*t, arrayPtr+recSize*(t+1),
01457              recSize * (arraySize-t-1) );
01458 }
01459 
01460 <span class="comment">//---------- End of function Misc::del_array_rec ---------//</span>
01461 
01462 <span class="comment">//-------- Begin of function Misc::cal_move_around_a_point -------//</span>
<a name="l01482"></a><a class="code" href="classMisc.html#a56">01482</a> <span class="comment">void Misc::cal_move_around_a_point(short num, short width, short height, int&amp; xShift, int&amp; yShift) {</span>
01483     <span class="keywordtype">short</span> maxSqtSize = (width&gt;height) ? height+1 : width+1;
01484     <span class="comment">//short num2 = num%(maxSqtSize*maxSqtSize) + 1;</span>
01485     <span class="keywordtype">short</span> num2 = (num-1)%(maxSqtSize*maxSqtSize) + 1;
01486 
01487     <span class="keywordflow">if</span>(num2&lt;=<a class="code" href="Omisc_8cpp.html#a0">MOVE_AROUND_TABLE_SIZE</a>) {
01488         xShift = int(*(move_around_table_x+num2-1));
01489         yShift = int(*(move_around_table_y+num2-1));
01490 
01491         <span class="comment">/*#ifdef DEBUG2</span>
01492 <span class="comment">          int xShift2, yShift2;</span>
01493 <span class="comment">          cal_move_around_a_point_v2(num, width, height, xShift2, yShift2);</span>
01494 <span class="comment">          err_when(xShift!=xShift2);</span>
01495 <span class="comment">          err_when(yShift!=yShift2);</span>
01496 <span class="comment">          #endif*/</span>
01497         <span class="keywordflow">return</span>;
01498     }
01499     <span class="keywordflow">else</span>
01500         cal_move_around_a_point_v2(num, width, height, xShift, yShift);
01501 }
01502 
01503 <span class="comment">//------ End of function Misc::cal_move_around_a_point ---------//</span>
01504 
01505 <span class="comment">//-------- Begin of function Misc::cal_move_around_a_point_v2 -------//</span>
<a name="l01506"></a><a class="code" href="classMisc.html#a57">01506</a> <span class="keywordtype">void</span> <a class="code" href="classMisc.html#a57">Misc::cal_move_around_a_point_v2</a>(<span class="keywordtype">short</span> num, <span class="keywordtype">short</span> width, <span class="keywordtype">short</span> height, <span class="keywordtype">int</span>&amp; xShift, <span class="keywordtype">int</span>&amp; yShift) {
01507     <span class="keywordtype">short</span> maxSqtSize = (width&gt;height) ? height+1 : width+1;
01508     <span class="comment">//short num2 = num%(maxSqtSize*maxSqtSize) + 1;</span>
01509     <span class="keywordtype">short</span> num2 = (num-1)%(maxSqtSize*maxSqtSize) + 1;
01510 
01511     <span class="keywordflow">if</span>(num2&lt;=1) {
01512         xShift = yShift = 0;
01513         <span class="keywordflow">return</span>;
01514     }
01515 
01516     <span class="keywordtype">int</span> sqtCount = 1;
01517 
01518     <span class="keywordflow">while</span>(sqtCount&lt;210) {                           <span class="comment">// the max. size of the map is 200x200</span>
01519         <span class="keywordflow">if</span>(num2&lt;=sqtCount*sqtCount)
01520             <span class="keywordflow">break</span>;
01521         <span class="keywordflow">else</span>
01522             sqtCount += 2;
01523     }
01524 
01525     <span class="keywordtype">int</span> filter = (sqtCount-1)/2;                    <span class="comment">// is an integer</span>
01526     <span class="keywordtype">int</span> refNum = num2 - (sqtCount-2)*(sqtCount-2);
01527 
01528     <span class="comment">//=====================================//</span>
01529     <span class="comment">// some adjustment to the refNum can</span>
01530     <span class="comment">// generate different mode of result</span>
01531     <span class="comment">//=====================================//</span>
01532     <span class="comment">// note: sqtCount&gt;=3 for this mode</span>
01533     refNum = (refNum-1-(sqtCount-3)/2)%(4*(sqtCount-1)) + 1;
01534 
01535     <span class="comment">//-------------------------------------------------//</span>
01536     <span class="comment">// determine xMag</span>
01537     <span class="comment">//-------------------------------------------------//</span>
01538     <span class="keywordtype">int</span> xMag;
01539     <span class="keywordflow">if</span>(refNum &lt; sqtCount)
01540         xMag = refNum - 1;
01541     <span class="keywordflow">else</span> {
01542         <span class="keywordflow">if</span>(refNum&gt;=sqtCount &amp;&amp; refNum&lt;=3*(sqtCount-1))
01543             xMag = (sqtCount&lt;&lt;1) - 1 - refNum;          <span class="comment">//(sqtCount-1) - (refNum-sqtCount);</span>
01544         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(refNum &gt;= sqtCount+2*(sqtCount-1))
01545             xMag = refNum + 3 - (sqtCount&lt;&lt;2);          <span class="comment">//(refNum-sqtCount-2*(sqtCount-1)) - (sqtCount-1);</span>
01546         <span class="keywordflow">else</span>
01547             <a class="code" href="ALL_8H.html#a1">err_here</a>();
01548     }
01549 
01550     <span class="comment">//-------------------------------------------------//</span>
01551     <span class="comment">// calculate xShift</span>
01552     <span class="comment">//-------------------------------------------------//</span>
01553     <span class="keywordflow">if</span>(xMag&gt;0)                                      <span class="comment">// +ve</span>
01554         xShift = (xMag&gt;filter) ? filter : xMag;
01555     <span class="keywordflow">else</span>                                            <span class="comment">// -ve</span>
01556         xShift = (-xMag&gt;filter) ? -filter : xMag;
01557 
01558     <span class="comment">//-------------------------------------------------//</span>
01559     <span class="comment">// calculate yShift</span>
01560     <span class="comment">//-------------------------------------------------//</span>
01561     <span class="comment">//ySign = (refNum&gt;sqtCount &amp;&amp; refNum&lt;=3*sqtCount-3) ? -1 : 1;</span>
01562     <span class="keywordtype">int</span> yMag = (sqtCount-1) - abs(xMag);            <span class="comment">// abs(xMag) + abs(yMag) always = (sqtCount-1)</span>
01563     <span class="keywordflow">if</span>(refNum&gt;sqtCount &amp;&amp; refNum&lt;=3*sqtCount-3)     <span class="comment">// -ve</span>
01564         yShift = (yMag&gt;filter) ? -filter : -yMag;
01565     <span class="keywordflow">else</span>                                            <span class="comment">// +ve</span>
01566         yShift = (yMag&gt;filter) ? filter : yMag;
01567 }
01568 
01569 <span class="comment">//------ End of function Misc::cal_move_around_a_point_v2 ---------//</span>
01570 
01571 <span class="comment">//-------- Begin of function Misc::construct_move_around_table -------//</span>
01572 <span class="keywordtype">void</span> Misc::construct_move_around_table() {
01573     <span class="keywordflow">if</span>(move_around_table_size==<a class="code" href="Omisc_8cpp.html#a0">MOVE_AROUND_TABLE_SIZE</a>)
01574         <span class="keywordflow">return</span>;                                       <span class="comment">// table already created</span>
01575 
01576     <span class="keywordtype">int</span> xShift, yShift;
01577     <span class="keywordtype">char</span> *xPtr = move_around_table_x;
01578     <span class="keywordtype">char</span> *yPtr = move_around_table_y;
01579     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=1; i&lt;=<a class="code" href="Omisc_8cpp.html#a0">MOVE_AROUND_TABLE_SIZE</a>; ++i, xPtr++, yPtr++) {
01580         <a class="code" href="classMisc.html#a57">cal_move_around_a_point_v2</a>(i, <a class="code" href="Omisc_8cpp.html#a0">MOVE_AROUND_TABLE_SIZE</a>, <a class="code" href="Omisc_8cpp.html#a0">MOVE_AROUND_TABLE_SIZE</a>, xShift, yShift);
01581         *xPtr = char(xShift);
01582         *yPtr = char(yShift);
01583     }
01584 
01585     move_around_table_size = <a class="code" href="Omisc_8cpp.html#a0">MOVE_AROUND_TABLE_SIZE</a>;
01586 }
01587 
01588 <span class="comment">//------ End of function Misc::construct_move_around_table ---------//</span>
01589 
01590 <span class="comment">//-------- Begin of function Misc::set_surround_bit -------//</span>
<a name="l01591"></a><a class="code" href="classMisc.html#a58">01591</a> <span class="keywordtype">void</span> <a class="code" href="classMisc.html#a58">Misc::set_surround_bit</a>(<span class="keywordtype">long</span> <span class="keywordtype">int</span>&amp; flag, <span class="keywordtype">int</span> bitNo) {
01592     <span class="keyword">static</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> bitFlag[20] = {
01593         0x000001, 0x000002, 0x000004, 0x000008, 0x000010, 0x000020, 0x000040, 0x000080,
01594         0x000100, 0x000200, 0x000400, 0x000800, 0x001000, 0x002000, 0x004000, 0x008000,
01595         0x010000, 0x020000, 0x040000, 0x080000
01596     };
01597 
01598     <a class="code" href="ALL_8H.html#a0">err_when</a>(bitNo&lt;0 || bitNo&gt;=20);
01599     flag |= bitFlag[bitNo];
01600 }
01601 
01602 <span class="comment">//------ End of function Misc::set_surround_bit ---------//</span>
01603 
01604 <span class="comment">//------- Begin of function Misc::roman_number -------//</span>
01605 
<a name="l01606"></a><a class="code" href="classMisc.html#a34">01606</a> <span class="keywordtype">char</span>* <a class="code" href="classMisc.html#a34">Misc::roman_number</a>(<span class="keywordtype">int</span> inNum) {
01607     <a class="code" href="ALL_8H.html#a0">err_when</a>( inNum&lt;1 || inNum &gt;= 1000 );
01608 
01609     <span class="keyword">static</span> <span class="keywordtype">char</span>* roman_number_array[] =
01610     { <span class="stringliteral">"I"</span>, <span class="stringliteral">"II"</span>, <span class="stringliteral">"III"</span>, <span class="stringliteral">"IV"</span>, <span class="stringliteral">"V"</span>, <span class="stringliteral">"VI"</span>, <span class="stringliteral">"VII"</span>, <span class="stringliteral">"VIII"</span>, <span class="stringliteral">"IX"</span>, <span class="stringliteral">"X"</span> };
01611 
01612     <span class="keyword">static</span> <a class="code" href="classString.html">String</a> str;
01613 
01614     str = <span class="stringliteral">""</span>;
01615 
01616     <span class="keywordflow">if</span>( inNum &gt; 100 ) {
01617         str += roman_number_array[inNum/100-1];
01618         inNum = inNum - inNum/100*100;
01619     }
01620 
01621     <span class="keywordflow">if</span>( inNum &gt; 10 ) {
01622         str += roman_number_array[(inNum-1)/10-1];
01623         inNum = inNum - (inNum-1)/10*10;
01624     }
01625 
01626     <a class="code" href="ALL_8H.html#a0">err_when</a>( inNum&lt;1 || inNum&gt;10 );
01627 
01628     str += roman_number_array[inNum-1];
01629 
01630     <span class="keywordflow">return</span> str;
01631 }
01632 
01633 <span class="comment">//------ End of function Misc::roman_number ---------//</span>
01634 
01635 <span class="comment">// ###### begin Gilbert 19/6 ########//</span>
<a name="l01636"></a><a class="code" href="classMisc.html#a0">01636</a> <a class="code" href="classMisc.html#a0">Misc::Misc</a>() {
01637     <a class="code" href="classMisc.html#m1">freeze_seed</a> = 0;
01638     construct_move_around_table();
01639 }
01640 
<a name="l01641"></a><a class="code" href="classMisc.html#a59">01641</a> <span class="keywordtype">void</span> <a class="code" href="classMisc.html#a59">Misc::lock_seed</a>() {
01642     <a class="code" href="classMisc.html#m1">freeze_seed</a> = 1;
01643 }
01644 
<a name="l01645"></a><a class="code" href="classMisc.html#a60">01645</a> <span class="keywordtype">void</span> <a class="code" href="classMisc.html#a60">Misc::unlock_seed</a>() {
01646     <a class="code" href="classMisc.html#m1">freeze_seed</a> = 0;
01647 }
01648 
<a name="l01649"></a><a class="code" href="classMisc.html#a61">01649</a> <span class="keywordtype">int</span> <a class="code" href="classMisc.html#a61">Misc::is_seed_locked</a>() {
01650     <span class="keywordflow">return</span> <a class="code" href="classMisc.html#m1">freeze_seed</a> &gt; 0;
01651 }
01652 
01653 <span class="comment">// ###### end Gilbert 19/6 ########//</span>
01654 
01655 <span class="comment">// ##### Begin Marco ##### //</span>
01656 <span class="comment">//------- Begin of function Misc::round_1dec ---------//</span>
<a name="l01664"></a><a class="code" href="classMisc.html#a43">01664</a> <span class="comment">float Misc::round_one_dec(float inNum) {</span>
01665     <span class="keywordflow">return</span> (float)((int)(inNum * 10)) / 10;
01666 }
01667 
01668 <span class="comment">//---------- End of function Misc::round_dec ---------//</span>
01669 <span class="comment">// ##### End Marco ##### //</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:05 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
