<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Odept.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Odept.cpp</h1><a href="Odept_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : ODEPT.CPP</span>
00002 <span class="comment">//Description : Department object</span>
00003 
00004 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00005 <span class="preprocessor">#include &lt;<a class="code" href="OGAMESET_8H.html">OGAMESET.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;OMATH.H&gt;</span>
00007 <span class="preprocessor">#include &lt;ODEPT.H&gt;</span>
00008 <span class="preprocessor">#include &lt;<a class="code" href="ODEPTRES_8H.html">ODEPTRES.H</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;OFIRM.H&gt;</span>
00010 <span class="preprocessor">#include &lt;<a class="code" href="OWORLD_8H.html">OWORLD.H</a>&gt;</span>
00011 <span class="preprocessor">#include &lt;<a class="code" href="OROAD_8H.html">OROAD.H</a>&gt;</span>
00012 <span class="preprocessor">#include &lt;<a class="code" href="OFIRMRES_8H.html">OFIRMRES.H</a>&gt;</span>
00013 <span class="preprocessor">#include &lt;OFACULTY.H&gt;</span>
00014 <span class="preprocessor">#include &lt;<a class="code" href="OSCHLRES_8H.html">OSCHLRES.H</a>&gt;</span>
00015 <span class="preprocessor">#include &lt;OPSCHOOL.H&gt;</span>
00016 <span class="preprocessor">#include &lt;OFINANCE.H&gt;</span>                             <span class="comment">// fiscal_start_month</span>
00017 
00018 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00019 <span class="preprocessor"></span><span class="comment">// --- Begin of function Department::Department --- //</span>
00020 <span class="comment">//</span>
00021 Department::Department() : cur_faculty_array(sizeof(<a class="code" href="classFaculty.html">Faculty</a>)), display_faculty_array(sizeof(<a class="code" href="classFaculty.html">Faculty</a>)) {
00022 }
00023 
00024 <span class="comment">//</span>
00025 <span class="comment">// --- End of function Department::Department --- //</span>
00026 <span class="preprocessor">#endif</span>
00027 <span class="preprocessor"></span>
00028 <span class="comment">//---------- Begin of function Department::init -----------//</span>
<a name="l00030"></a><a class="code" href="classDepartment.html#a0">00030</a> <span class="comment">void Department::init(int departmentId) {</span>
00031     <a class="code" href="classGeneralDepartment.html#a1">GeneralDepartment::init</a>();
00032     department_id = departmentId;
00033     firm_recno    = 0;
00034 
00035     <span class="keyword">enum</span> {
00036         <a class="code" href="Ocour__if_8cpp.html#a62a43">REPORT_TYPE_DEPARTMENT_OVERVIEW</a>, <a class="code" href="Ocour__if_8cpp.html#a62a44">REPORT_TYPE_DEPARTMENT_CLASSTYPES</a>,
00037         <a class="code" href="Ocour__if_8cpp.html#a62a45">REPORT_TYPE_INSTITUTION_OVERVIEW</a>, <a class="code" href="Ocour__if_8cpp.html#a62a46">REPORT_TYPE_INSTITUTION_SUMMERTEACHING</a>,
00038     };
00039     current_report_type=<a class="code" href="Ocour__if_8cpp.html#a62a45">REPORT_TYPE_INSTITUTION_OVERVIEW</a>;
00040 
00041     faculty_array.department_recno = department_recno;
00042     student_array.department_recno = department_recno;
00043     course_array.department_recno = department_recno;
00044 
00045     department_res[department_id];                  <span class="comment">// for debug</span>
00046 
00047     <span class="comment">//------ init performance indicators ------//</span>
00048 
00049     p_faculty_research = 0;
00050     p_academic_standing = 0;
00051     <span class="comment">// add in GAME_VERSION&gt;=200</span>
00052     p_academic_standing_no_latency = 0;
00053     p_tech_utilization = 0;
00054     p_educational_quality = 0;
00055     p_faculty_morale = 0;
00056     p_student_morale = 0;
00057     p_faculty_diversity = 0;                        <span class="comment">//##### fred 0818</span>
00058 
00059     cummulative_tech_utilization = 0;               <span class="comment">// 1104</span>
00060 
00061 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00062 <span class="preprocessor"></span>    department_incentives = 50;
00063     ease_outsourcing_credits = 50;
00064     distance_learning_credits = 50;
00065 
00066     distance_learning_enrollment = 0;
00067     distance_credits_provided = 0;
00068     total_distance_learning_place = 0;
00069 <span class="preprocessor">#endif</span>
00070 <span class="preprocessor"></span>
00071     <span class="comment">//----- link this department to a firm -----//</span>
00072 
00073     create_department_firm();
00074 
00075     <span class="comment">//----------- generate data; orders according to page3 of techdoc 3.3 -----------//</span>
00076 
00077     generate_course();
00078 
00079     <span class="comment">//##### begin fred 0824 #####//</span>
00080     total_research_dollar = 0;
00081     total_research_dollar_direct = 0;
00082     research_dollar_norm  = 0;
00083     percent_investigator = 0;
00084 
00085     regular_faculty_count = 0;
00086 
00087     memset(p_educational_quality_history, 0, <span class="keyword">sizeof</span>(p_educational_quality_history));
00088     memset(p_academic_standing_history, 0, <span class="keyword">sizeof</span>(p_academic_standing_history));
00089     memset(p_student_morale_history, 0, <span class="keyword">sizeof</span>(p_student_morale_history));
00090 
00091     memset(p_faculty_research_history, 0, <span class="keyword">sizeof</span>(p_faculty_research_history));
00092     memset(p_faculty_morale_history, 0, <span class="keyword">sizeof</span>(p_faculty_morale_history));
00093     memset(p_faculty_diversity_history, 0, <span class="keyword">sizeof</span>(p_faculty_diversity_history));
00094 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00095 <span class="preprocessor"></span>    memset(p_tech_utilization_history, 0, <span class="keyword">sizeof</span>(p_tech_utilization_history));
00096     memset(distance_credits_provided_history, 0, <span class="keyword">sizeof</span>(distance_credits_provided_history));
00097 
00098     memset(departures_history, 0, <span class="keyword">sizeof</span>(departures_history));
00099     memset(hires_history, 0, <span class="keyword">sizeof</span>(hires_history));
00100     memset(promotion_history, 0, <span class="keyword">sizeof</span>(promotion_history));
00101 <span class="preprocessor">#endif</span>
00102 <span class="preprocessor"></span>
00103     memset(var_educational_quality_history, 0, <span class="keyword">sizeof</span>(var_educational_quality_history));
00104     memset(var_academic_standing_history, 0, <span class="keyword">sizeof</span>(var_academic_standing_history));
00105     memset(var_student_morale_history, 0, <span class="keyword">sizeof</span>(var_student_morale_history));
00106 
00107     memset( var_change_educational_quality,0,<span class="keyword">sizeof</span>(var_change_educational_quality));
00108     memset( var_change_academic_standing,0,<span class="keyword">sizeof</span>(var_change_academic_standing));
00109     <span class="comment">//  memset( var_change_student_morale,0,sizeof(var_change_student_morale));</span>
00110 
00111     memset( faculty_level_history,0,<span class="keyword">sizeof</span>(faculty_level_history));
00112     memset( faculty_gender_history,0,<span class="keyword">sizeof</span>(faculty_gender_history));
00113 
00114     memset( student_level_history,0,<span class="keyword">sizeof</span>(student_level_history));
00115     memset( student_gender_history,0,<span class="keyword">sizeof</span>(student_gender_history));
00116 
00117     memset( research_m_history,0,<span class="keyword">sizeof</span>(research_m_history));
00118     memset( research_y_history,0,<span class="keyword">sizeof</span>(research_y_history));
00119     memset( research_total_history,0,<span class="keyword">sizeof</span>(research_total_history));
00120     memset( research_direct_history,0,<span class="keyword">sizeof</span>(research_direct_history));
00121     memset( regular_faculty_with_research,0,<span class="keyword">sizeof</span>(regular_faculty_with_research));
00122 
00123     <span class="comment">//----- init player input ------------------------------//</span>
00124     <span class="keywordtype">int</span> i;
00125 
00126     <span class="comment">//## 990609 fred</span>
00127     <span class="keywordflow">for</span> ( i=0; i&lt;<a class="code" href="Ofaculty_8h.html#a28a14">DISCRETIONARY_TYPE_COUNT</a>; i++ ) {
00128         <span class="keywordtype">int</span> t = math.get_random_snd(5, 0.6f);
00129         priority_discretionary_hour_array[i] = max(0, min(10,t));
00130     }
00131 
00132     memcpy( last_priority_discretionary_hour_array, priority_discretionary_hour_array, <span class="keyword">sizeof</span>(priority_discretionary_hour_array));
00133 
00134     <span class="comment">//## 990609 fred</span>
00135 
00136     pressure_to_change_teaching_load = 0;
00137 
00138     <a class="code" href="structCourseTemplate.html">CourseTemplate</a>* templ = course_res.get_template(department_id);
00139 
00140     <span class="keywordtype">int</span> sum;
00141 
00142     <span class="keywordflow">for</span> ( sum=0,i=0; i&lt;<a class="code" href="OCOURRES_8H.html#a8a2">COURSE_PREFERENCE_COUNT</a>; i++ ) {
00143         course_preference_input[i] = templ-&gt;<a class="code" href="structCourseTemplate.html#m1">target_preference</a>[i];
00144         course_preference[i] = course_preference_input[i];
00145         sum+=course_preference[i];
00146     }
00147 
00148     <span class="comment">//------ scenario special handling -------//</span>
00149 
00150     <span class="keywordflow">if</span>( player_school.scenario_id == <a class="code" href="Opschool_8h.html#a63a24">SCN_TEACHING_QUALITY</a> ) {
00151         <span class="comment">//---- increase class with breakout preference by 50% -----//</span>
00152 
00153         <span class="keywordtype">int</span> t = course_preference_input[<a class="code" href="Ocourse_8h.html#a40a33">CLASS_WITH_BREAKOUT</a>];
00154 
00155         course_preference_input[<a class="code" href="Ocourse_8h.html#a40a33">CLASS_WITH_BREAKOUT</a>] += t;
00156         course_preference[<a class="code" href="Ocourse_8h.html#a40a33">CLASS_WITH_BREAKOUT</a>]      += t;
00157 
00158         <span class="comment">//----- normalize the sum to 100 ------//</span>
00159 
00160         <span class="keywordtype">int</span> newSum=0;
00161 
00162         <span class="keywordflow">for</span> ( i=0; i&lt;<a class="code" href="OCOURRES_8H.html#a8a2">COURSE_PREFERENCE_COUNT</a>; i++ ) {
00163             course_preference_input[i] = (int) course_preference_input[i] * 100 / sum;
00164             newSum += course_preference_input[i];
00165         }
00166 
00167         <span class="comment">// the total may not be exactly 100, do this to make it 100.</span>
00168         course_preference_input[<a class="code" href="OCOURRES_8H.html#a8a2">COURSE_PREFERENCE_COUNT</a>-1] += 100-newSum;
00169     }
00170 
00171     <span class="comment">//----------------------------------------//</span>
00172 
00173     <a class="code" href="ALL_8H.html#a0">err_when</a>(sum!=100);
00174 
00175     dept_salary_multiplier = 1.0f;
00176 
00177     teaching_talent_priority = 1;                   <span class="comment">// for new hires // = {Very important = 3; Important = 2; Moderately important = 1; Not important = 0}</span>
00178     scholarship_talent_priority = 1;
00179     research_talent_priority = 1;
00180 
00181     <span class="comment">//## chea 260799 try to init scenario SCN_RAISE_SALARY</span>
00182     <span class="keywordflow">if</span> (player_school.scenario_id==<a class="code" href="Opschool_8h.html#a63a22">SCN_RAISE_SALARY</a>)
00183         assistant_professor_priority = 0;             <span class="comment">// = {Very important = 3; Important = 2; Doesn't matter = 1; Don't do it = 0}</span>
00184     <span class="keywordflow">else</span>
00185         assistant_professor_priority = 2;
00186 
00187 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00188 <span class="preprocessor"></span>    cost_containment_priority = 0;
00189     tenured_faculty_priority = 0;
00190 <span class="preprocessor">#else</span>
00191 <span class="preprocessor"></span>    cost_containment_priority = 1;
00192     tenured_faculty_priority = 1;
00193 <span class="preprocessor">#endif</span>
00194 <span class="preprocessor"></span>    longterm_adjunct_faculty_priority = 1;
00195     shortterm_adjunct_faculty_priority = 1;
00196     female_faculty_priority = 1;
00197     minority_faculty_priority = 1;
00198 
00199     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>; i++)
00200         salary_multiplier[i] = 1.0f;
00201 
00202     doctors_per_research_dollar = 0;
00203     breakout_section_by_doctor = 0;
00204 }
00205 
00206 <span class="comment">//---------- End of function Department::init -----------//</span>
00207 
00208 <span class="comment">//------- Begin of function Department::name -------//</span>
<a name="l00210"></a><a class="code" href="classDepartment.html#a3">00210</a> <span class="comment">char* Department::name() {</span>
00211     <span class="keyword">static</span> <a class="code" href="classString.html">String</a> str;
00212 
00213     str = department_res[department_id]-&gt;name;
00214     str += <span class="stringliteral">" Department"</span>;
00215 
00216     <span class="keywordflow">return</span> str;
00217 }
00218 
00219 <span class="comment">//------- End of function Department::name --------//</span>
00220 
00221 <span class="comment">//------- Begin of function Department::create_department_firm -------//</span>
<a name="l00223"></a><a class="code" href="classDepartment.html#a20">00223</a> <span class="comment">int Department::create_department_firm() {</span>
00224     <span class="keywordtype">int</span> blockWidth=10, blockHeight=8;
00225     <span class="keywordtype">char</span> debugFlag=0;
00226 
00227     <span class="comment">//------ get a firm type of the matched field ----//</span>
00228 
00229     <span class="keywordtype">int</span> curFieldId = department_res[department_id]-&gt;field_id;
00230 
00231     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> firmId=firm_res.firm_count ; firmId&gt;0 ; firmId-- ) {
00232         <span class="keywordflow">if</span>( firm_res[firmId]-&gt;field_id == curFieldId ) {
00233             <span class="keywordflow">if</span>( firm_res[firmId]-&gt;is_available() ) {
00234                 <span class="keywordflow">if</span>( firm_res[firmId]-&gt;loc_width &lt;= blockWidth-<a class="code" href="OROAD_8H.html#a10a6">ROAD_WIDTH</a> &amp;&amp;
00235                     firm_res[firmId]-&gt;loc_height &lt;= blockHeight-<a class="code" href="OROAD_8H.html#a10a7">ROAD_HEIGHT</a> ) {
00236                     <span class="keywordflow">break</span>;
00237                 }
00238                 <span class="keywordflow">else</span>
00239                     debugFlag = 1;
00240             }
00241             <span class="keywordflow">else</span>
00242                 debugFlag = 2;
00243         }
00244     }
00245 
00246     <a class="code" href="ALL_8H.html#a0">err_when</a>( firmId==0 );
00247 
00248     <span class="comment">//------- attempt to add the firm on the map ------//</span>
00249 
00250     <a class="code" href="structFirmInfo.html">FirmInfo</a>* firmInfo = firm_res[firmId];
00251 
00252     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> yLoc=2 ; yLoc+blockHeight&lt;=<a class="code" href="Oworldmt_8h.html#a1">MAX_WORLD_Y_LOC</a> ; yLoc+=blockHeight ) {
00253         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> xLoc=2 ; xLoc+blockWidth&lt;=<a class="code" href="Oworldmt_8h.html#a0">MAX_WORLD_X_LOC</a> ; xLoc+=blockWidth ) {
00254             <span class="keywordtype">int</span> buildXLoc = xLoc + (blockWidth-<a class="code" href="OROAD_8H.html#a10a6">ROAD_WIDTH</a>-firmInfo-&gt;<a class="code" href="structFirmInfo.html#m3">loc_width</a>)/2;
00255             <span class="keywordtype">int</span> buildYLoc = yLoc + (blockHeight-<a class="code" href="OROAD_8H.html#a10a7">ROAD_HEIGHT</a>-firmInfo-&gt;<a class="code" href="structFirmInfo.html#m4">loc_height</a>)/2;
00256 
00257             <span class="keywordflow">if</span>( !firmInfo-&gt;<a class="code" href="structFirmInfo.html#a1">can_build</a>(buildXLoc, buildYLoc) )
00258                 <span class="keywordflow">continue</span>;
00259 
00260             <span class="keywordtype">int</span> firmRecno = firm_array.add_firm( buildXLoc, buildYLoc, firmId );
00261 
00262             <span class="comment">//----- set linkage between the firm and the department ----//</span>
00263 
00264             firm_array[firmRecno]-&gt;department_recno = department_recno;
00265             firm_recno = firmRecno;
00266 
00267             <span class="keywordflow">return</span> 1;
00268         }
00269     }
00270 
00271     <span class="keywordflow">return</span> 0;                                       <span class="comment">// no space for adding the firm</span>
00272 }
00273 
00274 <span class="comment">//------- End of function Department::create_department_firm -------//</span>
00275 
00276 <span class="comment">//---------- Begin of function Department::generate_course -----------//</span>
<a name="l00278"></a><a class="code" href="classDepartment.html#a17">00278</a> <span class="comment">void Department::generate_course() {</span>
00279     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;<a class="code" href="Ocourse_8h.html#a13">MAX_COURSE_DEPTH_FOCUS</a> ; i++ ) {
00280         <span class="comment">// total: 7*5 = 35</span>
00281         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> j=0 ; j&lt;<a class="code" href="Ocourse_8h.html#a39a29">MAX_TEACHING_METHOD</a> ; j++ ) {
00282             <a class="code" href="classCourse.html">Course</a> course;
00283 
00284             memset( &amp;course, 0, <span class="keyword">sizeof</span>(<a class="code" href="classCourse.html">Course</a>) );
00285 
00286             course.<a class="code" href="classCourse.html#m1">department_recno</a> = department_recno;
00287 
00288             course.<a class="code" href="classCourse.html#m2">depth_category</a> = course_array.get_depth(i);
00289             course.<a class="code" href="classCourse.html#m3">focus_category</a> = course_array.get_focus(i);
00290 
00291             course.<a class="code" href="classCourse.html#m4">teaching_method</a> = j;
00292 
00293             course_array.add(&amp;course);
00294         }
00295     }
00296 }
00297 
00298 <span class="comment">//---------- End of function Department::generate_course -----------//</span>
00299 
00300 <span class="comment">//##### begin fred 0824 #####//</span>
00301 <span class="comment">//---------- Begin of function Department::next_day -----------//</span>
<a name="l00303"></a><a class="code" href="classDepartment.html#a18">00303</a> <span class="comment">void Department::next_day() {</span>
00304     <span class="comment">// special case; before faculty_array.next_day()</span>
00305 
00306     <span class="keywordflow">if</span> ( info.game_day == 1 ) {
00307         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="Odept_8h.html#a19a16">RESEARCH_STATUS_COUNT</a>; i++)
00308             <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(research_m_history[i], HISTORY_MONTH_COUNT);
00309 
00310         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(research_total_history, HISTORY_MONTH_COUNT);
00311         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(research_direct_history, HISTORY_MONTH_COUNT);
00312         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(regular_faculty_with_research, HISTORY_MONTH_COUNT);
00313 
00314         <span class="keywordflow">if</span> ( info.game_month == finance.fiscal_year_start_month )
00315             <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Odept_8h.html#a19a16">RESEARCH_STATUS_COUNT</a>; i++)
00316                 <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(research_y_history[i], HISTORY_YEAR_COUNT);
00317     }
00318 
00319     <span class="comment">//--------------------------//</span>
00320 
00321     student_array.next_day();
00322 
00323     faculty_array.next_day();
00324 
00325     course_array.next_day();
00326 
00327     <span class="comment">// start of a trimester</span>
00328     <span class="keywordflow">if</span> ( info.game_day == player_school.trimester_array[player_school.cur_trimester].start_day
00329          &amp;&amp; info.game_month == player_school.trimester_array[player_school.cur_trimester].start_month ) {
00330         update_history(UPDATE_TRIMESTER);
00331     }
00332 
00333     <span class="comment">// start of a month</span>
00334     <span class="keywordflow">if</span> ( info.game_day == 1 ) {
00335         update_history(UPDATE_MONTH);
00336         sys.yield();
00337 
00338         <span class="comment">// start of a year</span>
00339         <span class="keywordflow">if</span> ( info.game_month == finance.fiscal_year_start_month ) {
00340             update_history(UPDATE_YEAR);
00341 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00342 <span class="preprocessor"></span>            <span class="comment">// reset this variable value</span>
00343             this-&gt;project_added_this_year = <span class="keyword">false</span>;
00344 <span class="preprocessor">#endif</span>
00345 <span class="preprocessor"></span>        }
00346     }
00347 }
00348 
00349 <span class="comment">//---------- End of function Department::next_day -----------//</span>
00350 
00351 <span class="comment">//---------- Begin of function Department::update_history -----------//</span>
<a name="l00357"></a><a class="code" href="classDepartment.html#a26">00357</a> <span class="comment">void Department::update_history(char update_flag) {</span>
00358     <span class="keywordtype">int</span> i;
00359 
00360     <span class="keywordflow">switch</span> (update_flag) {
00361     <span class="keywordflow">case</span> UPDATE_MONTH:
00362         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(p_faculty_research_history, HISTORY_MONTH_COUNT);
00363         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(p_faculty_morale_history, HISTORY_MONTH_COUNT);
00364 
00365         calc_faculty_research();
00366         calc_faculty_morale();
00367 
00368         p_faculty_research_history[THIS_MONTH] = p_faculty_research;
00369         p_faculty_morale_history[THIS_MONTH] = p_faculty_morale;
00370 
00371         <span class="comment">// special case</span>
00372         calc_research_dollar();
00373 
00374         calc_research_history();                    <span class="comment">// 1217             // must after calc_research_dollar()</span>
00375         <span class="keywordflow">break</span>;
00376 
00377     <span class="keywordflow">case</span> UPDATE_TRIMESTER:
00378         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(p_educational_quality_history, HISTORY_TRIMESTER_COUNT);
00379         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(p_student_morale_history, HISTORY_TRIMESTER_COUNT);
00380 
00381         <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Odept_8h.html#a17a2">EDUCATIONAL_QUALITY_VAR_COUNT</a>; i++)
00382             <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(var_educational_quality_history[i], HISTORY_TRIMESTER_COUNT);
00383         <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Odept_8h.html#a17a4">STUDENT_MORALE_VAR_COUNT</a>; i++)
00384             <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(var_student_morale_history[i], HISTORY_TRIMESTER_COUNT);
00385 
00386 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00387 <span class="preprocessor"></span>        <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(p_tech_utilization_history, HISTORY_TRIMESTER_COUNT);
00388 <span class="preprocessor">#endif</span>
00389 <span class="preprocessor"></span>
00390         calc_educational_quality();
00391         calc_student_morale();                      <span class="comment">// must after calc_educational_quality</span>
00392         calc_tech_utilization();                    <span class="comment">// special case don't have history</span>
00393 
00394         p_educational_quality_history[THIS_TRIMESTER] = p_educational_quality;
00395         p_student_morale_history[THIS_TRIMESTER] = p_student_morale;
00396 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00397 <span class="preprocessor"></span>        p_tech_utilization_history[THIS_TRIMESTER] = p_tech_utilization;
00398 
00399         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>( distance_credits_provided_history, HISTORY_TRIMESTER_COUNT );
00400         distance_credits_provided_history[THIS_TRIMESTER] = distance_credits_provided;
00401 <span class="preprocessor">#endif</span>
00402 <span class="preprocessor"></span>
00403         <span class="keywordflow">break</span>;
00404 
00405     <span class="keywordflow">case</span> UPDATE_YEAR:
00406         <span class="keywordflow">for</span> (i=0;i&lt;<a class="code" href="Ofaculty_8h.html#a30a22">FACULTY_RANK_LEVEL_COUNT_N_TOTAL</a>; i++)
00407             <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(faculty_level_history[i], HISTORY_YEAR_COUNT);
00408 
00409         <span class="keywordflow">for</span> (i=0;i&lt;<a class="code" href="Ostudent_8h.html#a34a12">MAX_STUDENT_LEVEL_N_TOTAL</a>; i++)
00410             <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(student_level_history[i], HISTORY_YEAR_COUNT);
00411 
00412         <span class="keywordflow">for</span> (i=0;i&lt;<a class="code" href="Gamedef_8h.html#a77a33">GENDER_ETHNIC_TYPE_COUNT_N_TOTAL</a>; i++) {
00413             <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(faculty_gender_history[i], HISTORY_YEAR_COUNT);
00414             <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(student_gender_history[i], HISTORY_YEAR_COUNT);
00415         }
00416 
00417         calc_faculty_history();
00418         calc_student_history();
00419 
00420         <span class="comment">//------//</span>
00421 
00422         <span class="keywordflow">if</span>( info.prerun_year==1 )                   <span class="comment">// only do this once during initialization.</span>
00423             calc_research_norm();
00424 
00425         <span class="comment">//------//</span>
00426         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(p_academic_standing_history, HISTORY_YEAR_COUNT);
00427         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(p_faculty_diversity_history, HISTORY_YEAR_COUNT);
00428         <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Odept_8h.html#a17a3">ACADEMIC_STANDING_VAR_COUNT</a>; i++)
00429             <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(var_academic_standing_history[i], HISTORY_YEAR_COUNT);
00430 
00431         calc_academic_standing();
00432         calc_faculty_diversity();
00433 
00434         p_academic_standing_history[THIS_YEAR] = p_academic_standing;
00435         p_faculty_diversity_history[THIS_YEAR] = p_faculty_diversity;
00436 
00437         <span class="keywordflow">break</span>;
00438 
00439     <span class="keywordflow">case</span> UPDATE_ALL:
00440         update_history(UPDATE_MONTH);
00441         update_history(UPDATE_TRIMESTER);
00442         update_history(UPDATE_YEAR);
00443 
00444         <span class="comment">// 0223; fix for interface bug</span>
00445         <span class="keywordflow">for</span> (i=THIS_MONTH-1; i&gt;=THIS_MONTH-2; i--) {
00446             research_total_history[i] = research_total_history[THIS_MONTH];
00447             research_direct_history[i] = research_direct_history[THIS_MONTH];
00448             regular_faculty_with_research[i] = regular_faculty_with_research[THIS_MONTH];
00449         }
00450         <span class="keywordflow">break</span>;
00451     <span class="keywordflow">default</span>:
00452         <a class="code" href="ALL_8H.html#a1">err_here</a>();
00453         <span class="keywordflow">break</span>;
00454     }
00455 }
00456 
00457 <span class="comment">//---------- End of function Department::update_history -----------//</span>
00458 <span class="comment">//##### end fred 0824 #####//</span>
00459 
00460 <span class="comment">// ##### Begin MArco ##### //</span>
00461 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00462 <span class="preprocessor"></span><span class="comment">//---------- Begin of functio Department::save_initial_data -------//</span>
00463 <span class="keywordtype">void</span> Department::save_initial_data() {
00464     initial_p_faculty_morale = <a class="code" href="classDepartment.html#m43">p_faculty_morale</a>;
00465     initial_p_faculty_diversity = <a class="code" href="classDepartment.html#m45">p_faculty_diversity</a>;
00466     initial_p_faculty_research = <a class="code" href="classDepartment.html#m38">p_faculty_research</a>;
00467     initial_p_student_morale = <a class="code" href="classDepartment.html#m44">p_student_morale</a>;
00468     initial_p_academic_standing = <a class="code" href="classDepartment.html#m39">p_academic_standing</a>;
00469     initial_p_educational_quality = <a class="code" href="classDepartment.html#m42">p_educational_quality</a>;;
00470     initial_pressure_to_change_teaching_load = <a class="code" href="classDepartment.html#m12">pressure_to_change_teaching_load</a>;
00471 
00472     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0 ; i &lt; <a class="code" href="OCOURRES_8H.html#a8a2">COURSE_PREFERENCE_COUNT</a>; i++)
00473         initial_course_preference[i] = <a class="code" href="classDepartment.html#m15">course_preference</a>[i];
00474 
00475     <span class="keywordflow">for</span> (i = 0 ; i &lt; <a class="code" href="Ostudent_8h.html#a34a12">MAX_STUDENT_LEVEL_N_TOTAL</a>; i++) {
00476         <span class="comment">//              for (int j = 0; j &lt; HISTORY_TRIMESTER_COUNT; j++)</span>
00477         <span class="comment">//                      initial_dept_student_level_history[i][j] = dept_student_level_history[i][j];</span>
00478         <span class="comment">//new</span>
00479         initial_dept_student_level_history[i] = <a class="code" href="classDepartment.html#m48">dept_student_level_history</a>[i][HISTORY_TRIMESTER_COUNT - 1];
00480     }
00481 
00482     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="Gamedef_8h.html#a77a33">GENDER_ETHNIC_TYPE_COUNT_N_TOTAL</a>; i++) {
00483         <span class="comment">//              for (int j = 0; j &lt; HISTORY_TRIMESTER_COUNT; j++)</span>
00484         <span class="comment">//                      initial_dept_gender_student_level_history[i][j] = dept_gender_student_level_history[i][j];</span>
00485         <span class="comment">//NEW</span>
00486         initial_dept_gender_student_level_history[i] = <a class="code" href="classDepartment.html#m50">dept_gender_student_level_history</a>[i][HISTORY_TRIMESTER_COUNT - 1];
00487     }
00488 
00489     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="Ofaculty_8h.html#a30a22">FACULTY_RANK_LEVEL_COUNT_N_TOTAL</a>; i++) {
00490         initial_faculty_level[i] = <a class="code" href="classDepartment.html#m64">faculty_level_history</a>[i][HISTORY_YEAR_COUNT-1];
00491     }
00492 
00493     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="Gamedef_8h.html#a77a33">GENDER_ETHNIC_TYPE_COUNT_N_TOTAL</a>; i++) {
00494         initial_faculty_gender[i] = <a class="code" href="classDepartment.html#m65">faculty_gender_history</a>[i][HISTORY_YEAR_COUNT-1];
00495     }
00496 
00497     initial_p_faculty_morale = <a class="code" href="classDepartment.html#m56">p_faculty_morale_history</a>[HISTORY_MONTH_COUNT-1];
00498 
00499     initial_research_total = <a class="code" href="classDepartment.html#m68">research_total_history</a>[HISTORY_MONTH_COUNT-1];
00500     initial_research_direct = <a class="code" href="classDepartment.html#m69">research_direct_history</a>[HISTORY_MONTH_COUNT-1];
00501     <span class="comment">// 99-&gt;99%</span>
00502     initial_regular_faculty_with_research = <a class="code" href="classDepartment.html#m70">regular_faculty_with_research</a>[HISTORY_MONTH_COUNT-1];
00503 
00504     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="Ofaculty_8h.html#a28a14">DISCRETIONARY_TYPE_COUNT</a>; i++)
00505         initial_priority_discretionary_hour_array[i] = <a class="code" href="classDepartment.html#m10">priority_discretionary_hour_array</a>[i];
00506 
00507     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="Odept_8h.html#a19a16">RESEARCH_STATUS_COUNT</a>; i++) {
00508         initial_research_m[i] = <a class="code" href="classDepartment.html#m66">research_m_history</a>[i][HISTORY_MONTH_COUNT-1];
00509         initial_research_y[i] = <a class="code" href="classDepartment.html#m67">research_y_history</a>[i][HISTORY_YEAR_COUNT-1];
00510     }
00511 
00512     <span class="keywordflow">for</span> ( i=0; i&lt;<a class="code" href="Odept_8h.html#a17a2">EDUCATIONAL_QUALITY_VAR_COUNT</a>; i++ ) {
00513         initial_education_equality[i] = <a class="code" href="classDepartment.html#m58">var_educational_quality_history</a>[i][HISTORY_TRIMESTER_COUNT-1];
00514     }
00515 
00516     <span class="keywordflow">for</span> ( i=0; i&lt;<a class="code" href="Odept_8h.html#a17a3">ACADEMIC_STANDING_VAR_COUNT</a>; i++ ) {
00517         initial_academic_standing[i] = <a class="code" href="classDepartment.html#m59">var_academic_standing_history</a>[i][HISTORY_YEAR_COUNT-1];
00518     }
00519 
00520     <a class="code" href="classGeneralDepartment.html#m0">student_array</a>.save_initial_data();
00521     <a class="code" href="classDepartment.html#m0">faculty_array</a>.save_initial_data();
00522     <a class="code" href="classDepartment.html#m1">course_array</a>.save_initial_data();
00523 }
00524 
00525 <span class="comment">//---------- End of functio Department::save_initial_data -------//</span>
00526 <span class="preprocessor">#endif</span>
00527 <span class="preprocessor"></span><span class="comment">// ##### End Marco ##### //</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:22 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
