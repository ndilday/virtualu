<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Ovalsldr.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Ovalsldr.cpp</h1><a href="Ovalsldr_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OVALSLDR.CPP</span>
00002 <span class="comment">//Description : Object ValueSlider</span>
00003 
00004 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00005 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>
00006 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00007 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00008 <span class="preprocessor">#include &lt;OFONT.H&gt;</span>
00009 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00010 <span class="preprocessor">#include &lt;<a class="code" href="OVALSLDR_8H.html">OVALSLDR.H</a>&gt;</span>
00011 <span class="preprocessor">#include &lt;OMISC.H&gt;</span>
00012 <span class="preprocessor">#include &lt;OIFACE.H&gt;</span>
00013 
00014 <span class="comment">//-------------- Define static vars ------------//</span>
00015 
00016 <span class="keyword">static</span> <span class="keywordtype">char</span> paint_flag = 0;
00017 
00018 <span class="comment">//-------- Begin of function ValueSlider::ValueSlider ----//</span>
<a name="l00020"></a><a class="code" href="classValueSlider.html#a0">00020</a> <span class="comment">ValueSlider::ValueSlider() {</span>
00021     value_slider_bitmap = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00022     init_flag = 0;
00023     target_flat = 0;
00024 }
00025 
00026 <span class="comment">//---------- End of function ValueSlider::ValueSlider ----//</span>
00027 
00028 <span class="comment">//-------- Begin of function ValueSlider::~ValueSlider ---//</span>
<a name="l00030"></a><a class="code" href="classValueSlider.html#a1">00030</a> <span class="comment">ValueSlider::~ValueSlider() {</span>
00031     deinit();
00032 }
00033 
00034 <span class="comment">//---------- End of function ValueSlider::~ValueSlider ---//</span>
00035 
00036 <span class="comment">//-------- Begin of function ValueSlider::init --------//</span>
00054 <span class="comment">void ValueSlider::init( int x1, int y1, int barWidth, int barHeight, int minVal, int maxVal,</span>
00055                         <span class="keywordtype">int</span>* varPtr, <span class="keywordtype">int</span> transparentFlag, <span class="keywordtype">int</span> barColor, <span class="keywordtype">int</span> formatType ) {
00056     <a class="code" href="ALL_8H.html#a0">err_when</a>(minVal &gt; maxVal || barWidth &lt; 0 || barHeight &lt; 0);
00057 
00058     value_slider_x1 = x1;
00059     value_slider_y1 = y1;
00060     value_slider_x2 = x1 + barWidth + 3;
00061     value_slider_y2 = y1 + barHeight + 2;
00062 
00063     bar_width = value_slider_x2 - value_slider_x1 - 6;
00064 
00065     min_val = minVal;
00066     max_val = maxVal;
00067     var_ptr = varPtr;
00068 
00069     <span class="keywordflow">if</span>(*varPtr&gt;maxVal)max_val=*varPtr;
00070     <span class="keywordflow">if</span>(*varPtr&lt;minVal)min_val=*varPtr;
00071 
00072     bar_color = barColor;
00073     format_type = formatType;
00074     transparent_flag = transparentFlag;
00075 
00076     font_ptr = &amp;font_barcharts;
00077 
00078     init_flag = 1;
00079 
00080     paint();
00081 }
00082 
00083 <span class="comment">//------------- End of function ValueSlider::init -----------//</span>
00084 
00085 <span class="comment">//## chea 060999 begin for adding a target bar on the value slider</span>
00086 <span class="comment">//-------- Begin of function init_target::init --------//</span>
00094 <span class="comment"></span>
<a name="l00095"></a><a class="code" href="classValueSlider.html#a3">00095</a> <span class="keywordtype">void</span> <a class="code" href="classValueSlider.html#a3">ValueSlider::init_target</a>( <span class="keywordtype">int</span> x1, <span class="keywordtype">int</span> y1, <span class="keywordtype">int</span> height, <span class="keywordtype">int</span> width, <span class="keywordtype">int</span> borderColor, <span class="keywordtype">int</span> shadowColor) {
00096 
00097     tar_x_pos = x1;
00098     tar_y_pos = y1;
00099     tar_height = height;
00100     tar_width = width;
00101     tar_borderColor = borderColor;
00102     tar_shadowColor = shadowColor;
00103 
00104     target_flat = 1;
00105     <span class="comment">// ##### begin Gilbert 23/04/2001 ##### //</span>
00106     <span class="comment">// user_interface.v_line(tar_x_pos,tar_y_pos,tar_height,tar_width,tar_borderColor,tar_shadowColor,&amp;vga_front); //## chea 030999 bar draw here</span>
00107     user_interface.v_line(tar_x_pos,tar_y_pos,tar_height,tar_width,tar_borderColor,tar_shadowColor,<a class="code" href="classVga.html#p0">Vga::active_buf</a>);
00108     <span class="comment">// ##### end Gilbert 23/04/2001 ##### //</span>
00109 }
00110 
00111 <span class="comment">//------------- End of function ValueSlider::init_target -----------//</span>
00112 
00113 <span class="comment">//-------- Begin of function ValueSlider::set_target --------//</span>
00121 <span class="comment"></span>
<a name="l00122"></a><a class="code" href="classValueSlider.html#a4">00122</a> <span class="keywordtype">void</span> <a class="code" href="classValueSlider.html#a4">ValueSlider::set_target</a>( <span class="keywordtype">int</span> x1, <span class="keywordtype">int</span> y1, <span class="keywordtype">int</span> height, <span class="keywordtype">int</span> width, <span class="keywordtype">int</span> borderColor, <span class="keywordtype">int</span> shadowColor) {
00123 
00124     <span class="keywordflow">if</span>(target_flat == 0)
00125         <span class="keywordflow">return</span>;
00126 
00127     tar_x_pos = x1;
00128     tar_y_pos = y1;
00129     tar_height = height;
00130     tar_width = width;
00131     tar_borderColor = borderColor;
00132     tar_shadowColor = shadowColor;
00133 
00134 }
00135 
00136 <span class="comment">//------------- End of function ValueSlider::set_target -----------//</span>
00137 
00138 <span class="comment">//-------- Begin of function ValueSlider::deinit ------------//</span>
<a name="l00140"></a><a class="code" href="classValueSlider.html#a5">00140</a> <span class="comment">void ValueSlider::deinit() {</span>
00141     <span class="keywordflow">if</span> (init_flag) {
00142         <span class="keywordflow">if</span> (value_slider_bitmap) {
00143             <a class="code" href="ALL_8H.html#a8">mem_del</a>(value_slider_bitmap);
00144             value_slider_bitmap = <a class="code" href="OHELP_8H.html#a0">NULL</a>;
00145         }
00146     }
00147 
00148     init_flag = 0;
00149     target_flat = 0;
00150 
00151 }
00152 
00153 <span class="comment">//------------- End of function ValueSlider::deinit ---------//</span>
00154 
00155 <span class="comment">//----------- Begin of function ValueSlider::paint ----------//</span>
<a name="l00157"></a><a class="code" href="classValueSlider.html#a6">00157</a> <span class="comment">void ValueSlider::paint() {</span>
00158     <span class="keywordflow">if</span> (transparent_flag) {
00159         user_interface.brighten(value_slider_x1+3, value_slider_y1+3, value_slider_x2-2, value_slider_y2-2);
00160         value_slider_bitmap = vga_back.save_area(value_slider_x1+3, value_slider_y1+3, value_slider_x2-2, value_slider_y2-2, value_slider_bitmap);
00161     }
00162 
00163     paint_flag = 1;
00164     <span class="comment">//refresh();</span>
00165 }
00166 
00167 <span class="comment">//------------- End of function ValueSlider::paint ----------//</span>
00168 
00169 <span class="comment">//----------- Begin of function ValueSlider::refresh --------//</span>
<a name="l00171"></a><a class="code" href="classValueSlider.html#a7">00171</a> <span class="comment">void ValueSlider::refresh() {</span>
00172     <span class="keywordflow">if</span>(!init_flag)
00173         <span class="keywordflow">return</span>;
00174 
00175     <a class="code" href="ALL_8H.html#a0">err_when</a>(*var_ptr &gt; max_val || *var_ptr &lt; min_val);
00176 
00177     <span class="comment">//  vga.use_back();</span>
00178 
00179     <span class="comment">//  mouse.hide_area( value_slider_x1, value_slider_y1,</span>
00180     <span class="comment">//                                            value_slider_x2, value_slider_y2 );</span>
00181 
00182     <span class="keywordflow">if</span>(max_val==min_val)<span class="keywordflow">return</span>;
00183 
00184     <span class="keywordtype">short</span> x = (value_slider_x1 + 1) + bar_width
00185         * (*var_ptr - min_val) / (max_val - min_val);
00186 
00187     <span class="comment">//----- Draw the slider -----//</span>
00188 
00189     <span class="keywordflow">if</span> (transparent_flag) {
00190         vga_back.rest_area(value_slider_bitmap, 0, 0);
00191         user_interface.rect(value_slider_x1, value_slider_y1, value_slider_x2+3, value_slider_y2, 2);
00192     }
00193     <span class="keywordflow">else</span> {
00194         user_interface.bar(value_slider_x1, value_slider_y1, value_slider_x2+1, value_slider_y2);
00195         user_interface.panel(value_slider_x1+2, value_slider_y1+2, value_slider_x2-2, value_slider_y2-2);
00196     }
00197 
00198     <span class="comment">//----- Draw the bar area -----//</span>
00199 
00200     <span class="keywordflow">if</span> (x &gt;= value_slider_x1 + 3)
00201         user_interface.bar( value_slider_x1 + 4, value_slider_y1 + 4,
00202                             x + 1, value_slider_y2 - 3, bar_color );
00203     <span class="comment">//          user_interface.bar( value_slider_x1 + 3, value_slider_y1 + 4,</span>
00204     <span class="comment">//                                                            x, value_slider_y2 - 4, bar_color );</span>
00205 
00206     <span class="comment">//----- Draw the value in text -----//</span>
00207 
00208     <span class="comment">// ##### begin Gilbert 07/09/2001 ##### //</span>
00209     <span class="keywordflow">if</span>( format_type &gt; 0 )                           <span class="comment">// can suppress display</span>
00210         <span class="comment">// ##### end Gilbert 07/09/2001 ##### //</span>
00211         font_ptr-&gt;center_put(value_slider_x1, value_slider_y1, value_slider_x2, value_slider_y2, m.format(*var_ptr, format_type));
00212 
00213     <span class="comment">// ##### begin Gilbert 23/04/2001 ##### //</span>
00214     <span class="keywordflow">if</span>(target_flat==1)
00215         user_interface.v_line(tar_x_pos,tar_y_pos,tar_height,tar_width,tar_borderColor,tar_shadowColor,<a class="code" href="classVga.html#p0">Vga::active_buf</a>);
00216     <span class="comment">// ##### end Gilbert 23/04/2001 ##### //</span>
00217 
00218     <span class="comment">//  mouse.show_area();</span>
00219 
00220     <span class="comment">//  vga.use_front();</span>
00221     <span class="keywordflow">if</span> (!paint_flag)
00222         vga.blt_buf(value_slider_x1, value_slider_y1, value_slider_x2+2, value_slider_y2+2);
00223     <span class="keywordflow">else</span>
00224         paint_flag = 0;
00225 
00226     <span class="comment">// ##### begin Gilbert 23/04/2001 ##### //</span>
00227     <span class="comment">//## chea 060999 for adding a target bar on the value slider</span>
00228     <span class="comment">//if(target_flat==1)</span>
00229     <span class="comment">//user_interface.v_line(tar_x_pos,tar_y_pos,tar_height,tar_width,tar_borderColor,tar_shadowColor,&amp;vga_front); //## chea 030999 bar draw here</span>
00230     <span class="comment">// ##### end Gilbert 23/04/2001 ##### //</span>
00231 }
00232 
00233 <span class="comment">//------------- End of function ValueSlider::refresh ---------//</span>
00234 
00235 <span class="comment">//----------- Begin of function ValueSlider::detect ------------//</span>
<a name="l00240"></a><a class="code" href="classValueSlider.html#a8">00240</a> <span class="comment">int ValueSlider::detect() {</span>
00241     <span class="keywordflow">if</span> (!init_flag)
00242         <span class="keywordflow">return</span> 0;
00243 
00244     <span class="keywordflow">if</span> (!mouse.single_click( value_slider_x1, value_slider_y1,
00245                              value_slider_x2, value_slider_y2 ))
00246         <span class="keywordflow">return</span> 0;
00247 
00248     <span class="keywordtype">int</span> lastVar = *var_ptr;
00249 
00250     <span class="keywordtype">char</span> refreshFlag;
00251 
00252     <span class="keywordflow">do</span> {
00253         sys.yield();
00254         mouse.get_event();
00255         sys.blt_virtual_buf();
00256 
00257         refreshFlag = 0;
00258 
00259         *var_ptr = (mouse.cur_x - value_slider_x1 - 1)
00260             * (max_val - min_val) / bar_width + min_val;
00261 
00262         <span class="keywordflow">if</span>( *var_ptr &lt; min_val ) {
00263             *var_ptr = min_val;
00264             refresh();
00265             refreshFlag = 1;
00266         }
00267 
00268         <span class="keywordflow">if</span>( *var_ptr &gt; max_val ) {
00269             *var_ptr = max_val;
00270             refresh();
00271             refreshFlag = 1;
00272         }
00273 
00274         <span class="keywordflow">if</span>( lastVar != *var_ptr &amp;&amp; !refreshFlag )
00275             refresh();
00276     }
00277     <span class="keywordflow">while</span>( mouse.left_press );
00278 
00279     <span class="keywordflow">return</span> 1;
00280 }
00281 
00282 <span class="comment">//------------- End of function ValueSlider::detect ------------//</span>
00283 
00284 <span class="comment">//.........................................................//</span>
00285 
00286 <span class="comment">//-------- Begin of function ValueSliderGroup::ValueSliderGroup -------//</span>
00287 
<a name="l00288"></a><a class="code" href="classValueSliderGroup.html#a0">00288</a> <a class="code" href="classValueSliderGroup.html#a0">ValueSliderGroup::ValueSliderGroup</a>(<span class="keywordtype">int</span> valueSliderNum) {
00289     <a class="code" href="classValueSliderGroup.html#m0">value_slider_num</a> = valueSliderNum;
00290     <a class="code" href="classValueSliderGroup.html#m1">value_slider_array</a> = <span class="keyword">new</span> <a class="code" href="classValueSlider.html">ValueSlider</a>[valueSliderNum];
00291 }
00292 
00293 <span class="comment">//---------- End of function ValueSliderGroup::ValueSliderGroup -------//</span>
00294 
00295 <span class="comment">//--------- Begin of function ValueSliderGroup::paint -----------------//</span>
<a name="l00297"></a><a class="code" href="classValueSliderGroup.html#a2">00297</a> <span class="comment">void ValueSliderGroup::paint() {</span>
00298     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; value_slider_num; i++)
00299         value_slider_array[i].<a class="code" href="classValueSlider.html#a6">paint</a>();
00300 }
00301 
00302 <span class="comment">//----------- End of function ValueSliderGroup::paint ----------------//</span>
00303 
00304 <span class="comment">//--------- Begin of function ValueSliderGroup::detect ---------------//</span>
<a name="l00309"></a><a class="code" href="classValueSliderGroup.html#a3">00309</a> <span class="comment">int ValueSliderGroup::detect() {</span>
00310     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; value_slider_num; i++) {
00311         <span class="keywordflow">if</span> (value_slider_array[i].detect())
00312             <span class="keywordflow">return</span> i;
00313     }
00314     <span class="keywordflow">return</span> -1;
00315 }
00316 
00317 <span class="comment">//----------- End of function ValueSliderGroup::detect ---------------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:32 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
