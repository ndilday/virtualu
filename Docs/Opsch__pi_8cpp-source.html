<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Opsch_pi.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Opsch_pi.cpp</h1><a href="Opsch__pi_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OPSCH_PI.CPP</span>
00002 <span class="comment">//Description : School class</span>
00003 <span class="comment">//Owner       : Fred</span>
00004 
00005 <span class="preprocessor">#include &lt;All.h&gt;</span>
00006 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00007 <span class="preprocessor">#include &lt;OMATH.H&gt;</span>
00008 <span class="preprocessor">#include &lt;ODEPT.H&gt;</span>
00009 <span class="preprocessor">#include &lt;<a class="code" href="ODEPTRES_8H.html">ODEPTRES.H</a>&gt;</span>
00010 <span class="preprocessor">#include &lt;<a class="code" href="OPEERSCH_8H.html">OPEERSCH.H</a>&gt;</span>
00011 <span class="preprocessor">#include &lt;<a class="code" href="OSCHLRES_8H.html">OSCHLRES.H</a>&gt;</span>
00012 <span class="preprocessor">#include &lt;OCHANCE.H&gt;</span>
00013 <span class="preprocessor">#include &lt;OFINANCE.H&gt;</span>
00014 <span class="preprocessor">#include &lt;OATHLETI.H&gt;</span>
00015 <span class="preprocessor">#include &lt;ODEVELOP.H&gt;</span>
00016 <span class="preprocessor">#include &lt;OFACILIT.H&gt;</span>
00017 <span class="preprocessor">#include &lt;OENROLL.H&gt;</span>
00018 <span class="preprocessor">#include &lt;OINVEST.H&gt;</span>
00019 <span class="preprocessor">#include &lt;OCHANCE.H&gt;</span>
00020 
00021 <span class="preprocessor">#include &lt;OPSCHOOL.H&gt;</span>
00022 <span class="preprocessor">#include &lt;<a class="code" href="OTASK_8H.html">OTASK.H</a>&gt;</span>                                <span class="comment">//## chea 200899</span>
00023 
00024 <span class="keyword">static</span> <span class="keywordtype">float</span> default_sub_score_weight[<a class="code" href="Opschool_8h.html#a65a52">SCORE_VAR_COUNT</a>] = {
00025     0.120f,0.080f,
00026     0.070f,0.070f,0.070f,0.035f,0.035f,0.070f,
00027     0.075f,0.045f,0.030f,
00028     0.060f,0.090f,0.075f,0.075f,
00029 };
00030 
00031 <span class="comment">//------ Begin of function sort_peer_school_score_function ------//</span>
00035 <span class="comment">static int sort_peer_school_score_function( const void *a, const void *b ) {</span>
00036     <span class="keywordtype">float</span> valueA = school_res.peer_school_array[(*((<span class="keywordtype">short</span>*)a))].game_score;
00037     <span class="keywordtype">float</span> valueB = school_res.peer_school_array[(*((<span class="keywordtype">short</span>*)b))].game_score;
00038 
00039     <span class="keywordtype">float</span> rc = valueA - valueB;
00040 
00041     <span class="keywordflow">if</span>( rc &gt; 0 )
00042         <span class="keywordflow">return</span> -1;
00043     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( rc &lt; 0 )
00044         <span class="keywordflow">return</span> 1;
00045     <span class="keywordflow">else</span>
00046         <span class="keywordflow">return</span> 0;
00047 }
00048 
<a name="l00049"></a><a class="code" href="Opsch__pi_8cpp.html#a2">00049</a> <span class="keyword">inline</span> <span class="keywordtype">char</span> <a class="code" href="Opsch__pi_8cpp.html#a2">get_group_index</a>(<span class="keywordtype">int</span> i) {
00050     <span class="keywordtype">int</span> grp;
00051     <span class="keywordflow">if</span> ( i &gt;= <a class="code" href="Opschool_8h.html#a65a55">GROUP2_BEGIN_ID</a> &amp;&amp; i &lt; <a class="code" href="Opschool_8h.html#a65a56">GROUP3_BEGIN_ID</a> )
00052         grp=1;
00053     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( i &gt;= <a class="code" href="Opschool_8h.html#a65a56">GROUP3_BEGIN_ID</a> &amp;&amp; i &lt; <a class="code" href="Opschool_8h.html#a65a57">GROUP4_BEGIN_ID</a> )
00054         grp=2;
00055     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( i &gt;= <a class="code" href="Opschool_8h.html#a65a57">GROUP4_BEGIN_ID</a> )
00056         grp=3;
00057     <span class="keywordflow">else</span>
00058         grp=0;
00059 
00060     <span class="keywordflow">return</span> grp;
00061 }
00062 
00063 <span class="comment">//------- End of function sort_peer_school_score_function ------//</span>
00064 
00065 <span class="comment">//---------- Begin of function PlayerSchool::init_pi -----------//</span>
<a name="l00069"></a><a class="code" href="classPlayerSchool.html#a43">00069</a> <span class="comment">void PlayerSchool::init_pi() {</span>
00070     <span class="comment">//-------------------------//</span>
00071     <span class="comment">// refer to section 7.1 of WFM notes 0919</span>
00072 
00073     <a class="code" href="classPeerSchool.html">PeerSchool</a>* sch = school_res.player_peer_school;
00074     <span class="keywordtype">float</span> degreeGrantedInit[<a class="code" href="Ostudent_8h.html#a0">MAX_STUDENT_LEVEL</a>];
00075 
00076     degreeGrantedInit[<a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>] = sch-&gt;<a class="code" href="classSchool.html#m91">total_bach_degrees</a>;
00077     degreeGrantedInit[<a class="code" href="Ostudent_8h.html#a32a4">UG_NONTRADITION</a>] = sch-&gt;<a class="code" href="classSchool.html#m91">total_bach_degrees</a> / 2.0f;
00078     degreeGrantedInit[<a class="code" href="Ostudent_8h.html#a32a5">MASTER</a>] = sch-&gt;<a class="code" href="classSchool.html#m92">total_masters_and_prof_degree</a>;
00079     degreeGrantedInit[<a class="code" href="Ostudent_8h.html#a32a6">DOCTOR</a>] = sch-&gt;<a class="code" href="classSchool.html#m93">total_doctoral_degrees</a>;
00080     degreeGrantedInit[<a class="code" href="Ostudent_8h.html#a32a7">DISTANCE_LEARN</a>] = degreeGrantedInit[<a class="code" href="Ostudent_8h.html#a32a4">UG_NONTRADITION</a>]; {
00081 
00082         <span class="comment">//990507</span>
00083 
00084         <span class="keywordtype">float</span> totalDegree=0;
00085         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="Ostudent_8h.html#a0">MAX_STUDENT_LEVEL</a>; i++ )
00086             totalDegree += degreeGrantedInit[i];
00087 
00088         <span class="keywordtype">float</span> idealDegreeSL1 = enroll_res.student_count[<a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>] / 4.0f;
00089         <span class="keywordtype">float</span> ratio = idealDegreeSL1 * totalDegree / degreeGrantedInit[<a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>];
00090 
00091         <span class="keywordflow">for</span> ( i=0; i&lt;<a class="code" href="Ostudent_8h.html#a0">MAX_STUDENT_LEVEL</a>; i++ )
00092             degreeGrantedInit[i] *= ratio / totalDegree;
00093     }
00094 
00095     <a class="code" href="ALL_8H.html#a0">err_when</a>(degreeGrantedInit[<a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>] &lt;= 0);
00096 
00097     degree_granted_weight[<a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>] = (float) degreeGrantedInit[<a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>];
00098 
00099     <span class="keywordtype">float</span> adjust[3] = { 2,4,15 };
00100     <span class="keywordflow">for</span> (<span class="keywordtype">char</span> sl=<a class="code" href="Ostudent_8h.html#a32a4">UG_NONTRADITION</a>; sl&lt;=<a class="code" href="Ostudent_8h.html#a32a6">DOCTOR</a>; sl++)
00101         degree_granted_weight[sl] = ( degreeGrantedInit[sl] &gt; 0 ) ? (float) degreeGrantedInit[sl] : float(degreeGrantedInit[<a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>]) / adjust[sl-<a class="code" href="Ostudent_8h.html#a32a4">UG_NONTRADITION</a>];
00102 
00103     <span class="comment">//990507 degree_granted_weight[UG_TRADITION] = (float) degreeGrantedInit[UG_TRADITION];</span>
00104     degree_granted_weight[<a class="code" href="Ostudent_8h.html#a32a7">DISTANCE_LEARN</a>] = (float) degreeGrantedInit[<a class="code" href="Ostudent_8h.html#a32a4">UG_NONTRADITION</a>];
00105 
00106     <span class="keywordflow">for</span> (sl=0, degree_granted_ratio_init=0 ; sl&lt;<a class="code" href="Ostudent_8h.html#a0">MAX_STUDENT_LEVEL</a>; sl++) {
00107         degree_granted_weight[sl] = 1.0f / degree_granted_weight[sl];
00108         degree_granted_ratio_init += degree_granted_weight[sl] * degreeGrantedInit[sl];
00109     }
00110 
00111     <a class="code" href="ALL_8H.html#a0">err_when</a>(degree_granted_ratio_init == 0);
00112 
00113     <span class="comment">//-------------------------//</span>
00114     init_research_dollar = -1;
00115     <span class="comment">//grad_count = 0;</span>
00116     <span class="comment">//matrics_count = 0;</span>
00117 
00118     <span class="comment">//-------------------------//</span>
00119     memset(score_group_weight, 0, <span class="keyword">sizeof</span>(score_group_weight));
00120 
00121     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="Opschool_8h.html#a65a52">SCORE_VAR_COUNT</a>; i++) {
00122 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00123 <span class="preprocessor"></span>        <span class="comment">// sub_score_weight already initialized in game setting</span>
00124 <span class="preprocessor">#else</span>
00125 <span class="preprocessor"></span>        <span class="comment">// memcpy!</span>
00126         sub_score_weight[i] = default_sub_score_weight[i] * 100;
00127 <span class="preprocessor">#endif</span>
00128 <span class="preprocessor"></span>
00129         <span class="comment">// calc group info for if</span>
00130         <span class="comment">//</span>
00131         <span class="keywordtype">char</span> grp = <a class="code" href="Opsch__pi_8cpp.html#a2">get_group_index</a>(i);
00132 
00133         score_group_weight[grp] += sub_score_weight[i];
00134     }
00135 }
00136 
00137 <span class="comment">//---------- End of function PlayerSchool::init_pi -----------//</span>
00138 
00139 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00140 <span class="preprocessor"></span>
00141 <span class="comment">//---------- Begin of function PlayerSchool::init_sub_score_weight -----------//</span>
00146 <span class="comment">void PlayerSchool::init_sub_score_weight(int subScoreGroup) {</span>
00147     <span class="keywordtype">int</span> i;
00148     <span class="keywordflow">if</span>( subScoreGroup &lt; 0 ) {
00149         <span class="keywordflow">for</span>( i = 0; i &lt; <a class="code" href="Opschool_8h.html#a65a52">SCORE_VAR_COUNT</a>; ++i )
00150             sub_score_weight[i] = default_sub_score_weight[i] * 100;
00151     }
00152     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( subScoreGroup == 0 ) {
00153         <span class="keywordflow">for</span>( i = <a class="code" href="Opschool_8h.html#a65a54">GROUP1_BEGIN_ID</a>; i &lt; <a class="code" href="Opschool_8h.html#a65a55">GROUP2_BEGIN_ID</a>; ++i )
00154             sub_score_weight[i] = default_sub_score_weight[i] * 100;
00155     }
00156     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( subScoreGroup == 1 ) {
00157         <span class="keywordflow">for</span>( i = <a class="code" href="Opschool_8h.html#a65a55">GROUP2_BEGIN_ID</a>; i &lt; <a class="code" href="Opschool_8h.html#a65a56">GROUP3_BEGIN_ID</a>; ++i )
00158             sub_score_weight[i] = default_sub_score_weight[i] * 100;
00159     }
00160     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( subScoreGroup == 2 ) {
00161         <span class="keywordflow">for</span>( i = <a class="code" href="Opschool_8h.html#a65a56">GROUP3_BEGIN_ID</a>; i &lt; <a class="code" href="Opschool_8h.html#a65a57">GROUP4_BEGIN_ID</a>; ++i )
00162             sub_score_weight[i] = default_sub_score_weight[i] * 100;
00163     }
00164     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( subScoreGroup == 3 ) {
00165         <span class="keywordflow">for</span>( i = <a class="code" href="Opschool_8h.html#a65a57">GROUP4_BEGIN_ID</a>; i &lt; <a class="code" href="Opschool_8h.html#a65a52">SCORE_VAR_COUNT</a>; ++i )
00166             sub_score_weight[i] = default_sub_score_weight[i] * 100;
00167     }
00168     <span class="keywordflow">else</span> {
00169         <a class="code" href="ALL_8H.html#a1">err_here</a>();
00170     }
00171 }
00172 
00173 <span class="comment">//---------- End of function PlayerSchool::init_sub_score_weight -----------//</span>
00174 
00175 <span class="comment">//---------- Begin of function PlayerSchool::normalize_sub_score_weight -----------//</span>
00179 <span class="comment">void PlayerSchool::normalize_sub_score_weight() {</span>
00180     <span class="keywordtype">float</span> sumWeight = 0.0f;
00181     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="Opschool_8h.html#a65a52">SCORE_VAR_COUNT</a>; ++i )
00182         sumWeight += sub_score_weight[i];
00183 
00184     <span class="keywordflow">if</span>( sumWeight &lt;= 0.0f ) {
00185         init_sub_score_weight(-1);                    <span class="comment">// avoid divided by zero, restore default</span>
00186         <span class="keywordflow">return</span>;
00187     }
00188 
00189     <span class="keywordflow">for</span>( i = 0; i &lt; <a class="code" href="Opschool_8h.html#a65a52">SCORE_VAR_COUNT</a>; ++i )
00190         sub_score_weight[i] *= 100.0f / sumWeight;
00191 }
00192 
00193 <span class="comment">//---------- End of function PlayerSchool::init_sub_score_weight -----------//</span>
00194 
00195 <span class="comment">//---------- Begin of function PlayerSchool::get_default_sub_score_weight -----------//</span>
00197 <span class="comment">float PlayerSchool::get_default_sub_score_weight(int i) {</span>
00198     <span class="keywordflow">return</span> default_sub_score_weight[i] * 100;
00199 }
00200 
00201 <span class="comment">//---------- End of function PlayerSchool::get_default_sub_score_weight -----------//</span>
00202 <span class="preprocessor">#endif</span>
00203 <span class="preprocessor"></span>
00204 <span class="comment">//---------- Begin of function PlayerSchool::update_history -----------//</span>
<a name="l00210"></a><a class="code" href="classPlayerSchool.html#a46">00210</a> <span class="comment">void PlayerSchool::update_history(char update_flag) {</span>
00211     <span class="keywordflow">switch</span> (update_flag) {
00212     <span class="keywordflow">case</span> UPDATE_MONTH:
00213         <span class="comment">//## chea 071299 1.12.1 this is done in department_array.next_day</span>
00214         calc_performance_monthly();                 <span class="comment">// calc score</span>
00215 
00216         summer_emphasis_last = summer_emphasis;     <span class="comment">//1125</span>
00217         <span class="keywordflow">break</span>;
00218     <span class="keywordflow">case</span> UPDATE_TRIMESTER:
00219         <span class="keywordflow">break</span>;
00220     <span class="keywordflow">case</span> UPDATE_YEAR:
00221         calc_performance_yearly();                  <span class="comment">// include *_degree[HISTORY_YEAR_COUNT]//##chea 290100 try to loca the bug</span>
00222         <span class="keywordflow">break</span>;
00223     <span class="keywordflow">case</span> UPDATE_ALL:
00224         update_history(UPDATE_YEAR);
00225         update_history(UPDATE_MONTH);
00226         update_history(UPDATE_TRIMESTER);
00227         <span class="keywordflow">break</span>;
00228     <span class="keywordflow">default</span>:
00229         <a class="code" href="ALL_8H.html#a1">err_here</a>();
00230         <span class="keywordflow">break</span>;
00231     }
00232 }
00233 
00234 <span class="comment">//---------- End of function PlayerSchool::update_history -----------//</span>
00235 
00236 <span class="comment">//---------- Begin of function PlayerSchool::calc_performance_yearly -----------//</span>
00237 <span class="keywordtype">void</span> PlayerSchool::calc_performance_yearly() {
00238 
00239     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(<a class="code" href="classPlayerSchool.html#m100">bachelor_degree</a>, HISTORY_YEAR_COUNT);
00240 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00241 <span class="preprocessor"></span>    <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(non_ug_bachelor_degree, HISTORY_YEAR_COUNT);
00242 <span class="preprocessor">#endif</span>
00243 <span class="preprocessor"></span>    <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(<a class="code" href="classPlayerSchool.html#m101">master_degree</a>, HISTORY_YEAR_COUNT);
00244     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(<a class="code" href="classPlayerSchool.html#m102">doctor_degree</a>, HISTORY_YEAR_COUNT);
00245 
00246     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y=0; y&lt;<a class="code" href="Ostudent_8h.html#a33a8">DEGREE_TYPE_COUNT</a>; y++) {
00247         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(<a class="code" href="classPlayerSchool.html#m97">time_to_degree</a>[y], HISTORY_YEAR_COUNT);
00248         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(<a class="code" href="classPlayerSchool.html#m99">fake_disp_time_to_degree</a>[y], HISTORY_YEAR_COUNT);
00249         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(<a class="code" href="classPlayerSchool.html#m98">dropout_rate</a>[y], HISTORY_YEAR_COUNT);
00250     }
00251 
00252     <span class="keywordtype">int</span> i, deptCount = 0;
00253     <a class="code" href="classDepartment.html">Department</a>* deptPtr;
00254 
00255     <span class="keywordflow">for</span> ( i=department_array.size(); i&gt;0; i-- ) {
00256         <span class="keywordflow">if</span> ( department_array.is_deleted(i) )
00257             <span class="keywordflow">continue</span>;
00258 
00259         deptPtr = department_array[i];
00260 
00261         <a class="code" href="classPlayerSchool.html#m100">bachelor_degree</a>[THIS_YEAR] += deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#m14">bachelor_degree</a>[THIS_YEAR];
00262 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00263 <span class="preprocessor"></span>        non_ug_bachelor_degree[THIS_YEAR] += deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.non_ug_bachelor_degree[THIS_YEAR];
00264 <span class="preprocessor">#endif</span>
00265 <span class="preprocessor"></span>        <a class="code" href="classPlayerSchool.html#m101">master_degree</a>[THIS_YEAR] += deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#m15">master_degree</a>[THIS_YEAR];
00266         <span class="comment">//0223</span>
00267         <a class="code" href="classPlayerSchool.html#m102">doctor_degree</a>[THIS_YEAR] += deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#m16">doctor_degree</a>[THIS_YEAR];
00268 
00269         <span class="keywordflow">for</span> (y=0; y&lt;<a class="code" href="Ostudent_8h.html#a33a8">DEGREE_TYPE_COUNT</a>; y++) {
00270             <a class="code" href="classPlayerSchool.html#m97">time_to_degree</a>[y][THIS_YEAR] += deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#m11">time_to_degree</a>[y][THIS_YEAR];
00271             <a class="code" href="classPlayerSchool.html#m98">dropout_rate</a>[y][THIS_YEAR] += deptPtr-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#m12">dropout_rate</a>[y][THIS_YEAR];
00272         }
00273 
00274         deptCount++;
00275     }
00276 
00277     <span class="comment">//------------------------//</span>
00278 
00279     <span class="keywordflow">for</span> (y=0; y&lt;<a class="code" href="Ostudent_8h.html#a33a8">DEGREE_TYPE_COUNT</a>; y++)
00280         <a class="code" href="classPlayerSchool.html#m97">time_to_degree</a>[y][THIS_YEAR] /= deptCount;
00281 
00282     <span class="comment">//--- special case handling: smooth the graph for bachelor Time to Degree ---//</span>
00283 
00284     <a class="code" href="classPlayerSchool.html#m99">fake_disp_time_to_degree</a>[<a class="code" href="Ostudent_8h.html#a33a9">BACHELOR_DEGREE</a>][THIS_YEAR] = m.fmax( <a class="code" href="classPlayerSchool.html#m97">time_to_degree</a>[<a class="code" href="Ostudent_8h.html#a33a9">BACHELOR_DEGREE</a>][THIS_YEAR], math.get_random_snd(4.3f, 0.07f) );
00285 
00286     <span class="comment">//------------------------//</span>
00287 
00288     <a class="code" href="classGeneralDepartment.html">GeneralDepartment</a>* genDept = &amp;department_res.general_dept;
00289 
00290     <span class="keywordflow">for</span> (y=0; y&lt;<a class="code" href="Ostudent_8h.html#a33a8">DEGREE_TYPE_COUNT</a>; y++) {
00291         <a class="code" href="classPlayerSchool.html#m98">dropout_rate</a>[y][THIS_YEAR] += genDept-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>.<a class="code" href="classStudentArray.html#m12">dropout_rate</a>[y][THIS_YEAR];
00292     }
00293 
00294     <span class="comment">//990408 for (y=0; y&lt;DEGREE_TYPE_COUNT; y++)</span>
00295     <span class="comment">//990408    dropout_rate[y][THIS_YEAR] /= deptCount + 1;</span>
00296 }
00297 
00298 <span class="comment">//---------- Begin of function PlayerSchool::calc_performance_yearly -----------//</span>
00299 
00300 <span class="comment">//---------- Begin of function PlayerSchool::calc_performance_monthly -----------//</span>
00301 <span class="keywordtype">void</span> PlayerSchool::calc_performance_monthly() {
00302     calc_prestige();
00303     <span class="comment">//sys.yield();</span>
00304     <a class="code" href="classPlayerSchool.html#a48">calc_staff_morale</a>();
00305     <a class="code" href="classPlayerSchool.html#a49">calc_media_attitudes</a>();
00306     calc_administrative_performance_etc();
00307     <span class="comment">//sys.yield();</span>
00308     calc_student_performance();
00309     <span class="comment">//sys.yield();</span>
00310 
00311     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="Opschool_8h.html#a65a52">SCORE_VAR_COUNT</a>; i++)
00312         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(<a class="code" href="classPlayerSchool.html#m84">sub_score</a>[i], HISTORY_MONTH_COUNT);
00313     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(<a class="code" href="classPlayerSchool.html#m87">game_score_history</a>,HISTORY_MONTH_COUNT);
00314     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(<a class="code" href="classPlayerSchool.html#m88">ultimate_game_score_history</a>,HISTORY_MONTH_COUNT);
00315 
00316     <a class="code" href="classPlayerSchool.html#a47">calc_ultimate_score</a>();
00317 }
00318 
00319 <span class="comment">//---------- Begin of function PlayerSchool::calc_performance_monthly -----------//</span>
00320 
00321 <span class="comment">//---------- Begin of function PlayerSchool::calc_prestige -----------//</span>
00322 <span class="keywordtype">void</span> PlayerSchool::calc_prestige() {
00323     <span class="keyword">const</span> <span class="keywordtype">char</span> P_VAR_COUNT=4;
00324     <span class="keywordtype">int</span> i;
00325     <span class="keywordtype">float</span> diff;
00326     <span class="keywordtype">float</span> input[P_VAR_COUNT];
00327 
00328     <span class="comment">//## chea 201099</span>
00329     diff = 0.0f;
00330     <span class="keywordflow">if</span>(info.prerun_year == 1 &amp;&amp; info.game_day ==1 &amp;&amp; info.game_month==9) {
00331         <span class="keywordflow">if</span>(player_school.prestige == 1)
00332             school_res.player_peer_school-&gt;prestige = (float)(20 + m.random(4));
00333         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(player_school.prestige == 3)
00334             school_res.player_peer_school-&gt;prestige = (float)(30 + m.random(4));
00335         <span class="keywordflow">else</span>
00336             school_res.player_peer_school-&gt;prestige = (float)(40 + m.random(4));
00337 
00338         <a class="code" href="classPlayerSchool.html#m116">old_pre</a> = 0.0f;
00339     }
00340 
00341     memset(input, 0, <span class="keyword">sizeof</span>(input));
00342 
00343     <span class="comment">//--------------//</span>
00344     <span class="keywordtype">int</span> totalFacCount = 0;
00345     <a class="code" href="classDepartment.html">Department</a>* deptPtr;
00346 
00347     <span class="keywordflow">for</span> ( i=department_array.size(); i&gt;0; i-- ) {
00348         <span class="keywordflow">if</span> ( department_array.is_deleted(i) )
00349             <span class="keywordflow">continue</span>;
00350 
00351         deptPtr = department_array[i];
00352 
00353         <span class="keywordtype">int</span> facCount = deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#m1">faculty_count</a>;
00354 
00355         input[0] += deptPtr-&gt;<a class="code" href="classDepartment.html#m39">p_academic_standing</a> * facCount;
00356 
00357         totalFacCount += facCount;
00358     }
00359 
00360     <a class="code" href="ALL_8H.html#a0">err_when</a>(totalFacCount == 0);
00361     input[0] /= totalFacCount;
00362 
00363     <span class="comment">//--------------//</span>
00364     input[1] = enroll_res.cur_yield_rate[<a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>] * 100;
00365 
00366     <span class="comment">//--------------//</span>
00367     input[2] = math.safe_divide(1.0f, enroll_res.offers_rate[0]);
00368 
00369     <span class="comment">//--------------//</span>
00370     input[3] = athletics_office.avg_percent_win;
00371 
00372     <span class="comment">//--------------//</span>
00373     input[1] = math.single_response_func(0.0f, 100.0f, 40.0f, 40.0f, input[1]);
00374     input[2] = math.single_response_func(0.0f, 100.0f, 4.0f, 3.0f, input[2]);
00375     input[3] = math.dual_response_func(0.0f, 49.9f,100.0f, 0.225f, 0.178f, 0.301f, 0.685f, input[3]);
00376 
00377     <span class="comment">//--------------//</span>
00378 
00379     <span class="keywordtype">float</span> curPrestige = school_res.player_peer_school-&gt;prestige;
00380     <span class="keywordtype">float</span> weight[P_VAR_COUNT] = { 0.5f, 0.2f, 0.2f, 0.1f };
00381     <span class="keywordtype">float</span> newValue = 0;
00382 
00383     <span class="keywordflow">for</span>(i=0; i&lt;P_VAR_COUNT; i++)
00384         newValue += weight[i] * input[i];
00385 
00386     <span class="comment">//## chea 300899 change latency_func(HE.RespF_Defs.Rev 230899 E-mail)</span>
00387     curPrestige = player_school.latency_func( 0.91f, curPrestige, newValue);
00388 
00389     <span class="keywordflow">if</span>(info.prerun_year == 1 &amp;&amp; info.game_day ==1 &amp;&amp; info.game_month==9)
00390         diff = 0.0f ;
00391     <span class="keywordflow">else</span>
00392         diff = curPrestige - <a class="code" href="classPlayerSchool.html#m116">old_pre</a>;
00393 
00394     <a class="code" href="classPlayerSchool.html#m116">old_pre</a> = curPrestige;
00395     <a class="code" href="ALL_8H.html#a0">err_when</a>(<a class="code" href="classPlayerSchool.html#m116">old_pre</a> &lt;= 0);                         <span class="comment">//prestige can't be 0</span>
00396     school_res.player_peer_school-&gt;prestige += diff;
00397 
00398     <span class="keywordflow">if</span>(school_res.player_peer_school-&gt;prestige &lt;= 0)
00399         school_res.player_peer_school-&gt;prestige = 0.0f;
00400     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(school_res.player_peer_school-&gt;prestige &gt;= 100)
00401         school_res.player_peer_school-&gt;prestige = 100.0f;
00402 
00403 }
00404 
00405 <span class="comment">//---------- End of function PlayerSchool::calc_prestige -----------//</span>
00406 
00407 <span class="comment">//---------- Begin of function PlayerSchool::calc_staff_morale -----------//</span>
<a name="l00408"></a><a class="code" href="classPlayerSchool.html#a48">00408</a> <span class="keywordtype">void</span> <a class="code" href="classPlayerSchool.html#a48">PlayerSchool::calc_staff_morale</a>() {
00409     <span class="keyword">const</span> <span class="keywordtype">char</span> M_VAR_COUNT=4;
00410     <span class="keywordtype">int</span> i;
00411     <span class="keywordtype">float</span> input[M_VAR_COUNT];
00412     memset(input, 0, <span class="keyword">sizeof</span>(input));
00413 
00414     <span class="comment">//--------------//</span>
00415     input[0] = (float) finance.expense_policy_array[<a class="code" href="Ofinance_8h.html#a110a71">PL_STAFF_SALARY_INCREASES</a>].result_value;
00416 
00417     <span class="comment">//--------------//</span>
00418     input[1] = (float) finance.revenue_policy_array[<a class="code" href="Ofinance_8h.html#a108a68">PL_INDIRECT_COST_RATE</a>].result_value;
00419 
00420     <span class="comment">//--------------//</span>
00421     input[2] = (float) finance.expense_policy_array[<a class="code" href="Ofinance_8h.html#a110a72">PL_BUDGET_ADJUSTMENT</a>].result_value;
00422 
00423     <span class="comment">//--------------//</span>
00424     input[3] = <a class="code" href="classPlayerSchool.html#m82">administrative_performance</a>;
00425 
00426     <span class="comment">//--------------//</span>
00427     input[0] = math.dual_response_func(0,60.00f,100,0.711f,0.722f,0.355f,2.500f, input[0]);
00428     input[1] = math.dual_response_func(0, 60.00f, 100, 2.362f, 2.0f, -3.819f, 4.0f, input[1]);
00429     input[2] = math.dual_response_func(0, 60.00f, 100, 1.450f, 3.010f, -0.866f, 1.495f, input[2]);
00430 
00431 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00432 <span class="preprocessor"></span>    <span class="comment">// delete references to input[1]</span>
00433     <span class="keywordtype">float</span> weight[M_VAR_COUNT] = {0.50f, 0.00f, 0.3f, 0.2f};
00434 <span class="preprocessor">#else</span>
00435 <span class="preprocessor"></span>    <span class="keywordtype">float</span> weight[M_VAR_COUNT] = {0.50f, 0.20f, 0.1f, 0.2f};
00436 <span class="preprocessor">#endif</span>
00437 <span class="preprocessor"></span>
00438     <span class="keywordtype">float</span> newValue = 0;
00439     <span class="keywordflow">for</span>(i=0; i&lt;M_VAR_COUNT; i++)
00440         newValue += weight[i] * input[i];
00441 
00442     <span class="comment">//-------- pass throught the latency function ---------//</span>
00443 
00444     <span class="comment">//## chea 300899 change latency_func(HE.RespF_Defs.Rev 230899 E-mail)</span>
00445     <a class="code" href="classPlayerSchool.html#m80">staff_morale</a> = (char) player_school.latency_func( 0.88f, <a class="code" href="classPlayerSchool.html#m80">staff_morale</a>, newValue);
00446 
00447     <span class="comment">//---------- apply extra effect brought the chance cards ------------//</span>
00448 
00449     <span class="keywordtype">double</span> finalValue = <a class="code" href="classPlayerSchool.html#m80">staff_morale</a>;
00450 
00451     <span class="keywordflow">if</span>( chance_event.extra_effect_staff_morale ) {
00452         finalValue *= chance_event.extra_effect_staff_morale;
00453 
00454         chance_event.extra_effect_staff_morale += (1.0f - chance_event.extra_effect_staff_morale) * 0.3f;
00455     }
00456 
00457     <span class="comment">//------- apply penalty due to change of promised policies ------//</span>
00458 
00459     finalValue *= finance.expense_policy_array[<a class="code" href="Ofinance_8h.html#a110a71">PL_STAFF_SALARY_INCREASES</a>].penalty_multiplier1;
00460     finalValue *= finance.expense_policy_array[<a class="code" href="Ofinance_8h.html#a110a72">PL_BUDGET_ADJUSTMENT</a>].penalty_multiplier2;
00461     finalValue *= finance.cost_rise_policy_array[<a class="code" href="Ofinance_8h.html#a112a83">PL_ADMINISTRATION</a>].penalty_multiplier1;
00462 
00463     <a class="code" href="classPlayerSchool.html#m80">staff_morale</a> = (char) max(0, min(100, finalValue) );
00464 }
00465 
00466 <span class="comment">//---------- End of function PlayerSchool::calc_staff_morale -----------//</span>
00467 
00468 <span class="comment">//---------- Begin of function PlayerSchool::calc_media_attitudes -----------//</span>
00469 
<a name="l00470"></a><a class="code" href="classPlayerSchool.html#a49">00470</a> <span class="keywordtype">void</span> <a class="code" href="classPlayerSchool.html#a49">PlayerSchool::calc_media_attitudes</a>() {
00471     <span class="keyword">const</span> <span class="keywordtype">char</span> M_VAR_COUNT=3;
00472     <span class="keywordtype">int</span> i;
00473     <span class="keywordtype">float</span> input[M_VAR_COUNT];
00474     memset(input, 0, <span class="keyword">sizeof</span>(input));
00475 
00476     <span class="comment">//--------------//</span>
00477     input[0] = float( school_res.player_peer_school-&gt;prestige );
00478 
00479     <span class="comment">//--------------//</span>
00480     input[1] = float(finance.this_year.surplus_deficit) / float(finance.total_operating_expense.total);
00481     <a class="code" href="ALL_8H.html#a0">err_when</a>(finance.total_operating_expense.total&lt;= 0);
00482 
00483     <span class="comment">//--------------//</span>
00484     input[2] = athletics_office.avg_percent_win;    <span class="comment">//BUGHERE should *100</span>
00485 
00486     <span class="comment">//--------------//</span>
00487     input[1] = math.dual_response_func(0,60,100,0.486f,0.782f,-0.931f,1.000f, input[1]);
00488     input[2] = math.dual_response_func(0,40,100,19.97f,30.00f,20.00f,75.00f, input[2]);
00489 
00490     <span class="keywordtype">float</span> weight[M_VAR_COUNT] = { 0.60f, 0.20f, 0.20f, };
00491 
00492     <span class="keywordtype">float</span> newValue = 0;
00493     <span class="keywordflow">for</span>(i=0; i&lt;M_VAR_COUNT; i++)
00494         newValue += weight[i] * input[i];
00495 
00496     <span class="comment">//-------- pass throught the latency function ---------//</span>
00497 
00498     <span class="comment">//## chea 091199 handling chance card value</span>
00499     <a class="code" href="classPlayerSchool.html#m81">media_attitudes</a> = (char)player_school.latency_func( 0.5f, <a class="code" href="classPlayerSchool.html#m81">media_attitudes</a>, newValue);
00500 
00501     <span class="comment">//---------- extra effect brought the chance cards ------------//</span>
00502 
00503     <span class="keywordflow">if</span>( chance_event.extra_effect_media_att ) {
00504         <a class="code" href="classPlayerSchool.html#m81">media_attitudes</a> = char( (<span class="keywordtype">float</span>)<a class="code" href="classPlayerSchool.html#m81">media_attitudes</a> * chance_event.extra_effect_media_att );
00505 
00506         chance_event.extra_effect_media_att += (1.0f - chance_event.extra_effect_media_att) * 0.3f;
00507 
00508         <a class="code" href="classPlayerSchool.html#m81">media_attitudes</a> = max(0, min(100,<a class="code" href="classPlayerSchool.html#m81">media_attitudes</a>) );
00509     }
00510 }
00511 
00512 <span class="comment">//---------- End of function PlayerSchool::calc_media_attitudes -----------//</span>
00513 
00514 <span class="comment">//---------- Begin of function PlayerSchool::calc_administrative_performance_etc -----------//</span>
00515 <span class="keywordtype">void</span> PlayerSchool::calc_administrative_performance_etc() {
00516     <span class="keyword">const</span> <span class="keywordtype">char</span> M_VAR_COUNT=3;
00517     <span class="keywordtype">int</span> i;
00518     <span class="keywordtype">float</span> input[M_VAR_COUNT];
00519     memset(input, 0, <span class="keyword">sizeof</span>(input));
00520 
00521     <span class="comment">//--------------//</span>
00522     input[0] = (float) <a class="code" href="classPlayerSchool.html#m80">staff_morale</a>;
00523 
00524     <span class="comment">//--------------//</span>
00525     <span class="comment">//  input[1] = (float) finance.revenue_policy_array[PL_INDIRECT_COST_RATE].result_value;</span>
00526     <span class="comment">// chwg ##290699</span>
00527     <span class="keywordflow">if</span>(info.game_year==1)
00528         <span class="keywordflow">if</span>(info.game_month==9)
00529             <a class="code" href="classPlayerSchool.html#m30">initializationValueAC_ADMINISTRATION_N_OTHER_OPERATING_EXPENSE</a>=(float)finance.expense_array[<a class="code" href="Ofinance_8h.html#a104a52">AC_ADMINISTRATION_N_OTHER_OPERATING_EXPENSE</a>].total;
00530     input[1] = float(finance.expense_array[<a class="code" href="Ofinance_8h.html#a104a52">AC_ADMINISTRATION_N_OTHER_OPERATING_EXPENSE</a>].total)/
00531         (<a class="code" href="classPlayerSchool.html#m30">initializationValueAC_ADMINISTRATION_N_OTHER_OPERATING_EXPENSE</a>*(1+math.get_random_snd(0.0f, <a class="code" href="Opschool_8h.html#a1">PSCH_SD</a>(0.05f))));
00532 
00533     <span class="comment">//--------------//</span>
00534     <span class="comment">//  input[2] = float(finance.projected_expense_array[AC_ADMINISTRATION_N_OTHER_OPERATING_EXPENSE].this_year.total) / float(finance.projected_total_operating_expense.this_year.total);</span>
00535     <span class="comment">// chwg ##290699</span>
00536     input[2] = (float) finance.revenue_policy_array[<a class="code" href="Ofinance_8h.html#a108a68">PL_INDIRECT_COST_RATE</a>].result_value;
00537 
00538     <a class="code" href="ALL_8H.html#a0">err_when</a>(finance.budget_total_operating_expense.total &lt;= 0);
00539 
00540     <span class="comment">//--------------//</span>
00541     <span class="comment">//  input[1] = math.dual_response_func(0,60.00f,100,8.09f,23.52f,15.88f,29.96f, input[1]);</span>
00542     <span class="comment">// chwg290699</span>
00543     input[1] = math.dual_response_func(0,50.00f,100,1.68f,0.28f,0.45f,1.60f, input[1]);
00544     input[2] = math.dual_response_func(0, 60.10f, 100, 3.546f, 2.996f, -3.226f, 3.503f, input[2]);
00545 
00546 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00547 <span class="preprocessor"></span>    <span class="comment">// delete references to input[2]</span>
00548     <span class="keywordtype">float</span> weight[M_VAR_COUNT] = {0.5f, 0.5f, 0.0f};
00549 <span class="preprocessor">#else</span>
00550 <span class="preprocessor"></span>    <span class="keywordtype">float</span> weight[M_VAR_COUNT] = {0.4f, 0.2f, 0.4f};
00551 <span class="preprocessor">#endif</span>
00552 <span class="preprocessor"></span>
00553     <span class="keywordtype">float</span> newValue = 0;
00554     <span class="keywordflow">for</span>(i=0; i&lt;M_VAR_COUNT; i++)
00555         newValue += weight[i] * input[i];
00556 
00557     <span class="comment">//  administrative_performance = (char) math.latency_func( 0.95f, administrative_performance, newValue);</span>
00558     <span class="comment">//## chea 300899 change latency_func(HE.RespF_Defs.Rev 230899 E-mail)</span>
00559     <a class="code" href="classPlayerSchool.html#m82">administrative_performance</a> = (char) player_school.latency_func( 0.90f, <a class="code" href="classPlayerSchool.html#m82">administrative_performance</a>, newValue);
00560 
00561     <span class="comment">// req26b.txt:      //Single-Logistic; floor = 0.75; ceiling = 1; b = .998; b = 1.514</span>
00562     <a class="code" href="classPlayerSchool.html#m82">administrative_performance</a> = (char) math.single_response_func(0.75f, 1, .998f, 1.514f, <a class="code" href="classPlayerSchool.html#m82">administrative_performance</a>); {
00563 
00564         <span class="comment">//--------------//</span>
00565         <span class="comment">//scholarship_broadly_defined</span>
00566         <span class="comment">//--------------//</span>
00567 
00568         <span class="keyword">const</span> <span class="keywordtype">char</span> SB_VAR_COUNT=5;
00569         <span class="keywordtype">float</span> input[SB_VAR_COUNT];
00570         memset(input, 0, <span class="keyword">sizeof</span>(input));
00571 
00572         <span class="comment">//--------------//</span>
00573         <span class="comment">// Average regular faculty scholarship performance</span>
00574         <span class="comment">// Average regular faculty research performance</span>
00575         <span class="comment">// Average faculty educational development time (all faculty)</span>
00576         <span class="comment">// Average faculty public service time (all faculty)</span>
00577         <span class="comment">// Technology utilization in teaching</span>
00578 
00579         input[0] = department_array.performance_scholarship[THIS_TRIMESTER];
00580         input[1] = department_array.performance_research[THIS_TRIMESTER];
00581 
00582         input[2] = (float) department_array.discretionary_hour_array[<a class="code" href="Ofaculty_8h.html#a29a17">DT_EDUCATIONAL_DEVELOPMENT</a>][THIS_TRIMESTER];
00583         input[3] = (float) department_array.discretionary_hour_array[<a class="code" href="Ofaculty_8h.html#a29a20">DT_INSTITUTIONAL_AND_PUBLIC_SERVICE</a>][THIS_TRIMESTER];
00584 
00585         <span class="comment">//--------------//</span>
00586         <a class="code" href="classDepartment.html">Department</a>* deptPtr;
00587         <span class="keywordtype">int</span> totalFacCount = 0;
00588 
00589         <span class="keywordflow">for</span> ( i=department_array.size(); i&gt;0; i-- ) {
00590             <span class="keywordflow">if</span> ( department_array.is_deleted(i) )
00591                 <span class="keywordflow">continue</span>;
00592 
00593             deptPtr = department_array[i];
00594 
00595             <span class="keywordtype">int</span> facCount = deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#m1">faculty_count</a>;
00596 
00597             input[4] += deptPtr-&gt;<a class="code" href="classDepartment.html#m41">p_tech_utilization</a> * facCount;
00598 
00599             totalFacCount += facCount;
00600         }
00601 
00602         <a class="code" href="ALL_8H.html#a0">err_when</a>(!totalFacCount);
00603         input[4] /= totalFacCount;
00604 
00605         <span class="comment">//--------------//</span>
00606         input[0] = math.dual_response_func(1,50,100,28.35f,29.00f,22.31f,77.45f, input[0]);
00607         input[1] = math.dual_response_func(1,100,90,28.91f,20.78f,21.85f,80.03f, input[1]);
00608         input[2] = math.single_response_func(1,100,6.32f,7.58f, input[2]);
00609         input[3] = math.single_response_func(1,100,6.32f,7.58f, input[3]);
00610         input[4] = math.single_response_func(1,100,48.82f,40.98f, input[4]);
00611 
00612         <span class="keywordtype">float</span> weight[SB_VAR_COUNT] = {0.15f, 0.05f, 0.10f, 0.10f, 0.15f};
00613 
00614         <span class="keywordtype">float</span> newValue = 0;
00615         <span class="keywordflow">for</span>(i=0; i&lt;SB_VAR_COUNT; i++)
00616             newValue += weight[i] * input[i];
00617 
00618         <span class="comment">//      scholarship_broadly_defined = (char) math.latency_func( 0.93f, scholarship_broadly_defined, newValue);</span>
00619         <span class="comment">//## chea 300899 change latency_func(HE.RespF_Defs.Rev 230899 E-mail)</span>
00620         <a class="code" href="classPlayerSchool.html#m83">scholarship_broadly_defined</a> = (char) player_school.latency_func( 0.80f, <a class="code" href="classPlayerSchool.html#m83">scholarship_broadly_defined</a>, newValue);
00621 
00622     }
00623 }
00624 
00625 <span class="comment">//---------- End of function PlayerSchool::calc_administrative_performance_etc -----------//</span>
00626 
00627 <span class="comment">//---------- Begin of function PlayerSchool::calc_ultimate_score -----------//</span>
<a name="l00631"></a><a class="code" href="classPlayerSchool.html#a47">00631</a> <span class="comment">void PlayerSchool::calc_ultimate_score() {</span>
00632     <span class="keywordtype">int</span> i, j;
00633 
00634     <span class="comment">//------ Step 1: calculate the inputs -------//</span>
00635 
00636     <a class="code" href="classDepartment.html">Department</a> *deptPtr;
00637     <span class="keywordtype">float</span> subScore[<a class="code" href="Opschool_8h.html#a65a52">SCORE_VAR_COUNT</a>];
00638 
00639     memset(subScore, 0, <span class="keyword">sizeof</span>(subScore));
00640 
00641     <span class="comment">//----------- Calculate S_DEGREES_GRANTED ----------//</span>
00642     <span class="comment">//</span>
00643     <span class="comment">// Degrees granted: Min[100, 10*Max[0, X-15]]</span>
00644     <span class="comment">// where X = 100*(SL-1_degrees/SL-1_enrollments)</span>
00645     <span class="comment">// i.e. traditional undergraduates only. (X ranges from 15 [score=0] to 25 [score=100].)</span>
00646     <span class="comment">//</span>
00647     <span class="comment">//-----------------------------------------------------//</span>
00648 
00649     <span class="keywordtype">float</span> x = 100.0f * (float) bachelor_degree[THIS_YEAR] / (float) enroll_res.student_count[<a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>];
00650 
00651 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00652 <span class="preprocessor"></span>    <span class="comment">// Item 15i) -- Change formula for Score of Degree Granted in order to prevent zero value</span>
00653     subScore[<a class="code" href="Opschool_8h.html#a65a37">S_DEGREES_GRANTED</a>] = min(100, min(x,15)+8.5*max(0,x-15));
00654 <span class="preprocessor">#else</span>
00655 <span class="preprocessor"></span>    subScore[<a class="code" href="Opschool_8h.html#a65a37">S_DEGREES_GRANTED</a>] = min(100, 10 * max(0, x-15) );
00656 <span class="preprocessor">#endif</span>
00657 <span class="preprocessor"></span>
00658     <span class="comment">//---------- Calculate S_SPONSORED_RESEARCH_ACTIVITY --------------//</span>
00659     <span class="comment">//</span>
00660     <span class="comment">// use research performance from the performance screen.</span>
00661     <span class="comment">//</span>
00662     <span class="comment">//--------------------------------------------------------//</span>
00663 
00664     subScore[<a class="code" href="Opschool_8h.html#a65a38">S_SPONSORED_RESEARCH_ACTIVITY</a>] = department_array.p_faculty_research_history[THIS_MONTH];
00665 
00666     <span class="comment">//---------- Calculate S_PRESTIGE ----------------//</span>
00667 
00668     subScore[<a class="code" href="Opschool_8h.html#a65a39">S_PRESTIGE</a>] = school_res.player_peer_school-&gt;prestige;
00669 
00670     <span class="comment">//----------- Calculate S_EDUCATIONAL_QUALITY -----------//</span>
00671     <span class="comment">//</span>
00672     <span class="comment">// Educational quality: institution-level educational quality</span>
00673     <span class="comment">//  from the performance screen (already 0-100).</span>
00674     <span class="comment">//</span>
00675     <span class="comment">//--------------------------------------------------------//</span>
00676 
00677     subScore[<a class="code" href="Opschool_8h.html#a65a40">S_EDUCATIONAL_QUALITY</a>] = department_array.p_educational_quality_history[THIS_TRIMESTER];
00678 
00679     <span class="comment">//--------- Calculate S_SCHOLARSHIP_BROADLY_DEFINED ----------//</span>
00680     <span class="comment">//</span>
00681     <span class="comment">//  weighted average of the department-level scholarship performance figures</span>
00682     <span class="comment">// from the performance:detail screens (already 0-100), with the number of</span>
00683     <span class="comment">// regular faculty (i.e., excluding the two adjunct categories) as weights..</span>
00684     <span class="comment">//</span>
00685     <span class="comment">//-------------------------------------------------------------//</span>
00686 
00687     <span class="keywordtype">float</span> totalScholarship=0;
00688     <span class="keywordtype">int</span> totalFaculty = 0;
00689 
00690     <span class="keywordflow">for</span> ( i=department_array.size(); i&gt;0; i-- ) {
00691         <span class="keywordflow">if</span> ( department_array.is_deleted(i) )
00692             <span class="keywordflow">continue</span>;
00693 
00694         deptPtr = department_array[i];
00695 
00696         <span class="keywordflow">for</span>( j=deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classDynArray.html#a28">size</a>() ; j&gt;0 ; j-- ) {
00697             <span class="keywordflow">if</span>( deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#a10">is_deleted</a>(j) )
00698                 <span class="keywordflow">continue</span>;
00699 
00700             totalScholarship += deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>[j]-&gt;<a class="code" href="classFacultyArray.html#m6">performance_scholarship</a>;
00701             totalFaculty++;
00702         }
00703     }
00704 
00705     <a class="code" href="ALL_8H.html#a0">err_when</a> (!totalFaculty);
00706 
00707     subScore[<a class="code" href="Opschool_8h.html#a65a41">S_SCHOLARSHIP_BROADLY_DEFINED</a>] = totalScholarship / totalFaculty;
00708 
00709     sys.yield();
00710 
00711     <span class="comment">//----------- S_FACULTY_MORALE -----------//</span>
00712     <span class="comment">//</span>
00713     <span class="comment">// institution-level faculty morale from the performance screen (already 0-100).</span>
00714     <span class="comment">// Average performance ratings over faculty sims.</span>
00715     <span class="comment">//</span>
00716     <span class="comment">//----------------------------------------//</span>
00717 
00718     subScore[<a class="code" href="Opschool_8h.html#a65a45">S_FACULTY_MORALE</a>] = department_array.p_faculty_morale_history[THIS_MONTH];
00719 
00720     <span class="comment">//-------------------------------------------//</span>
00721 
00722     subScore[<a class="code" href="Opschool_8h.html#a65a46">S_STUDENT_MORALE</a>] = department_array.p_student_morale_history[THIS_TRIMESTER];
00723 
00724     <span class="comment">//------------S_STAFF_MORALE -------------//</span>
00725 
00726     subScore[<a class="code" href="Opschool_8h.html#a65a47">S_STAFF_MORALE</a>] = staff_morale;
00727 
00728 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00729 <span class="preprocessor"></span>    <span class="comment">//---------- S_STUDENT_DIVERSITY -------------//</span>
00730 
00731     <span class="comment">// Formula used by the U.S. Census Bureau</span>
00732     <span class="comment">// diversity = 1 - {(%NonMinMale/100)^2 + (%NonMinFemale/100)^2 + (%MinMale/100)^2 + (%MinFemale/100)^2}</span>
00733 
00734     <span class="comment">//  int nonMinFemale = enroll_res.overall_percent_female - enroll_res.overall_percent_minority_female;</span>
00735     <span class="comment">//  int minMale = enroll_res.overall_percent_minority - enroll_res.overall_percent_minority_female;</span>
00736     <span class="comment">//  int minFemale = enroll_res.overall_percent_minority_female;</span>
00737     <span class="comment">//  int nonMinMale = 100 - nonMinFemale - minMale - minFemale;</span>
00738     <span class="comment">//  subScore[S_STUDENT_DIVERSITY] = 100.0f * (1.0f -</span>
00739     <span class="comment">//          float(nonMinMale*nonMinMale + nonMinFemale*nonMinFemale + minMale*minMale + minFemale*minFemale)</span>
00740     <span class="comment">//          / float(100*100));</span>
00741 
00742     <span class="comment">// use count instead of interger percentage for accuracy</span>
00743     {
00744         <span class="keywordtype">int</span> gender, totalCount;
00745         subScore[<a class="code" href="Opschool_8h.html#a65a42">S_STUDENT_DIVERSITY</a>] = 0.0f;
00746 
00747         <span class="keywordflow">for</span>( gender = 0, totalCount = 0; gender &lt; <a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a>; ++gender ) {
00748             totalCount += enroll_res.overall_gender_ethnic_group_student_count[gender];
00749             subScore[<a class="code" href="Opschool_8h.html#a65a42">S_STUDENT_DIVERSITY</a>] += (float)enroll_res.overall_gender_ethnic_group_student_count[gender]
00750                 * (float)enroll_res.overall_gender_ethnic_group_student_count[gender];
00751         }
00752 
00753         <span class="keywordflow">if</span>( totalCount &gt; 0) {
00754             subScore[<a class="code" href="Opschool_8h.html#a65a42">S_STUDENT_DIVERSITY</a>] = 100.0f * (1.0f - subScore[<a class="code" href="Opschool_8h.html#a65a42">S_STUDENT_DIVERSITY</a>]/(float)totalCount/(float)totalCount);
00755         }
00756     }
00757 <span class="preprocessor">#else</span>
00758 <span class="preprocessor"></span>    <span class="comment">//---------- S_STUDENT_DIVERSITY -------------//</span>
00759     <span class="comment">//</span>
00760     <span class="comment">// Student diversity: Min[100, 1.75*Max[0, X -10]^1.2] where</span>
00761     <span class="comment">// X= (% male minority) + (% female minority) from the</span>
00762     <span class="comment">// institution-level student profile 2 screen . (X ranges from 10 [score=0] to 40 [score=100].)</span>
00763     <span class="comment">//</span>
00764     <span class="comment">//---------------------------------------------//</span>
00765 
00766     x = (float) enroll_res.overall_percent_minority;
00767 
00768     subScore[<a class="code" href="Opschool_8h.html#a65a42">S_STUDENT_DIVERSITY</a>] = min(100.0f, 1.75f * math.safe_pow(x, 1.2f) );
00769 <span class="preprocessor">#endif</span>
00770 <span class="preprocessor"></span>
00771     <span class="comment">//------------ S_FACULTY_DIVERSITY ----------//</span>
00772 
00773     totalFaculty = 0;
00774     <span class="keywordtype">float</span> totalMaleMinority=0;
00775     <span class="keywordtype">float</span> totalFemaleMinority=0;
00776     <span class="keywordtype">float</span> totalFemaleMajority=0;
00777 
00778     <span class="keywordflow">for</span> ( i=department_array.size(); i&gt;0; i-- ) {
00779         <span class="keywordflow">if</span> ( department_array.is_deleted(i) )
00780             <span class="keywordflow">continue</span>;
00781 
00782         deptPtr = department_array[i];
00783 
00784         <span class="keywordflow">for</span>( j=deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classDynArray.html#a28">size</a>() ; j&gt;0 ; j-- ) {
00785             <span class="keywordflow">if</span>( deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>.<a class="code" href="classFacultyArray.html#a10">is_deleted</a>(j) )
00786                 <span class="keywordflow">continue</span>;
00787 
00788             <span class="keywordflow">switch</span>( deptPtr-&gt;<a class="code" href="classDepartment.html#m0">faculty_array</a>[j]-&gt;gender_ethnic_group ) {
00789             <span class="keywordflow">case</span> <a class="code" href="Gamedef_8h.html#a75a29">MINORITY_MALE</a>:
00790                 totalMaleMinority++;
00791                 <span class="keywordflow">break</span>;
00792 
00793             <span class="keywordflow">case</span> <a class="code" href="Gamedef_8h.html#a75a30">MINORITY_FEMALE</a>:
00794                 totalFemaleMinority++;
00795                 <span class="keywordflow">break</span>;
00796 
00797             <span class="keywordflow">case</span> <a class="code" href="Gamedef_8h.html#a75a28">NONMINORITY_FEMALE</a>:
00798                 totalFemaleMajority++;
00799                 <span class="keywordflow">break</span>;
00800             }
00801 
00802             totalFaculty++;
00803         }
00804     }
00805 
00806     <a class="code" href="ALL_8H.html#a0">err_when</a> (!totalFaculty);
00807 
00808     <span class="comment">//--- convert to percentage ---//</span>
00809 
00810     totalMaleMinority = 100.0f * (float) totalMaleMinority / (float) totalFaculty;
00811     totalFemaleMinority = 100.0f * (float) totalFemaleMinority / (float) totalFaculty;
00812     totalFemaleMajority = 100.0f * (float) totalFemaleMajority / (float) totalFaculty;
00813 
00814 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00815 <span class="preprocessor"></span>
00816     <span class="comment">// Formula used by the U.S. Census Bureau</span>
00817     <span class="comment">// diversity = 1 - {(%NonMinMale/100)^2 + (%NonMinFemale/100)^2 + (%MinMale/100)^2 + (%MinFemale/100)^2}</span>
00818 
00819     <span class="keywordtype">float</span> totalMaleMajority = 100.0f - totalMaleMinority - totalFemaleMinority - totalFemaleMajority;
00820 
00821     subScore[<a class="code" href="Opschool_8h.html#a65a43">S_FACULTY_DIVERSITY</a>] = 100.0f * (1.0f -
00822                                               float(totalMaleMajority*totalMaleMajority + totalFemaleMajority*totalFemaleMajority + totalMaleMinority*totalMaleMinority + totalFemaleMinority*totalFemaleMinority)
00823                                               / float(100*100));
00824 <span class="preprocessor">#else</span>
00825 <span class="preprocessor"></span>
00826     x = 0.7f * ( totalMaleMinority + totalFemaleMinority ) +
00827         0.3f * ( totalFemaleMajority + totalFemaleMinority);
00828 
00829     subScore[<a class="code" href="Opschool_8h.html#a65a43">S_FACULTY_DIVERSITY</a>] = min( 100.0f, 2.5f * math.safe_pow( max(0, x-10.0f), 1.1f ) );
00830 <span class="preprocessor">#endif</span>
00831 <span class="preprocessor"></span>
00832     sys.yield();
00833 
00834     <span class="comment">//-----------S_PERCENT_ALUMNI_GIVEN ----------//</span>
00835 
00836     x = development_office.percent_alumni_gave_gift;
00837     subScore[<a class="code" href="Opschool_8h.html#a65a44">S_PERCENT_ALUMNI_GIVEN</a>] = min(0.62f * math.safe_pow(x,1.3f), 100.0f);
00838 
00839     <span class="comment">//--------- S_CURRENT_SURPLUS_DEFICIT_PERCENT ------------------//</span>
00840     <span class="comment">//</span>
00841     <span class="comment">// Current surplus-deficit: 50 + Sign[X]*Min[50, 10*Abs[ X]^1.5] where</span>
00842     <span class="comment">//  X = 100*(Current-year surplus or deficit)/(Current-year total expenditures).</span>
00843     <span class="comment">//  (X ranges from -3 [score=0] to +3 [score=100].)</span>
00844     <span class="comment">//</span>
00845     <span class="comment">//---------------------------------------------------------------//</span>
00846 
00847     x = 100.0f * (float)finance.this_year.surplus_deficit / (float)finance.projected_total_expense.this_year.total;
00848 
00849     subScore[<a class="code" href="Opschool_8h.html#a65a48">S_CURRENT_SURPLUS_DEFICIT_PERCENT</a>] = 50.0f + ((x&gt;0) ? 1.0f : -1.0f) *
00850         min( 50.0f, 10.0f * math.safe_pow( (<span class="keywordtype">float</span>) <a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(x), 1.5f ) );
00851 
00852     <span class="comment">//--------- S_SMOOTHED_SURPLUS_DEFICIT_PERCENT ------------//</span>
00853     <span class="comment">//</span>
00854     <span class="comment">// Smoothed surplus-deficit: Current surplus-deficit run through a latency</span>
00855     <span class="comment">// function with parameter = 0.5 (initialized at the end of the pre-year).</span>
00856     <span class="comment">//</span>
00857     <span class="comment">//---------------------------------------------------------------//</span>
00858 
00859     <span class="keywordtype">float</span> latency= 0.5f;
00860 
00861     <span class="keywordflow">if</span>( info.prerun_year == 1 )
00862         subScore[<a class="code" href="Opschool_8h.html#a65a49">S_SMOOTHED_SURPLUS_DEFICIT_PERCENT</a>] = subScore[<a class="code" href="Opschool_8h.html#a65a48">S_CURRENT_SURPLUS_DEFICIT_PERCENT</a>];
00863     <span class="keywordflow">else</span>
00864         subScore[<a class="code" href="Opschool_8h.html#a65a49">S_SMOOTHED_SURPLUS_DEFICIT_PERCENT</a>] = math.latency_func(latency, sub_score[<a class="code" href="Opschool_8h.html#a65a49">S_SMOOTHED_SURPLUS_DEFICIT_PERCENT</a>][THIS_MONTH-1], subScore[<a class="code" href="Opschool_8h.html#a65a48">S_CURRENT_SURPLUS_DEFICIT_PERCENT</a>]);
00865     <span class="comment">// don't change math.latency_func to player_school.latency_func</span>
00866 
00867     <span class="comment">//---------  S_DEFERRED_MAINTENANCE_BACKLOG_PERCENT --------//</span>
00868     <span class="comment">//</span>
00869     <span class="comment">// Deferred maintenance backlog: 100 - Min[100, 30.0*X^1.1] where</span>
00870     <span class="comment">// X = 100* (deferred maintenance backlog/replacement value of plant).</span>
00871     <span class="comment">// (X ranges from 0 [score=100] to 3 [score=0].)</span>
00872     <span class="comment">//</span>
00873     <span class="comment">//---------------------------------------------------------------//</span>
00874 
00875 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00876 <span class="preprocessor"></span>    x = 100.0f * math.safe_divide((<span class="keywordtype">float</span>) facility_office.onm_n_backlog_history[<a class="code" href="Gamedef_8h.html#a82a56">SECOND_H_THIS_YEAR</a>],
00877                                   (<span class="keywordtype">float</span>)finance.this_year.asset_array[<a class="code" href="Ofinance_8h.html#a97a23">AC_BUILDINGS</a>]);
00878 <span class="preprocessor">#else</span>
00879 <span class="preprocessor"></span>    x = 100.0f * (float) facility_office.onm_n_backlog_history[<a class="code" href="Gamedef_8h.html#a82a56">SECOND_H_THIS_YEAR</a>]
00880         / (float)finance.this_year.asset_array[<a class="code" href="Ofinance_8h.html#a97a23">AC_BUILDINGS</a>];
00881 <span class="preprocessor">#endif</span>
00882 <span class="preprocessor"></span>
00883     subScore[<a class="code" href="Opschool_8h.html#a65a51">S_DEFERRED_MAINTENANCE_BACKLOG_PERCENT</a>] = 100.0f - min(100.0f, 30.0f * math.safe_pow(x, 1.1f) );
00884 
00885     <span class="comment">//--------- S_ENDOWMENT_PAYOUT_RATE_RELATIVE --------//</span>
00886     <span class="comment">//</span>
00887     <span class="comment">// Endowment payout rate: 100 - Min[100, 25.0*Abs[X -4.5]^1.2] where</span>
00888     <span class="comment">// X = endowment payout rate (in percentage terms).</span>
00889     <span class="comment">// (X ranges from about 4.5 [score=0] to 7.5 or 1.5 [score=100].)</span>
00890     <span class="comment">//</span>
00891     <span class="comment">//---------------------------------------------------------------//</span>
00892 
00893     x = (float)finance.revenue_policy_array[<a class="code" href="Ofinance_8h.html#a108a67">PL_ENDOWMENT_SPENDING_RATE</a>].result_value;
00894 
00895     subScore[<a class="code" href="Opschool_8h.html#a65a50">S_ENDOWMENT_PAYOUT_RATE_RELATIVE</a>] =
00896         100.0f - min( 100.0f, 25.0f * math.safe_pow( (<span class="keywordtype">float</span>) <a class="code" href="OLINALG_8CPP.html#a2">fabs</a>(x-4.5f), 1.2f) );
00897 
00898     <span class="comment">//----- limit all inputs to the range from 0 to 1000 ------//</span>
00899 
00900     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Opschool_8h.html#a65a52">SCORE_VAR_COUNT</a>; i++) {
00901         <span class="keywordflow">if</span>( subScore[i] &lt; 0 )
00902             subScore[i] = 0;
00903 
00904         <span class="keywordflow">if</span>( subScore[i] &gt; 100 )
00905             subScore[i] = 100;
00906     }
00907 
00908     <span class="comment">//--------------------------------------------------------------//</span>
00909     <span class="comment">//   calc cur_game_score by adding up the inputs with weights</span>
00910     <span class="comment">//--------------------------------------------------------------//</span>
00911 
00912     <span class="keywordtype">float</span> rawCurrentGameScore = 0;
00913 
00914     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Opschool_8h.html#a65a52">SCORE_VAR_COUNT</a>; i++)
00915         rawCurrentGameScore += subScore[i] * sub_score_weight[i] / 100;
00916 
00917     cur_game_score = rawCurrentGameScore;
00918 
00919     <span class="comment">//------- calculate the utlimate score ---------//</span>
00920 
00921     ultimate_game_score = int((info.year_passed - 1) + (<span class="keywordtype">int</span>(cur_game_score) - <span class="keywordtype">int</span>(init_game_score)) * 10);
00922 
00923     <span class="comment">// 1013 for new "Objctive"  //## chea 200899</span>
00924     ultimate_game_score += task_array.total_bonus_pt;
00925     ultimate_game_score += bonus_point;             <span class="comment">// scenario bonus</span>
00926 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00927 <span class="preprocessor"></span>    ultimate_game_score += (int)threshold_event_bonus;
00928 <span class="preprocessor">#endif</span>
00929 <span class="preprocessor"></span>
00930     <span class="keywordflow">if</span> ( cur_game_score &lt;= 0 )
00931         cur_game_score = 0;
00932 
00933     sys.yield();
00934 
00935     <span class="comment">// ----- for interface graph plotting -----//</span>
00936 
00937     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Opschool_8h.html#a65a52">SCORE_VAR_COUNT</a>; i++) {
00938         <span class="keywordflow">if</span> ( subScore[i] &lt; 0 )
00939             subScore[i] = 0;
00940     }
00941 
00942     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Opschool_8h.html#a65a52">SCORE_VAR_COUNT</a>; i++) {
00943         sub_score[i][THIS_MONTH] = subScore[i];
00944         sub_score_change[i] = subScore[i] - sub_score_start[i];
00945     }
00946 
00947     <span class="comment">//----- save game score into historical array -----//</span>
00948 
00949     game_score_history[THIS_MONTH] = cur_game_score;
00950 
00951     ultimate_game_score_history[THIS_MONTH] = ultimate_game_score;
00952 
00953     <a class="code" href="classPeerSchool.html">PeerSchool</a> *playerSch = school_res.player_peer_school;
00954     playerSch-&gt;<a class="code" href="classPeerSchool.html#m6">game_score</a> = (float) cur_game_score;
00955 
00956     <span class="comment">//----- calculate input group sub-total --------//</span>
00957 
00958     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Opschool_8h.html#a65a53">SCORE_SUBGROUP_COUNT</a>; i++)
00959         score_sub_total[i][THIS_MONTH] = 0;
00960 
00961     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Opschool_8h.html#a65a52">SCORE_VAR_COUNT</a>; i++) {
00962         <span class="keywordtype">char</span> grp = <a class="code" href="Opsch__pi_8cpp.html#a2">get_group_index</a>(i);
00963 
00964         score_sub_total[grp][THIS_MONTH] += subScore[i] * sub_score_weight[i] / 100;
00965     }
00966 
00967     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="Opschool_8h.html#a65a53">SCORE_SUBGROUP_COUNT</a>; i++)
00968         score_group_change[i] = score_sub_total[i][THIS_MONTH] - score_sub_total[i][THIS_MONTH-1];
00969 
00970     <span class="comment">//------ calc peer school score ------//</span>
00971 
00972     <span class="keywordflow">for</span> (i=0; i&lt;school_res.peer_school_count; i++) {
00973         <span class="comment">// min &amp; max bug chea</span>
00974         school_res.peer_school_array[i].game_score = m.fmax(5.0f, school_res.peer_school_array[i].game_score + math.get_random_snd(0,5));
00975     }
00976 
00977     <span class="comment">// since it is overrided in the loop above</span>
00978     school_res.player_peer_school-&gt;game_score = (float) cur_game_score;
00979 
00980     <span class="comment">//------ sort peer_school_rank[] --------//         // peer_school_rank[] store the index of peer_school_array; index 0 refer to highest score</span>
00981 
00982     <span class="keywordflow">for</span>( i=0; i&lt;school_res.peer_school_count; i++ ) {
00983         school_res.peer_school_rank[i] = i;
00984     }
00985 
00986     qsort( school_res.peer_school_rank, school_res.peer_school_count, <span class="keyword">sizeof</span>(school_res.peer_school_rank[0]), sort_peer_school_score_function );
00987 }
00988 
00989 <span class="comment">//---------- End of function PlayerSchool::calc_ultimate_score -----------//</span>
00990 
00991 <span class="comment">//---------- Begin of function PlayerSchool::init_score -----------//</span>
00992 
<a name="l00993"></a><a class="code" href="classPlayerSchool.html#a44">00993</a> <span class="keywordtype">void</span> <a class="code" href="classPlayerSchool.html#a44">PlayerSchool::init_score</a>() {
00994     <span class="comment">//------- update ultimate score -------//</span>
00995 
00996     <a class="code" href="classPlayerSchool.html#a47">calc_ultimate_score</a>();
00997 
00998     <span class="comment">//------ update sub score -----------//</span>
00999 
01000     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="Opschool_8h.html#a65a52">SCORE_VAR_COUNT</a>; i++) {
01001         <a class="code" href="classPlayerSchool.html#m86">sub_score_start</a>[i] = <a class="code" href="classPlayerSchool.html#m84">sub_score</a>[i][THIS_MONTH];
01002         <a class="code" href="classPlayerSchool.html#m85">sub_score_change</a>[i] = 0;
01003     }
01004 
01005     <span class="comment">//------ calculate game score ------------//</span>
01006 
01007     <span class="comment">// set initial game score</span>
01008     player_school.init_game_score = player_school.cur_game_score;
01009 
01010     player_school.game_score_history[HISTORY_MONTH_COUNT-1]=player_school.cur_game_score;
01011     player_school.game_score_history[HISTORY_MONTH_COUNT-2]=player_school.cur_game_score;
01012 
01013     <span class="keywordflow">if</span> ( player_school.scenario_id &gt; 0 )
01014         player_school.scenario_start_score = (int) player_school.cur_game_score;
01015 
01016     <span class="comment">//------ re-calc it as init_game_score has been updated ----//</span>
01017 
01018     <a class="code" href="classPlayerSchool.html#a47">calc_ultimate_score</a>();
01019 }
01020 
01021 <span class="comment">//---------- End of function PlayerSchool::init_score -----------//</span>
01022 
01023 <span class="comment">//---------- Begin of function PlayerSchool::add_bonus -----------//</span>
01024 
<a name="l01025"></a><a class="code" href="classPlayerSchool.html#a45">01025</a> <span class="keywordtype">void</span> <a class="code" href="classPlayerSchool.html#a45">PlayerSchool::add_bonus</a>(<span class="keywordtype">int</span> value) {
01026     <a class="code" href="classPlayerSchool.html#m96">bonus_point</a> += value;
01027     <a class="code" href="classPlayerSchool.html#a47">calc_ultimate_score</a>();
01028 }
01029 
01030 <span class="comment">//---------- End of function PlayerSchool::add_bonus -----------//</span>
01031 
01032 <span class="comment">//---------- Begin of function PlayerSchool::calc_student_performance -----------//</span>
01034 <span class="comment">void PlayerSchool::calc_student_performance() {</span>
01035     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(talent_academic, HISTORY_MONTH_COUNT);
01036     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(talent_extracurricular, HISTORY_MONTH_COUNT);
01037     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(talent_athletics, HISTORY_MONTH_COUNT);
01038 
01039     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(satisfaction_academic, HISTORY_MONTH_COUNT);
01040     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(satisfaction_student_life, HISTORY_MONTH_COUNT);
01041     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(satisfaction_athletics, HISTORY_MONTH_COUNT);
01042     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(satisfaction_overall, HISTORY_MONTH_COUNT);
01043 
01044     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> d=0; d&lt;<a class="code" href="Ostudent_8h.html#a33a8">DEGREE_TYPE_COUNT</a>; d++)
01045         <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(talent_academic_all[d], HISTORY_MONTH_COUNT);
01046 
01047     <a class="code" href="Gamedef_8h.html#a14">shift_history</a>(performance_academic_ug, HISTORY_MONTH_COUNT);
01048 
01049     <a class="code" href="classStudentArray.html">StudentArray</a> *stuPtr;
01050     <span class="keyword">const</span> <span class="keywordtype">char</span>  AVG_VAR_COUNT = 11;
01051     <span class="keywordtype">float</span> total[AVG_VAR_COUNT];
01052     <span class="keywordtype">int</span> i, totalStuCount = 0, totalUgtStuCount=0;
01053     <span class="keywordtype">int</span> totalDoctorCount=0, totalMasterCount=0;
01054 
01055     memset(total, 0, <span class="keyword">sizeof</span>(total));
01056 
01057     <span class="keywordflow">for</span>( i=department_array.size() ; i&gt;0 ; i-- ) {
01058         <span class="keywordflow">if</span>( department_array.is_deleted(i) )
01059             <span class="keywordflow">continue</span>;
01060 
01061         <a class="code" href="classDepartment.html">Department</a> *dept = department_array[i];
01062         stuPtr = &amp;(department_array[i]-&gt;<a class="code" href="classGeneralDepartment.html#m0">student_array</a>);
01063 
01064         <span class="keywordtype">int</span> stuCount = stuPtr-&gt;<a class="code" href="classStudentArray.html#m1">student_count</a>;
01065         <span class="keywordtype">int</span> ugtCount = dept-&gt;<a class="code" href="classGeneralDepartment.html#m5">student_level_history</a>[<a class="code" href="Ostudent_8h.html#a32a3">UG_TRADITION</a>][THIS_YEAR];
01066         <span class="comment">//int ugAllCount = ugtCount + dept-&gt;student_level_history[UG_NONTRADITION][THIS_YEAR] + dept-&gt;student_level_history[DISTANCE_LEARN][THIS_YEAR];</span>
01067         <span class="keywordtype">int</span> masCount = dept-&gt;<a class="code" href="classGeneralDepartment.html#m5">student_level_history</a>[<a class="code" href="Ostudent_8h.html#a32a5">MASTER</a>][THIS_YEAR];
01068         <span class="keywordtype">int</span> docCount = dept-&gt;<a class="code" href="classGeneralDepartment.html#m5">student_level_history</a>[<a class="code" href="Ostudent_8h.html#a32a6">DOCTOR</a>][THIS_YEAR];
01069 
01070         <span class="comment">//              test[i] = ugtCount;</span>
01071 
01072         <span class="comment">//              test1 = stuPtr-&gt;talent_academic[THIS_MONTH] * info.debug[i];</span>
01073 
01074         <span class="comment">//              test2++;</span>
01075 
01076         total[0] += stuPtr-&gt;<a class="code" href="classStudentArray.html#m4">talent_academic</a>[THIS_MONTH] * ugtCount;
01077         <span class="comment">//              total[0] += stuPtr-&gt;talent_academic[THIS_MONTH-1] * info.debug[i];</span>
01078         total[1] += stuPtr-&gt;<a class="code" href="classStudentArray.html#m5">talent_extracurricular</a>[THIS_MONTH] * ugtCount;
01079         total[2] += stuPtr-&gt;<a class="code" href="classStudentArray.html#m6">talent_athletics</a>[THIS_MONTH] * ugtCount;
01080 
01081         total[3] += stuPtr-&gt;<a class="code" href="classStudentArray.html#m7">satisfaction_academic</a>[THIS_MONTH] * ugtCount;
01082         total[4] += stuPtr-&gt;<a class="code" href="classStudentArray.html#m8">satisfaction_student_life</a>[THIS_MONTH] * ugtCount;
01083         total[5] += stuPtr-&gt;<a class="code" href="classStudentArray.html#m9">satisfaction_athletics</a>[THIS_MONTH] * ugtCount;
01084         total[6] += stuPtr-&gt;<a class="code" href="classStudentArray.html#m10">satisfaction_overall</a>[THIS_MONTH] * ugtCount;
01085 
01086         <span class="comment">//ugAllCount;</span>
01087         total[7] += stuPtr-&gt;<a class="code" href="classStudentArray.html#m3">performance_academic_ug</a>[THIS_MONTH] * ugtCount;
01088         <span class="comment">// ugAllCount;</span>
01089         total[8] += stuPtr-&gt;<a class="code" href="classStudentArray.html#m2">talent_academic_all</a>[<a class="code" href="Ostudent_8h.html#a33a9">BACHELOR_DEGREE</a>][THIS_MONTH] * ugtCount;
01090         total[9] += stuPtr-&gt;<a class="code" href="classStudentArray.html#m2">talent_academic_all</a>[<a class="code" href="Ostudent_8h.html#a33a10">MASTER_DEGREE</a>][THIS_MONTH] * masCount;
01091         total[10] += stuPtr-&gt;<a class="code" href="classStudentArray.html#m2">talent_academic_all</a>[<a class="code" href="Ostudent_8h.html#a33a11">DOCTOR_DEGREE</a>][THIS_MONTH] * docCount;
01092 
01093         totalUgtStuCount += ugtCount;
01094         totalStuCount += stuCount;
01095 
01096         <span class="comment">//totalUgAllCount += ugAllCount;</span>
01097         totalMasterCount += masCount;
01098         totalDoctorCount += docCount;
01099     }
01100 
01101     <span class="comment">//  if (!totalStuCount )</span>
01102     <span class="comment">//          return;</span>
01103 
01104     <span class="keywordflow">if</span> ( totalUgtStuCount ) {
01105         <span class="comment">//## 071299 chea 1.12.1</span>
01106         talent_academic[THIS_MONTH] = char(total[0] / totalUgtStuCount);
01107         <span class="comment">//              talent_academic[THIS_MONTH] = 33; //## 200199 chea 4 testing only</span>
01108 
01109         <span class="comment">//              talent_academic[THIS_MONTH] = char(total[0] / info.debug[11]);</span>
01110         talent_extracurricular [THIS_MONTH] = char(total[1] / totalUgtStuCount);
01111         talent_athletics [THIS_MONTH] = char(total[2] / totalUgtStuCount);
01112 
01113         satisfaction_academic [THIS_MONTH] = char(total[3] / totalUgtStuCount);
01114         satisfaction_student_life [THIS_MONTH] = char(total[4] / totalUgtStuCount);
01115         satisfaction_athletics [THIS_MONTH] = char(total[5] / totalUgtStuCount);
01116         satisfaction_overall [THIS_MONTH] = char(total[6] / totalUgtStuCount);
01117 
01118         <span class="comment">//totalUgAllCount);</span>
01119         talent_academic_all[<a class="code" href="Ostudent_8h.html#a33a9">BACHELOR_DEGREE</a>][THIS_MONTH] = char(total[8] / totalUgtStuCount);
01120 
01121         performance_academic_ug[THIS_MONTH] = char(total[7] / totalUgtStuCount);
01122     }
01123 
01124     <span class="keywordflow">if</span> ( totalMasterCount )
01125         talent_academic_all[<a class="code" href="Ostudent_8h.html#a33a10">MASTER_DEGREE</a>][THIS_MONTH] = char(total[9] / totalMasterCount);
01126 
01127     <span class="keywordflow">if</span> ( totalDoctorCount )
01128         talent_academic_all[<a class="code" href="Ostudent_8h.html#a33a11">DOCTOR_DEGREE</a>][THIS_MONTH] = char(total[10] / totalDoctorCount);
01129 }
01130 
01131 <span class="comment">//---------- End of function PlayerSchool::calc_student_performance -----------//</span>
01132 
01133 <span class="comment">//---------- End of function PlayerSchool::next_trimester -----------//</span>
01134 <span class="comment">//</span>
01135 <span class="comment">// update the array adjusted_student_major_pref</span>
01136 <span class="comment">//</span>
<a name="l01137"></a><a class="code" href="classPlayerSchool.html#a34">01137</a> <span class="keywordtype">void</span> <a class="code" href="classPlayerSchool.html#a34">PlayerSchool::next_trimester</a>() {
01138     <span class="keywordtype">short</span> i, sl, deptCount;
01139     <span class="keywordtype">float</span> totalPctIncludedDept = 0.0f;
01140     <a class="code" href="classDepartment.html">Department</a> *deptPtr;
01141 
01142     deptCount = department_array.department_count;
01143 
01144     <span class="keywordflow">if</span> ( deptCount == 0 )                           <span class="comment">// it's true when called through init();</span>
01145         <span class="keywordflow">return</span>;
01146 
01147     <a class="code" href="ALL_8H.html#a0">err_when</a>(!deptCount || deptCount &gt; <a class="code" href="Gamedef_8h.html#a10">MAX_DEPARTMENT</a>);
01148 
01149     <span class="comment">//---------- adjust the array which was adjusted in PlayerSchool::generate_student_adjust_one_pct_array(float *arr, int size)</span>
01150 
01151     <span class="keywordflow">for</span> (sl=0; sl&lt;<a class="code" href="Ostudent_8h.html#a1">MAX_STUDENT_LEVEL_INI</a>; sl++) {
01152         <a class="code" href="classPlayerSchool.html#a38">generate_student_readjust_pct_array</a>
01153             (<a class="code" href="classPlayerSchool.html#m73">adjusted_student_major_pref</a>[sl], department_array.department_count);
01154     }
01155 
01156     sys.yield();
01157 
01158     <span class="comment">//---------- calc major multiplier and hence major ------------//</span>
01159 
01160     <span class="keywordflow">for</span> (sl=0; sl&lt;<a class="code" href="Ostudent_8h.html#a1">MAX_STUDENT_LEVEL_INI</a>; sl++) {
01161         totalPctIncludedDept = 0.0f;
01162 
01163         <span class="keywordflow">for</span> (i=1; i&lt;=deptCount; i++) {
01164             deptPtr = department_array[i];
01165 
01166             <span class="keywordtype">float</span> pref = 0.5f * deptPtr-&gt;<a class="code" href="classDepartment.html#m42">p_educational_quality</a> + 0.5f * deptPtr-&gt;<a class="code" href="classDepartment.html#m44">p_student_morale</a>;
01167 
01168             <a class="code" href="classPlayerSchool.html#m74">major_pref_multiplier</a>[i-1] = player_school.latency_func( 0.5f, <a class="code" href="classPlayerSchool.html#m74">major_pref_multiplier</a>[i-1], pref );
01169 
01170             <span class="comment">//float last1 = adjusted_student_major_pref[sl][i-1];</span>
01171             <span class="comment">//float rand = time_variation(last1, last2, 1.8531f, -0.9151f ,difficulty_multiplier*0.003099490f)</span>
01172             <span class="keywordtype">float</span> rand = math.time_variation(0, 0, 1.8531f, -0.9151f, <a class="code" href="classPlayerSchool.html#m52">difficulty_multiplier</a> * 0.003099490f );
01173 
01174             <a class="code" href="classPlayerSchool.html#m73">adjusted_student_major_pref</a>[sl][i-1]
01175                 *= <a class="code" href="classPlayerSchool.html#m74">major_pref_multiplier</a>[i-1] * (1 + rand);<span class="comment">// 1007: random added WFM note 0919</span>
01176 
01177             <span class="comment">//---------- Scenario special handling ----------//</span>
01178 
01179             <span class="keywordflow">if</span>( <a class="code" href="classPlayerSchool.html#m32">scenario_id</a> == <a class="code" href="Opschool_8h.html#a63a28">SCN_COMPENSATE_FOR_ENROLLMENT_SHIFTS</a> &amp;&amp;
01180                 info.prerun_year &amp;&amp; info.game_year==1 ) {
01181                 <span class="keywordflow">if</span>( player_school.scen_dept_selected_array[i-1] )
01182                     <a class="code" href="classPlayerSchool.html#m73">adjusted_student_major_pref</a>[sl][i-1] *= 1.67f;
01183                 <span class="keywordflow">else</span>
01184                     <a class="code" href="classPlayerSchool.html#m73">adjusted_student_major_pref</a>[sl][i-1] *= 0.33f;
01185             }
01186 
01187             <span class="comment">//----------------------------------------------------//</span>
01188 
01189             totalPctIncludedDept += <a class="code" href="classPlayerSchool.html#m73">adjusted_student_major_pref</a>[sl][i-1];
01190 
01191             sys.yield();
01192         }
01193 
01194         <span class="comment">//--------- normalize the preference ----------//</span>
01195 
01196         <span class="keywordflow">for</span> (i=1; i&lt;=deptCount; i++) {
01197             <a class="code" href="classPlayerSchool.html#m73">adjusted_student_major_pref</a>[sl][i-1] = math.safe_divide(<a class="code" href="classPlayerSchool.html#m73">adjusted_student_major_pref</a>[sl][i-1] ,totalPctIncludedDept);
01198         }
01199     }
01200 
01201     <span class="comment">// generate_student_adjust_pct_arrays(); for probability of selection of major</span>
01202     <span class="comment">//</span>
01203     <span class="keywordflow">for</span> (sl=0; sl&lt;<a class="code" href="Ostudent_8h.html#a1">MAX_STUDENT_LEVEL_INI</a>; sl++) {
01204         <a class="code" href="classPlayerSchool.html#a37">generate_student_adjust_pct_array</a>
01205             (<a class="code" href="classPlayerSchool.html#m73">adjusted_student_major_pref</a>[sl], department_array.department_count);
01206     }
01207 
01208     sys.yield();
01209 
01210     <span class="comment">//------------------------------------------------------------//</span>
01211     <span class="comment">//---------- 1103 calc elective course multiplier ------------//</span>
01212     <span class="comment">//------------------------------------------------------------//</span>
01213 
01214     <span class="keywordflow">for</span>( i=0 ; i&lt;=department_res.department_count ; i++ ) {
01215         <span class="comment">// 0 points to the general department</span>
01216         <a class="code" href="structDepartmentInfo.html">DepartmentInfo</a>* deptInfo = department_res.operator[](i);
01217 
01218         <span class="keywordtype">float</span> total_bachelor_pref = 0;
01219         <span class="keywordtype">float</span> total_master_pref = 0;
01220 
01221         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> d=department_array.size(); d&gt;0; d--) {
01222             <span class="keywordflow">if</span>( department_array.is_deleted(d) )
01223                 <span class="keywordflow">continue</span>;
01224 
01225             <span class="keywordtype">int</span> deptId = department_array[d]-&gt;department_id;
01226 
01227             deptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m4">bachelor_elective_course_pref</a>[deptId-1] *=
01228                 department_array[d]-&gt;p_educational_quality;
01229 
01230             deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m37">master_elective_course_pref</a>[deptId-1] *=
01231                 department_array[d]-&gt;p_educational_quality;
01232 
01233             total_bachelor_pref += deptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m4">bachelor_elective_course_pref</a>[deptId-1];
01234             total_master_pref += deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m37">master_elective_course_pref</a>[deptId-1];
01235         }
01236 
01237         total_bachelor_pref /= department_array.department_count;
01238         total_master_pref /= department_array.department_count;
01239 
01240         sys.yield();
01241 
01242         <span class="keywordflow">for</span> (d=department_array.size(); d&gt;0; d--) {
01243             <span class="keywordflow">if</span>( department_array.is_deleted(d) )
01244                 <span class="keywordflow">continue</span>;
01245 
01246             <span class="keywordtype">int</span> deptId = department_array[d]-&gt;department_id;
01247 
01248 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
01249 <span class="preprocessor"></span>            deptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m4">bachelor_elective_course_pref</a>[deptId-1] = math.safe_divide(deptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m4">bachelor_elective_course_pref</a>[deptId-1], total_bachelor_pref);
01250             deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m37">master_elective_course_pref</a>[deptId-1] = math.safe_divide(deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m37">master_elective_course_pref</a>[deptId-1], total_master_pref);
01251 <span class="preprocessor">#else</span>
01252 <span class="preprocessor"></span>            deptInfo-&gt;<a class="code" href="structGeneralDepartmentInfo.html#m4">bachelor_elective_course_pref</a>[deptId-1] /= total_bachelor_pref;
01253             deptInfo-&gt;<a class="code" href="structDepartmentInfo.html#m37">master_elective_course_pref</a>[deptId-1] /= total_master_pref;
01254 <span class="preprocessor">#endif</span>
01255 <span class="preprocessor"></span>        }
01256 
01257         sys.yield();
01258     }
01259 
01260     department_res.calc_total_elective_course_pref();
01261 }
01262 
01263 <span class="comment">//---------- End of function PlayerSchool::next_trimester -----------//</span>
01264 
01265 <span class="comment">// ##### Begin Marco ##### //</span>
01266 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
01267 <span class="preprocessor"></span><span class="comment">// -----------Begin of function PlayerSchool::save_initial_data ------ //</span>
01268 <span class="keywordtype">void</span> PlayerSchool::save_initial_data() {
01269     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="Ostudent_8h.html#a34a12">MAX_STUDENT_LEVEL_N_TOTAL</a>; i++) {
01270         <span class="comment">//              for (int j = 0; j &lt; HISTORY_TRIMESTER_COUNT; j++)</span>
01271         <span class="comment">//                      initial_ins_student_level_history[i][j] = ins_student_level_history[i][j];</span>
01272         initial_ins_student_level_history[i] = <a class="code" href="classPlayerSchool.html#m113">ins_student_level_history</a>[i][HISTORY_TRIMESTER_COUNT - 1];
01273     }
01274 
01275     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="Gamedef_8h.html#a77a33">GENDER_ETHNIC_TYPE_COUNT_N_TOTAL</a>; i++) {
01276         <span class="comment">//              for (int j = 0; j &lt; HISTORY_TRIMESTER_COUNT; j++)</span>
01277         <span class="comment">//                      initial_ins_gender_student_level_history[i][j] = ins_gender_student_level_history[i][j];</span>
01278         initial_ins_gender_student_level_history[i] = <a class="code" href="classPlayerSchool.html#m115">ins_gender_student_level_history</a>[i][HISTORY_TRIMESTER_COUNT - 1];
01279     }
01280 
01281     <span class="keywordflow">for</span> (i = 0; i &lt; HISTORY_MONTH_COUNT; i ++)
01282         initial_performance_academic_ug[i] = <a class="code" href="classPlayerSchool.html#m104">performance_academic_ug</a>[i];
01283 
01284     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="Ostudent_8h.html#a33a8">DEGREE_TYPE_COUNT</a>; j++) {
01285         <span class="keywordflow">for</span> (i = 0; i &lt; HISTORY_MONTH_COUNT; i ++)
01286             initial_talent_academic_all[j][i] = <a class="code" href="classPlayerSchool.html#m103">talent_academic_all</a>[j][i];
01287     }
01288 
01289     <span class="keywordflow">for</span> (i = 0; i &lt; HISTORY_MONTH_COUNT; i++) {
01290         initial_talent_academic[i] = <a class="code" href="classPlayerSchool.html#m105">talent_academic</a>[i];
01291         initial_talent_extracurricular[i] = <a class="code" href="classPlayerSchool.html#m106">talent_extracurricular</a>[i];
01292         initial_talent_athletics[i] = <a class="code" href="classPlayerSchool.html#m107">talent_athletics</a>[i];
01293 
01294         initial_satisfaction_academic[i] = <a class="code" href="classPlayerSchool.html#m108">satisfaction_academic</a>[i];
01295         initial_satisfaction_student_life[i] = <a class="code" href="classPlayerSchool.html#m109">satisfaction_student_life</a>[i];
01296         initial_satisfaction_athletics[i] = <a class="code" href="classPlayerSchool.html#m110">satisfaction_athletics</a>[i];
01297         initial_satisfaction_overall[i] = <a class="code" href="classPlayerSchool.html#m111">satisfaction_overall</a>[i];
01298     }
01299 
01300     <span class="keywordflow">for</span> (i = 0; i &lt; HISTORY_YEAR_COUNT; i++) {
01301         initial_bachelor_degree[i] = <a class="code" href="classPlayerSchool.html#m100">bachelor_degree</a>[i]+non_ug_bachelor_degree[i];
01302         initial_master_degree[i] = <a class="code" href="classPlayerSchool.html#m101">master_degree</a>[i];
01303         initial_doctor_degree[i] = <a class="code" href="classPlayerSchool.html#m102">doctor_degree</a>[i];
01304     }
01305 
01306     <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="Ostudent_8h.html#a33a8">DEGREE_TYPE_COUNT</a>; j++) {
01307         <span class="keywordflow">for</span> (i = 0; i &lt; HISTORY_YEAR_COUNT; i++) {
01308             initial_time_to_degree[j][i] = <a class="code" href="classPlayerSchool.html#m97">time_to_degree</a>[j][i];
01309             initial_dropout_rate[j][i] = <a class="code" href="classPlayerSchool.html#m98">dropout_rate</a>[j][i];
01310             <span class="comment">//                  initial_fake_disp_time_to_degree[j][i] = fake_disp_time_to_degree[j][i];</span>
01311             initial_fake_disp_time_to_degree[i] = <a class="code" href="classPlayerSchool.html#m99">fake_disp_time_to_degree</a>[<a class="code" href="Ostudent_8h.html#a33a9">BACHELOR_DEGREE</a>][i];
01312         }
01313     }
01314 }
01315 
01316 <span class="comment">// ----------- End of function PlayerSchool::save_initial_data ------ //</span>
01317 <span class="preprocessor">#endif</span>
01318 <span class="preprocessor"></span><span class="comment">// ##### End Marco ##### //</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:15 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
