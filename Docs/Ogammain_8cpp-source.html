<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Ogammain.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Ogammain.cpp</h1><a href="Ogammain_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OGAMMAIN.CPP</span>
00002 <span class="comment">//Description : Main Game Object - Main menu</span>
00003 
00004 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00005 <span class="preprocessor">#include &lt;<a class="code" href="OVGALOCK_8H.html">OVGALOCK.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;OWORLDMT.H&gt;</span>
00007 <span class="preprocessor">#include &lt;<a class="code" href="OMUSIC_8H.html">OMUSIC.H</a>&gt;</span>
00008 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00009 <span class="preprocessor">#include &lt;<a class="code" href="OIMGRES_8H.html">OIMGRES.H</a>&gt;</span>
00010 <span class="preprocessor">#include &lt;OIFACE.H&gt;</span>
00011 <span class="preprocessor">#include &lt;<a class="code" href="OCOLTBL_8H.html">OCOLTBL.H</a>&gt;</span>
00012 <span class="preprocessor">#include &lt;<a class="code" href="OPOWER_8H.html">OPOWER.H</a>&gt;</span>
00013 <span class="preprocessor">#include &lt;<a class="code" href="OBATTLE_8H.html">OBATTLE.H</a>&gt;</span>
00014 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00015 <span class="preprocessor">#include &lt;<a class="code" href="OMOUSECR_8H.html">OMOUSECR.H</a>&gt;</span>
00016 <span class="preprocessor">#include &lt;OPSCHOOL.H&gt;</span>
00017 <span class="preprocessor">#include &lt;<a class="code" href="OGSET_8H.html">OGSET.H</a>&gt;</span>
00018 <span class="preprocessor">#include &lt;OGFILE.H&gt;</span>
00019 <span class="preprocessor">#include &lt;<a class="code" href="OGAME_8H.html">OGAME.H</a>&gt;</span>
00020 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>
00021 <span class="preprocessor">#include &lt;<a class="code" href="OBOX_8H.html">OBOX.H</a>&gt;</span>
00022 <span class="preprocessor">#include &lt;<a class="code" href="OGAMESET_8H.html">OGAMESET.H</a>&gt;</span>
00023 <span class="preprocessor">#include &lt;<a class="code" href="ODEPTRES_8H.html">ODEPTRES.H</a>&gt;</span>
00024 <span class="preprocessor">#include &lt;OAUDIO.H&gt;</span>
00025 <span class="preprocessor">#include &lt;OCONFIG.H&gt;</span>
00026 
<a name="l00027"></a><a class="code" href="Ogammain_8cpp.html#a0">00027</a> <span class="preprocessor">#define DEBUG_LOG_LOCAL 1</span>
00028 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="OLOG_8H.html">OLOG.H</a>&gt;</span>
00029 
00030 <span class="comment">//---------- define constant ----------//</span>
00031 
00032 <span class="keyword">enum</span> { <a class="code" href="Ogammain_8cpp.html#a9a2">BUTTON_COUNT</a> = 6 };
00033 
00034 <span class="keyword">enum</span> {
00035     <a class="code" href="Ogammain_8cpp.html#a10a3">BUTTON_WIDTH</a>  = 201,
00036     <a class="code" href="Ogammain_8cpp.html#a10a4">BUTTON_HEIGHT</a> = 37
00037 };
00038 
00039 <span class="keyword">enum</span> {
00040     <a class="code" href="Ogammain_8cpp.html#a11a5">MODE_TITLE_SCREEN</a>=-1,
00041     <a class="code" href="Ogammain_8cpp.html#a11a6">MODE_GAME_SETTING</a>=-3,
00042     <a class="code" href="Ogammain_8cpp.html#a11a7">MODE_SCEN_GAME_SETTING</a>=-4
00043 };
00044 <span class="comment">//------- define struct GameOptionButton --------//</span>
00045 
<a name="l00049"></a><a class="code" href="structGameOptionButton.html">00049</a> <span class="keyword">struct </span><a class="code" href="structGameOptionButton.html">GameOptionButton</a> {
<a name="l00050"></a><a class="code" href="structGameOptionButton.html#m0">00050</a>     <span class="keywordtype">short</span> <a class="code" href="structGameOptionButton.html#m0">x1</a>;
<a name="l00051"></a><a class="code" href="structGameOptionButton.html#m1">00051</a>     <span class="keywordtype">short</span> <a class="code" href="structGameOptionButton.html#m1">y1</a>;
<a name="l00052"></a><a class="code" href="structGameOptionButton.html#m2">00052</a>     <span class="keywordtype">char</span>* <a class="code" href="structGameOptionButton.html#m2">file_name</a>;
00053 };
00054 
00055 <span class="comment">//----------- define static vars ---------//</span>
00056 
00057 <span class="keyword">static</span> <a class="code" href="structGameOptionButton.html">GameOptionButton</a> game_option_button_array[] = {
00058     { 80 , 460, <span class="stringliteral">"MM-BUT1"</span> },
00059     { 298, 460, <span class="stringliteral">"MM-BUT2"</span> },
00060     { 518, 460, <span class="stringliteral">"MM-BUT3"</span> },
00061     { 75 , 505, <span class="stringliteral">"MM-BUT4"</span> },
00062     { 290, 505, <span class="stringliteral">"MM-BUT5"</span> },
00063     { 510, 505, <span class="stringliteral">"MM-BUT6"</span> },
00064 };
00065 
00066 <span class="keyword">static</span> <span class="keywordtype">void</span> init_school_type();
00067 
00068 <span class="comment">//---------- Begin of function Game::main_menu ----------//</span>
<a name="l00070"></a><a class="code" href="classGame.html#a3">00070</a> <span class="comment">void Game::main_menu() {</span>
00071     <span class="comment">//------------- display menu options -------------//</span>
00072 
00073     <span class="keywordtype">int</span> refreshFlag=1;
00074 
00075     vga_front.unlock_buf();
00076 
00077     <span class="keywordflow">while</span>(1) {
00078         sys.signal_exit_flag=0;
00079         <span class="comment">//------- Display game title and paint menu box --------//</span>
00080 
00081         <span class="comment">// Handle window messages</span>
00082 
00083         MSG msg;
00084         <span class="keywordflow">if</span> (PeekMessage( &amp;msg, <a class="code" href="OHELP_8H.html#a0">NULL</a>, 0, 0, PM_NOREMOVE)) {
00085             <span class="keywordflow">if</span> (!GetMessage( &amp;msg, <a class="code" href="OHELP_8H.html#a0">NULL</a>, 0, 0)) {
00086                 sys.signal_exit_flag = 1;
00087                 <span class="keywordflow">return</span>;
00088             }
00089             TranslateMessage(&amp;msg);
00090             DispatchMessage(&amp;msg);
00091             <span class="keywordflow">continue</span>;
00092         }
00093         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( sys.paused_flag || !sys.active_flag ) {
00094             WaitMessage();
00095             <span class="keywordflow">continue</span>;
00096         }
00097 
00098         <span class="keywordflow">if</span>( sys.redraw_all_flag ) {                   <span class="comment">// || m.get_time() - sys.last_redraw_time &gt; 3000 )</span>
00099             refreshFlag = 1;
00100             sys.redraw_all_flag = 0;
00101             sys.last_redraw_time = m.get_time();        <span class="comment">// redraw every 8 sec. Such that if background erased at the beginning, redraw</span>
00102         }
00103         vga_front.lock_buf();                         <span class="comment">// ## chwg1116</span>
00104         vga.use_front();                              <span class="comment">// many places called vga.used_back</span>
00105 
00106         <span class="comment">// -------- display ----------//</span>
00107         <span class="keywordflow">if</span>( refreshFlag ) {
00108             sys.view_mode=-1;                           <span class="comment">// -1 = in main menu</span>
00109 
00110             <span class="keywordtype">int</span> dataSize;
00111             <span class="keywordtype">char</span>* bmpName = <span class="stringliteral">"MENU-STD"</span>;
00112 
00113 <span class="preprocessor">#ifdef DEMO</span>
00114 <span class="preprocessor"></span>            bmpName = <span class="stringliteral">"MENUDEMO"</span>;
00115 <span class="preprocessor">#endif</span>
00116 <span class="preprocessor"></span>
00117 <span class="preprocessor">#ifdef ADMIN</span>
00118 <span class="preprocessor"></span>            bmpName = <span class="stringliteral">"MENU-ADM"</span>;
00119 <span class="preprocessor">#endif</span>
00120 <span class="preprocessor"></span>
00121             <a class="code" href="classFile.html">File</a>* filePtr = image_interface.get_file(bmpName, dataSize);
00122 
00123             <span class="keywordflow">if</span> (filePtr-&gt;<a class="code" href="classFile.html#a11">file_get_short</a>() != -1 ) {     <span class="comment">// use common color palette</span>
00124                 filePtr-&gt;<a class="code" href="classFile.html#a7">file_seek</a>(filePtr-&gt;<a class="code" href="classFile.html#a8">file_pos</a>() - <span class="keyword">sizeof</span>(short));
00125                 vga_front.put_large_bitmap(0, 0, filePtr);
00126             }
00127             <span class="keywordflow">else</span> {                                      <span class="comment">// use own color palette</span>
00128                 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> palette[256 * 3];
00129                 <span class="keywordtype">short</span> *remapTable;
00130                 filePtr-&gt;<a class="code" href="classFile.html#a9">file_read</a>(palette, 256 * 3);
00131                 <a class="code" href="structPalDesc.html">PalDesc</a> palDesc(palette, 3, 256, 6);
00132                 <a class="code" href="classColorTable.html">ColorTable</a> colorTable;
00133                 colorTable.<a class="code" href="classColorTable.html#a9">generate_table_fast</a>(<a class="code" href="OVGA_8H.html#a3">MAX_BRIGHTNESS_ADJUST_DEGREE</a>, palDesc, <a class="code" href="classColorTable.html#d0">ColorTable::bright_func</a>);
00134                 remapTable = (<span class="keywordtype">short</span> *) colorTable.<a class="code" href="classColorTable.html#a11">get_table</a>(0);
00135                 vga_front.put_large_bitmap(0, 0, filePtr, remapTable);
00136             }
00137 
00138 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00139 <span class="preprocessor"></span>            <span class="comment">//------- display version info --------//</span>
00140             disp_version();
00141 <span class="preprocessor">#endif</span>
00142 <span class="preprocessor"></span>            mouse_cursor.set_icon(<a class="code" href="OMOUSECR_8H.html#a6a3">CURSOR_NORMAL</a>);
00143             mouse.show();
00144             refreshFlag=0;
00145         }
00146 
00147         sys.blt_virtual_buf();
00148 
00149         <span class="comment">//---------- detect menu option buttons -----------//</span>
00150         sys.yield();
00151         music.yield();
00152         mouse.get_event();
00153 
00154         <a class="code" href="structGameOptionButton.html">GameOptionButton</a>* buttonPtr = game_option_button_array;
00155 
00156         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;<a class="code" href="Ogammain_8cpp.html#a9a2">BUTTON_COUNT</a> ; i++, buttonPtr++ ) {
00157             <span class="keywordflow">if</span>(  mouse.single_click( buttonPtr-&gt;<a class="code" href="structGameOptionButton.html#m0">x1</a>, buttonPtr-&gt;<a class="code" href="structGameOptionButton.html#m1">y1</a>,
00158                                      buttonPtr-&gt;<a class="code" href="structGameOptionButton.html#m0">x1</a>+<a class="code" href="Ogammain_8cpp.html#a10a3">BUTTON_WIDTH</a>-1, buttonPtr-&gt;<a class="code" href="structGameOptionButton.html#m1">y1</a>+<a class="code" href="Ogammain_8cpp.html#a10a4">BUTTON_HEIGHT</a>-1, 0 ) ) {
00159                 mouse.hide_area(buttonPtr-&gt;<a class="code" href="structGameOptionButton.html#m0">x1</a>, buttonPtr-&gt;<a class="code" href="structGameOptionButton.html#m1">y1</a>,
00160                                 buttonPtr-&gt;<a class="code" href="structGameOptionButton.html#m0">x1</a>+<a class="code" href="Ogammain_8cpp.html#a10a3">BUTTON_WIDTH</a>-1,  buttonPtr-&gt;<a class="code" href="structGameOptionButton.html#m1">y1</a>+<a class="code" href="Ogammain_8cpp.html#a10a4">BUTTON_HEIGHT</a>-1);
00161                 image_interface.put_front( buttonPtr-&gt;<a class="code" href="structGameOptionButton.html#m0">x1</a>, buttonPtr-&gt;<a class="code" href="structGameOptionButton.html#m1">y1</a>, buttonPtr-&gt;<a class="code" href="structGameOptionButton.html#m2">file_name</a> );
00162                 mouse.show_area();
00163 
00164                 sys.blt_virtual_buf();
00165 
00166                 <span class="keywordflow">while</span>( mouse.left_press ) {
00167                     sys.yield();
00168                     mouse.get_event();
00169                     sys.blt_virtual_buf();
00170                 }
00171                 run_main_menu_option(i+1);
00172 
00173                 refreshFlag=1;
00174                 <span class="keywordflow">break</span>;
00175             }
00176         }
00177 
00178         vga_front.unlock_buf();                       <span class="comment">// ## chwg1116</span>
00179         <span class="comment">//-------------------------------------------------//</span>
00180         <span class="keywordflow">if</span>( sys.signal_exit_flag ==1)
00181             <span class="keywordflow">break</span>;
00182     }
00183 
00184     vga_front.lock_buf();                           <span class="comment">// ## chwg1116</span>
00185 }
00186 
00187 <span class="comment">//------------ End of function Game::main_menu -----------//</span>
00188 
00189 <span class="comment">//-------- Begin of function Game::run_main_menu_option --------//</span>
00192 <span class="comment">void Game::run_main_menu_option(int optionId) {</span>
00193     <span class="comment">//  vga_front.bar( 0, 0, VGA_WIDTH-1, VGA_HEIGHT-1, V_BLACK );</span>
00194     <span class="comment">//  sys.blt_virtual_buf();</span>
00195     audio.play_wav(<span class="stringliteral">"BEEPS-1"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00196 
00197     <span class="comment">//------ New Game -----------//</span>
00198 
00199     <span class="keywordflow">if</span>( optionId==2 ) {
00200 <span class="preprocessor">#ifndef ADMIN</span>
00201 <span class="preprocessor"></span>        box.msg( <span class="stringliteral">"The custom game in this version is for demo purpose only. It has a time limit of 2 years. Please consider buying the Administrator version for fully functional custom games."</span> );
00202 <span class="preprocessor">#endif</span>
00203 <span class="preprocessor"></span>
00204         new_game();
00205     }
00206 
00207     <span class="comment">//--------- Play Scenario ---------//</span>
00208     <span class="keywordflow">if</span>( optionId==1 )
00209         play_scenario();
00210 
00211     <span class="comment">//----------- Load Game -----------//</span>
00212 
00213     <span class="keywordflow">if</span>( optionId==3 )
00214         loadgame_menu();
00215 
00216     <span class="comment">//------------- Hall of Fame ----------------//</span>
00217 
00218     <span class="keywordflow">if</span>( optionId==4 )
00219         hall_of_fame();
00220     <span class="comment">//          game_file_array.disp_hall_of_fame();</span>
00221 
00222     <span class="comment">//------------- Credits ----------------//</span>
00223 
00224     <span class="keywordflow">if</span>( optionId==5 )
00225         credit();
00226 
00227     <span class="comment">//----------------- Quit Game ----------------//</span>
00228 
00229     <span class="keywordflow">if</span>( optionId==6 )
00230         sys.signal_exit_flag = 1;
00231 }
00232 
00233 <span class="comment">//---------- End of function Game::run_main_menu_option ---------//</span>
00234 
00235 <span class="comment">//-------- Begin of static function disp_version --------//</span>
00236 <span class="comment">//</span>
00237 <span class="keywordtype">void</span> Game::disp_version() {
00238     <span class="comment">//----------- display version string --------//</span>
00239 
00240     <a class="code" href="classString.html">String</a> str;
00241 
00242     str  = <span class="stringliteral">"Version "</span>;
00243     str += GAME_VERSION_STR;
00244 
00245 <span class="preprocessor">#ifdef BETA</span>
00246 <span class="preprocessor"></span>    str = <span class="stringliteral">"This is a Beta version. Unathorized distribution of this Beta is illegal."</span>;
00247 <span class="preprocessor">#endif</span>
00248 <span class="preprocessor"></span>
00249     <span class="keywordflow">if</span>( str.<a class="code" href="classString.html#a5">len</a>() &gt; 40 )
00250         font_fblack.center_put( 0, <a class="code" href="OVGA_8H.html#a1">VGA_HEIGHT</a>-20, <a class="code" href="OVGA_8H.html#a0">VGA_WIDTH</a>-1, <a class="code" href="OVGA_8H.html#a1">VGA_HEIGHT</a>-1, str );
00251     <span class="keywordflow">else</span>
00252         font_fblack.put( 10, <a class="code" href="OVGA_8H.html#a1">VGA_HEIGHT</a>-22, str );
00253 }
00254 
00255 <span class="comment">//---------- End of function Game::disp_version ---------//</span>
00256 
00257 <span class="comment">//---------- Begin of function init_school_type ---------//</span>
00258 <span class="keyword">static</span> <span class="keywordtype">void</span> init_school_type() {
00259     <span class="keywordflow">if</span> ( player_school.is_public() ) {
00260         <span class="keywordflow">if</span> ( player_school.campus_environment != <a class="code" href="Opschool_8h.html#a62a19">RURAL</a> )
00261             player_school.school_type = <a class="code" href="Gamedef_8h.html#a81a43">PUBLIC_SCHOOL</a>;
00262         <span class="keywordflow">else</span>
00263             player_school.school_type = <a class="code" href="Gamedef_8h.html#a81a44">COMPREHENSIVE_SCHOOL</a>;
00264     }
00265     <span class="keywordflow">else</span> {
00266         <span class="keywordflow">if</span> ( player_school.campus_environment != <a class="code" href="Opschool_8h.html#a62a19">RURAL</a> )
00267             player_school.school_type = <a class="code" href="Gamedef_8h.html#a81a41">PRIVATE_SCHOOL</a>;
00268         <span class="keywordflow">else</span>
00269             player_school.school_type = <a class="code" href="Gamedef_8h.html#a81a42">LIBERAL_ARTS_SCHOOL</a>;
00270     }
00271 
00272     <span class="comment">//firm_res.init();                  // it depends on player_school.school_type</span>
00273 }
00274 
00275 <span class="comment">//---------- End of function init_school_type ---------//</span>
00276 
00277 <span class="comment">//---------- Begin of function Game::new_game ----------//</span>
00279 <span class="comment">void Game::new_game() {</span>
00280     sys.view_mode=<a class="code" href="Ogammain_8cpp.html#a11a6">MODE_GAME_SETTING</a>;
00281     <span class="comment">//----- initialize player_school first -----//</span>
00282 
00283     player_school.init();
00284     game_setting.new_game_init();
00285 
00286     game_set.open_set(1);                           <span class="comment">// open the default game set</span>
00287 
00288     field_res.init();
00289     department_res.init();
00290 
00291     <span class="comment">//---- new game settings screen -----//</span>
00292 
00293     <span class="comment">// display the background</span>
00294     image_interface.put_large( &amp;vga_back, 0, 0, <span class="stringliteral">"EMPTYSCR"</span> );
00295 
00296     info.init();                                    <span class="comment">// ## chwg1015              no disp_column function for the game setting screen</span>
00297     game_setting.new_game_report(<a class="code" href="Gamedef_8h.html#a71a16">INFO_REPAINT</a>);
00298 
00299     sys.redraw_all_flag=0;
00300 
00301     vga_front.unlock_buf();                         <span class="comment">// chwg1116</span>
00302 
00303     <span class="keywordtype">int</span> startTime = m.get_time();
00304 
00305     sys.redraw_all_flag = 1;                        <span class="comment">// force repaint once</span>
00306 
00307     <span class="keywordflow">while</span>(1) {
00308         MSG msg;
00309         <span class="keywordflow">if</span> (PeekMessage( &amp;msg, <a class="code" href="OHELP_8H.html#a0">NULL</a>, 0, 0, PM_NOREMOVE)) {
00310             <span class="keywordflow">if</span> (!GetMessage( &amp;msg, <a class="code" href="OHELP_8H.html#a0">NULL</a>, 0, 0)) {
00311                 sys.signal_exit_flag = 1;
00312                 <span class="comment">// BUGHERE : vga_front is unlocked</span>
00313                 <span class="keywordflow">return</span>;
00314             }
00315             TranslateMessage(&amp;msg);
00316             DispatchMessage(&amp;msg);
00317             <span class="keywordflow">continue</span>;
00318         }
00319         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( sys.paused_flag || !sys.active_flag ) {
00320             WaitMessage();
00321             <span class="keywordflow">continue</span>;
00322         }
00323 
00324         vga_front.lock_buf();                         <span class="comment">// ## chwg1116</span>
00325         sys.yield();
00326 
00327         <span class="keywordflow">if</span>( sys.redraw_all_flag ) {                   <span class="comment">// || m.get_time() - sys.last_redraw_time &gt; 3000 )</span>
00328             sys.redraw_all_flag = 0;
00329             sys.last_redraw_time = m.get_time();        <span class="comment">// redraw every 8 sec. Such that if background erased at the beginning, redraw</span>
00330             game_setting.new_game_report(<a class="code" href="Gamedef_8h.html#a71a16">INFO_REPAINT</a>);
00331         }
00332 
00333         sys.yield();
00334 
00335         <span class="keywordtype">int</span> rc = game_setting.new_game_detect();
00336         <span class="keywordflow">if</span>( rc==1 ) {                                 <span class="comment">// Start button is pressed</span>
00337             <span class="comment">//## fred</span>
00338             <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(<span class="stringliteral">"Game::new_game(): Start button is pressed"</span>);
00339 
00340             player_school.calc_setting_vars();          <span class="comment">//## chea 091099 getting option button</span>
00341 
00342             <span class="keywordflow">break</span>;
00343         }
00344         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( rc == -1 ) {                         <span class="comment">// Cancel button is pressed</span>
00345             game_setting.new_game_init();               <span class="comment">// reset game_setting</span>
00346             info.deinit();                              <span class="comment">// ## chwg1015</span>
00347             field_res.deinit();
00348             department_res.deinit();
00349             game_set.close_set();                       <span class="comment">// close the game set</span>
00350 
00351             <span class="comment">//## fred</span>
00352             <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(<span class="stringliteral">"Game::new_game(): Cancel button is pressed"</span>);
00353             <span class="keywordflow">return</span>;
00354         }
00355 
00356         sys.blt_virtual_buf();
00357         sys.yield();
00358         mouse.get_event();
00359 
00360         <span class="keywordflow">if</span>(sys.redraw_all_flag)
00361             game_setting.new_game_report(<a class="code" href="Gamedef_8h.html#a71a16">INFO_REPAINT</a>);
00362         <span class="keywordflow">else</span>
00363             game_setting.new_game_report(<a class="code" href="Gamedef_8h.html#a71a17">INFO_UPDATE</a>);
00364         sys.yield();
00365 
00366         vga_front.unlock_buf();                       <span class="comment">// chwg1116</span>
00367     }
00368 
00369     user_interface.darken(<a class="code" href="Oworldmt_8h.html#a12">ZOOM_X1</a>,<a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a>,<a class="code" href="Oworldmt_8h.html#a14">ZOOM_X2</a>,<a class="code" href="Oworldmt_8h.html#a15">ZOOM_Y2</a>);
00370     info.disp_column_bitmap(&amp;vga_back);
00371     vga.blt_buf(<a class="code" href="Oworldmt_8h.html#a12">ZOOM_X1</a>,<a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a>,<a class="code" href="Oworldmt_8h.html#a14">ZOOM_X2</a>,<a class="code" href="Oworldmt_8h.html#a15">ZOOM_Y2</a>);
00372 
00373     image_interface.put_large( &amp;vga_back, 0, 0, <span class="stringliteral">"MAINSCR2"</span> );
00374     vga.blt_buf(0,0,799,<a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a>-1);
00375     vga.blt_buf(0,<a class="code" href="Oworldmt_8h.html#a15">ZOOM_Y2</a>+1,799,599);
00376     vga.use_back();
00377 
00378     box.progress(0);
00379 
00380     info.deinit();                                  <span class="comment">// ## chwg1015</span>
00381     field_res.deinit();
00382     department_res.deinit();
00383     game_set.close_set();                           <span class="comment">// close the game set</span>
00384 
00385     vga.use_front();
00386 
00387     <span class="comment">//------- start the game ------//</span>
00388     init_school_type();                             <span class="comment">// before firm_res.init()</span>
00389     player_school.init_setting_non_scenario();      <span class="comment">//## fred 0426</span>
00390 
00391     init();
00392     sys.staying_view_mode=<a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>;
00393     sys.view_mode=<a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>;
00394     sys.prev_view_mode = <a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>;
00395     sys.back_view_mode = <a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>;
00396     sys.is_institution_report=0;
00397     sys.menu_pull_down=0;
00398     sys.pause_game_flag=0;
00399     sys.redraw_all_flag = 1;
00400     sys.redraw_zoom_flag = 0;
00401     sys.set_speed(<a class="code" href="Osys_8h.html#a43a7">DEFAULT_SPEED</a>);
00402     sys.m_o_log_selected=0;
00403     sys.m_o_log_highlighted=-1;
00404     sys.m_o_log_old_selected=-2;
00405     sys.m_o_log_old_highlighted=-2;
00406     sys.m_o_log_display_updated=1;
00407     config.scroll_speed=10;
00408 
00409     vga_front.temp_unlock();
00410     <span class="comment">//## fred</span>
00411     <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(<span class="stringliteral">"Game::new_game(): calling battle.run() ---- "</span>);
00412     vga_front.temp_restore_lock();
00413 
00414     battle.run();
00415 
00416     vga_front.temp_unlock();
00417     <span class="comment">//## fred</span>
00418     <a class="code" href="OLOG_8H.html#a6">DEBUG_LOG</a>(<span class="stringliteral">"Game::new_game(): called  battle.run() ---- "</span>);
00419     vga_front.temp_restore_lock();
00420 
00421     deinit();
00422 
00423 }
00424 
00425 <span class="comment">//------------ End of function Game::new_game -----------//</span>
00426 
00427 <span class="comment">//---------- Begin of function Game::play_scenario ----------//</span>
00429 <span class="comment">void Game::play_scenario() {</span>
00430     <span class="comment">//----- initialize player_school first -----//</span>
00431     sys.view_mode=<a class="code" href="Ogammain_8cpp.html#a11a7">MODE_SCEN_GAME_SETTING</a>;
00432     player_school.init();
00433     game_setting.play_scenario_init();
00434 
00435     game_set.open_set(1);                           <span class="comment">// open the default game set</span>
00436 
00437     field_res.init();
00438     department_res.init();
00439     field_res.deinit();
00440     department_res.deinit();
00441 
00442     <span class="comment">//##  field_res.init();</span>
00443     <span class="comment">//## department_res.init();</span>
00444 
00445     <span class="comment">//---- new game settings screen -----//</span>
00446 
00447     <span class="comment">// display the background</span>
00448     image_interface.put_large( &amp;vga_back, 0, 0, <span class="stringliteral">"EMPTYSCR"</span> );
00449 
00450     info.init();                                    <span class="comment">// ## chwg1015              no disp_column function for the game setting screen</span>
00451 
00452 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00453 <span class="preprocessor"></span>    player_school.scenario_id = 1;                  <span class="comment">// auto select first scenario SCN_RAISE_SALARY is one</span>
00454 <span class="preprocessor">#endif</span>
00455 <span class="preprocessor"></span>    game_setting.play_scenario_report(<a class="code" href="Gamedef_8h.html#a71a16">INFO_REPAINT</a>);
00456 
00457     sys.redraw_all_flag=0;
00458 
00459     vga_front.unlock_buf();                         <span class="comment">// chwg1116</span>
00460 
00461     <span class="keywordflow">while</span>(1) {
00462 
00463         <span class="comment">// handle window message here //</span>
00464         <span class="comment">// ##  begin chwg1116</span>
00465         MSG msg;
00466         <span class="keywordflow">if</span> (PeekMessage( &amp;msg, <a class="code" href="OHELP_8H.html#a0">NULL</a>, 0, 0, PM_NOREMOVE)) {
00467             <span class="keywordflow">if</span> (!GetMessage( &amp;msg, <a class="code" href="OHELP_8H.html#a0">NULL</a>, 0, 0)) {
00468                 sys.signal_exit_flag = 1;
00469                 <span class="comment">// BUGHERE : vga_front is unlocked</span>
00470                 <span class="keywordflow">return</span>;
00471             }
00472             TranslateMessage(&amp;msg);
00473             DispatchMessage(&amp;msg);
00474             <span class="keywordflow">continue</span>;
00475         }
00476         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( sys.paused_flag || !sys.active_flag ) {
00477             WaitMessage();
00478             <span class="keywordflow">continue</span>;
00479         }
00480 
00481         vga_front.lock_buf();                         <span class="comment">// ## chwg1116</span>
00482         <span class="comment">/*</span>
00483 <span class="comment">          if( sys.redraw_all_flag ) // || m.get_time() - sys.last_redraw_time &gt; 3000 )</span>
00484 <span class="comment">          {</span>
00485 <span class="comment">          sys.redraw_all_flag = 0;</span>
00486 <span class="comment">          sys.last_redraw_time = m.get_time();  // redraw every 8 sec. Such that if background erased at the beginning, redraw</span>
00487 <span class="comment">          game_setting.play_scenario_report(INFO_REPAINT);</span>
00488 <span class="comment">          }</span>
00489 <span class="comment">        */</span>
00490         sys.yield();
00491 
00492         <span class="keywordtype">int</span> rc = game_setting.play_scenario_detect();
00493         <span class="keywordflow">if</span>( rc==1 )                                   <span class="comment">// Start button is pressed</span>
00494             <span class="keywordflow">break</span>;
00495         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( rc == -1 ) {                         <span class="comment">// Cancel to Main Menu button is pressed</span>
00496             game_setting.play_scenario_init();          <span class="comment">// reset game_setting</span>
00497             info.deinit();                              <span class="comment">// ## chwg1015</span>
00498             game_set.close_set();                       <span class="comment">// close the game set</span>
00499             <span class="keywordflow">return</span>;
00500         }
00501         sys.blt_virtual_buf();
00502         sys.yield();
00503         mouse.get_event();
00504 
00505         <span class="comment">// fix in version 2.0</span>
00506         <span class="comment">// game_setting.play_scenario_report(sys.redraw_all_flag?INFO_REPAINT:INFO_UPDATE);</span>
00507         <span class="keywordflow">if</span>( sys.redraw_all_flag ) {
00508             game_setting.play_scenario_report( <a class="code" href="Gamedef_8h.html#a71a16">INFO_REPAINT</a> );
00509             sys.redraw_all_flag = 0;
00510         }
00511         <span class="keywordflow">else</span> {
00512             game_setting.play_scenario_report( <a class="code" href="Gamedef_8h.html#a71a17">INFO_UPDATE</a> );
00513         }
00514 
00515         sys.yield();
00516 
00517         vga_front.unlock_buf();                       <span class="comment">// chwg1116</span>
00518     }
00519 
00520     <span class="comment">// the scenario file is loaded in scenario_detect which **called** game.init()      //## fred 0224</span>
00521     <span class="comment">// play now!</span>
00522 
00523     game_setting.play_scenario_init();              <span class="comment">//## fred 0224              // should be deinit!?</span>
00524     user_interface.darken(<a class="code" href="Oworldmt_8h.html#a12">ZOOM_X1</a>,<a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a>,<a class="code" href="Oworldmt_8h.html#a14">ZOOM_X2</a>,<a class="code" href="Oworldmt_8h.html#a15">ZOOM_Y2</a>);
00525     info.disp_column_bitmap(&amp;vga_back);
00526     vga.blt_buf(<a class="code" href="Oworldmt_8h.html#a12">ZOOM_X1</a>,<a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a>,<a class="code" href="Oworldmt_8h.html#a14">ZOOM_X2</a>,<a class="code" href="Oworldmt_8h.html#a15">ZOOM_Y2</a>);
00527 
00528     image_interface.put_large( &amp;vga_back, 0, 0, <span class="stringliteral">"MAINSCR2"</span> );
00529     vga.blt_buf(0,0,799,<a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a>-1);
00530     vga.blt_buf(0,<a class="code" href="Oworldmt_8h.html#a15">ZOOM_Y2</a>+1,799,599);
00531     vga.use_back();
00532 
00533     box.progress(0);
00534 
00535     info.deinit();                                  <span class="comment">// ## chwg1015</span>
00536     <span class="comment">//## field_res.deinit();</span>
00537     <span class="comment">//## department_res.deinit();</span>
00538     game_set.close_set();                           <span class="comment">// close the game set</span>
00539 
00540     vga.use_front();
00541 
00542     <span class="comment">//------- start the game ------//</span>
00543     <span class="comment">// rc: scenario id</span>
00544 
00545     <span class="comment">//init_school_type();</span>
00546 
00547     <span class="comment">//## fred 0224</span>
00548     player_school.init_setting_scenario(player_school.scenario_id);
00549 
00550     init();
00551     sys.staying_view_mode=<a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>;
00552     sys.view_mode=<a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>;
00553     sys.prev_view_mode = <a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>;
00554     sys.back_view_mode = <a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>;
00555     sys.is_institution_report=0;
00556     sys.menu_pull_down=0;
00557     sys.redraw_all_flag = 1;
00558     sys.redraw_zoom_flag = 0;
00559     sys.set_speed(<a class="code" href="Osys_8h.html#a43a7">DEFAULT_SPEED</a>);
00560     sys.m_o_log_selected=0;
00561     sys.m_o_log_highlighted=-1;
00562     sys.m_o_log_old_selected=-2;
00563     sys.m_o_log_old_highlighted=-2;
00564     sys.m_o_log_display_updated=1;
00565     config.scroll_speed=10;
00566 
00567     battle.run(player_school.scenario_id);
00568 
00569     deinit();
00570 }
00571 
00572 <span class="comment">//------------ End of function Game::play_scenario -----------//</span>
00573 
00574 <span class="comment">//---------- Begin of function Game::credit ----------//</span>
00576 <span class="comment">void Game::credit() {</span>
00577     <span class="keywordtype">int</span> vtab1=100,vtab2=120,vtab3=140;
00578     <span class="keywordtype">int</span> tab1 =200,tab2=530,tab3=650,tab4=750;
00579     sys.redraw_all_flag=1;
00580 
00581     <span class="keywordtype">int</span> credit_state=0;
00582     vga_front.unlock_buf();                         <span class="comment">// chwg1116</span>
00583 
00584     sys.redraw_all_flag = 1;                        <span class="comment">// force repaint once</span>
00585 
00586     <span class="keywordflow">while</span>(1) {
00587         <span class="comment">// handle window message here //</span>
00588         <span class="comment">// ##  begin chwg1116</span>
00589         MSG msg;
00590         <span class="keywordflow">if</span> (PeekMessage( &amp;msg, <a class="code" href="OHELP_8H.html#a0">NULL</a>, 0, 0, PM_NOREMOVE)) {
00591             <span class="keywordflow">if</span> (!GetMessage( &amp;msg, <a class="code" href="OHELP_8H.html#a0">NULL</a>, 0, 0)) {
00592                 sys.signal_exit_flag = 1;
00593                 <span class="comment">// BUGHERE : vga_front is unlocked</span>
00594                 <span class="keywordflow">return</span>;
00595             }
00596             TranslateMessage(&amp;msg);
00597             DispatchMessage(&amp;msg);
00598             <span class="keywordflow">continue</span>;
00599         }
00600         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( sys.paused_flag || !sys.active_flag ) {
00601             WaitMessage();
00602             <span class="keywordflow">continue</span>;
00603         }
00604 
00605         vga_front.lock_buf();                         <span class="comment">// chwg1116</span>
00606 
00607         <span class="keywordflow">if</span>( sys.redraw_all_flag ) {                   <span class="comment">// || m.get_time() - sys.last_redraw_time &gt; 3000 )</span>
00608             vga.use_back();
00609             <span class="comment">// display the background</span>
00610             image_interface.put_large( &amp;vga_back, 0, 0, <span class="stringliteral">"CREDIT"</span> );
00611 
00612             <span class="keywordflow">if</span>(credit_state==0) {
00613                 font_charts.put(tab1,vtab1+80,  <span class="stringliteral">"Published by"</span>);
00614                 font_charts.put(tab1+50,vtab1+100,  <span class="stringliteral">"Alfred P. Sloan Foundation"</span>);
00615                 font_charts.put(tab1,vtab1+140, <span class="stringliteral">"Developed by"</span>);
00616                 font_charts.put(tab1+50,vtab1+160,  <span class="stringliteral">"Enlight Software"</span>);
00617                 font_charts.put(tab1,vtab1+200, <span class="stringliteral">"Simulation Model Developed by"</span>);
00618                 font_charts.put(tab1+50,vtab1+220,  <span class="stringliteral">"The Jackson Hole Higher Education Group"</span>);
00619             }
00620 
00621             <span class="keywordflow">if</span>(credit_state==2) {
00622 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00623 <span class="preprocessor"></span>                font_charts.put(tab1,vtab1+40,<span class="stringliteral">"Original Concept"</span>);
00624                 font_charts.put(tab1+50,vtab1+60,<span class="stringliteral">"Bill Massy"</span>);
00625 
00626                 font_charts.put(tab1,vtab1+90,<span class="stringliteral">"Game Design"</span>);
00627                 font_charts.put(tab1+50,vtab1+110,<span class="stringliteral">"Trevor Chan, Jesse Ausubel, Bill Massy, and Sally Vaughn"</span>);
00628 
00629                 font_charts.put(tab1,vtab1+140,<span class="stringliteral">"Programming Version 2.0"</span>);
00630                 font_charts.put(tab1+50,vtab1+160,<span class="stringliteral">"Gilbert Luis, Kenneth Mo, Macro Yuen"</span>);
00631 
00632                 font_charts.put(tab1,vtab1+190,<span class="stringliteral">"Programming Version 1.0"</span>);
00633                 font_charts.put(tab1+50,vtab1+210,<span class="stringliteral">"Fred Hui, Alan Chea, Kevin Wong, Zhou Bin and Zhang Bing"</span>);
00634 
00635                 font_charts.put(tab1,vtab1+240,<span class="stringliteral">"Graphics"</span>);
00636                 font_charts.put(tab1+50,vtab1+260,<span class="stringliteral">"Chris Whitehouse and Victor Ngai"</span>);
00637 
00638                 font_charts.put(tab1,vtab1+290,<span class="stringliteral">"Game Text"</span>);
00639                 font_charts.put(tab1+50,vtab1+310,<span class="stringliteral">"Jesse Ausubel, Bill Massy, and Sally Vaughn"</span>);
00640 <span class="preprocessor">#else</span>
00641 <span class="preprocessor"></span>                font_charts.put(tab1,vtab1+40,<span class="stringliteral">"Original Concept"</span>);
00642                 font_charts.put(tab1+50,vtab1+60,<span class="stringliteral">"Bill Massy"</span>);
00643 
00644                 font_charts.put(tab1,vtab1+90,<span class="stringliteral">"Game Design"</span>);
00645                 font_charts.put(tab1+50,vtab1+110,<span class="stringliteral">"Trevor Chan, Jesse Ausubel, Bill Massy, and Sally Vaughn"</span>);
00646 
00647                 font_charts.put(tab1,vtab1+140,<span class="stringliteral">"Programming"</span>);
00648                 font_charts.put(tab1+50,vtab1+160,<span class="stringliteral">"Fred Hui, Alan Chea, Kevin Wong, Zhou Bin and Zhang Bing"</span>);
00649 
00650                 font_charts.put(tab1,vtab1+190,<span class="stringliteral">"Graphics"</span>);
00651                 font_charts.put(tab1+50,vtab1+210,<span class="stringliteral">"Chris Whitehouse and Victor Ngai"</span>);
00652 
00653                 font_charts.put(tab1,vtab1+240,<span class="stringliteral">"Game Text"</span>);
00654                 font_charts.put(tab1+50,vtab1+260,<span class="stringliteral">"Jesse Ausubel, Bill Massy, and Sally Vaughn"</span>);
00655 <span class="preprocessor">#endif</span>
00656 <span class="preprocessor"></span>            }
00657 
00658             <span class="keywordflow">if</span>(credit_state==3) {
00659                 font_charts.put(tab1,vtab1+20,<span class="stringliteral">"User Manual and Strategy Guide"</span>);
00660                 font_charts.put(tab1+50,vtab1+40,<span class="stringliteral">"Neil Salkind"</span>);
00661 
00662                 font_charts.put(tab1,vtab1+80,<span class="stringliteral">"Project Manager for Documentation"</span>);
00663                 font_charts.put(tab1+50,vtab1+100,<span class="stringliteral">"David Greely"</span>);
00664                 <span class="comment">//                              font_charts.put(tab1,vtab1+220,"Technical Documentation - Bill Massy (if the technical documents are included in the CDROM)");</span>
00665                 font_charts.put(tab1,vtab1+140,<span class="stringliteral">"Music and Sound Effects"</span>);
00666                 font_charts.put(tab1+50,vtab1+160,<span class="stringliteral">"Roberto Khan and Chris Whitehouse"</span>);
00667                 font_charts.put(tab1,vtab1+200,<span class="stringliteral">"Beta-testing Coordination"</span>);
00668                 font_charts.put(tab1+50,vtab1+220,<span class="stringliteral">"Eva Wong"</span>);
00669                 font_charts.put(tab1,vtab1+260,<span class="stringliteral">"Marketing Management"</span>);
00670                 font_charts.put(tab1+50,vtab1+280,<span class="stringliteral">"Ben Sawyer"</span>);
00671             }
00672             <span class="keywordflow">if</span>(credit_state==1) {                       <span class="comment">//## chea 120899 order change</span>
00673                 font_charts.put(tab1,vtab1+100,<span class="stringliteral">"Project Director (Sloan)"</span>);
00674                 font_charts.put(tab1+50,vtab1+120,<span class="stringliteral">"Jesse Ausubel"</span>);
00675                 font_charts.put(tab1,vtab1+160,<span class="stringliteral">"Project Director (The Jackson Hole Higher Education Group)"</span>);
00676                 font_charts.put(tab1+50,vtab1+180,<span class="stringliteral">"Bill Massy"</span>);
00677                 font_charts.put(tab1,vtab1+220,<span class="stringliteral">"Project Director (Enlight)"</span>);
00678                 font_charts.put(tab1+50,vtab1+240,<span class="stringliteral">"Trevor Chan"</span>);
00679             }
00680 
00681             vga.blt_buf(0,0,799,599);
00682             sys.redraw_all_flag = 0;
00683             sys.last_redraw_time = m.get_time();        <span class="comment">// redraw every 8 sec. Such that if background erased at the beginning, redraw</span>
00684         }
00685         <span class="comment">// ##  end chwg1116</span>
00686 
00687         <span class="comment">// detect</span>
00688         sys.blt_virtual_buf();
00689         sys.yield();
00690         mouse.get_event();
00691         <span class="keywordflow">if</span>(mouse.single_click(2)) {                   <span class="comment">// Cancel to Main Menu button is pressed</span>
00692             credit_state++;
00693             <span class="keywordflow">if</span>(credit_state&gt;3)
00694                 <span class="keywordflow">return</span>;
00695             sys.redraw_all_flag=1;
00696         }
00697         vga_front.unlock_buf();                       <span class="comment">// chwg1116</span>
00698     }
00699 
00700 }
00701 
00702 <span class="comment">//------------ End of function Game::credit -----------//</span>
00703 
<a name="l00704"></a><a class="code" href="classGame.html#a6">00704</a> <span class="keywordtype">void</span> <a class="code" href="classGame.html#a6">Game::hall_of_fame</a>() {
00705     <span class="keywordtype">int</span> vtab1=100,vtab2=120,vtab3=140;
00706     <span class="keywordtype">int</span> tab1 =150,tab2=530,tab3=650,tab4=750;
00707     <span class="keywordtype">int</span> line_spacing = 90;
00708 
00709     game_file_array.init(<span class="stringliteral">"*.SAV"</span>);                  <span class="comment">//## fred 0228  // which will load hallfame.dat</span>
00710     sys.redraw_all_flag=1;
00711 
00712     vga_front.unlock_buf();                         <span class="comment">// chwg1116</span>
00713     <span class="keywordflow">while</span>(1) {
00714         <span class="comment">// handle window message here //</span>
00715         <span class="comment">// ##  begin chwg1116</span>
00716         MSG msg;
00717         <span class="keywordflow">if</span> (PeekMessage( &amp;msg, <a class="code" href="OHELP_8H.html#a0">NULL</a>, 0, 0, PM_NOREMOVE)) {
00718             <span class="keywordflow">if</span> (!GetMessage( &amp;msg, <a class="code" href="OHELP_8H.html#a0">NULL</a>, 0, 0)) {
00719                 sys.signal_exit_flag = 1;
00720                 <span class="comment">// BUGHERE : vga_front is unlocked</span>
00721                 <span class="keywordflow">return</span>;
00722             }
00723             TranslateMessage(&amp;msg);
00724             DispatchMessage(&amp;msg);
00725             <span class="keywordflow">continue</span>;
00726         }
00727         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( sys.paused_flag || !sys.active_flag ) {
00728             WaitMessage();
00729             <span class="keywordflow">continue</span>;
00730         }
00731 
00732         vga_front.lock_buf();                         <span class="comment">// chwg1116</span>
00733         <span class="keywordflow">if</span>( sys.redraw_all_flag ) {                   <span class="comment">// || m.get_time() - sys.last_redraw_time &gt; 3000 )</span>
00734 
00735             vga.use_back();
00736             <span class="comment">// display the background</span>
00737             image_interface.put_large( &amp;vga_back, 0, 0, <span class="stringliteral">"HALL"</span> );
00738             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;<a class="code" href="Ogfile_8h.html#a4a3">HALL_FAME_NUM</a>;i++) {
00739                 <span class="keywordflow">if</span>(game_file_array.hall_fame_array[i].score&lt;=0)
00740                     <span class="keywordflow">break</span>;
00741 
00742                 user_interface.brighten(tab1-5,vtab1+line_spacing*i-5,tab4,vtab1+line_spacing*i+65);
00743                 user_interface.rect(tab1-5,vtab1+line_spacing*i-5,tab4,vtab1+line_spacing*i+65,1);
00744                 font_charts.put
00745                     (tab1+5,vtab1+line_spacing*i,i+1);
00746 
00747                 <a class="code" href="classString.html">String</a> title;
00748                 title = game_file_array.hall_fame_array[i].player_first_name;
00749                 title += <span class="stringliteral">" "</span>;
00750                 title += game_file_array.hall_fame_array[i].player_last_name;
00751                 title += <span class="stringliteral">" of "</span>;
00752                 title += game_file_array.hall_fame_array[i].school_name;
00753                 font_charts.put
00754                     (tab1+40,vtab1+line_spacing*i,title);
00755 
00756                 title = <span class="stringliteral">"Score : "</span>;
00757                 title += game_file_array.hall_fame_array[i].score;
00758                 title += <span class="stringliteral">"  Trustee Evaluation : "</span>;
00759                 title += game_file_array.hall_fame_array[i].trust_score;
00760                 font_charts.put
00761                     (tab1+40,vtab2+line_spacing*i,title);
00762 
00763                 title = <span class="stringliteral">"Period : "</span>;
00764                 title += m.format(game_file_array.hall_fame_array[i].start_year,16);
00765                 title += <span class="stringliteral">" - "</span>;
00766                 title += m.format(game_file_array.hall_fame_array[i].end_year,16);
00767                 font_charts.put
00768                     (tab2+40,vtab2+line_spacing*i,title);
00769 
00770                 <span class="keyword">enum</span> {TMP_SCENARIO_COUNT=<a class="code" href="Opschool_8h.html#a63a32">SCENARIO_COUNT</a>};
00771                 <span class="keyword">static</span> <span class="keywordtype">char</span>* scn_name[TMP_SCENARIO_COUNT] = {
00772                     <span class="stringliteral">"1. [PAY BETTER]"</span>,
00773                     <span class="stringliteral">"2. [ALLOCATE NEW MONEY]"</span>,
00774                     <span class="stringliteral">"3. [TEACH BETTER]"</span>,
00775                     <span class="stringliteral">"4. [IMPROVE RESEARCH PERFORMANCE]"</span>,
00776                     <span class="stringliteral">"5. [WIN GAMES]"</span>,
00777                     <span class="stringliteral">"6. [REDUCE TUITION]"</span>,
00778                     <span class="stringliteral">"7. [RESPOND TO ENROLLMENT SHIFTS]"</span>,
00779                     <span class="stringliteral">"8. [ENROLL MORE MINORITY STUDENTS]"</span>,
00780                     <span class="stringliteral">"9. [HIRE MORE MINORITY FACULTY MEMBERS]"</span>,
00781                     <span class="stringliteral">"10. [BALANCE THE BUDGET]"</span>,
00782 
00783                     <span class="comment">/*"1. BALANCE BUDGET",</span>
00784 <span class="comment">                      "2. RAISE SALARY",</span>
00785 <span class="comment">                      "3. INVEST ACADEMIC",</span>
00786 <span class="comment">                      "4. WINNING ATHLETICS",</span>
00787 <span class="comment">                      "5. LIMIT TUITION GROWTH",</span>
00788 <span class="comment">                    */</span>
00789                 };
00790 
00791                 <span class="keywordflow">if</span>(game_file_array.hall_fame_array[i].scenario_id&gt;0) {
00792                     title = <span class="stringliteral">"Scenario : "</span>;
00793                     <span class="comment">// BUGHERE ##chwg0228</span>
00794                     title += scn_name[game_file_array.hall_fame_array[i].scenario_id-1];
00795 
00796                     title += <span class="stringliteral">""</span>;
00797                     font_charts.put
00798                         (tab1+40,vtab3+line_spacing*i,title);
00799                 }
00800             }
00801             vga.blt_buf(0,0,799,599);
00802 
00803             sys.redraw_all_flag = 0;
00804             sys.last_redraw_time = m.get_time();        <span class="comment">// redraw every 8 sec. Such that if background erased at the beginning, redraw</span>
00805         }
00806 
00807         <span class="comment">// detect</span>
00808         sys.blt_virtual_buf();
00809         sys.yield();
00810         mouse.get_event();
00811         <span class="keywordflow">if</span>(mouse.single_click(2)) {                   <span class="comment">// Cancel to Main Menu button is pressed</span>
00812             <span class="keywordflow">return</span>;
00813         }
00814         vga_front.unlock_buf();                       <span class="comment">// chwg1116</span>
00815     }
00816 
00817 }
00818 
00819 <span class="comment">//------------ End of function Game::hall_of_fame -----------//</span>
00820 
00821 <span class="comment">//#### begin fred 0121 ####//</span>
00822 <span class="comment">//---------- Begin of function Game::scenario_menu ----------//</span>
00824 <span class="comment">void Game::scenario_menu() {</span>
00825     <a class="code" href="ALL_8H.html#a1">err_here</a>();
00826 }
00827 
00828 <span class="comment">//------------ End of function Game::scenario_menu -----------//</span>
00829 
00830 <span class="comment">//---------- Begin of function Game::loadgame_menu ----------//</span>
00832 <span class="comment">void Game::loadgame_menu() {</span>
00833     <span class="comment">//----- initialize first -----//</span>
00834 
00835     <span class="comment">//player_school.init();</span>
00836 
00837     loadgame_init();
00838 
00839     game_set.open_set(1);                           <span class="comment">// open the default game set</span>
00840 
00841     <span class="comment">//---- new screen -----//</span>
00842 
00843     <span class="comment">// display the background</span>
00844     image_interface.put_large( &amp;vga_back, 0, 0, <span class="stringliteral">"EMPTYSCR"</span> );
00845 
00846     info.init();                                    <span class="comment">// no disp_column function for the game setting screen</span>
00847     loadgame_report(<a class="code" href="Gamedef_8h.html#a71a16">INFO_REPAINT</a>);
00848 
00849     sys.redraw_all_flag=1;
00850 
00851     vga_front.unlock_buf();                         <span class="comment">// chwg1116</span>
00852 
00853     <span class="keywordflow">while</span>(1) {
00854 
00855         <span class="comment">// handle window message here //</span>
00856         <span class="comment">// ##  begin chwg1116</span>
00857         MSG msg;
00858         <span class="keywordflow">if</span> (PeekMessage( &amp;msg, <a class="code" href="OHELP_8H.html#a0">NULL</a>, 0, 0, PM_NOREMOVE)) {
00859             <span class="keywordflow">if</span> (!GetMessage( &amp;msg, <a class="code" href="OHELP_8H.html#a0">NULL</a>, 0, 0)) {
00860                 sys.signal_exit_flag = 1;
00861                 <span class="comment">// BUGHERE : vga_front is unlocked</span>
00862                 <span class="keywordflow">return</span>;
00863             }
00864             TranslateMessage(&amp;msg);
00865             DispatchMessage(&amp;msg);
00866             <span class="keywordflow">continue</span>;
00867         }
00868         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( sys.paused_flag || !sys.active_flag ) {
00869             WaitMessage();
00870             <span class="keywordflow">continue</span>;
00871         }
00872         <span class="comment">/*</span>
00873 <span class="comment">          if( sys.redraw_all_flag ) // || m.get_time() - sys.last_redraw_time &gt; 3000 )</span>
00874 <span class="comment">          {</span>
00875 <span class="comment">          sys.redraw_all_flag = 0;</span>
00876 <span class="comment">          sys.last_redraw_time = m.get_time();  // redraw every 8 sec. Such that if background erased at the beginning, redraw</span>
00877 <span class="comment">          loadgame_report(INFO_REPAINT);</span>
00878 <span class="comment">          }</span>
00879 <span class="comment">        */</span>
00880         vga_front.lock_buf();                         <span class="comment">// ## chwg1116</span>
00881         <span class="comment">// ##  end chwg1116</span>
00882 
00883         sys.blt_virtual_buf();
00884         sys.yield();
00885         mouse.get_event();
00886 
00887         <span class="keywordtype">int</span> rc = loadgame_detect();
00888 
00889         <span class="keywordflow">if</span>( rc==1 )                                   <span class="comment">// Start button is pressed</span>
00890             <span class="keywordflow">break</span>;
00891         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( rc == -1 ) {                         <span class="comment">// Cancel button is pressed</span>
00892             loadgame_deinit();
00893 
00894             info.deinit();
00895             game_set.close_set();                       <span class="comment">// close the game set</span>
00896             <span class="keywordflow">return</span>;
00897         }
00898 
00899         loadgame_report(sys.redraw_all_flag?INFO_REPAINT:INFO_UPDATE);
00900         vga_front.unlock_buf();                       <span class="comment">// ## chwg1116</span>
00901     }
00902 
00903     <span class="comment">//----------//</span>
00904     <span class="comment">// the loadgame file is loaded in loadgame_detect which **called** game.init()</span>
00905     <span class="comment">// play now!</span>
00906 
00907     loadgame_deinit();
00908 
00909     user_interface.darken(<a class="code" href="Oworldmt_8h.html#a12">ZOOM_X1</a>,<a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a>,<a class="code" href="Oworldmt_8h.html#a14">ZOOM_X2</a>,<a class="code" href="Oworldmt_8h.html#a15">ZOOM_Y2</a>);
00910     info.disp_column_bitmap(&amp;vga_back);
00911     vga.blt_buf(<a class="code" href="Oworldmt_8h.html#a12">ZOOM_X1</a>,<a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a>,<a class="code" href="Oworldmt_8h.html#a14">ZOOM_X2</a>,<a class="code" href="Oworldmt_8h.html#a15">ZOOM_Y2</a>);
00912 
00913     image_interface.put_large( &amp;vga_back, 0, 0, <span class="stringliteral">"MAINSCR2"</span> );
00914     vga.blt_buf(0,0,799,<a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a>-1);
00915     vga.blt_buf(0,<a class="code" href="Oworldmt_8h.html#a15">ZOOM_Y2</a>+1,799,599);
00916 
00917     vga.use_front();
00918 
00919     <span class="comment">//------- start the game ------//</span>
00920 
00921     sys.staying_view_mode=<a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>;
00922     sys.view_mode=<a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>;
00923     sys.prev_view_mode = <a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>;
00924     sys.back_view_mode = <a class="code" href="Osys_8h.html#a45a9">MODE_NORMAL</a>;
00925     sys.is_institution_report=0;
00926     sys.menu_pull_down=0;
00927     sys.redraw_all_flag = 1;
00928     sys.redraw_zoom_flag = 0;
00929     <span class="comment">//### begin zb 02/25/99</span>
00930     <span class="comment">//  sys.set_speed(DEFAULT_SPEED);</span>
00931     sys.set_speed(sys.save_speed);
00932     <span class="comment">//### end zb 02/25/99</span>
00933     sys.m_o_log_selected=0;
00934     sys.m_o_log_highlighted=-1;
00935     sys.m_o_log_old_selected=-2;
00936     sys.m_o_log_old_highlighted=-2;
00937     sys.m_o_log_display_updated=1;
00938     config.scroll_speed=10;
00939 
00940     sys.run(1);                                     <span class="comment">// 1: load game</span>
00941 
00942     deinit();
00943 }
00944 
00945 <span class="comment">//------------ End of function Game::loadgame_menu -----------//</span>
00946 <span class="comment">//#### end fred 0121 ####//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:43 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
