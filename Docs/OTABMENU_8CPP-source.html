<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OTABMENU.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>OTABMENU.CPP</h1><a href="OTABMENU_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OTABMENU.CPP</span>
00002 <span class="comment">//Description : Object TabMennu</span>
00003 
00004 <span class="comment">// Comments:    still has bugs, memory leak</span>
00005 <span class="comment">//                                      has to be modified for 16-bit color</span>
00006 <span class="comment">// Norris 0716</span>
00007 
00008 <span class="preprocessor">#include &lt;<a class="code" href="ALL_8H.html">ALL.H</a>&gt;</span>
00009 <span class="preprocessor">#include &lt;OINFO.H&gt;</span>
00010 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00011 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00012 <span class="preprocessor">#include &lt;OFONT.H&gt;</span>
00013 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00014 <span class="preprocessor">#include &lt;OIFACE.H&gt;</span>
00015 <span class="preprocessor">#include &lt;<a class="code" href="OTABMENU_8H.html">OTABMENU.H</a>&gt;</span>
00016 <span class="preprocessor">#include &lt;OAUDIO.H&gt;</span>
00017 <span class="preprocessor">#include &lt;OCONFIG.H&gt;</span>
00018 
00019 <span class="comment">//--------- Define macro constant -----------//</span>
00020 
00021 <span class="keyword">enum</span> {
00022     <a class="code" href="OTABMENU_8CPP.html#a2a0">TAB_HEIGHT</a> = 20,
00023     <a class="code" href="OTABMENU_8CPP.html#a2a1">TAB_BOUNDARY</a> = 10
00024 };
00025 
00026 <span class="comment">//-------- Begin of function TabMenu::TabMenu ----//</span>
<a name="l00028"></a><a class="code" href="classTabMenu.html#a0">00028</a> <span class="comment">TabMenu::TabMenu() {</span>
00029 }
00030 
00031 <span class="comment">//---------- End of function TabMenu::TabMenu ----//</span>
00032 
00033 <span class="comment">//-------- Begin of function TabMenu::~TabMenu ---//</span>
<a name="l00035"></a><a class="code" href="classTabMenu.html#a1">00035</a> <span class="comment">TabMenu::~TabMenu() {</span>
00036     deinit();
00037 }
00038 
00039 <span class="comment">//---------- End of function TabMenu::~TabMenu ---//</span>
00040 
00041 <span class="comment">//-------- Begin of function TabMenu::init --------//</span>
<a name="l00061"></a><a class="code" href="classTabMenu.html#a2">00061</a> <span class="comment">void TabMenu::init( int x1, int y1, int x2, int y2,</span>
00062                     <span class="keywordtype">int</span> optionNum, <span class="keywordtype">int</span> *selNum,
00063                     <span class="keywordtype">int</span> shortLength, <span class="keywordtype">int</span> longLength,
00064                     <span class="keywordtype">char</span> **shortDesc, <span class="keywordtype">char</span> **longDesc,
00065                     int (*dispFunc)(<span class="keywordtype">int</span>, <span class="keywordtype">int</span>), int (*detectFunc)(int) ) {
00066     <a class="code" href="ALL_8H.html#a0">err_when</a>(optionNum &lt;= 0 || shortLength &lt;= 0 || longLength &lt;= 0);
00067 
00068     tab_menu_x1 = x1;
00069     tab_menu_x2 = x2;
00070     tab_menu_y1 = y1 + <a class="code" href="OTABMENU_8CPP.html#a2a0">TAB_HEIGHT</a>;
00071     tab_menu_y2 = y2;
00072 
00073     option_num = optionNum;
00074     sel_num = selNum;
00075     short_view_length = shortLength;
00076     long_view_length = longLength;
00077     short_desc = shortDesc;
00078     long_desc = longDesc;
00079     disp_func = dispFunc;
00080     detect_func = detectFunc;
00081 
00082     tab_start = <span class="keyword">new</span> <span class="keywordtype">short</span>[optionNum];
00083     tab_end = <span class="keyword">new</span> <span class="keywordtype">short</span>[optionNum];
00084 
00085     init_flag = 1;
00086     back_img = vga_back.save_area(tab_menu_x1, tab_menu_y1-<a class="code" href="OTABMENU_8CPP.html#a2a0">TAB_HEIGHT</a>,
00087                                   tab_menu_x2, tab_menu_y2,back_img);
00088 
00089     refresh(<a class="code" href="Gamedef_8h.html#a71a16">INFO_REPAINT</a>);
00090 }
00091 
00092 <span class="comment">//------------- End of function TabMenu::init -----------//</span>
00093 
00094 <span class="comment">//-------- Begin of function TabMenu::deinit ------------//</span>
<a name="l00096"></a><a class="code" href="classTabMenu.html#a3">00096</a> <span class="comment">void TabMenu::deinit() {</span>
00097     <span class="keywordflow">if</span>(back_img) {
00098         <a class="code" href="ALL_8H.html#a8">mem_del</a>(back_img);
00099         back_img=<a class="code" href="OHELP_8H.html#a0">NULL</a>;
00100     }
00101 
00102     <span class="keyword">delete</span> [] tab_start;
00103     <span class="keyword">delete</span> [] tab_end;
00104 }
00105 
00106 <span class="comment">//------------- End of function TabMenu::deinit ---------//</span>
00107 
00108 <span class="comment">//----------- Begin of function TabMenu::refresh --------//</span>
<a name="l00110"></a><a class="code" href="classTabMenu.html#a4">00110</a> <span class="comment">void TabMenu::refresh(int refreshFlag) {</span>
00111     <a class="code" href="ALL_8H.html#a0">err_when</a>(*sel_num &gt; option_num || *sel_num &lt; 0);
00112 
00113     <span class="comment">//  mouse.hide_area( tab_menu_x1, tab_menu_y1-TAB_HEIGHT,</span>
00114     <span class="comment">//                                            tab_menu_x2, tab_menu_y2 );</span>
00115 
00116     <span class="keywordflow">if</span> (refreshFlag == <a class="code" href="Gamedef_8h.html#a71a16">INFO_REPAINT</a>) {
00117         vga_back.rest_area(back_img,0,0);
00118         user_interface.brighten(tab_menu_x1, tab_menu_y1+3, tab_menu_x2, tab_menu_y2);
00119         draw_tab();
00120         <span class="comment">//              vga.blt_buf( tab_menu_x1, tab_menu_y1-TAB_HEIGHT,</span>
00121         <span class="comment">//                                               tab_menu_x2, tab_menu_y2 ,0);</span>
00122         label_tab();
00123     }
00124 
00125     disp_func(*sel_num, refreshFlag);
00126     sys.yield();
00127     <span class="comment">//  mouse.show_area();</span>
00128 }
00129 
00130 <span class="comment">//------------- End of function TabMenu::refresh ---------//</span>
00131 
00132 <span class="comment">//----------- Begin of function TabMenu::detect ------------//</span>
<a name="l00137"></a><a class="code" href="classTabMenu.html#a5">00137</a> <span class="comment">int TabMenu::detect() {</span>
00138     <span class="keywordflow">if</span> (!init_flag)
00139         <span class="keywordflow">return</span> 0;
00140 
00141     <span class="comment">//---- If mouse inside tab menu area, call sub-detect function ----//</span>
00142     <span class="comment">//  if (mouse.in_area( tab_menu_x1, tab_menu_y1, tab_menu_x2, tab_menu_y2 ))</span>
00143     <span class="comment">//  {</span>
00144     <span class="comment">//          return detect_func(*sel_num);</span>
00145     <span class="comment">//  }</span>
00146 
00147     <span class="comment">//---- Detect tab click ----//</span>
00148 
00149     <span class="keywordflow">if</span> (mouse.single_click( tab_menu_x1, tab_menu_y1-<a class="code" href="OTABMENU_8CPP.html#a2a0">TAB_HEIGHT</a>,
00150                             tab_end[option_num-1]+<a class="code" href="OTABMENU_8CPP.html#a2a1">TAB_BOUNDARY</a>, tab_menu_y1 )) {
00151         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; option_num; i++) {
00152             <span class="keywordflow">if</span>(*sel_num == i)<span class="keywordflow">continue</span>;
00153             <span class="keywordflow">if</span> (mouse.single_click( tab_start[i]-<a class="code" href="OTABMENU_8CPP.html#a2a1">TAB_BOUNDARY</a>, tab_menu_y1-<a class="code" href="OTABMENU_8CPP.html#a2a0">TAB_HEIGHT</a>,
00154                                     tab_end[i]+<a class="code" href="OTABMENU_8CPP.html#a2a1">TAB_BOUNDARY</a>, tab_menu_y1 )) {
00155                 *sel_num = i;
00156                 refresh(<a class="code" href="Gamedef_8h.html#a71a16">INFO_REPAINT</a>);
00157                 audio.play_wav(<span class="stringliteral">"BEEPS-1"</span>,audio.int_to_DsVolume(config.sound_effect_volume));
00158                 <span class="keywordflow">return</span> 1;
00159             }
00160         }
00161     }
00162 
00163     <span class="comment">//## begin chwg1004 ##//</span>
00164     <span class="keywordflow">return</span> detect_func(*sel_num);
00165     <span class="comment">//## end chwg1004 ##//</span>
00166     <span class="keywordflow">return</span> 0;
00167 }
00168 
00169 <span class="comment">//------------- End of function TabMenu::detect ------------//</span>
00170 
00171 <span class="comment">//----------- Begin of function TabMenu::draw_tab ----------//</span>
00173 <span class="comment">void TabMenu::draw_tab() {</span>
00174     <span class="keywordtype">int</span> i;
00175     <span class="keywordtype">short</span> x = tab_menu_x1 + <a class="code" href="OTABMENU_8CPP.html#a2a1">TAB_BOUNDARY</a>;
00176 
00177     <span class="keywordflow">for</span> (i = 0; i &lt; option_num; i++) {
00178         tab_start[i] = x;
00179         x += (*sel_num == i) ? long_view_length : short_view_length;
00180         tab_end[i] = x;
00181         x += 2 * <a class="code" href="OTABMENU_8CPP.html#a2a1">TAB_BOUNDARY</a>;
00182     }
00183 
00184     <span class="keywordflow">for</span> (i = 0; i &lt; option_num; i++) {
00185         <span class="keywordflow">if</span> (*sel_num != i) {
00186             user_interface.brighten
00187                 (tab_start[i], tab_menu_y1-<a class="code" href="OTABMENU_8CPP.html#a2a0">TAB_HEIGHT</a>,
00188                  tab_end[i], tab_menu_y1+1);
00189         }
00190     }
00191 
00192     <span class="comment">//  user_interface.brighten</span>
00193     <span class="comment">//          (tab_start[*sel_num], tab_menu_y1-TAB_HEIGHT,</span>
00194     <span class="comment">//                                                          tab_end[*sel_num], tab_menu_y1+3);</span>
00195     vga_back.d3_panel_up
00196         (tab_start[*sel_num], tab_menu_y1-<a class="code" href="OTABMENU_8CPP.html#a2a0">TAB_HEIGHT</a>,
00197          tab_end[*sel_num], tab_menu_y1+3);
00198     user_interface.brighten
00199         ( tab_menu_x1, tab_menu_y1+3,
00200           tab_menu_x2, tab_menu_y2);
00201     user_interface.rect
00202         ( tab_menu_x1, tab_menu_y1+3,
00203           tab_menu_x2, tab_menu_y2);
00204 
00205 }
00206 
00207 <span class="comment">//------------- End of function TabMenu::draw_tab ---------//</span>
00208 
00209 <span class="comment">//----------- Begin of function TabMenu::label_tab --------//</span>
00211 <span class="comment">void TabMenu::label_tab() {</span>
00212     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; option_num; i++) {
00213         font_charts.center_put(tab_start[i], tab_menu_y1-<a class="code" href="OTABMENU_8CPP.html#a2a0">TAB_HEIGHT</a>+2,
00214                                tab_end[i], tab_menu_y1+4,
00215                                (*sel_num == i) ? long_desc[i] : short_desc[i]);
00216     }
00217 }
00218 
00219 <span class="comment">//------------- End of function TabMenu::label_tab --------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:30 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
