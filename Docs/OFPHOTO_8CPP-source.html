<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OFPHOTO.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>OFPHOTO.CPP</h1><a href="OFPHOTO_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//Filename    : OFPHOTO.CPP</span>
00002 <span class="comment">//Description : FacultyPhotoRes Class Definition</span>
00003 
00004 <span class="preprocessor">#include &lt;All.h&gt;</span>
00005 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00006 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00007 <span class="preprocessor">#include &lt;OSTR.h&gt;</span>
00008 <span class="preprocessor">#include &lt;OMISC.h&gt;</span>
00009 <span class="preprocessor">#include &lt;<a class="code" href="OGAMESET_8H.html">OGAMESET.H</a>&gt;</span>
00010 <span class="preprocessor">#include &lt;OFPHOTO.h&gt;</span>
00011 
00012 <span class="comment">//----------- Define constants -------------//</span>
00013 
<a name="l00014"></a><a class="code" href="OFPHOTO_8CPP.html#a0">00014</a> <span class="preprocessor">#define FACULTY_PHOTO_DB      "FPHOTO"</span>
00015 <span class="preprocessor"></span>
00016 <span class="comment">//----------- Begin of function FacultyPhotoRes Constructor -----//</span>
<a name="l00018"></a><a class="code" href="classFacultyPhotoRes.html#a0">00018</a> <span class="comment">FacultyPhotoRes::FacultyPhotoRes() {</span>
00019     init_flag=0;
00020 }
00021 
00022 <span class="comment">//------------- End of function FacultyPhotoRes Constructor -----//</span>
00023 
00024 <span class="comment">//----------- Begin of function FacultyPhotoRes Destructor ------//</span>
00026 <span class="comment"></span>
<a name="l00027"></a><a class="code" href="classFacultyPhotoRes.html#a1">00027</a> <a class="code" href="classFacultyPhotoRes.html#a1">FacultyPhotoRes::~FacultyPhotoRes</a>() {
00028     <a class="code" href="classFacultyPhotoRes.html#a3">deinit</a>();
00029 }
00030 
00031 <span class="comment">//------------- End of function FacultyPhotoRes Destructor ------//</span>
00032 
00033 <span class="comment">//----------- Begin of function FacultyPhotoRes::init --------//</span>
<a name="l00035"></a><a class="code" href="classFacultyPhotoRes.html#a2">00035</a> <span class="comment">void FacultyPhotoRes::init() {</span>
00036     <span class="keywordflow">if</span>( init_flag )
00037         <span class="keywordflow">return</span>;
00038 
00039     <span class="comment">//---- open faculty photo resource file ----//</span>
00040 
00041     <a class="code" href="classString.html">String</a> str;
00042 
00043     str  = <a class="code" href="Gamedef_8h.html#a4">DIR_RES</a>;
00044     str += <span class="stringliteral">"I_FPHOTO.RES"</span>;
00045 
00046     res_photo.init_imported(str, 1);                <span class="comment">// 1-don't read all into buffer</span>
00047 
00048     <span class="comment">//----- read info from FPHOTO.DBF ------//</span>
00049 
00050     load_info();
00051 
00052     <span class="comment">//----------------------------------------//</span>
00053 
00054     init_flag=1;
00055 }
00056 
00057 <span class="comment">//------------- End of function FacultyPhotoRes::init --------//</span>
00058 
00059 <span class="comment">//----------- Begin of function FacultyPhotoRes::deinit --------//</span>
<a name="l00061"></a><a class="code" href="classFacultyPhotoRes.html#a3">00061</a> <span class="comment">void FacultyPhotoRes::deinit() {</span>
00062     <span class="keywordflow">if</span>( init_flag ) {
00063         <a class="code" href="ALL_8H.html#a8">mem_del</a>(info_array);
00064 
00065         res_photo.deinit();
00066 
00067         init_flag=0;
00068     }
00069 }
00070 
00071 <span class="comment">//------------- End of function FacultyPhotoRes::deinit --------//</span>
00072 
00073 <span class="comment">//----------- Begin of function FacultyPhotoRes::load_info -------//</span>
00077 <span class="comment">void FacultyPhotoRes::load_info() {</span>
00078     <a class="code" href="structFacultyPhotoRec.html">FacultyPhotoRec</a>   *photoRec;
00079     <a class="code" href="structFacultyPhoto.html">FacultyPhoto</a>    *photoInfo;
00080     <a class="code" href="classDatabase.html">Database</a>      *dbFacultyPhoto = game_set.open_db(<a class="code" href="OFPHOTO_8CPP.html#a0">FACULTY_PHOTO_DB</a>);
00081     <span class="keywordtype">int</span>         bitmapOffset;
00082 
00083     photo_count = (short) dbFacultyPhoto-&gt;<a class="code" href="classDatabase.html#a7">rec_count</a>();
00084     info_array  = (<a class="code" href="structFacultyPhoto.html">FacultyPhoto</a>*) <a class="code" href="ALL_8H.html#a5">mem_add</a>( <span class="keyword">sizeof</span>(<a class="code" href="structFacultyPhoto.html">FacultyPhoto</a>)*photo_count );
00085 
00086     <span class="comment">//------ read in photo bitmap info array -------//</span>
00087 
00088     memset( info_array, 0, <span class="keyword">sizeof</span>(<a class="code" href="structFacultyPhoto.html">FacultyPhoto</a>) * photo_count );
00089 
00090     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0 ; i&lt;photo_count ; i++ ) {
00091         photoRec  = (<a class="code" href="structFacultyPhotoRec.html">FacultyPhotoRec</a>*) dbFacultyPhoto-&gt;<a class="code" href="classDatabase.html#a4">read</a>(i+1);
00092         photoInfo = info_array+i;
00093 
00094         <span class="keywordflow">switch</span>( photoRec-&gt;<a class="code" href="structFacultyPhotoRec.html#m1">nationality</a>[0] ) {
00095         <span class="keywordflow">case</span> <span class="charliteral">'A'</span>:                                   <span class="comment">// Asian</span>
00096         <span class="keywordflow">case</span> <span class="charliteral">'B'</span>:                                   <span class="comment">// Black</span>
00097             <span class="keywordflow">if</span>( photoRec-&gt;<a class="code" href="structFacultyPhotoRec.html#m0">sex</a> == <span class="charliteral">'M'</span> )
00098                 photoInfo-&gt;<a class="code" href="structFacultyPhoto.html#m0">gender_ethnic_group</a> = <a class="code" href="Gamedef_8h.html#a75a29">MINORITY_MALE</a>;
00099             <span class="keywordflow">else</span>
00100                 photoInfo-&gt;<a class="code" href="structFacultyPhoto.html#m0">gender_ethnic_group</a> = <a class="code" href="Gamedef_8h.html#a75a30">MINORITY_FEMALE</a>;
00101             <span class="keywordflow">break</span>;
00102 
00103         <span class="keywordflow">case</span> <span class="charliteral">'W'</span>:                                   <span class="comment">// Western</span>
00104             <span class="keywordflow">if</span>( photoRec-&gt;<a class="code" href="structFacultyPhotoRec.html#m0">sex</a> == <span class="charliteral">'M'</span> )
00105                 photoInfo-&gt;<a class="code" href="structFacultyPhoto.html#m0">gender_ethnic_group</a> = <a class="code" href="Gamedef_8h.html#a75a27">NONMINORITY_MALE</a>;
00106             <span class="keywordflow">else</span>
00107                 photoInfo-&gt;<a class="code" href="structFacultyPhoto.html#m0">gender_ethnic_group</a> = <a class="code" href="Gamedef_8h.html#a75a28">NONMINORITY_FEMALE</a>;
00108             <span class="keywordflow">break</span>;
00109         }
00110 
00111         memcpy( &amp;bitmapOffset, photoRec-&gt;<a class="code" href="structFacultyPhotoRec.html#m3">bitmap_ptr</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">long</span>) );
00112 
00113         photoInfo-&gt;<a class="code" href="structFacultyPhoto.html#m1">bitmap_ptr</a> = res_photo.read_imported(bitmapOffset);
00114 
00115         <span class="comment">//## fred</span>
00116         <a class="code" href="ALL_8H.html#a0">err_when</a>( photoInfo-&gt;<a class="code" href="structFacultyPhoto.html#m0">gender_ethnic_group</a> &lt; 0 || photoInfo-&gt;<a class="code" href="structFacultyPhoto.html#m0">gender_ethnic_group</a> &gt;= <a class="code" href="Gamedef_8h.html#a74a26">GENDER_ETHNIC_TYPE_COUNT</a> );
00117     }
00118 }
00119 
00120 <span class="comment">//----------- End of function FacultyPhotoRes::load_info -------//</span>
00121 
00122 <span class="comment">//---------- Begin of function FacultyPhotoRes::operator[] -----------//</span>
00123 
<a name="l00124"></a><a class="code" href="classFacultyPhotoRes.html#a5">00124</a> <a class="code" href="structFacultyPhoto.html">FacultyPhoto</a>* <a class="code" href="classFacultyPhotoRes.html#a5">FacultyPhotoRes::operator[]</a>(<span class="keywordtype">int</span> photoId) {
00125     <a class="code" href="ALL_8H.html#a2">err_if</a>( photoId&lt;1 || photoId&gt;<a class="code" href="classFacultyPhotoRes.html#m1">photo_count</a> )
00126         <a class="code" href="ALL_8H.html#a4">err_now</a>( <span class="stringliteral">"FacultyPhotoRes::operator[]"</span> );
00127 
00128     <span class="keywordflow">return</span> <a class="code" href="classFacultyPhotoRes.html#m2">info_array</a>+photoId-1;
00129 }
00130 
00131 <span class="comment">//------------ End of function FacultyPhotoRes::operator[] -----------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:37:41 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
