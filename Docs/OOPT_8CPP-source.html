<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OOPT.CPP Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.17 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>OOPT.CPP</h1><a href="OOPT_8CPP.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 <span class="comment">//Filename    : OOPT.CPP</span>
00003 <span class="comment">//Description : Optimization class - main body</span>
00004 
00005 <span class="preprocessor">#include &lt;OSYS.H&gt;</span>
00006 <span class="preprocessor">#include &lt;<a class="code" href="OBOX_8H.html">OBOX.H</a>&gt;</span>
00007 <span class="preprocessor">#include &lt;<a class="code" href="OGAMESET_8H.html">OGAMESET.H</a>&gt;</span>
00008 <span class="preprocessor">#include &lt;OWORLDMT.H&gt;</span>
00009 <span class="preprocessor">#include &lt;<a class="code" href="OBNDSLDR_8H.html">OBNDSLDR.H</a>&gt;</span>
00010 <span class="preprocessor">#include &lt;<a class="code" href="OVGA_8H.html">OVGA.H</a>&gt;</span>
00011 <span class="preprocessor">#include &lt;<a class="code" href="COLOR_8H.html">COLOR.H</a>&gt;</span>
00012 <span class="preprocessor">#include &lt;OFINANCE.H&gt;</span>
00013 <span class="preprocessor">#include &lt;OFONT.H&gt;</span>
00014 <span class="preprocessor">#include &lt;OGAMESTR.H&gt;</span>
00015 <span class="preprocessor">#include &lt;OMOUSE.H&gt;</span>
00016 <span class="preprocessor">#include &lt;OOPT.H&gt;</span>
00017 <span class="preprocessor">#include &lt;OIFACE.H&gt;</span>
00018 <span class="preprocessor">#include &lt;OBUTTON.H&gt;</span>
00019 <span class="preprocessor">#include &lt;ODEPT.H&gt;</span>
00020 
00021 <span class="comment">//------- Define constants -------//</span>
00022 
00023 <span class="keyword">enum</span> {
00024     <a class="code" href="OOPT_8CPP.html#a17a4">REPORT_X1</a> = <a class="code" href="Oworldmt_8h.html#a12">ZOOM_X1</a> + 15,
00025     <a class="code" href="OOPT_8CPP.html#a17a5">REPORT_Y1</a> = <a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a> + 25,
00026     <a class="code" href="OOPT_8CPP.html#a17a6">REPORT_X2</a> = <a class="code" href="Oworldmt_8h.html#a14">ZOOM_X2</a> - 15,
00027     <a class="code" href="OOPT_8CPP.html#a17a7">REPORT_Y2</a> = <a class="code" href="Oworldmt_8h.html#a15">ZOOM_Y2</a> - 60
00028 };
00029 
00030 <span class="keyword">enum</span> {
00031     <a class="code" href="OOPT_8CPP.html#a18a8">BUTTON_X1</a> = <a class="code" href="OOPT_8CPP.html#a17a4">REPORT_X1</a> + 70,
00032     <a class="code" href="OOPT_8CPP.html#a18a9">BUTTON_Y1</a> = <a class="code" href="OOPT_8CPP.html#a17a7">REPORT_Y2</a> + 15,
00033     <a class="code" href="OOPT_8CPP.html#a18a10">BUTTON_X2</a> = <a class="code" href="OOPT_8CPP.html#a17a6">REPORT_X2</a> - 70,
00034     <a class="code" href="OOPT_8CPP.html#a18a11">BUTTON_Y2</a> = <a class="code" href="OOPT_8CPP.html#a17a7">REPORT_Y2</a> + 40,
00035     <a class="code" href="OOPT_8CPP.html#a18a12">BUTTON_OPTIMIZE_WIDTH</a> = 350,
00036     <a class="code" href="OOPT_8CPP.html#a18a13">BUTTON_BACK_WIDTH</a> = 80,
00037     <a class="code" href="OOPT_8CPP.html#a18a14">BUTTON_NEXT_WIDTH</a> = 80,
00038     <a class="code" href="OOPT_8CPP.html#a18a15">BUTTON_DISTANCE</a> = (<a class="code" href="OOPT_8CPP.html#a18a10">BUTTON_X2</a> - <a class="code" href="OOPT_8CPP.html#a18a8">BUTTON_X1</a> - <a class="code" href="OOPT_8CPP.html#a18a12">BUTTON_OPTIMIZE_WIDTH</a> - <a class="code" href="OOPT_8CPP.html#a18a13">BUTTON_BACK_WIDTH</a> - <a class="code" href="OOPT_8CPP.html#a18a14">BUTTON_NEXT_WIDTH</a>) / 2
00039 };
00040 
00041 <span class="keyword">enum</span> {  <a class="code" href="OOPT_8CPP.html#a19a16">BG_PIC_ID</a> = 3 };
00042 
00043 <span class="comment">//-------- define static vars -----------//</span>
00044 
00045 <span class="keyword">static</span> <span class="keywordtype">char</span> redraw_flag = 0;
00046 <span class="keyword">static</span> <a class="code" href="classButton.html">Button</a> button_optimize, button_back, button_next;
00047 
00048 <span class="comment">//------- Begin of function Optimization::Optimization -----------//</span>
<a name="l00050"></a><a class="code" href="classOptimization.html#a0">00050</a> <span class="comment">Optimization::Optimization() {</span>
00051     init();
00052 
00053     init_stage_1();
00054     init_stage_2();
00055     init_stage_3();
00056 }
00057 
00058 <span class="comment">//--------- End of function Optimization::Optimization -----------//</span>
00059 
00060 <span class="comment">//------- Begin of function Optimization::~Optimization -----------//</span>
<a name="l00062"></a><a class="code" href="classOptimization.html#a1">00062</a> <span class="comment">Optimization::~Optimization() {</span>
00063     deinit();
00064 }
00065 
00066 <span class="comment">//--------- End of function Optimization::~Optimization -----------//</span>
00067 
00068 <span class="comment">//------- Begin of function Optimization::deinit ---------------//</span>
<a name="l00070"></a><a class="code" href="classOptimization.html#a3">00070</a> <span class="comment">void Optimization::deinit() {</span>
00071     <span class="keywordflow">switch</span> (stage_init_flag) {
00072     <span class="keywordflow">case</span> 1: deinit_stage_1();
00073         <span class="keywordflow">break</span>;
00074 
00075     <span class="keywordflow">case</span> 2: deinit_stage_2();
00076         <span class="keywordflow">break</span>;
00077 
00078     <span class="keywordflow">case</span> 3: deinit_stage_3();
00079         <span class="keywordflow">break</span>;
00080 
00081     <span class="keywordflow">default</span>:
00082         stage_init_flag = 0;
00083     }
00084 }
00085 
00086 <span class="comment">//--------- End of function Optimization::deinit ---------------//</span>
00087 
00088 <span class="comment">//------- Begin of function Optimization::init -----------------//</span>
<a name="l00090"></a><a class="code" href="classOptimization.html#a2">00090</a> <span class="comment">void Optimization::init() {</span>
00091 }
00092 
00093 <span class="comment">//--------- End of function Optimization::init -----------------//</span>
00094 
00095 <span class="comment">//------- Begin of function Optimization::disp ---------------//</span>
<a name="l00097"></a><a class="code" href="classOptimization.html#a4">00097</a> <span class="comment">void Optimization::disp(int refreshFlag) {</span>
00098     vga.use_back();
00099 
00100     <span class="keywordflow">if</span> (refreshFlag == <a class="code" href="Gamedef_8h.html#a71a16">INFO_REPAINT</a>) {
00101         <span class="comment">//------------- paint the background ----------------//</span>
00102         user_interface.bg_img(<a class="code" href="OOPT_8CPP.html#a19a16">BG_PIC_ID</a>, &amp;vga_back);
00103 
00104         <span class="keywordtype">short</span> x = <a class="code" href="OOPT_8CPP.html#a18a8">BUTTON_X1</a>;
00105 
00106         button_back.<a class="code" href="classButton.html#a11">paint_text</a>( x, <a class="code" href="OOPT_8CPP.html#a18a9">BUTTON_Y1</a>,
00107                                 x+<a class="code" href="OOPT_8CPP.html#a18a13">BUTTON_BACK_WIDTH</a>, <a class="code" href="OOPT_8CPP.html#a18a11">BUTTON_Y2</a>, <span class="stringliteral">"&lt;&lt; Back"</span> );
00108 
00109         x += <a class="code" href="OOPT_8CPP.html#a18a13">BUTTON_BACK_WIDTH</a> + <a class="code" href="OOPT_8CPP.html#a18a15">BUTTON_DISTANCE</a>;
00110 
00111         button_optimize.<a class="code" href="classButton.html#a11">paint_text</a>( x, <a class="code" href="OOPT_8CPP.html#a18a9">BUTTON_Y1</a>,
00112                                     x+<a class="code" href="OOPT_8CPP.html#a18a12">BUTTON_OPTIMIZE_WIDTH</a>, <a class="code" href="OOPT_8CPP.html#a18a11">BUTTON_Y2</a>, <span class="stringliteral">"Optimize"</span>);
00113 
00114         x += <a class="code" href="OOPT_8CPP.html#a18a12">BUTTON_OPTIMIZE_WIDTH</a> + <a class="code" href="OOPT_8CPP.html#a18a15">BUTTON_DISTANCE</a>;
00115 
00116 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00117 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ( current_stage == 3 ) {
00118             <span class="keywordtype">char</span> buttonText[123];
00119             strcpy ( buttonText, <span class="stringliteral">"Start Year "</span> );
00120             strcat( buttonText, m.format(info.game_year) );
00121             button_next.<a class="code" href="classButton.html#a11">paint_text</a>( x, <a class="code" href="OOPT_8CPP.html#a18a9">BUTTON_Y1</a>, x+<a class="code" href="OOPT_8CPP.html#a18a14">BUTTON_NEXT_WIDTH</a>*2-20, <a class="code" href="OOPT_8CPP.html#a18a11">BUTTON_Y2</a>, buttonText );
00122         }
00123         <span class="keywordflow">else</span>
00124 <span class="preprocessor">#endif</span>
00125 <span class="preprocessor"></span>            button_next.<a class="code" href="classButton.html#a11">paint_text</a>( x, <a class="code" href="OOPT_8CPP.html#a18a9">BUTTON_Y1</a>,
00126                                     x+<a class="code" href="OOPT_8CPP.html#a18a14">BUTTON_NEXT_WIDTH</a>, <a class="code" href="OOPT_8CPP.html#a18a11">BUTTON_Y2</a>, <span class="stringliteral">"Next &gt;&gt;"</span> );
00127     }
00128 
00129     <span class="comment">//-------------------------------------------------//</span>
00130 
00131     <span class="keywordflow">switch</span>(current_stage) {
00132     <span class="keywordflow">case</span> 1: report_stage_1(refreshFlag); <span class="keywordflow">break</span>;
00133     <span class="keywordflow">case</span> 2: report_stage_2(refreshFlag); <span class="keywordflow">break</span>;
00134     <span class="keywordflow">case</span> 3: report_stage_3(refreshFlag); <span class="keywordflow">break</span>;
00135     }
00136 
00137     <span class="keywordflow">if</span> (refreshFlag == <a class="code" href="Gamedef_8h.html#a71a16">INFO_REPAINT</a>) {
00138         vga.blt_buf(<a class="code" href="Oworldmt_8h.html#a12">ZOOM_X1</a>, <a class="code" href="Oworldmt_8h.html#a13">ZOOM_Y1</a>, <a class="code" href="Oworldmt_8h.html#a14">ZOOM_X2</a>, <a class="code" href="Oworldmt_8h.html#a15">ZOOM_Y2</a>);
00139     }
00140 
00141     <span class="keywordflow">if</span>((button_optimize_is_down==1)
00142        <span class="comment">// chwg992407</span>
00143        &amp;&amp;(is_optimize_slider_modified[current_stage-1]==0)) {
00144         button_optimize.<a class="code" href="classButton.html#a20">paint</a>();
00145         vga.blt_buf( <a class="code" href="OOPT_8CPP.html#a18a8">BUTTON_X1</a> + <a class="code" href="OOPT_8CPP.html#a18a13">BUTTON_BACK_WIDTH</a> + <a class="code" href="OOPT_8CPP.html#a18a15">BUTTON_DISTANCE</a>,
00146                      <a class="code" href="OOPT_8CPP.html#a18a9">BUTTON_Y1</a>,
00147                      <a class="code" href="OOPT_8CPP.html#a18a8">BUTTON_X1</a> + <a class="code" href="OOPT_8CPP.html#a18a13">BUTTON_BACK_WIDTH</a> + <a class="code" href="OOPT_8CPP.html#a18a15">BUTTON_DISTANCE</a> + <a class="code" href="OOPT_8CPP.html#a18a12">BUTTON_OPTIMIZE_WIDTH</a>, <a class="code" href="OOPT_8CPP.html#a18a11">BUTTON_Y2</a>);
00148         button_optimize_is_down=0;
00149         is_optimize_slider_modified[current_stage-1]=1;
00150     }
00151     <span class="comment">//---- can only proceed to the next when the optimization has been completed ----//</span>
00152 
00153     vga.use_front();
00154     <span class="keywordflow">if</span>(!is_optimize_slider_modified[current_stage-1]) {
00155         button_optimize.<a class="code" href="classButton.html#a27">enable</a>();
00156         button_next.<a class="code" href="classButton.html#a26">disable</a>();
00157 
00158     }
00159     <span class="comment">/*</span>
00160 <span class="comment">      //## chea 051199 BEGIN to change th back button</span>
00161 <span class="comment">      else if(info.debug_enroll == 8 &amp;&amp; button_optimize_is_down == 0)</span>
00162 <span class="comment">      {</span>
00163 <span class="comment">      if(!is_optimize_slider_modified[current_stage-1])</span>
00164 <span class="comment">      {</span>
00165 <span class="comment">      button_optimize.disable();</span>
00166 <span class="comment">      button_next.enable();</span>
00167 <span class="comment">      }</span>
00168 <span class="comment">      else</span>
00169 <span class="comment">      {</span>
00170 <span class="comment">      button_optimize.enable();</span>
00171 <span class="comment">      button_next.disable();</span>
00172 <span class="comment">      }</span>
00173 <span class="comment">      }</span>
00174 <span class="comment">      //## chea 051199 END to change th back button</span>
00175 <span class="comment">    */</span>
00176     <span class="keywordflow">else</span> {
00177         button_optimize.<a class="code" href="classButton.html#a26">disable</a>();
00178         button_next.<a class="code" href="classButton.html#a27">enable</a>();
00179     }
00180 
00181 }
00182 
00183 <span class="comment">//--------- End of function Optimization::disp --------------//</span>
00184 
00185 <span class="comment">//------- Begin of function Optimization::detect ---------------//</span>
<a name="l00187"></a><a class="code" href="classOptimization.html#a5">00187</a> <span class="comment">int Optimization::detect() {</span>
00188     vga.use_back();
00189 
00190     <span class="keywordtype">int</span> rc = detect2();
00191 
00192     vga.use_front();
00193 
00194     <span class="keywordflow">return</span> rc;
00195 }
00196 
00197 <span class="comment">//--------- End of function Optimization::detect --------------//</span>
00198 
00199 <span class="comment">//------- Begin of function Optimization::detect2 ---------------//</span>
<a name="l00201"></a><a class="code" href="classOptimization.html#a6">00201</a> <span class="comment">int Optimization::detect2() {</span>
00202     <span class="keywordflow">if</span> (button_optimize.<a class="code" href="classButton.html#a21">detect</a>()) {
00203         <span class="comment">// ##fred 1029</span>
00204         <span class="comment">//if (result_flag)</span>
00205         <span class="comment">//      return 1;</span>
00206 
00207         <span class="comment">//----------------------------------------------------------//</span>
00208         <span class="comment">// Notes:       a dialog box should pop-up when optimize_policy_x</span>
00209         <span class="comment">//                              returns false, to be modified</span>
00210         <span class="comment">// Norris 0717</span>
00211         <span class="comment">//----------------------------------------------------------//</span>
00212         button_optimize_is_down=1;
00213         <span class="keywordflow">switch</span> (current_stage) {
00214         <span class="keywordflow">case</span> 1:
00215             <span class="keywordflow">if</span>(is_optimize_slider_modified[0]==0) {
00216                 <span class="keywordflow">if</span> (finance.optimize_policy_1()) {
00217                     result_flag = 1;
00218                     is_optimized[0] = 1;
00219                 }
00220                 <span class="keywordflow">else</span>
00221                     result_flag = 0;                      <span class="comment">//## fred</span>
00222                 <span class="keywordflow">break</span>;
00223 
00224                 is_optimize_slider_modified[0]=1;
00225             }
00226         <span class="keywordflow">case</span> 2:
00227             <span class="keywordflow">if</span>(is_optimize_slider_modified[1]==0) {
00228                 <span class="keywordflow">if</span> (finance.optimize_policy_2()) {
00229                     result_flag = 1;
00230                     is_optimized[1] = 1;
00231                     finance.pre_optimization_stage_3();   <span class="comment">//## fred 990507</span>
00232                 }
00233                 <span class="keywordflow">else</span>
00234                     result_flag = 0;                      <span class="comment">//## fred</span>
00235                 <span class="keywordflow">break</span>;
00236 
00237                 is_optimize_slider_modified[1]=1;
00238             }
00239 
00240         <span class="keywordflow">case</span> 3:
00241             <span class="keywordflow">if</span>(is_optimize_slider_modified[2]==0) {
00242                 <span class="keywordflow">if</span> (finance.optimize_policy_3()) {
00243 
00244                     <span class="comment">//## chea 300799 CDE</span>
00245 
00246                     <span class="keywordtype">int</span> deptC=0;
00247                     deptC = department_array.department_count;
00248                     deptC--;
00249 
00250                     <span class="comment">//BUGHERE</span>
00251                     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> t=0; t &lt;= deptC; t++) {
00252                         *(optimization.opt3_slider_group[t].up_ptr)= (finance.hiring_policy_array[t].upper_bound);
00253                         *(optimization.opt3_slider_group[t].var_ptr)= (finance.hiring_policy_array[t].target_value);
00254                         vga.use_back();
00255                         <span class="comment">/*</span>
00256 <span class="comment">                          if(info.debug_enroll!=8)      //## chea 051199 BEGIN to change th back button</span>
00257 <span class="comment">                          optimization.opt3_slider_group[t].refresh();</span>
00258 <span class="comment">                        */</span>
00259                     }     
00260                     <span class="comment">//## chea 300799 cde</span>
00261 
00262                     result_flag = 1;
00263                     is_optimized[2] = 1;
00264                 }
00265                 <span class="keywordflow">else</span>
00266                     result_flag = 0;                      <span class="comment">//## fred</span>
00267                 <span class="keywordflow">break</span>;
00268 
00269                 is_optimize_slider_modified[2]=1;
00270             }
00271         }
00272 
00273         <span class="comment">// display modal dialog box if optimization fails</span>
00274         <span class="keywordflow">if</span>(result_flag == 0)
00275             box.msg(<span class="stringliteral">"optimization fails"</span>);
00276 
00277         <span class="keywordflow">return</span> 1;
00278     }
00279 
00280     <span class="comment">//--------------------------------------//</span>
00281 
00282     <span class="keywordtype">int</span> newStage = -1;
00283 
00284     <span class="keywordflow">if</span>( button_back.<a class="code" href="classButton.html#a21">detect</a>() ) {
00285         newStage = current_stage-1;
00286 
00287 <span class="preprocessor">#if(GAME_VERSION&gt;=200)</span>
00288 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ( current_stage == 1 ) {                   <span class="comment">// first page</span>
00289             <span class="comment">// should return to faculty turnover</span>
00290             <span class="keywordflow">return</span> 2;
00291         }
00292 <span class="preprocessor">#endif</span>
00293 <span class="preprocessor"></span>        <span class="comment">/*</span>
00294 <span class="comment">          // ##chwg073099 begin</span>
00295 <span class="comment">          if(current_stage==3)</span>
00296 <span class="comment">          {</span>
00297 <span class="comment">          is_optimized[2] = 0;</span>
00298 <span class="comment">          is_optimize_slider_modified[2]=0;</span>
00299 <span class="comment">          }</span>
00300 <span class="comment">          // ##chwg073099 begin</span>
00301 <span class="comment">        */</span>
00302         <span class="comment">//## chea 051199 BEGIN to change th back button</span>
00303         is_optimized[newStage] = 0;
00304         is_optimize_slider_modified[newStage]=0;
00305         is_optimized[current_stage] = 0;
00306         is_optimize_slider_modified[current_stage]=0;
00307         <span class="comment">//## chea 051199 END to change th back button</span>
00308     }
00309 
00310     <span class="keywordflow">if</span>( button_next.<a class="code" href="classButton.html#a21">detect</a>() )
00311         newStage = current_stage+1;
00312 
00313     <span class="keywordflow">if</span>( newStage &gt;= 0 ) {
00314         result_flag = 0;
00315 
00316         <span class="keywordflow">switch</span>( current_stage ) {                     <span class="comment">// deinit the existing stage variables</span>
00317         <span class="keywordflow">case</span> 1:
00318             deinit_stage_1();
00319             <span class="keywordflow">break</span>;
00320 
00321         <span class="keywordflow">case</span> 2:
00322             deinit_stage_2();
00323             <span class="keywordflow">break</span>;
00324 
00325         <span class="keywordflow">case</span> 3:
00326             deinit_stage_3();
00327             <span class="keywordflow">break</span>;
00328         }
00329 
00330         current_stage = newStage;
00331         optimization.button_optimize_is_down=0;
00332         redraw_flag = 1;
00333 
00334         <span class="keywordflow">return</span> 1;
00335     }
00336 
00337     <span class="comment">//-----------------------------------//</span>
00338 
00339     <span class="keywordflow">switch</span> (current_stage) {
00340     <span class="keywordflow">case</span> 1:
00341         <span class="keywordflow">if</span> (detect_stage_1())
00342             <span class="keywordflow">return</span> 1;
00343         <span class="keywordflow">break</span>;
00344 
00345     <span class="keywordflow">case</span> 2:
00346         <span class="keywordflow">if</span> (detect_stage_2())
00347             <span class="keywordflow">return</span> 1;
00348         <span class="keywordflow">break</span>;
00349 
00350     <span class="keywordflow">case</span> 3:
00351         <span class="keywordflow">if</span> (detect_stage_3())
00352             <span class="keywordflow">return</span> 1;
00353         <span class="keywordflow">break</span>;
00354     }
00355 
00356     <span class="keywordflow">return</span> 0;
00357 }
00358 
00359 <span class="comment">//--------- End of function Optimization::detect2 --------------//</span>
</pre></div><hr><address style="align: right;"><small>Generated on Fri Aug 23 01:38:08 2002 for VirtualU by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.17 </small></address>
</body>
</html>
